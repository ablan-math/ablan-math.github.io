<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- SYSTEM COMPLIANCE LOG: FixTabsError=YES | TeacherNameUpdated=YES -->
    <title>Ù¦-Ù¡ Ø¶Ø±Ø¨ ÙˆØ­ÙŠØ¯Ø§Øª Ø§Ù„Ø­Ø¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        const themeColor = {
            gradient: 'from-blue-600 to-blue-800', 
            icon: 'fa-graduation-cap', 
            text: 'text-blue-600',
            bg: 'bg-blue-50',
            hex: '#2563eb',
            chapterNum: '6' 
        };
    </script>

    <style>
        body { font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #f9fafb; }
        .hidden { display: none !important; }
        .tab-content { padding-bottom: 20px; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Math Styling */
        .math-eq { font-family: 'Cairo', sans-serif; font-weight: 700; color: #4338ca; background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 2px 8px; border-radius: 4px; display: inline-block; direction: rtl; unicode-bidi: embed; vertical-align: middle; line-height: 1.8; }
        @media (min-width: 768px) { .math-eq { font-size: 1.1em; padding: 4px 12px; } }
        .num-red { color: #dc2626; } .var-green { color: #16a34a; } .var-blue { color: #2563eb; }
        .highlight-number { background-color: #fef9c3; color: #b45309; padding: 0 4px; border-radius: 3px; font-weight: bold; }
        .tiny-sup { font-size: 0.6em; vertical-align: baseline; position: relative; top: -0.8em; margin-right: 0; line-height: 0; }
        .fix-pos { display: inline-flex; flex-direction: row; align-items: baseline; gap: 0px; }
        .fraction { display: inline-flex; flex-direction: column; vertical-align: middle; text-align: center; margin: 0 4px; font-size: 0.85em; vertical-align: middle; }
        .fraction > span { padding: 0 2px; display: block; line-height: 1; }
        .fraction > .bar { border-top: 2px solid currentColor; height: 0; width: 100%; margin: 2px 0; }
        
        /* UI Components */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e5e7eb; padding: 8px 0; display: flex; justify-content: space-around; z-index: 50; box-shadow: 0 -4px 20px rgba(0,0,0,0.05); }
        /* Adjusted nav item for text labels */
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #9ca3af; font-size: 0.6rem; width: 100%; cursor: pointer; transition: all 0.3s; padding: 4px 2px; position: relative; }
        .nav-item span { margin-top: 2px; text-align: center; line-height: 1.1; max-width: 60px; }
        @media (min-width: 768px) { .nav-item { font-size: 0.8rem; } .nav-item svg, .nav-item i { font-size: 1.4rem; margin-bottom: 4px; } .nav-item span { max-width: none; } }
        .nav-item.active { color: var(--theme-hex); font-weight: 800; transform: translateY(-2px); }
        .nav-item.active::after { content: ''; position: absolute; bottom: 0px; width: 20px; height: 3px; background: var(--theme-hex); border-radius: 4px 4px 0 0; }
        
        /* Interactive & Quiz */
        .step-box { border-right: 3px solid var(--theme-hex); background: #f9fafb; padding: 10px; margin-bottom: 8px; border-radius: 6px; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.3s; } .step-interactive.active { display: block; opacity: 1; }
        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .option-label { display: flex; align-items: center; justify-content: center; padding: 12px 8px; border: 2px solid #e5e7eb; border-radius: 12px; cursor: pointer; transition: all 0.2s; height: 100%; min-height: 50px; background: white; }
        input[type="radio"]:checked + .option-label { border-color: var(--theme-hex); background-color: #eff6ff; color: var(--theme-hex); font-weight: bold; box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2); }
        .error-hint { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-4px); } 75% { transform: translateX(4px); } }

        /* Results & Cards */
        .result-card-base { position: relative; overflow: hidden; padding: 1.5rem !important; transition: all 0.3s ease; }
        .result-card-base::before { font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-10deg); font-size: 8rem; z-index: 0; pointer-events: none; }
        .result-card-trophy { background-color: #fffbeb; border-color: #fcd34d; } .result-card-trophy::before { content: '\f091'; color: rgba(250, 204, 21, 0.15); }
        .result-card-star { background-color: #fff7ed; border-color: #fdba74; } .result-card-star::before { content: '\f005'; color: rgba(251, 146, 60, 0.15); }
        .result-card-retry { background-color: #fef2f2; border-color: #fca5a5; } .result-card-retry::before { content: '\f01e'; color: rgba(248, 113, 113, 0.15); }
        .gold-card { background: linear-gradient(135deg, #fffbeb 0%, #fff 100%); border: 2px solid #fcd34d !important; }
        .orange-card { background: linear-gradient(135deg, #fff7ed 0%, #fff 100%); border: 2px solid #fdba74 !important; }
        .normal-card { background: white; border: 2px solid #e5e7eb; }
        
        /* Loading */
        .loader { border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #2563eb; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Debug Panel */
        #debug-panel { position: fixed; bottom: 80px; left: 10px; width: 300px; background: rgba(0,0,0,0.9); color: #00ff00; font-family: monospace; font-size: 10px; padding: 10px; border-radius: 8px; z-index: 9999; direction: ltr; max-height: 200px; overflow-y: auto; display: none; }
        
        /* Footer Credits */
        .lesson-footer { text-align: center; margin-top: 40px; margin-bottom: 80px; padding-top: 20px; border-top: 1px dashed #e5e7eb; color: #9ca3af; font-size: 0.75rem; }
        .lesson-footer strong { color: #6b7280; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Header -->
    <header id="main-header" class="w-full text-white shadow-lg px-4 py-3 sticky top-0 z-50 transition-colors overflow-hidden relative">
        <div class="absolute inset-0 pointer-events-none overflow-hidden">
            <i id="header-bg-icon" class="fas fa-graduation-cap absolute -left-6 -bottom-8 text-8xl md:text-9xl text-white opacity-10 transform -rotate-12"></i>
            <span id="chapter-num-bg" class="absolute top-[-10px] right-10 text-9xl font-black text-white opacity-5 font-sans leading-none select-none">6</span>
            <span class="absolute top-1/2 left-1/4 text-4xl font-bold text-white opacity-10 transform rotate-12 select-none">Ã—</span>
            <span class="absolute bottom-2 right-1/3 text-3xl font-bold text-white opacity-10 select-none">Ã·</span>
            <span class="absolute top-2 right-4 text-2xl font-bold text-white opacity-5 select-none">+</span>
        </div>
        
        <div class="container mx-auto max-w-4xl flex justify-between items-center relative z-10">
            <!-- Ø§Ù„ÙŠÙ…ÙŠÙ†: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø±Ø³ ÙˆØ§Ù„Ù…Ù†ØµØ© ÙˆØ§Ù„Ø¯Ø±Ø¬Ø© -->
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 md:w-14 md:h-14 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center border border-white/20 shadow-md">
                    <i id="header-icon" class="fas fa-graduation-cap text-lg md:text-2xl"></i>
                </div>
                <div class="flex flex-col">
                    <span class="text-[9px] md:text-xs font-bold opacity-80">Ù…Ù†ØµØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</span>
                    <h1 class="text-base md:text-xl font-black flex items-center gap-2">
                        <span class="bg-white/20 px-2 rounded text-sm md:text-base font-sans pt-1">Ù¦-Ù¡</span>
                        <span>Ø¶Ø±Ø¨ ÙˆØ­ÙŠØ¯Ø§Øª Ø§Ù„Ø­Ø¯</span>
                        
                        <!-- SCORE LOCATION -->
                        <span id="header-score-badge" class="hidden flex items-center gap-1 bg-yellow-400/20 text-yellow-100 px-2 py-0.5 rounded-full text-xs border border-yellow-400/30 animate-pulse">
                            <i class="fas fa-star text-[10px]"></i> 
                            <span id="student-score">0</span>
                        </span>
                        
                    </h1>
                </div>
            </div>

            <!-- Ø§Ù„ÙŠØ³Ø§Ø±: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„Ø±Ø¬ÙˆØ¹ -->
            <div class="flex flex-col items-end gap-1.5">
                <div class="bg-black/10 px-3 py-0.5 rounded-lg border border-white/10 flex items-center gap-2 text-[10px] md:text-sm font-bold">
                    <i class="fas fa-user"></i> <span id="student-name">Ø²Ø§Ø¦Ø±</span>
                </div>
                <a href="https://ablan-math.github.io/term2.html" class="bg-white text-blue-700 hover:bg-red-50 hover:text-red-600 px-3 py-1 rounded-lg font-bold text-xs md:text-sm shadow-sm transition flex items-center gap-1 cursor-pointer no-underline">
                    <i class="fas fa-arrow-right"></i> <span>Ø±Ø¬ÙˆØ¹</span>
                </a>
            </div>
        </div>
    </header>

    <main id="main-content" class="container mx-auto max-w-4xl p-4 md:p-8 mb-4 transition-all duration-300">
        
        <!-- LEARN 1 -->
        <div id="tab-learn1" class="tab-content">
            <div class="flex items-center gap-2 mb-4">
                <span class="bg-yellow-100 text-yellow-700 w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center font-bold text-lg md:text-xl border border-yellow-200 shadow-sm">Ù¡</span>
                <h2 class="font-bold text-xl md:text-2xl text-gray-800">Ù…ÙÙ‡ÙˆÙ… ÙˆØ­ÙŠØ¯Ø© Ø§Ù„Ø­Ø¯</h2>
            </div>
            <div class="bg-white rounded-xl p-5 md:p-8 shadow-sm mb-6 border border-gray-100 relative overflow-hidden group hover:shadow-md transition">
                <div class="absolute top-0 right-0 w-1 h-full bg-yellow-400"></div>
                <p class="text-gray-600 leading-relaxed text-sm md:text-lg mb-4">Ù‡ÙŠ Ø¹Ø¨Ø§Ø±Ø© Ø±ÙŠØ§Ø¶ÙŠØ© Ù‚Ø¯ ØªÙƒÙˆÙ† Ø¹Ø¯Ø¯Ø§Ù‹ (<span class="highlight-number">Ù¡Ù </span>)ØŒ Ø£Ùˆ Ù…ØªØºÙŠØ±Ø§Ù‹ (<span class="math-eq">Ù&zwnj;</span>)ØŒ Ø£Ùˆ Ø­Ø§ØµÙ„ Ø¶Ø±Ø¨Ù‡Ù…Ø§.</p>
                <div class="bg-red-50 text-red-700 text-xs md:text-sm p-3 rounded-lg border border-red-100 flex gap-2">
                    <i data-lucide="alert-triangle" class="w-4 h-4 flex-shrink-0 mt-0.5"></i>
                    <span><strong>Ø§Ù†ØªØ¨Ù‡:</strong> Ø§Ù„Ø¬Ù…Ø¹ (+) ÙˆØ§Ù„Ø·Ø±Ø­ (-) ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ù…Ù† Ø£Ù† ØªÙƒÙˆÙ† ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯.</span>
                </div>
            </div>

            <!-- App 1.1 -->
            <div id="interactive-container-1-1" class="bg-white rounded-xl p-4 md:p-6 shadow-sm border-2 border-blue-50 mb-4">
                <div class="flex items-center justify-between mb-2"><h3 class="font-bold text-blue-800 text-sm md:text-lg">ØªØ·Ø¨ÙŠÙ‚ Ù¡-Ù¡: Ù‡Ù„ <span class="math-eq">Ù&zwnj; + Ù¢Ù¤</span> ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯ØŸ</h3><span class="text-[10px] md:text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full font-bold">ØªÙØ§Ø¹Ù„ÙŠ</span></div>
                <div class="min-h-[110px] mb-4 bg-gray-50 rounded-lg p-2 md:p-4">
                    <div class="interactive-placeholder text-center text-gray-400 py-6 text-sm md:text-base">Ø§Ø¶ØºØ· "Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ù„Ø­Ù„</div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¡</h4><p class="text-sm md:text-lg">Ù†Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø¬Ù…Ø¹ Ø£Ùˆ Ø§Ù„Ø·Ø±Ø­. ÙˆØ¬Ø¯Ù†Ø§ <span class="highlight-number">+</span>.</p></div>
                    <div class="step-interactive step-box border-red-500 bg-red-50"><h4 class="font-bold text-xs md:text-sm text-red-600 mb-1">Ø§Ù„Ù†ØªÙŠØ¬Ø©</h4><p class="text-sm md:text-lg">Ù„ÙŠØ³Øª ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯ Ù„ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¬Ù…Ø¹.</p></div>
                </div>
                <div class="flex justify-between"><button class="prev-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-600"><i data-lucide="chevron-right" class="w-4 h-4"></i></button><button class="next-btn px-6 py-1.5 bg-blue-600 text-white rounded-lg font-bold shadow-md">Ø§Ù„ØªØ§Ù„ÙŠ</button><button class="reset-btn px-6 py-1.5 bg-purple-100 text-purple-700 rounded-lg font-bold hidden">Ø¥Ø¹Ø§Ø¯Ø©</button></div>
            </div>

            <!-- App 1.2 -->
            <div id="interactive-container-1-2" class="bg-white rounded-xl p-4 md:p-6 shadow-sm border-2 border-blue-50 mb-6">
                <div class="flex items-center justify-between mb-2"><h3 class="font-bold text-blue-800 text-sm md:text-lg">ØªØ·Ø¨ÙŠÙ‚ Ù¡-Ù¢: Ù‡Ù„ <span class="fraction font-bold"><span>Ù£</span><span class="bar"></span><span>Ù†&zwnj;</span></span> ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯ØŸ</h3><span class="text-[10px] md:text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full font-bold">ØªÙØ§Ø¹Ù„ÙŠ</span></div>
                <div class="min-h-[110px] mb-4 bg-gray-50 rounded-lg p-2 md:p-4">
                    <div class="interactive-placeholder text-center text-gray-400 py-6 text-sm md:text-base">Ø§Ø¶ØºØ· "Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ù„ØªØ­Ù„ÙŠÙ„</div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¡</h4><p class="text-sm md:text-lg">Ù†Ù„Ø§Ø­Ø¸ ÙˆØ¬ÙˆØ¯ Ù…ØªØºÙŠØ± <span class="highlight-number">(Ù†)</span> ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù….</p></div>
                    <div class="step-interactive step-box border-red-500 bg-red-50"><h4 class="font-bold text-xs md:text-sm text-red-600 mb-1">Ø§Ù„Ù†ØªÙŠØ¬Ø©</h4><p class="text-sm md:text-lg">Ù„ÙŠØ³Øª ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯ (Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ Ù…ØªØºÙŠØ± Ù…Ù…Ù†ÙˆØ¹Ø©).</p></div>
                </div>
                <div class="flex justify-between"><button class="prev-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-600"><i data-lucide="chevron-right" class="w-4 h-4"></i></button><button class="next-btn px-6 py-1.5 bg-blue-600 text-white rounded-lg font-bold shadow-md">Ø§Ù„ØªØ§Ù„ÙŠ</button><button class="reset-btn px-6 py-1.5 bg-purple-100 text-purple-700 rounded-lg font-bold hidden">Ø¥Ø¹Ø§Ø¯Ø©</button></div>
            </div>

            <button onclick="switchTab('learn2')" class="w-full bg-gray-800 text-white py-3 md:py-4 rounded-xl font-bold text-sm md:text-lg shadow-lg hover:bg-gray-900 transition flex items-center justify-center gap-2"><span>Ø§Ù„ØªØ§Ù„ÙŠ: Ø¶Ø±Ø¨ Ø§Ù„Ù‚ÙˆÙ‰</span><i data-lucide="arrow-left"></i></button>
        </div>

        <!-- LEARN 2 -->
        <div id="tab-learn2" class="tab-content hidden">
            <div class="flex items-center gap-2 mb-4">
                <span class="bg-blue-100 text-blue-700 w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center font-bold text-lg md:text-xl border border-blue-200 shadow-sm">Ù¢</span>
                <h2 class="font-bold text-xl md:text-2xl text-gray-800">Ø¶Ø±Ø¨ Ø§Ù„Ù‚ÙˆÙ‰</h2>
            </div>
            <div class="bg-white rounded-xl p-5 md:p-8 shadow-sm mb-6 border border-gray-100 relative overflow-hidden group hover:shadow-md transition">
                <div class="absolute top-0 right-0 w-1 h-full bg-blue-500"></div>
                <p class="text-gray-600 text-sm md:text-lg mb-3">Ù„Ø¶Ø±Ø¨ Ù‚ÙˆØªÙŠÙ† Ù„Ù‡Ù…Ø§ Ù†ÙØ³ Ø§Ù„Ø£Ø³Ø§Ø³ØŒ Ù†Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø³Ø³.</p>
                <div class="text-center py-3 bg-blue-50 rounded-lg text-blue-900 mb-2 border border-blue-100 shadow-inner"><span class="math-eq text-xl">Ø£&zwnj;<sup class="tiny-sup">Ù…</sup> Â· Ø£&zwnj;<sup class="tiny-sup">Ù†</sup> = Ø£&zwnj;<sup class="tiny-sup">Ù…+Ù†</sup></span></div>
            </div>

            <!-- App 2.1 -->
            <div id="interactive-container-2-1" class="bg-white rounded-xl p-4 md:p-6 shadow-sm border-2 border-blue-50 mb-4">
                <div class="flex items-center justify-between mb-2"><h3 class="font-bold text-blue-800 text-sm md:text-lg">ØªØ·Ø¨ÙŠÙ‚ Ù¢-Ù¡: Ø¨Ø³Ù‘Ø· <span class="math-eq">(Ù¢Ø³&zwnj;<sup>Ù¢</sup>)(Ù£Ø³&zwnj;)</span></h3><span class="text-[10px] md:text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full font-bold">ØªÙØ§Ø¹Ù„ÙŠ</span></div>
                <div class="min-h-[110px] mb-4 bg-gray-50 rounded-lg p-2 md:p-4">
                    <div class="interactive-placeholder text-center text-gray-400 py-6 text-sm md:text-base">Ø§Ø¶ØºØ· "Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ù„Ø­Ù„</div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¡</h4><p class="text-sm md:text-lg"><span class="highlight-number">Ù¢</span> Ã— <span class="highlight-number">Ù£</span> = <span class="highlight-number">Ù¦</span></p></div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¢</h4><p class="text-sm md:text-lg">Ø³<sup>Ù¢</sup> Â· Ø³<sup>Ù¡</sup> &larr; Ù†Ø¬Ù…Ø¹: Ù¢+Ù¡ = Ù£</p></div>
                    <div class="step-interactive step-box border-green-500 bg-green-50"><h4 class="font-bold text-xs md:text-sm text-green-600 mb-1">Ø§Ù„Ù†Ø§ØªØ¬</h4><p class="text-sm md:text-lg font-bold"><span class="math-eq">Ù¦Ø³&zwnj;<sup>Ù£</sup></span></p></div>
                </div>
                <div class="flex justify-between"><button class="prev-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-600"><i data-lucide="chevron-right" class="w-4 h-4"></i></button><button class="next-btn px-6 py-1.5 bg-blue-600 text-white rounded-lg font-bold shadow-md">Ø§Ù„ØªØ§Ù„ÙŠ</button><button class="reset-btn px-6 py-1.5 bg-purple-100 text-purple-700 rounded-lg font-bold hidden">Ø¥Ø¹Ø§Ø¯Ø©</button></div>
            </div>

            <!-- App 2.2 -->
            <div id="interactive-container-2-2" class="bg-white rounded-xl p-4 md:p-6 shadow-sm border-2 border-blue-50 mb-6">
                <div class="flex items-center justify-between mb-2"><h3 class="font-bold text-blue-800 text-sm md:text-lg">ØªØ·Ø¨ÙŠÙ‚ Ù¢-Ù¢: Ø¨Ø³Ù‘Ø· <span class="math-eq">(Ù¤Ø£)(Ù¢Ø£&zwnj;<sup>Ù£</sup>)</span></h3><span class="text-[10px] md:text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full font-bold">ØªÙØ§Ø¹Ù„ÙŠ</span></div>
                <div class="min-h-[110px] mb-4 bg-gray-50 rounded-lg p-2 md:p-4">
                    <div class="interactive-placeholder text-center text-gray-400 py-6 text-sm md:text-base">Ø§Ø¶ØºØ· "Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ù„Ø­Ù„</div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¡</h4><p class="text-sm md:text-lg"><span class="highlight-number">Ù¤</span> Ã— <span class="highlight-number">Ù¢</span> = <span class="highlight-number">Ù¨</span></p></div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¢</h4><p class="text-sm md:text-lg">Ø£<sup>Ù¡</sup> Â· Ø£<sup>Ù£</sup> &larr; Ù†Ø¬Ù…Ø¹: Ù¡+Ù£ = Ù¤</p></div>
                    <div class="step-interactive step-box border-green-500 bg-green-50"><h4 class="font-bold text-xs md:text-sm text-green-600 mb-1">Ø§Ù„Ù†Ø§ØªØ¬</h4><p class="text-sm md:text-lg font-bold"><span class="math-eq">Ù¨Ø£&zwnj;<sup>Ù¤</sup></span></p></div>
                </div>
                <div class="flex justify-between"><button class="prev-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-600"><i data-lucide="chevron-right" class="w-4 h-4"></i></button><button class="next-btn px-6 py-1.5 bg-blue-600 text-white rounded-lg font-bold shadow-md">Ø§Ù„ØªØ§Ù„ÙŠ</button><button class="reset-btn px-6 py-1.5 bg-purple-100 text-purple-700 rounded-lg font-bold hidden">Ø¥Ø¹Ø§Ø¯Ø©</button></div>
            </div>

            <button onclick="switchTab('learn3')" class="w-full bg-gray-800 text-white py-3 md:py-4 rounded-xl font-bold text-sm md:text-lg shadow-lg hover:bg-gray-900 transition flex items-center justify-center gap-2"><span>Ø§Ù„ØªØ§Ù„ÙŠ: Ù‚ÙˆØ© Ø§Ù„Ù‚ÙˆØ©</span><i data-lucide="arrow-left"></i></button>
        </div>

        <!-- LEARN 3 -->
        <div id="tab-learn3" class="tab-content hidden">
            <div class="flex items-center gap-2 mb-4">
                <span class="bg-purple-100 text-purple-700 w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center font-bold text-lg md:text-xl border border-purple-200 shadow-sm">Ù£</span>
                <h2 class="font-bold text-xl md:text-2xl text-gray-800">Ù‚ÙˆØ© Ø§Ù„Ù‚ÙˆØ©</h2>
            </div>
            <div class="bg-white rounded-xl p-5 md:p-8 shadow-sm mb-6 border border-gray-100 relative overflow-hidden group hover:shadow-md transition">
                <div class="absolute top-0 right-0 w-1 h-full bg-purple-500"></div>
                <p class="text-gray-600 text-sm md:text-lg mb-3">Ù„Ø¥ÙŠØ¬Ø§Ø¯ Ù‚ÙˆØ© Ø§Ù„Ù‚ÙˆØ©ØŒ <strong>Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø£Ø³Ø³</strong>.</p>
                <div class="text-center py-3 bg-purple-50 rounded-lg text-purple-900 mb-2 border border-purple-100 shadow-inner"><span class="math-eq text-xl">(Ø£&zwnj;<sup class="tiny-sup">Ù…</sup>)<sup class="tiny-sup">Ù†</sup> = Ø£&zwnj;<sup class="tiny-sup">Ù…Â·Ù†</sup></span></div>
            </div>

            <!-- App 3.1 -->
            <div id="interactive-container-3-1" class="bg-white rounded-xl p-4 md:p-6 shadow-sm border-2 border-blue-50 mb-4">
                <div class="flex items-center justify-between mb-2"><h3 class="font-bold text-blue-800 text-sm md:text-lg">ØªØ·Ø¨ÙŠÙ‚ Ù£-Ù¡: Ø¨Ø³Ù‘Ø· <span class="math-eq">(Ù†&zwnj;<sup>Ù¤</sup>)<sup>Ù§</sup></span></h3><span class="text-[10px] md:text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full font-bold">ØªÙØ§Ø¹Ù„ÙŠ</span></div>
                <div class="min-h-[110px] mb-4 bg-gray-50 rounded-lg p-2 md:p-4">
                    <div class="interactive-placeholder text-center text-gray-400 py-6 text-sm md:text-base">Ø§Ø¶ØºØ· "Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ù„Ø­Ù„</div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¡</h4><p class="text-sm md:text-lg">Ø§Ù„Ø£Ø³ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ (Ù¤) ÙˆØ§Ù„Ø£Ø³ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (Ù§).</p></div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¢</h4><p class="text-sm md:text-lg">Ù†Ø¶Ø±Ø¨: Ù¤ Ã— Ù§ = Ù¢Ù¨</p></div>
                    <div class="step-interactive step-box border-green-500 bg-green-50"><h4 class="font-bold text-xs md:text-sm text-green-600 mb-1">Ø§Ù„Ù†Ø§ØªØ¬</h4><p class="text-sm md:text-lg font-bold"><span class="math-eq">Ù†&zwnj;<sup>Ù¢Ù¨</sup></span></p></div>
                </div>
                <div class="flex justify-between"><button class="prev-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-600"><i data-lucide="chevron-right" class="w-4 h-4"></i></button><button class="next-btn px-6 py-1.5 bg-blue-600 text-white rounded-lg font-bold shadow-md">Ø§Ù„ØªØ§Ù„ÙŠ</button><button class="reset-btn px-6 py-1.5 bg-purple-100 text-purple-700 rounded-lg font-bold hidden">Ø¥Ø¹Ø§Ø¯Ø©</button></div>
            </div>

            <!-- App 3.2 -->
            <div id="interactive-container-3-2" class="bg-white rounded-xl p-4 md:p-6 shadow-sm border-2 border-blue-50 mb-6">
                <div class="flex items-center justify-between mb-2"><h3 class="font-bold text-blue-800 text-sm md:text-lg">ØªØ·Ø¨ÙŠÙ‚ Ù£-Ù¢: Ø¨Ø³Ù‘Ø· <span class="math-eq">[(Ù£)<sup>Ù¢</sup>]<sup>Ù£</sup></span></h3><span class="text-[10px] md:text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full font-bold">ØªÙØ§Ø¹Ù„ÙŠ</span></div>
                <div class="min-h-[110px] mb-4 bg-gray-50 rounded-lg p-2 md:p-4">
                    <div class="interactive-placeholder text-center text-gray-400 py-6 text-sm md:text-base">Ø§Ø¶ØºØ· "Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ù„Ø­Ù„</div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¡</h4><p class="text-sm md:text-lg">Ø§Ù„Ø£Ø³Ø³: Ù¢ Ùˆ Ù£.</p></div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¢</h4><p class="text-sm md:text-lg">Ù†Ø¶Ø±Ø¨: Ù¢ Ã— Ù£ = Ù¦</p></div>
                    <div class="step-interactive step-box border-green-500 bg-green-50"><h4 class="font-bold text-xs md:text-sm text-green-600 mb-1">Ø§Ù„Ù†Ø§ØªØ¬</h4><p class="text-sm md:text-lg font-bold"><span class="math-eq">Ù£<sup>Ù¦</sup></span></p></div>
                </div>
                <div class="flex justify-between"><button class="prev-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-600"><i data-lucide="chevron-right" class="w-4 h-4"></i></button><button class="next-btn px-6 py-1.5 bg-blue-600 text-white rounded-lg font-bold shadow-md">Ø§Ù„ØªØ§Ù„ÙŠ</button><button class="reset-btn px-6 py-1.5 bg-purple-100 text-purple-700 rounded-lg font-bold hidden">Ø¥Ø¹Ø§Ø¯Ø©</button></div>
            </div>

            <button onclick="switchTab('learn4')" class="w-full bg-gray-800 text-white py-3 md:py-4 rounded-xl font-bold text-sm md:text-lg shadow-lg hover:bg-gray-900 transition flex items-center justify-center gap-2"><span>Ø§Ù„ØªØ§Ù„ÙŠ: Ù‚ÙˆØ© Ø­Ø§ØµÙ„ Ø§Ù„Ø¶Ø±Ø¨</span><i data-lucide="arrow-left"></i></button>
        </div>

        <!-- LEARN 4 -->
        <div id="tab-learn4" class="tab-content hidden">
            <div class="flex items-center gap-2 mb-4">
                <span class="bg-red-100 text-red-700 w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center font-bold text-lg md:text-xl border border-red-200 shadow-sm">Ù¤</span>
                <h2 class="font-bold text-xl md:text-2xl text-gray-800">Ù‚ÙˆØ© Ø­Ø§ØµÙ„ Ø§Ù„Ø¶Ø±Ø¨</h2>
            </div>
            <div class="bg-white rounded-xl p-5 md:p-8 shadow-sm mb-6 border border-gray-100 relative overflow-hidden group hover:shadow-md transition">
                <div class="absolute top-0 right-0 w-1 h-full bg-red-500"></div>
                <p class="text-gray-600 text-sm md:text-lg mb-3">Ù„Ø¥ÙŠØ¬Ø§Ø¯ Ù‚ÙˆØ© Ø­Ø§ØµÙ„ Ø§Ù„Ø¶Ø±Ø¨ØŒ Ø£ÙˆØ¬Ø¯ <strong>Ù‚ÙˆØ© ÙƒÙ„ Ø¹Ø§Ù…Ù„</strong> Ø«Ù… Ø§Ø¶Ø±Ø¨.</p>
                <div class="text-center py-3 bg-red-50 rounded-lg text-red-900 mb-2 border border-red-100 shadow-inner"><span class="math-eq text-xl">(Ø£Ø¨)<sup class="tiny-sup">Ù†</sup> = Ø£&zwnj;<sup class="tiny-sup">Ù†</sup> Ø¨&zwnj;<sup class="tiny-sup">Ù†</sup></span></div>
            </div>

            <!-- App 4.1 -->
            <div id="interactive-container-4-1" class="bg-white rounded-xl p-4 md:p-6 shadow-sm border-2 border-blue-50 mb-4">
                <div class="flex items-center justify-between mb-2"><h3 class="font-bold text-blue-800 text-sm md:text-lg">ØªØ·Ø¨ÙŠÙ‚ Ù¤-Ù¡: Ø¨Ø³Ù‘Ø· <span class="math-eq">(Ù£Ø³&zwnj;<sup>Ù¢</sup> Øµ&zwnj;)<sup>Ù¢</sup></span></h3><span class="text-[10px] md:text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full font-bold">ØªÙØ§Ø¹Ù„ÙŠ</span></div>
                <div class="min-h-[110px] mb-4 bg-gray-50 rounded-lg p-2 md:p-4">
                    <div class="interactive-placeholder text-center text-gray-400 py-6 text-sm md:text-base">Ø§Ø¶ØºØ· "Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ù„Ø­Ù„</div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¡</h4><p class="text-sm md:text-lg">ÙˆØ²Ø¹ Ø§Ù„Ø£Ø³ Ù¢ Ø¹Ù„Ù‰ (Ù£) Ùˆ(Ø³Â²) Ùˆ(Øµ).</p></div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¢</h4><p class="text-sm md:text-lg">Ù©Ø³<sup>Ù¤</sup>Øµ<sup>Ù¢</sup></p></div>
                    <div class="step-interactive step-box border-green-500 bg-green-50"><h4 class="font-bold text-xs md:text-sm text-green-600 mb-1">Ø§Ù„Ù†Ø§ØªØ¬</h4><p class="text-sm md:text-lg font-bold"><span class="math-eq">Ù©Ø³<sup>Ù¤</sup>Øµ<sup>Ù¢</sup></span></p></div>
                </div>
                <div class="flex justify-between"><button class="prev-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-600"><i data-lucide="chevron-right" class="w-4 h-4"></i></button><button class="next-btn px-6 py-1.5 bg-blue-600 text-white rounded-lg font-bold shadow-md">Ø§Ù„ØªØ§Ù„ÙŠ</button><button class="reset-btn px-6 py-1.5 bg-purple-100 text-purple-700 rounded-lg font-bold hidden">Ø¥Ø¹Ø§Ø¯Ø©</button></div>
            </div>

            <!-- App 4.2 -->
            <div id="interactive-container-4-2" class="bg-white rounded-xl p-4 md:p-6 shadow-sm border-2 border-blue-50 mb-4">
                <div class="flex items-center justify-between mb-2"><h3 class="font-bold text-blue-800 text-sm md:text-lg">ØªØ·Ø¨ÙŠÙ‚ Ù¤-Ù¢ (ØªØ­Ø¯ÙŠ): <span class="math-eq">(Ù¢Ø³&zwnj;<sup>Ù¢</sup>)<sup>Ù£</sup> Â· Ø³&zwnj;</span></h3><span class="text-[10px] md:text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full font-bold">ØªØ­Ø¯ÙŠ</span></div>
                <div class="min-h-[110px] mb-4 bg-gray-50 rounded-lg p-2 md:p-4">
                    <div class="interactive-placeholder text-center text-gray-400 py-6 text-sm md:text-base">Ø§Ø¶ØºØ· "Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ù„Ø­Ù„</div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¡</h4><p class="text-sm md:text-lg">ÙÙƒ Ø§Ù„Ù‚ÙˆØ© Ø£ÙˆÙ„Ø§Ù‹: Ù¢Â³ = Ù¨ØŒ Ùˆ (Ø³Â²)Â³ = Ø³â¶.</p></div>
                    <div class="step-interactive step-box"><h4 class="font-bold text-xs md:text-sm text-blue-600 mb-1">Ø®Ø·ÙˆØ© Ù¢</h4><p class="text-sm md:text-lg">Ø§Ø¶Ø±Ø¨ ÙÙŠ Ø³: Ù¨Ø³â¶ Â· Ø³Â¹</p></div>
                    <div class="step-interactive step-box border-green-500 bg-green-50"><h4 class="font-bold text-xs md:text-sm text-green-600 mb-1">Ø§Ù„Ù†Ø§ØªØ¬</h4><p class="text-sm md:text-lg font-bold"><span class="math-eq">Ù¨Ø³<sup>Ù§</sup></span></p></div>
                </div>
                <div class="flex justify-between"><button class="prev-btn w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-600"><i data-lucide="chevron-right" class="w-4 h-4"></i></button><button class="next-btn px-6 py-1.5 bg-blue-600 text-white rounded-lg font-bold shadow-md">Ø§Ù„ØªØ§Ù„ÙŠ</button><button class="reset-btn px-6 py-1.5 bg-purple-100 text-purple-700 rounded-lg font-bold hidden">Ø¥Ø¹Ø§Ø¯Ø©</button></div>
            </div>

            <div class="mt-4 text-center"><button onclick="switchTab('quiz')" class="bg-green-600 text-white px-8 py-3 md:py-4 rounded-full text-sm md:text-lg font-bold shadow-lg hover:bg-green-700 transition flex items-center justify-center gap-2 mx-auto w-full max-w-xs animate-bounce"><span>Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ</span><i data-lucide="arrow-left"></i></button></div>
        </div>

        <!-- QUIZ TAB -->
        <div id="tab-quiz" class="tab-content hidden">
             <div class="bg-white rounded-xl shadow-sm p-4 md:p-8 border border-gray-200">
                <div class="flex justify-between items-center mb-6 border-b border-gray-100 pb-4">
                    <div>
                        <h2 class="font-bold text-lg md:text-2xl text-gray-800">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙÙ‡Ù…</h2>
                        <p class="text-xs md:text-sm text-gray-500">5 Ø£Ø³Ø¦Ù„Ø© Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø¯Ù‚Ø©</p>
                    </div>
                    <div class="text-center">
                         <div id="loading-attempts" class="hidden"><div class="loader w-4 h-4"></div></div>
                         <div id="attempts-display" class="flex flex-col items-center">
                            <span class="block text-xl md:text-2xl font-bold text-purple-600" id="attempts-count">-</span>
                            <div class="flex items-center gap-1 text-[10px] md:text-xs text-gray-400">
                                <span>Ù…Ø­Ø§ÙˆÙ„Ø§Øª</span>
                            </div>
                            <span id="sync-status" class="w-2 h-2 rounded-full bg-gray-300 mt-1" title="Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„"></span>
                        </div>
                         <div id="timer-top-container" class="hidden mt-1">
                            <span class="block text-xs font-bold text-red-500 font-mono" id="timer-display-top">00:00:00</span>
                        </div>
                    </div>
                </div>
                <form id="quizForm" class="space-y-6"></form>
                
                <!-- Results Section -->
                <div id="quiz-results" class="hidden mt-6 text-center bg-gray-50 rounded-xl border border-gray-200 result-card-base max-w-sm mx-auto">
                    <div class="result-content">
                        <p class="text-sm text-gray-600 font-bold mb-1">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</p>
                        <p id="quiz-score" class="text-5xl font-black my-2 tracking-widest drop-shadow-sm">-</p>
                        <div id="save-status" class="mt-3 text-center text-sm font-bold animate-pulse"></div>
                        <div class="mt-4">
                            <!-- Retake Button merged into main flow - this container acts as backup or layout spacer -->
                            <div id="timer-bottom-container" class="hidden bg-red-50 border border-red-100 rounded-lg p-2 inline-block">
                                <span class="block text-lg font-bold text-red-600 font-mono tracking-wider" id="timer-display-bottom">00:00:00</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="games-wrapper" class="hidden mt-8 pt-6 border-t border-gray-200">
                    <div id="dynamic-games-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"></div>
                </div>
            </div>
        </div>
        
        <!-- Footer Credits -->
        <footer class="lesson-footer">
            <p>ØªØµÙ…ÙŠÙ… ÙˆØ¥Ø¹Ø¯Ø§Ø¯: <strong>Ø£. Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ø¨Ù„Ø§Ù†</strong></p>
            <p class="mt-1 opacity-70">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2025</p>
        </footer>
        
        <!-- Spacer for fixed bottom nav -->
        <div class="h-20"></div>
    </main>

    <!-- Bottom Nav -->
    <nav class="bottom-nav" id="bottom-nav-container"></nav>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-end sm:items-center justify-center backdrop-blur-sm">
        <div class="bg-white w-full sm:w-96 rounded-t-2xl sm:rounded-xl p-6 transform transition-transform duration-300 shadow-2xl">
            <div class="flex justify-between mb-4 items-center">
                <div class="flex items-center gap-2" style="color: var(--theme-hex)">
                    <i id="modal-icon" data-lucide="info" class="w-5 h-5"></i>
                    <h3 id="modal-title" class="font-bold text-lg">ØªÙˆØ¶ÙŠØ­</h3>
                </div>
                <button onclick="closeModal()" class="bg-gray-100 p-1 rounded-full text-gray-500 hover:bg-gray-200"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div id="modal-content" class="text-sm text-gray-600 leading-relaxed max-h-[60vh] overflow-y-auto pl-1"></div>
        </div>
    </div>

    <!-- Debug Panel -->
    <div id="debug-panel" class="hidden">
        <div class="flex justify-between items-center mb-2 border-b border-green-700 pb-1">
            <span class="font-bold text-white">ğŸ› ï¸ ØªØ´Ø®ÙŠØµ Ø§Ù„Ø§ØªØµØ§Ù„</span>
            <button onclick="document.getElementById('debug-panel').style.display='none'" class="text-red-400 hover:text-red-200 font-bold">x</button>
        </div>
        <div id="debug-content" class="space-y-1">Waiting...</div>
        <button onclick="hardReset()" class="mt-2 w-full bg-red-700 text-white text-xs py-1 rounded hover:bg-red-600">ØªØµÙÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„</button>
    </div>
    
    <!-- Debug Toggle Button -->
    <button onclick="document.getElementById('debug-panel').style.display='block'" class="fixed bottom-2 left-2 text-[10px] text-gray-300 hover:text-gray-500 opacity-50 z-50">ğŸ› ï¸ ØªØ´Ø®ÙŠØµ</button>

    <script>
        // ğŸš« CRITICAL DATA PROTOCOL - DO NOT MODIFY
        // ============================================
        // 1. Connection Method: MUST be GET (via URL query strings).
        // 2. Actions: 'getStudentData' (Read) | 'saveScore' (Write).
        // 3. Parameters: studentId, classId, itemId, score, type.
        // 4. Persistence: Data is stored in Google Sheets.
        // 5. User Roles: 'visitor' (Local only), 'Student' (Server sync).
        // ============================================
        
        lucide.createIcons();
        const urlParams = new URLSearchParams(window.location.search);
        
        // --- Init Logic ---
        document.getElementById('main-header').className += ` bg-gradient-to-r ${themeColor.gradient}`;
        const iconClasses = `fas ${themeColor.icon}`;
        document.getElementById('header-icon').className = `${iconClasses} text-lg md:text-2xl`;
        document.getElementById('header-bg-icon').className = `${iconClasses} absolute -left-6 -bottom-8 text-8xl md:text-9xl text-white opacity-10 transform -rotate-12`;
        document.getElementById('chapter-num-bg').textContent = themeColor.chapterNum;
        document.documentElement.style.setProperty('--theme-hex', themeColor.hex);
        
        document.getElementById('student-name').textContent = urlParams.get('name') || 'Ø²Ø§Ø¦Ø±';
        document.getElementById('student-score').textContent = urlParams.get('totalScore') || '0';
        
        // Backend Config - DO NOT CHANGE WITHOUT BACKEND UPDATE
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxqAQlGhNs8k5RwHs6jrWxDiDwaMABSx8a9Fl81O5oVVa5fHRWTwIEvsGy2cSDP4zGLWQ/exec"; 
        const LESSON_KEY = 'c6_l1'; 

        // --- Games Logic ---
        function renderDynamicGames() {
            const sId = urlParams.get('studentId') || 'visitor';
            document.getElementById('games-wrapper').classList.remove('hidden'); 
            const container = document.getElementById('dynamic-games-container');
            container.innerHTML = '';
            
            const games = [
                { id: 'g6_1_1', title: 'Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©', maxDefault: 5 },
                { id: 'g6_1_2', title: 'Ø­Ø±Ø¨ Ø§Ù„ÙØ¶Ø§Ø¡', maxDefault: 5 }
            ];
            
            let hasGames = false;
            games.forEach((game, idx) => {
                const i = idx + 1;
                // Try URL params first, else default
                const title = urlParams.get(`g${i}_title`) || game.title;
                const id = urlParams.get(`g${i}_id`) || game.id;
                const score = parseInt(urlParams.get(`g${i}_score`)) || 0;
                const max = parseInt(urlParams.get(`g${i}_max`)) || game.maxDefault;

                if (title && id) {
                    hasGames = true;
                    let cardClass = "normal-card";
                    let iconHtml = `<div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-lg shadow-sm" style="background-color: var(--theme-hex)"><i class="fas fa-gamepad"></i></div>`;
                    let statusText = "ØªØ·Ø¨ÙŠÙ‚ ØªÙØ§Ø¹Ù„ÙŠ";
                    
                    if (score >= max && max > 0) {
                         cardClass = "gold-card";
                         iconHtml = `<div class="w-10 h-10 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center text-lg shadow-sm"><i class="fas fa-trophy"></i></div>`;
                         statusText = "Ø£Ø­Ø³Ù†Øª! (Ø¯Ø±Ø¬Ø© ÙƒØ§Ù…Ù„Ø©)";
                    } else if (score > 0) {
                         cardClass = "orange-card";
                         iconHtml = `<div class="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center text-lg shadow-sm"><i class="fas fa-star"></i></div>`;
                         statusText = `Ù†ØªÙŠØ¬ØªÙƒ: ${score}/${max}`;
                    }

                    const gameHtml = `
                    <a href="https://ablan-math.github.io/games/${id}.html?studentId=${sId}&classId=${urlParams.get('classId')}" target="_blank" class="block group relative overflow-hidden rounded-xl p-4 hover:shadow-md transition-all duration-300 ${cardClass} no-underline">
                        <div class="flex items-center gap-3">
                            ${iconHtml}
                            <div>
                                <h3 class="font-bold text-gray-800 text-sm">${title}</h3>
                                <p class="text-[10px] text-gray-500 font-bold">${statusText}</p>
                            </div>
                        </div>
                    </a>`;
                    container.insertAdjacentHTML('beforeend', gameHtml);
                }
            });
             if(hasGames && !document.getElementById('games-title')) {
                 container.insertAdjacentHTML('beforebegin', `<h2 id="games-title" class="col-span-1 md:col-span-2 text-center font-black text-gray-700 mb-2 flex justify-center gap-2 items-center w-full"><i class="fas fa-gamepad text-yellow-500"></i> Ø§Ø³ØªÙ…ØªØ¹ ÙˆØªØ¹Ù„Ù…</h2>`);
            }
        }
        
        // --- Tabs Logic ---
        const tabs = [
            { id: 'learn1', icon: 'book-open', label: 'Ø§Ù„Ù…ÙÙ‡ÙˆÙ…' },
            { id: 'learn2', icon: 'pencil', label: 'Ø¶Ø±Ø¨ Ø§Ù„Ù‚ÙˆÙ‰' },
            { id: 'learn3', icon: 'layers', label: 'Ù‚ÙˆØ© Ø§Ù„Ù‚ÙˆØ©' },
            { id: 'learn4', icon: 'box', label: 'Ù‚ÙˆØ© Ø§Ù„Ø¶Ø±Ø¨' },
            { id: 'quiz', icon: 'clipboard-check', label: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±' }
        ];

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const tabEl = document.getElementById(`tab-${tabId}`);
            const navEl = document.getElementById(`nav-${tabId}`);
            if (tabEl) tabEl.classList.remove('hidden');
            if (navEl) navEl.classList.add('active');
            window.scrollTo(0,0);
            if(tabId === 'quiz') {
                if(document.getElementById('quizForm').innerHTML === '') { generateQuiz(); }
                renderDynamicGames(); 
                // Only fetch for students, not visitors to prevent server confusion
                const sId = urlParams.get('studentId');
                if(sId && sId !== 'visitor') fetchStudentData();
            }
        }

        // --- Interactive Logic ---
        function initInteractive() {
            document.querySelectorAll('[id^="interactive-container-"]').forEach(container => {
                const steps = container.querySelectorAll('.step-interactive');
                const placeholder = container.querySelector('.interactive-placeholder');
                const nextBtn = container.querySelector('.next-btn');
                const prevBtn = container.querySelector('.prev-btn');
                const resetBtn = container.querySelector('.reset-btn');
                let current = -1;
                const update = () => {
                    prevBtn.disabled = current === -1;
                    if (current === -1) placeholder.classList.remove('hidden'); else placeholder.classList.add('hidden');
                    steps.forEach((s, i) => { if (i <= current) s.classList.add('active'); else s.classList.remove('active'); });
                    if (current >= steps.length - 1) { nextBtn.classList.add('hidden'); resetBtn.classList.remove('hidden'); } 
                    else { nextBtn.classList.remove('hidden'); resetBtn.classList.add('hidden'); }
                };
                nextBtn.onclick = () => { if(current < steps.length - 1) { current++; update(); } };
                prevBtn.onclick = () => { if(current > -1) { current--; update(); } };
                resetBtn.onclick = () => { current = -1; update(); };
                update();
            });
        }
        
        // --- 15 Question Bank ---
        const questionBank = [
             { id: 101, type: 'learn1', t: 'Ø£ÙŠ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© ØªÙ…Ø«Ù„ ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯ØŸ', o: [{t:'<span class="math-eq">Ù¥Ø³&zwnj;</span>', v:'a'}, {t:'<span class="math-eq">Ù¥+Ø³&zwnj;</span>', v:'b'}, {t:'<span class="fraction"><span>Ù¥</span><span class="bar"></span><span>Ø³&zwnj;</span></span>', v:'c'}, {t:'<span class="math-eq">Ø³&zwnj;-Ù¥</span>', v:'d'}], c:'a', e:'Ù„Ø§Ù†Ù‡Ø§ Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† Ø­Ø§ØµÙ„ Ø¶Ø±Ø¨ Ø¹Ø¯Ø¯ ÙÙŠ Ù…ØªØºÙŠØ±ØŒ ÙˆÙ„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬Ù…Ø¹ Ø£Ùˆ Ø·Ø±Ø­.', smart:'Ø§Ø¨Ø­Ø« Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¹Ù† Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¶Ø±Ø¨ ÙÙ‚Ø·.' },
             { id: 102, type: 'learn1', t: 'Ø£ÙŠ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© <strong>Ù„ÙŠØ³Øª</strong> ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯ØŸ', o: [{t:'<span class="math-eq">Ù¡Ù¢</span>', v:'a'}, {t:'<span class="math-eq">Ø³&zwnj; + Ù¢</span>', v:'b'}, {t:'<span class="math-eq">Ù£Ø³</span>', v:'c'}, {t:'<span class="math-eq">Øµ</span>', v:'d'}], c:'b', e:'ÙˆØ¬ÙˆØ¯ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø¬Ù…Ø¹ (+) ÙŠØ®Ø±Ø¬Ù‡Ø§ Ù…Ù† ØªØ¹Ø±ÙŠÙ ÙˆØ­ÙŠØ¯Ø© Ø§Ù„Ø­Ø¯.', smart:'Ø¥Ø°Ø§ Ø±Ø£ÙŠØª + Ø£Ùˆ - ÙÙ‡ÙŠ Ù„ÙŠØ³Øª ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯.' },
             { id: 103, type: 'learn1', t: 'Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© <span class="fraction"><span>Ù£</span><span class="bar"></span><span>Ù¤</span></span> ØªÙØ¹ØªØ¨Ø±:', o: [{t:'ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯ (Ø«Ø§Ø¨Øª)', v:'a'}, {t:'Ù„ÙŠØ³Øª ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯', v:'b'}, {t:'Ù…ØªØºÙŠØ±', v:'c'}, {t:'Ø«Ù†Ø§Ø¦ÙŠØ© Ø­Ø¯', v:'d'}], c:'a', e:'Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø§Ù„Ø«Ø§Ø¨Øª Ù‡Ùˆ Ù†ÙˆØ¹ Ù…Ù† Ø£Ù†ÙˆØ§Ø¹ ÙˆØ­ÙŠØ¯Ø§Øª Ø§Ù„Ø­Ø¯.', smart:'Ø£ÙŠ Ø±Ù‚Ù… Ø¨Ø¯ÙˆÙ† Ù…ØªØºÙŠØ± Ù‡Ùˆ ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯.' },
             { id: 104, type: 'learn1', t: 'Ù„Ù…Ø§Ø°Ø§ <span class="fraction"><span>Ù¥</span><span class="bar"></span><span>Ù†</span></span> Ù„ÙŠØ³Øª ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯ØŸ', o: [{t:'Ù„Ø£Ù† Ø§Ù„Ù…ØªØºÙŠØ± ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù…', v:'a'}, {t:'Ù„Ø£Ù†Ù‡Ø§ ÙƒØ³Ø±', v:'b'}, {t:'Ù„ÙˆØ¬ÙˆØ¯ Ø¹Ø¯Ø¯ Ù¥', v:'c'}, {t:'Ù‡ÙŠ ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯', v:'d'}], c:'a', e:'Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ Ù…ØªØºÙŠØ± ØªÙ…Ù†Ø¹ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ù…Ù† Ø£Ù† ØªÙƒÙˆÙ† ÙˆØ­ÙŠØ¯Ø© Ø­Ø¯.', smart:'Ù…ØªØºÙŠØ± ØªØ­Øª Ø§Ù„Ø®Ø· = Ø®Ø·Ø£.' },
             { id: 201, type: 'learn2', t: 'Ù†Ø§ØªØ¬ <span class="math-eq">Ø³&zwnj;<sup>Ù¤</sup> Â· Ø³&zwnj;<sup>Ù£</sup></span>', o: [{t:'<span class="math-eq">Ø³&zwnj;<sup>Ù§</sup></span>', v:'a'}, {t:'<span class="math-eq">Ø³&zwnj;<sup>Ù¡Ù¢</sup></span>', v:'b'}, {t:'<span class="math-eq">Ù¢Ø³&zwnj;</span>', v:'c'}, {t:'<span class="math-eq">Ø³</span>', v:'d'}], c:'a', e:'ÙÙŠ Ø§Ù„Ø¶Ø±Ø¨ Ù†Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø³Ø³: Ù¤ + Ù£ = Ù§', smart:'Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµØºÙŠØ±Ø© (Ø§Ù„Ø£Ø³Ø³).' },
             { id: 202, type: 'learn2', t: 'Ø¨Ø³Ø· Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© <span class="math-eq">Ù¢Ø£&zwnj; Â· Ù£Ø£&zwnj;<sup>Ù¥</sup></span>', o: [{t:'<span class="math-eq">Ù¦Ø£&zwnj;<sup>Ù¦</sup></span>', v:'a'}, {t:'<span class="math-eq">Ù¥Ø£&zwnj;<sup>Ù¦</sup></span>', v:'b'}, {t:'<span class="math-eq">Ù¦Ø£&zwnj;<sup>Ù¥</sup></span>', v:'c'}, {t:'<span class="math-eq">Ù¥Ø£&zwnj;<sup>Ù¥</sup></span>', v:'d'}], c:'a', e:'Ù†Ø¶Ø±Ø¨ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª (Ù¢Ã—Ù£=Ù¦) ÙˆÙ†Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø³Ø³ (Ù¡+Ù¥=Ù¦).', smart:'Ø§Ø¶Ø±Ø¨ Ø§Ù„ÙƒØ¨Ø§Ø± ÙˆØ§Ø¬Ù…Ø¹ Ø§Ù„ØµØºØ§Ø±.' },
             { id: 203, type: 'learn2', t: 'Ù†Ø§ØªØ¬ <span class="math-eq">Ù†&zwnj;<sup>Ù£</sup> Â· Ù†&zwnj;</span> Ù‡Ùˆ:', o: [{t:'<span class="math-eq">Ù†&zwnj;<sup>Ù¤</sup></span>', v:'a'}, {t:'<span class="math-eq">Ù†&zwnj;<sup>Ù£</sup></span>', v:'b'}, {t:'<span class="math-eq">Ù¢Ù†&zwnj;<sup>Ù£</sup></span>', v:'c'}, {t:'<span class="math-eq">Ù†&zwnj;<sup>Ù¢</sup></span>', v:'d'}], c:'a', e:'Ø§Ù„Ù†ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø£Ø³Ù‡Ø§ Ù¡ØŒ Ù„Ø°Ø§ Ù£ + Ù¡ = Ù¤.', smart:'Ù„Ø§ ØªÙ†Ø³ Ø§Ù„Ø£Ø³ Ø§Ù„Ù…Ø®ÙÙŠ (Ù¡).' },
             { id: 204, type: 'learn2', t: 'Ø¨Ø³Ø· <span class="math-eq">(-Ù¤Ø±)(Ù¢Ø±<sup>Ù£</sup>)</span>', o: [{t:'<span class="math-eq">-Ù¨Ø±<sup>Ù¤</sup></span>', v:'a'}, {t:'<span class="math-eq">Ù¨Ø±<sup>Ù¤</sup></span>', v:'b'}, {t:'<span class="math-eq">-Ù¢Ø±<sup>Ù£</sup></span>', v:'c'}, {t:'<span class="math-eq">-Ù¨Ø±<sup>Ù£</sup></span>', v:'d'}], c:'a', e:'Ø³Ø§Ù„Ø¨ ÙÙŠ Ù…ÙˆØ¬Ø¨ = Ø³Ø§Ù„Ø¨ØŒ ÙˆÙ†Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø³Ø³.', smart:'Ø§Ù†ØªØ¨Ù‡ Ù„Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø³Ø§Ù„Ø¨Ø©.' },
             { id: 301, type: 'learn3', t: 'Ù†Ø§ØªØ¬ <span class="math-eq">(Ø¨&zwnj;<sup>Ù£</sup>)<sup>Ù¥</sup></span>', o: [{t:'<span class="math-eq">Ø¨&zwnj;<sup>Ù¨</sup></span>', v:'a'}, {t:'<span class="math-eq">Ø¨&zwnj;<sup>Ù¡Ù¥</sup></span>', v:'b'}, {t:'<span class="math-eq">Ø¨</span>', v:'c'}, {t:'<span class="math-eq">Ø¨&zwnj;<sup>Ù¢</sup></span>', v:'d'}], c:'b', e:'ÙÙŠ Ù‚ÙˆØ© Ø§Ù„Ù‚ÙˆØ© Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø£Ø³Ø³: Ù£ Ã— Ù¥ = Ù¡Ù¥', smart:'Ø¥Ø°Ø§ Ø±Ø£ÙŠØª Ø£Ø³ÙŠÙ† ÙÙˆÙ‚ Ø¨Ø¹Ø¶Ù‡Ù…Ø§ØŒ Ø§Ø¶Ø±Ø¨Ù‡Ù….' },
             { id: 302, type: 'learn3', t: 'Ø¨Ø³Ø· <span class="math-eq">[(Ù¢)<sup>Ù¢</sup>]<sup>Ù£</sup></span>', o: [{t:'<span class="math-eq">Ù¢<sup>Ù¦</sup></span>', v:'a'}, {t:'<span class="math-eq">Ù¢<sup>Ù¥</sup></span>', v:'b'}, {t:'<span class="math-eq">Ù¢</span>', v:'c'}, {t:'<span class="math-eq">Ù¦</span>', v:'d'}], c:'a', e:'Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø£Ø³Ø³: Ù¢ Ã— Ù£ = Ù¦.', smart:'Ø§Ø¶Ø±Ø¨ Ø§Ù„Ø£Ø³Ø³ ÙÙ‚Ø·.' },
             { id: 303, type: 'learn3', t: 'Ù†Ø§ØªØ¬ <span class="math-eq">(Ø³&zwnj;<sup>Ù¢</sup>)<sup>Ù¤</sup></span>', o: [{t:'<span class="math-eq">Ø³&zwnj;<sup>Ù¨</sup></span>', v:'a'}, {t:'<span class="math-eq">Ø³&zwnj;<sup>Ù¦</sup></span>', v:'b'}, {t:'<span class="math-eq">Ù¤Ø³&zwnj;<sup>Ù¢</sup></span>', v:'c'}, {t:'<span class="math-eq">Ù¢Ø³&zwnj;<sup>Ù¤</sup></span>', v:'d'}], c:'a', e:'Ù¢ Ã— Ù¤ = Ù¨.', smart:'Ø¶Ø±Ø¨ØŒ Ù„ÙŠØ³ Ø¬Ù…Ø¹.' },
             { id: 401, type: 'learn4', t: 'Ù†Ø§ØªØ¬ <span class="math-eq">(Ù£Ø³&zwnj;<sup>Ù£</sup>)<sup>Ù¢</sup></span>', o: [{t:'<span class="math-eq">Ù£Ø³&zwnj;<sup>Ù¦</sup></span>', v:'a'}, {t:'<span class="math-eq">Ù©Ø³&zwnj;<sup>Ù¦</sup></span>', v:'b'}, {t:'<span class="math-eq">Ù¦Ø³</span>', v:'c'}, {t:'<span class="math-eq">Ù©Ø³</span>', v:'d'}], c:'b', e:'Ù†Ø±Ø¨Ø¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ (Ù£Ã—Ù£=Ù©) ÙˆÙ†Ø¶Ø±Ø¨ Ø£Ø³ Ø§Ù„Ù…ØªØºÙŠØ± (Ù£Ã—Ù¢=Ù¦).', smart:'Ø±Ø¨Ø¹ Ø§Ù„Ø±Ù‚Ù… ÙˆØ§Ø¶Ø±Ø¨ Ø§Ù„Ø£Ø³.' },
             { id: 402, type: 'learn4', t: 'Ø¨Ø³Ø· <span class="math-eq">(Ù¢Ø£ Ø¨&zwnj;<sup>Ù¢</sup>)<sup>Ù£</sup></span>', o: [{t:'<span class="math-eq">Ù¨Ø£<sup>Ù£</sup>Ø¨<sup>Ù¦</sup></span>', v:'a'}, {t:'<span class="math-eq">Ù¦Ø£<sup>Ù£</sup>Ø¨<sup>Ù¦</sup></span>', v:'b'}, {t:'<span class="math-eq">Ù¢Ø£<sup>Ù£</sup>Ø¨<sup>Ù¦</sup></span>', v:'c'}, {t:'<span class="math-eq">Ù¨Ø£ Ø¨<sup>Ù¦</sup></span>', v:'d'}], c:'a', e:'ÙˆØ²Ø¹ Ø§Ù„Ø£Ø³ 3 Ø¹Ù„Ù‰ ÙƒÙ„ Ø¹Ù†ØµØ±.', smart:'ÙˆØ²Ø¹ Ø§Ù„Ø£Ø³ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„.' },
             { id: 403, type: 'learn4', t: 'Ø¨Ø³Ø· <span class="math-eq">(-Ù¢Ø³ Øµ)<sup>Ù¢</sup></span>', o: [{t:'<span class="math-eq">Ù¤Ø³<sup>Ù¢</sup>Øµ<sup>Ù¢</sup></span>', v:'a'}, {t:'<span class="math-eq">-Ù¤Ø³<sup>Ù¢</sup>Øµ<sup>Ù¢</sup></span>', v:'b'}, {t:'<span class="math-eq">-Ù¢Ø³<sup>Ù¢</sup>Øµ<sup>Ù¢</sup></span>', v:'c'}, {t:'<span class="math-eq">Ù¤Ø³ Øµ</span>', v:'d'}], c:'a', e:'Ø§Ù„ØªØ±Ø¨ÙŠØ¹ ÙŠÙ„ØºÙŠ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø³Ø§Ù„Ø¨Ø©.', smart:'Ø§Ù„Ø£Ø³ Ø§Ù„Ø²ÙˆØ¬ÙŠ "ÙŠØ£ÙƒÙ„" Ø§Ù„Ø³Ø§Ù„Ø¨.' },
             { id: 404, type: 'learn4', t: 'ØªØ­Ø¯ÙŠ: <span class="math-eq">(Ù£Ø³)<sup>Ù¢</sup> Â· Ø³</span>', o: [{t:'<span class="math-eq">Ù©Ø³<sup>Ù£</sup></span>', v:'a'}, {t:'<span class="math-eq">Ù©Ø³<sup>Ù¢</sup></span>', v:'b'}, {t:'<span class="math-eq">Ù£Ø³<sup>Ù£</sup></span>', v:'c'}, {t:'<span class="math-eq">Ù¦Ø³<sup>Ù£</sup></span>', v:'d'}], c:'a', e:'Ø£ÙˆÙ„Ø§Ù‹ Ù†ÙÙƒ Ø§Ù„Ù‚ÙˆØ©: Ù©Ø³Â²ØŒ Ø«Ù… Ù†Ø¶Ø±Ø¨ ÙÙŠ Ø³: Ù©Ø³Â² Â· Ø³ = Ù©Ø³Â³.', smart:'ÙÙƒ Ø§Ù„Ù‚ÙˆØ³ Ø£ÙˆÙ„Ø§Ù‹.' }
        ];

        // --- Quiz Engine & Attempts ---
        const ATTEMPTS_KEY = 'quiz_attempts_' + LESSON_KEY;
        const NEXT_ATTEMPT_KEY = 'quiz_next_attempt_' + LESSON_KEY;
        const COOLDOWN_MS = 24 * 60 * 60 * 1000;
        
        let attemptsLeft = 0; 
        let currentQuestions = [];

        // --- 1. ROBUST SYNC & RETRY MECHANISMS ---
        
        function logDebug(msg) {
            const panel = document.getElementById('debug-content');
            if(panel) panel.innerHTML += `<div>${new Date().toLocaleTimeString()} - ${msg}</div>`;
            console.log(msg);
        }

        function hardReset() {
            localStorage.clear();
            window.location.reload();
        }

        // Force sync from server
        async function fetchStudentData() {
            // Visitors don't sync with server to avoid collision
            const sId = urlParams.get('studentId') || 'visitor';
            if (sId === 'visitor') {
                logDebug("Visitor Mode: Local Only");
                return;
            }

            if (!APPS_SCRIPT_URL.startsWith('http')) {
                logDebug("Error: Invalid Apps Script URL");
                return;
            }

            const loadingEl = document.getElementById('loading-attempts');
            const displayEl = document.getElementById('attempts-display');
            if(loadingEl) loadingEl.classList.remove('hidden');
            if(displayEl) displayEl.classList.add('hidden');
            const syncStatus = document.getElementById('sync-status');
            if(syncStatus) { syncStatus.className = 'w-2 h-2 rounded-full bg-yellow-400 mt-1'; syncStatus.title = 'Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„...'; }

            try {
                const cId = urlParams.get('classId') || 'visitor';
                // CORRECTED ACTION: getStudentData
                const url = `${APPS_SCRIPT_URL}?action=getStudentData&studentId=${sId}&classId=${cId}&itemId=${LESSON_KEY}&t=${Date.now()}`;
                
                logDebug(`Fetching data for ${sId}...`);
                const response = await fetch(url);
                const jsonResponse = await response.json(); // Full response wrapper
                logDebug(`Server Response: ${JSON.stringify(jsonResponse).substring(0, 100)}...`);

                // CORRECTED PATH: Access data.data.lessons
                if (jsonResponse.status === "success" && jsonResponse.data) {
                    
                    // Fallback if lesson key missing (New Lesson)
                    let lessonData = { attempts: 0, allowed: true, waitTime: 0, grade: 0 };
                    
                    if (jsonResponse.data.lessons && jsonResponse.data.lessons[LESSON_KEY]) {
                        lessonData = jsonResponse.data.lessons[LESSON_KEY];
                    }

                    const consumed = lessonData.attempts || 0;
                    const maxAttempts = 3; 
                    
                    // 1. Force Authority
                    attemptsLeft = Math.max(0, maxAttempts - consumed);
                    
                    // 2. Logic: Server vs Local Storage
                    if (attemptsLeft > 0) {
                        // UNLOCK EVERYTHING
                        localStorage.removeItem(`${NEXT_ATTEMPT_KEY}_${sId}`);
                        
                        if (timerInterval) clearInterval(timerInterval);
                        
                        document.getElementById('timer-top-container').classList.add('hidden');
                        document.getElementById('timer-bottom-container').classList.add('hidden');
                        document.getElementById('retake-quiz-btn').classList.remove('hidden');
                        
                        const submitBtn = document.getElementById('quiz-action-btn');
                        if(submitBtn) {
                             submitBtn.disabled = false;
                             submitBtn.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-gray-400');
                             submitBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                             submitBtn.textContent = "ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª";
                        }
                    } else {
                        // Server says BLOCKED
                        attemptsLeft = 0;
                        if (lessonData.waitTime > 0) {
                            const unlockTime = Date.now() + lessonData.waitTime;
                            localStorage.setItem(`${NEXT_ATTEMPT_KEY}_${sId}`, unlockTime);
                            startTimer(unlockTime);
                        }
                    }
                    
                    localStorage.setItem(`${ATTEMPTS_KEY}_${sId}`, attemptsLeft);
                    
                    // Update header score
                    const scoreEl = document.getElementById('student-score');
                    const badge = document.getElementById('header-score-badge');
                    if (lessonData.grade > 0 && scoreEl) {
                        scoreEl.textContent = lessonData.grade;
                        if(badge) badge.classList.remove('hidden');
                    }
                    
                    if(syncStatus) { syncStatus.className = 'w-2 h-2 rounded-full bg-green-500 mt-1'; syncStatus.title = 'Ù…ØªØµÙ„'; }
                } else {
                    logDebug("Data format invalid.");
                }
            } catch (error) {
                logDebug(`Sync Error: ${error.message}`);
                console.error("Sync Error:", error);
                if(syncStatus) { syncStatus.className = 'w-2 h-2 rounded-full bg-red-500 mt-1'; syncStatus.title = 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„'; }
            } finally {
                updateAttemptsUI();
                if(loadingEl) loadingEl.classList.add('hidden');
                if(displayEl) displayEl.classList.remove('hidden');
            }
        }

        function initAttempts() {
            const sId = urlParams.get('studentId') || 'visitor';
            
            if (sId === 'visitor') {
                // VISITOR MODE - ALWAYS RESET FOR DEBUGGING/TESTING IF NEEDED OR KEEP LOCAL
                // For now, let's auto-reset visitor every load to fix "stuck at 0" issue for you
                localStorage.removeItem(`${ATTEMPTS_KEY}_visitor`);
                localStorage.removeItem(`${NEXT_ATTEMPT_KEY}_visitor`);
                
                attemptsLeft = 1; 
                updateAttemptsUI();
            } else {
                // STUDENT MODE
                // Start with what we have (0 to be safe) until server replies
                attemptsLeft = 0; 
                updateAttemptsUI();
                
                // Always fetch fresh data
                fetchStudentData();
            }
        }
        
        let timerInterval;
        
        function updateAttemptsUI() {
            const countEl = document.getElementById('attempts-count');
            if(countEl) countEl.textContent = convertToArabic(attemptsLeft);
            
            const submitBtn = document.getElementById('quiz-action-btn');
            
            // Only manipulate the button state if the quiz result is hidden (active quiz)
            // If quiz result is shown, the button is controlled by handleQuizSubmit logic (Retake/Finished)
            const resultsVisible = !document.getElementById('quiz-results').classList.contains('hidden');
            
            if (!resultsVisible && submitBtn) {
                 if (attemptsLeft > 0) {
                    // Enable if we have attempts and are in quiz mode
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-gray-400');
                    submitBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    submitBtn.textContent = "ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª";
                } else {
                    // Disable if no attempts
                    submitBtn.disabled = true;
                    submitBtn.classList.add('opacity-50', 'cursor-not-allowed', 'bg-gray-400');
                    submitBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    submitBtn.textContent = "Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…Ø³ØªÙ†ÙØ°Ø©";
                }
            }
        }
        
        function startTimer(targetTime) {
             clearInterval(timerInterval);
             const tick = () => {
                const now = Date.now();
                const diff = targetTime - now;
                if (diff <= 0) {
                    clearInterval(timerInterval);
                    const sId = urlParams.get('studentId') || 'visitor';
                    if (sId === 'visitor') {
                         attemptsLeft = 1;
                         localStorage.setItem(`${ATTEMPTS_KEY}_visitor`, 1);
                         localStorage.removeItem(`${NEXT_ATTEMPT_KEY}_visitor`);
                         updateAttemptsUI();
                    } else {
                        fetchStudentData(); 
                    }
                    return;
                }
                const hours = Math.floor((diff / (1000 * 60 * 60)));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                const timeStr = `${hours}:${minutes}:${seconds}`; 
                const timeStrAr = timeStr.replace(/\d/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©"[d]);
                
                const topDisplay = document.getElementById('timer-display-top');
                const bottomDisplay = document.getElementById('timer-display-bottom');
                if(topDisplay) {
                    topDisplay.textContent = timeStrAr;
                    topDisplay.parentElement.classList.remove('hidden');
                }
                if(bottomDisplay) bottomDisplay.textContent = timeStrAr;
            };
            timerInterval = setInterval(tick, 1000);
            tick();
        }

        function generateQuiz() { 
            const getQ = (type) => {
                const subset = questionBank.filter(q => q.type === type);
                return subset[Math.floor(Math.random() * subset.length)];
            };

            const q1 = getQ('learn1');
            const q2 = getQ('learn2');
            const q3 = getQ('learn3');
            const q4 = getQ('learn4');
            let q5 = questionBank[Math.floor(Math.random() * questionBank.length)];
            while ([q1, q2, q3, q4].includes(q5)) {
                q5 = questionBank[Math.floor(Math.random() * questionBank.length)];
            }

            currentQuestions = [q1, q2, q3, q4, q5].sort((a, b) => {
                const order = { 'learn1': 1, 'learn2': 2, 'learn3': 3, 'learn4': 4 };
                return (order[a.type] || 5) - (order[b.type] || 5);
            });

            renderQuiz(); 
        }

        function renderQuiz() {
            const quizForm = document.getElementById('quizForm');
            let html = '';
            
            const typeLabels = { 'learn1': 'Ù…ÙÙ‡ÙˆÙ… ÙˆØ­ÙŠØ¯Ø© Ø§Ù„Ø­Ø¯', 'learn2': 'Ø¶Ø±Ø¨ Ø§Ù„Ù‚ÙˆÙ‰', 'learn3': 'Ù‚ÙˆØ© Ø§Ù„Ù‚ÙˆØ©', 'learn4': 'Ù‚ÙˆØ© Ø­Ø§ØµÙ„ Ø§Ù„Ø¶Ø±Ø¨' };

            currentQuestions.forEach((q, i) => {
                html += `
                <div class="border border-gray-200 rounded-xl p-4 md:p-6 hover:border-blue-200 transition bg-white mb-6">
                    <div class="flex flex-col gap-2 mb-4">
                        <div class="flex justify-between items-center">
                            <span class="bg-blue-100 text-blue-600 px-2 py-0.5 rounded text-[10px] md:text-xs font-bold">Ø³Ø¤Ø§Ù„ ${convertToArabic(i+1)}</span>
                            <span class="text-[10px] text-gray-400 font-bold flex items-center gap-1"><i class="fas fa-tag text-xs"></i> ${typeLabels[q.type] || 'Ø¹Ø§Ù…'}</span>
                        </div>
                        <p class="font-bold text-gray-800 text-sm md:text-lg leading-6 mt-1">${q.t}</p>
                    </div>
                    <div class="options-grid">
                        ${q.o.map((opt, oi) => `<div><input type="radio" name="q${i}" id="q${i}o${oi}" value="${opt.v}" class="hidden"><label for="q${i}o${oi}" class="option-label text-sm md:text-base select-none shadow-sm">${opt.t}</label></div>`).join('')}
                    </div>
                    <div id="feedback-${i}" class="text-xs md:text-base font-bold mt-3 hidden p-3 rounded-lg"></div>
                    <div id="post-submit-actions-${i}" class="hidden flex flex-wrap gap-2 mt-3 items-center">
                         <button type="button" onclick="showExplain(${i})" class="text-xs md:text-sm bg-blue-50 text-blue-600 px-3 py-2 rounded-lg hover:bg-blue-100 flex items-center gap-1 transition"><i data-lucide="help-circle" class="w-3 h-3 md:w-4 md:h-4"></i> Ù„Ù…Ø§Ø°Ø§ØŸ</button>
                         <button type="button" onclick="showSmart(${i})" class="text-xs md:text-sm bg-purple-50 text-purple-600 px-3 py-2 rounded-lg hover:bg-purple-100 flex items-center gap-1 transition"><i data-lucide="lightbulb" class="w-3 h-3 md:w-4 md:h-4"></i> Ø§Ù„Ø­Ù„ Ø§Ù„Ø°ÙƒÙŠ</button>
                         <button type="button" onclick="switchTab('${q.type}')" class="text-xs md:text-sm border border-gray-200 text-gray-500 px-3 py-2 rounded-lg hover:bg-gray-50 flex items-center gap-1 transition mr-auto"><i data-lucide="book-open" class="w-3 h-3 md:w-4 md:h-4"></i> Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¯Ø±Ø³</button>
                    </div>
                </div>`;
            });

            // The ONE button to rule them all
            html += '<button type="submit" id="quiz-action-btn" class="w-full bg-blue-600 text-white font-bold py-3 md:py-4 rounded-xl text-sm md:text-lg shadow-lg hover:bg-blue-700 transition transform active:scale-95 mb-4 disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-400">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</button>';
            
            quizForm.innerHTML = html;
            lucide.createIcons();
            quizForm.onsubmit = handleQuizSubmit;
        }

        // --- NEW SAVE FUNCTION WITH RETRY (AUTO-RETRY) ---
        async function saveScoreToBackend(lessonId, grade) {
            const urlParams = new URLSearchParams(window.location.search);
            const studentId = urlParams.get('studentId');
            const classId = urlParams.get('classId');
            const saveStatus = document.getElementById('save-status');
            
            if (!studentId || !classId) {
                if(saveStatus) saveStatus.innerHTML = '<span class="text-yellow-600">ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ (Ø²Ø§Ø¦Ø±)</span>';
                return;
            }

            if(saveStatus) saveStatus.innerHTML = '<span class="text-blue-600"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±Ù Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©...</span>';
            
            const requestUrl = `${APPS_SCRIPT_URL}?action=saveScore&studentId=${studentId}&classId=${classId}&itemId=${lessonId}&score=${grade}&type=lesson`;
            
            // Retry Logic: Try 3 times with 2-second delay
            let success = false;
            for (let i = 0; i < 3; i++) {
                try {
                    // Method changed to GET as per backend script
                    await fetch(requestUrl);
                    success = true;
                    break; // Exit loop on success
                } catch (error) {
                    console.warn(`Save attempt ${i+1} failed. Retrying...`);
                    if(saveStatus) saveStatus.innerHTML = `<span class="text-orange-500">â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© (${i+1}/3)...</span>`;
                    await new Promise(r => setTimeout(r, 2000)); // Wait 2s
                }
            }

            if (success) {
                if(saveStatus) saveStatus.innerHTML = '<span class="text-green-600 font-bold">âœ” ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ù†Ø¬Ø§Ø­!</span>';
                setTimeout(() => fetchStudentData(), 1000); // Sync attempts
            } else {
                if(saveStatus) saveStatus.innerHTML = '<span class="text-red-600 font-bold">âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø­ÙØ¸. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„.</span>';
            }
        }

        // Renamed to resetQuizView as used in the onclick handler
        function resetQuizView() {
            document.getElementById('quiz-results').classList.add('hidden');
            // Re-enable radio inputs for clean state
            generateQuiz(); 
            // Sync data to be sure
            fetchStudentData();
            // Scroll to top of tab
            document.getElementById('tab-quiz').scrollIntoView({ behavior: 'smooth' });
        }

        async function handleQuizSubmit(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('quiz-action-btn');

            // If button is in "Retake" mode (managed via onclick overriding, but good to double check logic flow)
            // Actually, once we change onclick, this listener is bypassed. 
            // So this function ONLY runs for "Check Answer" submission.
            
            if (attemptsLeft <= 0) {
                alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù‚Ø¯ Ø§Ø³ØªÙ†ÙØ°Øª Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ.");
                return;
            }

            // Local decrement for immediate feedback
            attemptsLeft--;
            const sId = urlParams.get('studentId') || 'visitor';
            
            if (sId === 'visitor') {
                localStorage.setItem(`${ATTEMPTS_KEY}_visitor`, attemptsLeft);
                if (attemptsLeft === 0) {
                    localStorage.setItem(`${NEXT_ATTEMPT_KEY}_visitor`, Date.now() + COOLDOWN_MS);
                    startTimer(Date.now() + COOLDOWN_MS);
                }
            } else {
                localStorage.setItem(`${ATTEMPTS_KEY}_${sId}`, attemptsLeft);
                if (attemptsLeft === 0) {
                    localStorage.setItem(`${NEXT_ATTEMPT_KEY}_${sId}`, Date.now() + COOLDOWN_MS);
                    startTimer(Date.now() + COOLDOWN_MS);
                }
            }
            // Do NOT call updateAttemptsUI here because it might reset our button logic below.
            // We update text manually if needed or let the flow handle it.
            const countEl = document.getElementById('attempts-count');
            if(countEl) countEl.textContent = convertToArabic(attemptsLeft);

            let score = 0;
            submitBtn.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµØ­ÙŠØ­ ÙˆØ§Ù„Ø­ÙØ¸...";
            submitBtn.disabled = true;

            currentQuestions.forEach((q, i) => {
                const selected = quizForm.querySelector(`input[name="q${i}"]:checked`);
                const feedback = document.getElementById(`feedback-${i}`);
                const actionArea = document.getElementById(`post-submit-actions-${i}`);
                if(actionArea) actionArea.classList.remove('hidden');

                if (selected) {
                    if (selected.value === q.c) {
                        score++;
                        feedback.innerHTML = 'âœ” Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!';
                        feedback.className = 'text-xs font-bold mt-3 text-green-700 bg-green-50 block p-3 rounded-lg border border-green-100';
                        feedback.classList.remove('hidden');
                    } else {
                        feedback.innerHTML = 'âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©.';
                        feedback.className = 'text-xs font-bold mt-3 text-red-700 bg-red-50 block p-3 rounded-lg border border-red-100';
                        feedback.classList.remove('hidden');
                    }
                } else {
                    feedback.innerHTML = 'âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±.';
                    feedback.className = 'text-xs font-bold mt-3 text-yellow-700 bg-yellow-50 block p-3 rounded-lg';
                    feedback.classList.remove('hidden');
                }
            });

            const finalScore = score * 2; 
            
            // Save to Backend with Retry (Async - let UI proceed)
            saveScoreToBackend(LESSON_KEY, finalScore);

            const resultCard = document.getElementById('quiz-results');
            resultCard.classList.remove('hidden', 'result-card-trophy', 'result-card-star', 'result-card-retry');
            
            if (finalScore > 8) resultCard.classList.add('result-card-trophy');
            else if (finalScore >= 5) resultCard.classList.add('result-card-star');
            else resultCard.classList.add('result-card-retry');

            document.getElementById('quiz-score').textContent = `${convertToArabic(finalScore)} / Ù¡Ù `;
            
            const inputs = quizForm.querySelectorAll('input');
            inputs.forEach(i => i.disabled = true);
            
            // --- TRANSFORM BUTTON ---
            // Remove submit behavior to prevent re-submission
            submitBtn.type = "button"; 
            submitBtn.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-blue-600', 'hover:bg-blue-700', 'bg-gray-400');
            
            if (attemptsLeft > 0) {
                submitBtn.textContent = "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±";
                // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø¬Ø¹Ù„ Ø§Ù„Ø²Ø± Ø£Ø²Ø±Ù‚ ØµØ±ÙŠØ­ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø¨ÙŠØ¶
                submitBtn.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700', 'shadow-lg', 'transform', 'active:scale-95');
                submitBtn.disabled = false;
                submitBtn.onclick = resetQuizView; // Bind the reset function
            } else {
                submitBtn.textContent = "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª";
                submitBtn.classList.add('bg-gray-400', 'text-white', 'cursor-not-allowed');
                submitBtn.disabled = true;
                
                // Show timer below
                document.getElementById('timer-bottom-container').classList.remove('hidden');
            }
            
            renderDynamicGames();
        }

        function convertToArabic(n) { return n.toString().replace(/\d/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©"[d]); }
        function showExplain(i) { document.getElementById('modal-content').innerHTML = currentQuestions[i].e; document.getElementById('modal').classList.remove('hidden'); }
        function showSmart(i) { document.getElementById('modal-content').innerHTML = `<p class="font-bold text-purple-700">ğŸ’¡ Ø§Ù„Ø­Ù„ Ø§Ù„Ø°ÙƒÙŠ:</p>${currentQuestions[i].smart}`; document.getElementById('modal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }
        
        // --- Init ---
        const navContainer = document.getElementById('bottom-nav-container');
        let navHTML = '';
        
        tabs.forEach((tab, index) => {
             navHTML += `
             <div class="nav-item ${index === 0 ? 'active' : ''}" onclick="switchTab('${tab.id}')" id="nav-${tab.id}">
                 <i data-lucide="${tab.icon}"></i>
                 <span>${tab.label}</span>
             </div>`;
        });
        
        navContainer.innerHTML = navHTML;
        lucide.createIcons();
        initInteractive();
        initAttempts();
    </script>
</body>
</html>
