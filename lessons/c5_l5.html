<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุฏุฑุณ ูฅ-ูฅ: ุชุทุจููุงุช ุนูู ุงููุธุงู ุงููููู ูู ูุนุงุฏูุชูู ุฎุทูุชูู | ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .math-eq { font-family: "Courier New", monospace; font-size: 1.1rem; font-weight: bold; padding: 4px 8px; border-radius: 6px; display: inline-block; vertical-align: middle; border: 1px solid; }
        .highlight-number { background-color: #fef9c3; color: #b45309; padding: 1px 5px; border-radius: 4px; border: 1px solid #fde047; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; }
        input[type="radio"] { display: none; }
        .eq-color-1 { color: #1d4ed8; background-color: #dbeafe; border-color: #93c5fd; } 
        .eq-color-2 { color: #15803d; background-color: #dcfce7; border-color: #86efac; } 
        .eq-color-3 { color: #7e22ce; background-color: #f3e8ff; border-color: #d8b4fe; } 
        .final-answer-box { background-color: #fef9c3; border-color: #fde047; color: #b45309; font-weight: bold; }
        .step-box { border-right: 4px solid #1d4ed8; padding: 10px; margin-bottom: 10px; background: #f9fafb; border-radius: 4px; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="min-h-screen flex flex-col">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        
        <main class="container mx-auto max-w-4xl my-8 px-4 flex-grow">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 class="text-3xl font-bold text-blue-800">ุงูุฏุฑุณ ูฅ-ูฅ: ุชุทุจููุงุช ุนูู ุงููุธุงู ุงููููู ูู ูุนุงุฏูุชูู ุฎุทูุชูู</h1>
                </header>
                
                <!-- ุงููุณู ุงูุฃูู: ุงูููููู -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ก ุฃููุงู: ุงูููููู ุงูุฃุณุงุณู</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                        <p class="text-lg">ูุงุฎุชูุงุฑ ุงูุทุฑููุฉ ุงูุฃูุถู ูุญู ุงููุธุงูุ ุงุชุจุน ูุฐุง ุงูุฌุฏูู ุงูุฅุฑุดุงุฏู:</p>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white rounded-lg shadow">
                                <thead class="bg-blue-600 text-white">
                                    <tr>
                                        <th class="p-3 text-right">ุงูุทุฑููุฉ</th>
                                        <th class="p-3 text-right">ุฃูุถู ุญุงูุฉ ูุงุณุชุนูุงููุง</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b"><td class="p-3 font-bold">ุงูุชูุซูู ุงูุจูุงูู</td><td class="p-3">ูุชูุฏูุฑ ุงูุญููู ููุท.</td></tr>
                                    <tr class="border-b bg-gray-50"><td class="p-3 font-bold">ุงูุชุนููุถ</td><td class="p-3">ุฅุฐุง ูุงู ูุนุงูู ุฃุญุฏ ุงููุชุบูุฑูู <span class="highlight-number">ูก</span> ุฃู <span class="highlight-number">-ูก</span>.</td></tr>
                                    <tr class="border-b"><td class="p-3 font-bold">ุงูุญุฐู ุจุงูุฌูุน</td><td class="p-3">ุฅุฐุง ูุงู ุงููุนุงููุงู ูุชุนุงูุณูู (ูุซู ูฅุ -ูฅ).</td></tr>
                                    <tr class="border-b bg-gray-50"><td class="p-3 font-bold">ุงูุญุฐู ุจุงูุทุฑุญ</td><td class="p-3">ุฅุฐุง ูุงู ุงููุนุงููุงู ูุชุณุงูููู (ูุซู ูฃุ ูฃ).</td></tr>
                                    <tr><td class="p-3 font-bold">ุงูุญุฐู ุจุงูุถุฑุจ</td><td class="p-3">ุฅุฐุง ูู ุชุชููุฑ ุงูุดุฑูุท ุงูุณุงุจูุฉ.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- ุงููุณู ุงูุซุงูู: ุชุญุฏูุงุช ุชูุงุนููุฉ ุณุฑูุนุฉ -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ฏ ุซุงููุงู: ุญุฏุฏ ุงูุทุฑููุฉ ุงูุฃูุถู (ุชูุงุนูู)</h2>
                    <p class="mb-4 text-gray-600">ุงุถุบุท ุนูู ุงูุทุฑููุฉ ุงูุชู ุชุฑุงูุง ููุงุณุจุฉ ููู ูุธุงู ูุดุงูุฏ ุงูุดุฑุญ ุงููุฎุตุต:</p>
                    <div id="choice-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- ูุชู ุฅุถุงูุฉ ุงูุฃูุซูุฉ ููุง ุจุฑูุฌูุงู -->
                    </div>
                </section>

                <!-- ุงููุณู ุงูุซุงูุซ: ุชุทุจููุงุช ูู ูุงูุน ุงูุญูุงุฉ -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ ุซุงูุซุงู: ุชุทุจููุงุช ูู ูุงูุน ุงูุญูุงุฉ</h2>
                    <div id="apps-container" class="space-y-8"></div>
                </section>
                
                <!-- ุงููุณู ุงูุฑุงุจุน: ุงูุงุฎุชุจุงุฑ ุงูุนุดูุงุฆู -->
                <section class="mt-12 bg-gray-50 p-6 rounded-xl border border-gray-200">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">โ๏ธ ุฑุงุจุนุงู: ุงุฎุชุจุฑ ูููู (ูฅ ุฃุณุฆูุฉ ุนุดูุงุฆูุฉ)</h2>
                    </div>
                    <form id="quizForm" class="space-y-8"></form>
                    
                    <div id="results-area" class="hidden mt-8 p-8 bg-white border-2 border-blue-200 rounded-2xl text-center shadow-inner">
                        <h3 class="text-xl font-bold text-blue-900 mb-2">ุงููุชูุฌุฉ ุงูููุงุฆูุฉ</h3>
                        <p id="score-display" class="text-6xl font-black text-blue-600 my-4" dir="ltr"></p>
                        <div id="save-status" class="py-2 px-4 rounded-lg inline-block text-sm font-bold mt-2"></div>
                        <div class="mt-6">
                            <button onclick="window.location.reload()" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-blue-700 transition">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ (ุฃุณุฆูุฉ ุฌุฏูุฏุฉ)</button>
                        </div>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-white border-t py-6"></footer>
    </div>

    <!-- Modals -->
    <div id="modal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center p-4 z-[100]">
        <div class="bg-white rounded-xl max-w-lg w-full p-6 shadow-2xl">
            <div class="flex justify-between mb-4 border-b pb-2">
                <h3 id="modal-title" class="text-xl font-bold text-blue-800"></h3>
                <button onclick="closeModal()" class="text-2xl font-bold">&times;</button>
            </div>
            <div id="modal-body" class="text-gray-700 leading-relaxed max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    let studentData = null;

    // ุจูู ุงูุฃุณุฆูุฉ (ูกูฅ ุณุคุงูุงู)
    const QUESTION_BANK = [
        { level: 'โญ', text: 'ูุง ุฃูุถู ุทุฑููุฉ ูุญู ุงููุธุงูุ<br><span class="math-eq">ุณ = ูขุต + ูฅ</span><br><span class="math-eq">ูฃุณ + ูคุต = ูกูฅ</span>', options: ['ุงูุชูุซูู ุงูุจูุงูู', 'ุงูุชุนููุถ', 'ุงูุญุฐู ุจุงูุฌูุน', 'ุงูุญุฐู ุจุงูุทุฑุญ'], correct: 'ุงูุชุนููุถ', explanation: 'ุงููุนุงุฏูุฉ ุงูุฃููู ุชุจุฏุฃ ุจู ุณ=ุ ููุฐุง ููุชุงุญ ุงุณุชุฎุฏุงู ุงูุชุนููุถ.' },
        { level: 'โญ', text: 'ุฃูุถู ุทุฑููุฉ ูุญู ุงููุธุงู:<br><span class="math-eq">ูฅุณ + ูขุต = ูง</span><br><span class="math-eq">ูฃุณ - ูขุต = ูก</span>', options: ['ุงูุชุนููุถ', 'ุงูุญุฐู ุจุงูุฌูุน', 'ุงูุญุฐู ุจุงูุทุฑุญ', 'ุงูุญุฐู ุจุงูุถุฑุจ'], correct: 'ุงูุญุฐู ุจุงูุฌูุน', explanation: 'ุงูุธุฑ ูู ุตุ ูุนุงููุงุชูุง ูุชุนุงูุณุฉ (+ูข ู -ูข)ุ ูุฐุง ูุณุชุฎุฏู ุงูุญุฐู ุจุงูุฌูุน.' },
        { level: 'โญ', text: 'ุฃูุถู ุทุฑููุฉ ูุญู ุงููุธุงู:<br><span class="math-eq">ูฆุณ + ูฅุต = ูกู</span><br><span class="math-eq">ูฆุณ - ูฃุต = ูข</span>', options: ['ุงูุชูุซูู ุงูุจูุงูู', 'ุงูุชุนููุถ', 'ุงูุญุฐู ุจุงูุฌูุน', 'ุงูุญุฐู ุจุงูุทุฑุญ'], correct: 'ุงูุญุฐู ุจุงูุทุฑุญ', explanation: 'ูุนุงููุงุช ุณ ูุชุณุงููุฉ (ูฆ ู ูฆ)ุ ูุฐุง ุงูุทุฑุญ ูุญุฐู ุณ ููุฑุงู.' },
        { level: 'โญโญ', text: 'ูุง ุงูุทุฑููุฉ ุงูุฃูุณุจ ุฅุฐุง ูุงูุช ุงููุนุงููุงุช ูู (ูขุ ูฃ) ู (ูฅุ ูค)ุ', options: ['ุงูุชุนููุถ', 'ุงูุญุฐู ุจุงูุฌูุน', 'ุงูุญุฐู ุจุงูุทุฑุญ', 'ุงูุญุฐู ุจุงูุถุฑุจ'], correct: 'ุงูุญุฐู ุจุงูุถุฑุจ', explanation: 'ูุนุฏู ูุฌูุฏ ูุนุงููุงุช ูก ุฃู -ูก ุฃู ููู ูุชุณุงููุฉ/ูุชุนุงูุณุฉุ ูุณุชุฎุฏู ุงูุถุฑุจ.' },
        { level: 'โญ', text: 'ูุฌููุน ุนุฏุฏูู ูกูข ูุงููุฑู ุจููููุง ูค. ูุง ููุงุ', options: ['(ูจุ ูค)', '(ูงุ ูฅ)', '(ูฉุ ูฃ)', '(ูฆุ ูฆ)'], correct: '(ูจุ ูค)', explanation: 'ูจ+ูค=ูกูข ู ูจ-ูค=ูค.' },
        { level: 'โญโญ', text: 'ูุง ุญู ุงููุธุงู: <span class="math-eq">ุณ + ุต = ูฆ</span> ู <span class="math-eq">ุณ + ุต = ูกู</span>ุ', options: ['(ูฃุ ูฃ)', '(ูฅุ ูฅ)', 'ูุง ููุฌุฏ ุญู', 'ุนุฏุฏ ูุง ููุงุฆู'], correct: 'ูุง ููุฌุฏ ุญู', explanation: 'ุงููุณุชูููุงู ูุชูุงุฒูุงู ูุฃู ุงูุทุฑู ุงูุฃููู ูุชุทุงุจู ูุงูุฃูุณุฑ ูุฎุชูู.' },
        { level: 'โญ', text: 'ุญู ุงููุธุงู: <span class="math-eq">ุต = ุณ + ูฃ</span> ู <span class="math-eq">ุต = ูขุณ + ูก</span>ุ', options: ['(ูขุ ูฅ)', '(ูกุ ูค)', '(ูุ ูฃ)', '(ูฃุ ูฆ)'], correct: '(ูขุ ูฅ)', explanation: 'ุจูุณุงูุงุฉ ุงููุนุงุฏูุชูู: ุณ+ูฃ = ูขุณ+ูก => ุณ=ูข. ุซู ุต=ูข+ูฃ=ูฅ.' },
        { level: 'โญโญ', text: 'ุนุฏุฏุงู ุฃุญุฏููุง ูุฒูุฏ ุนู ุงูุขุฎุฑ ุจููุฏุงุฑ ูฅ ููุฌููุนููุง ูกูฅ. ูุง ููุงุ', options: ['(ูกูุ ูฅ)', '(ูฅุ ู)', '(ูกูขุ ูง)', '(ูกูกุ ูฆ)'], correct: '(ูกูุ ูฅ)', explanation: 'ูกู+ูฅ=ูกูฅ ู ูกู-ูฅ=ูฅ.' },
        { level: 'โญโญ', text: 'ุฃู ูุธุงู ููุง ููู ููุถู ุญูู ุจุงูุญุฐู ุจุงูุทุฑุญุ', options: ['ูขุณ+ุต=ูฅ ุ ูฃุณ-ุต=ูข', 'ุณ=ุต+ูข ุ ูขุณ-ุต=ูค', 'ูคุณ+ูฃุต=ูง ุ ูคุณ+ุต=ูฃ', 'ุณ+ุต=ูกู ุ ูขุณ+ูขุต=ูขู'], correct: 'ูคุณ+ูฃุต=ูง ุ ูคุณ+ุต=ูฃ', explanation: 'ูุชุณุงูู ูุนุงูู ุณ ููู (ูค).' },
        { level: 'โญโญ', text: 'ุญู ุงููุธุงู: <span class="math-eq">ูขุณ + ูฃุต = ูก</span> ู <span class="math-eq">ูขุณ + ูฃุต = ูก</span>ุ', options: ['(ูุ ู)', 'ูุง ููุฌุฏ ุญู', 'ุนุฏุฏ ูุง ููุงุฆู', '(ูกุ ูก)'], correct: 'ุนุฏุฏ ูุง ููุงุฆู', explanation: 'ุงููุนุงุฏูุชุงู ูุชุทุงุจูุชุงู ุชูุงูุงู.' },
        { level: 'โญ', text: 'ูู ุงูุชุนููุถุ ุฅุฐุง ุญุตููุง ุนูู <span class="math-eq">ูฅ = ูฅ</span> ููุฐุง ูุนูู:', options: ['ุญู ูุญูุฏ', 'ูุง ููุฌุฏ ุญู', 'ุนุฏุฏ ูุง ููุงุฆู', 'ุฎุทุฃ ูู ุงูุญู'], correct: 'ุนุฏุฏ ูุง ููุงุฆู', explanation: 'ุงูุฌููุฉ ุงูุตุญูุญุฉ ุฏุงุฆูุงู ุชุนูู ุงูุทุจุงู ุงููุณุชููููู.' },
        { level: 'โญโญโญ', text: 'ุซูู ูฃ ุฃููุงู ูุฏูุชุฑูู ูกูจ ุฑูุงูุ ูุซูู ูฃ ุฃููุงู ู ูค ุฏูุงุชุฑ ูขูค ุฑูุงู. ูุง ุซูู ุงูุฏูุชุฑุ', options: ['ูข ุฑูุงู', 'ูฃ ุฑูุงู', 'ูค ุฑูุงู', 'ูฅ ุฑูุงู'], correct: 'ูฃ ุฑูุงู', explanation: 'ุจุงูุทุฑุญ: ูข ุฏูุชุฑ = ูฆ ุฑูุงูุงุชุ ุฅุฐู ุงูุฏูุชุฑ ุงููุงุญุฏ ูฃ ุฑูุงูุงุช.' },
        { level: 'โญ', text: 'ุฅุฐุง ูุงู ุงููุชุบูุฑ ุต ูุนุฒููุงู ูู ุทุฑู ูุญุฏูุ ูุณุชุฎุฏู:', options: ['ุงูุถุฑุจ', 'ุงูุฌูุน', 'ุงูุทุฑุญ', 'ุงูุชุนููุถ'], correct: 'ุงูุชุนููุถ', explanation: 'ูุฃู ุงูุชุนููุถ ูููู ูุจุงุดุฑุงู ูุณููุงู.' },
        { level: 'โญโญ', text: 'ุญู ุงููุธุงู: <span class="math-eq">ุณ+ุต=ูค</span> ู <span class="math-eq">ุณ-ุต=ูข</span>ุ', options: ['(ูฃุ ูก)', '(ูขุ ูข)', '(ูคุ ู)', '(ูกุ ูฃ)'], correct: '(ูฃุ ูก)', explanation: 'ุจุงูุฌูุน: ูขุณ=ูฆ => ุณ=ูฃ. ุซู ุจุงูุชุนููุถ ุต=ูก.' },
        { level: 'โญโญโญ', text: 'ูุธุงู ูููู ูู ูุนุงุฏูุชูู ูููุง ููุณ ุงูููู ูููุณ ุงูููุทุน ุงูุตุงุฏู:', options: ['ูุชุณู ููุณุชูู', 'ูุชุณู ูุบูุฑ ูุณุชูู', 'ุบูุฑ ูุชุณู', 'ูุง ูููู ุชุญุฏูุฏ ุฐูู'], correct: 'ูุชุณู ูุบูุฑ ูุณุชูู', explanation: 'ูุฃู ูููุง ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู ูููุทุจูุงู ุนูู ุจุนุถููุง.' }
    ];

    document.addEventListener('DOMContentLoaded', () => {
        studentData = getStudentData();
        buildHeader();
        renderInteractiveChoices();
        renderRealLifeExamples();
        startQuiz();
    });

    function getStudentData() {
        const params = new URLSearchParams(window.location.search);
        const data = {
            id: params.get('studentId') || localStorage.getItem('sId') || null,
            classId: params.get('classId') || localStorage.getItem('cId') || null,
            name: params.get('name') || "ุฒุงุฆุฑ"
        };
        if(data.id) { localStorage.setItem('sId', data.id); localStorage.setItem('cId', data.classId); }
        return data.id ? data : null;
    }

    function buildHeader() {
        const name = studentData ? studentData.name : "ุฒุงุฆุฑ";
        document.getElementById('main-header').innerHTML = `
            <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                <div><h1 class="text-xl font-bold text-blue-800">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h1></div>
                <div class="text-left font-bold text-gray-700">${name}</div>
            </div>`;
    }

    // ุงููุณู ุงูุซุงูู ุงููุทูุฑ ุจุดุฑุญ ุงูุฅุฌุงุจุงุช ุงูุตุญูุญุฉ ูุงูุฎุงุทุฆุฉ
    function renderInteractiveChoices() {
        const challenges = [
            { 
                eq: 'ุต = ูฃุณ + ูก<br>ูขุณ + ุต = ูฉ', 
                correct: 'ุงูุชุนููุถ',
                feedbacks: {
                    'ุงูุชุนููุถ': 'ุตุญูุญ! ูุฃู ุงููุชุบูุฑ (ุต) ูุนุฒูู ูู ุทุฑู ูุญุฏูุ ููุง ูุณูู ุงุณุชุฎุฏุงูู ูุจุงุดุฑุฉ ูู ุงููุนุงุฏูุฉ ุงูุฃุฎุฑู.',
                    'ุงูุญุฐู ุจุงูุฌูุน': 'ุฎุงุทุฆุ ูุฃู ุงููุนุงููุงุช ููุณุช ูุชุนุงูุณุฉุ ูุงูุชุนููุถ ููุง ุฃุณุฑุน ุจูุซูุฑ ููุฌูุฏ (ุต) ุฌุงูุฒุฉ.',
                    'ุงูุญุฐู ุจุงูุทุฑุญ': 'ุฎุงุทุฆุ ูุฃู ุงููุนุงููุงุช ููุณุช ูุชุณุงููุฉุ ูุงูุชุนููุถ ููุง ุณูููุฑ ุนููู ุฎุทูุงุช ุงูุชุฑุชูุจ.',
                    'ุงูุญุฐู ุจุงูุถุฑุจ': 'ุฎุงุทุฆุ ุงูุถุฑุจ ูุณุชุฎุฏู ุนูุฏูุง ูุง ููุฌุฏ ูุนุงูู ูกุ ูููุง (ุต) ูุนุงูููุง ูก ููุนุฒููุฉุ ููุง ุฏุงุนู ููุถุฑุจ.'
                }
            },
            { 
                eq: 'ูคุณ - ุต = ูฅ<br>ูคุณ + ุต = ูกูก', 
                correct: 'ุงูุญุฐู ุจุงูุฌูุน',
                feedbacks: {
                    'ุงูุญุฐู ุจุงูุฌูุน': 'ุตุญูุญ! ูุฃู ูุนุงูู (ุต) ูู (-ูก) ู (+ูก)ุ ูููุง ูุนููุณุงู ุฌูุนูุงู ูุฎุชููุงู ูุจุงุดุฑุฉ ุจุงูุฌูุน.',
                    'ุงูุชุนููุถ': 'ุฎุงุทุฆุ ูุง ููุฌุฏ ูุชุบูุฑ ูุนุฒูู ุญุงููุงูุ ูุงูุญุฐู ุจุงูุฌูุน ูุนุทูู ุงูุญู ูู ุฎุทูุฉ ูุงุญุฏุฉ ุฏูู ุญุงุฌุฉ ูุนุฒู ูุชุบูุฑ.',
                    'ุงูุญุฐู ุจุงูุทุฑุญ': 'ุฎุงุทุฆุ ุจุงูุฑุบู ูู ุฃูู ูุญุฐู ุณุ ุฅูุง ุฃู ุงูุฌูุน ุฃุณูู ููุง ูุชุฌูุจ ุฃุฎุทุงุก ุงูุฅุดุงุฑุงุช ุงูุชู ูุฏ ุชูุน ูุน ุงูุทุฑุญ.',
                    'ุงูุญุฐู ุจุงูุถุฑุจ': 'ุฎุงุทุฆุ ูุง ุญุงุฌุฉ ููุถุฑุจ ูุชุบููุฑ ุงูุฃุฑูุงู ูุง ุฏุงูุช ุงููุนุงุฏูุชุงู ุฌุงูุฒุชูู ููุญุฐู ุจุงูุฌูุน ูุจุงุดุฑุฉ.'
                }
            },
            { 
                eq: 'ูฃุณ + ูขุต = ูจ<br>ูฃุณ - ูฅุต = ูก', 
                correct: 'ุงูุญุฐู ุจุงูุทุฑุญ',
                feedbacks: {
                    'ุงูุญุฐู ุจุงูุทุฑุญ': 'ุตุญูุญ! ูุฃู ูุนุงูู (ุณ) ูู ุงููุนุงุฏูุชูู ูู (ูฃ)ุ ูุทุฑุญููุง ูุญุฐู (ุณ) ููุฑุงู ููุชุฑู ูู ูุฌูููุงู ูุงุญุฏุงู.',
                    'ุงูุชุนููุถ': 'ุฎุงุทุฆุ ูุง ููุฌุฏ ูุชุบูุฑ ูุนุงููู ูก ููุนุฒู ุจุณูููุฉุ ุณุชุญุชุงุฌ ูุงุณุชุฎุฏุงู ุงููุณูุฑ ุฅุฐุง ุงุฎุชุฑุช ุงูุชุนููุถ ููุง.',
                    'ุงูุญุฐู ุจุงูุฌูุน': 'ุฎุงุทุฆุ ุงูุฌูุน ููุง ูู ูุญุฐู ุฃู ูุชุบูุฑ ูุฃู ุงููุนุงููุงุช ููุณุช ูุนููุณุฉ ุฌูุนูุงู (ูฃ+ูฃ = ูฆ ูููุณ ู).',
                    'ุงูุญุฐู ุจุงูุถุฑุจ': 'ุฎุงุทุฆุ ูุง ุญุงุฌุฉ ูุถุฑุจ ุงููุนุงุฏูุงุช ูุชูุจูุฑ ุงูุฃุฑูุงู ูุง ุฏุงู (ุณ) ุฌุงูุฒ ููุญุฐู ุจุงูุทุฑุญ ุงููุจุงุดุฑ.'
                }
            },
            { 
                eq: 'ูขุณ + ูฃุต = ูง<br>ูฅุณ + ูคุต = ูกูข', 
                correct: 'ุงูุญุฐู ุจุงูุถุฑุจ',
                feedbacks: {
                    'ุงูุญุฐู ุจุงูุถุฑุจ': 'ุตุญูุญ! ูุฃูู ูุง ููุฌุฏ ูุชุบูุฑ ูุนุงููู ูกุ ููุง ุชูุฌุฏ ูุนุงููุงุช ูุชุณุงููุฉ ุฃู ูุชุนุงูุณุฉุ ูุฐุง ุงูุถุฑุจ ุถุฑูุฑู.',
                    'ุงูุชุนููุถ': 'ุฎุงุทุฆุ ุงุฎุชูุงุฑ ุงูุชุนููุถ ููุง ุณูุนูุฏ ุงูุญู ุฌุฏุงู ุจุณุจุจ ุธููุฑ ุงููุณูุฑ ุนูุฏ ุนุฒู ุฃู ูุชุบูุฑ.',
                    'ุงูุญุฐู ุจุงูุฌูุน': 'ุฎุงุทุฆุ ุงูุฌูุน ุงููุจุงุดุฑ ูู ูุญุฐู ุฃู ูุชุบูุฑ ูุฃู ุงูุฃุฑูุงู ูุฎุชููุฉ ุชูุงูุงู.',
                    'ุงูุญุฐู ุจุงูุทุฑุญ': 'ุฎุงุทุฆุ ุงูุทุฑุญ ุงููุจุงุดุฑ ูู ูุญุฐู ุฃู ูุชุบูุฑ ูุฃู ุงููุนุงููุงุช ุบูุฑ ูุชุณุงููุฉ.'
                }
            }
        ];
        const container = document.getElementById('choice-container');
        challenges.forEach((c, i) => {
            container.innerHTML += `
                <div class="bg-white p-4 rounded-lg shadow border border-gray-100">
                    <div class="text-center mb-4"><span class="math-eq eq-color-3">${c.eq}</span></div>
                    <div class="grid grid-cols-2 gap-2">
                        ${Object.keys(c.feedbacks).map(opt => `
                            <button onclick="checkQuickChallenge(${i}, '${opt}', '${c.correct}', \`${c.feedbacks[opt]}\`)" class="bg-blue-100 text-blue-800 p-2 rounded text-sm hover:bg-blue-200 transition">${opt}</button>
                        `).join('')}
                    </div>
                    <div id="quick-feedback-${i}" class="mt-3 p-2 rounded text-center text-xs font-bold hidden border"></div>
                </div>`;
        });
    }

    function checkQuickChallenge(idx, selected, correct, feedbackText) {
        const fb = document.getElementById(`quick-feedback-${idx}`);
        fb.classList.remove('hidden');
        fb.innerHTML = feedbackText;
        
        if(selected === correct) {
            fb.className = "mt-3 p-2 rounded text-center text-xs font-bold text-green-700 bg-green-50 border-green-200";
        } else {
            fb.className = "mt-3 p-2 rounded text-center text-xs font-bold text-red-700 bg-red-50 border-red-200";
        }
    }

    function renderRealLifeExamples() {
        const examples = [
            { id: 'shop', title: '๐ ุงูุชุณูู', problem: 'ูค ูุฑุงุณุงุช ูุญููุจุฉ ุจู ูกูู ุฑูุงูุ ููุฑุงุณุชุงู ูุญููุจุฉ ุจู ูฆู ุฑูุงู. ูุง ุซูู ุงููุฑุงุณุฉุ', steps: ['ุงููุนุงุฏูุงุช: ูคู+ุญ=ูกูู ุ ูขู+ุญ=ูฆู', 'ูุณุชุฎุฏู ุงูุญุฐู ุจุงูุทุฑุญ ูุฃู ูุนุงูู ุญ ูุชุณุงูู.', 'ุจุงูุทุฑุญ: ูขู = ูคู ุฑูุงู.', 'ุฅุฐู ุงููุฑุงุณุฉ ุงููุงุญุฏุฉ ุจู ูขู ุฑูุงู.'] }
        ];
        const container = document.getElementById('apps-container');
        examples.forEach(ex => {
            container.innerHTML += `
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="font-bold text-blue-700 mb-2">${ex.title}</h3>
                    <p class="text-gray-600 mb-4 bg-blue-50 p-3 rounded-lg">${ex.problem}</p>
                    <div id="steps-${ex.id}" class="space-y-2 mb-4"></div>
                    <button onclick="nextStep('${ex.id}', ${JSON.stringify(ex.steps).replace(/"/g, '&quot;')})" id="btn-${ex.id}" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm">ุฃุธูุฑ ุงูุฎุทูุฉ ุงูุชุงููุฉ</button>
                </div>`;
        });
    }

    let stepIdx = { shop: 0 };
    function nextStep(id, steps) {
        if(stepIdx[id] < steps.length) {
            const div = document.createElement('div');
            div.className = "step-box";
            div.innerHTML = steps[stepIdx[id]];
            document.getElementById(`steps-${id}`).appendChild(div);
            stepIdx[id]++;
        }
        if(stepIdx[id] >= steps.length) document.getElementById(`btn-${id}`).classList.add('hidden');
    }

    let activeQuestions = [];
    function startQuiz() {
        activeQuestions = [...QUESTION_BANK].sort(() => 0.5 - Math.random()).slice(0, 5);
        const form = document.getElementById('quizForm');
        form.innerHTML = activeQuestions.map((q, i) => `
            <div class="p-5 bg-white border border-gray-200 rounded-xl shadow-sm">
                <p class="font-bold mb-4">${i+1}. <span class="text-blue-600">${q.level}</span> ${q.text}</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    ${q.options.map((opt, oi) => `
                        <div>
                            <input type="radio" name="q${i}" value="${opt}" id="q${i}_o${oi}">
                            <label for="q${i}_o${oi}" class="option-label text-sm font-semibold">${opt}</label>
                        </div>
                    `).join('')}
                </div>
                <div id="fb-${i}" class="hidden mt-3 p-2 rounded-lg text-xs font-bold"></div>
                <button type="button" onclick="showHint(${i})" id="hint-${i}" class="hidden mt-2 text-blue-500 text-xs underline">ุดุฑุญ ุงูุญู</button>
            </div>
        `).join('') + `<button type="submit" id="submit-quiz" class="w-full bg-green-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-green-700 shadow-lg">ุฅุฑุณุงู ุงูุฅุฌุงุจุงุช ุงูููุงุฆูุฉ</button>`;
        form.onsubmit = handleQuizSubmit;
    }

    function handleQuizSubmit(e) {
        e.preventDefault();
        let score = 0;
        activeQuestions.forEach((q, i) => {
            const selected = e.target.elements[`q${i}`]?.value;
            const fb = document.getElementById(`fb-${i}`);
            fb.classList.remove('hidden');
            if (selected === q.correct) {
                score++;
                fb.innerHTML = "โ ุฅุฌุงุจุฉ ุตุญูุญุฉ"; fb.className = "mt-3 p-2 rounded-lg bg-green-50 text-green-700 text-xs font-bold";
            } else {
                fb.innerHTML = `โ ุฎุทุฃ. ุงูุตุญูุญ: ${q.correct}`; fb.className = "mt-3 p-2 rounded-lg bg-red-50 text-red-700 text-xs font-bold";
            }
            document.getElementById(`hint-${i}`).classList.remove('hidden');
        });

        const grade = (score / 5) * 10;
        document.getElementById('results-area').classList.remove('hidden');
        const scoreDisp = document.getElementById('score-display');
        scoreDisp.textContent = `${grade} / 10`;
        scoreDisp.setAttribute('dir', 'ltr');

        if (studentData) saveResult(grade);
        document.getElementById('submit-quiz').disabled = true;
        document.getElementById('submit-quiz').classList.add('opacity-50');
    }

    function saveResult(grade) {
        const status = document.getElementById('save-status');
        status.innerHTML = "โณ ุฌุงุฑู ุญูุธ ุงูุฏุฑุฌุฉ...";
        status.className = "py-2 px-4 bg-blue-100 text-blue-700";
        const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentData.id}&classId=${studentData.classId}&lessonId=c5_l5&grade=${grade}`;
        fetch(url).then(() => {
            status.innerHTML = "โ ุชู ุญูุธ ูุชูุฌุชู ูู ุงูููุตุฉ";
            status.className = "py-2 px-4 bg-green-100 text-green-700";
        }).catch(() => {
            status.innerHTML = "โ๏ธ ูุดู ุงูุญูุธุ ุตููุฑ ุงูุดุงุดุฉ ูููุนูู";
            status.className = "py-2 px-4 bg-red-100 text-red-700";
        });
    }

    function showHint(i) {
        document.getElementById('modal-title').innerHTML = "ุดุฑุญ ุงูุณุคุงู " + (i+1);
        document.getElementById('modal-body').innerHTML = activeQuestions[i].explanation;
        document.getElementById('modal').classList.remove('hidden');
    }

    function closeModal() { document.getElementById('modal').classList.add('hidden'); }
    </script>
</body>
</html>
