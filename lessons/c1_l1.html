<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุฏุฑุณ ูก-ูก: ุงููุนุงุฏูุงุช | ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-change { color: #ef4444; font-weight: bold; }
        .math-eq {
            color: #4338ca;
            font-weight: 900; /* ุฎุท ุนุฑูุถ ุฌุฏุงู */
            font-family: 'Courier New', Courier, monospace; /* ุฎุท ูุฎุชูู ููุงุถุญ */
            display: inline-block;
            font-size: 1.2em; /* ุชู ุชุตุบูุฑ ุงูุฎุท ููููุงู */
            padding: 0 4px; /* ุฒูุงุฏุฉ ุงููุณุงุญุฉ ุญูู ุงูุญุฑู */
            vertical-align: -3px; /* ุชุนุฏูู ุงููุญุงุฐุงุฉ ุงูุนููุฏูุฉ ูุชูุงุณุจ ุงูุญุฌู ุงูุฌุฏูุฏ */
            border: 1px solid #ddd; /* ุฅุถุงูุฉ ุฅุทุงุฑ ุฎููู ููุชูููุฒ */
            background-color: #f7f7f9; /* ุฎูููุฉ ุจููู ูุฎุชูู ููููุงู */
            border-radius: 4px;
        }
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .substitution-value {
            color: #c026d3; /* fuchsia-600 */
            font-weight: bold;
            padding: 1px 4px;
            border-radius: 4px;
            background-color: #fce7f3; /* pink-100 */
        }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
        /* Styles for explanation modal AND interactive examples */
        .explanation-step {
            text-align: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .explanation-comment {
            color: #6b7280; /* gray-500 */
            font-size: 0.9em;
            font-family: 'Cairo', sans-serif;
            font-weight: normal;
            display: block;
            margin-bottom: 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">ุงูุฏุฑุณ ูก-ูก: ุงููุนุงุฏูุงุช</h1>
                </header>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ก ุฃููุงู: ุงูููููู ุงูุฃุณุงุณู</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h3 class="font-bold text-lg mb-2">ุงูููุฑุฏุงุช ุงูุฃุณุงุณูุฉ:</h3>
                            <ul class="list-inside space-y-3">
                                <li><span class="vocab-term">ุงูุฌููุฉ ุงูููุชูุญุฉ:</span> ูู ุฌููุฉ ุฑูุงุถูุฉ ุชุญุชูู ุนูู ูุชุบูุฑุ ูุซู: <span class="math-eq">ุณ + ูฃ = ูง</span> ุฃู <span class="math-eq">ุต + ูฃ</span>.</li>
                                <li><span class="vocab-term">ุงููุนุงุฏูุฉ:</span> ูู ููุน ุฎุงุต ูู ุงูุฌูู ุงูููุชูุญุฉุ ุญูุซ ูุฌุจ ุฃู ุชุญุชูู ุนูู ุฅุดุงุฑุฉ ุงููุณุงูุงุฉ (<span class="math-eq">=</span>).</li>
                                <li><span class="vocab-term">ูุฌููุนุฉ ุงูุชุนููุถ:</span> ูู ูุฌููุนุฉ ูู ุงูุฃุนุฏุงุฏ ุงูุชู ูุนูุถ ุจูุง ุนู ูููุฉ ุงููุชุบูุฑ.</li>
                                <li><span class="vocab-term">ูุฌููุนุฉ ุงูุญู:</span> ูู ูุฌููุนุฉ ุงูุนูุงุตุฑ ูู ูุฌููุนุฉ ุงูุชุนููุถ ุงูุชู ุชุฌุนู ุงููุนุงุฏูุฉ ุตุญูุญุฉ.</li>
                                <li><span class="vocab-term">ุงููุชุทุงุจูุฉ:</span> ูู ูุนุงุฏูุฉ ุชููู ุตุญูุญุฉ ูู <strong>ุฌููุน</strong> ููู ุงููุชุบูุฑ ุงูุชู ูุนูุถ ุจูุง. ูุซุงู: <span class="math-eq">ูข(ุณ + ูฃ) = ูขุณ + ูฆ</span>. ูููุง ูุงูุช ูููุฉ ุณุ ุณูุจูู ุทุฑูุง ุงููุนุงุฏูุฉ ูุชุณุงูููู.</li>
                            </ul>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg mt-4">
                            <h4 class="font-bold text-lg mb-2 text-red-800">ูุชู ูุง ูููู ูููุนุงุฏูุฉ ุญูุ (ุงููุนุงุฏูุฉ ุงููุณุชุญููุฉ)</h4>
                            <p>ูุง ูููู ูููุนุงุฏูุฉ ุญู ุนูุฏูุง ุชุคุฏู ุชุจุณูุทุงุชูุง ุฅูู ุนุจุงุฑุฉ ุฎุงุทุฆุฉ ุฏุงุฆูุงูุ ุจุบุถ ุงููุธุฑ ุนู ูููุฉ ุงููุชุบูุฑ. ูุซุงู: <span class="math-eq">ุณ + ูฅ = ุณ + ูก</span>. ุฅุฐุง ุทุฑุญูุง 'ุณ' ูู ุงูุทุฑูููุ ูุญุตู ุนูู <span class="math-eq">ูฅ = ูก</span>ุ ููู ุนุจุงุฑุฉ ุฎุงุทุฆุฉ. ูุฐุงุ ูุง ููุฌุฏ ุฃู ูููุฉ ูููุชุบูุฑ 'ุณ' ูููู ุฃู ุชุฌุนู ูุฐู ุงููุนุงุฏูุฉ ุตุญูุญุฉุ ูุชููู ูุฌููุนุฉ ุงูุญู ูู ุงููุฌููุนุฉ ุงูุฎุงููุฉ { }.</p>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ฏ ุซุงููุงู: ุฃูุซูุฉ ุชูุงุนููุฉ</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div class="grid grid-cols-1 gap-8">
                            <!-- Example 1 Start -->
                            <div id="interactive-container-1" class="p-4 bg-white rounded-lg">
                                <p class="text-lg font-semibold mb-4">ูุซุงู ูก: ุญู ุงููุนุงุฏูุฉ <span class="math-eq">ู + ูฅ = ูง</span>ุ ุฅุฐุง ูุงูุช ูุฌููุนุฉ ุงูุชุนููุถ ูู <span class="math-eq">{ูกุ ูขุ ูฃุ ูค}</span>.</p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 1: ุงูุชุนููุถ</h4><p>ูุนูุถ ุนู ุงููุชุบูุฑ <span class="math-eq">ู</span> ุจูู ุนูุตุฑ ูู ูุฌููุนุฉ ุงูุชุนููุถ.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-1"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุงูุชุญูู (ู=1)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">ูููุฉ ู</th><th class="p-2">ุงูุชุนููุถ ูู <span class="math-eq">ู+ูฅ</span></th><th class="p-2">ุงููุชูุฌุฉ</th><th class="p-2">ุตุญูุญุฉุ</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">ูก</span></td><td><span class="math-eq"><span class="substitution-value">ูก</span> + ูฅ</span></td><td><span class="math-eq">ูฆ</span></td><td><span class="text-red-600 font-bold">ุฎุทุฃ</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-1"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุงูุชุญูู (ู=2)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">ูููุฉ ู</th><th class="p-2">ุงูุชุนููุถ ูู <span class="math-eq">ู+ูฅ</span></th><th class="p-2">ุงููุชูุฌุฉ</th><th class="p-2">ุตุญูุญุฉุ</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">ูก</span></td><td><span class="math-eq">ูก + ูฅ</span></td><td><span class="math-eq">ูฆ</span></td><td><span class="text-red-600 font-bold">ุฎุทุฃ</span></td></tr><tr class="border-b bg-green-50"><td><span class="math-eq">ูข</span></td><td><span class="math-eq"><span class="substitution-value">ูข</span> + ูฅ</span></td><td><span class="math-eq">ูง</span></td><td><span class="text-green-600 font-bold">โ</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-1"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุงูุชุญูู (ู=3)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">ูููุฉ ู</th><th class="p-2">ุงูุชุนููุถ ูู <span class="math-eq">ู+ูฅ</span></th><th class="p-2">ุงููุชูุฌุฉ</th><th class="p-2">ุตุญูุญุฉุ</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">ูก</span></td><td><span class="math-eq">ูก + ูฅ</span></td><td><span class="math-eq">ูฆ</span></td><td><span class="text-red-600 font-bold">ุฎุทุฃ</span></td></tr><tr class="border-b bg-green-50"><td><span class="math-eq">ูข</span></td><td><span class="math-eq">ูข + ูฅ</span></td><td><span class="math-eq">ูง</span></td><td><span class="text-green-600 font-bold">โ</span></td></tr><tr class="border-b"><td><span class="math-eq">ูฃ</span></td><td><span class="math-eq"><span class="substitution-value">ูฃ</span> + ูฅ</span></td><td><span class="math-eq">ูจ</span></td><td><span class="text-red-600 font-bold">ุฎุทุฃ</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-1"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุงูุชุญูู (ู=4)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">ูููุฉ ู</th><th class="p-2">ุงูุชุนููุถ ูู <span class="math-eq">ู+ูฅ</span></th><th class="p-2">ุงููุชูุฌุฉ</th><th class="p-2">ุตุญูุญุฉุ</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">ูก</span></td><td><span class="math-eq">ูก + ูฅ</span></td><td><span class="math-eq">ูฆ</span></td><td><span class="text-red-600 font-bold">ุฎุทุฃ</span></td></tr><tr class="border-b bg-green-50"><td><span class="math-eq">ูข</span></td><td><span class="math-eq">ูข + ูฅ</span></td><td><span class="math-eq">ูง</span></td><td><span class="text-green-600 font-bold">โ</span></td></tr><tr class="border-b"><td><span class="math-eq">ูฃ</span></td><td><span class="math-eq">ูฃ + ูฅ</span></td><td><span class="math-eq">ูจ</span></td><td><span class="text-red-600 font-bold">ุฎุทุฃ</span></td></tr><tr><td><span class="math-eq">ูค</span></td><td><span class="math-eq"><span class="substitution-value">ูค</span> + ูฅ</span></td><td><span class="math-eq">ูฉ</span></td><td><span class="text-red-600 font-bold">ุฎุทุฃ</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ: ุงูุญู ุงูููุงุฆู</h4><p>ูุฌุฏูุง ุฃู ุงููููุฉ ุงูุชู ุชุฌุนู ุงููุนุงุฏูุฉ ุตุญูุญุฉ ูู <span class="math-eq">ูข</span>. ุฅุฐูุ <span class="vocab-term">ูุฌููุนุฉ ุงูุญู</span> ูู <span class="math-eq">{ูข}</span>.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                    <div>
                                        <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                        <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                    </div>
                                </div>
                            </div>
                             <!-- Example 2 Start -->
                            <div id="interactive-container-2" class="p-4 bg-white rounded-lg">
                                <p class="text-lg font-semibold mb-4">ูุซุงู ูข: ุฃูุฌุฏ ูุฌููุนุฉ ุญู ุงููุนุงุฏูุฉ <span class="math-eq">ุต = ูจ - ูขุณ</span>ุ ุฅุฐุง ูุงู <span class="math-eq">ุณ โ {ูกุ ูขุ ูฃ}</span>.</p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 1: ุฅูุดุงุก ุฌุฏูู</h4><p>ููุธู ุงูุญู ุจุฅูุดุงุก ุฌุฏูู ููุนูุถ ุนู ูู ูููุฉ ูู <span class="math-eq">ุณ</span> ูุฅูุฌุงุฏ ูููุฉ <span class="math-eq">ุต</span> ุงูููุงุจูุฉ.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-2"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุงูุชุนููุถ (ุณ=1)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">ุณ</th><th class="p-2">ุงูุชุนููุถ ูู <span class="math-eq">ูจ-ูขุณ</span></th><th class="p-2">ุต</th><th class="p-2">ุงูุญู (ุณุุต)</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">ูก</span></td><td><span class="math-eq">ูจ - ูข(<span class="substitution-value">ูก</span>)</span></td><td><span class="math-eq">ูฆ</span></td><td><span class="math-eq">(ูกุ ูฆ)</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-2"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุงูุชุนููุถ (ุณ=2)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">ุณ</th><th class="p-2">ุงูุชุนููุถ ูู <span class="math-eq">ูจ-ูขุณ</span></th><th class="p-2">ุต</th><th class="p-2">ุงูุญู (ุณุุต)</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">ูก</span></td><td><span class="math-eq">ูจ - ูข(ูก)</span></td><td><span class="math-eq">ูฆ</span></td><td><span class="math-eq">(ูกุ ูฆ)</span></td></tr><tr class="border-b"><td><span class="math-eq">ูข</span></td><td><span class="math-eq">ูจ - ูข(<span class="substitution-value">ูข</span>)</span></td><td><span class="math-eq">ูค</span></td><td><span class="math-eq">(ูขุ ูค)</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-2"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุงูุชุนููุถ (ุณ=3)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">ุณ</th><th class="p-2">ุงูุชุนููุถ ูู <span class="math-eq">ูจ-ูขุณ</span></th><th class="p-2">ุต</th><th class="p-2">ุงูุญู (ุณุุต)</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">ูก</span></td><td><span class="math-eq">ูจ - ูข(ูก)</span></td><td><span class="math-eq">ูฆ</span></td><td><span class="math-eq">(ูกุ ูฆ)</span></td></tr><tr class="border-b"><td><span class="math-eq">ูข</span></td><td><span class="math-eq">ูจ - ูข(ูข)</span></td><td><span class="math-eq">ูค</span></td><td><span class="math-eq">(ูขุ ูค)</span></td></tr><tr><td><span class="math-eq">ูฃ</span></td><td><span class="math-eq">ูจ - ูข(<span class="substitution-value">ูฃ</span>)</span></td><td><span class="math-eq">ูข</span></td><td><span class="math-eq">(ูฃุ ูข)</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ: ุงูุญู ุงูููุงุฆู</h4><p><span class="vocab-term">ูุฌููุนุฉ ุงูุญู</span> ูู ูุฌููุนุฉ ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉ: <span class="math-eq">{(ูกุ ูฆ)ุ (ูขุ ูค)ุ (ูฃุ ูข)}</span>.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                    <div>
                                        <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                        <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Example 3 Start -->
                            <div id="interactive-container-3" class="p-4 bg-white rounded-lg">
                                <p class="text-lg font-semibold mb-4">ูุซุงู ูฃ: ูู ุงููุนุงุฏูุฉ <span class="math-eq">ูฃ(ุณ + ูข) = ูฃุณ + ูฆ</span> ูุชุทุงุจูุฉุ</p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงููุนุงุฏูุฉ ุงูุฃุตููุฉ</h4><div class="explanation-step justify-center mt-2"><span class="math-eq">ูฃ(ุณ + ูข) = ูฃุณ + ูฆ</span></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 1: ุชุจุณูุท ุงูุทุฑู ุงูุฃูุณุฑ</h4><div class="text-center mt-2"><p class="explanation-comment mb-1">ุจุงุณุชุฎุฏุงู ุฎุงุตูุฉ ุงูุชูุฒูุน</p><span class="math-eq"><span class="highlight-change">ูฃ ร ุณ</span> + <span class="highlight-change">ูฃ ร ูข</span> = ูฃุณ + ูฆ</span></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุงูููุงุฑูุฉ</h4><div class="text-center mt-2"><p class="explanation-comment mb-1">ุงูุทุฑูุงู ูุชุทุงุจูุงู</p><span class="math-eq">ูฃุณ + ูฆ = ูฃุณ + ูฆ</span></div></div>
                                    <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ: ุงูุงุณุชูุชุงุฌ</h4><p>ุจูุง ุฃู ุทุฑูู ุงููุนุงุฏูุฉ ูุชุทุงุจูุงู ุชูุงููุงุ ููู <span class="vocab-term">ูุชุทุงุจูุฉ</span>. ูุฌููุนุฉ ุงูุญู ูู ุฌููุน ุงูุฃุนุฏุงุฏ ุงูุญููููุฉ.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                    <div>
                                        <button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                        <button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                    </div>
                                </div>
                            </div>
                            <!-- Example 4 Start -->
                            <div id="interactive-container-4" class="p-4 bg-white rounded-lg">
                                <p class="text-lg font-semibold mb-4">ูุซุงู ูค: ูู ูููุนุงุฏูุฉ <span class="math-eq">ูฅุณ + ูฃ = ูฅุณ + ูง</span> ุญูุ</p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงููุนุงุฏูุฉ ุงูุฃุตููุฉ</h4><div class="text-center mt-2"><span class="math-eq">ูฅุณ + ูฃ = ูฅุณ + ูง</span></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 1: ุนุฒู ุงููุชุบูุฑ</h4><div class="text-center mt-2"><p class="explanation-comment mb-1">ุจุทุฑุญ ูฅุณ ูู ุงูุทุฑููู</p><span class="math-eq">ูฅุณ <span class="highlight-change">- ูฅุณ</span> + ูฃ = ูฅุณ <span class="highlight-change">- ูฅุณ</span> + ูง</span></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุงูุชุจุณูุท</h4><div class="text-center mt-2"><p class="explanation-comment mb-1">ุนุจุงุฑุฉ ุฎุงุทุฆุฉ</p><span class="math-eq">ูฃ = ูง</span></div></div>
                                    <div class="step-interactive p-4 bg-red-200 rounded-lg step-box border-red-600"><h4 class="font-bold">ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ: ุงูุงุณุชูุชุงุฌ</h4><p>ุจูุง ุฃู ุงูุนุจุงุฑุฉ <span class="math-eq">ูฃ = ูง</span> ุฎุงุทุฆุฉ ุฏุงุฆููุงุ ููุฐู ุงููุนุงุฏูุฉ <span class="vocab-term">ูุณุชุญููุฉ ุงูุญู</span>. ูุฌููุนุฉ ุงูุญู ูู ุงููุฌููุนุฉ ุงูุฎุงููุฉ { }.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="4" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                    <div>
                                        <button data-example="4" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                        <button data-example="4" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">โ๏ธ ุฑุงุจุนุงู: ุญุงู ุฏูุฑู! ุงุฎุชุจุฑ ูููู</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">ูุชูุฌุชู ุงูููุงุฆูุฉ</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold" id="modal-title">๐ก ุดุฑุญ ุงูุฅุฌุงุจุฉ</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    // =================================================================================
    // ุฏูุงู ูุดุชุฑูุฉ (ูุง ุชูู ุจุชุนุฏูู ูุฐุง ุงููุณู)
    // =================================================================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h1></a>`; } let userInfoHtml = ''; const backLink = `<a href="../index.html" target="_top" class="text-xs text-blue-600 hover:underline">&larr; ุงูุนูุฏุฉ ุฅูู ุงูููุฑุณ</a>`; if (studentData) { userInfoHtml = `<div class="flex items-center gap-4"><div class="text-right"><span class="font-semibold block">ุฃููุงูุ ${studentData.name}</span>${backLink}</div><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600 self-start">ุฎุฑูุฌ</a></div>`; } else { userInfoHtml = `<div class="text-right"><p class="text-lg text-gray-600">ุฒุงุฆุฑ</p>${backLink}</div>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; const logoutLink = headerContainer.querySelector('#logout-link'); if(logoutLink) { logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); } }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">ยฉ 2024 ุฌููุน ุงูุญููู ูุญููุธุฉ | ุชุตููู ูุชุทููุฑ: ุฃ. ุนุจุฏุงูุนุฒูุฒ ุฎุงูุฏ ุงูุนุจูุงู</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData, studentId, classId) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุชุงุญุฉ ููุฐุง ุงูุฏุฑุณ ุญุงููุงู.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `ุงููุญุงููุงุช ุงููุชุจููุฉ: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); const smartButton = q.smartExplanation ? `<button type="button" id="smart-explain-btn-${index}" class="hidden mt-2 ml-4 text-xs text-purple-600 hover:underline">๐ก ุญู ุฐูู</button>` : ''; return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div class="flex items-center"><button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">ุงุนุฑู ููุงุฐุงุ</button>${smartButton}</div></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">ุชุญูู ูู ุฅุฌุงุจุงุชู</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) { explainBtn.addEventListener('click', () => showExplanation(index, false)); } const smartExplainBtn = document.getElementById(`smart-explain-btn-${index}`); if(smartExplainBtn) { smartExplainBtn.addEventListener('click', () => showExplanation(index, true)); } }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'ูุง ุชูุฌุฏ ูุญุงููุงุช ูุชุจููุฉ'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = 'โ ุฅุฌุงุจุฉ ุตุญูุญุฉ!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden'); const smartBtn = document.getElementById(`smart-explain-btn-${index}`); if(smartBtn) smartBtn.classList.remove('hidden'); }); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentId && classId) { saveGrade(lessonId, finalGrade, studentId, classId); if (attemptsLeft - 1 > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'ุชู ุนุฑุถ ูุชูุฌุชู. ุณุฌู ุงูุฏุฎูู ูุญูุธ ุชูุฏูู.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade, studentId, classId) { if (!studentId || !classId) { console.error("Student ID or Class ID is missing."); return; } const saveStatus = document.getElementById('save-status'); saveStatus.textContent = 'ุฌุงุฑู ุญูุธ ูุชูุฌุชู...'; const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&classId=${classId}&lessonId=${lessonId}&grade=${grade}`; fetch(url) .then(res => res.json()) .then(result => { if (result.status === 'success') { saveStatus.textContent = 'โ ุชู ุญูุธ ูุชูุฌุชู ุจูุฌุงุญ! ุณุชุธูุฑ ูู ููุญุฉ ุงูุชุญูู ุนูุฏ ุงูุนูุฏุฉ.'; const studentData = JSON.parse(localStorage.getItem('currentStudent')); if (studentData && studentData.id === studentId) { if (!studentData.lessons) studentData.lessons = {}; if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; } else { studentData.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(studentData)); } } else { throw new Error(result.message); } }) .catch(error => { saveStatus.textContent = 'โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุฏุฑุฌุฉ.'; console.error("Save Grade Error:", error); }); }
    function showExplanation(questionIndex, isSmart) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); const modalTitle = document.getElementById('modal-title'); const question = currentQuestions[questionIndex]; if(modal && explanationText && modalTitle && question) { if (isSmart && question.smartExplanation) { modalTitle.innerHTML = '๐ก ุงูุญู ุงูุฐูู'; explanationText.innerHTML = `<p class="text-lg">${question.smartExplanation}</p>`; } else { modalTitle.innerHTML = '๐ก ุดุฑุญ ุงูุฅุฌุงุจุฉ'; explanationText.innerHTML = question.explanation; } modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    
    // =================================================================================
    // ูุญุชูู ุงูุฏุฑุณ ุงููุญุฏุฏ (ูุฐุง ุงููุณู ูุชู ุชุนุฏููู ููู ุฏุฑุณ)
    // =================================================================================
    const LESSON_ID = 'c1_l1'; 
    function generateQuiz() { 
        const questionBank = [
            { type: 'mcq', level: 'โญ', topic: 'vocabulary', text: 'ุฃู ูู ุงูุชุงูู ูู ูุซุงู ุนูู ุฌููุฉ ููุชูุญุฉ ูููุณุช ูุนุงุฏูุฉุ', options: [ { display: '<span class="math-eq">ูฅุณ - ูข</span>', value: 'ูฅุณ - ูข' }, { display: '<span class="math-eq">ูฉ + ูง = ูกูฆ</span>', value: 'ูฉ + ูง = ูกูฆ' }, { display: '<span class="math-eq">ูกูข > ูค</span>', value: 'ูกูข > ูค' }, { display: '<span class="math-eq">ุณ = ูฅ</span>', value: 'ุณ = ูฅ' } ], correct: 'ูฅุณ - ูข', explanation: `<p>ุงูุฌููุฉ ุงูููุชูุญุฉ ุชุญุชูู ูุชุบูุฑุงูุ ูููููุง ูุง ุชุญุชูู ุจุงูุถุฑูุฑุฉ ุนูู ุนูุงูุฉ ูุณุงูุงุฉ ูุชููู ูุนุงุฏูุฉ.</p><p class='mt-2 p-2 bg-gray-100 rounded-md'><span class='math-eq'>ูฅุณ - ูข</span> ูู ุฌููุฉ ููุชูุญุฉ ูุฃููุง ุชุนุชูุฏ ุนูู ูููุฉ ุณ.</p>` },
            { type: 'mcq', level: 'โญโญ', topic: 'vocabulary', text: 'ุฅุฐุง ูุงูุช ุงููุนุงุฏูุฉ ูู <span class="math-eq">ุณ + ูค = ูฉ</span> ู<span class="vocab-term">ูุฌููุนุฉ ุงูุชุนููุถ</span> ูู <span class="math-eq">{ูฃ, ูค, ูฅ, ูฆ}</span>ุ ููุง ูู <span class="vocab-term">ูุฌููุนุฉ ุงูุญู</span>ุ', options: [ { display: '<span class="math-eq">{ูฃ}</span>', value: '{ูฃ}' }, { display: '<span class="math-eq">{ูฅ}</span>', value: '{ูฅ}' }, { display: '<span class="math-eq">{ูฃ, ูค, ูฅ}</span>', value: '{ูฃ, ูค, ูฅ}' }, { display: '<span class="math-eq">{ูค}</span>', value: '{ูค}' } ], correct: '{ูฅ}', smartExplanation: "ุจุชุฌุฑุจุฉ ุงูุฎูุงุฑุงุชุ ูุจุฏุฃ ุจุงูุนุฏุฏ ูฅ: ูฅ + ูค = ูฉ. ุฅุฌุงุจุฉ ุตุญูุญุฉ ูุจุงุดุฑุฉ.", explanation: `<p>ูุนูุถ ุจูู ุนูุตุฑ ูู ุงููุนุงุฏูุฉ:</p><ul class='list-disc pr-5 mt-2'><li>ุนูุฏ <span class="math-eq">ุณ=ูฃ</span>: <span class="math-eq">ูฃ+ูค = ูง</span> (ุฎุทุฃ)</li><li>ุนูุฏ <span class="math-eq">ุณ=ูค</span>: <span class="math-eq">ูค+ูค = ูจ</span> (ุฎุทุฃ)</li><li class='text-green-600 font-bold'>ุนูุฏ <span class="math-eq">ุณ=ูฅ</span>: <span class="math-eq">ูฅ+ูค = ูฉ</span> (ุตุญูุญ)</li><li>ุนูุฏ <span class="math-eq">ุณ=ูฆ</span>: <span class="math-eq">ูฆ+ูค = ูกู</span> (ุฎุทุฃ)</li></ul><p class='mt-2 p-2 bg-green-100 rounded-md'>ุฅุฐูุ ูุฌููุนุฉ ุงูุญู ูู <span class="math-eq">{ูฅ}</span>.</p>` },
            { type: 'mcq', level: 'โญ', topic: 'oneVariable', text: 'ุญู ุงููุนุงุฏูุฉ: <span class="math-eq">ุณ - ูค = ูฆ</span>.', options: [ { display: '<span class="math-eq">ูข</span>', value: 'ูข' }, { display: '<span class="math-eq">ูกู</span>', value: 'ูกู' }, { display: '<span class="math-eq">ูขูค</span>', value: 'ูขูค' }, { display: '<span class="math-eq">-ูข</span>', value: '-ูข' } ], correct: 'ูกู', smartExplanation: "ูุง ูู ุงูุนุฏุฏ ุงูุฐู ุฅุฐุง ุทุฑุญูุง ููู ูค ูุนุทู ูฆุ ุจุงูุชุฃููุฏ ูู ูกู.", explanation: `<div class='space-y-3'><div class='explanation-step'><p class='explanation-comment'>ุงููุนุงุฏูุฉ ุงูุฃุตููุฉ</p><span class='math-eq'>ุณ - ูค = ูฆ</span></div><div class='explanation-step'><p class='explanation-comment'>ุจุฅุถุงูุฉ ูค ููุทุฑููู</p><span class='math-eq'>ุณ - ูค <span class='highlight-change'>+ ูค</span> = ูฆ <span class='highlight-change'>+ ูค</span></span></div><div class='explanation-step'><p class='explanation-comment'>ุงูุญู ุงูููุงุฆู</p><span class='math-eq'>ุณ = ูกู</span></div></div>` },
            { type: 'mcq', level: 'โญโญ', topic: 'oneVariable', text: 'ุญู ุงููุนุงุฏูุฉ: <span class="math-eq">ูฃู + ูก = ูกูฆ</span>.', options: [ { display: '<span class="math-eq">ูฅ</span>', value: 'ูฅ' }, { display: '<span class="math-eq">ูฆ</span>', value: 'ูฆ' }, { display: '<span class="math-eq">ูกูฅ</span>', value: 'ูกูฅ' }, { display: '<span class="math-eq">ูค</span>', value: 'ูค' } ], correct: 'ูฅ', smartExplanation: "ููุฑ ุนูุณูุงู: ูกูฆ ูุงูุต ูก ูุณุงูู ูกูฅ. ูุง ุงูุนุฏุฏ ุงูุฐู ูุถุฑุจู ูู ูฃ ููุนุทู ูกูฅุ ุฅูู ูฅ.", explanation: `<div class='space-y-3'><div class='explanation-step'><p class='explanation-comment'>ุงููุนุงุฏูุฉ ุงูุฃุตููุฉ</p><span class='math-eq'>ูฃู + ูก = ูกูฆ</span></div><div class='explanation-step'><p class='explanation-comment'>ุจุทุฑุญ ูก ูู ุงูุทุฑููู</p><span class='math-eq'>ูฃู + ูก <span class='highlight-change'>- ูก</span> = ูกูฆ <span class='highlight-change'>- ูก</span></span></div><div class='explanation-step'><p class='explanation-comment'>ุจุนุฏ ุงูุชุจุณูุท</p><span class='math-eq'>ูฃู = ูกูฅ</span></div><div class='explanation-step'><p class='explanation-comment'>ุจูุณูุฉ ุงูุทุฑููู ุนูู ูฃ</p><span class='math-eq'><span class="fraction"><span>ูฃู</span><span class="frac-bar"></span><span>ูฃ</span></span> = <span class="fraction"><span>ูกูฅ</span><span class="frac-bar"></span><span>ูฃ</span></span></span></div><div class='explanation-step'><p class='explanation-comment'>ุงูุญู ุงูููุงุฆู</p><span class='math-eq'>ู = ูฅ</span></div></div>` },
            { type: 'mcq', level: 'โญโญโญ', topic: 'identity', text: 'ุฃู ูู ุงููุนุงุฏูุงุช ุงูุชุงููุฉ ุชุนุชุจุฑ <span class="vocab-term">ูุชุทุงุจูุฉ</span>ุ', options: [ { display: '<span class="math-eq">ุณ + ูฅ = ูกู</span>', value: 'ุณ + ูฅ = ูกู' }, { display: '<span class="math-eq">ูฃ(ุณ + ูข) = ูฃุณ + ูฆ</span>', value: 'ูฃ(ุณ + ูข) = ูฃุณ + ูฆ' }, { display: '<span class="math-eq">ุณ = ุณ + ูก</span>', value: 'ุณ = ุณ + ูก' }, { display: '<span class="math-eq">ูขุณ = ูจ</span>', value: 'ูขุณ = ูจ' } ], correct: 'ูฃ(ุณ + ูข) = ูฃุณ + ูฆ', smartExplanation: "ุจูุฌุฑุฏ ุงููุธุฑุ ุจุชูุฒูุน ุงูุถุฑุจ ุนูู ุงูููุณ ูู ุงูุฎูุงุฑ ุงูุซุงูู (ูฃ ร ุณ ู ูฃ ร ูข) ูุญุตู ุนูู ูฃุณ + ูฆุ ููู ููุณ ุงูุทุฑู ุงูุขุฎุฑ.", explanation: `<p>ุงููุชุทุงุจูุฉ ูู ูุนุงุฏูุฉ ุตุญูุญุฉ ูุฌููุน ููู ุงููุชุบูุฑ. ุฅุฐุง ูุฒุนูุง ุงูุถุฑุจ ุนูู ุงูุฌูุน ูู ุงูุทุฑู ุงูุฃููู ูู ุงููุนุงุฏูุฉ <span class="math-eq">ูฃ(ุณ + ูข)</span>ุ ูุญุตู ุนูู <span class="math-eq">ูฃุณ + ูฆ</span>ุ ููู ููุณ ุงูุทุฑู ุงูุฃูุณุฑ. ูุฐุง ูู ูุชุทุงุจูุฉ.</p>` },
            { type: 'mcq', level: 'โญโญโญ', topic: 'noSolution', text: 'ูุง ูู ูุฌููุนุฉ ุญู ุงููุนุงุฏูุฉ <span class="math-eq">ู + ูจ = ู - ูข</span>ุ', options: [ { display: '<span class="math-eq">{ูกู}</span>', value: '{ูกู}' }, { display: '<span class="math-eq">{-ูฆ}</span>', value: '{-ูฆ}' }, { display: '<span class="math-eq">{ูู ุงูุฃุนุฏุงุฏ ุงูุญููููุฉ}</span>', value: 'all' }, { display: '<span class="math-eq">{ } (ูุง ููุฌุฏ ุญู)</span>', value: 'none' } ], correct: 'none', smartExplanation: "ูุงุญุธ ุฃู 'ู' ููุฌูุฏุฉ ูู ุงูุทุฑููู. ุฅุฐุง ุญุฐููุงูุงุ ูุชุจูู ูจ = -ูขุ ููุฐุง ูุณุชุญูู. ุฅุฐู ูุง ููุฌุฏ ุญู.", explanation: `<p>ุฅุฐุง ุญุงูููุง ุญู ุงููุนุงุฏูุฉ ูุทุฑุญูุง <span class="math-eq">ู</span> ูู ุงูุทุฑูููุ ุณูุญุตู ุนูู ุงูุนุจุงุฑุฉ ุงูุฎุงุทุฆุฉ <span class="math-eq">ูจ = -ูข</span>. ูุฐุง ูุนูู ุฃูู ูุง ุชูุฌุฏ ูููุฉ ูู <span class="math-eq">ู</span> ุชุฌุนู ุงููุนุงุฏูุฉ ุตุญูุญุฉุ ูุจุงูุชุงูู ููุฌููุนุฉ ุงูุญู ูุงุฑุบุฉ.</p>` },
            { type: 'mcq', level: 'โญโญ', topic: 'oneVariable', text: 'ุญู ุงููุนุงุฏูุฉ: <span class="math-eq">ูกูฅ = ูขุจ - ูฃ</span>.', options: [ { display: '<span class="math-eq">ูฉ</span>', value: 'ูฉ' }, { display: '<span class="math-eq">ูฆ</span>', value: 'ูฆ' }, { display: '<span class="math-eq">ูกูจ</span>', value: 'ูกูจ' }, { display: '<span class="math-eq">-ูฉ</span>', value: '-ูฉ' } ], correct: 'ูฉ', smartExplanation: "ููุฑ ุนูุณูุงู: ูกูฅ ุฒุงุฆุฏ ูฃ ูุณุงูู ูกูจ. ูุง ุงูุนุฏุฏ ุงูุฐู ูุถุฑุจู ูู ูข ููุนุทู ูกูจุ ุฅูู ูฉ.", explanation: `<div class='space-y-3'><div class='explanation-step'><p class='explanation-comment'>ุงููุนุงุฏูุฉ ุงูุฃุตููุฉ</p><span class='math-eq'>ูกูฅ = ูขุจ - ูฃ</span></div><div class='explanation-step'><p class='explanation-comment'>ุจุฅุถุงูุฉ ูฃ ููุทุฑููู</p><span class='math-eq'>ูกูฅ <span class='highlight-change'>+ ูฃ</span> = ูขุจ - ูฃ <span class='highlight-change'>+ ูฃ</span></span></div><div class='explanation-step'><p class='explanation-comment'>ุจุนุฏ ุงูุชุจุณูุท</p><span class='math-eq'>ูกูจ = ูขุจ</span></div><div class='explanation-step'><p class='explanation-comment'>ุจูุณูุฉ ุงูุทุฑููู ุนูู ูข</p><span class='math-eq'><span class="fraction"><span>ูกูจ</span><span class="frac-bar"></span><span>ูข</span></span> = <span class="fraction"><span>ูขุจ</span><span class="frac-bar"></span><span>ูข</span></span></span></div><div class='explanation-step'><p class='explanation-comment'>ุงูุญู ุงูููุงุฆู</p><span class='math-eq'>ูฉ = ุจ</span></div></div>` },
            { type: 'mcq', level: 'โญโญ', topic: 'twoVariables', text: 'ุฅุฐุง ูุงู <span class="math-eq">(ูฃุ ุต)</span> ุญูุงู ูููุนุงุฏูุฉ <span class="math-eq">ุต = ูฅุณ - ูฉ</span>ุ ููุง ูููุฉ <span class="math-eq">ุต</span>ุ', options: [ { display: '<span class="math-eq">ูกูฅ</span>', value: 'ูกูฅ' }, { display: '<span class="math-eq">-ูก</span>', value: '-ูก' }, { display: '<span class="math-eq">ูฆ</span>', value: 'ูฆ' }, { display: '<span class="math-eq">ูขูค</span>', value: 'ูขูค' } ], correct: 'ูฆ', smartExplanation: "ูุนูุถ ูุจุงุดุฑุฉ: ูฅ ุถุฑุจ ูฃ ูุณุงูู ูกูฅุ ุซู ูกูฅ ูุงูุต ูฉ ูุณุงูู ูฆ.", explanation: `<p>ูุนูุถ ุนู ูููุฉ <span class="math-eq">ุณ</span> ุจู <span class="math-eq">ูฃ</span> ูู ุงููุนุงุฏูุฉ:</p><div class='space-y-3 mt-2'><div class='explanation-step'><p class='explanation-comment'>ุงูุชุนููุถ ุนู ูููุฉ ุณ</p><span class='math-eq'>ุต = ูฅ(<span class='substitution-value'>ูฃ</span>) - ูฉ</span></div><div class='explanation-step'><p class='explanation-comment'>ุญุณุงุจ ุญุงุตู ุงูุถุฑุจ</p><span class='math-eq'>ุต = ูกูฅ - ูฉ</span></div><div class='explanation-step'><p class='explanation-comment'>ุงูุญู ุงูููุงุฆู</p><span class='math-eq'>ุต = ูฆ</span></div></div>` },
            { type: 'mcq', level: 'โญโญโญ', topic: 'identity', text: 'ุฃู ุงูุนุจุงุฑุงุช ุงูุชุงููุฉ ุชุฌุนู ุงููุนุงุฏูุฉ <span class="math-eq">ูค(ู - ูก) = ...</span> ูุชุทุงุจูุฉุ', options: [ { display: '<span class="math-eq">ูคู - ูก</span>', value: 'ูคู - ูก' }, { display: '<span class="math-eq">ู - ูค</span>', value: 'ู - ูค' }, { display: '<span class="math-eq">ูคู - ูค</span>', value: 'ูคู - ูค' }, { display: '<span class="math-eq">ูคู</span>', value: 'ูคู' } ], correct: 'ูคู - ูค', smartExplanation: "ุจุชูุฒูุน ุงูุถุฑุจ: ูค ุถุฑุจ ู ูู ูคูุ ู ูค ุถุฑุจ -ูก ูู -ูค. ุฅุฐู ุงูุฅุฌุงุจุฉ ูู ูคู - ูค.", explanation: `<p>ููู ุชููู ุงููุนุงุฏูุฉ ูุชุทุงุจูุฉุ ูุฌุจ ุฃู ูููู ุงูุทุฑูุงู ูุชุณุงูููู. ุจุงุณุชุฎุฏุงู ุฎุงุตูุฉ ุงูุชูุฒูุนุ ูุถุฑุจ ูค ูู ูู ุญุฏ ุฏุงุฎู ุงูููุณ:</p><div class='space-y-3 mt-2'><div class='explanation-step'><p class='explanation-comment'></p><span class='math-eq'>ูค ร ู = ูคู</span></div><div class='explanation-step'><p class='explanation-comment'></p><span class='math-eq'>ูค ร -ูก = -ูค</span></div></div><p class='mt-2'>ุฅุฐูุ ุงูุทุฑู ุงูุขุฎุฑ ูุฌุจ ุฃู ูููู <span class="math-eq">ูคู - ูค</span>.</p>` },
            { type: 'mcq', level: 'โญโญโญ', topic: 'noSolution', text: 'ุญู ุงููุนุงุฏูุฉ <span class="math-eq">ูง + ูขุณ = ูข(ุณ + ูก)</span>.', options: [ { display: '<span class="math-eq">ุณ = ูฅ</span>', value: 'ุณ = ูฅ' }, { display: '<span class="math-eq">{ } (ูุง ููุฌุฏ ุญู)</span>', value: 'none' }, { display: '<span class="math-eq">{ูู ุงูุฃุนุฏุงุฏ ุงูุญููููุฉ}</span>', value: 'all' }, { display: '<span class="math-eq">ุณ = -ูฅ</span>', value: 'ุณ = -ูฅ' } ], correct: 'none', smartExplanation: "ุจูู ุงูููุณ ุงูุฃููู ูุญุตู ุนูู ูขุณ + ูข. ูุงุญุธ ุฃู 'ูขุณ' ููุฌูุฏุฉ ูู ุงูุทุฑููู. ุจุญุฐููุง ูุชุจูู ูง = ูขุ ููุฐุง ูุณุชุญูู.", explanation: `<div class='space-y-3'><div class='explanation-step'><p class='explanation-comment'>ุงููุนุงุฏูุฉ ุงูุฃุตููุฉ</p><span class='math-eq'>ูง + ูขุณ = ูข(ุณ + ูก)</span></div><div class='explanation-step'><p class='explanation-comment'>ุจุชูุฒูุน ุงูุถุฑุจ ุนูู ุงูุฌูุน</p><span class='math-eq'>ูง + ูขุณ = <span class='highlight-change'>ูขุณ + ูข</span></span></div><div class='explanation-step'><p class='explanation-comment'>ุจุทุฑุญ ูขุณ ูู ุงูุทุฑููู</p><span class='math-eq'>ูง + ูขุณ <span class='highlight-change'>- ูขุณ</span> = ูขุณ + ูข <span class='highlight-change'>- ูขุณ</span></span></div><div class='explanation-step'><p class='explanation-comment'>ุนุจุงุฑุฉ ุฎุงุทุฆุฉ</p><span class='math-eq'>ูง = ูข</span></div></div><p class='mt-4'>ุจูุง ุฃู ุงูุนุจุงุฑุฉ ุงูููุงุฆูุฉ ุฎุงุทุฆุฉุ ูุงููุนุงุฏูุฉ ููุณ ููุง ุญู.</p>` },
            { type: 'mcq', level: 'โญ', topic: 'vocabulary', text: 'ูุงุฐุง ุชุณูู ุงููุนุงุฏูุฉ ุงูุชู ุชููู ุตุญูุญุฉ ูุฌููุน ููู ุงููุชุบูุฑุ', options: [ { display: 'ูุนุงุฏูุฉ ูุณุชุญููุฉ', value: 'impossible' }, { display: 'ุฌููุฉ ููุชูุญุฉ', value: 'open' }, { display: 'ูุชุทุงุจูุฉ', value: 'identity' }, { display: 'ูุฌููุนุฉ ุญู', value: 'solution' } ], correct: 'identity', explanation: `<p>ุงููุนุงุฏูุฉ ุงูุชู ุชููู ุตุญูุญุฉ ุฏุงุฆููุงุ ุจุบุถ ุงููุธุฑ ุนู ูููุฉ ุงููุชุบูุฑุ ุชุณูู <span class="vocab-term">ูุชุทุงุจูุฉ</span>.</p>` },
            { type: 'mcq', level: 'โญโญ', topic: 'writing', text: 'ุงุดุชุฑู ุฃุญูุฏ ูุชุงุจูุง ุจุณุนุฑ ูุฒูุฏ ูฅ ุฑูุงูุงุช ุนู ุณุนุฑ ูููู. ุฅุฐุง ูุงู ุณุนุฑ ุงููุชุงุจ ูฃู ุฑูุงูุงูุ ููุง ุงููุนุงุฏูุฉ ุงูุชู ุชูุซู ุณุนุฑ ุงูููู (ู)ุ', options: [ { display: '<span class="math-eq">ู - ูฅ = ูฃู</span>', value: 'ู - ูฅ = ูฃู' }, { display: '<span class="math-eq">ู + ูฅ = ูฃู</span>', value: 'ู + ูฅ = ูฃู' }, { display: '<span class="math-eq">ูฅู = ูฃู</span>', value: 'ูฅู = ูฃู' }, { display: '<span class="math-eq">ู = ูฃู + ูฅ</span>', value: 'ู = ูฃู + ูฅ' } ], correct: 'ู + ูฅ = ูฃู', smartExplanation: "ูููุฉ 'ูุฒูุฏ ูฅ' ุชุนูู ุฃู ุณุนุฑ ุงููุชุงุจ ูู (ุณุนุฑ ุงูููู + ูฅ). ุฅุฐู ูฃู = ู + ูฅ.", explanation: `<p>ุณุนุฑ ุงููุชุงุจ (<span class="math-eq">ูฃู</span>) ูุณุงูู ุณุนุฑ ุงูููู (<span class="math-eq">ู</span>) ูุถุงููุง ุฅููู <span class="math-eq">ูฅ</span>. ูุฐููุ ุงููุนุงุฏูุฉ ุงูุตุญูุญุฉ ูู <span class="math-eq">ู + ูฅ = ูฃู</span>.</p>` }
        ];
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random()); 
        const questionCount = Math.min(shuffled.length, 5); 
        return shuffled.slice(0, questionCount); 
    }

    // =================================================================================
    // ูุดุบู ุงูููุฏ (ูุง ุชูู ุจุชุนุฏูู ูุฐุง ุงููุณู)
    // =================================================================================
    document.addEventListener('DOMContentLoaded', () => { 
        const urlParams = new URLSearchParams(window.location.search);
        const studentId = urlParams.get('studentId');
        const classId = urlParams.get('classId');

        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            state[exampleId] = {
                currentIndex: -1,
                steps: container.querySelectorAll('.step-interactive'),
                placeholder: container.querySelector('.interactive-placeholder'),
                prevBtn: container.querySelector('.prev-btn'),
                nextBtn: container.querySelector('.next-btn'),
                resetBtn: container.querySelector('.reset-btn')
            };

            const steps = state[exampleId].steps;
            const totalSteps = steps.length;

            const updateButtons = () => {
                const isFirstStep = state[exampleId].currentIndex <= -1;
                const isLastStep = state[exampleId].currentIndex >= totalSteps - 1;
                state[exampleId].prevBtn.disabled = isFirstStep;
                if (isLastStep) {
                    state[exampleId].nextBtn.classList.add('hidden');
                    state[exampleId].resetBtn.classList.remove('hidden');
                } else {
                    state[exampleId].nextBtn.classList.remove('hidden');
                    state[exampleId].resetBtn.classList.add('hidden');
                }
            };

            const showState = () => {
                const index = state[exampleId].currentIndex;
                if (index === -1) {
                    if (state[exampleId].placeholder) state[exampleId].placeholder.classList.remove('hidden');
                    steps.forEach(s => s.classList.remove('active'));
                    return;
                }
                
                if (state[exampleId].placeholder) state[exampleId].placeholder.classList.add('hidden');

                const visibleSteps = new Set();
                const lastStepInGroup = {};

                for (let i = 0; i <= index; i++) {
                    const step = steps[i];
                    const group = step.dataset.stepGroup;
                    if (group) {
                        lastStepInGroup[group] = step;
                    } else {
                        visibleSteps.add(step);
                    }
                }
                Object.values(lastStepInGroup).forEach(step => visibleSteps.add(step));

                steps.forEach(step => {
                    if (visibleSteps.has(step)) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                });
            };

            const resetExample = () => {
                state[exampleId].currentIndex = -1;
                showState();
                updateButtons();
            };

            state[exampleId].nextBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex < totalSteps - 1) {
                    state[exampleId].currentIndex++;
                    showState();
                    updateButtons();
                }
            });

            state[exampleId].prevBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex > -1) {
                    state[exampleId].currentIndex--;
                    showState();
                    updateButtons();
                }
            });

            if(state[exampleId].resetBtn) {
                state[exampleId].resetBtn.addEventListener('click', resetExample);
            }
            updateButtons();
        });

        const student = getStudentFromStorage(); 
        const lessonTitleElement = document.getElementById('lesson-title'); 
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null; 
        buildHeader(student, lessonTitle); 
        buildFooter(); 
        const questions = generateQuiz(); 
        initializeQuiz(LESSON_ID, questions, student, studentId, classId); 
        const retakeBtn = document.getElementById('retake-quiz-btn'); 
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); } 
        const closeModalBtn = document.getElementById('closeModalBtn'); 
        if(closeModalBtn) { closeModalBtn.addEventListener('click', closeModal); } 
    });
    </script>
</body>
</html>
