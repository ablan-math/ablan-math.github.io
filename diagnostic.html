<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑุงุช ุงูุฑูุงุถูุงุช ุงูุชุดุฎูุตูุฉ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3498db; --secondary: #2ecc71; --accent: #f1c40f;
            --light: #fdfdfd; --dark: #34495e; --bg-color: #ecf0f1;
            --card-bg: #ffffff; --text-color: #4a4a4a; --header-gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            --score-high: #2ecc71; --score-medium: #f1c40f; --score-low: #e74c3c;
            --points-color: #9b59b6;
        }
        
        body { 
            font-family: 'Cairo', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            line-height: 1.7; 
            margin: 0;
            padding: 0;
        }

        .screen { display: none; }
        .screen.active { display: block; animation: zoomIn 0.6s ease-in-out; }

        @keyframes zoomIn { 
            from { opacity: 0; transform: scale(0.95); } 
            to { opacity: 1; transform: scale(1); } 
        }

        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }

        header {
            background: var(--header-gradient); 
            color: white; 
            padding: 1.5rem 1rem; 
            border-radius: 0 0 35px 35px; 
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1); 
            margin-bottom: 2rem;
            position: relative; 
            overflow: hidden;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-align: right;
            position: relative;
            z-index: 2;
        }

        header::before, header::after {
             z-index: 1;
        }
        
        header::before {
            content: '\f1ec'; 
            font-family: 'Font Awesome 6 Free'; 
            font-weight: 900;
            position: absolute; 
            top: -20px; 
            left: -30px; 
            font-size: 150px; 
            opacity: 0.1; 
            transform: rotate(-15deg);
        }

        header::after {
            content: '\f518'; 
            font-family: 'Font Awesome 6 Free'; 
            font-weight: 900;
            position: absolute; 
            bottom: -30px; 
            right: -20px; 
            font-size: 150px; 
            opacity: 0.1; 
            transform: rotate(15deg);
        }

        header h1 { 
            font-size: 2.5rem; 
            font-weight: 800; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2); 
            margin: 0;
        }

        header p { 
            font-size: 1.2rem; 
            opacity: 0.9; 
            margin-top: 0.25rem; 
            margin-bottom: 0;
        }

        .welcome-container, .dashboard-container, .test-section, .student-progress { 
            background: var(--card-bg); 
            padding: 2.5rem; 
            border-radius: 20px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.08); 
        }

        .btn {
            background-color: var(--primary); 
            color: white; 
            padding: 1rem 3rem; 
            border: none;
            border-radius: 50px; 
            font-size: 1.2rem; 
            font-weight: 700; 
            cursor: pointer;
            transition: all 0.3s ease; 
            display: inline-flex; 
            align-items: center; 
            gap: 0.75rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin: 0.5rem;
            text-decoration: none;
        }

        .btn:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 6px 15px rgba(0,0,0,0.2); 
        }

        .btn:active { 
            transform: translateY(-1px); 
        }
        
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background-color: #95a5a6;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        
        .btn-exit {
            background-color: #e74c3c;
            padding: 0.5rem 1.5rem;
            font-size: 1rem;
        }

        .dashboard-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); 
            gap: 2rem; 
            margin-top: 2rem; 
        }

        .quiz-card {
            background: var(--card-bg); 
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.06); 
            transition: all 0.3s ease;
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
        }

        .quiz-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 12px 30px rgba(0,0,0,0.12); 
        }

        .quiz-card-header { 
            padding: 1.5rem; 
            background: var(--primary); 
            color: white; 
            text-align: center; 
        }

        .quiz-card-header h3 { 
            font-size: 1.6rem; 
            margin: 0; 
        }

        .quiz-card-body { 
            padding: 1.5rem; 
            flex-grow: 1; 
            text-align: center; 
        }

        .best-score-container { 
            margin-bottom: 1rem; 
            padding-bottom: 1rem; 
            border-bottom: 2px dashed #eee; 
        }

        .best-score-container h4 { 
            margin: 0; 
            color: var(--dark); 
            font-size: 1rem; 
        }

        .best-score-container p { 
            font-size: 2rem; 
            font-weight: 800; 
            color: var(--primary); 
            margin: 0.25rem 0 0; 
        }

        .levels-container { 
            display: flex; 
            justify-content: space-around; 
            align-items: flex-start; 
            margin-top: 1rem; 
        }

        .level-wrapper {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .level-bubble {
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            width: 80px; 
            height: 80px; 
            border-radius: 50%; 
            border: 3px solid #eee;
            cursor: pointer; 
            transition: all 0.3s ease;
        }
        
        .level-bubble.disabled {
            cursor: not-allowed;
            background-color: #f8f9f9;
        }

        .level-bubble:hover:not(.disabled) { 
            transform: scale(1.1); 
            border-color: var(--primary); 
        }

        .level-bubble .level-name { 
            font-size: 0.9rem; 
            font-weight: 700; 
        }

        .level-bubble .level-score { 
            font-size: 1.1rem; 
            font-weight: 800; 
            display: flex; 
            align-items: center; 
            gap: 0.3rem; 
        }

        .level-bubble .level-score.not-completed { 
            color: #aaa; 
            font-size: 0.8rem; 
        }

        .level-bubble .score-high { color: var(--score-high); }
        .level-bubble .score-medium { color: var(--score-medium); }
        .level-bubble .score-low { color: var(--score-low); }

        .level-stars {
            position: absolute;
            bottom: -8px;
            left: -8px;
            font-size: 1rem;
            color: var(--accent);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            transform: rotate(-20deg);
            letter-spacing: 1px;
            pointer-events: none;
        }

        .final-average { 
            margin: 2rem 0; 
            padding: 2.5rem; 
            background: var(--header-gradient); 
            color: white; 
            border-radius: 20px; 
            text-align: center; 
            display: none; 
        }

        .final-average h2 { 
            font-size: 2.2rem; 
            margin-bottom: 0.5rem; 
        }

        .final-average p { 
            font-size: 2.8rem; 
            font-weight: 800; 
        }
        
        .student-progress {
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .progress-container {
            width: 100%;
            margin-top: 1rem;
        }

        .progress-bar {
            height: 20px;
            background-color: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--header-gradient);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-text {
            margin-top: 0.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .points-container {
            display: flex;
            align-items: center;
            margin-top: 1rem;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .points-container i {
            color: var(--points-color);
            margin-left: 0.5rem;
        }
        
        .quiz-header {
            text-align: center; 
            margin-bottom: 2rem; 
        }

        .quiz-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .question-counter, .time-counter { 
            font-size: 1.2rem; 
            font-weight: 600; 
            color: #777; 
            padding: 0.5rem 1rem; 
            background: #eee; 
            border-radius: 20px; 
            display: inline-block;
        }

        .time-counter.warning {
            background-color: #f39c12;
            color: white;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .question-text { 
            font-size: 2rem; 
            margin: 1rem 0; 
            min-height: 70px; 
            color: var(--dark); 
        }

        .options-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 1.5rem; 
        }

        .option {
            background: var(--card-bg); 
            padding: 1.5rem; 
            border: 2px solid #ddd; 
            border-radius: 15px;
            cursor: pointer; 
            transition: all 0.3s ease; 
            font-size: 1.3rem;
            display: flex; 
            align-items: center; 
            justify-content: center;
        }

        .option:hover { 
            border-color: var(--primary); 
            transform: scale(1.05); 
        }

        .option.selected { 
            border-color: var(--secondary); 
            background-color: #e8f9f5; 
            transform: scale(1.05); 
        }

        .option.correct { 
            background-color: #d4edda; 
            border-color: var(--score-high); 
            transform: scale(1.05); 
            animation: correct-answer 0.5s ease; 
        }

        .option.incorrect { 
            background-color: #f8d7da; 
            border-color: var(--score-low); 
            animation: incorrect-answer 0.5s ease; 
        }

        @keyframes correct-answer { 
            0%, 100% { transform: scale(1.05); } 
            50% { transform: scale(1.1); } 
        }

        @keyframes incorrect-answer { 
            0%, 100% { transform: translateX(0); } 
            25% { transform: translateX(-10px); } 
            75% { transform: translateX(10px); } 
        }

        .quiz-nav { 
            margin-top: 2rem; 
            display: flex; 
            justify-content: center;
            gap: 1rem;
        }

        .explanation { 
            margin-top: 2rem; 
            padding: 1.5rem; 
            background-color: #fffbe6; 
            border-right: 5px solid var(--accent); 
            border-radius: 10px; 
            text-align: right; 
            display: none; 
        }

        .explanation h4 { 
            font-size: 1.3rem; 
            color: var(--accent); 
            margin-bottom: 0.5rem; 
        }

        .result-box { 
            text-align: center; 
            padding: 3rem; 
            position: relative; 
        }

        .result-box .result-icon { 
            font-size: 8rem; 
            color: var(--accent); 
            margin-bottom: 1rem; 
            animation: trophy-animation 1s ease-out; 
        }

        @keyframes trophy-animation { 
            from { transform: translateY(-50px) scale(0.5); opacity: 0; } 
            to { transform: translateY(0) scale(1); opacity: 1; } 
        }

        .result-box h2 { 
            font-size: 2.8rem; 
            color: var(--primary); 
        }

        .result-box p { 
            font-size: 3.5rem; 
            font-weight: 800; 
            color: var(--secondary); 
            margin: 1rem 0; 
        }

        .points-earned {
            font-size: 1.5rem;
            color: var(--points-color);
            margin: 1rem 0;
            font-weight: bold;
        }

        .fraction { 
            display: inline-flex; 
            flex-direction: column; 
            align-items: center; 
            vertical-align: middle; 
            margin: 0 0.2em; 
            line-height: 1; 
        }

        .fraction .numerator { 
            border-bottom: 2px solid; 
            padding: 0 0.2em; 
        }

        .fraction .denominator { 
            padding: 0.1em 0.2em; 
        }

        .footer {
            background-color: var(--dark);
            color: white;
            padding: 1.5rem 0;
            text-align: center;
            margin-top: 2rem;
        }

        .footer .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            header h1 {
                font-size: 2rem;
            }
            
            header p {
                font-size: 1.1rem;
            }
            
            .quiz-card {
                margin-bottom: 1.5rem;
            }
            
            .btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="main-content">
        <div id="dashboard-screen" class="screen active">
            <header>
                <div class="header-content container">
                    <div id="header-info">
                        <h1 id="dashboard-title"></h1>
                        <p id="dashboard-subtitle">ุงุฎุชุฑ ููุงุฑุฉ ูุชุจุฏุฃ ุงูุงุฎุชุจุงุฑ</p>
                    </div>
                    <div id="header-action"></div>
                </div>
            </header>
            <div class="container">
                <div class="student-progress" id="student-progress-box"></div>
                <div class="final-average" id="final-average-box"></div>
                <div class="dashboard-grid" id="dashboard-grid"></div>
            </div>
        </div>

        <div id="quiz-screen" class="screen">
             <header><h1 id="quiz-title"></h1></header>
            <div class="container"><div class="test-section">
                <div class="quiz-header">
                    <div class="quiz-meta">
                        <p class="question-counter" id="question-counter"></p>
                        <p class="time-counter" id="time-counter"></p>
                    </div>
                    <p class="question-text" id="question-text"></p>
                </div>
                <div class="options-grid" id="options-grid"></div>
                <div class="explanation" id="explanation-box"><h4><i class="fas fa-lightbulb"></i> ุทุฑููุฉ ุงูุญู:</h4><p id="explanation-text"></p></div>
                <div class="quiz-nav">
                    <button id="next-question-btn" class="btn"><i class="fas fa-arrow-left"></i> ุงูุณุคุงู ุงูุชุงูู</button>
                </div>
            </div></div>
        </div>

        <div id="result-screen" class="screen">
            <header><h1>ูุชูุฌุฉ ุงูุชุญุฏู</h1></header>
            <div class="container"><div class="welcome-container result-box">
                <i id="result-icon" class="fas"></i>
                <h2 id="result-title"></h2>
                <p id="result-score"></p>
                <p id="result-points" class="points-earned"></p>
                <button id="back-to-dashboard-btn" class="btn"><i class="fas fa-th-large"></i> ุงูุนูุฏุฉ ูููุญุฉ ุงูุฅูุฌุงุฒุงุช</button>
                <button id="retry-from-result-btn" class="btn btn-secondary"><i class="fas fa-redo"></i> ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ</button>
            </div></div>
        </div>
    </div>
    <footer class="footer"><div class="container"><p>&copy; ูขููขูค ุงุฎุชุจุงุฑ ุงูุฑูุงุถูุงุช ุงูุชุดุฎูุตู | ุฅุนุฏุงุฏ: ุนุจุฏุงูุนุฒูุฒ ุฎุงูุฏ ุงูุนุจูุงู</p></div></footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- CONFIGURATION ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
        
        // --- DOM Elements ---
        const screens = { 
            dashboard: document.getElementById('dashboard-screen'), 
            quiz: document.getElementById('quiz-screen'), 
            result: document.getElementById('result-screen') 
        };
        const studentProgressBox = document.getElementById('student-progress-box');
        const dashboardGrid = document.getElementById('dashboard-grid');
        const dashboardTitle = document.getElementById('dashboard-title');
        const dashboardSubtitle = document.getElementById('dashboard-subtitle');
        const headerAction = document.getElementById('header-action');
        const quizTitle = document.getElementById('quiz-title');
        const questionCounter = document.getElementById('question-counter');
        const timeCounter = document.getElementById('time-counter');
        const questionText = document.getElementById('question-text');
        const optionsGrid = document.getElementById('options-grid');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const resultTitle = document.getElementById('result-title');
        const resultScore = document.getElementById('result-score');
        const resultIcon = document.getElementById('result-icon');
        const resultPoints = document.getElementById('result-points');
        const backToDashboardBtn = document.getElementById('back-to-dashboard-btn');
        const retryFromResultBtn = document.getElementById('retry-from-result-btn');
        const finalAverageBox = document.getElementById('final-average-box');
        const explanationBox = document.getElementById('explanation-box');
        const explanationText = document.getElementById('explanation-text');

        // --- State ---
        let studentId = '';
        let studentName = '';
        let isVisitor = false;
        let currentQuizId = null;
        let currentDifficulty = null;
        let currentQuestionIndex = 0;
        let currentModel = [];
        let score = 0;
        let quizData = {};
        let timer = null;
        let timeLeft = 0;
        let totalPoints = 0;

        // --- Data (Questions) - ALL 6 SKILLS ADDED with 3 levels and 4 questions each ---
        const quizzes = {
            arithmetic: {
                title: 'ุงูุฃุนุฏุงุฏ ูุงูุนูููุงุช ุงูุญุณุงุจูุฉ',
                levels: {
                    easy: [[{ q: 'ูุงุชุฌ ุฌูุน ูข + ูฅ ูุณุงูู:', o: ['ูฆ', 'ูง', 'ูจ', 'ูฉ'], a: 1, exp: 'ุนูุฏ ุฅุถุงูุฉ ูฅ ุฅูู ูขุ ูุญุตู ุนูู ุงููุฌููุน ูง.' }, { q: 'ุฃู ุนุฏุฏ ูุฃุชู ุจุนุฏ ุงูุนุฏุฏ ูฉุ', o: ['ูจ', 'ูกูก', 'ูง', 'ูกู'], a: 3, exp: 'ูู ุฎุท ุงูุฃุนุฏุงุฏุ ุงูุนุฏุฏ ุงูุฐู ููู ูฉ ูุจุงุดุฑุฉ ูู ูกู.' }, { q: 'ูู ุนุฏุฏ ุงูุชูุงุญุงุช ูู ุงูุตูุฑุฉ: ๐๐๐๐', o: ['ุซูุงุซุฉ', 'ุฎูุณุฉ', 'ุฃุฑุจุนุฉ', 'ุณุชุฉ'], a: 2, exp: 'ุจุจุณุงุทุฉ ูุนุฏ ุงูุชูุงุญุงุช ููุฌุฏ ุฃููุง ุฃุฑุจุน.' }, { q: 'ูุงุชุฌ ุทุฑุญ ูจ - ูฃ ูุณุงูู:', o: ['ูฅ', 'ูฆ', 'ูค', 'ูง'], a: 0, exp: 'ุนูุฏูุง ูุฃุฎุฐ ูฃ ูู ูจุ ูุชุจูู ูุฏููุง ูฅ.' }]],
                    medium: [[{ q: 'ูุงุชุฌ ุถุฑุจ ูฆ ร ูง ูุณุงูู:', o: ['ูกูฃ', 'ูคูจ', 'ูฃูฆ', 'ูคูข'], a: 3, exp: 'ูู ุฌุฏูู ุงูุถุฑุจุ ูุนูู ุฃู ุญุงุตู ุถุฑุจ ูฆ ูู ูง ูู ูคูข.' }, { q: 'ุฅุฐุง ูุงู ูุฏูู ูฃู ุฑูุงูุงูุ ูุงุดุชุฑูุช ูุนุจุฉ ุจุณุนุฑ ูกูข ุฑูุงูุงูุ ูู ูุชุจูู ูุนูุ', o: ['ูกูจ ุฑูุงู', 'ูขูจ ุฑูุงู', 'ูคูข ุฑูุงู', 'ูกูฅ ุฑูุงู'], a: 0, exp: 'ูููู ุจุนูููุฉ ุงูุทุฑุญ: ูฃู - ูกูข = ูกูจ ุฑูุงูุงู.' }, { q: 'ูุฒุน ูุนูู ูขู ูููุงู ุนูู ูค ุทูุงุจ ุจุงูุชุณุงูู. ูู ูุฃุฎุฐ ูู ุทุงูุจุ', o: ['ูค ุฃููุงู', 'ูฆ ุฃููุงู', 'ูฅ ุฃููุงู', 'ูกู ุฃููุงู'], a: 2, exp: 'ูููู ุจุนูููุฉ ุงููุณูุฉ: ูขู รท ูค = ูฅ ุฃููุงู ููู ุทุงูุจ.' }, { q: 'ุฃู ูุณุฑ ุฃูุจุฑ: <span class="fraction"><span class="numerator">ูก</span><span class="denominator">ูฃ</span></span> ุฃู <span class="fraction"><span class="numerator">ูก</span><span class="denominator">ูค</span></span>ุ', o: ['<span class="fraction"><span class="numerator">ูก</span><span class="denominator">ูฃ</span></span>', '<span class="fraction"><span class="numerator">ูก</span><span class="denominator">ูค</span></span>', 'ูุชุณุงููุงู', 'ูุง ูููู ุงูููุงุฑูุฉ'], a: 0, exp: 'ุนูุฏูุง ูุชุณุงูู ุงูุจุณุทุ ุงููุณุฑ ุฐู ุงูููุงู ุงูุฃุตุบุฑ ูู ุงูุฃูุจุฑ. ูุฐุง ูก/ูฃ ุฃูุจุฑ ูู ูก/ูค.' }]],
                    hard: [[{ q: 'ูุง ูู ูุงุชุฌ ูุณูุฉ ูคูฅูฅ รท ูฅ ุ', o: ['ูฉูก', 'ูจูก', 'ูฉูฅ', 'ูกููก'], a: 0, exp: 'ูคูฅ ูุณูุฉ ูฅ ูู ูฉุ ู ูฅ ูุณูุฉ ูฅ ูู ูก. ุฅุฐู ุงููุชูุฌุฉ ูู ูฉูก.' }, { q: 'ูุง ูู ูุงุชุฌ (ูค + ูฆ) ร ูฃ ุ', o: ['ูขูข', 'ูกูฃ', 'ูกูจ', 'ูฃู'], a: 3, exp: 'ูุชุจุน ุชุฑุชูุจ ุงูุนูููุงุชุ ููุญุณุจ ูุง ุจุฏุงุฎู ุงูุฃููุงุณ ุฃููุงู: (ูค+ูฆ) = ูกู. ุซู ูุถุฑุจ: ูกู ร ูฃ = ูฃู.' }, { q: 'ุฅุฐุง ูุงู ุณุนุฑ ูค ุฃููุงู ูู ูฆ ุฑูุงูุงุชุ ููุง ุณุนุฑ ูกู ุฃููุงูุ', o: ['ูกูฅ ุฑูุงู', 'ูขูค ุฑูุงู', 'ูกู ุฑูุงู', 'ูกูข ุฑูุงู'], a: 0, exp: 'ุณุนุฑ ุงูููู ุงููุงุญุฏ = ูฆ รท ูค = ูก.ูฅ ุฑูุงู. ุฅุฐู ุณุนุฑ ูกู ุฃููุงู = ูกู ร ูก.ูฅ = ูกูฅ ุฑูุงู.' }, { q: 'ูุงุชุฌ (ูกู - ูค) รท ูข + ูฅ ูุณุงูู:', o: ['ูจ', 'ูฆ', 'ูง', 'ูฅ'], a: 0, exp: 'ุงูุฃููุงุณ ุฃููุงู (ูกู-ูค=ูฆ). ุซู ุงููุณูุฉ (ูฆรทูข=ูฃ). ุซู ุงูุฌูุน (ูฃ+ูฅ=ูจ).' }]]
                }
            },
            geometry: {
                title: 'ุงูููุฏุณุฉ ุงูุฃุณุงุณูุฉ',
                levels: {
                    easy: [[{ q: 'ูุง ูู ุงุณู ูุฐุง ุงูุดูู: ๐ฅ ุ', o: ['ุฏุงุฆุฑุฉ', 'ูุซูุซ', 'ูุฑุจุน', 'ูุฌูุฉ'], a: 2, exp: 'ูุฐุง ุงูุดูู ูู ุฃุฑุจุนุฉ ุฃุถูุงุน ูุชุณุงููุฉ ูุฃุฑุจุน ุฒูุงูุง ูุงุฆูุฉุ ูุฐุง ูู ูุฑุจุน.' }, { q: 'ูู ุนุฏุฏ ุฃุถูุงุน ุงููุซูุซุ', o: ['ุซูุงุซุฉ', 'ุฃุฑุจุนุฉ', 'ุฎูุณุฉ', 'ุณุชุฉ'], a: 0, exp: 'ุงููุซูุซุ ููุง ูุชุถุญ ูู ุงุณููุ ูู ุซูุงุซุฉ ุฃุถูุงุน.' }, { q: 'ุฃู ูู ูุฐู ุงูุฃุดูุงุก ูุดุจู ุงูุฏุงุฆุฑุฉุ', o: ['ุจุงุจ', 'ูุชุงุจ', 'ุนุฌูุฉ ุงูุณูุงุฑุฉ', 'ุทุงููุฉ'], a: 2, exp: 'ุนุฌูุฉ ุงูุณูุงุฑุฉ ูู ุฃูุถู ูุซุงู ุนูู ุงูุดูู ุงูุฏุงุฆุฑู ูู ุจูู ุงูุฎูุงุฑุงุช.' }, { q: 'ูุง ูู ุงูุดูู ุงูุฐู ููุณ ูู ุฒูุงูุง ุญุงุฏุฉุ', o: ['ุงููุซูุซ', 'ุงููุณุชุทูู', 'ุงููุฌูุฉ', 'ุงูุณูู'], a: 1, exp: 'ุงููุณุชุทูู ุฌููุน ุฒูุงูุงู ูุงุฆูุฉ (ูฉู ุฏุฑุฌุฉ)ุ ูููุณุช ุญุงุฏุฉ.' }]],
                    medium: [[{ q: 'ูุง ูู ูุญูุท ูุฑุจุน ุทูู ุถูุนู ูฃ ุณูุ', o: ['ูฆ ุณู', 'ูฉ ุณู', 'ูกูข ุณู', 'ูฃ ุณู'], a: 2, exp: 'ูุญูุท ุงููุฑุจุน = ุทูู ุงูุถูุน ร ูค. ุฅุฐู ูฃ ร ูค = ูกูข ุณู.' }, { q: 'ูู ุนุฏุฏ ุฑุคูุณ ุงูููุนุจุ', o: ['ูค', 'ูฆ', 'ูจ', 'ูกูข'], a: 2, exp: 'ุงูููุนุจ ูู ูจ ุฑุคูุณ (ุฒูุงูุง).' }, { q: 'ุงูุฒุงููุฉ ุงูุชู ุชุดุจู ุฒุงููุฉ ูุฑูุฉ ุงููุชุงุจ ุชุณูู ุฒุงููุฉ:', o: ['ุญุงุฏุฉ', 'ูููุฑุฌุฉ', 'ูุณุชูููุฉ', 'ูุงุฆูุฉ'], a: 3, exp: 'ุฒุงููุฉ ุฑูู ุงููุชุงุจ ูู ูุซุงู ููุชุงุฒ ุนูู ุงูุฒุงููุฉ ุงููุงุฆูุฉ ุงูุชู ููุงุณูุง ูฉู ุฏุฑุฌุฉ.' }, { q: 'ูุง ูู ุงุณู ุงููุฌุณู ุงูุฐู ูุดุจู ุนูุจุฉ ุงูุฃุญุฐูุฉุ', o: ['ููุนุจ', 'ูุชูุงุฒู ูุณุชุทููุงุช', 'ูุฑู', 'ุฃุณุทูุงูุฉ'], a: 1, exp: 'ุนูุจุฉ ุงูุฃุญุฐูุฉ ูู ูุซุงู ุดุงุฆุน ุนูู ูุฌุณู ูุชูุงุฒู ุงููุณุชุทููุงุช.' }]],
                    hard: [[{ q: 'ูุง ูู ูุณุงุญุฉ ูุณุชุทูู ุทููู ูกู ุณู ูุนุฑุถู ูฅ ุณูุ', o: ['ูกูฅ ุณูยฒ', 'ูฃู ุณูยฒ', 'ูฅู ุณูยฒ', 'ูกูู ุณูยฒ'], a: 2, exp: 'ูุณุงุญุฉ ุงููุณุชุทูู = ุงูุทูู ร ุงูุนุฑุถ. ุฅุฐู ูกู ร ูฅ = ูฅู ุณูยฒ.' }, { q: 'ูุง ูู ูุฌููุน ุฒูุงูุง ุฃู ุดูู ุฑุจุงุนูุ', o: ['ูฉู ุฏุฑุฌุฉ', 'ูกูจู ุฏุฑุฌุฉ', 'ูขูงู ุฏุฑุฌุฉ', 'ูฃูฆู ุฏุฑุฌุฉ'], a: 3, exp: 'ูุฌููุน ููุงุณุงุช ุงูุฒูุงูุง ุงูุฏุงุฎููุฉ ูุฃู ุดูู ุฑุจุงุนู ูู ุฏุงุฆูุงู ูฃูฆู ุฏุฑุฌุฉ.' }, { q: 'ุฅุฐุง ูุงู ูุญูุท ูุซูุซ ูุชุณุงูู ุงูุฃุถูุงุน ูู ูขูก ุณูุ ููุง ุทูู ูู ุถูุนุ', o: ['ูฃ ุณู', 'ูง ุณู', 'ูขูก ุณู', 'ูฆูฃ ุณู'], a: 1, exp: 'ุจูุง ุฃู ุงูุฃุถูุงุน ูุชุณุงููุฉุ ููุณู ุงููุญูุท ุนูู ุนุฏุฏ ุงูุฃุถูุงุน (ูฃ). ูขูก รท ูฃ = ูง ุณู.' }, { q: 'ูุง ูู ุญุฌู ููุนุจ ุทูู ุญุฑูู ูค ุณูุ', o: ['ูกูข ุณูยณ', 'ูกูฆ ุณูยณ', 'ูฃูข ุณูยณ', 'ูฆูค ุณูยณ'], a: 3, exp: 'ุญุฌู ุงูููุนุจ = ุทูู ุงูุญุฑู ร ููุณู ร ููุณู. ุฅุฐู ูค ร ูค ร ูค = ูฆูค ุณูยณ.' }]]
                }
            },
            algebra: {
                title: 'ุงูุชูููุฑ ุงูุฌุจุฑู',
                levels: {
                    easy: [[{ q: 'ุฅุฐุง ูุงู โฌ + ูฃ = ูฅุ ููุง ูู ุงูุนุฏุฏ ุฏุงุฎู ุงููุฑุจุนุ', o: ['ูก', 'ูข', 'ูฃ', 'ูค'], a: 1, exp: 'ุงูุนุฏุฏ ุงูุฐู ุฅุฐุง ุฃุถููุง ุฅููู ูฃ ูุตุจุญ ุงููุงุชุฌ ูฅ ูู ูข.' }, { q: 'ุฃููู ุงูููุท: โฒุ โผุ โฒุ โผุ __ุ', o: ['โฒ', 'โผ', 'โ', 'โ'], a: 0, exp: 'ุงูููุท ูุชูุงูุจ ุจูู ุณูู ููุฃุนูู ูุณูู ููุฃุณูู.' }, { q: 'ูุง ูู ุงูุนุฏุฏ ุงูููููุฏ ูู ุงูููุท: ูขุ ูคุ ูฆุ __ุ ูกูุ', o: ['ูง', 'ูจ', 'ูฉ', 'ูฅ'], a: 1, exp: 'ุงูููุท ูุฒูุฏ ุจููุฏุงุฑ ูข ูู ูู ูุฑุฉ. ุจุนุฏ ูฆุ ูุฃุชู ุงูุนุฏุฏ ูจ.' }, { q: 'ุฅุฐุง ูุงู ูุฏูู ูฃ ุตูุงุฏููุ ููู ูู ุตูุฏูู ูค ูุฑุงุชุ ููุง ูุฌููุน ุงููุฑุงุชุ', o: ['ูง', 'ูกู', 'ูกูข', 'ูฉ'], a: 2, exp: 'ูุฐู ุนูููุฉ ุถุฑุจ ูุชูุฑุฑ: ูฃ ร ูค = ูกูข ูุฑุฉ.' }]],
                    medium: [[{ q: 'ุญู ุงููุนุงุฏูุฉ: ุณ + ูกู = ูกูง', o: ['ุณ = ูขูง', 'ุณ = ูกูง', 'ุณ = ูง', 'ุณ = ูกู'], a: 2, exp: 'ูุฅูุฌุงุฏ ูููุฉ ุณุ ูุทุฑุญ ูกู ูู ุงูุทุฑููู. ุณ = ูกูง - ูกู = ูง.' }, { q: 'ุฅุฐุง ูุงูุช ุฃ = ูฅุ ููุง ูููุฉ ูค ร ุฃ ุ', o: ['ูฉ', 'ูคูฅ', 'ูก', 'ูขู'], a: 3, exp: 'ูุนูุถ ุนู ุฃ ุจุงูุฑูู ูฅุ ูุชุตุจุญ ุงูุนูููุฉ ูค ร ูฅ = ูขู.' }, { q: 'ูุง ูู ุงูุนุฏุฏ ุงูุฐู ุฅุฐุง ุทุฑุญูุง ููู ูฆ ูุงู ุงููุงุชุฌ ูฉุ', o: ['ูฃ', 'ูกูฅ', 'ูฅูค', 'ูฉูฆ'], a: 1, exp: 'ูุญููุง ุจุดูู ุนูุณู: ูฉ + ูฆ = ูกูฅ. ุงูุนุฏุฏ ูู ูกูฅ.' }, { q: 'ุฃููู ุงูููุท: ูฃุ ูฆุ ูฉุ ูกูขุ __ุ', o: ['ูกูฃ', 'ูกูค', 'ูกูฅ', 'ูกูฆ'], a: 2, exp: 'ุงูููุท ูุฒูุฏ ุจููุฏุงุฑ ูฃ ูู ูู ูุฑุฉ (ูุถุงุนูุงุช ุงูุนุฏุฏ ูฃ). ุจุนุฏ ูกูขุ ูุฃุชู ุงูุนุฏุฏ ูกูฅ.' }]],
                    hard: [[{ q: 'ุญู ุงููุนุงุฏูุฉ: ูฃุต = ูขูก', o: ['ุต = ูกูจ', 'ุต = ูง', 'ุต = ูขูค', 'ุต = ูฃ'], a: 1, exp: 'ูุฅูุฌุงุฏ ูููุฉ ุตุ ููุณู ุงูุทุฑููู ุนูู ูฃ. ุต = ูขูก รท ูฃ = ูง.' }, { q: 'ุฅุฐุง ูุงู ุณ/ูข = ูจุ ููุง ูููุฉ ุณุ', o: ['ูค', 'ูกู', 'ูฆ', 'ูกูฆ'], a: 3, exp: 'ูุฅูุฌุงุฏ ูููุฉ ุณุ ูุถุฑุจ ุงูุทุฑููู ูู ูข. ุณ = ูจ ร ูข = ูกูฆ.' }, { q: 'ุฅุฐุง ูุงูุช ุจ = ูคุ ููุง ูููุฉ (ูฅ ร ุจ) - ูฅ ุ', o: ['ูกูฅ', 'ูขูฅ', 'ูขู', 'ูกู'], a: 0, exp: 'ูุชุจุน ุชุฑุชูุจ ุงูุนูููุงุช: ุงูุถุฑุจ ุฃููุงู (ูฅรูค=ูขู)ุ ุซู ุงูุทุฑุญ (ูขู-ูฅ=ูกูฅ).' }, { q: 'ุฃููู ุงูููุท: ูกุ ูคุ ูฉุ ูกูฆุ __ุ', o: ['ูขู', 'ูขูค', 'ูขูฅ', 'ูฃูข'], a: 2, exp: 'ูุฐุง ุงูููุท ููุซู ูุฑุจุน ุงูุฃุนุฏุงุฏ (ูกรูกุ ูขรูขุ ูฃรูฃุ ูครูค). ุงูุนุฏุฏ ุงูุชุงูู ูู ูฅรูฅ = ูขูฅ.' }]]
                }
            },
            measurement: {
                title: 'ุงูููุงุณ ูุงููุญุฏุงุช',
                levels: {
                    easy: [[{ q: 'ูู ูููุงู ูู ุงูุฃุณุจูุนุ', o: ['ูฅ ุฃูุงู', 'ูฆ ุฃูุงู', 'ูง ุฃูุงู', 'ูจ ุฃูุงู'], a: 2, exp: 'ุงูุฃุณุจูุน ูุชููู ูู ุณุจุนุฉ ุฃูุงู.' }, { q: 'ุฃู ูุญุฏุฉ ุฃูุถู ูููุงุณ ูุฒู ุชูุงุญุฉุ', o: ['ุงูุฌุฑุงู', 'ุงูููููุฌุฑุงู', 'ุงูุทู', 'ุงููุชุฑ'], a: 0, exp: 'ุงูุฌุฑุงู ูู ุงููุญุฏุฉ ุงูููุงุณุจุฉ ูููุงุณ ุงูุฃูุฒุงู ุงูุตุบูุฑุฉ.' }, { q: 'ุฃู ูู ูุฐู ุฃุทูู: ููู ุฑุตุงุต ุฃู ุณูุงุฑุฉุ', o: ['ููู ุฑุตุงุต', 'ุณูุงุฑุฉ', 'ูุชุณุงููุงู', 'ูุง ูููู ุงูููุงุฑูุฉ'], a: 1, exp: 'ูู ุงููุงุถุญ ุฃู ุงูุณูุงุฑุฉ ุฃุทูู ุจูุซูุฑ ูู ููู ุงูุฑุตุงุต.' }, { q: 'ุฅุฐุง ูุงูุช ุงูุณุงุนุฉ ุชุดูุฑ ุฅูู ุชูุงู ุงูุณุงุนุฉ ุงูุซุงููุฉุ ูุฃูู ูููู ุนูุฑุจ ุงูุฏูุงุฆูุ', o: ['ุนูุฏ ูฃ', 'ุนูุฏ ูฆ', 'ุนูุฏ ูฉ', 'ุนูุฏ ูกูข'], a: 3, exp: 'ุนูุฏูุง ุชููู ุงูุณุงุนุฉ ุชูุงูุงูุ ูููู ุนูุฑุจ ุงูุฏูุงุฆู ุงูุทููู ุฏุงุฆูุงู ุนูุฏ ุงูุฑูู ูกูข.' }]],
                    medium: [[{ q: 'ูู ุณูุชููุชุฑ ูู ูข ูุชุฑุ', o: ['ูขู ุณู', 'ูขููู ุณู', 'ูข ุณู', 'ูขูู ุณู'], a: 3, exp: 'ุจูุง ุฃู ุงููุชุฑ ุงููุงุญุฏ ูุณุงูู ูกูู ุณูุ ูุฅู ูุชุฑูู ูุณุงููุงู ูข ร ูกูู = ูขูู ุณู.' }, { q: 'ูฃููู ุฌุฑุงู ุชุณุงูู ูู ููููุฌุฑุงูุ', o: ['ูฃู ูุฌู', 'ูฃ ูุฌู', 'ูฃูู ูุฌู', 'ู.ูฃ ูุฌู'], a: 1, exp: 'ูู ูกููู ุฌุฑุงู ูุณุงูู ูก ููููุฌุฑุงูุ ูุฐุง ูฃููู ุฌุฑุงู ุชุณุงูู ูฃ ููููุฌุฑุงู.' }, { q: 'ุฅุฐุง ูุงูุช ุงูุณุงุนุฉ ุงูุขู ูค:ูฃูุ ููู ูุงูุช ูุจู ูุตู ุณุงุนุฉุ', o: ['ูฃ:ูฃู', 'ูค:ูู', 'ูฅ:ูู', 'ูฃ:ูู'], a: 1, exp: 'ูุจู ูุตู ุณุงุนุฉ (ูฃู ุฏูููุฉ) ูู ูค:ูฃู ูุงูุช ุงูุณุงุนุฉ ูค:ูู ุชูุงูุงู.' }, { q: 'ูุง ูู ุงูุฃุฏุงุฉ ุงูุชู ูุณุชุฎุฏููุง ูุฑุณู ุฎุท ูุณุชูููุ', o: ['ุงูููููุฉ', 'ุงููุฑุฌุงุฑ', 'ุงูููุญุงุฉ', 'ุงููุณุทุฑุฉ'], a: 3, exp: 'ุงููุณุทุฑุฉ ูู ุงูุฃุฏุงุฉ ุงููุฎุตุตุฉ ูุฑุณู ูููุงุณ ุงูุฎุทูุท ุงููุณุชูููุฉ.' }]],
                    hard: [[{ q: 'ูููู ูุฏุชู ุณุงุนุฉ ู ูคูฅ ุฏูููุฉ. ูู ุฏูููุฉ ูู ูุฏุฉ ุงููููู ุงูุฅุฌูุงููุฉุ', o: ['ูกูู ุฏูููุฉ', 'ูกูคูฅ ุฏูููุฉ', 'ูกููฅ ุฏูููุฉ', 'ูฆูฅ ุฏูููุฉ'], a: 2, exp: 'ุงูุณุงุนุฉ ุชุณุงูู ูฆู ุฏูููุฉ. ูุถูู ุฅูููุง ูคูฅ ุฏูููุฉุ ููููู ุงููุฌููุน ูฆู + ูคูฅ = ูกููฅ ุฏูููุฉ.' }, { q: 'ุฅุฐุง ูุงู ูุญูุท ุญุฏููุฉ ูุณุชุทููุฉ ูคู ูุชุฑุงูุ ูุทูููุง ูกูข ูุชุฑุงูุ ููู ุนุฑุถูุงุ', o: ['ูจ ุฃูุชุงุฑ', 'ูกูฆ ูุชุฑุงู', 'ูขูจ ูุชุฑุงู', 'ูขู ูุชุฑุงู'], a: 0, exp: 'ูุตู ุงููุญูุท = ูคู รท ูข = ูขู ูุชุฑ. ุงูุนุฑุถ = ูุตู ุงููุญูุท - ุงูุทูู = ูขู - ูกูข = ูจ ุฃูุชุงุฑ.' }, { q: 'ูู ูุชุฑุงู ูู ูฅููู ูููููุชุฑุ', o: ['ูฅูู ูุชุฑ', 'ูฅู ูุชุฑ', 'ูฅ ูุชุฑ', 'ู.ูฅ ูุชุฑ'], a: 2, exp: 'ุจูุง ุฃู ูู ูกููู ูููููุชุฑ ูุณุงูู ูก ูุชุฑุ ูุฅููุง ููุณู ูฅููู ุนูู ูกููู ููุญุตู ุนูู ูฅ ูุชุฑุงุช.' }, { q: 'ุจุฏุฃ ุงูุชูุฑูู ุงูุณุงุนุฉ ูจ:ูกู ุตุจุงุญุงู ูุงุณุชูุฑ ููุฏุฉ ูฅูฅ ุฏูููุฉ. ูุชู ุงูุชููุ', o: ['ูฉ:ูู ุต', 'ูจ:ูฅูฅ ุต', 'ูฉ:ููฅ ุต', 'ูฉ:ูกู ุต'], a: 2, exp: 'ูจ:ูกู + ูฅู ุฏูููุฉ = ูฉ:ูู. ุซู ูุถูู ุงูู ูฅ ุฏูุงุฆู ุงููุชุจููุฉุ ููููู ููุช ุงูุงูุชูุงุก ูู ูฉ:ููฅ ุตุจุงุญุงู.' }]]
                }
            },
            statistics: {
                title: 'ุงูุฅุญุตุงุก ูุงูุจูุงูุงุช',
                levels: {
                    easy: [[{ q: 'ูู ูุงุฆูุฉ ุงูููุงูู: ุชูุงุญุ ููุฒุ ุชูุงุญุ ุจุฑุชูุงูุ ุชูุงุญ. ูุง ูู ุงููุงููุฉ ุงูุฃูุซุฑ ุชูุฑุงุฑุงูุ', o: ['ููุฒ', 'ุจุฑุชูุงู', 'ุชูุงุญ', 'ูุง ููุฌุฏ'], a: 2, exp: 'ูููุฉ "ุชูุงุญ" ุชูุฑุฑุช ูฃ ูุฑุงุชุ ููู ุงูุฃูุซุฑ.' }, { q: 'ุฅุฐุง ูุงู ูู ุฑูุฒ ๐ฆ ููุซู ุทุงูุจุงู ูุงุญุฏุงูุ ููู ุนุฏุฏ ุงูุทูุงุจ ุงูุฐูู ููุซููู: ๐ฆ๐ฆ๐ฆ ุ', o: ['ุทุงูุจุงู', 'ุซูุงุซุฉ ุทูุงุจ', 'ุฃุฑุจุนุฉ ุทูุงุจ', 'ุทุงูุจ ูุงุญุฏ'], a: 1, exp: 'ุจูุง ุฃู ูู ุฑูุฒ ููุซู ุทุงูุจุงูุ ูุฅู ุซูุงุซุฉ ุฑููุฒ ุชูุซู ุซูุงุซุฉ ุทูุงุจ.' }, { q: 'ุฅุฐุง ูุงู ูุฏูู ูฃ ููุตุงู ุญูุฑุงุก ู ูข ุฒุฑูุงุกุ ุฃู ููู ูุฏูู ูุฑุตุฉ ุฃูุจุฑ ุฃู ุชุฎุชุงุฑู ุนุดูุงุฆูุงูุ', o: ['ุฃุฒุฑู', 'ุฃุญูุฑ', 'ููุณ ุงููุฑุตุฉ', 'ุฃุฎุถุฑ'], a: 1, exp: 'ุจูุง ุฃู ุนุฏุฏ ุงูููุตุงู ุงูุญูุฑุงุก ุฃูุจุฑุ ูุฅู ูุฑุตุฉ ุงุฎุชูุงุฑูุง ูู ุงูุฃูุจุฑ.' }, { q: 'ูู ุฑุณู ุจูุงูู ููุซู ุฃูุงู ุงูุฃุณุจูุนุ ุฃู ููู ูุฃุชู ุจุนุฏ ููู ุงูุฅุซูููุ', o: ['ุงูุฃุญุฏ', 'ุงูุซูุงุซุงุก', 'ุงูุฃุฑุจุนุงุก', 'ุงูุณุจุช'], a: 1, exp: 'ูููุงู ูุชุฑุชูุจ ุฃูุงู ุงูุฃุณุจูุนุ ููู ุงูุซูุงุซุงุก ูุฃุชู ูุจุงุดุฑุฉ ุจุนุฏ ููู ุงูุฅุซููู.' }]],
                    medium: [[{ q: 'ูุง ูู ูุชูุณุท ุงูุฃุนุฏุงุฏ: ูขุ ูฃุ ูง ุ', o: ['ูฃ', 'ูค', 'ูฆ', 'ูง'], a: 1, exp: 'ูุฌูุน ุงูุฃุนุฏุงุฏ (ูข+ูฃ+ูง = ูกูข) ุซู ููุณู ุนูู ุนุฏุฏูุง (ูฃ). ูกูข รท ูฃ = ูค.' }, { q: 'ุฅุฐุง ุฑููุช ุนููุฉ ูุนุฏููุฉุ ููุง ูู ุงุญุชูุงู ุธููุฑ "ุตูุฑุฉ"ุ', o: ['ูกูู%', 'ู%', 'ูขูฅ%', 'ูฅู%'], a: 3, exp: 'ุงูุนููุฉ ุงููุนุฏููุฉ ููุง ูุฌูุงูุ ูููู ูุฌู ูุฑุตุฉ ุธููุฑ ูุชุณุงููุฉุ ููู ุงููุตู ุฃู ูฅู%.' }, { q: 'ูุง ูู ูููุงู ุงูุจูุงูุงุช ุงูุชุงููุฉ: ูจ, ูฉ, ูกู, ูฉ, ูจ, ูฉ ุ', o: ['ูจ', 'ูกู', 'ูฉ', 'ูุง ููุฌุฏ'], a: 2, exp: 'ุงููููุงู ูู ุงููููุฉ ุงูุฃูุซุฑ ุชูุฑุงุฑุงู. ุงูุนุฏุฏ ูฉ ุชูุฑุฑ ูฃ ูุฑุงุชุ ููู ุงูุฃูุซุฑ.' }, { q: 'ุฅุฐุง ูุงู ุฑุณู ุจูุงูู ููุถุญ ุฃู ูฅ ุทูุงุจ ููุถููู ูุฑุฉ ุงููุฏู ู ูกู ููุถููู ุงูุณูุฉุ ูู ูุฒูุฏ ุนุฏุฏ ูุญุจู ุงูุณูุฉุ', o: ['ุจููุฏุงุฑ ูฅ', 'ุจููุฏุงุฑ ูกู', 'ุจููุฏุงุฑ ูข', 'ูุง ูุฒูุฏ'], a: 0, exp: 'ุงููุฑู ุจูู ุนุฏุฏ ูุญุจู ุงูุณูุฉ ููุฑุฉ ุงููุฏู ูู ูกู - ูฅ = ูฅ ุทูุงุจ.' }]],
                    hard: [[{ q: 'ูุง ูู ูุณูุท ุงูุฃุนุฏุงุฏ ุงูุชุงููุฉ: ูกูุ ูฅุ ูขูุ ูกูฅุ ูขูฅุ', o: ['ูขู', 'ูกู', 'ูกูฅ', 'ูขูฅ'], a: 2, exp: 'ุฃููุงู ูุฑุชุจ ุงูุฃุนุฏุงุฏ: ูฅุ ูกูุ ูกูฅุ ูขูุ ูขูฅ. ุงููุณูุท ูู ุงูุนุฏุฏ ุงูุฐู ููุน ูู ุงูููุชุตู ุชูุงูุงูุ ููู ูกูฅ.' }, { q: 'ูุง ูู ุงููุฏู ููุจูุงูุงุช ุงูุชุงููุฉ: ูฃูฃ, ูกูฅ, ูคู, ูขูข, ูกูขุ', o: ['ูขูก', 'ูขูจ', 'ูคู', 'ูกูข'], a: 1, exp: 'ุงููุฏู ูู ุงููุฑู ุจูู ุฃุนูู ูููุฉ ูุฃูู ูููุฉ. ูคู - ูกูข = ูขูจ.' }, { q: 'ุฅุฐุง ูุงู ูุชูุณุท ุฏุฑุฌุงุช ุทุงูุจ ูู ุงุฎุชุจุงุฑูู ูู ูฉูุ ููุงูุช ุฏุฑุฌุชู ูู ุงูุงุฎุชุจุงุฑ ุงูุฃูู ูจูฅุ ููุง ุฏุฑุฌุชู ูู ุงูุซุงููุ', o: ['ูฉูฅ', 'ูฉู', 'ูจูฅ', 'ูกูู'], a: 0, exp: 'ุงููุฌููุน ุงูููู ููุฏุฑุฌุชูู = ุงููุชูุณุท ร ูข = ูฉู ร ูข = ูกูจู. ุฏุฑุฌุฉ ุงูุงุฎุชุจุงุฑ ุงูุซุงูู = ูกูจู - ูจูฅ = ูฉูฅ.' }, { q: 'ูู ุตู ุจู ูขู ุทุงูุจุงูุ ูฅู% ูููู ุฃููุงุฏ. ูู ุนุฏุฏ ุงูุจูุงุชุ', o: ['ูฅ', 'ูกูฅ', 'ูกู', 'ูขู'], a: 2, exp: 'ุฅุฐุง ูุงู ูฅู% ุฃููุงุฏุ ูุฅู ุงูู ูฅู% ุงููุชุจููุฉ ูู ุจูุงุช. ูุตู ุนุฏุฏ ุงูุทูุงุจ (ูขู รท ูข) ูู ูกู ุจูุงุช.' }]]
                }
            },
            percentages: {
                title: 'ุงููุณุจ ุงููุฆููุฉ',
                levels: {
                    easy: [[{ q: 'ุฅุฐุง ุฃููุช ูุตู ุชูุงุญุฉุ ููู ุงููุณุจุฉ ุงููุฆููุฉ ุงูุชู ุฃููุชูุงุ', o: ['ูขูฅ%', 'ูกูู%', 'ูฅู%', 'ูกู%'], a: 2, exp: 'ุงููุตู ุฏุงุฆูุงู ููุซู ูฅู% ูู ุฃู ุดูุก ูุงูู.' }, { q: 'ูุงุฐุง ุชุนูู ูกูู% ูู ูุนูุฉุ', o: ['ูุตู ุงููุนูุฉ', 'ูู ุงููุนูุฉ', 'ุฑุจุน ุงููุนูุฉ', 'ูุง ุดูุก'], a: 1, exp: 'ูกูู% ุชุนูู ุงููู ุฃู ุงูุดูุก ูุงููุงู.' }, { q: 'ุฃู ูุณุจุฉ ุฃูุจุฑ: ูขู% ุฃู ูกู%ุ', o: ['ูขู%', 'ูกู%', 'ูุชุณุงููุชุงู', 'ูุง ูููู ุงูููุงุฑูุฉ'], a: 0, exp: 'ูููุง ุฒุงุฏ ุงูุฑููุ ุฒุงุฏุช ุงููุณุจุฉ ุงููุฆููุฉ. ูขู ุฃูุจุฑ ูู ูกู.' }, { q: 'ุฅุฐุง ูุงูุช ุจุทุงุฑูุฉ ูุงุชูู ูกูู%ุ ููุฐุง ูุนูู ุฃููุง:', o: ['ูุงุฑุบุฉ', 'ูุตู ููุชูุฆุฉ', 'ููุชูุฆุฉ ุจุงููุงูู', 'ุชุญุชุงุฌ ููุดุญู'], a: 2, exp: 'ูกูู% ูู ุงููุณุจุฉ ุงูุชู ุชุฏู ุนูู ุงูุงูุชูุงู ูุงูุงูุชูุงุก.' }]],
                    medium: [[{ q: 'ุงููุณุฑ ุงูุงุนุชูุงุฏู <span class="fraction"><span class="numerator">ูก</span><span class="denominator">ูค</span></span> ูุณุงูู:', o: ['ูขู%', 'ูคู%', 'ูกูค%', 'ูขูฅ%'], a: 3, exp: 'ุงูุฑุจุน ููุซู ูขูฅ% ูู ุงููู (ูกูู รท ูค = ูขูฅ).' }, { q: 'ูุง ูููุฉ ูฅู% ูู ุงูุนุฏุฏ ูขูุ', o: ['ูฅ', 'ูกู', 'ูกูฅ', 'ูขู'], a: 1, exp: 'ูฅู% ุชุนูู ุงููุตู. ูุตู ุงูุนุฏุฏ ูขู ูู ูกู.' }, { q: 'ุงููุณุฑ ุงูุนุดุฑู ู.ูก ููุซู ุฃู ูุณุจุฉ ูุฆููุฉุ', o: ['ูก%', 'ูกูู%', 'ูกู%', 'ู.ูก%'], a: 2, exp: 'ูุชุญููู ูุณุฑ ุนุดุฑู ุฅูู ูุณุจุฉ ูุฆููุฉุ ูุถุฑุจู ูู ูกูู. ู.ูก ร ูกูู = ูกู%.' }, { q: 'ุตูุฏูู ุจู ูกู ูุฑุงุชุ ูง ูููุง ุญูุฑุงุก. ูุง ูู ุงููุณุจุฉ ุงููุฆููุฉ ูููุฑุงุช ุงูุญูุฑุงุกุ', o: ['ูง%', 'ูงู%', 'ูกู%', 'ูกูง%'], a: 1, exp: 'ูง ูู ูกู ุชุนูู ูงู ูู ูกููุ ุฃู ูงู%.' }]],
                    hard: [[{ q: 'ูุง ูููุฉ ูขู% ูู ุงูุนุฏุฏ ูขููุ', o: ['ูขู', 'ูคู', 'ูฅู', 'ูกูู'], a: 1, exp: 'ุทุฑููุฉ ุณููุฉ: ูกู% ูู ูขูู ูู ูขู. ุฅุฐู ูขู% ูู ุถุนููุงุ ุฃู ูคู. ุฃู (ูขู ร ูขูู) รท ูกูู = ูคู.' }, { q: 'ุณุนุฑ ูููุต ูจู ุฑูุงูุงูุ ุนููู ุฎุตู ูขูฅ%. ูู ุฑูุงูุงู ุณุชููุฑุ', o: ['ูขูฅ ุฑูุงู', 'ูจ ุฑูุงู', 'ูคู ุฑูุงู', 'ูขู ุฑูุงู'], a: 3, exp: 'ูขูฅ% ุชุนุงุฏู ุงูุฑุจุน. ุฑุจุน ุงููุจูุบ ูจู ูู ูจู รท ูค = ูขู ุฑูุงู.' }, { q: 'ุฃุฌุงุจ ุทุงูุจ ุนูู ูกูจ ุณุคุงูุงู ุตุญูุญุงู ูู ุฃุตู ูขู. ูุง ูู ูุณุจุชู ุงููุฆููุฉุ', o: ['ูกูจ%', 'ูจู%', 'ูฉู%', 'ูจูจ%'], a: 2, exp: 'ุงููุณุจุฉ = (ูกูจ รท ูขู) ร ูกูู = ู.ูฉ ร ูกูู = ูฉู%.' }, { q: 'ูุง ูู ุงูุนุฏุฏ ุงูุฐู ูฅู% ููู ูุณุงูู ูกูฅุ', o: ['ูกูฅ', 'ูฃู', 'ูฅู', 'ูง.ูฅ'], a: 1, exp: 'ุฅุฐุง ูุงู ูุตู ุงูุนุฏุฏ ูู ูกูฅุ ูุฅู ุงูุนุฏุฏ ูุงููุงู (ูกูู%) ูู ุถุนู ูุฐุง ุงูุฑูู: ูกูฅ ร ูข = ูฃู.' }]]
                }
            }
        };

        // --- Functions ---
        function toArabicNumerals(str) {
            if (str === null || str === undefined) return '';
            const arabicNumerals = ['ู', 'ูก', 'ูข', 'ูฃ', 'ูค', 'ูฅ', 'ูฆ', 'ูง', 'ูจ', 'ูฉ'];
            return String(str).replace(/[0-9]/g, d => arabicNumerals[parseInt(d)]);
        }
        
        function processContent(content) {
            let processed = toArabicNumerals(content);
            processed = processed.replace(/([ู-ูฉ]+)\/([ู-ูฉ]+)/g, '<span class="fraction"><span class="numerator">$1</span><span class="denominator">$2</span></span>');
            return processed;
        }

        function showScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.remove('active'));
            screens[screenId].classList.add('active');
        }

        function loadQuizData(studentData) {
            let dataToLoad = null;
            if(isVisitor) {
                const savedVisitorData = sessionStorage.getItem('visitorDiagnosticData');
                if(savedVisitorData) dataToLoad = JSON.parse(savedVisitorData);
            } else if (studentData && studentData.diagnostics) {
                dataToLoad = studentData.diagnostics;
            }

            totalPoints = 0;
            Object.keys(quizzes).forEach(key => {
                quizData[key] = { title: quizzes[key].title, levels: {} };
                Object.keys(quizzes[key].levels).forEach(levelKey => {
                    const skillId = `d_${key}_${levelKey}`;
                    const levelData = dataToLoad ? dataToLoad[skillId] : null;
                    quizData[key].levels[levelKey] = { 
                        score: levelData ? levelData.grade : null, 
                        completed: !!levelData 
                    };
                    if(levelData) {
                        // Points are now stored in metricValue
                        totalPoints += levelData.metricValue || 0;
                    }
                });
            });
        }
        
        async function saveGradeToSheet(itemId, grade, points) {
            if (isVisitor || !studentId) return; // Don't save for visitors
            const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&itemId=${itemId}&grade=${grade}&metricValue=${points}`;
            try {
                const response = await fetch(url);
                const result = await response.json();
                console.log(`Saved ${itemId}:`, result);
            } catch (error) {
                console.error(`Failed to save ${itemId}:`, error);
            }
        }

        function getScoreStyle(score) {
            if (score >= 80) return { class: 'score-high', icon: 'fa-trophy' };
            if (score >= 50) return { class: 'score-medium', icon: 'fa-smile' };
            return { class: 'score-low', icon: 'fa-frown' };
        }

        // ** UPDATED: Calculate points based on correct answers **
        function calculatePoints(correctAnswers, difficulty) {
            const pointsPerQuestion = difficulty === 'easy' ? 1 : (difficulty === 'medium' ? 2 : 3);
            return correctAnswers * pointsPerQuestion;
        }

        // ** UPDATED: Calculate weighted score based on division **
        function calculateWeightedScore(levels) {
            const weights = { easy: 3, medium: 2, hard: 1 };
            let bestWeightedScore = -1;

            Object.keys(levels).forEach(levelKey => {
                if (levels[levelKey].completed) {
                    const weightedScore = (levels[levelKey].score || 0) / weights[levelKey];
                    if (weightedScore > bestWeightedScore) {
                        bestWeightedScore = weightedScore;
                    }
                }
            });

            if (bestWeightedScore === -1) return null;
            return bestWeightedScore.toFixed(1);
        }

        function renderDashboard() {
            if(isVisitor) {
                dashboardTitle.textContent = 'ูุฑุญุจุงู ุจู ุฃููุง ุงูุฒุงุฆุฑ';
                dashboardSubtitle.textContent = 'ููููู ุชุฌุฑุจุฉ ูู ุงุฎุชุจุงุฑ ูุฑุฉ ูุงุญุฏุฉ';
                headerAction.innerHTML = '';
            } else {
                dashboardTitle.textContent = `ุฃููุงู ุจูุ ${studentName}`;
                dashboardSubtitle.textContent = 'ุงุฎุชุฑ ููุงุฑุฉ ูุชุจุฏุฃ ุงูุงุฎุชุจุงุฑ';
                headerAction.innerHTML = `<a href="index.html" target="_top" class="btn btn-exit"><i class="fas fa-sign-out-alt"></i> ุงูุนูุฏุฉ ููููุตุฉ</a>`;
            }

            const allLevels = Object.values(quizData).flatMap(q => Object.values(q.levels));
            const completedLevels = allLevels.filter(l => l.completed).length;
            const totalLevels = allLevels.length;
            const progressPercentage = totalLevels > 0 ? Math.round((completedLevels / totalLevels) * 100) : 0;

            studentProgressBox.innerHTML = `
                <h3><i class="fas fa-chart-line"></i> ุชูุฏูู ูู ุงูุชุนูู</h3>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                    </div>
                    <div class="progress-text">${toArabicNumerals(progressPercentage)}% ุงูุชูุงู</div>
                </div>
                <div class="points-container">
                    <span>ุงูููุงุท ุงูุชู ุฌูุนุชูุง:</span>
                    <i class="fas fa-coins"></i>
                    <span>${toArabicNumerals(totalPoints)}</span>
                </div>
            `;

            dashboardGrid.innerHTML = '';
            
            Object.keys(quizzes).forEach(key => {
                const quiz = quizzes[key];
                const data = quizData[key];
                const card = document.createElement('div');
                card.className = 'quiz-card';
                
                const weightedScore = calculateWeightedScore(data.levels);
                let weightedScoreHTML = '';
                if (weightedScore !== null) {
                    weightedScoreHTML = `<div class="best-score-container">
                                            <h4>ุฃูุถู ูุชูุฌุฉ ููุฒููุฉ</h4>
                                            <p>${toArabicNumerals(weightedScore)}%</p>
                                         </div>`;
                }

                let levelsHTML = '<div class="levels-container">';
                Object.keys(quiz.levels).forEach(levelKey => {
                    const levelData = data.levels[levelKey];
                    let scoreHTML = `<div class="level-score not-completed">ูู ูุฎุชุจุฑ</div>`;
                    if (levelData.completed) {
                        const style = getScoreStyle(levelData.score);
                        scoreHTML = `<div class="level-score ${style.class}"><i class="fas ${style.icon}"></i> ${toArabicNumerals(levelData.score)}%</div>`;
                    }
                    const levelName = levelKey === 'easy' ? 'ุณูู' : (levelKey === 'medium' ? 'ูุชูุณุท' : 'ุนุงูู');
                    const multiplier = levelKey === 'easy' ? '<i class="fas fa-star"></i>' : (levelKey === 'medium' ? '<i class="fas fa-star"></i><i class="fas fa-star"></i>' : '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>');
                    levelsHTML += `<div class="level-wrapper" data-quiz-id="${key}" data-difficulty="${levelKey}">
                                        <div class="level-bubble ${levelData.completed && isVisitor ? 'disabled' : ''}">
                                            <div class="level-name">${levelName}</div>
                                            ${scoreHTML}
                                        </div>
                                        <div class="level-stars">${multiplier}</div>
                                    </div>`;
                });
                levelsHTML += '</div>';

                card.innerHTML = `<div class="quiz-card-header"><h3>${quiz.title}</h3></div><div class="quiz-card-body">${weightedScoreHTML}${levelsHTML}</div>`;
                dashboardGrid.appendChild(card);
            });
            
            if (!isVisitor && completedLevels === totalLevels) {
                const average = Math.round(allLevels.reduce((sum, level) => sum + (level.score || 0), 0) / totalLevels);
                finalAverageBox.innerHTML = `<h2><i class="fas fa-medal"></i> ุงูุชูู ุงูุชูููู ุงูุดุงูู!</h2><p>ูุนุฏูู ุงูุฅุฌูุงูู: ${toArabicNumerals(average)}%</p>`;
                finalAverageBox.style.display = 'block';
                saveGradeToSheet('d_test_overall', average, totalPoints);
            } else {
                finalAverageBox.style.display = 'none';
            }

            dashboardGrid.addEventListener('click', (e) => {
                const bubble = e.target.closest('.level-bubble');
                if (bubble && !bubble.classList.contains('disabled')) {
                    const wrapper = bubble.closest('.level-wrapper');
                    startQuiz(wrapper.dataset.quizId, wrapper.dataset.difficulty);
                }
            });
        }

        function startQuiz(quizId, difficulty) {
            currentQuizId = quizId;
            currentDifficulty = difficulty;
            currentQuestionIndex = 0;
            score = 0;
            
            const models = quizzes[currentQuizId].levels[currentDifficulty];
            const modelIndex = Math.floor(Math.random() * models.length);
            currentModel = models[modelIndex].sort(() => 0.5 - Math.random()).slice(0, 4);

            const levelName = currentDifficulty === 'easy' ? 'ุณูู' : (currentDifficulty === 'medium' ? 'ูุชูุณุท' : 'ุนุงูู');
            quizTitle.textContent = `${quizzes[currentQuizId].title} - ูุณุชูู ${levelName}`;
            showScreen('quiz');
            loadQuestion();
        }

        function startTimer() {
            clearInterval(timer);
            timeLeft = 30; // 30 seconds per question
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if(timeLeft <= 0) {
                    clearInterval(timer);
                    handleTimeOut();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            timeCounter.textContent = `ุงูููุช ุงููุชุจูู: ${toArabicNumerals(timeLeft)} ุซุงููุฉ`;
            timeCounter.classList.toggle('warning', timeLeft <= 10);
        }

        function handleTimeOut() {
            Array.from(optionsGrid.children).forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            const question = currentModel[currentQuestionIndex];
            const correctIndex = question.a;
            
            optionsGrid.children[correctIndex].classList.add('correct');
            explanationText.innerHTML = processContent(question.exp);
            explanationBox.style.display = 'block';
            
            nextQuestionBtn.style.display = 'inline-flex';
        }

        function loadQuestion() {
            clearInterval(timer);
            explanationBox.style.display = 'none';
            nextQuestionBtn.style.display = 'none';
            const question = currentModel[currentQuestionIndex];
            
            questionCounter.textContent = `ุงูุณุคุงู ${toArabicNumerals(currentQuestionIndex + 1)} ูู ${toArabicNumerals(currentModel.length)}`;
            questionText.innerHTML = processContent(question.q);
            optionsGrid.innerHTML = '';

            question.o.forEach((optionText, index) => {
                const option = document.createElement('div');
                option.className = 'option';
                option.innerHTML = processContent(optionText);
                option.dataset.index = index;
                option.addEventListener('click', selectOption);
                optionsGrid.appendChild(option);
            });
            
            startTimer();
        }

        function selectOption(e) {
            clearInterval(timer);
            const selectedOption = e.target.closest('.option');
            const selectedIndex = parseInt(selectedOption.dataset.index);
            const question = currentModel[currentQuestionIndex];
            const correctIndex = question.a;

            Array.from(optionsGrid.children).forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            if (selectedIndex === correctIndex) {
                score++;
                selectedOption.classList.add('correct');
            } else {
                selectedOption.classList.add('incorrect');
                optionsGrid.children[correctIndex].classList.add('correct');
                explanationText.innerHTML = processContent(question.exp);
                explanationBox.style.display = 'block';
            }
            
            nextQuestionBtn.style.display = 'inline-flex';
        }

        function showQuizResult() {
            const totalQuestions = currentModel.length;
            const percentageScore = Math.round((score / totalQuestions) * 100);
            
            const currentLevelData = quizData[currentQuizId].levels[currentDifficulty];
            currentLevelData.score = percentageScore; 
            currentLevelData.completed = true;
            
            const pointsEarned = calculatePoints(score, currentDifficulty);
            const skillId = `d_${currentQuizId}_${currentDifficulty}`;
            saveGradeToSheet(skillId, percentageScore, pointsEarned);

            if(isVisitor) {
                let visitorData = JSON.parse(sessionStorage.getItem('visitorDiagnosticData')) || {};
                visitorData[skillId] = { grade: percentageScore, metricValue: pointsEarned };
                sessionStorage.setItem('visitorDiagnosticData', JSON.stringify(visitorData));
            }
            
            const levelName = currentDifficulty === 'easy' ? 'ุณูู' : (currentDifficulty === 'medium' ? 'ูุชูุณุท' : 'ุนุงูู');
            resultTitle.textContent = `ูุชูุฌุชู ูู ุงููุณุชูู - ${levelName}`;
            resultScore.textContent = `${toArabicNumerals(percentageScore)}%`;
            
            resultPoints.textContent = `ููุฏ ูุณุจุช ${toArabicNumerals(pointsEarned)} ููุทุฉ!`;
            
            const style = getScoreStyle(percentageScore);
            resultIcon.className = `fas ${style.icon} result-icon`;
            resultIcon.style.color = style.class === 'score-high' ? 'var(--score-high)' : (style.class === 'score-medium)' ? 'var(--score-medium)' : 'var(--score-low)');

            retryFromResultBtn.style.display = isVisitor ? 'none' : 'inline-flex';

            showScreen('result');
        }
        
        function updateAndRenderDashboard() {
            // Re-load data from storage to get the latest scores
            const student = isVisitor ? null : { diagnostics: quizData, name: studentName };
            loadQuizData(student);
            renderDashboard();
        }

        // --- Event Listeners ---
        nextQuestionBtn.addEventListener('click', () => {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentModel.length) {
                loadQuestion();
            } else {
                showQuizResult();
            }
        });

        retryFromResultBtn.addEventListener('click', () => {
            startQuiz(currentQuizId, currentDifficulty);
        });

        backToDashboardBtn.addEventListener('click', () => {
            showScreen('dashboard');
            updateAndRenderDashboard();
        });

        /**
         * Main initialization function.
         */
        async function init() {
            const urlParams = new URLSearchParams(window.location.search);
            studentId = urlParams.get('studentId');

            if (!studentId) {
                isVisitor = true;
                loadQuizData(null);
                renderDashboard();
                showScreen('dashboard');
                return;
            }
            
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getStudentData&studentId=${studentId}`);
                const result = await response.json();
                if (result.status === 'success' && result.data) {
                    studentName = result.data.name;
                    loadQuizData(result.data);
                    renderDashboard();
                    showScreen('dashboard');
                } else {
                    isVisitor = true;
                    loadQuizData(null);
                    renderDashboard();
                    showScreen('dashboard');
                }
            } catch (error) {
                console.error("Failed to fetch student data:", error);
                isVisitor = true;
                loadQuizData(null);
                renderDashboard();
                showScreen('dashboard');
            }
        }

        init();
    });
    </script>
</body>
</html>
