<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدرس ٥-١: حل نظام من معادلتين خطيتين بيانياً | منصة الرياضيات التفاعلية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .math-eq {
            font-family: "Courier New", monospace;
            font-size: 1.1rem;
            font-weight: bold;
            color: #4338ca;
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            padding: 2px 8px;
            border-radius: 6px;
            display: inline-block;
            vertical-align: middle;
        }
        .explanation-step { 
            padding-right: 12px; 
            margin-bottom: 1rem; 
            border-right: 3px solid #1d4ed8; 
            transition: opacity 0.5s ease-in-out; 
            min-height: 80px;
        }
        .summary-box {
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .summary-box-blue {
             border-right: 3px solid #2563eb; /* blue-600 */
             background-color: #eff6ff; /* blue-50 */
        }
         .summary-box-blue .highlight-num {
            font-weight: bold;
            color: #1d4ed8; /* blue-700 */
        }
        .summary-box-red {
             border-right: 3px solid #dc2626; /* red-600 */
             background-color: #fee2e2; /* red-50 */
        }
         .summary-box-red .highlight-num {
            font-weight: bold;
            color: #b91c1c; /* red-700 */
        }
        .summary-box-green {
             border-right: 3px solid #16a34a; /* green-600 */
             background-color: #f0fdf4; /* green-50 */
        }
         .summary-box-green .highlight-num {
            font-weight: bold;
            color: #15803d; /* green-700 */
        }
        .nav-btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        .fraction {
            display: inline-flex;
            flex-direction: column;
            text-align: center;
            vertical-align: middle;
            margin: 0 0.2em;
            line-height: 1.2em;
        }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > span:last-child { border-top: 2px solid currentColor; }

        /* Graph Styles */
        .graph-container {
            position: relative;
            width: 100%;
            max-width: 360px;
            height: 360px;
            margin: 20px auto;
            border: 2px solid #9ca3af;
            background-color: #f9fafb;
            overflow: hidden;
        }
        .graph-grid {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(to right, #e5e7eb 1px, transparent 1px), 
                linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .graph-axis { position: absolute; background-color: #9ca3af; }
        .x-axis { width: 100%; height: 2px; }
        .y-axis { height: 100%; width: 2px; }
        .graph-line {
            position: absolute;
            height: 3px;
            transform-origin: 0 50%; /* left center */
            transition: all 0.5s ease-in-out;
            opacity: 0;
        }
        .graph-point {
            position: absolute;
            width: 12px; height: 12px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.5s ease-in-out;
            opacity: 0;
            z-index: 10;
        }
        .graph-movement-line {
            position: absolute;
            border-style: dashed;
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
            z-index: 5;
        }
        .graph-movement-text {
            position: absolute;
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
            z-index: 6;
            font-weight: bold;
            font-size: 0.9rem;
            transform: translate(-50%, -50%);
        }
        .solution-point {
            width: 18px; height: 18px;
            background-color: #f59e0b;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #f59e0b;
            z-index: 20;
            animation: pulse 1.5s infinite;
        }
        .axis-label {
            position: absolute;
            font-size: 10px;
            color: #6b7280;
            background-color: #f9fafb;
            padding: 0 2px;
        }
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="min-h-screen">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-5xl my-8 p-4">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">الدرس ٥-١: حل نظام من معادلتين خطيتين بيانياً</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; العودة إلى الفهرس</a>
                </header>

                <!-- Part 1: Basic Concepts -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفاهيم الأساسية</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <p>نظام المعادلات هو مجموعة من معادلتين خطيتين أو أكثر. وحل النظام هو إيجاد الزوج المرتب (س، ص) الذي يحقق جميع معادلات النظام في نفس الوقت. بيانياً، هذا يعني إيجاد نقطة تقاطع المستقيمات.</p>
                        <div class="bg-white rounded-xl shadow p-4">
                            <h3 class="text-xl font-bold text-center mb-4 text-indigo-700">الحلول الممكنة لنظام من معادلتين</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                                <!-- Case 1: One Solution -->
                                <div class="border rounded-lg p-3 flex flex-col items-center">
                                    <h4 class="font-bold">حل واحد فقط</h4>
                                    <svg class="w-32 h-32 my-2" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                        <line x1="10" y1="90" x2="90" y2="10" stroke="#ef4444" stroke-width="3"/>
                                        <line x1="10" y1="10" x2="90" y2="90" stroke="#3b82f6" stroke-width="3"/>
                                        <circle cx="50" cy="50" r="5" fill="#f59e0b"/>
                                    </svg>
                                    <p class="text-sm">المستقيمان يتقاطعان في نقطة واحدة.</p>
                                    <p class="mt-2"><span class="font-semibold">يُسمى:</span> <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">متسق ومستقل</span></p>
                                </div>
                                <!-- Case 2: Infinite Solutions -->
                                <div class="border rounded-lg p-3 flex flex-col items-center">
                                    <h4 class="font-bold">عدد لا نهائي من الحلول</h4>
                                     <svg class="w-32 h-32 my-2" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                        <line x1="10" y1="10" x2="90" y2="90" stroke="#3b82f6" stroke-width="4"/>
                                        <line x1="10" y1="10" x2="90" y2="90" stroke="#ef4444" stroke-width="4" stroke-dasharray="8, 8"/>
                                    </svg>
                                    <p class="text-sm">المستقيمان متطابقان (نفس المستقيم).</p>
                                    <p class="mt-2"><span class="font-semibold">يُسمى:</span> <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">متسق وغير مستقل</span></p>
                                </div>
                                <!-- Case 3: No Solution -->
                                <div class="border rounded-lg p-3 flex flex-col items-center">
                                    <h4 class="font-bold">لا يوجد حل</h4>
                                     <svg class="w-32 h-32 my-2" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                         <line x1="10" y1="20" x2="90" y2="60" stroke="#ef4444" stroke-width="3"/>
                                         <line x1="10" y1="40" x2="90" y2="80" stroke="#3b82f6" stroke-width="3"/>
                                     </svg>
                                    <p class="text-sm">المستقيمان متوازيان ولا يتقاطعان أبداً.</p>
                                    <p class="mt-2"><span class="font-semibold">يُسمى:</span> <span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs">غير متسق</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Part 2: Interactive Graphing -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">📊 ثانياً: حل النظام بيانياً (تفاعلي)</h2>
                    <div class="space-y-10">
                        <!-- Example 1: One Solution -->
                        <div class="p-6 bg-gray-50 rounded-lg border">
                            <h3 class="text-xl font-bold text-center mb-2">مثال ١: حل واحد</h3>
                            <p class="text-center">حل النظام: <span class="math-eq text-blue-600">ص = -س + ٣</span> و <span class="math-eq text-red-600">ص = ٢س</span></p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-4">
                                <div class="bg-gray-50 p-4 rounded-lg border min-h-[400px] flex flex-col justify-between">
                                    <div>
                                        <div id="summary-container-1"></div>
                                        <div id="graph-exp-1" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="graph-back-1" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="graph-counter-1">1</span> / <span id="graph-total-1">8</span></span>
                                        <button id="graph-next-1" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                                <div id="graph-container-1" class="graph-container">
                                    <div class="graph-grid"></div><div class="graph-axis x-axis" style="top: 50%;"></div><div class="graph-axis y-axis" style="left: 50%;"></div>
                                    <div id="graph-line-1a" class="graph-line bg-blue-500"></div><div id="graph-line-1b" class="graph-line bg-red-500"></div>
                                    <div id="graph-point-1a1" class="graph-point bg-blue-500"></div><div id="graph-point-1a2" class="graph-point bg-blue-500"></div>
                                    <div id="graph-point-1b1" class="graph-point bg-red-500"></div><div id="graph-point-1b2" class="graph-point bg-red-500"></div>
                                    <div id="graph-rise-1a" class="graph-movement-line border-blue-500"></div><div id="graph-run-1a" class="graph-movement-line border-blue-500"></div>
                                    <div id="graph-rise-text-1a" class="graph-movement-text text-blue-600"></div><div id="graph-run-text-1a" class="graph-movement-text text-blue-600"></div>
                                    <div id="graph-rise-1b" class="graph-movement-line border-red-500"></div><div id="graph-run-1b" class="graph-movement-line border-red-500"></div>
                                    <div id="graph-rise-text-1b" class="graph-movement-text text-red-600"></div><div id="graph-run-text-1b" class="graph-movement-text text-red-600"></div>
                                    <div id="solution-point-1" class="graph-point solution-point"></div>
                                </div>
                            </div>
                        </div>
                        <!-- Example 2: No Solution -->
                        <div class="p-6 bg-gray-50 rounded-lg border">
                            <h3 class="text-xl font-bold text-center mb-2">مثال ٢: لا يوجد حل</h3>
                            <p class="text-center">حل النظام: <span class="math-eq text-blue-600">ص = ٢س + ١</span> و <span class="math-eq text-red-600">ص = ٢س - ٢</span></p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-4">
                               <div class="bg-gray-50 p-4 rounded-lg border min-h-[400px] flex flex-col justify-between">
                                    <div>
                                        <div id="summary-container-2"></div>
                                        <div id="graph-exp-2" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="graph-back-2" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="graph-counter-2">1</span> / <span id="graph-total-2">8</span></span>
                                        <button id="graph-next-2" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                                <div id="graph-container-2" class="graph-container">
                                    <div class="graph-grid"></div><div class="graph-axis x-axis" style="top: 50%;"></div><div class="graph-axis y-axis" style="left: 50%;"></div>
                                    <div id="graph-line-2a" class="graph-line bg-blue-500"></div><div id="graph-line-2b" class="graph-line bg-red-500"></div>
                                    <div id="graph-point-2a1" class="graph-point bg-blue-500"></div><div id="graph-point-2a2" class="graph-point bg-blue-500"></div>
                                    <div id="graph-point-2b1" class="graph-point bg-red-500"></div><div id="graph-point-2b2" class="graph-point bg-red-500"></div>
                                    <div id="graph-rise-2a" class="graph-movement-line border-blue-500"></div><div id="graph-run-2a" class="graph-movement-line border-blue-500"></div>
                                    <div id="graph-rise-text-2a" class="graph-movement-text text-blue-600"></div><div id="graph-run-text-2a" class="graph-movement-text text-blue-600"></div>
                                    <div id="graph-rise-2b" class="graph-movement-line border-red-500"></div><div id="graph-run-2b" class="graph-movement-line border-red-500"></div>
                                    <div id="graph-rise-text-2b" class="graph-movement-text text-red-600"></div><div id="graph-run-text-2b" class="graph-movement-text text-red-600"></div>
                                </div>
                            </div>
                        </div>
                        <!-- Example 3: Infinite Solutions -->
                        <div class="p-6 bg-gray-50 rounded-lg border">
                            <h3 class="text-xl font-bold text-center mb-2">مثال ٣: عدد لا نهائي من الحلول</h3>
                            <p class="text-center">حل النظام: <span class="math-eq text-blue-600">ص = س + ١</span> و <span class="math-eq text-red-600">٢ص = ٢س + ٢</span></p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-4">
                                <div class="bg-gray-50 p-4 rounded-lg border min-h-[400px] flex flex-col justify-between">
                                    <div>
                                        <div id="summary-container-3"></div>
                                        <div id="graph-exp-3" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="graph-back-3" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="graph-counter-3">1</span> / <span id="graph-total-3">5</span></span>
                                        <button id="graph-next-3" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                                <div id="graph-container-3" class="graph-container">
                                    <div class="graph-grid"></div><div class="graph-axis x-axis" style="top: 50%;"></div><div class="graph-axis y-axis" style="left: 50%;"></div>
                                    <div id="graph-line-3a" class="graph-line bg-blue-500"></div>
                                    <div id="graph-line-3b" class="graph-line bg-red-500 opacity-70" style="height: 6px;"></div>
                                    <div id="graph-point-3a1" class="graph-point bg-blue-500"></div><div id="graph-point-3a2" class="graph-point bg-blue-500"></div>
                                    <div id="graph-rise-3a" class="graph-movement-line border-blue-500"></div><div id="graph-run-3a" class="graph-movement-line border-blue-500"></div>
                                    <div id="graph-rise-text-3a" class="graph-movement-text text-blue-600"></div><div id="graph-run-text-3a" class="graph-movement-text text-blue-600"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Part 3: Real-life Example -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🏢 ثالثاً: من واقع الحياة</h2>
                       <div class="p-6 bg-gray-50 rounded-lg border">
                            <h3 class="font-bold text-center mb-2">مثال: سباق القراءة</h3>
                            <div class="flex justify-center gap-4 text-center p-4">
                                <div class="bg-blue-100 p-3 rounded-lg border border-blue-300">
                                    <h4 class="font-bold text-blue-800">صالح</h4>
                                    <p>قرأ <span class="font-bold text-lg">٦٥</span> صفحة</p>
                                    <p>ويقرأ <span class="font-bold text-lg">٢٠</span> صفحة يومياً</p>
                                </div>
                                <div class="bg-green-100 p-3 rounded-lg border border-green-300">
                                    <h4 class="font-bold text-green-800">عبدالله</h4>
                                    <p>قرأ <span class="font-bold text-lg">٨٥</span> صفحة</p>
                                    <p>ويقرأ <span class="font-bold text-lg">١٠</span> صفحات يومياً</p>
                                </div>
                            </div>
                            <p class="text-center mt-2">بعد كم يوم يصبح ما قرأه صالح مساوياً لما قرأه عبدالله؟</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-4">
                                <div class="bg-gray-50 p-4 rounded-lg border min-h-[420px] flex flex-col">
                                    <div class="flex-grow">
                                        <div id="summary-container-life"></div>
                                        <div id="life-exp-1" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="life-back-1" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="life-counter-1">1</span> / <span id="life-total-1">11</span></span>
                                        <button id="life-next-1" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                                <div id="life-graph-container" class="graph-container">
                                    <div class="graph-grid"></div>
                                    <div id="life-x-axis" class="graph-axis x-axis"></div><div id="life-y-axis" class="graph-axis y-axis"></div>
                                    <div id="graph-line-life-a" class="graph-line bg-blue-500"></div>
                                    <div id="graph-line-life-b" class="graph-line bg-green-500"></div>
                                    <div id="graph-point-life-a1" class="graph-point bg-blue-500"></div><div id="graph-point-life-a2" class="graph-point bg-blue-500"></div>
                                    <div id="graph-point-life-b1" class="graph-point bg-green-500"></div><div id="graph-point-life-b2" class="graph-point bg-green-500"></div>
                                    <div id="graph-rise-life-a" class="graph-movement-line border-blue-500"></div>
                                    <div id="graph-run-life-a" class="graph-movement-line border-blue-500"></div>
                                    <div id="graph-rise-text-life-a" class="graph-movement-text text-blue-600"></div>
                                    <div id="graph-run-text-life-a" class="graph-movement-text text-blue-600"></div>
                                    <div id="graph-rise-life-b" class="graph-movement-line border-green-500"></div>
                                    <div id="graph-run-life-b" class="graph-movement-line border-green-500"></div>
                                    <div id="graph-rise-text-life-b" class="graph-movement-text text-green-600"></div>
                                    <div id="graph-run-text-life-b" class="graph-movement-text text-green-600"></div>
                                    <div id="solution-point-life" class="graph-point solution-point"></div>
                                </div>
                            </div>
                        </div>
                </section>

                <!-- Part 4: Quiz -->
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">✍️ رابعاً: حان دورك! اختبر فهمك</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-6 rounded-lg text-center">
                        <h3 class="text-xl font-bold">نتيجتك النهائية</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">إعادة الاختبار</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">💡 شرح الإجابة</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    // ==================================================
    // Platform Common Functions
    // ==================================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    function getStudentFromStorage() { const d = localStorage.getItem('currentStudent'); return d ? JSON.parse(d) : null; }
    function buildHeader(studentData, lessonTitle = null) { const h = document.getElementById('main-header'); if (!h) return; let t = lessonTitle ? `<div><h2 class="text-sm text-gray-500 leading-tight">منصة الرياضيات التفاعلية</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>` : `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">منصة الرياضيات التفاعلية</h1></a>`; let u = studentData ? `<div class="flex items-center gap-4"><span class="font-semibold">أهلاً، ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">خروج</a></div>` : `<p class="text-lg text-gray-600">زائر</p>`; h.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${t}${u}</div>`; const l = h.querySelector('#logout-link'); if(l) l.addEventListener('click', () => localStorage.removeItem('currentStudent')); }
    function buildFooter() { const f = document.getElementById('main-footer'); if (f) f.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">© 2024 جميع الحقوق محفوظة | تصميم وتطوير: أ. عبدالعزيز خالد العبلان</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) {
        currentQuestions = questions;
        const qf = document.getElementById('quizForm');
        if (!qf) return;
        if (questions.length === 0) { qf.innerHTML = `<p class="text-center text-gray-600">لا توجد أسئلة متاحة لهذا الدرس حالياً.</p>`; return; }
        let attemptsLeft = studentData ? MAX_ATTEMPTS - (studentData.lessons?.[lessonId]?.attempts || 0) : 1;
        const ac = document.getElementById('attempts-counter');
        if (ac) ac.innerHTML = `المحاولات المتبقية: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`;
        qf.innerHTML = questions.map((q, i) => { const o = q.options.map((opt, oi) => `<div><input type="radio" name="q${i}" value="${opt.value}" id="q${i}_opt${oi}" class="hidden"><label for="q${i}_opt${oi}" class="option-label">${opt.display}</label></div>`).join(''); return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${i + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${o}</div><div id="feedback-q${i}" class="mt-2 text-sm font-bold"></div><div id="explanation-buttons-${i}" class="hidden mt-2 space-x-4 rtl:space-x-reverse"></div></div>`; }).join('') + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">تحقق من إجاباتي</button>`;
        if (attemptsLeft <= 0) { const btn = qf.querySelector('#submit-quiz-btn'); btn.disabled = true; btn.textContent = 'لا توجد محاولات متبقية'; btn.classList.add('bg-gray-400', 'hover:bg-gray-400'); }
        qf.onsubmit = (e) => {
            e.preventDefault();
            let score = 0;
            questions.forEach((q, i) => {
                const ua = e.target.elements[`q${i}`]?.value;
                const fb = document.getElementById(`feedback-q${i}`);
                const bc = document.getElementById(`explanation-buttons-${i}`);
                bc.innerHTML = '';
                if (ua === q.correct) { score++; fb.textContent = '✔ إجابة صحيحة!'; fb.className = 'mt-2 text-sm font-bold text-green-600'; } else { fb.textContent = `❌ إجابة خاطئة.`; fb.className = 'mt-2 text-sm font-bold text-red-600'; }
                bc.classList.remove('hidden');
                const stdBtn = document.createElement('button'); stdBtn.type = 'button'; stdBtn.textContent = 'اعرف لماذا؟'; stdBtn.className = 'text-xs text-blue-600 hover:underline'; stdBtn.onclick = () => window.showExplanation(i, 'standard'); bc.appendChild(stdBtn);
                if (q.smartExplanation) { const smtBtn = document.createElement('button'); smtBtn.type = 'button'; smtBtn.innerHTML = '🧠 الحل الذكي'; smtBtn.className = 'text-xs text-purple-600 hover:underline font-bold'; smtBtn.onclick = () => window.showExplanation(i, 'smart'); bc.appendChild(smtBtn); }
            });
            const finalGrade = Math.round((score / questions.length) * 10);
            const rd = document.getElementById('quiz-results'); rd.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`;
            if (studentData) { saveGrade(lessonId, finalGrade, studentData.id); if (attemptsLeft - 1 > 0) document.getElementById('retake-quiz-btn').classList.remove('hidden'); } else { document.getElementById('save-status').textContent = 'تم عرض نتيجتك. سجل الدخول لحفظ تقدمك.'; }
            e.target.querySelector('#submit-quiz-btn').disabled = true;
        };
    }
    function saveGrade(lessonId, grade, studentId) { if (!studentId) return; const ss = document.getElementById('save-status'); ss.textContent = 'جارٍ حفظ نتيجتك...'; fetch(`${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&lessonId=${lessonId}&grade=${grade}`).then(res => res.json()).then(result => { if (result.status === 'success') { ss.textContent = '✔ تم حفظ نتيجتك بنجاح!'; const sd = JSON.parse(localStorage.getItem('currentStudent')); if (!sd.lessons) sd.lessons = {}; if (!sd.lessons[lessonId] || sd.lessons[lessonId].grade < grade) { sd.lessons[lessonId] = { grade: grade, attempts: (sd.lessons[lessonId]?.attempts || 0) + 1 }; } else { sd.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(sd)); } else { throw new Error(result.message); } }).catch(error => { ss.textContent = '❌ حدث خطأ أثناء حفظ الدرجة.'; console.error("Save Grade Error:", error); }); }
    window.showExplanation = (i, type) => { const q = currentQuestions[i]; const m = document.getElementById('explanationModal'); const et = document.getElementById('explanationText'); if (!m || !et || !q) return; et.innerHTML = (type === 'smart' && q.smartExplanation) ? `<p>${q.smartExplanation}</p>` : `<p>${q.explanation}</p>`; m.classList.remove('hidden'); }
    function closeModal() { const m = document.getElementById('explanationModal'); if(m) m.classList.add('hidden'); }
    
    // ==================================================
    // Lesson Specific Code
    // ==================================================
    const LESSON_ID = 'c5_l1'; 
    
    function generateQuiz() {
        const questionBank = [
            { type: 'mcq', level: '⭐', text: 'عندما يكون لنظام المعادلات حل واحد فقط، كيف تبدو المستقيمات على الرسم البياني؟', options: [ { display: 'متوازية', value: 'A' }, { display: 'متقاطعة', value: 'B' }, { display: 'متطابقة', value: 'C' }, { display: 'متعامدة', value: 'D' } ], correct: 'B', explanation: 'الحل الوحيد للنظام هو نقطة التقاطع بين المستقيمين.' },
            { type: 'mcq', level: '⭐', text: 'ماذا يسمى نظام المعادلات الذي لا يوجد له حل؟', options: [ { display: 'متسق ومستقل', value: 'A' }, { display: 'متسق وغير مستقل', value: 'B' }, { display: 'غير متسق', value: 'C' }, { display: 'مستقل', value: 'D' } ], correct: 'C', explanation: 'النظام الذي لا يوجد له حل (مستقيمان متوازيان) يسمى نظاماً غير متسق.' },
            { type: 'mcq', level: '⭐⭐', text: 'كم عدد الحلول لنظام المعادلات: ص = ٣س + ٥ و ص = ٣س - ١ ؟', options: [ { display: 'حل واحد', value: 'A' }, { display: 'حلان', value: 'B' }, { display: 'عدد لا نهائي', value: 'C' }, { display: 'لا يوجد حل', value: 'D' } ], correct: 'D', explanation: 'للمعادلتين نفس الميل (٣) ومقطع صادي مختلف. هذا يعني أنهما متوازيان، وبالتالي لا يوجد حل.', smartExplanation: 'بما أن الميل متساوٍ والمقطع مختلف، فالمستقيمان متوازيان. لا يمكن أن يتقاطعا.' },
            { type: 'mcq', level: '⭐⭐', text: 'ما هو حل النظام الممثل بالمعادلتين: ص = س + ٢ و ص = -س + ٤ ؟', options: [ { display: '(١، ٣)', value: 'A' }, { display: '(٣، ١)', value: 'B' }, { display: '(٢، ٢)', value: 'C' }, { display: '(٠، ٤)', value: 'D' } ], correct: 'A', explanation: 'بالتعويض بالنقطة (١، ٣) في المعادلتين: المعادلة الأولى: ٣ = ١ + ٢ (صحيحة). المعادلة الثانية: ٣ = -١ + ٤ (صحيحة). إذن (١، ٣) هو الحل.' },
            { type: 'mcq', level: '⭐⭐⭐', text: 'أي نظام من المعادلات التالية هو نظام متسق وغير مستقل؟', options: [ { display: 'ص = س + ١<br>ص = س + ٢', value: 'A' }, { display: 'ص = ٢س<br>ص = -٢س', value: 'B' }, { display: 'ص = س + ٣<br>٢ص = ٢س + ٦', value: 'C' }, { display: 'ص = ٤س<br>ص = س + ٤', value: 'D' } ], correct: 'C', explanation: 'النظام المتسق وغير المستقل له عدد لا نهائي من الحلول (نفس المستقيم). إذا قسمنا المعادلة الثانية (٢ص = ٢س + ٦) على ٢، نحصل على ص = س + ٣، وهي نفس المعادلة الأولى.' },
            { type: 'mcq', level: '⭐', text: 'إذا كان المستقيمان متطابقين، فكم عدد الحلول للنظام؟', options: [ { display: 'صفر', value: 'A' }, { display: 'واحد', value: 'B' }, { display: 'اثنان', value: 'C' }, { display: 'عدد لا نهائي', value: 'D' } ], correct: 'D', explanation: 'المستقيمان المتطابقان يشتركان في جميع النقاط، لذا يوجد عدد لا نهائي من الحلول.' },
            { type: 'mcq', level: '⭐⭐', text: 'حل النظام: س + ص = ٥ و س - ص = ١', options: [ { display: '(٢، ٣)', value: 'A' }, { display: '(٣، ٢)', value: 'B' }, { display: '(٤، ١)', value: 'C' }, { display: '(١، ٤)', value: 'D' } ], correct: 'B', explanation: 'بتحويل المعادلتين إلى صيغة الميل والمقطع: ص = -س + ٥ و ص = س - ١. بالتعويض بالنقطة (٣، ٢): ٢ = -٣ + ٥ (صحيح)، ٢ = ٣ - ١ (صحيح).' },
            { type: 'mcq', level: '⭐⭐⭐', text: 'إذا كان ميل المستقيم الأول يساوي ميل المستقيم الثاني، ولكن المقطع الصادي مختلف، فما نوع الحل؟', options: [ { display: 'حل وحيد', value: 'A' }, { display: 'لا يوجد حل', value: 'B' }, { display: 'عدد لا نهائي من الحلول', value: 'C' }, { display: 'لا يمكن التحديد', value: 'D' } ], correct: 'B', explanation: 'هذه هي حالة المستقيمين المتوازيين، وهما لا يتقاطعان أبداً.' },
            { type: 'mcq', level: '⭐⭐', text: 'ما هي نقطة تقاطع المستقيمين ص = ٥ و س = ٢ ؟', options: [ { display: '(٥، ٢)', value: 'A' }, { display: '(٠، ٥)', value: 'B' }, { display: '(٢، ٠)', value: 'C' }, { display: '(٢، ٥)', value: 'D' } ], correct: 'D', explanation: 'المستقيم ص=٥ هو خط أفقي، والمستقيم س=٢ هو خط رأسي. يتقاطعان عند النقطة التي يكون فيها الإحداثي السيني ٢ والصادي ٥.' },
            { type: 'mcq', level: '⭐', text: 'أي مما يلي يصف نظاماً متسقاً ومستقلاً؟', options: [ { display: 'مستقيمان متوازيان', value: 'A' }, { display: 'مستقيمان متقاطعان', value: 'B' }, { display: 'مستقيمان متطابقان', value: 'C' }, { display: 'لا شيء مما سبق', value: 'D' } ], correct: 'B', explanation: 'النظام المتسق والمستقل له حل واحد فقط، وهو ما يحدث عندما يتقاطع المستقيمان.' },
            { type: 'mcq', level: '⭐⭐⭐', text: 'نظام المعادلات ص = أس + ٣ و ص = ٢س + ب له حل وحيد. ماذا تستنتج عن قيمة أ؟', options: [ { display: 'أ = ٢', value: 'A' }, { display: 'أ لا يساوي ٢', value: 'B' }, { 'display': 'أ = ب', value: 'C' }, { display: 'أ لا يساوي ب', value: 'D' } ], correct: 'B', explanation: 'لكي يكون هناك حل وحيد، يجب أن يكون للمستقيمين ميل مختلف. ميل المستقيم الثاني هو ٢، لذا يجب أن لا يساوي ميل المستقيم الأول (أ) القيمة ٢.' },
            { type: 'mcq', level: '⭐⭐', text: 'أي نقطة تقع على المستقيم ٢س + ص = ٨؟', options: [ { display: '(١، ٦)', value: 'A' }, { display: '(٢، ٥)', value: 'B' }, { display: '(٤، ١)', value: 'C' }, { display: '(٥، -١)', value: 'D' } ], correct: 'A', explanation: 'نعوض بالنقطة (١، ٦) في المعادلة: ٢(١) + ٦ = ٢ + ٦ = ٨. المعادلة صحيحة.' }
        ];
        return [...questionBank].sort(() => 0.5 - Math.random()).slice(0, 5);
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        const student = getStudentFromStorage();
        const lessonTitle = document.getElementById('lesson-title')?.textContent;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        document.getElementById('retake-quiz-btn')?.addEventListener('click', () => window.location.reload());
        document.getElementById('closeModalBtn')?.addEventListener('click', closeModal);

        function createInteractiveSection(config) {
            let currentStep = 0;
            const totalSteps = config.stepsContent.length;
            
            if(config.totalStepsCounter) config.totalStepsCounter.textContent = totalSteps;

            const renderStep = (step) => {
                if(config.stepCounter) config.stepCounter.textContent = step + 1;
                
                const summaryContainer = document.getElementById(config.summaryContainerId);
                if (summaryContainer) {
                    summaryContainer.innerHTML = ''; 
                    if (config.summaries) {
                        config.summaries.forEach(s => {
                            if (step >= s.step) {
                                const summaryEl = document.createElement('div');
                                summaryEl.className = `summary-box ${s.colorClass}`;
                                summaryEl.innerHTML = s.html;
                                summaryContainer.appendChild(summaryEl);
                            }
                        });
                    }
                }

                config.explanationDiv.innerHTML = `<div class="explanation-step" style="opacity:1; border-color: ${step > 0 && config.stepsContent[step] ? '#1d4ed8' : 'transparent'};">${config.stepsContent[step] || ''}</div>`;
                
                if (config.customRender) config.customRender(step);
                if(config.backBtn) config.backBtn.disabled = (step === 0);
                if(config.nextBtn) config.nextBtn.textContent = (step === totalSteps - 1) ? 'إعادة' : 'التالي';
            };
            config.nextBtn?.addEventListener('click', () => { currentStep = (currentStep < totalSteps - 1) ? currentStep + 1 : 0; renderStep(currentStep); });
            config.backBtn?.addEventListener('click', () => { if (currentStep > 0) { currentStep--; renderStep(currentStep); } });
            renderStep(0);
        }

        const unit = 20;

        function setupGraphElements(step, config) {
            const { p1, p2, line, riseLine, runLine, riseText, runText, p1_coords, p2_coords, riseVal, runVal, scaleX = 1, scaleY = 1, origin = {x: 50, y: 50} } = config;
            const getPos = (coords) => ({ x: (coords.x / scaleX) * unit, y: (coords.y / scaleY) * unit });
            const p1_pos = getPos(p1_coords);
            
            [p1, p2, line, riseLine, runLine, riseText, runText].forEach(el => { if(el) el.style.opacity = '0' });
            if(line) line.style.width = '0px';

            if (p1 && step >= config.p1_step) {
                p1.style.opacity = '1'; p1.style.top = `calc(${origin.y}% - ${p1_pos.y}px)`; p1.style.left = `calc(${origin.x}% + ${p1_pos.x}px)`;
            }
            if (p2 && step >= config.p2_step) {
                const p2_pos = getPos(p2_coords);
                if(riseLine) {
                    riseLine.style.opacity = '1';
                    riseLine.style.top = `calc(${origin.y}% - ${Math.max(p1_pos.y, p2_pos.y)}px)`;
                    riseLine.style.left = `calc(${origin.x}% + ${p1_pos.x}px)`;
                    riseLine.style.height = `${Math.abs(p1_pos.y - p2_pos.y)}px`;
                    riseLine.style.borderLeftWidth = '2px';
                }
                if(riseText) {
                    riseText.style.opacity = '1';
                    riseText.textContent = riseVal > 0 ? `+${riseVal}`: `${riseVal}`;
                    riseText.style.top = `calc(${origin.y}% - ${p1_pos.y + (p2_pos.y - p1_pos.y)/2}px)`;
                    riseText.style.left = `calc(${origin.x}% + ${p1_pos.x - 15}px)`;
                }
                if(runLine) {
                    runLine.style.opacity = '1';
                    runLine.style.top = `calc(${origin.y}% - ${p2_pos.y}px)`;
                    runLine.style.left = `calc(${origin.x}% + ${Math.min(p1_pos.x, p2_pos.x)}px)`;
                    runLine.style.width = `${Math.abs(p1_pos.x - p2_pos.x)}px`;
                    runLine.style.borderTopWidth = '2px';
                }
                if(runText) {
                    runText.style.opacity = '1';
                    runText.textContent = runVal > 0 ? `+${runVal}`: `${runVal}`;
                    runText.style.top = `calc(${origin.y}% - ${p2_pos.y - 15}px)`;
                    runText.style.left = `calc(${origin.x}% + ${p1_pos.x + (p2_pos.x - p1_pos.x)/2}px)`;
                }
                p2.style.opacity = '1';
                p2.style.top = `calc(${origin.y}% - ${p2_pos.y}px)`;
                p2.style.left = `calc(${origin.x}% + ${p2_pos.x}px)`;
            }
            if (line && step >= config.line_step) {
                const extended_p1 = getPos({x: p1_coords.x - runVal * 10, y: p1_coords.y - riseVal * 10});
                const extended_p2 = getPos({x: p1_coords.x + runVal * 10, y: p1_coords.y + riseVal * 10});
                const dx = extended_p2.x - extended_p1.x;
                const dy = extended_p2.y - extended_p1.y;
                const length = Math.sqrt(dx*dx + dy*dy);
                const angle = Math.atan2(dy, dx) * (180 / Math.PI);
                line.style.opacity = '1';
                line.style.width = `${length}px`;
                line.style.top = `calc(${origin.y}% - ${extended_p1.y}px)`;
                line.style.left = `calc(${origin.x}% + ${extended_p1.x}px)`;
                line.style.transform = `rotate(${-angle}deg)`;
            }
        }
        
        // Example 1: One Solution
        createInteractiveSection({
            nextBtn: document.getElementById('graph-next-1'), backBtn: document.getElementById('graph-back-1'),
            stepCounter: document.getElementById('graph-counter-1'), 
            totalStepsCounter: document.getElementById('graph-total-1'),
            explanationDiv: document.getElementById('graph-exp-1'),
            summaryContainerId: 'summary-container-1',
            summaries: [
                { step: 3, colorClass: 'summary-box-blue', html: "<b>المستقيم الأزرق:</b> ص = -س + <span class='highlight-num'>٣</span><br><b>الميل:</b> <span class='highlight-num'>-١</span> | <b>المقطع ص:</b> <span class='highlight-num'>٣</span>" },
                { step: 7, colorClass: 'summary-box-red', html: "<b>المستقيم الأحمر:</b> ص = <span class='highlight-num'>٢</span>س + <span class='highlight-num'>٠</span><br><b>الميل:</b> <span class='highlight-num'>٢</span> | <b>المقطع ص:</b> <span class='highlight-num'>٠</span>" }
            ],
            stepsContent: [
                "اضغط على 'التالي' لبدء المثال.",
                "<strong>1. المعادلة <span class='text-blue-600'>ص = -س + ٣</span>:</strong><br>نحدد المقطع الصادي (ب = ٣) عند النقطة (٠، ٣).",
                "<strong>2. نستخدم الميل <span class='text-blue-600'>م = <span class='math-eq'><span class='fraction'><span>-١</span><span>١</span></span></span></span>:</strong><br>نتحرك للأسفل ١ ولليمين ١ لنجد النقطة الثانية (١، ٢).",
                "<strong>3. نرسم المستقيم الأول.</strong>",
                "والآن، لنرسم المستقيم الثاني.",
                "<strong>4. المعادلة <span class='text-red-600'>ص = ٢س</span>:</strong><br>نحدد المقطع الصادي (ب = ٠) عند النقطة (٠، ٠).",
                "<strong>5. نستخدم الميل <span class='text-red-600'>م = <span class='math-eq'><span class='fraction'><span>+٢</span><span>١</span></span></span></span>:</strong><br>نتحرك للأعلى ٢ ولليمين ١ لنجد النقطة الثانية (١، ٢).",
                "<strong>6. نرسم المستقيم الثاني.</strong>",
                "<strong>7. تحليل الحل:</strong><br>بما أن المستقيمان متقاطعان، فإن حل النظام هو نقطة التقاطع <span class='math-eq bg-amber-100'>(١، ٢)</span>."
            ],
            customRender: (step) => {
                const solPoint = document.getElementById('solution-point-1');
                solPoint.style.opacity = '0';
                setupGraphElements(step, { p1: document.getElementById('graph-point-1a1'), p2: document.getElementById('graph-point-1a2'), line: document.getElementById('graph-line-1a'), riseLine: document.getElementById('graph-rise-1a'), runLine: document.getElementById('graph-run-1a'), riseText: document.getElementById('graph-rise-text-1a'), runText: document.getElementById('graph-run-text-1a'), p1_coords: {x: 0, y: 3}, p2_coords: {x: 1, y: 2}, riseVal: -1, runVal: 1, p1_step: 1, p2_step: 2, line_step: 3 });
                setupGraphElements(step, { p1: document.getElementById('graph-point-1b1'), p2: document.getElementById('graph-point-1b2'), line: document.getElementById('graph-line-1b'), riseLine: document.getElementById('graph-rise-1b'), runLine: document.getElementById('graph-run-1b'), riseText: document.getElementById('graph-rise-text-1b'), runText: document.getElementById('graph-run-text-1b'), p1_coords: {x: 0, y: 0}, p2_coords: {x: 1, y: 2}, riseVal: 2, runVal: 1, p1_step: 5, p2_step: 6, line_step: 7 });
                if (step >= 8) { solPoint.style.opacity = '1'; solPoint.style.top = `calc(50% - ${2 * unit}px)`; solPoint.style.left = `calc(50% + ${1 * unit}px)`; }
            }
        });

        // Example 2: No Solution
        createInteractiveSection({
            nextBtn: document.getElementById('graph-next-2'), backBtn: document.getElementById('graph-back-2'),
            stepCounter: document.getElementById('graph-counter-2'), 
            totalStepsCounter: document.getElementById('graph-total-2'),
            explanationDiv: document.getElementById('graph-exp-2'),
            summaryContainerId: 'summary-container-2',
            summaries: [ 
                { step: 3, colorClass: 'summary-box-blue', html: "<b>المستقيم الأزرق:</b> ص = <span class='highlight-num'>٢</span>س + <span class='highlight-num'>١</span><br><b>الميل:</b> <span class='highlight-num'>٢</span> | <b>المقطع ص:</b> <span class='highlight-num'>١</span>" },
                { step: 6, colorClass: 'summary-box-red', html: "<b>المستقيم الأحمر:</b> ص = <span class='highlight-num'>٢</span>س - <span class='highlight-num'>٢</span><br><b>الميل:</b> <span class='highlight-num'>٢</span> | <b>المقطع ص:</b> <span class='highlight-num'>-٢</span>" }
            ],
            stepsContent: [
                 "اضغط على 'التالي' لبدء المثال.",
                "<strong>1. المعادلة <span class='text-blue-600'>ص = ٢س + ١</span>:</strong><br>المقطع الصادي هو ١ (النقطة (٠، ١)).",
                "<strong>2. نستخدم الميل <span class='text-blue-600'>م = <span class='math-eq'><span class='fraction'><span>+٢</span><span>١</span></span></span></span>:</strong><br>نتحرك للأعلى ٢ ولليمين ١ لنجد النقطة (١، ٣).",
                "<strong>3. نرسم المستقيم الأول.</strong>",
                "والآن، لنرسم المستقيم الثاني.",
                "<strong>4. المعادلة <span class='text-red-600'>ص = ٢س - ٢</span>:</strong><br>المقطع الصادي هو -٢ (النقطة (٠، -٢)).",
                "<strong>5. نستخدم الميل <span class='text-red-600'>م = <span class='math-eq'><span class='fraction'><span>+٢</span><span>١</span></span></span></span>:</strong><br>نتحرك للأعلى ٢ ولليمين ١ لنجد النقطة (١، ٠).",
                "<strong>6. نرسم المستقيم الثاني.</strong>",
                "<strong>7. تحليل الحل:</strong><br>بما أن المستقيمان لهما نفس الميل ومقطع صادي مختلف، فهما متوازيان ولا يتقاطعان أبداً. <span class='math-eq bg-red-100'>لا يوجد حل</span>."
            ],
            customRender: (step) => {
                setupGraphElements(step, { p1: document.getElementById('graph-point-2a1'), p2: document.getElementById('graph-point-2a2'), line: document.getElementById('graph-line-2a'), riseLine: document.getElementById('graph-rise-2a'), runLine: document.getElementById('graph-run-2a'), riseText: document.getElementById('graph-rise-text-2a'), runText: document.getElementById('graph-run-text-2a'), p1_coords: {x: 0, y: 1}, p2_coords: {x: 1, y: 3}, riseVal: 2, runVal: 1, p1_step: 1, p2_step: 2, line_step: 3 });
                setupGraphElements(step, { p1: document.getElementById('graph-point-2b1'), p2: document.getElementById('graph-point-2b2'), line: document.getElementById('graph-line-2b'), riseLine: document.getElementById('graph-rise-2b'), runLine: document.getElementById('graph-run-2b'), riseText: document.getElementById('graph-rise-text-2b'), runText: document.getElementById('graph-run-text-2b'), p1_coords: {x: 0, y: -2}, p2_coords: {x: 1, y: 0}, riseVal: 2, runVal: 1, p1_step: 5, p2_step: 6, line_step: 7 });
            }
        });

        // Example 3: Infinite Solutions
        createInteractiveSection({
            nextBtn: document.getElementById('graph-next-3'), backBtn: document.getElementById('graph-back-3'),
            stepCounter: document.getElementById('graph-counter-3'), 
            totalStepsCounter: document.getElementById('graph-total-3'),
            explanationDiv: document.getElementById('graph-exp-3'),
            summaryContainerId: 'summary-container-3',
            summaries: [ { step: 4, colorClass: 'summary-box-blue', html: "<b>المعادلتان:</b> ص = س + <span class='highlight-num'>١</span><br><b>الميل:</b> <span class='highlight-num'>١</span> | <b>المقطع ص:</b> <span class='highlight-num'>١</span>" } ],
            stepsContent: [
                "اضغط على 'التالي' لبدء المثال.",
                "<strong>1. تبسيط المعادلة <span class='text-red-600'>٢ص = ٢س + ٢</span>:</strong><br>بقسمة كل الحدود على ٢، نحصل على <span class='text-red-600'>ص = س + ١</span>.",
                "<strong>2. نمثل المعادلة <span class='text-blue-600'>ص = س + ١</span>:</strong><br>المقطع الصادي هو ١ (النقطة (٠، ١)).",
                "<strong>3. نستخدم الميل <span class='text-blue-600'>م = <span class='math-eq'><span class='fraction'><span>+١</span><span>١</span></span></span></span>:</strong><br>نتحرك للأعلى ١ ولليمين ١ لنجد النقطة (١، ٢).",
                "<strong>4. نرسم المستقيم ونعرض الملخص.</strong>",
                "<strong>5. تحليل الحل:</strong><br>بما أن المعادلتين تمثلان نفس المستقيم، فإنهما متطابقان. يوجد <span class='math-eq bg-green-100'>عدد لا نهائي من الحلول</span>."
            ],
            customRender: (step) => {
                 const line2 = document.getElementById('graph-line-3b');
                 line2.style.opacity = '0';
                 setupGraphElements(step, { p1: document.getElementById('graph-point-3a1'), p2: document.getElementById('graph-point-3a2'), line: document.getElementById('graph-line-3a'), riseLine: document.getElementById('graph-rise-3a'), runLine: document.getElementById('graph-run-3a'), riseText: document.getElementById('graph-rise-text-3a'), runText: document.getElementById('graph-run-text-3a'), p1_coords: {x: 0, y: 1}, p2_coords: {x: 1, y: 2}, riseVal: 1, runVal: 1, p1_step: 2, p2_step: 3, line_step: 4 });
                 if (step >= 4) {
                     line2.style.opacity = '0.7';
                     setupGraphElements(step, { p1: {style:{}}, line: line2, p1_coords: {x: 0, y: 1}, p2_coords: {x: 1, y: 2}, riseVal: 1, runVal: 1, p1_step: 2, p2_step: 3, line_step: 4 });
                 }
            }
        });
        
        // Life Example
        createInteractiveSection({ 
            nextBtn: document.getElementById('life-next-1'), backBtn: document.getElementById('life-back-1'), 
            stepCounter: document.getElementById('life-counter-1'), 
            totalStepsCounter: document.getElementById('life-total-1'),
            explanationDiv: document.getElementById('life-exp-1'), 
            summaryContainerId: 'summary-container-life',
            summaries: [
                { step: 4, colorClass: 'summary-box-blue', html: "<b>صالح:</b> ص = ٢٠س + ٦٥<br><b>الميل:</b> <span class='highlight-num'>٢٠</span> | <b>المقطع ص:</b> <span class='highlight-num'>٦٥</span>" },
                { step: 8, colorClass: 'summary-box-green', html: "<b>عبدالله:</b> ص = ١٠س + ٨٥<br><b>الميل:</b> <span class='highlight-num'>١٠</span> | <b>المقطع ص:</b> <span class='highlight-num'>٨٥</span>" }
            ],
            stepsContent: [ 
                "اضغط على 'التالي' لبدء تحليل المثال.",
                "<strong>1. معادلة صالح:</strong><br>بدأ بـ ٦٥ صفحة (المقطع الصادي) ويقرأ ٢٠ صفحة يومياً (الميل).<br>المعادلة هي <span class='math-eq text-blue-600'>ص = ٢٠س + ٦٥</span>",
                "<strong>2. نمثل معادلة صالح:</strong><br>نحدد المقطع الصادي (ب = ٦٥) عند النقطة (٠، ٦٥).",
                "<strong>3. نستخدم الميل <span class='text-blue-600'>م = <span class='math-eq'><span class='fraction'><span>+٢٠</span><span>١</span></span></span></span>:</strong><br>نتحرك للأعلى ٢٠ (من ٦٥ إلى ٨٥) ولليمين ١ لنجد النقطة الثانية (١، ٨٥).",
                "<strong>4. نرسم مستقيم صالح.</strong>",
                "<strong>5. معادلة عبدالله:</strong><br>بدأ بـ ٨٥ صفحة (المقطع الصادي) ويقرأ ١٠ صفحات يومياً (الميل).<br>المعادلة هي <span class='math-eq text-green-600'>ص = ١٠س + ٨٥</span>",
                "<strong>6. نمثل معادلة عبدالله:</strong><br>نحدد المقطع الصادي (ب = ٨٥) عند النقطة (٠، ٨٥).",
                "<strong>7. نستخدم الميل <span class='text-green-600'>م = <span class='math-eq'><span class='fraction'><span>+١٠</span><span>١</span></span></span></span>:</strong><br>نتحرك للأعلى ١٠ (من ٨٥ إلى ٩٥) ولليمين ١ لنجد النقطة الثانية (١، ٩٥).",
                "<strong>8. نرسم مستقيم عبدالله.</strong>",
                "<strong>9. نحدد نقطة التقاطع.</strong><br>يتقاطع المستقيمان عند النقطة (٢، ١٠٥).",
                "<strong>10. تحليل الحل:</strong><br>الحل <span class='math-eq bg-amber-100'>(٢، ١٠٥)</span> يعني أنه بعد يومين (س=٢) سيكون كلاهما قد قرأ ١٠٥ صفحات."
            ],
            customRender: (step) => {
                const container = document.getElementById('life-graph-container');
                const xAxis = document.getElementById('life-x-axis');
                const yAxis = document.getElementById('life-y-axis');
                
                const origin = { x: 25, y: 85 };
                xAxis.style.top = `${origin.y}%`;
                yAxis.style.left = `${origin.x}%`;

                if (!container.dataset.labelsDrawn) {
                    const drawAxisLabels = () => {
                        const graphSize = 360;
                        for(let i = -5; i <= 12; i++) {
                            const val = i * 10;
                            const label = document.createElement('span');
                            label.className = 'axis-label';
                            label.textContent = val;
                            label.style.top = `${graphSize * (origin.y/100) - (val / 10) * unit - 8}px`; 
                            label.style.left = `${graphSize * (origin.x/100) + 5}px`;
                            container.appendChild(label);
                        }
                        for(let i = -4; i <= 14; i++) {
                            if (i === 0) continue;
                            const label = document.createElement('span');
                            label.className = 'axis-label';
                            label.textContent = i;
                            label.style.top = `${graphSize * (origin.y/100) + 5}px`; 
                            label.style.left = `${graphSize * (origin.x/100) + (i/1) * unit - 5}px`;
                            container.appendChild(label);
                        }
                    }
                    drawAxisLabels();
                    container.dataset.labelsDrawn = 'true';
                }

                const solPoint = document.getElementById('solution-point-life');
                solPoint.style.opacity = '0';
                const lifeConfig = { scaleX: 1, scaleY: 10, origin: origin };
                
                // Saleh's Line
                setupGraphElements(step, { ...lifeConfig, p1: document.getElementById('graph-point-life-a1'), p2: document.getElementById('graph-point-life-a2'), line: document.getElementById('graph-line-life-a'), riseLine: document.getElementById('graph-rise-life-a'), runLine: document.getElementById('graph-run-life-a'), riseText: document.getElementById('graph-rise-text-life-a'), runText: document.getElementById('graph-run-text-life-a'), p1_coords: {x: 0, y: 65}, p2_coords: {x: 1, y: 85}, riseVal: 20, runVal: 1, p1_step: 2, p2_step: 3, line_step: 4 });
                
                // Abdullah's Line
                setupGraphElements(step, { ...lifeConfig, p1: document.getElementById('graph-point-life-b1'), p2: document.getElementById('graph-point-life-b2'), line: document.getElementById('graph-line-life-b'), riseLine: document.getElementById('graph-rise-life-b'), runLine: document.getElementById('graph-run-life-b'), riseText: document.getElementById('graph-rise-text-life-b'), runText: document.getElementById('graph-run-text-life-b'), p1_coords: {x: 0, y: 85}, p2_coords: {x: 1, y: 95}, riseVal: 10, runVal: 1, p1_step: 6, p2_step: 7, line_step: 8 });
                
                if (step >= 9) {
                    solPoint.style.opacity = '1';
                    solPoint.style.top = `calc(${origin.y}% - ${(105 / 10) * unit}px)`;
                    solPoint.style.left = `calc(${origin.x}% + ${(2 / 1) * unit}px)`;
                }
            }
        });
    });
    </script>
</body>
</html>
