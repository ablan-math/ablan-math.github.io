<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدرس ١-٢: حل المعادلات ذات الخطوة الواحدة | منصة الرياضيات التفاعلية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-change { color: #ef4444; font-weight: bold; }
        
        /* === تعديل الرموز الرياضية === */
        .math-eq {
            font-family: "Courier New", monospace; /* خط عريض ومتباعد */
            font-size: 1.1rem; 
            font-weight: bold;
            color: #4338ca;
            background-color: #f3f4f6; /* خلفية رمادية فاتحة */
            border: 1px solid #d1d5db; /* إطار خفيف */
            padding: 2px 8px; /* هوامش داخلية */
            border-radius: 6px; /* زوايا دائرية */
            display: inline-block;
            vertical-align: middle; /* محاذاة أفضل مع النص */
            white-space: nowrap;
        }
        
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">الدرس ١-٢: حل المعادلات ذات الخطوة الواحدة</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; العودة إلى الفهرس</a>
                </header>
                
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفهوم الأساسي</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                        <p>لحل معادلة، هدفنا هو <span class="vocab-term">عزل المتغير</span> في طرف لوحده. لفعل ذلك، نستخدم <span class="vocab-term">العمليات العكسية</span>.</p>
                        <p>تذكر دائماً: <strong class="text-red-600">أي عملية تجريها على طرف من المعادلة، يجب أن تجريها على الطرف الآخر أيضاً</strong>. عندما تفعل ذلك، فأنت تنشئ <span class="vocab-term">معادلات متكافئة</span>، وهي معادلات لها نفس الحل.</p>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: أمثلة تفاعلية على الجمع والطرح</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Example 1 -->
                            <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-2">مثال ١: الحل بالجمع</p>
                                <p class="text-md mb-4 pb-2 border-b">حل المعادلة: <span class="math-eq">ص - ٢٧ = ١٩</span></p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد العملية</h4><p>المتغير <span class="math-eq">ص</span> مطروح منه <span class="math-eq">٢٧</span>. العملية العكسية للطرح هي الجمع.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تطبيق العملية العكسية</h4><p>نضيف <span class="math-eq">٢٧</span> إلى <strong class="text-red-600">كلا الطرفين</strong>.</p><p class="math-eq text-center mt-2">ص - ٢٧ <span class="highlight-change">+ ٢٧</span> = ١٩ <span class="highlight-change">+ ٢٧</span></p></div>
                                    <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">ص = ٤٦</span></p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                            <!-- Example 2 -->
                            <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-2">مثال ٢: الحل بالطرح</p>
                                <p class="text-md mb-4 pb-2 border-b">حل المعادلة: <span class="math-eq">م + ١٢ = ١٥</span></p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد العملية</h4><p>المتغير <span class="math-eq">م</span> مضاف إليه <span class="math-eq">١٢</span>. العملية العكسية للجمع هي الطرح.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تطبيق العملية العكسية</h4><p>نطرح <span class="math-eq">١٢</span> من <strong class="text-red-600">كلا الطرفين</strong>.</p><p class="math-eq text-center mt-2">م + ١٢ <span class="highlight-change">- ١٢</span> = ١٥ <span class="highlight-change">- ١٢</span></p></div>
                                    <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">م = ٣</span></p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثالثاً: أمثلة تفاعلية على الضرب والقسمة</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Example 3 -->
                            <div id="interactive-container-3" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-2">مثال ٣: الحل بالقسمة</p>
                                <p class="text-md mb-4 pb-2 border-b">حل المعادلة: <span class="math-eq">٤ل = ٥٢</span></p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد العملية</h4><p>المتغير <span class="math-eq">ل</span> مضروب في <span class="math-eq">٤</span>. العملية العكسية للضرب هي القسمة.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تطبيق العملية العكسية</h4><p>نقسم <strong class="text-red-600">كلا الطرفين</strong> على <span class="math-eq">٤</span>.</p><p class="text-center mt-2"><span class="math-eq"><span class="fraction"><span>٤ل</span><span class="frac-bar"></span><span>٤</span></span> = <span class="fraction"><span>٥٢</span><span class="frac-bar"></span><span>٤</span></span></span></p></div>
                                    <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">ل = ١٣</span></p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                            <!-- Example 4 -->
                            <div id="interactive-container-4" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-2">مثال ٤: الحل بالضرب</p>
                                <p class="text-md mb-4 pb-2 border-b">حل المعادلة: <span class="math-eq"><span class="fraction"><span>س</span><span class="frac-bar"></span><span>٦</span></span> = ٨</span></p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد العملية</h4><p>المتغير <span class="math-eq">س</span> مقسوم على <span class="math-eq">٦</span>. العملية العكسية للقسمة هي الضرب.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تطبيق العملية العكسية</h4><p>نضرب <strong class="text-red-600">كلا الطرفين</strong> في <span class="math-eq">٦</span>.</p><p class="text-center mt-2"><span class="math-eq"><span class="fraction"><span>س</span><span class="frac-bar"></span><span>٦</span></span> <span class="highlight-change">× ٦</span> = ٨ <span class="highlight-change">× ٦</span></span></p></div>
                                    <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">س = ٤٨</span></p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="4" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="4" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="4" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                            <!-- Example 5 -->
                            <div id="interactive-container-5" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-2">مثال ٥: التعامل مع الكسور</p>
                                <p class="text-md mb-4 pb-2 border-b">حل المعادلة: <span class="math-eq"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span> ق = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span></span></p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد العملية</h4><p>المتغير <span class="math-eq">ق</span> مضروب في الكسر. العملية العكسية هي الضرب في <span class="vocab-term">مقلوب الكسر</span>.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تطبيق العملية العكسية</h4><p>نضرب <strong class="text-red-600">كلا الطرفين</strong> في مقلوب الكسر وهو <span class="math-eq"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span>.</p><p class="text-center mt-2"><span class="math-eq"><span class="highlight-change"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span> × <span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span> ق = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span> × <span class="highlight-change"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span></span></p></div>
                                    <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">ق = <span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٤</span></span></span></p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="5" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="5" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="5" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                            <!-- Example 6 -->
                            <div id="interactive-container-6" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-2">مثال ٦: التعامل مع مقلوب كسر سالب</p>
                                <p class="text-md mb-4 pb-2 border-b">حل المعادلة: <span class="math-eq"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٥</span></span> ف = -٩</span></p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد العملية</h4><p>المتغير <span class="math-eq">ف</span> مضروب في الكسر. العملية العكسية هي الضرب في مقلوب الكسر.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تطبيق العملية العكسية</h4><p>نضرب <strong class="text-red-600">كلا الطرفين</strong> في مقلوب الكسر وهو <span class="math-eq"><span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٣</span></span></span>.</p><p class="text-center mt-2"><span class="math-eq"><span class="highlight-change"><span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٣</span></span></span> × <span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٥</span></span> ف = -٩ × <span class="highlight-change"><span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٣</span></span></span></span></p></div>
                                    <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">ف = -١٥</span></p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="6" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="6" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="6" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 رابعاً: كتابة المعادلات وحلها</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Example 7 -->
                            <div id="interactive-container-7" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-2">مثال ٧: كتابة معادلة ضرب</p>
                                <p class="text-md mb-4 pb-2 border-b">اكتب معادلة تمثل "ستة أمثال عدد تساوي ١٣٢"، ثم حلها.</p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: ترجمة الجملة</h4><p>"ستة أمثال عدد" تترجم إلى <span class="math-eq">٦س</span>. "تساوي ١٣٢" تترجم إلى <span class="math-eq">= ١٣٢</span>. إذن، المعادلة هي: <span class="math-eq">٦س = ١٣٢</span></p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: حل المعادلة</h4><p>لحل المعادلة، نقسم كلا الطرفين على <span class="math-eq">٦</span>.</p><p class="text-center mt-2"><span class="math-eq"><span class="fraction"><span>٦س</span><span class="frac-bar"></span><span>٦</span></span> = <span class="fraction"><span>١٣٢</span><span class="frac-bar"></span><span>٦</span></span></span></p></div>
                                    <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>بعد التبسيط، نجد أن <span class="math-eq">س = ٢٢</span></p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="7" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="7" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="7" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                            <!-- Example 8 -->
                            <div id="interactive-container-8" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-2">مثال ٨: كتابة معادلة طرح</p>
                                <p class="text-md mb-4 pb-2 border-b">اكتب معادلة تمثل "أقل من عدد بعشرة يساوي ٢٥"، ثم حلها.</p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-blue-100 rounded-lg step-box border-blue-600"><h4 class="font-bold text-blue-800">الخطوة 1: ترجمة الجملة</h4><p>"أقل من عدد بعشرة" تترجم إلى <span class="math-eq">س - ١٠</span>. "يساوي ٢٥" تترجم إلى <span class="math-eq">= ٢٥</span>. إذن، المعادلة هي: <span class="math-eq text-blue-700">س - ١٠ = ٢٥</span></p></div>
                                    <div class="step-interactive p-4 bg-blue-100 rounded-lg step-box border-blue-600"><h4 class="font-bold text-blue-800">الخطوة 2: حل المعادلة</h4><p>لحل المعادلة، نضيف <span class="math-eq">١٠</span> إلى كلا الطرفين.</p><p class="text-center mt-2"><span class="math-eq">س - ١٠ <span class="highlight-change">+ ١٠</span> = ٢٥ <span class="highlight-change">+ ١٠</span></span></p></div>
                                    <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>بعد التبسيط، نجد أن <span class="math-eq">س = ٣٥</span></p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="8" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="8" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="8" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">✍️ خامساً: حان دورك! اختبر فهمك</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">نتيجتك النهائية</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">إعادة الاختبار</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">💡 شرح الإجابة</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    // ===================================================================================
    // الدوال المشتركة (لا تقم بتعديل هذا الجزء)
    // ===================================================================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">منصة الرياضيات التفاعلية</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">منصة الرياضيات التفاعلية</h1></a>`; } let userInfoHtml = ''; if (studentData) { userInfoHtml = `<div class="flex items-center gap-4"><span class="font-semibold">أهلاً، ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">خروج</a></div>`; } else { userInfoHtml = `<p class="text-lg text-gray-600">زائر</p>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; const logoutLink = headerContainer.querySelector('#logout-link'); if(logoutLink) { logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); } }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">© 2024 جميع الحقوق محفوظة | تصميم وتطوير: أ. عبدالعزيز خالد العبلان</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">لا توجد أسئلة متاحة لهذا الدرس حالياً.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `المحاولات المتبقية: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">اعرف لماذا؟</button></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">تحقق من إجاباتي</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'لا توجد محاولات متبقية'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = '✔ إجابة صحيحة!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `❌ إجابة خاطئة.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden');}); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentData) { saveGrade(lessonId, finalGrade, studentData.id); if (attemptsLeft - 1 > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'تم عرض نتيجتك. سجل الدخول لحفظ تقدمك.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade, studentId) { if (!studentId) return; const saveStatus = document.getElementById('save-status'); saveStatus.textContent = 'جارٍ حفظ نتيجتك...'; const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&lessonId=${lessonId}&grade=${grade}`; fetch(url) .then(res => res.json()) .then(result => { if (result.status === 'success') { saveStatus.textContent = '✔ تم حفظ نتيجتك بنجاح! ستظهر في لوحة التحكم عند العودة.'; const studentData = JSON.parse(localStorage.getItem('currentStudent')); if (!studentData.lessons) studentData.lessons = {}; if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; } else { studentData.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(studentData)); } else { throw new Error(result.message); } }) .catch(error => { saveStatus.textContent = '❌ حدث خطأ أثناء حفظ الدرجة.'; console.error("Save Grade Error:", error); }); }
    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    
    // ===================================================================================
    // مشغل الكود (هنا تضع محتوى الدرس)
    // ===================================================================================
    
    // 1. تحديد معرّف فريد للدرس
    const LESSON_ID = 'c1_l2'; 

    // 2. بنك الأسئلة الخاص بالدرس
    function generateQuiz() {
        const questionBank = [
            { type: 'mcq', level: '⭐', topic: 'addition', text: 'حل المعادلة: <span class="math-eq">س + ١٠ = ٣٥</span>', options: [ { display: '<span class="math-eq">٤٥</span>', value: '٤٥' }, { display: '<span class="math-eq">٢٥</span>', value: '٢٥' }, { display: '<span class="math-eq">٣.٥</span>', value: '٣.٥' }, { display: '<span class="math-eq">-٢٥</span>', value: '-٢٥' } ], correct: '٢٥', explanation: `<p class='mb-2'>لحل المعادلة، نطرح <span class="math-eq">١٠</span> من كلا الطرفين.</p><div class='text-right space-y-2'><p>أولاً: <span class='math-eq'>س + ١٠ <span class='highlight-change'>- ١٠</span> = ٣٥ <span class='highlight-change'>- ١٠</span></span></p><p>ثانياً: <span class='math-eq'>س = ٢٥</span></p></div>` },
            { type: 'mcq', level: '⭐', topic: 'subtraction', text: 'حل المعادلة: <span class="math-eq">ك - ١٣ = ٥</span>', options: [ { display: '<span class="math-eq">٨</span>', value: '٨' }, { display: '<span class="math-eq">-٨</span>', value: '-٨' }, { display: '<span class="math-eq">١٨</span>', value: '١٨' }, { display: '<span class="math-eq">-١٨</span>', value: '-١٨' } ], correct: '١٨', explanation: `<p class='mb-2'>لحل المعادلة، نضيف <span class="math-eq">١٣</span> إلى كلا الطرفين.</p><div class='text-right space-y-2'><p>أولاً: <span class='math-eq'>ك - ١٣ <span class='highlight-change'>+ ١٣</span> = ٥ <span class='highlight-change'>+ ١٣</span></span></p><p>ثانياً: <span class='math-eq'>ك = ١٨</span></p></div>` },
            { type: 'mcq', level: '⭐⭐', topic: 'division', text: 'حل المعادلة: <span class="math-eq">-٨س = ٩٦</span>', options: [ { display: '<span class="math-eq">١٢</span>', value: '١٢' }, { display: '<span class="math-eq">١٠٤</span>', value: '١٠٤' }, { display: '<span class="math-eq">-١٢</span>', value: '-١٢' }, { display: '<span class="math-eq">-٨٨</span>', value: '-٨٨' } ], correct: '-١٢', explanation: `<p class='mb-2'>لحل المعادلة، نقسم كلا الطرفين على <span class="math-eq">-٨</span>.</p><div class='text-center space-y-2'><p><span class='math-eq'><span class="fraction"><span>-٨س</span><span class="frac-bar"></span><span class='highlight-change'>-٨</span></span> = <span class="fraction"><span>٩٦</span><span class="frac-bar"></span><span class='highlight-change'>-٨</span></span></span></p><p><span class='math-eq'>س = -١٢</span></p></div>` },
            { type: 'mcq', level: '⭐⭐', topic: 'multiplication', text: 'حل المعادلة: <span class="math-eq"><span class="fraction"><span>ص</span><span class="frac-bar"></span><span>٧</span></span> = -٤</span>', options: [ { display: '<span class="math-eq">٣</span>', value: '٣' }, { display: '<span class="math-eq">-٢٨</span>', value: '-٢٨' }, { display: '<span class="math-eq">٢٨</span>', value: '٢٨' }, { display: '<span class="math-eq">-١١</span>', value: '-١١' } ], correct: '-٢٨', explanation: `<p class='mb-2'>لحل المعادلة، نضرب كلا الطرفين في <span class="math-eq">٧</span>.</p><div class='text-center space-y-2'><p><span class='math-eq'><span class="fraction"><span>ص</span><span class="frac-bar"></span><span>٧</span></span> <span class='highlight-change'>× ٧</span> = -٤ <span class='highlight-change'>× ٧</span></span></p><p><span class='math-eq'>ص = -٢٨</span></p></div>` },
            { type: 'mcq', level: '⭐⭐⭐', topic: 'writing', text: 'ما حل المعادلة التي تمثل "ثلثا عدد يساوي سالب ثمانية"؟', options: [ { display: '<span class="math-eq">-١٢</span>', value: '-١٢' }, { display: '<span class="math-eq">-١٦</span>', value: '-١٦' }, { display: '<span class="math-eq flex justify-center items-center">-٥<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span></span>', value: '-16/3' }, { display: '<span class="math-eq">١٢</span>', value: '١٢' } ], correct: '-١٢', explanation: `<p class='mb-2'>أولاً، نكتب المعادلة: <span class="math-eq"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>س = -٨</span></p><p class='mb-2'>ثانياً، نحل بضرب الطرفين في مقلوب الكسر <span class="math-eq"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span></p><p class='math-eq text-center'>س = -٨ × <span class="highlight-change"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span></p><p class='math-eq text-center'>س = <span class="fraction"><span>-٢٤</span><span class="frac-bar"></span><span>٢</span></span> = -١٢</p>` },
            { type: 'mcq', level: '⭐', topic: 'subtraction', text: 'حل المعادلة: <span class="math-eq">ن - ٦ = -١٥</span>', options: [ { display: '<span class="math-eq">-٩</span>', value: '-٩' }, { display: '<span class="math-eq">-٢١</span>', value: '-٢١' }, { display: '<span class="math-eq">٩</span>', value: '٩' }, { display: '<span class="math-eq">٢١</span>', value: '٢١' } ], correct: '-٩', explanation: `<p class='mb-2'>لحل المعادلة، نضيف <span class="math-eq">٦</span> إلى كلا الطرفين.</p><div class='text-right space-y-2'><p>أولاً: <span class='math-eq'>ن - ٦ <span class='highlight-change'>+ ٦</span> = -١٥ <span class='highlight-change'>+ ٦</span></span></p><p>ثانياً: <span class='math-eq'>ن = -٩</span></p></div>` },
            { type: 'mcq', level: '⭐⭐', topic: 'multiplication', text: 'حل المعادلة: <span class="math-eq">-٣ف = -٢٧</span>', options: [ { display: '<span class="math-eq">-٩</span>', value: '-٩' }, { display: '<span class="math-eq">٩</span>', value: '٩' }, { display: '<span class="math-eq">-٣٠</span>', value: '-٣٠' }, { display: '<span class="math-eq">-٢٤</span>', value: '-٢٤' } ], correct: '٩', explanation: `<p class='mb-2'>لحل المعادلة، نقسم كلا الطرفين على <span class="math-eq">-٣</span>.</p><div class='text-center space-y-2'><p><span class='math-eq'><span class="fraction"><span>-٣ف</span><span class="frac-bar"></span><span class='highlight-change'>-٣</span></span> = <span class="fraction"><span>-٢٧</span><span class="frac-bar"></span><span class='highlight-change'>-٣</span></span></span></p><p><span class='math-eq'>ف = ٩</span></p></div>` },
            { type: 'mcq', level: '⭐⭐⭐', topic: 'division', text: 'حل المعادلة: <span class="math-eq"><span class="fraction"><span>ب</span><span class="frac-bar"></span><span>-٤</span></span> = -١٢</span>', options: [ { display: '<span class="math-eq">٣</span>', value: '٣' }, { display: '<span class="math-eq">-٣</span>', value: '-٣' }, { display: '<span class="math-eq">٤٨</span>', value: '٤٨' }, { display: '<span class="math-eq">-٤٨</span>', value: '-٤٨' } ], correct: '٤٨', explanation: `<p class='mb-2'>لحل المعادلة، نضرب كلا الطرفين في <span class="math-eq">-٤</span>.</p><div class='text-center space-y-2'><p><span class='math-eq'><span class="fraction"><span>ب</span><span class="frac-bar"></span><span>-٤</span></span> <span class='highlight-change'>× -٤</span> = -١٢ <span class='highlight-change'>× -٤</span></span></p><p><span class='math-eq'>ب = ٤٨</span></p></div>` },
            { type: 'mcq', level: '⭐⭐', topic: 'writing', text: 'عدد نقص بمقدار ٨ فأصبح ١٥. ما هي المعادلة التي تمثل هذه الجملة؟', options: [ { display: '<span class="math-eq">س + ٨ = ١٥</span>', value: 'س + ٨ = ١٥' }, { display: '<span class="math-eq">س - ٨ = ١٥</span>', value: 'س - ٨ = ١٥' }, { display: '<span class="math-eq">٨ - س = ١٥</span>', value: '٨ - س = ١٥' }, { display: '<span class="math-eq">٨س = ١٥</span>', value: '٨س = ١٥' } ], correct: 'س - ٨ = ١٥', explanation: `<p class='mb-2'>"عدد" يمثل بـ <span class="math-eq">س</span>. "نقص بمقدار ٨" يعني نطرح <span class="math-eq">٨</span>. "فأصبح ١٥" يعني يساوي <span class="math-eq">١٥</span>. إذن المعادلة هي <span class="math-eq">س - ٨ = ١٥</span></p>` },
            { type: 'mcq', level: '⭐⭐⭐', topic: 'fractions', text: 'حل المعادلة: <span class="math-eq"><span class="fraction"><span>٤</span><span class="frac-bar"></span><span>٥</span></span> م = ٢٨</span>', options: [ { display: '<span class="math-eq">٣٥</span>', value: '٣٥' }, { display: '<span class="math-eq">٢٢.٤</span>', value: '٢٢.٤' }, { display: '<span class="math-eq">٢٨.٨</span>', value: '٢٨.٨' }, { display: '<span class="math-eq">٣٢</span>', value: '٣٢' } ], correct: '٣٥', explanation: `<p class='mb-2'>لحل المعادلة، نضرب كلا الطرفين في مقلوب الكسر وهو <span class="math-eq"><span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٤</span></span></span></p><p class='math-eq text-center'>م = ٢٨ × <span class="highlight-change"><span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٤</span></span></span></p><p class='math-eq text-center'>م = <span class="fraction"><span>٢٨ × ٥</span><span class="frac-bar"></span><span>٤</span></span> = <span class="fraction"><span>١٤٠</span><span class="frac-bar"></span><span>٤</span></span> = ٣٥</p>` },
            { type: 'mcq', level: '⭐', topic: 'writing', text: 'ما هي المعادلة التي تمثل الجملة: "عدد مضاف إليه ١٤ يساوي ٣"؟', options: [ { display: '<span class="math-eq">س + ١٤ = ٣</span>', value: 'س + ١٤ = ٣' }, { display: '<span class="math-eq">س - ١٤ = ٣</span>', value: 'س - ١٤ = ٣' }, { display: '<span class="math-eq">١٤س = ٣</span>', value: '١٤س = ٣' }, { display: '<span class="math-eq">٣ + س = ١٤</span>', value: '٣ + س = ١٤' } ], correct: 'س + ١٤ = ٣', explanation: `<p class='mb-2'>"عدد مضاف إليه ١٤" يترجم إلى <span class="math-eq">س + ١٤</span>. "يساوي ٣" يترجم إلى <span class="math-eq">= ٣</span>. إذن المعادلة هي <span class="math-eq">س + ١٤ = ٣</span></p>` },
            { type: 'mcq', level: '⭐⭐', topic: 'writing', text: 'ما هي المعادلة التي تمثل الجملة: "ناتج قسمة عدد على ٥ يساوي -١٠"؟', options: [ { display: '<span class="math-eq">س + ٥ = -١٠</span>', value: 'س + ٥ = -١٠' }, { display: '<span class="math-eq"><span class="fraction"><span>س</span><span class="frac-bar"></span><span>٥</span></span> = -١٠</span>', value: 'س/٥ = -١٠' }, { display: '<span class="math-eq">٥س = -١٠</span>', value: '٥س = -١٠' }, { display: '<span class="math-eq">س - ٥ = -١٠</span>', value: 'س - ٥ = -١٠' } ], correct: 'س/٥ = -١٠', explanation: `<p class='mb-2'>"ناتج قسمة عدد على ٥" يترجم إلى <span class="math-eq"><span class="fraction"><span>س</span><span class="frac-bar"></span><span>٥</span></span></span>. "يساوي -١٠" يترجم إلى <span class="math-eq">= -١٠</span>. إذن المعادلة هي <span class="math-eq"><span class="fraction"><span>س</span><span class="frac-bar"></span><span>٥</span></span> = -١٠</span></p>` },
            { type: 'mcq', level: '⭐⭐', topic: 'writing', text: 'ترجم الجملة التالية إلى معادلة: "ناتج ضرب عدد في سالب سبعة هو ٤٩".', options: [ { display: '<span class="math-eq">س - ٧ = ٤٩</span>', value: 'س - ٧ = ٤٩' }, { display: '<span class="math-eq">س + (-٧) = ٤٩</span>', value: 'س + (-٧) = ٤٩' }, { display: '<span class="math-eq">-٧س = ٤٩</span>', value: '-٧س = ٤٩' }, { display: '<span class="math-eq"><span class="fraction"><span>س</span><span class="frac-bar"></span><span>-٧</span></span> = ٤٩</span>', value: 'س/-٧ = ٤٩' } ], correct: '-٧س = ٤٩', explanation: `<p class='mb-2'>"ناتج ضرب عدد في سالب سبعة" يترجم إلى <span class="math-eq">-٧س</span>. "هو ٤٩" يترجم إلى <span class="math-eq">= ٤٩</span>. إذن المعادلة هي <span class="math-eq">-٧س = ٤٩</span></p>` }
        ];
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        const questionCount = Math.min(shuffled.length, 5);
        return shuffled.slice(0, questionCount);
    }

    // 3. تشغيل الكود عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', () => {
        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            state[exampleId] = {
                currentIndex: -1,
                steps: container.querySelectorAll('.step-interactive'),
                placeholder: container.querySelector('.interactive-placeholder'),
                prevBtn: container.querySelector('.prev-btn'),
                nextBtn: container.querySelector('.next-btn'),
                resetBtn: container.querySelector('.reset-btn')
            };
            const resetExample = () => {
                state[exampleId].steps.forEach(step => step.classList.remove('active'));
                state[exampleId].currentIndex = -1;
                if (state[exampleId].placeholder) {
                    state[exampleId].placeholder.classList.remove('hidden');
                }
                updateButtons();
            };
            const updateButtons = () => {
                const isFirstStep = state[exampleId].currentIndex <= -1;
                const isLastStep = state[exampleId].currentIndex >= state[exampleId].steps.length - 1;
                state[exampleId].prevBtn.disabled = isFirstStep;
                if (isLastStep) {
                    state[exampleId].nextBtn.classList.add('hidden');
                    state[exampleId].resetBtn.classList.remove('hidden');
                } else {
                    state[exampleId].nextBtn.classList.remove('hidden');
                    state[exampleId].resetBtn.classList.add('hidden');
                }
            };
            state[exampleId].nextBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex < state[exampleId].steps.length - 1) {
                    if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.add('hidden');
                    }
                    state[exampleId].currentIndex++;
                    state[exampleId].steps[state[exampleId].currentIndex].classList.add('active');
                    updateButtons();
                }
            });
            state[exampleId].prevBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex > -1) {
                    state[exampleId].steps[state[exampleId].currentIndex].classList.remove('active');
                    state[exampleId].currentIndex--;
                    if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.remove('hidden');
                    }
                    updateButtons();
                }
            });
            if(state[exampleId].resetBtn) {
                state[exampleId].resetBtn.addEventListener('click', resetExample);
            }
            updateButtons();
        });
        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) {
            retakeBtn.addEventListener('click', () => {
                window.location.reload();
            });
        }
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) {
            closeModalBtn.addEventListener('click', closeModal);
        }
    });
    </script>
</body>
</html>

