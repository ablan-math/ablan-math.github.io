<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ø­Ù„ Ø¨Ø§Ù„ØªØ¹ÙˆÙŠØ¶ 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            direction: rtl;
            overscroll-behavior: none;
            background-color: #f3f4f6;
            height: 100dvh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª: Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø§ØªØ¬Ø§Ù‡ LTR */
        .equation-font {
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.1rem; 
            font-weight: 700;
            text-align: center;
            direction: ltr; 
            unicode-bidi: isolate;
            display: inline-block;
            white-space: nowrap;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .game-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 100%;
            overflow-y: auto;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® */
        .problem-area {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        /* Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© */
        .main-equations {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            border-bottom: 2px dashed #cbd5e1;
            padding-bottom: 0.5rem;
            margin-bottom: 0.25rem;
            transition: all 0.5s ease;
        }
        
        .main-equations.faded {
            opacity: 0.4;
            filter: grayscale(100%);
        }

        .eq-badge {
            background: white;
            border: 1px solid #94a3b8;
            padding: 0.25rem 0.6rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            color: #1e40af;
            font-size: 1rem;
        }

        /* Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ù†Ø¬Ø²Ø© */
        .history-step {
            background-color: #dcfce7;
            border: 1px solid #86efac;
            color: #166534;
            padding: 0.4rem 0.8rem;
            border-radius: 0.5rem;
            width: 100%;
            text-align: center;
            animation: fadeIn 0.5s ease-out;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
        }
        
        .history-step.modification-step {
            background-color: #ecfdf5;
            border: 2px solid #10b981;
            flex-direction: column;
            gap: 0.25rem;
            padding: 0.5rem;
        }
        
        .history-step.modification-step .equations-wrapper {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .history-label {
            font-size: 0.75rem;
            color: #15803d;
            font-weight: bold;
            min-width: 70px;
            text-align: right;
        }
        
        .history-step.modification-step .history-label {
            width: 100%;
            text-align: center;
            border-bottom: 1px solid #a7f3d0;
            padding-bottom: 0.25rem;
            margin-bottom: 0.25rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ */
        #interaction-area {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            width: 100%;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª */
        .choices-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            width: 100%;
        }

        .choice-button {
            width: 100%;
            padding: 0.5rem;
            background-color: #ffffff;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 700;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            direction: ltr; 
            unicode-bidi: isolate;
            min-height: 3rem;
            word-break: break-word;
            line-height: 1.2;
        }
        
        .choice-button.text-choice {
            font-family: 'Cairo', sans-serif;
            direction: rtl;
            unicode-bidi: normal;
            font-size: 0.85rem;
        }

        .choice-button:hover:not(:disabled) {
            border-color: #3b82f6;
            background-color: #f0f9ff;
        }
        .choice-button:disabled {
            cursor: default;
            opacity: 0.7;
        }
        .choice-button.correct {
            border-color: #16a34a !important;
            background-color: #dcfce7 !important;
            color: #15803d;
            box-shadow: 0 0 0 2px rgba(22, 163, 74, 0.3);
        }
        .choice-button.incorrect {
            border-color: #dc2626 !important;
            background-color: #fee2e2 !important;
            color: #991b1b;
            box-shadow: 0 0 0 2px rgba(220, 38, 38, 0.3);
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
        .action-btn {
            width: 100%;
            padding: 0.6rem;
            border-radius: 0.5rem;
            font-weight: bold;
            font-size: 0.95rem;
            transition: 0.2s;
            text-align: center;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .btn-blue { background-color: #2563eb; }
        .btn-blue:hover { background-color: #1d4ed8; }
        .btn-green { background-color: #16a34a; }
        .btn-green:hover { background-color: #15803d; }
        .btn-gray { background-color: #9ca3af; color: #1f2937; }

        /* Ø§Ù„Ù†ÙˆØ§ÙØ° */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.7);
            display: flex; align-items: center; justify-content: center;
            z-index: 50; opacity: 0; visibility: hidden; transition: 0.3s;
            padding: 1rem;
        }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-box {
            background: white; padding: 1.5rem; border-radius: 1rem;
            width: 100%; max-width: 400px; text-align: center;
            transform: scale(0.9); transition: 0.3s;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-overlay.show .modal-box { transform: scale(1); }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ */
        #feedback-container {
            min-height: 1.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.25rem;
        }
        #feedback-text {
            font-size: 0.9rem; font-weight: bold; text-align: center;
        }
        
        /* Ø´Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ø§Ø· */
        .score-badge {
            background: #fef3c7;
            color: #d97706;
            padding: 0.2rem 0.6rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: auto;
        }

        /* Ø´Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª */
        .timer-badge {
            background: #e0f2fe;
            color: #0369a1;
            padding: 0.2rem 0.6rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        .timer-icon { width: 1rem; height: 1rem; }
    </style>
</head>
<body>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
    <div id="welcome-screen" class="modal-overlay show">
        <div class="modal-box">
            <h1 class="text-2xl font-bold text-blue-700 mb-2">Ø§Ù„Ø­Ù„ Ø¨Ø§Ù„ØªØ¹ÙˆÙŠØ¶ 1</h1>
            <p id="welcomeMessage" class="text-gray-600 mb-4">Ø­Ù„ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©.<br>Ù„Ø¯ÙŠÙƒ Ù£ Ù…Ø³Ø§Ø¦Ù„ Ù…Ø®ØªÙ„ÙØ© ÙÙŠ ÙƒÙ„ Ù…Ø­Ø§ÙˆÙ„Ø©.</p>
            <div class="bg-blue-50 p-3 rounded-lg text-sm text-blue-800 mb-6">
                <p><strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª:</strong></p>
                <p>ÙƒÙ„ Ø®Ø·ÙˆØ© ØµØ­ÙŠØ­Ø© = <span class="font-bold">Ù¡ Ù†Ù‚Ø·Ø©</span></p>
                <p>Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø³ØªØ­Ø³Ø¨ Ù…Ù† <span class="font-bold">Ù¥</span></p>
            </div>
            <button onclick="startGame()" class="action-btn btn-blue">
                Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ù„
            </button>
            <p class="text-xs text-gray-500 mt-6 font-semibold">
                ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ±: Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ø¨Ù„Ø§Ù†
            </p>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
    <div id="game-ui" class="game-card hidden">
        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
        <div class="flex items-center mb-2 px-1 w-full">
            <h2 id="question-counter" class="text-lg font-bold text-gray-700">Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ù¡ Ù…Ù† Ù£</h2>
            <div id="timer-display" class="timer-badge">
                <svg xmlns="http://www.w3.org/2000/svg" class="timer-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span id="timer-text">Ù Ù :Ù Ù </span>
            </div>
            <div id="current-score-display" class="score-badge">Ø§Ù„Ù†Ù‚Ø§Ø·: Ù </div>
            <button onclick="location.reload()" class="text-red-500 font-bold text-xl mr-2">âœ•</button>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø£Ù„Ø© ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ù„ -->
        <div class="problem-area" id="problem-area">
            <!-- Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØªØ§Ù† -->
            <div class="main-equations" id="main-equations">
                <div id="eq1" class="equation-font eq-badge"></div>
                <div id="eq2" class="equation-font eq-badge"></div>
            </div>
            
            <!-- Ø³Ø¬Ù„ Ø§Ù„Ø®Ø·ÙˆØ§Øª -->
            <div id="steps-history" class="w-full flex flex-col"></div>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ -->
        <div id="interaction-area">
            <p id="prompt-text" class="text-center text-blue-600 font-bold text-sm my-2">Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØµØ­ÙŠØ­Ø©</p>
            <div id="options-grid" class="choices-grid"></div>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© -->
        <div id="feedback-container">
            <span id="feedback-text"></span>
            <button id="explain-btn" class="hidden px-3 py-1 bg-yellow-100 text-yellow-800 border border-yellow-300 rounded-full text-xs hover:bg-yellow-200 transition" onclick="showStepExplanation()">
                Ø§Ø¹Ø±Ù Ù„Ù…Ø§Ø°Ø§ØŸ ğŸ’¡
            </button>
        </div>

        <div class="flex gap-2 mt-2">
            <button id="next-btn" onclick="nextStep()" class="action-btn btn-green hidden">Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù†ØªÙ‚Ø§Ù„ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ø§Ù„ÙØ§ØµÙ„) -->
    <div id="transition-screen" class="modal-overlay">
        <div class="modal-box bg-green-50 border-2 border-green-200">
            <h2 class="text-2xl font-bold text-green-700 mb-3">âœ… Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ù…Ø³Ø£Ù„Ø©!</h2>
            <p class="text-gray-600 mb-4">Ù†ØªÙŠØ¬Ø© Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</p>
            <div class="text-3xl font-bold text-blue-600 mb-6">
                <span id="question-points">0</span> Ù†Ù‚Ø·Ø©
            </div>
            <button id="next-question-btn" onclick="proceedToNextQuestion()" class="action-btn btn-green">
                Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© â¬…ï¸
            </button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
    <div id="end-screen" class="modal-overlay">
        <div class="modal-box">
            <h2 class="text-3xl font-bold text-green-600 mb-2">ğŸ‰ ØªÙ… Ø§Ù„Ø­Ù„!</h2>
            <p class="text-gray-700 mb-4">Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø¦Ù„.</p>
            
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <p class="text-gray-600 text-sm mb-1">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚:</p>
                <p id="final-time-display" class="text-xl font-bold text-blue-600 mb-3"></p>
                
                <!-- Ù…ÙƒØ§Ù† Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ù† Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
                <div id="final-result-display" class="mb-4 border-t pt-2"></div>
            </div>

            <div id="leaderboard-loader" class="hidden mb-4 text-blue-500">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„...</div>
            <div id="leaderboard-container" class="mb-4"></div>

            <div id="finish-game-wrapper" class="hidden">
                <button id="finish-game-btn" class="action-btn btn-blue mb-2">Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¥Ø±Ø³Ø§Ù„</button>
            </div>

            <button onclick="location.reload()" class="action-btn btn-gray text-white mb-4">
                Ø­Ù„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
            </button>
            
            <p class="text-xs text-gray-400 font-semibold">
                ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ±: Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ² Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ø¨Ù„Ø§Ù†
            </p>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø±Ø­ -->
    <div id="explanation-modal" class="modal-overlay">
        <div class="modal-box relative">
            <button onclick="hideExplanation()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 font-bold">âœ•</button>
            <h3 class="text-xl font-bold text-blue-700 mb-4">ØªÙØ³ÙŠØ± Ø§Ù„Ø®Ø·ÙˆØ©</h3>
            <div id="explanation-content" class="text-right text-gray-700 text-base leading-relaxed bg-blue-50 p-4 rounded-lg border border-blue-100"></div>
            <button onclick="hideExplanation()" class="mt-6 w-full action-btn btn-blue">ÙÙ‡Ù…Øª</button>
        </div>
    </div>

    <script>
        // --- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ ---
        function toArabicNum(str) {
            return str.toString()
                .replace(/\d/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©"[d])
                .replace(/-/g, 'âˆ’');
        }

        function formatEq(eq) {
            return eq.replace(/x/gi, 'Ø³')
                     .replace(/y/gi, 'Øµ')
                     .replace(/\d+/g, d => toArabicNum(d));
        }

        function formatOpt(opt) {
            if(opt.includes('Ù„Ø§') || opt.includes('Ø¹Ø¯Ø¯') || opt.includes('Ø¬Ø§Ù‡Ø²Ø©') || opt.includes('Ù†Ø¹Ø¯Ù„') || opt.includes('Ù…ØªØ³Ù‚') || opt.includes('ØºÙŠØ±')) return opt;
            return formatEq(opt).replace(',', 'ØŒ');
        }

        // --- Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (3 Ù…Ø¬Ù…ÙˆØ¹Ø§Øª) ---
        const questionPools = [
            // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© 1: Ù…Ø¹Ø§Ø¯Ù„Ø© Ø¬Ø§Ù‡Ø²Ø© Ø¨ØµÙŠØºØ© (Ø³ = ...)
            [
                // Ø§Ù„Ø¨Ø¯ÙŠÙ„ 1
                {
                    eq1: "2x - y = 3", eq2: "x = y + 1",
                    steps: [
                        { label: "Ø§Ù„ØªÙ…Ù‡ÙŠØ¯", prompt: "Ù‡Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ¹ÙˆÙŠØ¶ØŸ", correct: "Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", options: ["Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", "Ù†Ø¹Ø¯Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªÙŠÙ†"], type: "text", explanation: "Ù†Ø¹Ù…ØŒ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø³ = Øµ + Ù¡) Ø¬Ø§Ù‡Ø²Ø©." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¡", prompt: "Ø¹ÙˆØ¶ Ø¨Ù‚ÙŠÙ…Ø© Ø³ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰", correct: "2(y + 1) - y = 3", options: ["2(y + 1) - y = 3", "2y + 1 - y = 3"], explanation: "Ù†Ø¶Ø¹ (Øµ + Ù¡) Ù…ÙƒØ§Ù† Ø³ Ø¨ÙŠÙ† Ù‚ÙˆØ³ÙŠÙ†." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¢", prompt: "ÙÙƒ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³", correct: "2y + 2 - y = 3", options: ["2y + 2 - y = 3", "2y + 1 - y = 3"], explanation: "Ù¢ Ã— Øµ = Ù¢ØµØŒ Ùˆ Ù¢ Ã— Ù¡ = Ù¢." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù£", prompt: "Ø¨Ø³Ø· Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©", correct: "y + 2 = 3", options: ["y + 2 = 3", "3y + 2 = 3"], explanation: "Ù¢Øµ - Øµ = Øµ." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¤", prompt: "Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", correct: "(2 , 1)", options: ["(2 , 1)", "(1 , 2)"], type: "point", explanation: "Øµ=Ù¡ØŒ Ø³=Ù¡+Ù¡=Ù¢." },
                        { label: "Ø§Ù„ØªØµÙ†ÙŠÙ", prompt: "Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ", correct: "Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", options: ["Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", "ØºÙŠØ± Ù…ØªØ³Ù‚", "Ù…ØªØ³Ù‚ ÙˆØºÙŠØ± Ù…Ø³ØªÙ‚Ù„"], type: "text", explanation: "ÙŠÙˆØ¬Ø¯ Ø­Ù„ ÙˆØ­ÙŠØ¯." }
                    ]
                },
                // Ø§Ù„Ø¨Ø¯ÙŠÙ„ 2
                {
                    eq1: "x = 3y", eq2: "x - 2y = 5",
                    steps: [
                        { label: "Ø§Ù„ØªÙ…Ù‡ÙŠØ¯", prompt: "Ù‡Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ¹ÙˆÙŠØ¶ØŸ", correct: "Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", options: ["Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", "Ù†Ø¹Ø¯Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªÙŠÙ†"], type: "text", explanation: "Ù†Ø¹Ù…ØŒ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø³ = Ù£Øµ) Ø¬Ø§Ù‡Ø²Ø©." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¡", prompt: "Ø¹ÙˆØ¶ Ø¨Ù‚ÙŠÙ…Ø© Ø³ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©", correct: "3y - 2y = 5", options: ["3y - 2y = 5", "3y - y = 5"], explanation: "Ù†Ø¶Ø¹ (Ù£Øµ) Ù…ÙƒØ§Ù† Ø³." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¢", prompt: "Ø¨Ø³Ø· Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©", correct: "y = 5", options: ["y = 5", "5y = 5"], explanation: "Ù£Øµ - Ù¢Øµ = Øµ." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù£", prompt: "Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", correct: "(15 , 5)", options: ["(15 , 5)", "(5 , 15)"], type: "point", explanation: "Øµ=Ù¥. Ù†Ø¹ÙˆØ¶ ÙÙŠ Ø³=Ù£Øµ (Ø³ = Ù£ Ã— Ù¥ = Ù¡Ù¥)." },
                        { label: "Ø§Ù„ØªØµÙ†ÙŠÙ", prompt: "Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ", correct: "Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", options: ["Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", "ØºÙŠØ± Ù…ØªØ³Ù‚", "Ù…ØªØ³Ù‚ ÙˆØºÙŠØ± Ù…Ø³ØªÙ‚Ù„"], type: "text", explanation: "ÙŠÙˆØ¬Ø¯ Ø­Ù„ ÙˆØ­ÙŠØ¯." }
                    ]
                },
                // Ø§Ù„Ø¨Ø¯ÙŠÙ„ 3
                {
                    eq1: "x = y + 2", eq2: "2x + y = 10",
                    steps: [
                        { label: "Ø§Ù„ØªÙ…Ù‡ÙŠØ¯", prompt: "Ù‡Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ¹ÙˆÙŠØ¶ØŸ", correct: "Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", options: ["Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", "Ù†Ø¹Ø¯Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªÙŠÙ†"], type: "text", explanation: "Ù†Ø¹Ù…ØŒ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø³ = ...) Ø¬Ø§Ù‡Ø²Ø©." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¡", prompt: "Ø¹ÙˆØ¶ Ø¨Ù‚ÙŠÙ…Ø© Ø³ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©", correct: "2(y + 2) + y = 10", options: ["2(y + 2) + y = 10", "2y + 2 + y = 10"], explanation: "Ù†Ø¶Ø¹ (Øµ + Ù¢) Ù…ÙƒØ§Ù† Ø³ Ø¨ÙŠÙ† Ù‚ÙˆØ³ÙŠÙ†." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¢", prompt: "ÙÙƒ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³", correct: "2y + 4 + y = 10", options: ["2y + 4 + y = 10", "2y + 2 + y = 10"], explanation: "Ù¢ Ã— Øµ = Ù¢ØµØŒ Ùˆ Ù¢ Ã— Ù¢ = Ù¤." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù£", prompt: "Ø¨Ø³Ø· Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©", correct: "3y = 6", options: ["3y = 6", "3y = 14"], explanation: "Ù¢Øµ + Øµ = Ù£ØµØŒ Ùˆ Ù¡Ù  - Ù¤ = Ù¦." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¤", prompt: "Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", correct: "(4 , 2)", options: ["(4 , 2)", "(2 , 4)"], type: "point", explanation: "Øµ=Ù¢. Ø³=Ù¢+Ù¢=Ù¤." },
                        { label: "Ø§Ù„ØªØµÙ†ÙŠÙ", prompt: "Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ", correct: "Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", options: ["Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", "ØºÙŠØ± Ù…ØªØ³Ù‚", "Ù…ØªØ³Ù‚ ÙˆØºÙŠØ± Ù…Ø³ØªÙ‚Ù„"], type: "text", explanation: "ÙŠÙˆØ¬Ø¯ Ø­Ù„ ÙˆØ­ÙŠØ¯." }
                    ]
                }
            ],

            // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© 2: Ù…Ø¹Ø§Ø¯Ù„Ø© Ø¬Ø§Ù‡Ø²Ø© Ø¨ØµÙŠØºØ© (Øµ = ...)
            [
                // Ø§Ù„Ø¨Ø¯ÙŠÙ„ 1
                {
                    eq1: "y = 2x - 1", eq2: "x + 2y = 8",
                    steps: [
                        { label: "Ø§Ù„ØªÙ…Ù‡ÙŠØ¯", prompt: "Ù‡Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¬Ø§Ù‡Ø²Ø©ØŸ", correct: "Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", options: ["Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", "Ù†Ø¹Ø¯Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªÙŠÙ†"], type: "text", explanation: "Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¬Ø§Ù‡Ø²Ø©." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¡", prompt: "Ø¹ÙˆØ¶ Ø¹Ù† Øµ ÙÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠØ©", correct: "x + 2(2x - 1) = 8", options: ["x + 2(2x - 1) = 8", "x + 2x - 1 = 8"], explanation: "Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ù‚ÙˆØ§Ø³." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¢", prompt: "ÙÙƒ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³", correct: "x + 4x - 2 = 8", options: ["x + 4x - 2 = 8", "x + 4x - 1 = 8"], explanation: "Ù¢ ÙÙŠ Ù¢Ø³ = Ù¤Ø³ØŒ Ù¢ ÙÙŠ -Ù¡ = -Ù¢." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù£", prompt: "Ø¨Ø³Ø·", correct: "5x = 10", options: ["5x = 10", "5x = 6"], explanation: "Ø³+Ù¤Ø³=Ù¥Ø³. Ù¨+Ù¢=Ù¡Ù ." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¤", prompt: "Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", correct: "(2 , 3)", options: ["(2 , 3)", "(3 , 2)"], type: "point", explanation: "Ø³=Ù¢. Øµ=Ù¢(Ù¢)-Ù¡=Ù£." },
                        { label: "Ø§Ù„ØªØµÙ†ÙŠÙ", prompt: "Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ", correct: "Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", options: ["Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", "ØºÙŠØ± Ù…ØªØ³Ù‚", "Ù…ØªØ³Ù‚ ÙˆØºÙŠØ± Ù…Ø³ØªÙ‚Ù„"], type: "text", explanation: "ÙŠÙˆØ¬Ø¯ Ø­Ù„ ÙˆØ­ÙŠØ¯." }
                    ]
                },
                // Ø§Ù„Ø¨Ø¯ÙŠÙ„ 2
                {
                    eq1: "3x + y = 7", eq2: "y = x - 1",
                    steps: [
                        { label: "Ø§Ù„ØªÙ…Ù‡ÙŠØ¯", prompt: "Ù‡Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¬Ø§Ù‡Ø²Ø©ØŸ", correct: "Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", options: ["Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", "Ù†Ø¹Ø¯Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªÙŠÙ†"], type: "text", explanation: "Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø¬Ø§Ù‡Ø²Ø©." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¡", prompt: "Ø¹ÙˆØ¶ Ø¹Ù† Øµ ÙÙŠ Ø§Ù„Ø£ÙˆÙ„Ù‰", correct: "3x + (x - 1) = 7", options: ["3x + (x - 1) = 7", "3x + x + 1 = 7"], explanation: "Øµ = Ø³ - Ù¡." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¢", prompt: "Ø¨Ø³Ø·", correct: "4x = 8", options: ["4x = 8", "4x = 6"], explanation: "Ù£Ø³+Ø³=Ù¤Ø³. Ù§+Ù¡=Ù¨." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù£", prompt: "Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", correct: "(2 , 1)", options: ["(2 , 1)", "(1 , 2)"], type: "point", explanation: "Ø³=Ù¢. Øµ=Ù¢-Ù¡=Ù¡." },
                        { label: "Ø§Ù„ØªØµÙ†ÙŠÙ", prompt: "Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ", correct: "Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", options: ["Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", "ØºÙŠØ± Ù…ØªØ³Ù‚", "Ù…ØªØ³Ù‚ ÙˆØºÙŠØ± Ù…Ø³ØªÙ‚Ù„"], type: "text", explanation: "ÙŠÙˆØ¬Ø¯ Ø­Ù„ ÙˆØ­ÙŠØ¯." }
                    ]
                },
                // Ø§Ù„Ø¨Ø¯ÙŠÙ„ 3
                {
                    eq1: "y = 4x", eq2: "2x - y = -4",
                    steps: [
                        { label: "Ø§Ù„ØªÙ…Ù‡ÙŠØ¯", prompt: "Ù‡Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¬Ø§Ù‡Ø²Ø©ØŸ", correct: "Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", options: ["Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", "Ù†Ø¹Ø¯Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªÙŠÙ†"], type: "text", explanation: "Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¬Ø§Ù‡Ø²Ø©." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¡", prompt: "Ø¹ÙˆØ¶ Ø¹Ù† Øµ ÙÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠØ©", correct: "2x - 4x = -4", options: ["2x - 4x = -4", "2x - (4x) = 4"], explanation: "Ù†Ø¶Ø¹ Ù¤Ø³ Ù…ÙƒØ§Ù† Øµ." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¢", prompt: "Ø¨Ø³Ø·", correct: "-2x = -4", options: ["-2x = -4", "2x = -4"], explanation: "Ù¢Ø³ - Ù¤Ø³ = -Ù¢Ø³." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù£", prompt: "Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", correct: "(2 , 8)", options: ["(2 , 8)", "(8 , 2)"], type: "point", explanation: "Ø³=Ù¢. Øµ=Ù¤(Ù¢)=Ù¨." },
                        { label: "Ø§Ù„ØªØµÙ†ÙŠÙ", prompt: "Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ", correct: "Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", options: ["Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", "ØºÙŠØ± Ù…ØªØ³Ù‚", "Ù…ØªØ³Ù‚ ÙˆØºÙŠØ± Ù…Ø³ØªÙ‚Ù„"], type: "text", explanation: "ÙŠÙˆØ¬Ø¯ Ø­Ù„ ÙˆØ­ÙŠØ¯." }
                    ]
                }
            ],

            // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© 3: ØªØ­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„ (ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø©)
            [
                {
                    eq1: "x + y = 5", eq2: "2x - y = 4",
                    steps: [
                        { label: "Ø§Ù„ØªÙ…Ù‡ÙŠØ¯", prompt: "Ù‡Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ¹ÙˆÙŠØ¶ØŸ", correct: "Ù†Ø¹Ø¯Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªÙŠÙ†", options: ["Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", "Ù†Ø¹Ø¯Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªÙŠÙ†"], type: "text", explanation: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªØºÙŠØ± Ù…Ø¹Ø²ÙˆÙ„." },
                        { label: "Ø§Ù„ØªØ¹Ø¯ÙŠÙ„", prompt: "Ø§Ø®ØªØ± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø¹Ø²Ù„ Øµ)", correct: "y = 5 - x", options: ["y = 5 - x", "y = x - 5"], explanation: "Ù†Ù†Ù‚Ù„ Ø³ ÙˆØªØµØ¨Ø­ (-Ø³). Øµ = Ù¥ - Ø³.", updateEquations: ["y = 5 - x", "2x - y = 4"] },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¡", prompt: "Ø¹ÙˆØ¶ Ø¨Ù‚ÙŠÙ…Ø© Øµ (Ù¥ - Ø³) ÙÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠØ©", correct: "2x - (5 - x) = 4", options: ["2x - (5 - x) = 4", "2x - 5 - x = 4"], explanation: "Ù†Ø¶Ø¹ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¨ÙŠÙ† Ù‚ÙˆØ³ÙŠÙ† Ù„ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø³Ø§Ù„Ø¨." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¢", prompt: "ÙÙƒ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³", correct: "2x - 5 + x = 4", options: ["2x - 5 + x = 4", "2x - 5 - x = 4"], explanation: "Ø³Ø§Ù„Ø¨ ÙÙŠ Ù¥ = -Ù¥ØŒ Ø³Ø§Ù„Ø¨ ÙÙŠ -Ø³ = +Ø³." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù£", prompt: "Ø¨Ø³Ø· Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©", correct: "3x = 9", options: ["3x = 9", "x = 9"], explanation: "Ù¢Ø³ + Ø³ = Ù£Ø³. Ù¤ + Ù¥ = Ù©." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¤", prompt: "Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", correct: "(3 , 2)", options: ["(3 , 2)", "(3 , 5)"], type: "point", explanation: "Ø³=Ù£. Øµ=Ù¥-Ù£=Ù¢." },
                        { label: "Ø§Ù„ØªØµÙ†ÙŠÙ", prompt: "Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ", correct: "Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", options: ["Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", "ØºÙŠØ± Ù…ØªØ³Ù‚", "Ù…ØªØ³Ù‚ ÙˆØºÙŠØ± Ù…Ø³ØªÙ‚Ù„"], type: "text", explanation: "ÙŠÙˆØ¬Ø¯ Ø­Ù„ ÙˆØ­ÙŠØ¯." }
                    ]
                },
                {
                    eq1: "x - y = 2", eq2: "3x + y = 10",
                    steps: [
                        { label: "Ø§Ù„ØªÙ…Ù‡ÙŠØ¯", prompt: "Ù‡Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¬Ø§Ù‡Ø²Ø©ØŸ", correct: "Ù†Ø¹Ø¯Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªÙŠÙ†", options: ["Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", "Ù†Ø¹Ø¯Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªÙŠÙ†"], type: "text", explanation: "Ù†Ø­ØªØ§Ø¬ Ù„Ø¹Ø²Ù„ Ø³." },
                        { label: "Ø§Ù„ØªØ¹Ø¯ÙŠÙ„", prompt: "Ø§Ø®ØªØ± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø£ÙˆÙ„Ù‰ (Ø¹Ø²Ù„ Ø³)", correct: "x = y + 2", options: ["x = y + 2", "x = 2 - y"], explanation: "Ø³ = Øµ + Ù¢.", updateEquations: ["x = y + 2", "3x + y = 10"] },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¡", prompt: "Ø¹ÙˆØ¶ Ø¹Ù† Ø³ ÙÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠØ©", correct: "3(y + 2) + y = 10", options: ["3(y + 2) + y = 10", "3y + 2 + y = 10"], explanation: "Ù£(Øµ+Ù¢)." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¢", prompt: "ÙÙƒ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³", correct: "3y + 6 + y = 10", options: ["3y + 6 + y = 10", "3y + 2 + y = 10"], explanation: "Ù£Øµ + Ù¦." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù£", prompt: "Ø¨Ø³Ø·", correct: "4y = 4", options: ["4y = 4", "4y = 16"], explanation: "Ù¤Øµ = Ù¤." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¤", prompt: "Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", correct: "(3 , 1)", options: ["(3 , 1)", "(1 , 3)"], type: "point", explanation: "Øµ=Ù¡. Ø³=Ù¡+Ù¢=Ù£." },
                        { label: "Ø§Ù„ØªØµÙ†ÙŠÙ", prompt: "Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ", correct: "Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", options: ["Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", "ØºÙŠØ± Ù…ØªØ³Ù‚", "Ù…ØªØ³Ù‚ ÙˆØºÙŠØ± Ù…Ø³ØªÙ‚Ù„"], type: "text", explanation: "ÙŠÙˆØ¬Ø¯ Ø­Ù„ ÙˆØ­ÙŠØ¯." }
                    ]
                },
                {
                    eq1: "y + 2x = 7", eq2: "y - x = 1",
                    steps: [
                        { label: "Ø§Ù„ØªÙ…Ù‡ÙŠØ¯", prompt: "Ù‡Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¬Ø§Ù‡Ø²Ø©ØŸ", correct: "Ù†Ø¹Ø¯Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªÙŠÙ†", options: ["Ø¬Ø§Ù‡Ø²Ø©ØŒ Ù†Ø¹ÙˆØ¶ Ù…Ø¨Ø§Ø´Ø±Ø©", "Ù†Ø¹Ø¯Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„ØªÙŠÙ†"], type: "text", explanation: "Ù†Ø¹Ø¯Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø£Ø³Ù‡Ù„." },
                        { label: "Ø§Ù„ØªØ¹Ø¯ÙŠÙ„", prompt: "Ø§Ø®ØªØ± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø«Ø§Ù†ÙŠØ© (Ø¹Ø²Ù„ Øµ)", correct: "y = 1 + x", options: ["y = 1 + x", "y = 1 - x"], explanation: "Øµ = Ù¡ + Ø³.", updateEquations: ["y + 2x = 7", "y = 1 + x"] },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¡", prompt: "Ø¹ÙˆØ¶ Ø¹Ù† Øµ ÙÙŠ Ø§Ù„Ø£ÙˆÙ„Ù‰", correct: "(1 + x) + 2x = 7", options: ["(1 + x) + 2x = 7", "1 + x + 2x = 7"], explanation: "Ø§Ø³ØªØ¨Ø¯Ù„ Øµ Ø¨Ù€ (Ù¡+Ø³)." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù¢", prompt: "Ø¨Ø³Ø·", correct: "3x = 6", options: ["3x = 6", "x = 6"], explanation: "Ù£Ø³ = Ù¦." },
                        { label: "Ø§Ù„Ø®Ø·ÙˆØ© Ù£", prompt: "Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ", correct: "(2 , 3)", options: ["(2 , 3)", "(3 , 2)"], type: "point", explanation: "Ø³=Ù¢. Øµ=Ù¡+Ù¢=Ù£." },
                        { label: "Ø§Ù„ØªØµÙ†ÙŠÙ", prompt: "Ù…Ø§ Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ", correct: "Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", options: ["Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", "ØºÙŠØ± Ù…ØªØ³Ù‚", "Ù…ØªØ³Ù‚ ÙˆØºÙŠØ± Ù…Ø³ØªÙ‚Ù„"], type: "text", explanation: "ÙŠÙˆØ¬Ø¯ Ø­Ù„ ÙˆØ­ÙŠØ¯." }
                    ]
                }
            ]
        ];

        // --- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ---
        let currentQuestionsList = [];
        let currentQIndex = 0;
        let currentStepIndex = 0;
        let score = 0;
        let maxScore = 0;
        let currentQuestionPoints = 0; // ØªØªØ¨Ø¹ Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¤Ù‚Øª
        let timerSeconds = 0;
        let timerInterval;
        let isTimerPaused = false;

        function startTimer() {
            timerSeconds = 0;
            updateTimerDisplay();
            resumeTimer();
        }

        function resumeTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timerSeconds++;
                updateTimerDisplay();
            }, 1000);
            isTimerPaused = false;
        }

        function pauseTimer() {
            if (timerInterval) clearInterval(timerInterval);
            isTimerPaused = true;
        }

        function stopTimer() {
            if (timerInterval) clearInterval(timerInterval);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            const formattedTime = `${toArabicNum(minutes.toString().padStart(2, '0'))}:${toArabicNum(seconds.toString().padStart(2, '0'))}`;
            document.getElementById('timer-text').innerText = formattedTime;
        }
        
        function getFinalTimeFormatted() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            let timeString = "";
            if (minutes > 0) timeString += `${toArabicNum(minutes)} Ø¯Ù‚ÙŠÙ‚Ø© `;
            if (minutes > 0 && seconds > 0) timeString += " Ùˆ "; // Ø¥Ø¶Ø§ÙØ© "Ùˆ" ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¯Ù‚Ø§Ø¦Ù‚ ÙˆØ«ÙˆØ§Ù†ÙŠ
            if (seconds > 0) timeString += `${toArabicNum(seconds)} Ø«Ø§Ù†ÙŠØ©`;
            if (timeString === "") timeString = "Ù  Ø«Ø§Ù†ÙŠØ©";
            return timeString;
        }

        function startGame() {
            currentQuestionsList = questionPools.map(pool => {
                const randomIndex = Math.floor(Math.random() * pool.length);
                return pool[randomIndex];
            });

            maxScore = currentQuestionsList.reduce((acc, q) => acc + q.steps.length, 0);
            currentQIndex = 0;
            currentStepIndex = 0;
            score = 0;
            currentQuestionPoints = 0;
            
            document.getElementById('welcome-screen').classList.remove('show');
            document.getElementById('game-ui').classList.remove('hidden');
            updateScoreDisplay();
            loadQuestion();
            startTimer();
        }

        function updateScoreDisplay() {
            document.getElementById('current-score-display').innerText = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${toArabicNum(score)}`;
        }

        function loadQuestion() {
            const q = currentQuestionsList[currentQIndex];
            currentStepIndex = 0;
            currentQuestionPoints = 0; // ØªØµÙÙŠØ± Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            
            document.getElementById('question-counter').innerText = `Ø§Ù„Ù…Ø³Ø£Ù„Ø© ${toArabicNum(currentQIndex + 1)} Ù…Ù† ${toArabicNum(currentQuestionsList.length)}`;
            
            const mainEqDiv = document.getElementById('main-equations');
            mainEqDiv.classList.remove('faded');
            document.getElementById('eq1').innerText = formatEq(q.eq1);
            document.getElementById('eq2').innerText = formatEq(q.eq2);
            
            document.getElementById('steps-history').innerHTML = '';
            document.getElementById('interaction-area').classList.remove('hidden');
            
            renderStep();
        }

        function updateDisplayedEquations(eq1, eq2, highlight = false) {
            const el1 = document.getElementById('eq1');
            const el2 = document.getElementById('eq2');
            el1.innerText = formatEq(eq1);
            el2.innerText = formatEq(eq2);
            if (highlight) {
                el1.classList.add('eq-modified');
                setTimeout(() => el1.classList.remove('eq-modified'), 1000);
            } else {
                el1.classList.remove('eq-modified');
            }
        }

        function renderStep() {
            const q = currentQuestionsList[currentQIndex];
            const step = q.steps[currentStepIndex];
            
            document.getElementById('prompt-text').innerText = step.prompt;
            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            grid.className = 'choices-grid';

            const opts = [...step.options].sort(() => Math.random() - 0.5);
            opts.forEach(opt => {
                const btn = document.createElement('button');
                const isText = opt.includes('Ø¬Ø§Ù‡Ø²Ø©') || opt.includes('Ù†Ø¹Ø¯Ù„') || opt.includes('Ù„Ø§') || opt.includes('Ø¹Ø¯Ø¯') || opt.includes('Ù…ØªØ³Ù‚') || opt.includes('ØºÙŠØ±');
                btn.className = `choice-button ${isText ? 'text-choice' : ''}`;
                btn.innerText = formatOpt(opt);
                btn.onclick = () => submitChoice(btn, opt);
                grid.appendChild(btn);
            });

            document.getElementById('feedback-text').innerText = "";
            document.getElementById('explain-btn').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            document.getElementById('interaction-area').classList.remove('hidden');
        }

        function submitChoice(btn, selectedValue) {
            const buttons = document.querySelectorAll('.choice-button');
            buttons.forEach(b => b.disabled = true);

            const q = currentQuestionsList[currentQIndex];
            const step = q.steps[currentStepIndex];
            const isCorrect = selectedValue === step.correct;
            const feedbackText = document.getElementById('feedback-text');
            const nextBtn = document.getElementById('next-btn');
            const explainBtn = document.getElementById('explain-btn');

            if (isCorrect) {
                btn.classList.add('correct');
                score++;
                currentQuestionPoints++; // Ø²ÙŠØ§Ø¯Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                updateScoreDisplay();
                feedbackText.innerText = "Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ…";
                feedbackText.className = "text-green-600";
                
                if (step.updateEquations) {
                    document.getElementById('main-equations').classList.add('faded');
                    addModifiedSystemToHistory(step.label, step.updateEquations);
                } else {
                    addToHistory(step.correct, step.label);
                }
                
                document.getElementById('interaction-area').classList.add('hidden');
                nextBtn.classList.remove('hidden');
                updateNextButtonLabel(q);

            } else {
                btn.classList.add('incorrect');
                feedbackText.innerText = "Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©ØŒ Ø§Ù†Ø¸Ø± Ù„Ù„Ø´Ø±Ø­ âŒ";
                feedbackText.className = "text-red-600";
                
                if (step.updateEquations) {
                    document.getElementById('main-equations').classList.add('faded');
                    addModifiedSystemToHistory(step.label, step.updateEquations);
                } else {
                    addToHistory(step.correct, step.label);
                }
                explainBtn.classList.remove('hidden');
                nextBtn.classList.remove('hidden');
                updateNextButtonLabel(q);
            }
            
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø£Ø³ÙÙ„ Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ
            scrollToBottom();
        }

        function updateNextButtonLabel(q) {
            const nextBtn = document.getElementById('next-btn');
            if (currentStepIndex < q.steps.length - 1) {
                nextBtn.innerText = "Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ© â¬…ï¸";
            } else {
                nextBtn.innerText = "Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ù…Ø³Ø£Ù„Ø© âœ…";
            }
        }

        function showStepExplanation() {
            pauseTimer();
            const q = currentQuestionsList[currentQIndex];
            const step = q.steps[currentStepIndex];
            document.getElementById('explanation-content').innerHTML = `
                <p class="font-bold mb-2 text-blue-800">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: <span class="equation-font text-lg">${formatOpt(step.correct)}</span></p>
                <p>${step.explanation}</p>
            `;
            document.getElementById('explanation-modal').classList.add('show');
        }

        function hideExplanation() {
            document.getElementById('explanation-modal').classList.remove('show');
            resumeTimer();
        }

        function addToHistory(text, label) {
            const div = document.createElement('div');
            div.className = 'history-step';
            const isText = text.includes('Ø¬Ø§Ù‡Ø²Ø©') || text.includes('Ù†Ø¹Ø¯Ù„') || text.includes('Ù„Ø§') || text.includes('Ø¹Ø¯Ø¯') || text.includes('Ù…ØªØ³Ù‚') || text.includes('ØºÙŠØ±');
            div.innerHTML = `<span class="history-label">${label}</span><span class="equation-font" style="${isText ? 'direction:rtl; unicode-bidi:normal;' : ''}">${formatOpt(text)}</span>`;
            document.getElementById('steps-history').appendChild(div);
        }

        function addModifiedSystemToHistory(label, equations) {
            const div = document.createElement('div');
            div.className = 'history-step modification-step';
            div.innerHTML = `<div class="history-label">${label}</div><div class="equations-wrapper"><span class="equation-font eq-badge">${formatEq(equations[0])}</span><span class="equation-font eq-badge">${formatEq(equations[1])}</span></div>`;
            document.getElementById('steps-history').appendChild(div);
        }

        function scrollToBottom() {
            // ØªÙ…Ø±ÙŠØ± Ø§Ù„ÙƒØ±Øª Ù†ÙØ³Ù‡ Ù„Ø£Ø³ÙÙ„
            const gameCard = document.getElementById('game-ui');
            setTimeout(() => {
                gameCard.scrollTop = gameCard.scrollHeight;
            }, 100);
        }

        function nextStep() {
            const q = currentQuestionsList[currentQIndex];
            currentStepIndex++;
            if (currentStepIndex < q.steps.length) {
                renderStep();
                scrollToBottom(); // ØªÙ…Ø±ÙŠØ± Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            } else {
                // Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³Ø£Ù„Ø©ØŒ Ù†Ø¸Ù‡Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ÙŠØ©
                showTransitionScreen();
            }
        }
        
        function showTransitionScreen() {
            document.getElementById('question-points').innerText = toArabicNum(currentQuestionPoints);
            document.getElementById('transition-screen').classList.add('show');
        }
        
        function proceedToNextQuestion() {
            document.getElementById('transition-screen').classList.remove('show');
            currentQIndex++;
            if (currentQIndex < currentQuestionsList.length) {
                loadQuestion();
            } else {
                endGame();
            }
        }

        function endGame() {
            stopTimer();
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('end-screen').classList.add('show');
            
            document.getElementById('final-time-display').innerText = getFinalTimeFormatted();
            
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ø­ÙØ¸ ÙˆØ¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            if (window.saveAndFinishGame) {
                window.saveAndFinishGame(score, timerSeconds); 
            }
        }
    </script>

    <!-- Ù…Ø­Ø±Ùƒ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
    <script>
    // --- START OF CONNECTION & LEADERBOARD ENGINE ---
    (function() {
        // --- CONFIGURATION (Ø¹Ø¯Ù‘Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„ÙƒÙ„ Ù„Ø¹Ø¨Ø©) ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
        const GAME_ID = 'g5_2_1';                       // Ù…Ø¹Ø±Ù Ø§Ù„Ù„Ø¹Ø¨Ø©
        const GAME_MAX_POINTS = 18;                     // Ø£Ù‚ØµÙ‰ Ù†Ù‚Ø§Ø· ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ø«Ù„Ø§Ø« (6+5+7)
        const PLATFORM_MAX_GRADE = 5;                   // Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©
        const METRIC_TYPE = 'time';                     // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹ÙŠØ§Ø±: 'time', 'stars', 'errors'
        const METRIC_LABEL = 'Ø§Ù„ÙˆÙ‚Øª (Ø«ÙˆØ§Ù†ÙŠ)';           // Ø§Ø³Ù… Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„

        // --- Read URL Parameters ---
        const urlParams = new URLSearchParams(window.location.search);
        const studentId = urlParams.get('studentId');
        const classId = urlParams.get('classId');
        const studentName = urlParams.get('studentName');

        let currentUser = (studentId && studentName) ? { id: studentId, name: studentName } : null;

        // --- CORE FUNCTIONS ---

        // 1. Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„ØªÙŠ ØªØ³ØªØ¯Ø¹ÙŠÙ‡Ø§ Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        window.saveAndFinishGame = function(points, metricValue) {
            const finalPoints = parseFloat(points) || 0;
            const finalMetric = parseFloat(metricValue) || 0;
            const maxPoints = parseFloat(GAME_MAX_POINTS) || 1;
            const finalGrade = (finalPoints / maxPoints) * PLATFORM_MAX_GRADE;

            const resultDisplay = document.getElementById('final-result-display');
            if (resultDisplay) {
                resultDisplay.innerHTML = `
                    <p class="text-gray-700">Ø§Ù„Ù†Ù‚Ø§Ø·: <span class="font-bold text-xl">${finalPoints} / ${maxPoints}</span></p>
                    <p class="text-blue-600">Ø§Ù„Ø¯Ø±Ø¬Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©: <span class="font-bold text-2xl">${finalGrade.toFixed(1)} / ${PLATFORM_MAX_GRADE}</span></p>
                `;
            }

            if (studentId && classId) {
                const params = new URLSearchParams({
                    action: 'saveGrade',
                    studentId: studentId,
                    classId: classId,
                    itemId: GAME_ID,
                    grade: finalGrade.toFixed(2),
                    metricValue: Math.round(finalMetric).toString()
                });
                fetch(`${SCRIPT_URL}?${params.toString()}`)
                    .then(res => res.json())
                    .then(result => console.log('Save result:', result.status))
                    .catch(err => console.error("Save Error:", err))
                    .finally(fetchAndShowLeaderboard);
            } else {
                console.log(`Visitor finished. Score: ${finalPoints}, Metric: ${finalMetric}`);
                fetchAndShowLeaderboard();
            }
        }

        // 2. Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„
        function fetchAndShowLeaderboard() {
            const loader = document.getElementById('leaderboard-loader');
            const container = document.getElementById('leaderboard-container');
            if (!loader || !container) return;
            
            if (!classId) {
                console.log("No classId found, skipping leaderboard for visitor.");
                container.innerHTML = `<p class="text-center text-gray-500 mt-4">Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ Ù…ØªØ§Ø­ Ù„Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† ÙÙ‚Ø·.</p>`;
                showFinishButton();
                return;
            }

            loader.style.display = 'block';
            container.innerHTML = '';

            const params = new URLSearchParams({
                action: 'getLeaderboard',
                gameId: GAME_ID,
                metricType: METRIC_TYPE,
                classId: classId
            });

            fetch(`${SCRIPT_URL}?${params.toString()}`)
                .then(res => res.json())
                .then(response => {
                    if (response.status === 'success' && response.data) {
                        displayLeaderboard(response.data);
                    } else {
                        throw new Error(response.message || 'Failed to load leaderboard data.');
                    }
                })
                .catch(err => {
                    console.error("Leaderboard Error:", err);
                    container.innerHTML = `<p class="text-center text-red-500">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„.</p>`;
                })
                .finally(() => {
                    loader.style.display = 'none';
                    showFinishButton();
                });
        }
        
        // 3. Ø¯Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„
        function displayLeaderboard(data) {
            const container = document.getElementById('leaderboard-container');
            if (!data || data.length === 0) {
                container.innerHTML = `<p class="text-center text-gray-500 mt-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„!</p>`;
                return;
            }

            let tableHTML = `
                <div class="mt-6 border-t pt-4">
                    <h3 class="text-2xl font-bold text-center text-gray-800 mb-4">ğŸ† Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ ğŸ†</h3>
                    <table class="min-w-full bg-white shadow-md rounded-lg">
                        <thead class="bg-gray-800 text-white">
                            <tr>
                                <th class="text-center py-2 px-3">Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                                <th class="text-right py-2 px-3">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                <th class="text-center py-2 px-3">Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                                <th class="text-center py-2 px-3">${METRIC_LABEL}</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-700">`;

            data.forEach((player, index) => {
                const rank = index + 1;
                let rankDisplay = rank;
                if (rank === 1) rankDisplay = 'ğŸ¥‡';
                if (rank === 2) rankDisplay = 'ğŸ¥ˆ';
                if (rank === 3) rankDisplay = 'ğŸ¥‰';

                const isCurrentUser = (currentUser && player.name === currentUser.name);
                const rowClass = isCurrentUser ? 'bg-blue-100 font-bold' : (index % 2 === 0 ? 'bg-gray-100' : '');

                tableHTML += `
                    <tr class="${rowClass}">
                        <td class="text-center py-2 px-3 text-xl">${rankDisplay}</td>
                        <td class="text-right py-2 px-3">${player.name}</td>
                        <td class="text-center py-2 px-3">${player.grade.toFixed(1)}</td>
                        <td class="text-center py-2 px-3">${player.metricValue}</td>
                    </tr>`;
            });

            tableHTML += `</tbody></table></div>`;
            container.innerHTML = tableHTML;
        }

        // 4. Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡
        function showFinishButton() {
            const finishWrapper = document.getElementById('finish-game-wrapper');
            if (finishWrapper) {
                finishWrapper.style.display = 'block';
            }
        }

        // 5. Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø²Ø± Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØªØ®ØµÙŠØµ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
        document.addEventListener('DOMContentLoaded', () => {
            // Personalize welcome message
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (studentName && welcomeMessage) {
                welcomeMessage.innerHTML = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ <span class="font-bold text-yellow-600">${studentName}</span>! Ø§Ù†Ø·Ù„Ù‚ ÙÙŠ Ø±Ø­Ù„ØªÙƒ Ù„Ø­Ù„ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø§Ù„ØªØ¹ÙˆÙŠØ¶. ÙƒÙ„ Ø®Ø·ÙˆØ© ØµØ­ÙŠØ­Ø© ØªÙ‚Ø±Ø¨Ùƒ Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ!`;
            }

            const finishBtn = document.getElementById('finish-game-btn');
            if (finishBtn) {
                finishBtn.addEventListener('click', () => {
                    window.parent.postMessage({ event: 'gameFinished', gameId: GAME_ID }, '*');
                });
            }
        });
    })();
    // --- END OF CONNECTION & LEADERBOARD ENGINE ---
    </script>
</body>
</html>
