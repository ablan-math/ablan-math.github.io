<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุฏุฑุณ ูฃ-ูก: ูุนุงุฏูุฉ ุงููุณุชููู ุจุตูุบุฉ ุงูููู ูุงูููุทุน | ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .math-eq {
            font-family: "Courier New", monospace; /* ุฎุท ุนุฑูุถ ููุชุจุงุนุฏ */
            font-size: 1.2rem; /* ุชูุจูุฑ ุญุฌู ุงูุฎุท */
            font-weight: bold;
            color: #4338ca;
            background-color: #f3f4f6; /* ุฎูููุฉ ุฑูุงุฏูุฉ ูุงุชุญุฉ */
            border: 1px solid #d1d5db; /* ุฅุทุงุฑ ุฎููู */
            padding: 2px 8px; /* ููุงูุด ุฏุงุฎููุฉ */
            border-radius: 6px; /* ุฒูุงูุง ุฏุงุฆุฑูุฉ */
            display: inline-block;
            vertical-align: middle; /* ูุญุงุฐุงุฉ ุฃูุถู ูุน ุงููุต */
        }
        .explanation-step { 
            padding-right: 12px; 
            margin-bottom: 1rem; 
            border-right: 3px solid #1d4ed8; 
            transition: opacity 0.5s ease-in-out; 
        }
        .nav-btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        .fraction {
            display: inline-flex;
            flex-direction: column;
            text-align: center;
            vertical-align: middle;
            margin: 0 0.2em;
            line-height: 1.2em;
        }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > span:last-child { border-top: 2px solid #4338ca; }

        /* Styles for the interactive graph */
        .graph-container {
            position: relative;
            width: 360px;
            height: 360px;
            margin: 20px auto;
            border: 2px solid #9ca3af;
            background-color: #f9fafb;
        }
        .graph-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(to right, #e5e7eb 1px, transparent 1px), 
                linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
            background-size: 20px 20px; /* Each square is 20x20 pixels */
        }
        .graph-axis {
            position: absolute;
            background-color: #9ca3af;
        }
        .x-axis { width: 100%; height: 2px; top: 50%; }
        .y-axis { height: 100%; width: 2px; left: 50%; }
        .graph-line {
            position: absolute;
            background-color: #3b82f6;
            height: 3px;
            transform-origin: 0 0;
            transition: all 0.5s ease-in-out;
        }
        .graph-point {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: #ef4444;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.5s ease-in-out;
            opacity: 0;
            z-index: 10;
        }
        .graph-movement-line {
            position: absolute;
            border-color: #f59e0b; /* amber-500 */
            border-style: dashed;
            opacity: 0;
            z-index: 5;
        }
        .graph-movement-text {
            position: absolute;
            opacity: 0;
            z-index: 6;
            color: #d97706; /* amber-600 */
            font-weight: bold;
            font-size: 1.1rem;
            transform: translate(-50%, -50%);
        }
        /* --- Animation Delays for Graphing --- */
        .graph-rise, .graph-rise-text {
            transition: opacity 0.4s ease-in-out 0.3s;
        }
        .graph-run, .graph-run-text {
            transition: opacity 0.4s ease-in-out 1.2s;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-5xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">ุงูุฏุฑุณ ูฃ-ูก: ูุนุงุฏูุฉ ุงููุณุชููู ุจุตูุบุฉ ุงูููู ูุงูููุทุน</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; ุงูุนูุฏุฉ ุฅูู ุงูููุฑุณ</a>
                </header>

                <!-- ุงููุญุชูู ุงููุฏูู ูุจุฏุฃ ููุง -->

                <!-- Part 1: Basic Concepts -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ก ุฃููุงู: ุงูููุงููู ุงูุฃุณุงุณูุฉ</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">ุตูุบุฉ ุงูููู ูุงูููุทุน</h3>
                            <p>ุงูุชุนุจูุฑ ุงูููุธู: ูููู ูุชุงุจุฉ ูุนุงุฏูุฉ ุฃู ุฎุท ูุณุชููู (ุบูุฑ ุฑุฃุณู) ุจุงุณุชุนูุงู ูููู (ู) ูุงูููุทุน ุงูุตุงุฏู (ุจ) ููู ุงูุฅุญุฏุงุซู ุงูุตุงุฏู ูููุทุฉ ุชูุงุทุน ุงููุณุชููู ูุน ูุญูุฑ ุงูุตุงุฏุงุช.</p>
                            <div class="mt-4 p-4 bg-white rounded-lg border">
                                 <p class="text-lg text-center font-bold">ุตูุบุฉ ุงูููู ูุงูููุทุน</p>
                                 <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-xl">
                                     <span class="math-eq" style="font-size: 1.5rem;">ุต = ู ุณ + ุจ</span>
                                 </p>
                                 <div class="flex justify-around mt-2 text-center">
                                    <p><strong>ู:</strong> ุงูููู</p>
                                    <p><strong>ุจ:</strong> ุงูููุทุน ุงูุตุงุฏู</p>
                                 </div>
                            </div>
                        </div>
                         <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                            <div class="bg-white p-3 rounded-lg border text-center">
                                <p><strong>ูุซุงู ูก:</strong> <span class="math-eq">ุต = ูฃุณ + ูข</span></p>
                                <p class="text-green-600 font-bold">ุงูููู (ู) = <span class="math-eq">ูฃ</span></p>
                                <p class="text-blue-600 font-bold">ุงูููุทุน (ุจ) = <span class="math-eq">ูข</span></p>
                            </div>
                            <div class="bg-white p-3 rounded-lg border text-center">
                                <p><strong>ูุซุงู ูข:</strong> <span class="math-eq">ุต = -ูขุณ + ูก</span></p>
                                <p class="text-green-600 font-bold">ุงูููู (ู) = <span class="math-eq">-ูข</span></p>
                                <p class="text-blue-600 font-bold">ุงูููุทุน (ุจ) = <span class="math-eq">ูก</span></p>
                            </div>
                            <div class="bg-white p-3 rounded-lg border text-center">
                                <p><strong>ูุซุงู ูฃ:</strong> <span class="math-eq">ุต = <span class="fraction"><span>ูก</span><span>ูข</span></span> ุณ - ูฃ</span></p>
                                <p class="text-green-600 font-bold">ุงูููู (ู) = <span class="math-eq"><span class="fraction"><span>ูก</span><span>ูข</span></span></span></p>
                                <p class="text-blue-600 font-bold">ุงูููุทุน (ุจ) = <span class="math-eq">-ูฃ</span></p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Part 2: Writing Equation from Slope and Intercept -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">โ๏ธ ุซุงููุงู: ูุชุงุจุฉ ุงููุนุงุฏูุฉ (ุชูุงุนูู)</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Example 1 -->
                            <div class="border p-4 rounded-lg bg-white">
                                 <p class="text-center font-bold">ูุซุงู ูก: ุงูุชุจ ูุนุงุฏูุฉ ุงููุณุชููู ุงูุฐู ูููู <span class="math-eq">-ูฃ</span> ูููุทุนู ุงูุตุงุฏู <span class="math-eq">ูฅ</span>.</p>
                                <div class="bg-gray-50 p-4 mt-2 rounded-lg border min-h-[250px]">
                                   <div id="write-eq-explanation-1" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                   <button id="write-eq-back-1" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">ุฑุฌูุน</button>
                                   <span class="text-sm font-bold text-gray-600">ุงูุฎุทูุฉ <span id="write-eq-counter-1">0</span> / 4</span>
                                   <button id="write-eq-next-1" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">ุงูุชุงูู</button>
                               </div>
                            </div>
                            <!-- Example 2 -->
                            <div class="border p-4 rounded-lg bg-white">
                                 <p class="text-center font-bold">ูุซุงู ูข: ุงูุชุจ ูุนุงุฏูุฉ ุงููุณุชููู ุงูุฐู ูููู <span class="math-eq">ูค</span> ูููุทุนู ุงูุตุงุฏู <span class="math-eq">-ูข</span>.</p>
                                <div class="bg-gray-50 p-4 mt-2 rounded-lg border min-h-[250px]">
                                   <div id="write-eq-explanation-2" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                   <button id="write-eq-back-2" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">ุฑุฌูุน</button>
                                   <span class="text-sm font-bold text-gray-600">ุงูุฎุทูุฉ <span id="write-eq-counter-2">0</span> / 4</span>
                                   <button id="write-eq-next-2" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">ุงูุชุงูู</button>
                               </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Part 3: Graphing an Equation -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ ุซุงูุซุงู: ุชูุซูู ุงููุนุงุฏูุฉ ุจูุงููุงู (ุชูุงุนูู)</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <!-- Example 1 -->
                        <div class="border p-4 rounded-lg bg-white">
                            <h3 class="text-xl font-bold text-center mb-2">ูุซุงู ูก: ููู ููุฌุจ</h3>
                            <p class="text-center">ูุซู ุงููุนุงุฏูุฉ <span class="math-eq">ุต = <span class="fraction"><span>ูข</span><span>ูฃ</span></span>ุณ - ูก</span> ุจูุงููุงู.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-4">
                                <div class="border p-4 rounded-lg bg-white">
                                    <div class="bg-gray-50 p-4 rounded-lg border min-h-[340px]">
                                       <div id="graph-eq-explanation-1" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                       <button id="graph-eq-back-1" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">ุฑุฌูุน</button>
                                       <span class="text-sm font-bold text-gray-600">ุงูุฎุทูุฉ <span id="graph-eq-counter-1">0</span> / 4</span>
                                       <button id="graph-eq-next-1" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">ุงูุชุงูู</button>
                                   </div>
                                </div>
                                <div class="graph-container">
                                    <div class="graph-grid"></div>
                                    <div class="graph-axis x-axis"></div>
                                    <div class="graph-axis y-axis"></div>
                                    <div id="graph-rise-line-1" class="graph-movement-line graph-rise"></div>
                                    <div id="graph-run-line-1" class="graph-movement-line graph-run"></div>
                                    <div id="graph-rise-text-1" class="graph-movement-text graph-rise-text"></div>
                                    <div id="graph-run-text-1" class="graph-movement-text graph-run-text"></div>
                                    <div id="graph-point-1-1" class="graph-point"></div>
                                    <div id="graph-point-1-2" class="graph-point"></div>
                                    <div id="graph-line-1" class="graph-line" style="width: 0; top: 0; left: 0;"></div>
                                </div>
                            </div>
                        </div>
                        <!-- Example 2 -->
                        <div class="border p-4 rounded-lg bg-white">
                            <h3 class="text-xl font-bold text-center mb-2">ูุซุงู ูข: ููู ุณุงูุจ (ุฃุตุนุจ)</h3>
                            <p class="text-center">ูุซู ุงููุนุงุฏูุฉ <span class="math-eq">ุต + <span class="fraction"><span>ูก</span><span>ูค</span></span>ุณ = ูข</span> ุจูุงููุงู.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-4">
                                <div class="border p-4 rounded-lg bg-white">
                                    <div class="bg-gray-50 p-4 rounded-lg border min-h-[340px]">
                                       <div id="graph-eq-explanation-2" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                       <button id="graph-eq-back-2" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">ุฑุฌูุน</button>
                                       <span class="text-sm font-bold text-gray-600">ุงูุฎุทูุฉ <span id="graph-eq-counter-2">0</span> / 5</span>
                                       <button id="graph-eq-next-2" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">ุงูุชุงูู</button>
                                   </div>
                                </div>
                                <div class="graph-container">
                                    <div class="graph-grid"></div>
                                    <div class="graph-axis x-axis"></div>
                                    <div class="graph-axis y-axis"></div>
                                    <div id="graph-rise-line-2" class="graph-movement-line graph-rise"></div>
                                    <div id="graph-run-line-2" class="graph-movement-line graph-run"></div>
                                    <div id="graph-rise-text-2" class="graph-movement-text graph-rise-text"></div>
                                    <div id="graph-run-text-2" class="graph-movement-text graph-run-text"></div>
                                    <div id="graph-point-2-1" class="graph-point"></div>
                                    <div id="graph-point-2-2" class="graph-point"></div>
                                    <div id="graph-line-2" class="graph-line" style="width: 0; top: 0; left: 0;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Part 4: Real-life Example -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ข ุฑุงุจุนุงู: ูู ูุงูุน ุงูุญูุงุฉ</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Example 1 -->
                            <div class="border p-4 rounded-lg bg-white">
                                <h3 class="font-bold text-center mb-2">ูุซุงู ูก: ุชูููุฉ ุซุงุจุชุฉ ููุชุบูุฑุฉ</h3>
                                <p>ูุฏู ุดุฑูุฉ ุณูุงุฑุงุช ุฃุฌุฑุฉ ุฑุณู ุซุงุจุช ููุฏุงุฑู <span class="math-eq">ูค</span> ุฑูุงูุงุชุ ูุถุงู ุฅููู <span class="math-eq">ูข</span> ุฑูุงู ููู ูููููุชุฑ ุชูุทุนู ุงูุณูุงุฑุฉ. ุงูุชุจ ูุนุงุฏูุฉ ุชูุซู ุงูุชูููุฉ (ุต) ูุนุฏุฏ (ุณ) ูู ุงููููููุชุฑุงุช.</p>
                                 <div class="bg-gray-50 p-4 mt-2 rounded-lg border min-h-[220px]">
                                   <div id="life-eq-explanation-1" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                   <button id="life-eq-back-1" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">ุฑุฌูุน</button>
                                   <span class="text-sm font-bold text-gray-600">ุงูุฎุทูุฉ <span id="life-eq-counter-1">0</span> / 3</span>
                                   <button id="life-eq-next-1" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">ุงูุชุงูู</button>
                               </div>
                            </div>
                            <!-- Example 2 -->
                            <div class="border p-4 rounded-lg bg-white">
                                <h3 class="font-bold text-center mb-2">ูุซุงู ูข: ูููุฉ ุงุจุชุฏุงุฆูุฉ ูุชูุงูุต (ุฃุตุนุจ)</h3>
                                <p>ุจุทุงุฑูุฉ ูุงุชู ูุดุญููุฉ ุจุงููุงูู (<span class="math-eq">ูกูููช</span>). ุฅุฐุง ูุงูุช ุชููุฏ <span class="math-eq">ูกูฅูช</span> ูู ุดุญููุง ูู ุณุงุนุฉ ูู ุงูุงุณุชุฎุฏุงูุ ุงูุชุจ ูุนุงุฏูุฉ ุชูุซู ุงููุณุจุฉ ุงููุฆููุฉ ุงููุชุจููุฉ ูู ุงูุดุญู (ุต) ุจุนุฏ (ุณ) ุณุงุนุฉ.</p>
                                 <div class="bg-gray-50 p-4 mt-2 rounded-lg border min-h-[220px]">
                                   <div id="life-eq-explanation-2" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                   <button id="life-eq-back-2" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">ุฑุฌูุน</button>
                                   <span class="text-sm font-bold text-gray-600">ุงูุฎุทูุฉ <span id="life-eq-counter-2">0</span> / 4</span>
                                   <button id="life-eq-next-2" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">ุงูุชุงูู</button>
                               </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ุงููุญุชูู ุงููุฏูู ููุชูู ููุง -->

                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">โ๏ธ ุฎุงูุณุงู: ุญุงู ุฏูุฑู! ุงุฎุชุจุฑ ูููู</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-6 rounded-lg text-center">
                        <h3 class="text-xl font-bold">ูุชูุฌุชู ุงูููุงุฆูุฉ</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">๐ก ุดุฑุญ ุงูุฅุฌุงุจุฉ</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    // ==================================================
    // ุฏูุงู ูุดุชุฑูุฉ ููููุตุฉ
    // ==================================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h1></a>`; } let userInfoHtml = ''; if (studentData) { userInfoHtml = `<div class="flex items-center gap-4"><span class="font-semibold">ุฃููุงูุ ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">ุฎุฑูุฌ</a></div>`; } else { userInfoHtml = `<p class="text-lg text-gray-600">ุฒุงุฆุฑ</p>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; const logoutLink = headerContainer.querySelector('#logout-link'); if(logoutLink) { logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); } }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">ยฉ 2024 ุฌููุน ุงูุญููู ูุญููุธุฉ | ุชุตููู ูุชุทููุฑ: ุฃ. ุนุจุฏุงูุนุฒูุฒ ุฎุงูุฏ ุงูุนุจูุงู</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุชุงุญุฉ ููุฐุง ุงูุฏุฑุณ ุญุงููุงู.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `ุงููุญุงููุงุช ุงููุชุจููุฉ: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">ุงุนุฑู ููุงุฐุงุ</button></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">ุชุญูู ูู ุฅุฌุงุจุงุชู</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'ูุง ุชูุฌุฏ ูุญุงููุงุช ูุชุจููุฉ'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = 'โ ุฅุฌุงุจุฉ ุตุญูุญุฉ!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden');}); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentData) { saveGrade(lessonId, finalGrade, studentData.id); if (attemptsLeft - 1 > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'ุชู ุนุฑุถ ูุชูุฌุชู. ุณุฌู ุงูุฏุฎูู ูุญูุธ ุชูุฏูู.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade, studentId) { if (!studentId) return; const saveStatus = document.getElementById('save-status'); saveStatus.textContent = 'ุฌุงุฑู ุญูุธ ูุชูุฌุชู...'; const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&lessonId=${lessonId}&grade=${grade}`; fetch(url) .then(res => res.json()) .then(result => { if (result.status === 'success') { saveStatus.textContent = 'โ ุชู ุญูุธ ูุชูุฌุชู ุจูุฌุงุญ! ุณุชุธูุฑ ูู ููุญุฉ ุงูุชุญูู ุนูุฏ ุงูุนูุฏุฉ.'; const studentData = JSON.parse(localStorage.getItem('currentStudent')); if (!studentData.lessons) studentData.lessons = {}; if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; } else { studentData.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(studentData)); } else { throw new Error(result.message); } }) .catch(error => { saveStatus.textContent = 'โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุฏุฑุฌุฉ.'; console.error("Save Grade Error:", error); }); }
    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    
    // ==================================================
    // ูุดุบู ุงูููุฏ ุงูุฎุงุต ุจุงูุฏุฑุณ
    // ==================================================
    
    // 1. ุชุญุฏูุฏ ุงููุนุฑู ุงููุฑูุฏ ููุฏุฑุณ
    const LESSON_ID = 'c3_l1'; 
    
    // 2. ุจูู ุงูุฃุณุฆูุฉ ุงูุฎุงุต ุจุงูุฏุฑุณ
    function generateQuiz() {
        const questionBank = [
            { type: 'mcq', level: 'โญ', topic: 'identify', text: 'ูู ุงููุนุงุฏูุฉ ุต = ูฅุณ - ูฃุ ูุง ูู ุงูููุทุน ุงูุตุงุฏูุ', options: [ { display: 'ูฅ', value: 'A' }, { display: 'ุณ', value: 'B' }, { display: '-ูฃ', value: 'C' }, { display: 'ูฃ', value: 'D' } ], correct: 'C', explanation: '<p>ูู ุตูุบุฉ ุงูููู ูุงูููุทุน (ุต = ู ุณ + ุจ)ุ ููุซู ุงูุฑูุฒ (ุจ) ุงูููุทุน ุงูุตุงุฏู. ูู ูุฐู ุงููุนุงุฏูุฉุ ุจ = -ูฃ.</p>' },
            { type: 'mcq', level: 'โญ', topic: 'identify', text: 'ูู ุงููุนุงุฏูุฉ ุต = -ุณ + ูงุ ูุง ูู ุงููููุ', options: [ { display: 'ูก', value: 'A' }, { display: '-ูก', value: 'B' }, { display: 'ูง', value: 'C' }, { display: '-ูง', value: 'D' } ], correct: 'B', explanation: '<p>ูู ุตูุบุฉ ุงูููู ูุงูููุทุน (ุต = ู ุณ + ุจ)ุ ููุซู ุงูุฑูุฒ (ู) ุงูููู. ูู ูุฐู ุงููุนุงุฏูุฉุ ุต = (-ูก)ุณ + ูงุ ุฅุฐู ุงูููู ู = -ูก.</p>' },
            { type: 'mcq', level: 'โญโญ', topic: 'write-equation', text: 'ุงูุชุจ ูุนุงุฏูุฉ ุงููุณุชููู ุงูุฐู ูููู ูข ูููุทุนู ุงูุตุงุฏู -ูค.', options: [ { display: 'ุต = -ูคุณ + ูข', value: 'A' }, { display: 'ุต = ูขุณ - ูค', value: 'B' }, { display: 'ุต = ูขุณ + ูค', value: 'C' }, { display: 'ุต = ูคุณ - ูข', value: 'D' } ], correct: 'B', explanation: '<p>ูุนูุถ ูุจุงุดุฑุฉ ูู ุงูุตูุบุฉ ุต = ู ุณ + ุจ. ูุน ู = ูข ู ุจ = -ูคุ ูุญุตู ุนูู ุต = ูขุณ - ูค.</p>' },
            { type: 'mcq', level: 'โญโญ', topic: 'write-equation', text: 'ูุง ูู ูุนุงุฏูุฉ ุงููุณุชููู ุงูุฐู ูููู <span class="fraction"><span>ูก</span><span>ูข</span></span> ูููุทุนู ุงูุตุงุฏู ูฃุ', options: [ { display: 'ุต = ูฃุณ + <span class="fraction"><span>ูก</span><span>ูข</span></span>', value: 'A' }, { display: 'ุต = ุณ + <span class="fraction"><span>ูฃ</span><span>ูข</span></span>', value: 'B' }, { display: 'ุต = <span class="fraction"><span>ูก</span><span>ูข</span></span> ุณ + ูฃ', value: 'C' }, { display: 'ุต = <span class="fraction"><span>ูก</span><span>ูข</span></span> ุณ - ูฃ', value: 'D' } ], correct: 'C', explanation: '<p>ูุนูุถ ูุจุงุดุฑุฉ ูู ุงูุตูุบุฉ ุต = ู ุณ + ุจ. ูุน ู = <span class="fraction"><span>ูก</span><span>ูข</span></span> ู ุจ = ูฃุ ูุญุตู ุนูู ุต = <span class="fraction"><span>ูก</span><span>ูข</span></span> ุณ + ูฃ.</p>' },
            { type: 'mcq', level: 'โญโญโญ', topic: 'application', text: 'ุชุจูุบ ุชูููุฉ ุงูุงุดุชุฑุงู ูู ูุงุฏู ุฑูุงุถู ูกูู ุฑูุงู ุดูุฑูุงูุ ุจุงูุฅุถุงูุฉ ุฅูู ูฅู ุฑูุงูุงู ูุฑุณู ุชุณุฌูู ููุฑุฉ ูุงุญุฏุฉ. ุฃู ูุนุงุฏูุฉ ุชูุซู ุงูุชูููุฉ (ุต) ูุนุฏุฏ (ุณ) ูู ุงูุดููุฑุ', options: [ { display: 'ุต = ูฅูุณ + ูกูู', value: 'A' }, { display: 'ุต = ูกููุณ + ูฅู', value: 'B' }, { display: 'ุต = ูกูฅูุณ', value: 'C' }, { display: 'ุต = ูฅูุณ - ูกูู', value: 'D' } ], correct: 'B', explanation: '<p>ุฑุณู ุงูุชุณุฌูู ูู ูุจูุบ ุซุงุจุช ููุฏูุน ูุฑุฉ ูุงุญุฏุฉุ ูุฐุง ููู ุงูููุทุน ุงูุตุงุฏู (ุจ = ูฅู). ุงูุชูููุฉ ุงูุดูุฑูุฉ ูู ูุนุฏู ุงูุชุบูุฑุ ูุฐุง ูู ุงูููู (ู = ูกูู). ุงููุนุงุฏูุฉ ูู ุต = ูกููุณ + ูฅู.</p>' },
            { type: 'mcq', level: 'โญโญโญ', topic: 'graph-to-equation', text: 'ูุณุชููู ููุฑ ุจุงูููุทุฉ (ูุ ูก) ูุงูููุทุฉ (ูขุ ูฅ). ูุง ูู ูุนุงุฏูุชูุ', options: [ { display: 'ุต = ูขุณ + ูก', value: 'A' }, { display: 'ุต = ุณ + ูข', value: 'B' }, { display: 'ุต = -ูขุณ + ูก', value: 'C' }, { display: 'ุต = ูฅุณ + ูข', value: 'D' } ], correct: 'A', explanation: '<p>ุฃููุงูุ ูุญุฏุฏ ุงูููุทุน ุงูุตุงุฏู ูู ุงูููุทุฉ (ูุ ูก)ุ ุฅุฐู ุจ = ูก. ุซุงููุงูุ ูุญุณุจ ุงูููู: ู = <span class="fraction"><span>ูฅ-ูก</span><span>ูข-ู</span></span> = <span class="fraction"><span>ูค</span><span>ูข</span></span> = ูข. ุฅุฐู ุงููุนุงุฏูุฉ ูู ุต = ูขุณ + ูก.</p>' },
            { type: 'mcq', level: 'โญโญ', topic: 'write-equation', text: 'ูุง ูุนุงุฏูุฉ ุงููุณุชููู ุงูุฐู ูููู ูค ูููุทุนู ุงูุตุงุฏู -ูขุ', options: [ { display: 'ุต = ูคุณ - ูข', value: 'A' }, { display: 'ุต = -ูขุณ + ูค', value: 'B' }, { display: 'ุต = ูคุณ + ูข', value: 'C' }, { display: 'ุต = ูขุณ - ูค', value: 'D' } ], correct: 'A', explanation: '<p>ุจุชุทุจูู ุตูุบุฉ ุงูููู ูุงูููุทุน ุต = ู ุณ + ุจุ ูุนูุถ ุนู ู ุจู ูค ูุนู ุจ ุจู -ูข ููุญุตู ุนูู ุต = ูคุณ - ูข.</p>' },
            { type: 'mcq', level: 'โญโญโญ', topic: 'write-equation-rearranged', text: 'ุฃู ูุนุงุฏูุฉ ุชูุซู ูุณุชูููุงู ูููู -ูข ูููุทุนู ุงูุตุงุฏู ูฃุ', options: [ { display: 'ุต + ูขุณ = ูฃ', value: 'A' }, { display: 'ุต - ูขุณ = ูฃ', value: 'B' }, { display: 'ูขุต + ุณ = ูฆ', value: 'C' }, { display: 'ุต + ูฃ = -ูขุณ', value: 'D' } ], correct: 'A', explanation: '<p>ุงููุนุงุฏูุฉ ูู ุต = -ูขุณ + ูฃ. ุจููู -ูขุณ ุฅูู ุงูุทุฑู ุงูุขุฎุฑุ ุชุตุจุญ ุงููุนุงุฏูุฉ ุต + ูขุณ = ูฃ.</p>' },
            { type: 'mcq', level: 'โญโญโญ', topic: 'graph-to-equation', text: 'ูุณุชููู ููุทุนู ุงูุตุงุฏู ุนูุฏ (ูุ -ูก) ููููู <span class="fraction"><span>ูข</span><span>ูฃ</span></span>. ูุง ูู ูุนุงุฏูุชูุ', options: [ { display: 'ุต = <span class="fraction"><span>ูข</span><span>ูฃ</span></span>ุณ - ูก', value: 'A' }, { display: 'ุต = <span class="fraction"><span>ูฃ</span><span>ูข</span></span>ุณ - ูก', value: 'B' }, { display: 'ุต = -ุณ + <span class="fraction"><span>ูข</span><span>ูฃ</span></span>', value: 'C' }, { display: 'ุต = <span class="fraction"><span>ูข</span><span>ูฃ</span></span>ุณ + ูก', value: 'D' } ], correct: 'A', explanation: '<p>ุจูุง ุฃู ุงูููุทุน ุงูุตุงุฏู ุจ = -ูก ูุงูููู ู = <span class="fraction"><span>ูข</span><span>ูฃ</span></span>ุ ูุฅู ุงููุนุงุฏูุฉ ูู ุต = <span class="fraction"><span>ูข</span><span>ูฃ</span></span>ุณ - ูก.</p>' },
            { type: 'mcq', level: 'โญโญโญ', topic: 'identify-from-rearranged', text: 'ูุง ูู ููู ุงููุณุชููู ุงูุฐู ูุนุงุฏูุชู ูฃุต - ูฆุณ = ูฉุ', options: [ { display: '-ูข', value: 'A' }, { display: 'ูฆ', value: 'B' }, { display: 'ูฃ', value: 'C' }, { display: 'ูข', value: 'D' } ], correct: 'D', explanation: '<p>ูุฌุจ ุฃููุงู ูุถุน ุงููุนุงุฏูุฉ ุนูู ุตูุบุฉ ุงูููู ูุงูููุทุน (ุต = ู ุณ + ุจ). ูฃุต = ูฆุณ + ูฉ. ุซู ููุณู ุนูู ูฃ: ุต = ูขุณ + ูฃ. ุฅุฐู ุงูููู (ู) ูู ูข.</p>' },
            { type: 'mcq', level: 'โญโญโญ', topic: 'application', text: 'ุจุงุณุชุฎุฏุงู ูุนุงุฏูุฉ ุณูุงุฑุฉ ุงูุฃุฌุฑุฉ ุต = ูขุณ + ูคุ ูุง ุชูููุฉ ุฑุญูุฉ ููุณุงูุฉ ูกู ูููููุชุฑุงุชุ', options: [ { display: 'ูขูค ุฑูุงู', value: 'A' }, { display: 'ูกูฆ ุฑูุงู', value: 'B' }, { display: 'ูขู ุฑูุงู', value: 'C' }, { display: 'ูกูค ุฑูุงู', value: 'D' } ], correct: 'A', explanation: '<p>ูุนูุถ ุนู ุณ (ุงููุณุงูุฉ) ุจู ูกู ูู ุงููุนุงุฏูุฉ: ุต = ูข(ูกู) + ูค = ูขู + ูค = ูขูค ุฑูุงู.</p>' },
            { type: 'mcq', level: 'โญโญโญ', topic: 'application', text: 'ุจุงุณุชุฎุฏุงู ูุนุงุฏูุฉ ุงูุจุทุงุฑูุฉ ุต = -ูกูฅุณ + ูกููุ ูู ุณุชููู ูุณุจุฉ ุงูุดุญู ุจุนุฏ ูฃ ุณุงุนุงุชุ', options: [ { display: 'ูคูฅูช', value: 'A' }, { display: 'ูฅูฅูช', value: 'B' }, { display: 'ูงููช', value: 'C' }, { display: 'ูจูฅูช', value: 'D' } ], correct: 'B', explanation: '<p>ูุนูุถ ุนู ุณ (ุงูุณุงุนุงุช) ุจู ูฃ ูู ุงููุนุงุฏูุฉ: ุต = -ูกูฅ(ูฃ) + ูกูู = -ูคูฅ + ูกูู = ูฅูฅูช.</p>' }
        ];
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        const questionCount = Math.min(shuffled.length, 5);
        return shuffled.slice(0, questionCount);
    }
    
    // 3. ุชุดุบูู ุงูููุฏ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
    document.addEventListener('DOMContentLoaded', () => {
        // --- ุฏูุงู ุงูุฃูุซูุฉ ุงูุชูุงุนููุฉ ุงููุฏููุฉ ---
        function createInteractiveSection(config) {
            let currentStep = 0;
            const renderStep = (step) => {
                if(config.stepCounter) config.stepCounter.textContent = step;
                let cumulativeHTML = '';
                if (step === 0) {
                    cumulativeHTML = `<div class="explanation-step" style="border-color: transparent;">${config.stepsContent[0].text}</div>`;
                } else {
                    for (let i = 1; i <= step; i++) {
                        cumulativeHTML += `<div class="explanation-step">${config.stepsContent[i].text}</div>`;
                    }
                }
                if(config.explanationDiv) config.explanationDiv.innerHTML = cumulativeHTML;
                if (config.customRender) {
                    config.customRender(step);
                }
                if(config.backBtn) config.backBtn.disabled = (step === 0);
                if(config.nextBtn) config.nextBtn.textContent = (step === config.totalSteps) ? 'ุฅุนุงุฏุฉ' : 'ุงูุชุงูู';
            };
            if(config.nextBtn) config.nextBtn.addEventListener('click', () => {
                currentStep = (currentStep < config.totalSteps) ? currentStep + 1 : 0;
                renderStep(currentStep);
            });
            if(config.backBtn) config.backBtn.addEventListener('click', () => {
                if (currentStep > 0) {
                    currentStep--;
                    renderStep(currentStep);
                }
            });
            renderStep(0);
        }

        // ุงุณุชุฏุนุงุกุงุช ุงูุฃูุซูุฉ ุงูุชูุงุนููุฉ ุงููุฏููุฉ
        createInteractiveSection({ nextBtn: document.getElementById('write-eq-next-1'), backBtn: document.getElementById('write-eq-back-1'), stepCounter: document.getElementById('write-eq-counter-1'), explanationDiv: document.getElementById('write-eq-explanation-1'), totalSteps: 4, stepsContent: [ { text: "ูุจุฏุฃ ุจูุชุงุจุฉ ุงูุตูุบุฉ ุงูุนุงูุฉ ููุนุงุฏูุฉ ุงููุณุชููู." }, { text: "<strong>1. ุงูุตูุบุฉ ุงูุนุงูุฉ:</strong><br><span class='math-eq text-center mt-2 block'>ุต = ู ุณ + ุจ</span>" }, { text: "<strong>2. ุชุญุฏูุฏ ุงููุนุทูุงุช:</strong><br>ุงูููู <span class='math-eq'>ู = -ูฃ</span><br>ุงูููุทุน ุงูุตุงุฏู <span class='math-eq'>ุจ = ูฅ</span>" }, { text: "<strong>3. ูุนูุถ ุจุงูููู ูู ุงูุตูุบุฉ:</strong><br><span class='math-eq text-center mt-2 block'>ุต = (-ูฃ)ุณ + (ูฅ)</span>" }, { text: "<strong>4. ุงููุนุงุฏูุฉ ุงูููุงุฆูุฉ:</strong><br><span class='math-eq text-center mt-2 block p-2 bg-green-100 rounded-md'>ุต = -ูฃุณ + ูฅ</span>" } ] });
        createInteractiveSection({ nextBtn: document.getElementById('write-eq-next-2'), backBtn: document.getElementById('write-eq-back-2'), stepCounter: document.getElementById('write-eq-counter-2'), explanationDiv: document.getElementById('write-eq-explanation-2'), totalSteps: 4, stepsContent: [ { text: "ูุจุฏุฃ ุจูุชุงุจุฉ ุงูุตูุบุฉ ุงูุนุงูุฉ ููุนุงุฏูุฉ ุงููุณุชููู." }, { text: "<strong>1. ุงูุตูุบุฉ ุงูุนุงูุฉ:</strong><br><span class='math-eq text-center mt-2 block'>ุต = ู ุณ + ุจ</span>" }, { text: "<strong>2. ุชุญุฏูุฏ ุงููุนุทูุงุช:</strong><br>ุงูููู <span class='math-eq'>ู = ูค</span><br>ุงูููุทุน ุงูุตุงุฏู <span class='math-eq'>ุจ = -ูข</span>" }, { text: "<strong>3. ูุนูุถ ุจุงูููู ูู ุงูุตูุบุฉ:</strong><br><span class='math-eq text-center mt-2 block'>ุต = (ูค)ุณ + (-ูข)</span>" }, { text: "<strong>4. ุงููุนุงุฏูุฉ ุงูููุงุฆูุฉ:</strong><br><span class='math-eq text-center mt-2 block p-2 bg-green-100 rounded-md'>ุต = ูคุณ - ูข</span>" } ] });
        createInteractiveSection({ nextBtn: document.getElementById('graph-eq-next-1'), backBtn: document.getElementById('graph-eq-back-1'), stepCounter: document.getElementById('graph-eq-counter-1'), explanationDiv: document.getElementById('graph-eq-explanation-1'), totalSteps: 4, stepsContent: [ { text: "ูุชูุซูู ุงููุนุงุฏูุฉ ุจูุงููุงูุ ูุญุชุงุฌ ุฅูู ููุทุชูู ุนูู ุงูุฃูู." }, { text: "<strong>1. ูุญุฏุฏ ุงูููุทุน ุงูุตุงุฏู (ุจ):</strong><br>ูู ุงููุนุงุฏูุฉุ ูุฌุฏ ุฃู <span class='math-eq'>ุจ = -ูก</span>. ูุฐู ูู ุงูููุทุฉ ุงูุฃููู (ูุ -ูก)." }, { text: "<strong>2. ูุณุชุฎุฏู ุงูููู (ู) ูุฅูุฌุงุฏ ููุทุฉ ุฃุฎุฑู:</strong><br>ุงูููู <span class='math-eq'>ู = <span class='fraction'><span>ูข</span><span>ูฃ</span></span></span>. ูุฐุง ูุนูู ุชุญุฑู ุฑุฃุณู (ุจุณุท) ูุชุญุฑู ุฃููู (ููุงู)." }, { text: "<strong>3. ูุจุฏุฃ ูู ุงูููุทุน ุงูุตุงุฏู (ูุ -ูก):</strong><br>ูุชุญุฑู ูุญุฏุชูู ููุฃุนูู (ูุฃู ุงูุจุณุท ูข) ููฃ ูุญุฏุงุช ูููููู (ูุฃู ุงูููุงู ูฃ) ูููุตูู ุฅูู ุงูููุทุฉ ุงูุซุงููุฉ (ูฃุ ูก)." }, { text: "<strong>4. ูุฑุณู ุฎุทุงู ูุณุชูููุงู ููุฑ ุจุงูููุทุชูู.</strong>" } ], customRender: (step) => { const p1 = document.getElementById('graph-point-1-1'); const p2 = document.getElementById('graph-point-1-2'); const line = document.getElementById('graph-line-1'); const riseLine = document.getElementById('graph-rise-line-1'); const runLine = document.getElementById('graph-run-line-1'); const riseText = document.getElementById('graph-rise-text-1'); const runText = document.getElementById('graph-run-text-1'); const unit = 20; p1.style.opacity = '0'; p2.style.opacity = '0'; line.style.width = '0px'; riseLine.style.opacity = '0'; runLine.style.opacity = '0'; riseText.style.opacity = '0'; runText.style.opacity = '0'; if (step >= 1) { p1.style.opacity = '1'; p1.style.top = `calc(50% + ${1 * unit}px)`; p1.style.left = '50%'; } if (step >= 3) { riseLine.style.opacity = '1'; riseText.style.opacity = '1'; runLine.style.opacity = '1'; runText.style.opacity = '1'; riseLine.style.top = `calc(50% - ${1 * unit}px)`; riseLine.style.left = `50%`; riseLine.style.height = `${2 * unit}px`; riseLine.style.borderLeftWidth = '2px'; runLine.style.top = `calc(50% - ${1 * unit}px)`; runLine.style.left = `50%`; runLine.style.width = `${3 * unit}px`; runLine.style.borderTopWidth = '2px'; riseText.textContent = '+ูข'; riseText.style.top = `calc(50%)`; riseText.style.left = `calc(50% - 20px)`; runText.textContent = '+ูฃ'; runText.style.top = `calc(50% - ${1 * unit}px - 15px)`; runText.style.left = `calc(50% + ${1.5 * unit}px)`; p2.style.opacity = '1'; p2.style.top = `calc(50% - ${1 * unit}px)`; p2.style.left = `calc(50% + ${3 * unit}px)`; } if (step >= 4) { line.style.top = `calc(50% + ${1 * unit}px)`; line.style.left = '50%'; const rise = -2 * unit; const run = 3 * unit; const angle = Math.atan2(rise, run) * (180 / Math.PI); const length = Math.sqrt(rise*rise + run*run); line.style.transform = `rotate(${angle}deg) translate(-${length * 2}px, 0)`; line.style.width = `${length * 5}px`; } } });
        createInteractiveSection({ nextBtn: document.getElementById('graph-eq-next-2'), backBtn: document.getElementById('graph-eq-back-2'), stepCounter: document.getElementById('graph-eq-counter-2'), explanationDiv: document.getElementById('graph-eq-explanation-2'), totalSteps: 5, stepsContent: [ { text: "ุฃููุงูุ ูุฌุจ ุฃู ุชููู ุงููุนุงุฏูุฉ ุนูู ุตูุบุฉ ุงูููู ูุงูููุทุน (ุต = ู ุณ + ุจ)." }, { text: "<strong>1. ูุนูุฏ ุชุฑุชูุจ ุงููุนุงุฏูุฉ:</strong><br>ูููู <span class='math-eq'>+<span class='fraction'><span>ูก</span><span>ูค</span></span>ุณ</span> ุฅูู ุงูุทุฑู ุงูุขุฎุฑ ุจุนูุณ ุฅุดุงุฑุชู.<br><span class='math-eq text-center mt-2 block p-2 bg-blue-100 rounded-md'>ุต = -<span class='fraction'><span>ูก</span><span>ูค</span></span>ุณ + ูข</span>" }, { text: "<strong>2. ูุญุฏุฏ ุงูููุทุน ุงูุตุงุฏู (ุจ):</strong><br>ุงูุขู ุงููุนุงุฏูุฉ ุนูู ุงูุตูุบุฉ ุงูุตุญูุญุฉ. ูุฌุฏ ุฃู <span class='math-eq'>ุจ = ูข</span>. ูุฐู ูู ุงูููุทุฉ ุงูุฃููู (ูุ ูข)." }, { text: "<strong>3. ูุณุชุฎุฏู ุงูููู (ู) ูุฅูุฌุงุฏ ููุทุฉ ุฃุฎุฑู:</strong><br>ุงูููู <span class='math-eq'>ู = -<span class='fraction'><span>ูก</span><span>ูค</span></span></span>. ูุฐุง ูุนูู ุชุญุฑู ููุฃุณูู ูก (ุจุณุท) ููููููู ูค (ููุงู)." }, { text: "<strong>4. ููุซู ุงูุญุฑูุฉ:</strong><br>ุจุฏุกุงู ูู (ูุ ูข)ุ ูุชุญุฑู ููุฃุณูู ูก ููููููู ูค ููุตู ุฅูู ุงูููุทุฉ (ูคุ ูก)." }, { text: "<strong>5. ูุฑุณู ุงูุฎุท ุงููุณุชููู</strong> ุงูุฐู ููุฑ ุจุงูููุทุชูู."} ], customRender: (step) => { const p1 = document.getElementById('graph-point-2-1'); const p2 = document.getElementById('graph-point-2-2'); const line = document.getElementById('graph-line-2'); const riseLine = document.getElementById('graph-rise-line-2'); const runLine = document.getElementById('graph-run-line-2'); const riseText = document.getElementById('graph-rise-text-2'); const runText = document.getElementById('graph-run-text-2'); const unit = 20; p1.style.opacity = '0'; p2.style.opacity = '0'; line.style.width = '0px'; riseLine.style.opacity = '0'; runLine.style.opacity = '0'; riseText.style.opacity = '0'; runText.style.opacity = '0'; if (step >= 2) { p1.style.opacity = '1'; p1.style.top = `calc(50% - ${2 * unit}px)`; p1.style.left = '50%'; } if (step >= 4) { riseLine.style.opacity = '1'; riseText.style.opacity = '1'; runLine.style.opacity = '1'; runText.style.opacity = '1'; riseLine.style.top = `calc(50% - ${2 * unit}px)`; riseLine.style.left = `50%`; riseLine.style.height = `${1 * unit}px`; riseLine.style.borderLeftWidth = '2px'; runLine.style.top = `calc(50% - ${1 * unit}px)`; runLine.style.left = `50%`; runLine.style.width = `${4 * unit}px`; runLine.style.borderTopWidth = '2px'; riseText.textContent = '-ูก'; riseText.style.top = `calc(50% - ${1.5 * unit}px)`; riseText.style.left = `calc(50% - 15px)`; runText.textContent = '+ูค'; runText.style.top = `calc(50% - ${1 * unit}px - 15px)`; runText.style.left = `calc(50% + ${2 * unit}px)`; p2.style.opacity = '1'; p2.style.top = `calc(50% - ${1 * unit}px)`; p2.style.left = `calc(50% + ${4 * unit}px)`; } if (step >= 5) { line.style.top = `calc(50% - ${2 * unit}px)`; line.style.left = '50%'; const rise = 1 * unit; const run = 4 * unit; const angle = Math.atan2(rise, run) * (180 / Math.PI); const length = Math.sqrt(rise*rise + run*run); line.style.transform = `rotate(${angle}deg) translate(-${length * 1.5}px, 0)`; line.style.width = `${length * 4}px`; } } });
        createInteractiveSection({ nextBtn: document.getElementById('life-eq-next-1'), backBtn: document.getElementById('life-eq-back-1'), stepCounter: document.getElementById('life-eq-counter-1'), explanationDiv: document.getElementById('life-eq-explanation-1'), totalSteps: 3, stepsContent: [ { text: "ูุญูู ุงููุณุฃูุฉ ูุชุญุฏูุฏ ุงูููู ูุงูููุทุน ุงูุตุงุฏู." }, { text: "<strong>1. ูุญุฏุฏ ุงูููุทุน ุงูุตุงุฏู (ุจ):</strong><br>ูู ุงููููุฉ ุงูุซุงุจุชุฉ ุงูุชู ูุง ุชุชุบูุฑุ ููู ุงูุฑุณู ุงูุซุงุจุช. ุฅุฐู <span class='math-eq'>ุจ = ูค</span>." }, { text: "<strong>2. ูุญุฏุฏ ุงูููู (ู):</strong><br>ูู ูุนุฏู ุงูุชุบูุฑุ ุฃู ุงูุชูููุฉ ููู ูููููุชุฑ. ุฅุฐู <span class='math-eq'>ู = ูข</span>." }, { text: "<strong>3. ููุชุจ ุงููุนุงุฏูุฉ ุจุตูุบุฉ ุงูููู ูุงูููุทุน:</strong><br><span class='math-eq text-center mt-2 block p-2 bg-green-100 rounded-md'>ุต = ูขุณ + ูค</span>" } ] });
        createInteractiveSection({ nextBtn: document.getElementById('life-eq-next-2'), backBtn: document.getElementById('life-eq-back-2'), stepCounter: document.getElementById('life-eq-counter-2'), explanationDiv: document.getElementById('life-eq-explanation-2'), totalSteps: 4, stepsContent: [ { text: "ูุญูู ุงููุณุฃูุฉ ูุชุญุฏูุฏ ุงูููู ูุงูููุทุน ุงูุตุงุฏู." }, { text: "<strong>1. ูุญุฏุฏ ุงูููุทุน ุงูุตุงุฏู (ุจ):</strong><br>ูู ุงููููุฉ ุงูุงุจุชุฏุงุฆูุฉุ ููู ูุณุจุฉ ุดุญู ุงูุจุทุงุฑูุฉ ูุจู ุงูุงุณุชุฎุฏุงู. ุฅุฐู <span class='math-eq'>ุจ = ูกูู</span>." }, { text: "<strong>2. ูุญุฏุฏ ุงูููู (ู):</strong><br>ูู ูุนุฏู ุงูุชุบูุฑุ ุฃู ููุฏุงุฑ ุงูููุตุงู ูู ุงูุดุญู ูู ุณุงุนุฉ. ุจูุง ุฃูู ููุตุงูุ ูุงูููู ุณุงูุจ." }, { text: "<strong>3. ูููุฉ ุงูููู:</strong><br>ุชููุฏ ุงูุจุทุงุฑูุฉ ูกูฅูช ูู ุณุงุนุฉุ ุฅุฐู <span class='math-eq'>ู = -ูกูฅ</span>." }, { text: "<strong>4. ููุชุจ ุงููุนุงุฏูุฉ ุจุตูุบุฉ ุงูููู ูุงูููุทุน:</strong><br><span class='math-eq text-center mt-2 block p-2 bg-green-100 rounded-md'>ุต = -ูกูฅุณ + ูกูู</span>" } ] });

        // --- ุชููุฆุฉ ุงูููุตุฉ ูุงูุงูุชุญุงู ---
        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) { closeModalBtn.addEventListener('click', closeModal); }
    });
    </script>
</body>
</html>
