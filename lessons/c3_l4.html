<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدرس ٣-٤: المستقيمات المتوازية والمتعامدة | منصة الرياضيات التفاعلية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .vocab-term-alt { background-color: #dbeafe; padding: 2px 6px; border-radius: 4px; font-weight: bold; } /* New Style */
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-number { background-color: #fef9c3; border: 1px solid #fde047; color: #b45309; font-weight: bold; padding: 0 5px; border-radius: 4px; } /* New Style */
        .math-eq { font-family: "Courier New", monospace; font-size: 1.1rem; font-weight: bold; color: #4338ca; background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 2px 8px; border-radius: 6px; display: inline-block; vertical-align: middle; }
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">الدرس ٣-٤: المستقيمات المتوازية والمتعامدة</h1>
                </header>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفهوم الأساسي</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">المستقيمان المتوازيان</h3>
                            <p class="text-center">يكون المستقيمان غير الرأسيين متوازيين إذا وفقط إذا كان لهما <span class="vocab-term">الميل نفسه</span>.</p>
                            <div class="mt-4 p-4 bg-white rounded-lg border">
                                 <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-xl math-eq">
                                      م₁ = م₂
                                 </p>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">المستقيمان المتعامدان</h3>
                            <p class="text-center">يكون المستقيمان غير الرأسيين متعامدين إذا وفقط إذا كان <span class="vocab-term">حاصل ضرب ميليهما يساوي <span class="highlight-number">-١</span></span>.</p>
                             <div class="mt-4 p-4 bg-white rounded-lg border space-y-2">
                                 <div class="flex justify-center items-center gap-4">
                                     <p class="flex-1 text-center my-2 p-3 bg-indigo-50 rounded-md text-xl math-eq">
                                          م₁ × م₂ = -١
                                     </p>
                                     <span class="text-gray-500 font-bold">أو</span>
                                     <p class="flex-1 text-center my-2 p-3 bg-indigo-50 rounded-md text-xl math-eq">
                                          م₁ = -<span class="fraction"><span>١</span><span class="frac-bar"></span><span>م₂</span></span>
                                     </p>
                                 </div>
                                 <p class="text-sm text-gray-600 text-center">هذا يعني أن ميل أحدهما هو <span class="vocab-term">مقلوب</span> <span class="vocab-term-alt">معكوس</span> ميل الآخر.</p>
                             </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: أمثلة تفاعلية (تحديد العلاقة)</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="flex flex-col space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <!-- Interactive Example 1 -->
                                <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">مثال ١: <span class="math-eq">ص = ٤س + ٣</span> و <span class="math-eq">ص = ٤س - ٥</span></p>
                                    <div class="steps-container space-y-4 min-h-[150px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: الصيغة المستخدمة</h4><p>بما أن المعادلتين على صيغة الميل والمقطع <span class="math-eq">ص = م س + ب</span>، يمكننا تحديد الميل مباشرة.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تحديد الميلين</h4><p>ميل المستقيم الأول: <span class="math-eq">م₁ = ٤</span><br>ميل المستقيم الثاني: <span class="math-eq">م₂ = ٤</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: المقارنة</h4><p>بما أن الميلين متساويان (<span class="math-eq">م₁ = م₂</span>)، فالمستقيمان <span class="font-bold">متوازيان</span>.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- Interactive Example 2 -->
                                <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">مثال ٢: <span class="math-eq">ص = -<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span>س + ٢</span> و <span class="math-eq">ص = ٣س - ١</span></p>
                                    <div class="steps-container space-y-4 min-h-[150px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: الصيغة المستخدمة</h4><p>بما أن المعادلتين على صيغة الميل والمقطع <span class="math-eq">ص = م س + ب</span>، يمكننا تحديد الميل مباشرة.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تحديد الميلين</h4><p>ميل المستقيم الأول: <span class="math-eq">م₁ = -<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span></span><br>ميل المستقيم الثاني: <span class="math-eq">م₂ = ٣</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: التحقق من التعامد</h4><p>حاصل ضرب الميلين: <span class="math-eq">(-<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span>) × ٣ = -١</span>. بما أن الناتج <span class="highlight-number">-١</span>، فالمستقيمان <span class="font-bold">متعامدان</span>.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <!-- Interactive Example 3 -->
                                <div id="interactive-container-3" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">مثال ٣: <span class="math-eq">ص = ٢س + ١</span> و <span class="math-eq">ص = -٢س + ١</span></p>
                                    <div class="steps-container space-y-4 min-h-[150px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: الصيغة المستخدمة</h4><p>بما أن المعادلتين على صيغة الميل والمقطع <span class="math-eq">ص = م س + ب</span>، يمكننا تحديد الميل مباشرة.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تحديد الميلين</h4><p>ميل المستقيم الأول: <span class="math-eq">م₁ = ٢</span><br>ميل المستقيم الثاني: <span class="math-eq">م₂ = -٢</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: المقارنة</h4><p>الميلان غير متساويين (<span class="math-eq">٢ ≠ -٢</span>) وحاصل ضربهما لا يساوي <span class="highlight-number">-١</span> (<span class="math-eq">٢ × -٢ = -٤</span>). إذن، المستقيمان <span class="font-bold">متقاطعان وغير متعامدين</span>.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- Interactive Example 4 -->
                                <div id="interactive-container-4" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">مثال ٤: <span class="math-eq">ص = س + ٧</span> و <span class="math-eq">ص = -س + ٣</span></p>
                                    <div class="steps-container space-y-4 min-h-[150px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: الصيغة المستخدمة</h4><p>بما أن المعادلتين على صيغة الميل والمقطع <span class="math-eq">ص = م س + ب</span>، يمكننا تحديد الميل مباشرة.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تحديد الميلين</h4><p>ميل المستقيم الأول: <span class="math-eq">م₁ = ١</span><br>ميل المستقيم الثاني: <span class="math-eq">م₂ = -١</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: التحقق من التعامد</h4><p>حاصل ضرب الميلين: <span class="math-eq">١ × -١ = -١</span>. بما أن الناتج <span class="highlight-number">-١</span>، فالمستقيمان <span class="font-bold">متعامدان</span>.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="4" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="4" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="4" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                             <!-- Interactive Example 5 -->
                            <div id="interactive-container-5" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4">مثال ٥: <span class="math-eq">ص = -٢س + ٣</span> و <span class="math-eq">٢س + ص = ١٠</span></p>
                                <div class="steps-container space-y-4 min-h-[150px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: توحيد الصيغة</h4><p>للمقارنة، يجب أن تكون كلتا المعادلتين على صيغة الميل والمقطع <span class="math-eq">ص = م س + ب</span>.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: حل المعادلة الثانية وتحديد الميلين</h4>
                                        <p>ميل المستقيم الأول (الجاهز): <span class="math-eq">م₁ = -٢</span></p>
                                        <div class="mt-2 pt-2 border-t">
                                            <p class="text-sm font-semibold">حل المعادلة الثانية:</p>
                                            <div class="space-y-1 text-sm">
                                                <p><span class="math-eq">٢س + ص = ١٠</span></p>
                                                <p>ننقل <span class="highlight-number">٢س</span>: <span class="math-eq">ص = -٢س + ١٠</span></p>
                                                <p class="mt-2">إذن: <span class="math-eq">م₂ = -٢</span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: المقارنة</h4><p>بما أن الميلين متساويان (<span class="math-eq">م₁ = م₂</span>)، فالمستقيمان <span class="font-bold">متوازيان</span>.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="5" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="5" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="5" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                             <!-- Interactive Example 6 -->
                            <div id="interactive-container-6" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4">مثال ٦: <span class="math-eq">٥س - ٣ص = ٦</span> و <span class="math-eq">٣س + ٥ص = ١٠</span></p>
                                <div class="steps-container space-y-4 min-h-[150px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: توحيد الصيغة</h4><p>للمقارنة، يجب أن تكون كلتا المعادلتين على صيغة الميل والمقطع <span class="math-eq">ص = م س + ب</span>.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                        <h4 class="font-bold mb-2">الخطوة 2: حل المعادلات (الجزء الأول)</h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div>
                                                <p class="text-sm font-semibold">المستقيم الأول:</p>
                                                <div class="space-y-1 text-sm">
                                                    <p><span class="math-eq">٥س - ٣ص = ٦</span></p>
                                                    <p>ننقل <span class="highlight-number">٥س</span>: <span class="math-eq">-٣ص = -٥س + ٦</span></p>
                                                </div>
                                            </div>
                                            <div>
                                                <p class="text-sm font-semibold">المستقيم الثاني:</p>
                                                <div class="space-y-1 text-sm">
                                                    <p><span class="math-eq">٣س + ٥ص = ١٠</span></p>
                                                    <p>ننقل <span class="highlight-number">٣س</span>: <span class="math-eq">٥ص = -٣س + ١٠</span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                        <h4 class="font-bold mb-2">الخطوة 3: إيجاد الميلين</h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div>
                                                <div class="space-y-1 text-sm">
                                                    <p>نقسم على <span class="highlight-number">-٣</span>: <span class="math-eq">ص = <span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٣</span></span>س - ٢</span></p>
                                                    <p class="mt-2">إذن: <span class="math-eq">م₁ = <span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٣</span></span></span></p>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="space-y-1 text-sm">
                                                    <p>نقسم على <span class="highlight-number">٥</span>: <span class="math-eq">ص = -<span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٥</span></span>س + ٢</span></p>
                                                    <p class="mt-2">إذن: <span class="math-eq">م₂ = -<span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٥</span></span></span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: التحقق من التعامد</h4><p>حاصل ضرب الميلين: <span class="math-eq">(<span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٣</span></span>) × (-<span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٥</span></span>) = -١</span>. بما أن الناتج <span class="highlight-number">-١</span>، فالمستقيمان <span class="font-bold">متعامدان</span>.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="6" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="6" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="6" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثالثاً: أمثلة تفاعلية (كتابة المعادلات)</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="flex flex-col space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <!-- Interactive Example 7 -->
                                <div id="interactive-container-7" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">مثال ٧: اكتب معادلة المستقيم المار بالنقطة <span class="text-blue-600 font-bold">(-١، -٥)</span> وموازٍ للمستقيم <span class="math-eq">ص = ٣س + ٢</span></p>
                                    <div class="steps-container space-y-4 min-h-[200px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد المعطيات</h4><p>ميل المستقيم الموازي هو نفسه: <span class="math-eq">م = ٣</span><br>النقطة المعطاة: <span class="math-eq">(س₁، ص₁) = (-١، -٥)</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: الصيغة المستخدمة</h4><p>نستخدم صيغة الميل ونقطة:<br><span class="math-eq">ص - ص₁ = م(س - س₁)</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: التعويض</h4><p>نعوض بالقيم في الصيغة:<br><span class="math-eq">ص - (<span class="text-blue-600 font-bold">-٥</span>) = <span class="text-red-600 font-bold">٣</span>(س - (<span class="text-blue-600 font-bold">-١</span>))</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>بتبسيط المعادلة، نحصل على:<br><span class="math-eq">ص + ٥ = ٣(س + ١)</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="7" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="7" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="7" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                                 <!-- Interactive Example 8 -->
                                <div id="interactive-container-8" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">مثال ٨: اكتب معادلة المستقيم المار بالنقطة <span class="text-blue-600 font-bold">(٦، -١)</span> ومتعامد مع المستقيم <span class="math-eq">ص = -٢س + ٥</span></p>
                                    <div class="steps-container space-y-4 min-h-[200px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد المعطيات</h4><p>ميل المستقيم المتعامد هو معكوس مقلوب <span class="highlight-number">-٢</span>: <span class="math-eq">م = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span></span><br>النقطة المعطاة: <span class="math-eq">(س₁، ص₁) = (٦، -١)</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: الصيغة المستخدمة</h4><p>نستخدم صيغة الميل ونقطة:<br><span class="math-eq">ص - ص₁ = م(س - س₁)</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: التعويض</h4><p>نعوض بالقيم في الصيغة:<br><span class="math-eq">ص - (<span class="text-blue-600 font-bold">-١</span>) = <span class="text-red-600 font-bold"><span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span></span>(س - <span class="text-blue-600 font-bold">٦</span>)</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>بتبسيط المعادلة، نحصل على:<br><span class="math-eq">ص + ١ = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span>(س - ٦)</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="8" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="8" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="8" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <!-- Interactive Example 9 -->
                                <div id="interactive-container-9" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">مثال ٩: اكتب معادلة المستقيم المار بالنقطة <span class="text-blue-600 font-bold">(٤، ٠)</span> وموازٍ للمستقيم <span class="math-eq">٢س + ص = ١</span></p>
                                    <div class="steps-container space-y-4 min-h-[200px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: إيجاد الميل وتحديد النقطة</h4>
                                            <p>نحول المعادلة <span class="math-eq">٢س + ص = ١</span> إلى صورة الميل والمقطع: <span class="math-eq">ص = -٢س + ١</span>.</p>
                                            <p class="mt-2">إذن، ميل المستقيم المعطى هو <span class="text-red-600 font-bold">-٢</span>.</p>
                                            <p>الميل الموازي المطلوب هو نفسه: <span class="math-eq">م = -٢</span>.</p>
                                            <p>النقطة المعطاة هي <span class="math-eq">(س₁، ص₁) = (٤، ٠)</span>.</p>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: الصيغة المستخدمة</h4><p>نستخدم صيغة الميل ونقطة:<br><span class="math-eq">ص - ص₁ = م(س - س₁)</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: التعويض</h4><p>نعوض بالقيم في الصيغة:<br><span class="math-eq">ص - <span class="text-blue-600 font-bold">٠</span> = <span class="text-red-600 font-bold">-٢</span>(س - <span class="text-blue-600 font-bold">٤</span>)</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>بتبسيط المعادلة، نحصل على:<br><span class="math-eq">ص = -٢(س - ٤)</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="9" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="9" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="9" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                                 <!-- Interactive Example 10 -->
                                <div id="interactive-container-10" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">مثال ١٠: اكتب معادلة المستقيم المار بالنقطة <span class="text-blue-600 font-bold">(-٤، ٣)</span> ومتعامد مع المستقيم <span class="math-eq">٢س - ٥ص = ١٠</span></p>
                                    <div class="steps-container space-y-4 min-h-[200px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: إيجاد الميل وتحديد النقطة</h4>
                                            <p>نحل المعادلة <span class="math-eq">٢س - ٥ص = ١٠</span> لتصبح بصيغة الميل والمقطع: <span class="math-eq">ص = <span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٥</span></span>س - ٢</span>.</p>
                                            <p class="mt-2">ميل المستقيم المعطى هو <span class="text-red-600 font-bold"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٥</span></span></span>.</p>
                                            <p>ميل المستقيم المتعامد هو معكوس مقلوبه: <span class="math-eq">م = -<span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٢</span></span></span>.</p>
                                            <p>النقطة المعطاة هي <span class="math-eq">(س₁، ص₁) = (-٤، ٣)</span>.</p>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: الصيغة المستخدمة</h4><p>نستخدم صيغة الميل ونقطة:<br><span class="math-eq">ص - ص₁ = م(س - س₁)</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: التعويض</h4><p>نعوض بالقيم في الصيغة:<br><span class="math-eq">ص - <span class="text-blue-600 font-bold">٣</span> = <span class="text-red-600 font-bold">-<span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٢</span></span></span>(س - (<span class="text-blue-600 font-bold">-٤</span>))</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>بتبسيط المعادلة، نحصل على:<br><span class="math-eq">ص - ٣ = -<span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٢</span></span>(س + ٤)</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="10" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="10" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="10" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">✍️ رابعاً: حان دورك! اختبر فهمك</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">نتيجتك النهائية</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">إعادة الاختبار</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">💡 شرح الإجابة</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <div id="smartExplanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full border-t-4 border-purple-500">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-purple-800">🧠 الحل الذكي</h3>
                <button id="closeSmartModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="smartExplanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    const urlParams = new URLSearchParams(window.location.search);
    const studentId = urlParams.get('studentId');
    const classId = urlParams.get('classId');

    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">منصة الرياضيات التفاعلية</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">منصة الرياضيات التفاعلية</h1></a>`; } let userInfoHtml = ''; if (studentData) { userInfoHtml = `<div class="text-left"><span class="font-semibold">أهلاً، ${studentData.name}</span><br><a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">العودة إلى الفهرس &larr;</a></div>`; } else { userInfoHtml = `<div class="text-left"><p class="font-semibold">زائر</p><a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">العودة إلى الفهرس &larr;</a></div>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">© 2024 جميع الحقوق محفوظة | تصميم وتطوير: أ. عبدالعزيز خالد العبلان</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">لا توجد أسئلة متاحة لهذا الدرس حالياً.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `المحاولات المتبقية: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); const smartButtonHTML = q.smartExplanation ? `<button type="button" id="smart-explain-btn-${index}" class="hidden mt-2 text-xs text-purple-600 hover:underline font-semibold">🧠 الحل الذكي</button>` : ''; return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div class="flex items-center space-x-4 space-x-reverse">${smartButtonHTML}<button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">اعرف لماذا؟</button></div></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">تحقق من إجاباتي</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); if (q.smartExplanation) { const smartExplainBtn = document.getElementById(`smart-explain-btn-${index}`); if(smartExplainBtn) smartExplainBtn.addEventListener('click', () => showSmartExplanation(index)); } }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'لا توجد محاولات متبقية'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = '✔ إجابة صحيحة!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `❌ إجابة خاطئة.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden'); if (q.smartExplanation) { document.getElementById(`smart-explain-btn-${index}`).classList.remove('hidden'); } }); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentData) { saveGrade(lessonId, finalGrade, studentData.id); if (attemptsLeft - 1 > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'تم عرض نتيجتك. سجل الدخول لحفظ تقدمك.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade, studentId) { if (!studentId || !classId) { console.error("Student ID or Class ID is missing from the URL."); document.getElementById('save-status').textContent = 'خطأ: لا يمكن حفظ نتيجتك. بيانات الطالب أو الفصل غير موجودة.'; return; } const saveStatus = document.getElementById('save-status'); saveStatus.textContent = 'جارٍ حفظ نتيجتك...'; const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&classId=${classId}&lessonId=${lessonId}&grade=${grade}`; fetch(url) .then(res => res.json()) .then(result => { if (result.status === 'success') { saveStatus.textContent = '✔ تم حفظ نتيجتك بنجاح! ستظهر في لوحة التحكم عند العودة.'; const studentData = JSON.parse(localStorage.getItem('currentStudent')); if (!studentData.lessons) studentData.lessons = {}; if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; } else { studentData.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(studentData)); } else { throw new Error(result.message); } }) .catch(error => { saveStatus.textContent = '❌ حدث خطأ أثناء حفظ الدرجة.'; console.error("Save Grade Error:", error); }); }
    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    function showSmartExplanation(questionIndex) { const modal = document.getElementById('smartExplanationModal'); const explanationText = document.getElementById('smartExplanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].smartExplanation) { explanationText.innerHTML = currentQuestions[questionIndex].smartExplanation; modal.classList.remove('hidden'); } }
    function closeSmartModal() { const modal = document.getElementById('smartExplanationModal'); if(modal) modal.classList.add('hidden'); }
    const LESSON_ID = 'c3_l4'; 
    function generateQuiz() { 
        const questionBank = [
            { 
                type: 'mcq', level: '⭐', text: `ما ميل المستقيم الموازي للمستقيم <span class="math-eq">ص = ٥س - ٣</span>؟`,
                options: [ 
                    { display: '٥', value: 'A' }, { display: '-٣', value: 'B' }, 
                    { display: '-<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٥</span></span>', value: 'C' }, { display: '<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٥</span></span>', value: 'D' }
                ], 
                correct: 'A',
                explanation: `<p>المستقيمات المتوازية لها الميل نفسه.</p><p>ميل المستقيم المعطى <span class="math-eq">ص = <span class="text-red-600 font-bold">٥</span>س - ٣</span> هو <span class="text-red-600 font-bold">٥</span>.</p><p>إذن، ميل المستقيم الموازي له هو أيضاً <span class="text-red-600 font-bold">٥</span>.</p>`,
                smartExplanation: `<p>كلمة "موازٍ" تعني "نفس الميل". ميل المعادلة المعطاة هو الرقم المضروب في (س)، وهو ٥. إذن، الجواب هو ٥ مباشرة.</p>`
            },
            { 
                type: 'mcq', level: '⭐', text: `ما ميل المستقيم المتعامد مع المستقيم <span class="math-eq">ص = -٤س + ١</span>؟`, 
                options: [ 
                    { display: '-٤', value: 'A' }, { display: '٤', value: 'B' }, 
                    { display: '-<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>', value: 'C' }, { display: '<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>', value: 'D' }
                ], 
                correct: 'D', 
                explanation: `<p>ميل المستقيم المعطى هو <span class="math-eq">م₁ = <span class="text-red-600 font-bold">-٤</span></span>.</p><p>ميل المستقيم المتعامد هو معكوس مقلوب الميل الأول.</p><p>مقلوب <span class="text-red-600 font-bold">-٤</span> هو <span class="math-eq">-<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span></span>.</p><p>معكوس الإشارة هو <span class="math-eq"><span class="text-blue-600 font-bold"><span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span></span></span>.</p>`,
                smartExplanation: `<p>كلمة "متعامد" تعني "اقلب الكسر وغير الإشارة".</p><p>الميل هو <span class="math-eq">-٤</span> أو <span class="math-eq">-<span class="fraction"><span>٤</span><span class="frac-bar"></span><span>١</span></span></span>.</p><p>١. اقلب الكسر: <span class="math-eq">-<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span></span>.</p><p>٢. غير الإشارة: <span class="math-eq"><span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span></span>.</p>`
            },
            { 
                type: 'mcq', level: '⭐⭐', text: `ما معادلة المستقيم المار بالنقطة (٢، ٣) وموازٍ للمستقيم <span class="math-eq">ص = ٢س + ١</span>؟`, 
                options: [ 
                    { display: 'ص = ٢س - ١', value: 'A' }, { display: 'ص = ٢س + ٣', value: 'B' }, 
                    { display: 'ص = -<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span>س + ٤', value: 'C' }, { display: 'ص - ٣ = ٢(س - ٢)', value: 'D' }
                ], 
                correct: 'A', 
                explanation: `<p><b>1. ميل المستقيم المعطى:</b> <span class="math-eq">م = <span class="text-red-600 font-bold">٢</span></span>.</p><p><b>2. ميل المستقيم الموازي:</b> <span class="math-eq">م = <span class="text-red-600 font-bold">٢</span></span>.</p><p><b>3. استخدام صيغة الميل ونقطة:</b> <span class="math-eq">ص - <span class="text-blue-600 font-bold">٣</span> = <span class="text-red-600 font-bold">٢</span>(س - <span class="text-green-600 font-bold">٢</span>)</span>.</p><p><b>4. التحويل لصيغة الميل والمقطع:</b><br>نفك القوس: <span class="math-eq">ص - ٣ = ٢س - ٤</span><br>ننقل -٣: <span class="math-eq">ص = ٢س - ١</span></p>`,
                smartExplanation: `<p>الميل يجب أن يكون ٢ (لأنه موازٍ). هذا يستبعد الخيار (ج).</p><p>لنجرب تعويض النقطة (٢، ٣) في الخيارات المتبقية:</p><p><b>خيار (أ):</b> هل ٣ = ٢(٢) - ١؟ نعم، ٣ = ٣. إذن هو الجواب الصحيح.</p><p><b>خيار (ب):</b> هل ٣ = ٢(٢) + ٣؟ لا، ٣ لا تساوي ٧.</p>`
            },
            {
                type: 'mcq', level: '⭐⭐', text: `ما معادلة المستقيم المار بالنقطة (١، ٨) ومتعامد مع المستقيم <span class="math-eq">ص = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>س + ٥</span>؟`,
                options: [
                    { display: 'ص = -٤س + ١٢', value: 'A' }, { display: 'ص = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>س + ٧.٧٥', value: 'B' },
                    { display: 'ص = ٤س + ٤', value: 'C' }, { display: 'ص = -٤س + ٨', value: 'D' }
                ],
                correct: 'A',
                explanation: `<p><b>1. ميل المستقيم المعطى:</b> <span class="math-eq">م₁ = <span class="text-red-600 font-bold"><span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span></span></span>.</p><p><b>2. ميل المستقيم المتعامد:</b> معكوس مقلوب <span class="text-red-600 font-bold"><span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span></span> هو <span class="math-eq">م₂ = <span class="text-blue-600 font-bold">-٤</span></span>.</p><p><b>3. استخدام صيغة الميل ونقطة:</b> <span class="math-eq">ص - <span class="text-green-600 font-bold">٨</span> = <span class="text-blue-600 font-bold">-٤</span>(س - <span class="purple-600 font-bold">١</span>)</span>.</p><p><b>4. التحويل لصيغة الميل والمقطع:</b><br>نفك القوس: <span class="math-eq">ص - ٨ = -٤س + ٤</span><br>ننقل -٨: <span class="math-eq">ص = -٤س + ١٢</span></p>`,
                smartExplanation: `<p>الميل المطلوب هو معكوس مقلوب <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>، أي -٤. هذا يستبعد الخيارين (ب) و (ج).</p><p>لنجرب تعويض النقطة (١، ٨) في الخيارين المتبقيين:</p><p><b>خيار (أ):</b> هل ٨ = -٤(١) + ١٢؟ نعم، ٨ = ٨. إذن هو الجواب الصحيح.</p><p><b>خيار (د):</b> هل ٨ = -٤(١) + ٨؟ لا، ٨ لا تساوي ٤.</p>`
            },
            {
                type: 'mcq', level: '⭐⭐⭐', text: `أي من المعادلات التالية تمثل مستقيماً متعامداً مع <span class="math-eq">٣س + ٢ص = ٦</span>؟`,
                options: [
                    { display: 'ص = -<span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span>س + ٥', value: 'A' }, { display: 'ص = <span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span>س + ١', value: 'B' },
                    { display: 'ص = <span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>س - ٢', value: 'C' }, { display: 'ص = -<span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>س + ٤', value: 'D' }
                ],
                correct: 'C',
                explanation: `<p><b>1. نوجد ميل المستقيم المعطى:</b></p><p class='text-sm'>المعادلة الأصلية: <span class="math-eq"><span class="text-red-600 font-bold">٣</span>س + <span class="text-blue-600 font-bold">٢</span>ص = ٦</span></p><p class='text-sm'>ننقل <span class="text-red-600 font-bold">٣</span>س للطرف الآخر: <span class="math-eq"><span class="text-blue-600 font-bold">٢</span>ص = -<span class="text-red-600 font-bold">٣</span>س + ٦</span></p><p class='text-sm'>نقسم الطرفين على <span class="text-blue-600 font-bold">٢</span>: <span class="math-eq">ص = -<span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span>س + ٣</span></p><p>إذن، ميل المستقيم المعطى هو <span class="math-eq">م₁ = -<span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span>.</p><p><b>2. نوجد ميل المستقيم المتعامد:</b></p><p>ميل المستقيم المتعامد هو معكوس مقلوب الميل الأول.</p><p><span class="math-eq">م₂ = <span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span></span>.</p><p><b>3. نبحث عن المعادلة التي ميلها <span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>:</b></p><p>الإجابة الصحيحة هي <span class="math-eq">ص = <span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>س - ٢</span>.</p>`
            },
            { 
                type: 'mcq', level: '⭐', text: `ما العلاقة بين المستقيمين <span class="math-eq">٦س + ٢ص = ٨</span> و <span class="math-eq">ص = -٣س - ٢</span>؟`,
                options: [ 
                    { display: 'متوازيان', value: 'A' }, { display: 'متعامدان', value: 'B' }, 
                    { display: 'متقاطعان وغير متعامدين', value: 'C' }, { display: 'متطابقان', value: 'D' }
                ], 
                correct: 'A',
                explanation: `<p><b>1. نوجد ميل المستقيم الأول:</b></p><p class='text-sm'>المعادلة: <span class="math-eq">٦س + ٢ص = ٨</span></p><p class='text-sm'>ننقل ٦س: <span class="math-eq">٢ص = -٦س + ٨</span></p><p class='text-sm'>نقسم على ٢: <span class="math-eq">ص = -٣س + ٤</span></p><p>إذن، ميل المستقيم الأول هو <span class="math-eq">م₁ = <span class="text-red-600 font-bold">-٣</span></span>.</p><p><b>2. نوجد ميل المستقيم الثاني:</b></p><p>المعادلة <span class="math-eq">ص = -٣س - ٢</span> جاهزة بصيغة الميل والمقطع.</p><p>ميل المستقيم الثاني هو <span class="math-eq">م₂ = <span class="text-blue-600 font-bold">-٣</span></span>.</p><p><b>3. نقارن الميلين:</b></p><p>بما أن <span class="text-red-600 font-bold">-٣</span> = <span class="text-blue-600 font-bold">-٣</span>، فالمستقيمان متوازيان.</p>`
            },
            { 
                type: 'mcq', level: '⭐', text: `ما ميل المستقيم المتعامد مع المستقيم <span class="math-eq">س = ٥</span>؟`, 
                options: [ 
                    { display: '٠', value: 'A' }, { display: '١', value: 'B' }, 
                    { display: 'غير معرف', value: 'C' }, { display: '-١', value: 'D' }
                ], 
                correct: 'A', 
                explanation: `<p>المستقيم <span class="math-eq">س = ٥</span> هو مستقيم رأسي.</p><p>ميل المستقيم الرأسي غير معرف.</p><p>المستقيم المتعامد مع مستقيم رأسي هو مستقيم أفقي.</p><p>ميل أي مستقيم أفقي يساوي <span class="text-red-600 font-bold">٠</span>.</p>`,
                smartExplanation: `<p>تخيل المحاور. الخط <span class="math-eq">س = ٥</span> هو خط عمودي (رأسي). الخط العمودي عليه يجب أن يكون أفقيًا تمامًا مثل محور السينات. ميل أي خط أفقي هو صفر دائمًا.</p>`
            },
            { 
                type: 'mcq', level: '⭐⭐', text: `ما معادلة المستقيم المار بالنقطة (-٣، -١) وموازٍ للمستقيم <span class="math-eq">ص = -٢س + ٥</span>؟`, 
                options: [ 
                    { display: 'ص = -٢س - ٧', value: 'A' }, { display: 'ص = -٢س - ١', value: 'B' }, 
                    { display: 'ص = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span>س + ٠.٥', value: 'C' }, { display: 'ص = -٢س + ٥', value: 'D' }
                ], 
                correct: 'A', 
                explanation: `<p><b>1. ميل المستقيم المعطى:</b> <span class="math-eq">م = <span class="text-red-600 font-bold">-٢</span></span>.</p><p><b>2. ميل المستقيم الموازي:</b> <span class="math-eq">م = <span class="text-red-600 font-bold">-٢</span></span>.</p><p><b>3. استخدام صيغة الميل ونقطة:</b> <span class="math-eq">ص - (<span class="text-blue-600 font-bold">-١</span>) = <span class="text-red-600 font-bold">-٢</span>(س - (<span class="text-green-600 font-bold">-٣</span>))</span>.</p><p><b>4. التحويل لصيغة الميل والمقطع:</b><br>نبسط: <span class="math-eq">ص + ١ = -٢(س + ٣)</span><br>نفك القوس: <span class="math-eq">ص + ١ = -٢س - ٦</span><br>ننقل ١: <span class="math-eq">ص = -٢س - ٧</span></p>`
            },
            {
                type: 'mcq', level: '⭐⭐', text: `ما معادلة المستقيم المار بالنقطة (٤، -٢) ومتعامد مع المستقيم <span class="math-eq">ص = -٤س + ١</span>؟`,
                options: [
                    { display: 'ص = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>س - ٣', value: 'A' }, { display: 'ص = -٤س + ١٤', value: 'B' },
                    { display: 'ص = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>س - ١', value: 'C' }, { display: 'ص = ٤س - ١٨', value: 'D' }
                ],
                correct: 'A',
                explanation: `<p><b>1. ميل المستقيم المعطى:</b> <span class="math-eq">م₁ = <span class="text-red-600 font-bold">-٤</span></span>.</p><p><b>2. ميل المستقيم المتعامد:</b> معكوس مقلوب <span class="text-red-600 font-bold">-٤</span> هو <span class="math-eq">م₂ = <span class="text-blue-600 font-bold"><span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span></span></span>.</p><p><b>3. استخدام صيغة الميل ونقطة:</b> <span class="math-eq">ص - (<span class="text-green-600 font-bold">-٢</span>) = <span class="text-blue-600 font-bold"><span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span></span>(س - <span class="purple-600 font-bold">٤</span>)</span>.</p><p><b>4. التحويل لصيغة الميل والمقطع:</b><br>نبسط: <span class="math-eq">ص + ٢ = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>س - ١</span><br>ننقل ٢: <span class="math-eq">ص = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>س - ٣</span></p>`
            },
            {
                type: 'mcq', level: '⭐⭐', text: `ما العلاقة بين المستقيمين <span class="math-eq">ص - ٢ = ٣(س - ١)</span> و <span class="math-eq">ص = -<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span>س + ٤</span>؟`,
                options: [
                    { display: 'متوازيان', value: 'A' }, { display: 'متعامدان', value: 'B' },
                    { display: 'متقاطعان وغير متعامدين', value: 'C' }, { display: 'متطابقان', value: 'D' }
                ],
                correct: 'B',
                explanation: `<p><b>1. ميل المستقيم الأول:</b> المعادلة بصيغة الميل ونقطة، إذن الميل هو <span class="math-eq">م₁ = <span class="text-red-600 font-bold">٣</span></span>.</p><p><b>2. ميل المستقيم الثاني:</b> المعادلة بصيغة الميل والمقطع، إذن الميل هو <span class="math-eq">م₂ = <span class="text-blue-600 font-bold">-<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span></span></span>.</p><p><b>3. نتحقق من العلاقة:</b><br>حاصل ضرب الميلين: <span class="math-eq"><span class="text-red-600 font-bold">٣</span> × (<span class="text-blue-600 font-bold">-<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span></span>) = -١</span>.</p><p>بما أن حاصل الضرب يساوي -١، فالمستقيمان متعامدان.</p>`,
                smartExplanation: `<p>من المعادلة الأولى، الميل هو الرقم الذي خارج القوس، وهو <span class="text-red-600 font-bold">٣</span>.</p><p>من المعادلة الثانية، الميل هو الرقم المضروب في (س)، وهو <span class="text-blue-600 font-bold">-<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span></span>.</p><p>بما أن <span class="text-red-600 font-bold">٣</span> و <span class="text-blue-600 font-bold">-<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span></span> كل منهما معكوس مقلوب للآخر، فالمستقيمان متعامدان.</p>`
            },
            {
                type: 'mcq', level: '⭐⭐⭐', text: `اكتب معادلة المستقيم المار بالنقطة (٢، ٥) ومتعامد مع المستقيم <span class="math-eq">٤س + ص = ٧</span> بصيغة الميل والمقطع.`,
                options: [
                    { display: 'ص = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>س + ٤.٥', value: 'A' }, { display: 'ص = -٤س + ١٣', value: 'B' },
                    { display: 'ص = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>س - ٤.٥', value: 'C' }, { display: 'ص = -٤س + ٥', value: 'D' }
                ],
                correct: 'A',
                explanation: `<p><b>1. نوجد ميل المستقيم المعطى:</b><br><span class="math-eq">٤س + ص = ٧</span> ننقل ٤س فتصبح <span class="math-eq">ص = -٤س + ٧</span>. إذن <span class="math-eq">م₁ = <span class="text-red-600 font-bold">-٤</span></span>.</p><p><b>2. ميل المستقيم المتعامد:</b> معكوس مقلوب <span class="text-red-600 font-bold">-٤</span> هو <span class="math-eq">م₂ = <span class="text-blue-600 font-bold"><span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span></span></span>.</p><p><b>3. استخدام صيغة الميل ونقطة:</b> <span class="math-eq">ص - <span class="text-green-600 font-bold">٥</span> = <span class="text-blue-600 font-bold"><span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span></span>(س - <span class="purple-600 font-bold">٢</span>)</span>.</p><p><b>4. التحويل لصيغة الميل والمقطع:</b><br>نفك القوس: <span class="math-eq">ص - ٥ = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>س - <span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٤</span></span></span><br>نبسط وننقل -٥: <span class="math-eq">ص = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>س - ٠.٥ + ٥</span><br>الناتج النهائي: <span class="math-eq">ص = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٤</span></span>س + ٤.٥</span></p>`
            },
            {
                type: 'mcq', level: '⭐⭐⭐', text: `أي وصف يصف المستقيمين <span class="math-eq">٢س - ٥ص = -٣</span> و <span class="math-eq">٥س + ٢ص = ٦</span>؟`,
                options: [
                    { display: 'متوازيان', value: 'A' }, { display: 'متعامدان', value: 'B' },
                    { display: 'متقاطعان وغير متعامدين', value: 'C' }, { display: 'متطابقان', value: 'D' }
                ],
                correct: 'B',
                explanation: `<p><b>1. نوجد ميل المستقيم الأول:</b><br><span class="math-eq">٢س - ٥ص = -٣</span> ننقل ٢س: <span class="math-eq">-٥ص = -٢س - ٣</span> نقسم على -٥: <span class="math-eq">ص = <span class="text-red-600 font-bold"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٥</span></span></span>س + <span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٥</span></span></span>. إذن <span class="math-eq">م₁ = <span class="text-red-600 font-bold"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٥</span></span></span></span>.</p><p><b>2. نوجد ميل المستقيم الثاني:</b><br><span class="math-eq">٥س + ٢ص = ٦</span> ننقل ٥س: <span class="math-eq">٢ص = -٥س + ٦</span> نقسم على ٢: <span class="math-eq">ص = <span class="text-blue-600 font-bold">-<span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٢</span></span></span>س + ٣</span>. إذن <span class="math-eq">م₂ = <span class="text-blue-600 font-bold">-<span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٢</span></span></span></span>.</p><p><b>3. نتحقق من العلاقة:</b><br>حاصل ضرب الميلين: <span class="math-eq">(<span class="text-red-600 font-bold"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٥</span></span></span>) × (<span class="text-blue-600 font-bold">-<span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٢</span></span></span>) = -١</span>.</p><p>بما أن حاصل الضرب يساوي -١، فالمستقيمان متعامدان.</p>`,
                smartExplanation: `<p>هناك طريقة سريعة لمقارنة المستقيمات في الصورة القياسية <span class="math-eq">أس + ب ص = ج</span>.</p><p>المستقيم الأول: أ=<span class="text-red-600">٢</span>، ب=<span class="text-red-600">-٥</span>.</p><p>المستقيم الثاني: أ=<span class="text-blue-600">٥</span>، ب=<span class="text-blue-600">٢</span>.</p><p>لاحظ أن معاملي (أ) و (ب) تبادلا الأماكن وتغيرت إشارة أحدهما (<span class="text-red-600">-٥</span> أصبحت <span class="text-blue-600">٥</span>). هذه هي علامة التعامد.</p>`
            }
        ];
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random()); const questionCount = Math.min(shuffled.length, 5); return shuffled.slice(0, questionCount); }
    document.addEventListener('DOMContentLoaded', () => {
        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            state[exampleId] = { currentIndex: -1, steps: container.querySelectorAll('.step-interactive'), placeholder: container.querySelector('.interactive-placeholder'), prevBtn: container.querySelector('.prev-btn'), nextBtn: container.querySelector('.next-btn'), resetBtn: container.querySelector('.reset-btn') };
            const resetExample = () => { state[exampleId].steps.forEach(step => step.classList.remove('active')); state[exampleId].currentIndex = -1; if (state[exampleId].placeholder) { state[exampleId].placeholder.classList.remove('hidden'); } updateButtons(); };
            const updateButtons = () => { const isFirstStep = state[exampleId].currentIndex <= -1; const isLastStep = state[exampleId].currentIndex >= state[exampleId].steps.length - 1; state[exampleId].prevBtn.disabled = isFirstStep; if (isLastStep) { state[exampleId].nextBtn.classList.add('hidden'); state[exampleId].resetBtn.classList.remove('hidden'); } else { state[exampleId].nextBtn.classList.remove('hidden'); state[exampleId].resetBtn.classList.add('hidden'); } };
            
            state[exampleId].nextBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex < state[exampleId].steps.length - 1) {
                    if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.add('hidden');
                    }
                    state[exampleId].currentIndex++;
                    state[exampleId].steps[state[exampleId].currentIndex].classList.add('active');
                    updateButtons();
                }
            });
            state[exampleId].prevBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex > -1) {
                    state[exampleId].steps[state[exampleId].currentIndex].classList.remove('active');
                    state[exampleId].currentIndex--;
                     if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.remove('hidden');
                    }
                    updateButtons();
                }
            });

            if(state[exampleId].resetBtn) { state[exampleId].resetBtn.addEventListener('click', resetExample); }
            updateButtons();
        });

        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
        
        const closeSmartModalBtn = document.getElementById('closeSmartModalBtn');
        if(closeSmartModalBtn) closeSmartModalBtn.addEventListener('click', closeSmartModal);
    });
    </script>
</body>
</html>
