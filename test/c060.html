<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± ØªØ¯Ø±ÙŠØ¨ÙŠ (Ø°Ø§ØªÙŠ) - Ø±ÙŠØ§Ø¶ÙŠØ§Øª</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ø§Ù…Ø© --- */
        * { box-sizing: border-box; }
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #000;
        }

        /* --- ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒØ³ÙˆØ± ÙˆØ§Ù„Ø£Ø³Ø³ --- */
        .fraction {
            display: inline-flex;
            flex-direction: column;
            text-align: center;
            vertical-align: middle;
            margin: 0 4px;
            font-size: 0.9em;
        }
        .numerator { border-bottom: 1px solid #000; padding-bottom: 1px; display: block; }
        .denominator { padding-top: 1px; display: block; }
        sup { vertical-align: top; font-size: 0.75em; position: relative; top: -0.5em; margin-right: 2px; }

        /* --- Ø§Ù„ÙˆØ±Ù‚Ø© --- */
        .page {
            background: white; width: 210mm; min-height: 297mm; padding: 15mm;
            margin-bottom: 30px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            box-sizing: border-box; position: relative; display: flex; flex-direction: column;
        }

        /* --- Ø§Ù„ÙƒÙ„ÙŠØ´Ø© --- */
        .header-container {
            margin-bottom: 15px;
            display: flex; justify-content: space-between;
            align-items: center; font-size: 12px; height: 120px; width: 100%; border-bottom: 2px double #000; padding-bottom: 10px;
        }
        .header-right, .header-center, .header-left { text-align: center; display: flex; flex-direction: column; justify-content: center; }
        .header-right { width: 30%; align-items: flex-start; }
        .header-right p { margin: 2px 0; font-weight: bold; }
        .header-center { width: 30%; }
        .grade-circle { width: 60px; height: 60px; border: 2px solid #000; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 18px; font-weight: bold; margin: 0 auto; }
        
        .exam-info-bar {
            width: 100%; text-align: center;
            background-color: #eee;
            padding: 8px 0; margin-bottom: 20px;
            font-weight: bold; font-size: 14px; border: 1px solid #000;
        }

        /* --- Ø§Ù„Ø£Ø³Ø¦Ù„Ø© --- */
        .section-title {
            background-color: #34495e; color: #fff; padding: 8px 10px;
            border-radius: 4px; margin: 15px 0 10px 0; 
            font-size: 15px; font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
        }
        .grade-badge { background: #fff; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 12px; }

        .question-block {
            border-bottom: 1px solid #eee; padding: 10px 0; 
            page-break-inside: avoid;
        }
        .question-prompt { font-weight: bold; margin-bottom: 8px; display: flex; align-items: flex-start; gap: 8px; font-size: 15px; }
        .q-num { 
            background: #2c3e50; color: white; width: 22px; height: 22px; 
            display: flex; justify-content: center; align-items: center; 
            border-radius: 50%; font-size: 12px; flex-shrink: 0; margin-top: 2px; 
        }

        /* --- Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª --- */
        .options-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding-right: 30px; }
        .option {
            border: 1px solid #ccc; border-radius: 6px; padding: 8px; 
            cursor: pointer; display: flex; align-items: center; 
            transition: all 0.2s; font-size: 14px; background: #fff;
        }
        .option:hover { background-color: #f9f9f9; }
        .option.selected { background-color: #e3f2fd; border-color: #2196f3; box-shadow: 0 0 0 1px #2196f3; }
        
        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ØªØµØ­ÙŠØ­ */
        .option.correct-answer { background-color: #d4edda !important; border-color: #28a745 !important; color: #155724; }
        .option.wrong-answer { background-color: #f8d7da !important; border-color: #dc3545 !important; color: #721c24; }
        
        /* Ø§Ù„ØµØ­ ÙˆØ§Ù„Ø®Ø·Ø£ */
        .tf-row { display: flex; justify-content: space-between; align-items: center; width: 100%; padding-right: 30px; }
        .tf-options { display: flex; gap: 15px; }
        .tf-btn {
            padding: 5px 15px; border: 1px solid #ccc; border-radius: 20px; cursor: pointer; font-weight: bold; background: white;
        }
        .tf-btn.selected[data-val="true"] { background: #e3f2fd; border-color: #2196f3; color: #2196f3; }
        .tf-btn.selected[data-val="false"] { background: #ffebee; border-color: #f44336; color: #f44336; }
        
        /* ØªØµØ­ÙŠØ­ Ø§Ù„ØµØ­ ÙˆØ§Ù„Ø®Ø·Ø£ */
        .tf-btn.correct-state { background: #28a745 !important; color: white !important; border-color: #28a745 !important; }
        .tf-btn.wrong-state { background: #dc3545 !important; color: white !important; border-color: #dc3545 !important; opacity: 0.5; }

        /* --- Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠ --- */
        .essay-area {
            width: 100%; min-height: 120px; padding: 10px;
            border: 1px solid #bbb; border-radius: 4px;
            font-family: 'Cairo'; font-size: 14px; margin-top: 5px;
            resize: vertical;
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø®ÙÙŠØ© */
        .model-answer-section {
            display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            margin-top: 15px;
            border: 2px dashed #27ae60;
            background-color: #f0fff4;
            padding: 15px;
            border-radius: 8px;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .model-title { color: #27ae60; font-weight: bold; margin-bottom: 8px; display: block; border-bottom: 1px solid #c3e6cb; padding-bottom: 5px; }
        .grading-controls { margin-top: 15px; display: flex; align-items: center; gap: 10px; background: #fff; padding: 10px; border-radius: 5px; border: 1px solid #ddd; }
        .score-input { width: 60px; padding: 5px; text-align: center; border: 2px solid #3498db; border-radius: 4px; font-weight: bold; font-size: 16px; }

        /* --- Ø§Ù„ØªØ­ÙƒÙ… --- */
        .floating-controls {
            position: fixed; bottom: 20px; left: 20px; 
            display: flex; flex-direction: column; gap: 10px; 
            z-index: 999;
        }
        .btn {
            padding: 12px 25px; border: none; border-radius: 30px;
            font-family: 'Cairo'; font-weight: bold; font-size: 16px;
            cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-check { background-color: #27ae60; color: white; }
        .btn-retry { background-color: #e67e22; color: white; }
        .btn-calc { background-color: #8e44ad; color: white; display: none; }

        /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„Ù…Ø®ØµØµØ© */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 2000;
            display: none; justify-content: center; align-items: center;
        }
        .modal-box {
            background: white; padding: 30px; border-radius: 15px; text-align: center; width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 90%;
        }
        .score-display { font-size: 40px; color: #2c3e50; font-weight: bold; margin: 20px 0; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal-buttons { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .btn-modal { padding: 10px 20px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; font-family: 'Cairo'; }
        .btn-confirm { background: #27ae60; color: white; }
        .btn-cancel { background: #e74c3c; color: white; }
        .btn-close { background: #95a5a6; color: white; }

        @media print {
            .floating-controls, .modal-overlay { display: none !important; }
            body { background: white; padding: 0; }
            .page { margin: 0; box-shadow: none; border: none; width: 100%; }
            .essay-area { border: 1px solid #000; }
        }
    </style>
</head>
<body>

    <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© -->
    <div class="floating-controls">
        <button class="btn btn-check" id="checkBtn" onclick="window.askToGrade()">âœ… ØªØµØ­ÙŠØ­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        <button class="btn btn-calc" id="calcBtn" onclick="window.showFinalResult()">ğŸ“Š Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</button>
        <button class="btn btn-retry" onclick="location.reload()">ğŸ”„ Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯ (Ø¥Ø¹Ø§Ø¯Ø©)</button>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯ (Ø¨Ø¯ÙŠÙ„ Ø¹Ù† confirm) -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal-box">
            <h3>ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØµØ­ÙŠØ­</h3>
            <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø­Ù„ ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„Ø°Ø§ØªÙŠØŸ</p>
            <p style="font-size: 12px; color: #777;">(Ù„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ)</p>
            <div class="modal-buttons">
                <button class="btn-modal btn-confirm" onclick="window.executeGrading()">Ù†Ø¹Ù…ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØµØ­ÙŠØ­</button>
                <button class="btn-modal btn-cancel" onclick="document.getElementById('confirmModal').style.display='none'">ØªØ±Ø§Ø¬Ø¹</button>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (Ø¨Ø¯ÙŠÙ„ Ø¹Ù† alert) -->
    <div class="modal-overlay" id="alertModal">
        <div class="modal-box">
            <h3 id="alertTitle">ØªÙ†Ø¨ÙŠÙ‡</h3>
            <p id="alertMessage"></p>
            <div class="modal-buttons">
                <button class="btn-modal btn-close" onclick="document.getElementById('alertModal').style.display='none'">Ø­Ø³Ù†Ø§Ù‹</button>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->
    <div class="modal-overlay" id="resultModal">
        <div class="modal-box">
            <h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
            <p>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª (Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ÙŠ + ØªÙ‚ÙŠÙŠÙ…Ùƒ Ø§Ù„Ø°Ø§ØªÙŠ Ù„Ù„Ù…Ù‚Ø§Ù„ÙŠ)</p>
            <div class="score-display"><span id="finalScore">0</span> / 60</div>
            <p id="feedbackText"></p>
            <div class="modal-buttons">
                <button class="btn-modal btn-retry" onclick="location.reload()" style="background-color: #e67e22; color: white;">Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ø®Ø±Ù‰</button>
                <button class="btn-modal btn-close" onclick="document.getElementById('resultModal').style.display='none'">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙˆØ±Ù‚Ø©</button>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ -->
    <div class="page">
        <div class="header-container">
            <div class="header-right">
                <p>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</p>
                <p>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</p>
                <p>Ø§Ø®ØªØ¨Ø§Ø± ØªØ¯Ø±ÙŠØ¨ÙŠ (Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ)</p>
            </div>
            <div class="header-center">
                <div class="grade-circle">60</div>
            </div>
            <div class="header-left">
                <p>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨: <span style="font-weight:normal; text-decoration: underline;">Ø·Ø§Ù„Ø¨ (ØªØ¯Ø±ÙŠØ¨ Ø°Ø§ØªÙŠ)</span></p>
                <p>Ø§Ù„Ù…Ø§Ø¯Ø©: Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù£Ù…</p>
                <p>Ø§Ù„Ø²Ù…Ù†: Ù…ÙØªÙˆØ­</p>
            </div>
        </div>

        <div class="exam-info-bar">
            ØªÙ†Ø¨ÙŠÙ‡: Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ø°Ø§ØªÙŠ. Ø£Ø¬Ø¨ Ø¹Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø©ØŒ Ø«Ù… Ø§Ø¶ØºØ· "ØªØµØ­ÙŠØ­" Ù„ÙŠØ¸Ù‡Ø± Ù„Ùƒ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ØŒ Ø«Ù… Ù‚ÙŠÙ… Ù†ÙØ³Ùƒ ÙÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠØ©.
        </div>

        <!-- Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª -->
        <div class="section-title">
            <span>Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„: Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</span>
            <span class="grade-badge">45 Ø¯Ø±Ø¬Ø©</span>
        </div>
        <div id="mcq-container"></div>
    </div>

    <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© -->
    <div class="page">
        <div class="section-title">
            <span>ØªØ§Ø¨Ø¹ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„ (Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª):</span>
        </div>
        <div id="mcq-container-p2"></div>
        
        <div class="section-title">
            <span>Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø¶Ø¹ Ø¹Ù„Ø§Ù…Ø© (âœ“) Ø£Ùˆ (âŒ):</span>
            <span class="grade-badge">5 Ø¯Ø±Ø¬Ø§Øª</span>
        </div>
        <div id="tf-container"></div>
    </div>

    <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠ) -->
    <div class="page">
        <div class="section-title">
            <span>Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ù„Ø«: Ø£Ø¬Ø¨ ÙƒØªØ§Ø¨ÙŠØ§Ù‹ Ø«Ù… ØµØ­Ø­ Ù„Ù†ÙØ³Ùƒ:</span>
            <span class="grade-badge">10 Ø¯Ø±Ø¬Ø§Øª</span>
        </div>
        <div id="essay-container"></div>

        <div style="margin-top: auto; text-align: center; font-size: 14px; color: #777;">
            *** Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© *** <br>
            Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØµØ­ÙŠØ­ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©
        </div>
    </div>

    <script>
        /* --- Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª --- */
        const mcqBank = [
            { q: "Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØªÙŠ Ù„ÙŠØ³ Ù„Ù‡Ø§ Ø­Ù„ ØªØ³Ù…Ù‰:", options: ["Ù…Ø¹Ø§Ø¯Ù„Ø© Ù…Ø³ØªØ­ÙŠÙ„Ø© Ø§Ù„Ø­Ù„", "Ù…ØªØ·Ø§Ø¨Ù‚Ø©", "Ø¬Ù…Ù„Ø© Ù…ÙØªÙˆØ­Ø©", "Ø¯Ø§Ù„Ø© Ø®Ø·ÙŠØ©"], ans: 0 },
            { q: "Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø³ + Ù¦ = Ù¢Ù  Ù‡Ùˆ:", options: ["Ù¢Ù¦", "Ù¡Ù¤", "-Ù¡Ù¤", "Ù¦"], ans: 1 },
            { q: "Ù‚ÙŠÙ…Ø© Ù… Ø§Ù„ØªÙŠ ØªØ¬Ø¹Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ù£Ù… = Ù¢Ù§ ØµØ­ÙŠØ­Ø© Ù‡ÙŠ:", options: ["Ù©", "Ù§", "Ù¢Ù¤", "Ù¨Ù¡"], ans: 0 },
            { q: "Ù…Ø¬Ù…ÙˆØ¹Ø© Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© |Ø³| = -Ù© Ù‡ÙŠ:", options: ["{Ù©}", "{-Ù©}", "{Ù©ØŒ -Ù©}", "âˆ… (ÙØ§ÙŠ)"], ans: 3 },
            { q: "Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ù¥(Ø³ + Ù¢) = Ù¥Ø³ + Ù¡Ù :", options: ["Ø³ = Ù¡", "Ø³ = Ù ", "Ù„ÙŠØ³ Ù„Ù‡Ø§ Ø­Ù„", "Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©"], ans: 3 },
            { q: "Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø© Ø§Ù„ØªÙŠ ØªÙ…Ø«Ù„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø³ Ùˆ Ù£ ØªØ³Ø§ÙˆÙŠ Ù¤:", options: ["|Ø³ - Ù£| = Ù¤", "|Ø³ + Ù£| = Ù¤", "|Ø³ - Ù¤| = Ù£", "|Ø³ + Ù¤| = Ù£"], ans: 0 },
            { q: "Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„ØªØ§Ø¨Ø¹ ÙÙŠ 'ÙƒÙ„Ù…Ø§ Ø²Ø§Ø¯ Ø§Ù„Ù…Ø·Ø± Ø§Ø±ØªÙØ¹ Ù…Ù†Ø³ÙˆØ¨ Ø§Ù„Ù…ÙŠØ§Ù‡':", options: ["ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ø±", "Ù…Ù†Ø³ÙˆØ¨ Ø§Ù„Ù…ÙŠØ§Ù‡", "ÙˆÙ‚Øª Ø§Ù„Ù…Ø·Ø±", "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©"], ans: 1 },
            { q: "Ø£ÙŠ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© ØªÙ…Ø«Ù„ Ø¯Ø§Ù„Ø© Ø®Ø·ÙŠØ©ØŸ", options: ["Øµ = Ø³<sup>Ù£</sup>", "Øµ = Ù¤Ø³ + Ù¡", "Øµ = <span class='fraction'><span class='numerator'>Ù¢</span><span class='denominator'>Ø³</span></span>", "Ø³ Øµ = Ù¥"], ans: 1 },
            { q: "Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ… Ø§Ù„Ù…Ø§Ø± Ø¨Ø§Ù„Ù†Ù‚Ø·ØªÙŠÙ† (Ù¡ØŒ Ù£) Ùˆ (Ù£ØŒ Ù§) Ù‡Ùˆ:", options: ["Ù¡", "Ù¢", "Ù£", "Ù¤"], ans: 1 },
            { q: "Ø£Ø³Ø§Ø³ Ø§Ù„Ù…ØªØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©: Ù¢ØŒ Ù¦ØŒ Ù¡Ù ØŒ Ù¡Ù¤ØŒ ... Ù‡Ùˆ:", options: ["Ù¢", "Ù¤", "-Ù¤", "Ù¦"], ans: 1 },
            { q: "Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„ØµØ§Ø¯ÙŠ Ù„Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Øµ = Ù£Ø³ - Ù§ Ù‡Ùˆ:", options: ["Ù£", "-Ù§", "Ù§", "Ù "], ans: 1 },
            { q: "Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø­Ø¯ Ø§Ù„Ù†ÙˆÙ†ÙŠ Ù„Ù„Ù…ØªØªØ§Ø¨Ø¹Ø© (Ø£ÙˆÙ„Ù‡Ø§ Ù£ ÙˆØ£Ø³Ø§Ø³Ù‡Ø§ Ù¤):", options: ["Ø£Ù† = Ù¤Ù† - Ù¡", "Ø£Ù† = Ù¤Ù† + Ù¡", "Ø£Ù† = Ù£Ù† + Ù¤", "Ø£Ù† = Ù¤Ù† + Ù£"], ans: 0 },
            { q: "Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ© Ù„Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø®Ø·ÙŠØ© ØªÙƒØªØ¨ Ø¹Ù„Ù‰ ØµÙˆØ±Ø©:", options: ["Øµ = Ù… Ø³ + Ø¨", "Ø£ Ø³ + Ø¨ Øµ = Ø¬Ù€", "Øµ - ØµÙ¡ = Ù…(Ø³ - Ø³Ù¡)", "Øµ = Ø£ Ø³"], ans: 1 },
            { q: "Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ… Ø§Ù„Ø£ÙÙ‚ÙŠ (Ø§Ù„Ù…ÙˆØ§Ø²ÙŠ Ù„Ù„Ø³ÙŠÙ†Ø§Øª) Ù‡Ùˆ:", options: ["ØµÙØ±", "Ù¡", "-Ù¡", "ØºÙŠØ± Ù…Ø¹Ø±Ù"], ans: 0 },
            { q: "Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ…Ø§Ù† Ø§Ù„Ù„Ø°Ø§Ù† Ù„Ù‡Ù…Ø§ Ø§Ù„Ù…ÙŠÙ„ Ù†ÙØ³Ù‡ (Ù…Ù¡ = Ù…Ù¢) Ù‡Ù…Ø§:", options: ["Ù…ØªÙˆØ§Ø²ÙŠØ§Ù†", "Ù…ØªØ¹Ø§Ù…Ø¯Ø§Ù†", "Ù…ØªÙ‚Ø§Ø·Ø¹Ø§Ù†", "ØºÙŠØ± Ø°Ù„Ùƒ"], ans: 0 },
            { q: "Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ… (Ù…ÙŠÙ„Ù‡ Ù¤ ÙˆÙ…Ù‚Ø·Ø¹Ù‡ Ø§Ù„ØµØ§Ø¯ÙŠ Ù¡):", options: ["Øµ = Ù¤Ø³ + Ù¡", "Øµ = Ø³ + Ù¤", "Ù¤Ø³ + Øµ = Ù¡", "Øµ = Ù¤Ø³ - Ù¡"], ans: 0 },
            { q: "Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ… Ø§Ù„Ù…Ø¹Ø§Ù…Ø¯ Ù„Ù„Ù…Ø³ØªÙ‚ÙŠÙ… Øµ = Ù¢Ø³ + Ù£ Ù‡Ùˆ:", options: ["Ù¢", "-Ù¢", "<span class='fraction'><span class='numerator'>Ù¡</span><span class='denominator'>Ù¢</span></span>", "<span class='fraction'><span class='numerator'>-Ù¡</span><span class='denominator'>Ù¢</span></span>"], ans: 3 },
            { q: "Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ… Ø§Ù„Ù…Ø§Ø± Ø¨Ø§Ù„Ù†Ù‚Ø·Ø© (Ù ØŒ Ù ) ÙˆÙ…ÙŠÙ„Ù‡ -Ù£:", options: ["Øµ = -Ù£", "Ø³ = -Ù£", "Øµ = -Ù£Ø³", "Øµ = Ø³ - Ù£"], ans: 2 },
            { q: "Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø³ + Ù¢ < Ù¥:", options: ["Ø³ < Ù£", "Ø³ > Ù£", "Ø³ < Ù§", "Ø³ > Ù§"], ans: 0 },
            { q: "Ø¹Ù†Ø¯ Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ù…ÙˆØ¬Ø¨ ÙÙŠ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© ÙØ¥Ù† Ø§Ù„Ø¥Ø´Ø§Ø±Ø©:", options: ["ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ", "ØªÙ†Ø¹ÙƒØ³", "ØªØµØ¨Ø­ ÙŠØ³Ø§ÙˆÙŠ", "ØªØ­Ø°Ù"], ans: 0 },
            { q: "Ù…Ø¬Ù…ÙˆØ¹Ø© Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© |Ø³| > -Ù¢:", options: ["Ø­ (Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©)", "âˆ…", "{Ù¢}", "{-Ù¢}"], ans: 0 },
            { q: "Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© 'Ø¹Ø¯Ø¯ Ù„Ø§ ÙŠÙ‚Ù„ Ø¹Ù† Ù¡Ù¥' ØªÙƒØªØ¨:", options: ["Ø³ â‰¥ Ù¡Ù¥", "Ø³ â‰¤ Ù¡Ù¥", "Ø³ > Ù¡Ù¥", "Ø³ < Ù¡Ù¥"], ans: 0 },
            { q: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© (Ø§Ù„ØªÙ‚Ø§Ø·Ø¹) ØªØ­ØªÙˆÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·:", options: ["Ùˆ", "Ø£Ùˆ", "Ø¥Ø°Ø§", "ÙÙ‚Ø·"], ans: 0 },
            { q: "Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© -Ù£Ø³ â‰¤ Ù©:", options: ["Ø³ â‰¥ -Ù£", "Ø³ â‰¤ -Ù£", "Ø³ â‰¥ Ù£", "Ø³ â‰¤ Ù£"], ans: 0 },
            { q: "Ø¹Ø¯Ø¯ Ø­Ù„ÙˆÙ„ Ù†Ø¸Ø§Ù… Ù…Ø³ØªÙ‚ÙŠÙ…ÙŠÙ† Ù…ØªÙ‚Ø§Ø·Ø¹ÙŠÙ† ÙÙŠ Ù†Ù‚Ø·Ø© ÙˆØ§Ø­Ø¯Ø©:", options: ["Ø­Ù„ ÙˆØ§Ø­Ø¯", "Ø¹Ø¯Ø¯ Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠ", "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ù„", "Ø­Ù„Ø§Ù†"], ans: 0 },
            { q: "Ø£ÙØ¶Ù„ Ø·Ø±ÙŠÙ‚Ø© Ù„Ø­Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…: Ø³ = Øµ + Ù¢ ØŒ Ù¢Ø³ + Øµ = Ù¥:", options: ["Ø§Ù„ØªØ¹ÙˆÙŠØ¶", "Ø§Ù„Ø­Ø°Ù Ø¨Ø§Ù„Ø¬Ù…Ø¹", "Ø§Ù„Ø­Ø°Ù Ø¨Ø§Ù„Ø·Ø±Ø­", "Ø§Ù„Ø¶Ø±Ø¨"], ans: 0 },
            { q: "Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ù‡ Ø­Ù„ ÙŠØ³Ù…Ù‰:", options: ["Ù…ØªØ³Ù‚ ÙˆÙ…Ø³ØªÙ‚Ù„", "Ù…ØªØ³Ù‚ ÙˆØºÙŠØ± Ù…Ø³ØªÙ‚Ù„", "ØºÙŠØ± Ù…ØªØ³Ù‚", "Ù…ØªØ¹Ø§Ù…Ø¯"], ans: 2 },
            { q: "Ù„Ø­Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ù¥Ø³+Ù¢Øµ=Ù¡Ù  Ùˆ Ù£Ø³+Ù¢Øµ=Ù¦ Ù†Ø³ØªØ®Ø¯Ù…:", options: ["Ø§Ù„Ø¬Ù…Ø¹", "Ø§Ù„Ø·Ø±Ø­", "Ø§Ù„Ø¶Ø±Ø¨", "Ø§Ù„Ù‚Ø³Ù…Ø©"], ans: 1 },
            { q: "Ø­Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø³+Øµ=Ù¤ Ùˆ Ø³-Øµ=Ù¢ Ù‡Ùˆ:", options: ["(Ù£ØŒ Ù¡)", "(Ù¢ØŒ Ù¢)", "(Ù¤ØŒ Ù )", "(Ù¡ØŒ Ù£)"], ans: 0 },
            { q: "Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ…Ø§Ù† Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ† ÙØ¥Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ù„ÙˆÙ„:", options: ["Ø­Ù„ ÙˆØ§Ø­Ø¯", "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ù„", "Ø¹Ø¯Ø¯ Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠ", "ØµÙØ±"], ans: 2 }
        ];

        const tfBank = [
            { q: "Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ù¢(Ø³ + Ù£) = Ù¢Ø³ + Ù¦ ØªÙ…Ø«Ù„ Ù…ØªØ·Ø§Ø¨Ù‚Ø©.", ans: true },
            { q: "Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ… Ø§Ù„Ø±Ø£Ø³ÙŠ ØºÙŠØ± Ù…Ø¹Ø±Ù.", ans: true },
            { q: "Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„ØµØ§Ø¯ÙŠ Ù„Ù„Ù…Ø³ØªÙ‚ÙŠÙ… Øµ = Ù£Ø³ + Ù§ Ù‡Ùˆ Ù£.", ans: false },
            { q: "Ø§Ù„Ù…ØªØªØ§Ø¨Ø¹Ø© Ù¡ØŒ Ù¤ØŒ Ù©ØŒ Ù¡Ù¦ ... Ù‡ÙŠ Ù…ØªØªØ§Ø¨Ø¹Ø© Ø­Ø³Ø§Ø¨ÙŠØ©.", ans: false },
            { q: "Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø±Ø¨ ÙÙŠ Ø¹Ø¯Ø¯ Ø³Ø§Ù„Ø¨ ÙÙŠ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ù†Ø¹ÙƒØ³ Ø¥Ø´Ø§Ø±Ø© Ø§Ù„ØªØ¨Ø§ÙŠÙ†.", ans: true }
        ];

        const essayModels = {
            A: [
                { q: "Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ÙˆØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø­Ù„: Ù¢(Ø³ + Ù£) - Ù¤ = Ù¡Ù ", ans: "Ù¡) Ù¢Ø³ + Ù¦ - Ù¤ = Ù¡Ù  <br> Ù¢) Ù¢Ø³ + Ù¢ = Ù¡Ù  <br> Ù£) Ù¢Ø³ = Ù¨  â†  Ø³ = Ù¤", max: 3 },
                { q: "Ø­Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø§Ù„Ø­Ø°Ù: <br> Ù¢Ø³ + Øµ = Ù¨ <br> Ù¢Ø³ - Øµ = Ù¤", ans: "Ù¡) Ø¨Ø§Ù„Ø¬Ù…Ø¹: Ù¤Ø³ = Ù¡Ù¢  â†  Ø³ = Ù£ <br> Ù¢) Ù†Ø¹ÙˆØ¶: Ù¢(Ù£) + Øµ = Ù¨  â†  Ù¦ + Øµ = Ù¨  â†  Øµ = Ù¢", max: 3 },
                { q: "Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ÙˆÙ…Ø«Ù„ Ø§Ù„Ø­Ù„ Ø¨ÙŠØ§Ù†ÙŠØ§Ù‹: | Ø³ - Ù¢ | < Ù£", ans: "Ù¡) -Ù£ < Ø³ - Ù¢ < Ù£ <br> Ù¢) Ù†Ø¶ÙŠÙ Ù¢ Ù„Ù„Ø£Ø·Ø±Ø§Ù: -Ù¡ < Ø³ < Ù¥ <br> Ù£) Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø­Ù„: { Ø³ | -Ù¡ < Ø³ < Ù¥ }", max: 4 }
            ],
            B: [
                { q: "Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: Ù£(Ø³ - Ù¡) + Ù¥ = Ù¡Ù¡", ans: "Ù¡) Ù£Ø³ - Ù£ + Ù¥ = Ù¡Ù¡ <br> Ù¢) Ù£Ø³ + Ù¢ = Ù¡Ù¡ <br> Ù£) Ù£Ø³ = Ù©  â†  Ø³ = Ù£", max: 3 },
                { q: "Ø­Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ØªØ¹ÙˆÙŠØ¶: <br> Øµ = Ø³ + Ù¡ <br> Ù¢Ø³ + Øµ = Ù§", ans: "Ù¡) Ù†Ø¹ÙˆØ¶: Ù¢Ø³ + (Ø³ + Ù¡) = Ù§ <br> Ù¢) Ù£Ø³ + Ù¡ = Ù§  â†  Ù£Ø³ = Ù¦  â†  Ø³ = Ù¢ <br> Ù£) Øµ = Ù¢ + Ù¡ = Ù£", max: 3 },
                { q: "Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© ÙˆÙ…Ø«Ù„Ù‡Ø§: | Ø³ + Ù¡ | â‰¥ Ù¤", ans: "Ù¡) Ø³ + Ù¡ â‰¥ Ù¤  Ø£Ùˆ  Ø³ + Ù¡ â‰¤ -Ù¤ <br> Ù¢) Ø³ â‰¥ Ù£  Ø£Ùˆ  Ø³ â‰¤ -Ù¥ <br> Ù£) Ø§Ù„Ø­Ù„: Ø§ØªØ­Ø§Ø¯ Ø§Ù„ÙØªØ±ØªÙŠÙ†", max: 4 }
            ]
        };

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø©
        let currentMcq = [];
        let currentTf = [];
        let currentEssay = [];

        // Ø¯Ø§Ù„Ø© Ø®Ù„Ø· Ø§Ù„Ù…ØµÙÙˆÙØ©
        window.shuffleArray = function(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        window.initExam = function() {
            // 1. Ø®Ù„Ø· Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ÙŠØ©
            currentMcq = window.shuffleArray([...mcqBank]);
            currentTf = window.shuffleArray([...tfBank]);

            // 2. Ø§Ø®ØªÙŠØ§Ø± Ù†Ù…ÙˆØ°Ø¬ Ù…Ù‚Ø§Ù„ÙŠ Ø¹Ø´ÙˆØ§Ø¦ÙŠ (A Ø£Ùˆ B)
            const modelKey = Math.random() < 0.5 ? 'A' : 'B';
            currentEssay = essayModels[modelKey];

            // 3. Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            window.renderMCQ();
            window.renderTF();
            window.renderEssay();
        }

        window.renderMCQ = function() {
            const p1Container = document.getElementById('mcq-container');
            const p2Container = document.getElementById('mcq-container-p2');
            const letters = ['Ø£', 'Ø¨', 'Ø¬', 'Ø¯'];
            
            p1Container.innerHTML = '';
            p2Container.innerHTML = '';

            currentMcq.forEach((item, index) => {
                const html = `
                    <div class="question-block" id="mcq-${index}" data-ans="${item.ans}">
                        <div class="question-prompt">
                            <span class="q-num">${index + 1}</span> ${item.q}
                        </div>
                        <div class="options-container">
                            ${item.options.map((opt, i) => `
                                <div class="option" onclick="window.selectOption(this, ${index}, ${i})">
                                    <span style="font-weight:bold; margin-left:5px;">${letters[i]}.</span> ${opt}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                if (index < 14) p1Container.insertAdjacentHTML('beforeend', html);
                else p2Container.insertAdjacentHTML('beforeend', html);
            });
        }

        window.renderTF = function() {
            const container = document.getElementById('tf-container');
            container.innerHTML = '';

            currentTf.forEach((item, index) => {
                const html = `
                    <div class="question-block" id="tf-${index}" data-ans="${item.ans}">
                        <div class="tf-row">
                            <div class="question-prompt" style="margin:0;">
                                <span class="q-num">${index + 1}</span> ${item.q}
                            </div>
                            <div class="tf-options">
                                <button class="tf-btn" onclick="window.selectTF(this, ${index}, true)">ØµØ­ (âœ“)</button>
                                <button class="tf-btn" onclick="window.selectTF(this, ${index}, false)">Ø®Ø·Ø£ (âŒ)</button>
                            </div>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        window.renderEssay = function() {
            const container = document.getElementById('essay-container');
            container.innerHTML = '';

            currentEssay.forEach((item, index) => {
                const html = `
                    <div class="question-block" style="border:none;">
                        <div class="question-prompt">
                            <span class="q-num">${index + 1}</span> ${item.q}
                        </div>
                        <textarea class="essay-area" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                        
                        <!-- Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø®ÙÙŠ -->
                        <div class="model-answer-section" id="essay-model-${index}">
                            <span class="model-title">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©:</span>
                            <div style="line-height:1.6; font-size:14px;">${item.ans}</div>
                            
                            <div class="grading-controls">
                                <label>Ù‚Ø§Ø±Ù† Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¨Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ¶Ø¹ Ø¯Ø±Ø¬ØªÙƒ Ø¨Ù†ÙØ³Ùƒ:</label>
                                <input type="number" class="score-input" id="score-${index}" min="0" max="${item.max}" placeholder="0">
                                <span> Ù…Ù† <strong>${item.max}</strong></span>
                            </div>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙØ§Ø¹Ù„ (Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€ window) ---
        window.selectOption = function(el, qIndex, optIndex) {
            // Ù…Ù†Ø¹ Ø§Ù„ØªØºÙŠÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù„ØªØµØ­ÙŠØ­
            const checkBtn = document.getElementById('checkBtn');
            if(checkBtn && checkBtn.style.display === 'none') return; 

            const parent = document.getElementById(`mcq-${qIndex}`);
            if(!parent) return;

            parent.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            parent.dataset.userChoice = optIndex;
        }

        window.selectTF = function(el, qIndex, val) {
            // Ù…Ù†Ø¹ Ø§Ù„ØªØºÙŠÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù„ØªØµØ­ÙŠØ­
            const checkBtn = document.getElementById('checkBtn');
            if(checkBtn && checkBtn.style.display === 'none') return;

            const parent = document.getElementById(`tf-${qIndex}`);
            if(!parent) return;

            parent.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            el.dataset.val = val;
            parent.dataset.userChoice = val;
        }
        
        // --- Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ---
        window.showAlert = function(title, message) {
            document.getElementById('alertTitle').textContent = title;
            document.getElementById('alertMessage').textContent = message;
            document.getElementById('alertModal').style.display = 'flex';
        }

        // --- Ø·Ù„Ø¨ Ø§Ù„ØªØµØ­ÙŠØ­ (ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„) ---
        window.askToGrade = function() {
            document.getElementById('confirmModal').style.display = 'flex';
        }

        // --- ØªÙ†ÙÙŠØ° Ø§Ù„ØªØµØ­ÙŠØ­ (Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ù†Ø¹Ù…) ---
        window.executeGrading = function() {
            try {
                // Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯
                document.getElementById('confirmModal').style.display = 'none';

                // 1. ØªØµØ­ÙŠØ­ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
                currentMcq.forEach((item, index) => {
                    const block = document.getElementById(`mcq-${index}`);
                    if(!block) return; 

                    const userChoice = block.dataset.userChoice;
                    const options = block.querySelectorAll('.option');
                    
                    // ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµØ­ÙŠØ­ Ø¯Ø§Ø¦Ù…Ø§Ù‹
                    if(options[item.ans]) options[item.ans].classList.add('correct-answer');
                    
                    // ØªÙ„ÙˆÙŠÙ† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† Ø®Ø·Ø£
                    if (userChoice !== undefined && parseInt(userChoice) !== item.ans) {
                        if(options[userChoice]) options[userChoice].classList.add('wrong-answer');
                    }
                });

                // 2. ØªØµØ­ÙŠØ­ Ø§Ù„ØµØ­ ÙˆØ§Ù„Ø®Ø·Ø£
                currentTf.forEach((item, index) => {
                    const block = document.getElementById(`tf-${index}`);
                    if(!block) return;

                    const userChoice = block.dataset.userChoice;
                    const btns = block.querySelectorAll('.tf-btn');
                    
                    btns.forEach(btn => {
                        const btnVal = btn.innerHTML.includes('ØµØ­'); // true button logic
                        
                        // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø²Ø± Ø§Ù„ØµØ­ÙŠØ­
                        if(btnVal === item.ans) btn.classList.add('correct-state');
                        
                        // Ø¥Ø°Ø§ Ø£Ø¬Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø®Ø·Ø£
                        if(userChoice !== undefined) {
                            const userBool = userChoice === "true";
                            if((userBool === btnVal) && userBool !== item.ans) {
                                btn.classList.add('wrong-state');
                            }
                        }
                    });
                });

                // 3. Ø¥Ø¸Ù‡Ø§Ø± Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠ
                document.querySelectorAll('.model-answer-section').forEach(div => {
                    div.style.display = 'block';
                });
                document.querySelectorAll('.essay-area').forEach(txt => txt.disabled = true); // Ù‚ÙÙ„ Ø§Ù„ÙƒØªØ§Ø¨Ø©

                // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                const checkBtn = document.getElementById('checkBtn');
                const calcBtn = document.getElementById('calcBtn');
                if(checkBtn) checkBtn.style.display = 'none';
                if(calcBtn) calcBtn.style.display = 'block';

                window.showAlert("ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­", "ØªÙ… ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ÙŠØ©. Ø§Ù†Ø²Ù„ Ù„Ù„Ø£Ø³ÙÙ„ â¬‡ï¸ Ù„ØªÙ‚ÙŠÙŠÙ… Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠØ© Ø¨Ù†ÙØ³Ùƒ Ø«Ù… Ø§Ø¶ØºØ· (Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©).");

            } catch (error) {
                console.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ­ÙŠØ­:", error);
                window.showAlert("Ø®Ø·Ø£", "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ­ÙŠØ­.");
            }
        }

        window.showFinalResult = function() {
            try {
                // Ø­Ø³Ø§Ø¨ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ÙŠ (1.5 Ø¯Ø±Ø¬Ø© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ 1 Ø¯Ø±Ø¬Ø© Ù„Ù„ØµØ­ ÙˆØ§Ù„Ø®Ø·Ø£)
                let objectiveScore = 0;
                
                // Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª (30 Ø³Ø¤Ø§Ù„ * 1.5 = 45)
                currentMcq.forEach((item, index) => {
                    const block = document.getElementById(`mcq-${index}`);
                    if(block && block.dataset.userChoice == item.ans) objectiveScore += 1.5;
                });

                // Ø§Ù„ØµØ­ ÙˆØ§Ù„Ø®Ø·Ø£ (5 Ø£Ø³Ø¦Ù„Ø© * 1 = 5)
                currentTf.forEach((item, index) => {
                    const block = document.getElementById(`tf-${index}`);
                    if(block && block.dataset.userChoice === String(item.ans)) objectiveScore += 1;
                });

                // Ø­Ø³Ø§Ø¨ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨
                let essayScore = 0;
                let missingInput = false;
                
                currentEssay.forEach((item, index) => {
                    const input = document.getElementById(`score-${index}`);
                    if(!input) return;

                    const val = parseFloat(input.value);
                    if(isNaN(val)) {
                        missingInput = true;
                        input.style.borderColor = "red";
                    } else {
                        if (val > item.max) { essayScore += item.max; } // Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
                        else { essayScore += val; }
                        input.style.borderColor = "#3498db";
                    }
                });

                if(missingInput) {
                    window.showAlert("Ø¯Ø±Ø¬Ø§Øª Ù†Ø§Ù‚ØµØ©", "ÙŠØ±Ø¬Ù‰ ÙˆØ¶Ø¹ Ø¯Ø±Ø¬Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠØ© (Ø¶Ø¹ 0 Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø®Ø§Ø·Ø¦Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„).");
                    return;
                }

                const total = Math.round(objectiveScore + essayScore);
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                document.getElementById('finalScore').textContent = total;
                const feedback = document.getElementById('feedbackText');
                if(total >= 50) { feedback.textContent = "Ù…Ù…ØªØ§Ø²! Ù…Ø³ØªÙˆÙ‰ Ø±Ø§Ø¦Ø¹ ğŸŒŸ"; feedback.style.color = "green"; }
                else if(total >= 40) { feedback.textContent = "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ ğŸ‘"; feedback.style.color = "blue"; }
                else { feedback.textContent = "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„ØªØ­Ø³ÙŠÙ† Ù…Ø³ØªÙˆØ§Ùƒ ğŸ’ª"; feedback.style.color = "orange"; }

                document.getElementById('resultModal').style.display = 'flex';
            } catch (e) {
                console.error(e);
                window.showAlert("Ø®Ø·Ø£", "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©.");
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        window.addEventListener('load', window.initExam);

    </script>
</body>
</html>
