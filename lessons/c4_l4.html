<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدرس ٤-٤: حل المتباينات المركبة | منصة الرياضيات التفاعلية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .vocab-term-alt { background-color: #dbeafe; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; min-height: 80px; display: flex; align-items: center; justify-content: center; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-number { background-color: #fef9c3; border: 1px solid #fde047; color: #b45309; font-weight: bold; padding: 0 5px; border-radius: 4px; }
        .math-eq { font-family: "Courier New", monospace; font-size: 1.1rem; font-weight: bold; color: #4338ca; background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 2px 8px; border-radius: 6px; display: inline-block; vertical-align: middle; }
        .math-eq .highlight-number { padding: 0; border: none; }
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
        .number-line-wrapper { margin-top: 1rem; padding: 1rem 0; }
        .number-line { position: relative; width: 100%; height: 2px; background-color: #374151; }
        .number-line::before, .number-line::after { content: ''; position: absolute; top: 50%; transform: translateY(-50%); width: 0; height: 0; border-style: solid; }
        .number-line::before { left: -1px; border-width: 6px 8px 6px 0; border-color: transparent #374151 transparent transparent; }
        .number-line::after { right: -1px; border-width: 6px 0 6px 8px; border-color: transparent transparent transparent #374151; }
        .ticks-container { position: relative; width: 100%; height: 2rem; }
        .tick { position: absolute; bottom: 0; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; font-size: 0.875rem; }
        .tick::before { content: ''; width: 2px; height: 8px; background-color: #374151; margin-bottom: 4px; }
        .solution-line { position: absolute; top: 50%; transform: translateY(-50%); height: 4px; background-color: #2563eb; }
        .solution-point { position: absolute; top: 50%; transform: translate(-50%, -50%); width: 12px; height: 12px; border-radius: 9999px; border: 2px solid #2563eb; }
        .solution-point.open { background-color: #fff; }
        .solution-point.closed { background-color: #2563eb; }

        /* Styles for number lines inside quiz options */
        .option-nl-wrapper { width: 100%; padding: 1rem 0.5rem; }
        .option-nl-ticks { position: relative; width: 100%; height: 1.5rem; }
        .option-nl-line { position: relative; width: 100%; height: 2px; background-color: #374151; }
        .option-nl-line::before, .option-nl-line::after { content: ''; position: absolute; top: 50%; transform: translateY(-50%); width: 0; height: 0; border-style: solid; }
        .option-nl-line::before { left: -1px; border-width: 4px 6px 4px 0; border-color: transparent #374151 transparent transparent; }
        .option-nl-line::after { right: -1px; border-width: 4px 0 4px 6px; border-color: transparent transparent transparent #374151; }
        .option-nl-tick { position: absolute; bottom: 0; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; font-size: 0.75rem; color: #4b5563; }
        .option-nl-tick::before { content: ''; width: 1px; height: 5px; background-color: #4b5563; margin-bottom: 2px; }
        .option-nl-sol-line { position: absolute; top: 50%; transform: translateY(-50%); height: 3px; background-color: #3b82f6; }
        .option-nl-sol-point { position: absolute; top: 50%; transform: translate(-50%, -50%); width: 10px; height: 10px; border-radius: 9999px; border: 2px solid #3b82f6; }
        .option-nl-sol-point.open { background-color: #fff; }
        .option-nl-sol-point.closed { background-color: #3b82f6; }

        /* Styles for interactive translation */
        .translation-box { background-color: #eef2ff; border: 2px dashed #c7d2fe; min-height: 50px; }
        .word-part { background-color: white; border: 1px solid #d1d5db; padding: 4px 8px; border-radius: 6px; cursor: pointer; user-select: none; transition: all 0.1s ease-in-out; }
        .word-part:hover { background-color: #f3f4f6; transform: translateY(-1px); }
        .word-part.symbol { font-weight: bold; color: #4f46e5; }
        .word-part.variable { font-style: italic; color: #1d4ed8; }
        .word-part.disabled { cursor: not-allowed; background-color: #f3f4f6; color: #9ca3af; opacity: 0.6; }

    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">الدرس ٤-٤: حل المتباينات المركبة</h1>
                </header>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفهوم الأساسي</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">المتباينة المركبة بأداة الربط "و" (التقاطع)</h3>
                            <p class="text-gray-700">هي متباينة تحتوي على أداة الربط "و"، ويكون حلها هو مجموعة <span class="vocab-term">التقاطع</span>، أي الأعداد التي تحقق <span class="font-bold">كلا المتباينتين</span> في الوقت نفسه. يمكن كتابتها كمتباينة واحدة.</p>
                            <div class="mt-4 p-4 bg-white rounded-lg border text-center">
                                <p>مثال: <span class="math-eq">س ≥ -٢</span> و <span class="math-eq">س < ٥</span></p>
                                <p>تُكتب أيضاً: <span class="math-eq">-٢ ≤ س < ٥</span></p>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-green-700 mb-2">المتباينة المركبة بأداة الربط "أو" (الاتحاد)</h3>
                            <p class="text-gray-700">هي متباينة تحتوي على أداة الربط "أو"، ويكون حلها هو مجموعة <span class="vocab-term bg-green-100 text-green-800">الاتحاد</span>، أي الأعداد التي تحقق <span class="font-bold">إحدى المتباينتين على الأقل</span>.</p>
                             <div class="mt-4 p-4 bg-white rounded-lg border text-center">
                                <p>مثال: <span class="math-eq">ص ≤ ١</span> أو <span class="math-eq">ص > ٦</span></p>
                                <p class="text-sm text-gray-500">(لا يمكن دمجها في متباينة واحدة)</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: أمثلة تفاعلية</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        
                        <!-- قسم أمثلة التقاطع -->
                        <div>
                            <h3 class="text-xl font-bold text-blue-800 mb-4 border-b-2 border-blue-200 pb-2">أمثلة تقاطع ("و")</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-4">
                                <!-- المثال التفاعلي 1: تقاطع -->
                                <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ١:</p>
                                        <p class="text-lg font-semibold mt-1">حل <span class="math-eq">-٣ ≤ م - ٤ < ١</span></p>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ١: أضف ٤ لجميع الأطراف</h4><p class="text-center"><span class="math-eq">-٣ <span class="highlight-number">+٤</span> ≤ م - ٤ <span class="highlight-number">+٤</span> < ١ <span class="highlight-number">+٤</span></span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٢: التبسيط</h4><p class="text-center"><span class="math-eq">١ ≤ م < ٥</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٣: مجموعة الحل</h4><p class="text-center"><span class="math-eq">{م | ١ ≤ م < ٥}</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة ٤: التمثيل البياني</h4>
                                            <div class="number-line-wrapper">
                                                <div class="ticks-container">
                                                    <div class="tick" style="left: 20%;"><span>٠</span></div>
                                                    <div class="tick" style="left: 40%;"><span>١</span></div>
                                                    <div class="tick" style="left: 60%;"><span>٣</span></div>
                                                    <div class="tick" style="left: 80%;"><span>٥</span></div>
                                                    <div class="number-line">
                                                        <div class="solution-line" style="left: 40%; width: 40%;"></div>
                                                        <div class="solution-point closed" style="left: 40%;"></div>
                                                        <div class="solution-point open" style="left: 80%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- المثال التفاعلي 2: تقاطع -->
                                <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ٢:</p>
                                        <p class="text-lg font-semibold mt-1">حل <span class="math-eq">٦ ≤ ٤ن - ٢ ≤ ١٤</span></p>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ١: أضف ٢ لجميع الأطراف</h4><p class="text-center"><span class="math-eq">٦ <span class="highlight-number">+٢</span> ≤ ٤ن - ٢ <span class="highlight-number">+٢</span> ≤ ١٤ <span class="highlight-number">+٢</span></span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٢: التبسيط</h4><p class="text-center"><span class="math-eq">٨ ≤ ٤ن ≤ ١٦</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٣: اقسم الأطراف على ٤</h4><p class="text-center"><span class="math-eq"><span class="fraction"><span>٨</span><span class="frac-bar"></span><span class="highlight-number">٤</span></span> ≤ <span class="fraction"><span>٤ن</span><span class="frac-bar"></span><span class="highlight-number">٤</span></span> ≤ <span class="fraction"><span>١٦</span><span class="frac-bar"></span><span class="highlight-number">٤</span></span></span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٤: الحل النهائي</h4><p class="text-center"><span class="math-eq">٢ ≤ ن ≤ ٤</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- قسم أمثلة الاتحاد -->
                        <div>
                            <h3 class="text-xl font-bold text-green-800 mb-4 border-b-2 border-green-200 pb-2">أمثلة اتحاد ("أو")</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-4">
                                <!-- المثال التفاعلي 3: اتحاد -->
                                <div id="interactive-container-3" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ٣:</p>
                                        <p class="text-lg font-semibold mt-1">حل <span class="math-eq">أ+١ < ٤</span> أو <span class="math-eq">أ-١ ≥ ٣</span></p>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                            <h4 class="font-bold">الخطوة ١: حل المتباينتين</h4>
                                            <div class="flex justify-around text-center mt-2">
                                                <div class="space-y-1">
                                                    <p><span class="math-eq" style="font-size: 1rem; padding: 2px 4px;">أ+١<span class="highlight-number">-١</span> < ٤<span class="highlight-number">-١</span></span></p>
                                                    <p class="font-bold text-xl">↓</p>
                                                    <p><span class="math-eq">أ < ٣</span></p>
                                                </div>
                                                <div class="space-y-1">
                                                    <p><span class="math-eq" style="font-size: 1rem; padding: 2px 4px;">أ-١<span class="highlight-number">+١</span> ≥ ٣<span class="highlight-number">+١</span></span></p>
                                                    <p class="font-bold text-xl">↓</p>
                                                    <p><span class="math-eq">أ ≥ ٤</span></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٢: مجموعة الحل</h4><p class="text-center"><span class="math-eq">{أ | أ < ٣ أو أ ≥ ٤}</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة ٣: التمثيل البياني</h4>
                                            <div class="number-line-wrapper">
                                                <div class="ticks-container">
                                                    <div class="tick" style="left: 25%;"><span>٢</span></div>
                                                    <div class="tick" style="left: 50%;"><span>٣</span></div>
                                                    <div class="tick" style="left: 75%;"><span>٤</span></div>
                                                    <div class="number-line">
                                                        <div class="solution-line" style="left: 0%; width: 50%;"></div>
                                                        <div class="solution-point open" style="left: 50%;"></div>
                                                        <div class="solution-line" style="left: 75%; width: 25%;"></div>
                                                        <div class="solution-point closed" style="left: 75%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- المثال التفاعلي 4: اتحاد -->
                                <div id="interactive-container-4" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ٤:</p>
                                        <p class="text-lg font-semibold mt-1">حل <span class="math-eq">٣س+٢ < ٨</span> أو <span class="math-eq">٢س-٩ > ٧</span></p>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                            <h4 class="font-bold">الخطوة ١: حل المتباينتين</h4>
                                            <div class="flex justify-around text-center mt-2">
                                                <div class="space-y-1">
                                                    <p><span class="math-eq" style="font-size: 1rem; padding: 2px 4px;">٣س+٢<span class="highlight-number">-٢</span> < ٨<span class="highlight-number">-٢</span></span></p>
                                                    <p class="font-bold text-xl">↓</p>
                                                    <p><span class="math-eq">٣س < ٦</span></p>
                                                </div>
                                                <div class="space-y-1">
                                                    <p><span class="math-eq" style="font-size: 1rem; padding: 2px 4px;">٢س-٩<span class="highlight-number">+٩</span> > ٧<span class="highlight-number">+٩</span></span></p>
                                                    <p class="font-bold text-xl">↓</p>
                                                    <p><span class="math-eq">٢س > ١٦</span></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                            <h4 class="font-bold">الخطوة ٢: تبسيط الحلين</h4>
                                            <div class="flex justify-around items-center text-center mt-2">
                                                <div class="space-y-1">
                                                    <p><span class="math-eq"><span class="fraction"><span>٣س</span><span class="frac-bar"></span><span class="highlight-number">٣</span></span> < <span class="fraction"><span>٦</span><span class="frac-bar"></span><span class="highlight-number">٣</span></span></span></p>
                                                    <p class="font-bold text-xl">↓</p>
                                                    <p><span class="math-eq">س < ٢</span></p>
                                                </div>
                                                <p class="font-bold text-lg">أو</p>
                                                <div class="space-y-1">
                                                    <p><span class="math-eq"><span class="fraction"><span>٢س</span><span class="frac-bar"></span><span class="highlight-number">٢</span></span> > <span class="fraction"><span>١٦</span><span class="frac-bar"></span><span class="highlight-number">٢</span></span></span></p>
                                                    <p class="font-bold text-xl">↓</p>
                                                    <p><span class="math-eq">س > ٨</span></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٣: مجموعة الحل</h4><p class="text-center"><span class="math-eq">{س | س < ٢ أو س > ٨}</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة ٤: التمثيل البياني</h4>
                                            <div class="number-line-wrapper">
                                                <div class="ticks-container">
                                                    <div class="tick" style="left: 25%;"><span>٢</span></div>
                                                    <div class="tick" style="left: 50%;"><span>٥</span></div>
                                                    <div class="tick" style="left: 75%;"><span>٨</span></div>
                                                    <div class="number-line">
                                                        <div class="solution-line" style="left: 0%; width: 25%;"></div>
                                                        <div class="solution-point open" style="left: 25%;"></div>
                                                        <div class="solution-line" style="left: 75%; width: 25%;"></div>
                                                        <div class="solution-point open" style="left: 75%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="4" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="4" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="4" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- قسم كتابة المتباينة من الرسم -->
                        <div>
                            <h3 class="text-xl font-bold text-purple-800 mb-4 border-b-2 border-purple-200 pb-2">كتابة متباينة مركبة من تمثيل بياني</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-4">
                                <!-- المثال التفاعلي 5: من الرسم -->
                                <div id="interactive-container-5" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ٥:</p>
                                        <p class="text-lg font-semibold mt-1">اكتب متباينة مركبة للتمثيل التالي:</p>
                                        <div class="number-line-wrapper bg-gray-100 p-4 rounded-lg">
                                            <div class="ticks-container">
                                                <div class="tick" style="left: 25%;"><span>-١</span></div>
                                                <div class="tick" style="left: 50%;"><span>٠</span></div>
                                                <div class="tick" style="left: 75%;"><span>٤</span></div>
                                                <div class="number-line">
                                                    <div class="solution-line" style="left: 25%; width: 50%;"></div>
                                                    <div class="solution-point closed" style="left: 25%;"></div>
                                                    <div class="solution-point closed" style="left: 75%;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[150px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ١: تحليل التمثيل</h4><p>التمثيل يظهر فترة محصورة بين عددين، وهذا يعني تقاطع ("و").</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٢: تحديد النقاط</h4><p>نقطة البداية دائرة مغلقة عند <span class="highlight-number">-١</span>، وتعني <span class="math-eq">س ≥ -١</span>.</p><p class="mt-2">نقطة النهاية دائرة مغلقة عند <span class="highlight-number">٤</span>، وتعني <span class="math-eq">س ≤ ٤</span>.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٣: كتابة المتباينة</h4><p class="text-center">بدمج المتباينتين نحصل على:</p><p class="text-center mt-2"><span class="math-eq">-١ ≤ س ≤ ٤</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="5" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="5" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="5" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- المثال التفاعلي 6: من الرسم -->
                                <div id="interactive-container-6" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ٦:</p>
                                        <p class="text-lg font-semibold mt-1">اكتب متباينة مركبة للتمثيل التالي:</p>
                                        <div class="number-line-wrapper bg-gray-100 p-4 rounded-lg">
                                            <div class="ticks-container">
                                                <div class="tick" style="left: 25%;"><span>-٤</span></div>
                                                <div class="tick" style="left: 50%;"><span>-٣</span></div>
                                                <div class="tick" style="left: 75%;"><span>-٢</span></div>
                                                <div class="number-line">
                                                    <div class="solution-line" style="left: 0%; width: 25%;"></div>
                                                    <div class="solution-point open" style="left: 25%;"></div>
                                                    <div class="solution-line" style="left: 50%; width: 50%;"></div>
                                                    <div class="solution-point open" style="left: 50%;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[150px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ١: تحليل التمثيل</h4><p>التمثيل يظهر شعاعين متجهين للخارج، وهذا يعني اتحاد ("أو").</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٢: تحديد الأشعة</h4><p>الشعاع الأول يبدأ بدائرة مفتوحة عند <span class="highlight-number">-٤</span> ويتجه يساراً: <span class="math-eq">س < -٤</span>.</p><p class="mt-2">الشعاع الثاني يبدأ بدائرة مفتوحة عند <span class="highlight-number">-٣</span> ويتجه يميناً: <span class="math-eq">س > -٣</span>.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٣: كتابة المتباينة</h4><p class="text-center">بربط المتباينتين بالأداة "أو" نحصل على:</p><p class="text-center mt-2"><span class="math-eq">س < -٤</span> أو <span class="math-eq">س > -٣</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="6" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="6" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="6" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- قسم أمثلة من واقع الحياة -->
                        <div>
                            <h3 class="text-xl font-bold text-teal-800 mb-4 border-b-2 border-teal-200 pb-2">أمثلة من واقع الحياة</h3>
                            <div class="grid grid-cols-1 mt-4">
                                <!-- المثال التفاعلي 7: من واقع الحياة -->
                                <div id="interactive-container-7" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ٧ (سلاحف):</p>
                                        <p class="text-lg mt-1">نادراً ما يفقس بيض السلاحف البحرية في درجة حرارة أقل من ٢٣° أو فوق ٣٣° سيليزية. اكتب متباينة تمثل درجات الحرارة التي يجب أن تُحضن فيها البيوض كي تفقس.</p>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ١: تحليل المسألة</h4><p>المطلوب هو درجات الحرارة التي <span class="font-bold">يفقس</span> فيها البيض، وهي عكس المذكور. أي أنها ليست أقل من ٢٣ وليست فوق ٣٣.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                            <h4 class="font-bold">الخطوة ٢: ترجمة العبارات إلى رموز</h4>
                                            <div class="space-y-4 mt-2">
                                                <div>
                                                    <p class="mb-2 text-center font-semibold">"ليست أقل من ٢٣"</p>
                                                    <div id="translation-box-1" class="translation-box p-2 flex items-center justify-center space-x-2 space-x-reverse"></div>
                                                    <div class="flex justify-center gap-2 mt-2 flex-wrap" id="parts-1">
                                                        <span class="word-part variable" data-target="1">د</span>
                                                        <span class="word-part symbol" data-target="1">≥</span>
                                                        <span class="word-part" data-target="1">٢٣</span>
                                                    </div>
                                                </div>
                                                <hr>
                                                <div>
                                                    <p class="mb-2 text-center font-semibold">"ليست فوق ٣٣"</p>
                                                    <div id="translation-box-2" class="translation-box p-2 flex items-center justify-center space-x-2 space-x-reverse"></div>
                                                    <div class="flex justify-center gap-2 mt-2 flex-wrap" id="parts-2">
                                                        <span class="word-part variable" data-target="2">د</span>
                                                        <span class="word-part symbol" data-target="2">≤</span>
                                                        <span class="word-part" data-target="2">٣٣</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٣: كتابة المتباينة</h4><p>بما أن درجة الحرارة يجب أن تحقق الشرطين معاً، نستخدم أداة الربط "و".</p><p class="text-center mt-2"><span class="math-eq">٢٣ ≤ د ≤ ٣٣</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="7" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="7" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="7" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </section>

                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">✍️ ثالثاً: حان دورك! اختبر فهمك</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">نتيجتك النهائية</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">إعادة الاختبار</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>

    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">💡 شرح الإجابة</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <div id="smartExplanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full border-t-4 border-purple-500">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-purple-800">🧠 الحل الذكي</h3>
                <button id="closeSmartModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="smartExplanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    const LESSON_ID = 'c4_l4'; 

    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) {
        const headerContainer = document.getElementById('main-header');
        if (!headerContainer) return;
        let titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">منصة الرياضيات التفاعلية</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle || ''}</h1></div>`;
        let userInfoHtml = '';
        if (studentData) {
            userInfoHtml = `<div class="text-right"><span class="font-semibold">أهلاً، ${studentData.name}</span><div><a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; العودة إلى الفهرس</a><span class="mx-1 text-gray-300">|</span><a href="../index.html" target="_top" id="logout-link" class="text-sm text-red-500 hover:underline">خروج</a></div></div>`;
        } else {
            userInfoHtml = `<div class="text-right"><p class="font-semibold text-gray-700">زائر</p><a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; العودة إلى الفهرس</a></div>`;
        }
        headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`;
        const logoutLink = headerContainer.querySelector('#logout-link');
        if (logoutLink) {
            logoutLink.addEventListener('click', () => {
                localStorage.removeItem('currentStudent');
            });
        }
    }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">© 2024 جميع الحقوق محفوظة | تصميم وتطوير: أ. عبدالعزيز خالد العبلان</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">لا توجد أسئلة متاحة لهذا الدرس حالياً.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `المحاولات المتبقية: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); const smartButtonHTML = q.smartExplanation ? `<button type="button" id="smart-explain-btn-${index}" class="hidden mt-2 text-xs text-purple-600 hover:underline font-semibold">🧠 الحل الذكي</button>` : ''; return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div class="flex items-center space-x-4 space-x-reverse">${smartButtonHTML}<button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">اعرف لماذا؟</button></div></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">تحقق من إجاباتي</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); if (q.smartExplanation) { const smartExplainBtn = document.getElementById(`smart-explain-btn-${index}`); if(smartExplainBtn) smartExplainBtn.addEventListener('click', () => showSmartExplanation(index)); } }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'لا توجد محاولات متبقية'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = '✔ إجابة صحيحة!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `❌ إجابة خاطئة.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden'); if (q.smartExplanation) { document.getElementById(`smart-explain-btn-${index}`).classList.remove('hidden'); } }); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentData) { saveGrade(LESSON_ID, finalGrade); if (attemptsLeft - 1 > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'تم عرض نتيجتك. سجل الدخول لحفظ تقدمك.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade) {
        const urlParams = new URLSearchParams(window.location.search);
        const studentId = urlParams.get('studentId');
        const classId = urlParams.get('classId');
        const saveStatus = document.getElementById('save-status');

        if (!studentId || !classId) {
            saveStatus.textContent = 'خطأ: لا يمكن حفظ نتيجتك. معلومات الطالب أو الفصل مفقودة.';
            console.error("Student ID or Class ID is missing from the URL.");
            return;
        }
        
        saveStatus.textContent = 'جارٍ حفظ نتيجتك...';
        const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&classId=${classId}&lessonId=${lessonId}&grade=${grade}`;
        fetch(url)
            .then(res => res.json())
            .then(result => {
                if (result.status === 'success') {
                    saveStatus.textContent = '✔ تم حفظ نتيجتك بنجاح! ستظهر في لوحة التحكم عند العودة.';
                    const studentData = getStudentFromStorage();
                    if(studentData){
                        if (!studentData.lessons) studentData.lessons = {};
                        if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) {
                            studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 };
                        } else {
                            studentData.lessons[lessonId].attempts++;
                        }
                        localStorage.setItem('currentStudent', JSON.stringify(studentData));
                    }
                } else {
                    throw new Error(result.message);
                }
            })
            .catch(error => {
                saveStatus.textContent = '❌ حدث خطأ أثناء حفظ الدرجة.';
                console.error("Save Grade Error:", error);
            });
    }
    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    function showSmartExplanation(questionIndex) { const modal = document.getElementById('smartExplanationModal'); const explanationText = document.getElementById('smartExplanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].smartExplanation) { explanationText.innerHTML = currentQuestions[questionIndex].smartExplanation; modal.classList.remove('hidden'); } }
    function closeSmartModal() { const modal = document.getElementById('smartExplanationModal'); if(modal) modal.classList.add('hidden'); }
    
    function generateQuiz() { 
        const questionBank = [
            { 
                type: 'mcq', level: '⭐', text: `أي من التالي يمثل متباينة مركبة تحتوي على أداة الربط "أو"؟`,
                options: [ 
                    { display: '<span class="math-eq">-١ < س < ٥</span>', value: 'A' }, 
                    { display: '<span class="math-eq">س ≥ ٠</span>', value: 'B' }, 
                    { display: '<span class="math-eq">س < -٢</span> أو <span class="math-eq">س ≥ ٣</span>', value: 'C' }, 
                    { display: '<span class="math-eq">س = ٤</span>', value: 'D' }
                ], 
                correct: 'C',
                explanation: `<p>المتباينة المركبة التي تحتوي على "أو" (اتحاد) تربط بين متباينتين منفصلتين بهذه الأداة. الخيار (ج) هو الوحيد الذي يطابق هذا الوصف.</p><p>الخيار (أ) هو متباينة تقاطع ("و").</p>`,
            },
            { 
                type: 'mcq', level: '⭐⭐', text: `حل المتباينة <span class="math-eq">١ < ٢ص + ٣ ≤ ٩</span>`,
                options: [ 
                    { display: '<span class="math-eq">-١ < ص ≤ ٣</span>', value: 'A' }, 
                    { display: '<span class="math-eq">٢ < ص ≤ ٦</span>', value: 'B' }, 
                    { display: '<span class="math-eq">-٢ < ص ≤ ٦</span>', value: 'C' }, 
                    { display: '<span class="math-eq">ص > -١</span>', value: 'D' }
                ], 
                correct: 'A',
                explanation: `<p>هذه متباينة تقاطع ("و").</p><p>١. نطرح <span class="highlight-number">٣</span> من جميع الأطراف: <span class="math-eq">١ - ٣ < ٢ص ≤ ٩ - ٣</span></p><p>٢. نبسط: <span class="math-eq">-٢ < ٢ص ≤ ٦</span></p><p>٣. نقسم جميع الأطراف على <span class="highlight-number">٢</span>: <span class="math-eq">-١ < ص ≤ ٣</span></p>`,
                smartExplanation: `<p>جرب تعويض قيمة حدية. مثلاً، إذا كانت <span class="math-eq">ص = ٣</span>، فإن <span class="math-eq">٢(٣) + ٣ = ٩</span>. بما أن المتباينة تسمح بـ <span class="math-eq">≤ ٩</span>، فإن الحل يجب أن يتضمن <span class="math-eq">ص ≤ ٣</span>. هذا يلغي الخيارين (ب) و (د).</p>`
            },
            { 
                type: 'mcq', level: '⭐⭐', text: `حل المتباينة <span class="math-eq"><span class="fraction"><span>ك</span><span class="frac-bar"></span><span>٣</span></span> > ٢</span> أو <span class="math-eq">ك+٥ ≤ ٤</span>`,
                options: [ 
                    { display: '<span class="math-eq">ك > ٦</span>', value: 'A' }, 
                    { display: '<span class="math-eq">ك ≤ -١</span>', value: 'B' }, 
                    { display: '<span class="math-eq">-١ ≤ ك < ٦</span>', value: 'C' }, 
                    { display: '<span class="math-eq">ك ≤ -١</span> أو <span class="math-eq">ك > ٦</span>', value: 'D' }
                ], 
                correct: 'D',
                explanation: `<p>هذه متباينة اتحاد ("أو"). نحل كل جزء على حدة.</p><p>الجزء الأول: <span class="math-eq"><span class="fraction"><span>ك</span><span class="frac-bar"></span><span>٣</span></span> > ٢</span>  ←  <span class="math-eq">ك > ٦</span>.</p><p>الجزء الثاني: <span class="math-eq">ك+٥ ≤ ٤</span>  ←  <span class="math-eq">ك ≤ -١</span>.</p><p>الحل هو اتحاد الحلين: <span class="math-eq">ك ≤ -١</span> أو <span class="math-eq">ك > ٦</span>.</p>`,
            },
            { 
                type: 'mcq', level: '⭐', text: `ما المتباينة التي تمثل الجملة "عدد ما بين <span class="highlight-number">-٥</span> و <span class="highlight-number">٧</span>"؟`,
                options: [ 
                    { display: '<span class="math-eq">س > -٥</span> أو <span class="math-eq">س < ٧</span>', value: 'A' }, 
                    { display: '<span class="math-eq">-٥ < س < ٧</span>', value: 'B' }, 
                    { display: '<span class="math-eq">س < -٥</span> أو <span class="math-eq">س > ٧</span>', value: 'C' }, 
                    { display: '<span class="math-eq">س > ٧</span>', value: 'D' }
                ], 
                correct: 'B',
                explanation: `<p>كلمة "بين" تعني أن العدد أكبر من القيمة الصغرى وأصغر من القيمة الكبرى في نفس الوقت. هذا يمثل متباينة تقاطع ("و")، والتي يمكن كتابتها بالشكل <span class="math-eq">-٥ < س < ٧</span>.</p>`
            },
            { 
                type: 'mcq', level: '⭐⭐⭐', text: `حل المتباينة <span class="math-eq">-٢س+٧ ≤ ١</span> أو <span class="math-eq">٥س-٩ < ٦</span>`,
                options: [ 
                    { display: '<span class="math-eq">س < ٣</span>', value: 'A' }, 
                    { display: '<span class="math-eq">س ≥ ٣</span>', value: 'B' }, 
                    { display: 'كل الأعداد الحقيقية', value: 'C' }, 
                    { display: '<span class="math-eq">٣ ≤ س < ٥</span>', value: 'D' }
                ], 
                correct: 'C',
                explanation: `<p>نحل كل جزء على حدة.</p><p>الجزء الأول: <span class="math-eq">-٢س+٧ ≤ ١</span> ← <span class="math-eq">-٢س ≤ -٦</span>. عند القسمة على -٢، <span class="text-red-600 font-bold">نعكس الإشارة</span>: <span class="math-eq">س ≥ ٣</span>.</p><p>الجزء الثاني: <span class="math-eq">٥س-٩ < ٦</span> ← <span class="math-eq">٥س < ١٥</span> ← <span class="math-eq">س < ٣</span>.</p><p>الحل هو اتحاد الحلين: <span class="math-eq">س ≥ ٣</span> أو <span class="math-eq">س < ٣</span>. هذا الاتحاد يغطي كل الأعداد على خط الأعداد، لذا فالحل هو جميع الأعداد الحقيقية.</p>`
            },
            {
                type: 'mcq', level: '⭐', text: 'أي تمثيل بياني يمثل حل المتباينة <span class="math-eq">-٢ ≤ س < ٣</span>؟',
                options: [
                    { value: 'A', display: `<div class="option-nl-wrapper"><div class="option-nl-ticks"><div class="option-nl-tick" style="left: 20%;"><span>-٢</span></div><div class="option-nl-tick" style="left: 80%;"><span>٣</span></div><div class="option-nl-line"><div class="option-nl-sol-line" style="left: 20%; width: 60%;"></div><div class="option-nl-sol-point closed" style="left: 20%;"></div><div class="option-nl-sol-point open" style="left: 80%;"></div></div></div></div>` },
                    { value: 'B', display: `<div class="option-nl-wrapper"><div class="option-nl-ticks"><div class="option-nl-tick" style="left: 20%;"><span>-٢</span></div><div class="option-nl-tick" style="left: 80%;"><span>٣</span></div><div class="option-nl-line"><div class="option-nl-sol-line" style="left: 20%; width: 60%;"></div><div class="option-nl-sol-point open" style="left: 20%;"></div><div class="option-nl-sol-point closed" style="left: 80%;"></div></div></div></div>` },
                    { value: 'C', display: `<div class="option-nl-wrapper"><div class="option-nl-ticks"><div class="option-nl-tick" style="left: 20%;"><span>-٢</span></div><div class="option-nl-tick" style="left: 80%;"><span>٣</span></div><div class="option-nl-line"><div class="option-nl-sol-line" style="left: 0%; width: 20%;"></div><div class="option-nl-sol-point closed" style="left: 20%;"></div><div class="option-nl-sol-line" style="left: 80%; width: 20%;"></div><div class="option-nl-sol-point open" style="left: 80%;"></div></div></div></div>` },
                    { value: 'D', display: `<div class="option-nl-wrapper"><div class="option-nl-ticks"><div class="option-nl-tick" style="left: 20%;"><span>-٢</span></div><div class="option-nl-tick" style="left: 80%;"><span>٣</span></div><div class="option-nl-line"><div class="option-nl-sol-line" style="left: 20%; width: 80%;"></div><div class="option-nl-sol-point closed" style="left: 20%;"></div></div></div></div>` }
                ],
                correct: 'A',
                explanation: '<p>الإشارة <span class="math-eq">≤</span> عند <span class="highlight-number">-٢</span> تعني دائرة مغلقة.</p><p>الإشارة <span class="math-eq"><</span> عند <span class="highlight-number">٣</span> تعني دائرة مفتوحة.</p><p>بما أنها متباينة تقاطع ("و")، فإن الحل هو المنطقة المحصورة بين العددين.</p>'
            },
            {
                type: 'mcq', level: '⭐⭐', text: 'حل المتباينة <span class="math-eq">س - ٣ > ١</span> أو <span class="math-eq">س + ٢ < -١</span>',
                options: [
                    { display: '<span class="math-eq">س > ٤</span> أو <span class="math-eq">س < -٣</span>', value: 'A' },
                    { display: '<span class="math-eq">-٣ < س < ٤</span>', value: 'B' },
                    { display: '<span class="math-eq">س > -٣</span>', value: 'C' },
                    { display: '<span class="math-eq">س < ٤</span>', value: 'D' }
                ],
                correct: 'A',
                explanation: '<p>نحل كل متباينة على حدة.</p><p>الأولى: <span class="math-eq">س - ٣ > ١</span> ← <span class="math-eq">س > ٤</span>.</p><p>الثانية: <span class="math-eq">س + ٢ < -١</span> ← <span class="math-eq">س < -٣</span>.</p><p>الحل هو اتحاد الحلين مع أداة الربط "أو".</p>'
            },
            {
                type: 'mcq', level: '⭐⭐⭐', text: 'حل المتباينة <span class="math-eq">-٢ < <span class="fraction"><span>١-س</span><span class="frac-bar"></span><span>٣</span></span> ≤ ١</span>',
                options: [
                    { display: '<span class="math-eq">-٢ ≤ س < ٧</span>', value: 'A' },
                    { display: '<span class="math-eq">-٧ < س ≤ ٢</span>', value: 'B' },
                    { display: '<span class="math-eq">-٢ < س ≤ ٧</span>', value: 'C' },
                    { display: '<span class="math-eq">-٧ ≤ س < ٢</span>', value: 'D' }
                ],
                correct: 'A',
                explanation: '<p>١. نضرب جميع الأطراف في <span class="highlight-number">٣</span>: <span class="math-eq">-٦ < ١-س ≤ ٣</span>.</p><p>٢. نطرح <span class="highlight-number">١</span> من جميع الأطراف: <span class="math-eq">-٧ < -س ≤ ٢</span>.</p><p>٣. نضرب جميع الأطراف في <span class="highlight-number">-١</span> و<span class="text-red-600 font-bold">نعكس اتجاه الإشارتين</span>: <span class="math-eq">٧ > س ≥ -٢</span>.</p><p>٤. نعيد ترتيبها بالشكل المعتاد: <span class="math-eq">-٢ ≤ س < ٧</span>.</p>',
                smartExplanation: '<p>عندما تصل للخطوة <span class="math-eq">-٧ < -س ≤ ٢</span>، يمكنك اختبار الخيارات. هل يمكن أن تكون <span class="math-eq">س = ٠</span>؟ نعم، لأن <span class="math-eq">-٧ < ٠ ≤ ٢</span> صحيح. هذا يلغي الخيارين (ب) و (د). هل يمكن أن تكون <span class="math-eq">س = -٢</span>؟ نعم، لأن <span class="math-eq">-٧ < ٢ ≤ ٢</span> صحيح. هذا يؤكد أن الإشارة يجب أن تكون <span class="math-eq">≥</span> عند -٢، مما يرجح الخيار (أ).</p>'
            },
            {
                type: 'mcq', level: '⭐', text: 'ترجم الجملة "عدد ما (ن) هو على الأقل ٤ وعلى الأكثر ١٠" إلى متباينة مركبة.',
                options: [
                    { display: '<span class="math-eq">ن < ٤</span> أو <span class="math-eq">ن > ١٠</span>', value: 'A' },
                    { display: '<span class="math-eq">٤ ≤ ن ≤ ١٠</span>', value: 'B' },
                    { display: '<span class="math-eq">٤ < ن < ١٠</span>', value: 'C' },
                    { display: '<span class="math-eq">ن ≤ ٤</span> أو <span class="math-eq">ن ≥ ١٠</span>', value: 'D' }
                ],
                correct: 'B',
                explanation: '<p>"على الأقل ٤" تعني <span class="math-eq">ن ≥ ٤</span>.</p><p>"على الأكثر ١٠" تعني <span class="math-eq">ن ≤ ١٠</span>.</p><p>بما أن العدد يحقق الشرطين معاً، ندمجهما في متباينة تقاطع: <span class="math-eq">٤ ≤ ن ≤ ١٠</span>.</p>'
            },
            {
                type: 'mcq', level: '⭐⭐', text: 'اكتب المتباينة المركبة التي يمثلها خط الأعداد التالي: شعاع يبدأ من -٥ (مفتوح) لليسار، وشعاع آخر يبدأ من ٢ (مغلق) لليمين.',
                options: [
                    { display: '<span class="math-eq">-٥ < س ≤ ٢</span>', value: 'A' },
                    { display: '<span class="math-eq">س < -٥</span> و <span class="math-eq">س ≥ ٢</span>', value: 'B' },
                    { display: '<span class="math-eq">س < -٥</span> أو <span class="math-eq">س ≥ ٢</span>', value: 'C' },
                    { display: '<span class="math-eq">س ≤ -٥</span> أو <span class="math-eq">س > ٢</span>', value: 'D' }
                ],
                correct: 'C',
                explanation: '<p>الشعاعان يتجهان للخارج، مما يعني أنها متباينة اتحاد ("أو").</p><p>الدائرة المفتوحة عند -٥ والشعاع لليسار تعني <span class="math-eq">س < -٥</span>.</p><p>الدائرة المغلقة عند ٢ والشعاع لليمين تعني <span class="math-eq">س ≥ ٢</span>.</p><p>إذن، المتباينة هي <span class="math-eq">س < -٥</span> أو <span class="math-eq">س ≥ ٢</span>.</p>'
            },
            {
                type: 'mcq', level: '⭐⭐⭐', text: 'يجب أن تكون درجة حرارة معمل (د) بين ١٥° و ٢٥° سيليزية، شاملة للطرفين. أي متباينة تمثل هذا الشرط؟',
                options: [
                    { display: '<span class="math-eq">د < ١٥</span> أو <span class="math-eq">د > ٢٥</span>', value: 'A' },
                    { display: '<span class="math-eq">١٥ ≤ د ≤ ٢٥</span>', value: 'B' },
                    { display: '<span class="math-eq">١٥ < د < ٢٥</span>', value: 'C' },
                    { display: '<span class="math-eq">د ≤ ١٥</span> أو <span class="math-eq">د ≥ ٢٥</span>', value: 'D' }
                ],
                correct: 'B',
                explanation: '<p>كلمة "بين" تعني أنها متباينة تقاطع.</p><p>عبارة "شاملة للطرفين" تعني أننا نستخدم الإشارة <span class="math-eq">≤</span>.</p><p>لذلك، المتباينة هي <span class="math-eq">١٥ ≤ د ≤ ٢٥</span>.</p>'
            },
            {
                type: 'mcq', level: '⭐⭐', text: 'حل المتباينة <span class="math-eq">٥س - ١ > ٤</span> و <span class="math-eq">٢س + ٣ < ١٣</span>',
                options: [
                    { display: '<span class="math-eq">١ < س < ٥</span>', value: 'A' },
                    { display: '<span class="math-eq">س < ١</span> أو <span class="math-eq">س > ٥</span>', value: 'B' },
                    { display: '<span class="math-eq">س > ١</span>', value: 'C' },
                    { display: '<span class="math-eq">س < ٥</span>', value: 'D' }
                ],
                correct: 'A',
                explanation: '<p>نحل كل متباينة على حدة.</p><p>الأولى: <span class="math-eq">٥س > ٥</span> ← <span class="math-eq">س > ١</span>.</p><p>الثانية: <span class="math-eq">٢س < ١٠</span> ← <span class="math-eq">س < ٥</span>.</p><p>بما أن أداة الربط هي "و"، فإن الحل هو تقاطع الحلين: <span class="math-eq">١ < س < ٥</span>.</p>',
                smartExplanation: '<p>ابحث عن عدد يحقق المتباينتين. لنجرب <span class="math-eq">س = ٢</span>.</p><p>الأولى: <span class="math-eq">٥(٢) - ١ = ٩ > ٤</span> (صحيح).</p><p>الثانية: <span class="math-eq">٢(٢) + ٣ = ٧ < ١٣</span> (صحيح).</p><p>إذن الحل يجب أن يحتوي على العدد ٢. هذا يلغي الخيار (ب). لنجرب <span class="math-eq">س = ٦</span>. الأولى صحيحة لكن الثانية خاطئة. إذن الحل يجب أن يكون أصغر من ٥، مما يلغي الخيار (ج). لنجرب <span class="math-eq">س = ٠</span>. الأولى خاطئة. إذن الحل يجب أن يكون أكبر من ١، مما يلغي الخيار (د). الخيار الوحيد المتبقي هو (أ).</p>'
            }
        ];
        
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        const questionCount = Math.min(shuffled.length, 5);
        return shuffled.slice(0, questionCount);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const studentId = urlParams.get('studentId');
        const classId = urlParams.get('classId');

        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            state[exampleId] = { currentIndex: -1, steps: container.querySelectorAll('.step-interactive'), placeholder: container.querySelector('.interactive-placeholder'), prevBtn: container.querySelector('.prev-btn'), nextBtn: container.querySelector('.next-btn'), resetBtn: container.querySelector('.reset-btn') };
            const resetExample = () => { 
                state[exampleId].steps.forEach(step => step.classList.remove('active')); 
                state[exampleId].currentIndex = -1; 
                if (state[exampleId].placeholder) { 
                    state[exampleId].placeholder.classList.remove('hidden'); 
                } 
                if (exampleId === '7') {
                    document.getElementById('translation-box-1').innerHTML = '';
                    document.getElementById('translation-box-2').innerHTML = '';
                    document.querySelectorAll('#parts-1 .word-part, #parts-2 .word-part').forEach(p => p.classList.remove('disabled'));
                }
                updateButtons(); 
            };
            const updateButtons = () => { 
                const isFirstStep = state[exampleId].currentIndex <= -1; 
                const isLastStep = state[exampleId].currentIndex >= state[exampleId].steps.length - 1; 
                state[exampleId].prevBtn.disabled = isFirstStep; 
                if (isLastStep) { 
                    state[exampleId].nextBtn.classList.add('hidden'); 
                    state[exampleId].resetBtn.classList.remove('hidden'); 
                } else { 
                    state[exampleId].nextBtn.classList.remove('hidden'); 
                    state[exampleId].resetBtn.classList.add('hidden'); 
                } 
            };
            
            state[exampleId].nextBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex < state[exampleId].steps.length - 1) {
                    if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.add('hidden');
                    }
                    state[exampleId].currentIndex++;
                    state[exampleId].steps[state[exampleId].currentIndex].classList.add('active');
                    updateButtons();
                }
            });
            state[exampleId].prevBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex > -1) {
                    if(state[exampleId].steps[state[exampleId].currentIndex]) {
                       state[exampleId].steps[state[exampleId].currentIndex].classList.remove('active');
                    }
                    state[exampleId].currentIndex--;
                     if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.remove('hidden');
                    }
                    updateButtons();
                }
            });

            if(state[exampleId].resetBtn) { state[exampleId].resetBtn.addEventListener('click', resetExample); }
            updateButtons();
        });

        // Specific script for example 7 translation
        document.querySelectorAll('.word-part').forEach(part => {
            part.addEventListener('click', () => {
                if (part.classList.contains('disabled')) return;
                const targetId = part.dataset.target;
                const targetBox = document.getElementById(`translation-box-${targetId}`);
                const newPart = part.cloneNode(true);
                newPart.classList.remove('word-part');
                targetBox.appendChild(newPart);
                part.classList.add('disabled');
            });
        });


        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
        
        const closeSmartModalBtn = document.getElementById('closeSmartModalBtn');
        if(closeSmartModalBtn) closeSmartModalBtn.addEventListener('click', closeSmartModal);
    });
    </script>
</body>
</html>
