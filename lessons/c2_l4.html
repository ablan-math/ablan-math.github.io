<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุฏุฑุณ ูข-ูค: ุญู ุงููุนุงุฏูุงุช ุงูุฎุทูุฉ ุจูุงููุงู | ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-change { color: #ef4444; font-weight: bold; }
        
        /* === ุชุนุฏูู ุงูุฑููุฒ ุงูุฑูุงุถูุฉ === */
        .math-eq {
            font-family: "Courier New", monospace; /* ุฎุท ุนุฑูุถ ููุชุจุงุนุฏ */
            font-size: 1.1rem; /* ุชูุจูุฑ ุญุฌู ุงูุฎุท */
            font-weight: bold;
            color: #4338ca;
            background-color: #f3f4f6; /* ุฎูููุฉ ุฑูุงุฏูุฉ ูุงุชุญุฉ */
            border: 1px solid #d1d5db; /* ุฅุทุงุฑ ุฎููู */
            padding: 2px 8px; /* ููุงูุด ุฏุงุฎููุฉ */
            border-radius: 6px; /* ุฒูุงูุง ุฏุงุฆุฑูุฉ */
            display: inline-block;
            vertical-align: middle; /* ูุญุงุฐุงุฉ ุฃูุถู ูุน ุงููุต */
        }
        
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
        .highlight-s { color: #2563eb; font-weight: bold; }
        .btn-disabled {
            background-color: #9ca3af !important;
            cursor: not-allowed;
            opacity: 0.7;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">ุงูุฏุฑุณ ูข-ูค: ุญู ุงููุนุงุฏูุงุช ุงูุฎุทูุฉ ุจูุงููุงู</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; ุงูุนูุฏุฉ ุฅูู ุงูููุฑุณ</a>
                </header>
                
                <!-- Section 1: Basic Concepts -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ก ุฃููุงู: ุงูููุงููู ุงูุฃุณุงุณูุฉ</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">ุงูุฏุงูุฉ ุงูููููุฏุฉ (ุงูุฃู) ููุฏูุงู ุงูุฎุทูุฉ</h3>
                            <p>ุฃุจุณุท ุฏุงูุฉ ุฎุทูุฉ ูู <span class="math-eq">ุฏ(ุณ) = ุณ</span>. ูุชูุณูู <span class="vocab-term">ุงูุฏุงูุฉ ุงููููุฏุฉ (ุงูุฃู)</span> ููุฌููุนุฉ ุงูุฏูุงู ุงูุฎุทูุฉ.</p>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">ุงููุนุงุฏูุฉ ูุงูุฏุงูุฉ ุงููุฑุชุจุทุฉ</h3>
                            <p><span class="vocab-term">ุงููุนุงุฏูุฉ ุงูุฎุทูุฉ</span> ูู ุฌููุฉ ุฑูุงุถูุฉ ุทุฑูุงูุง ูุชุณุงููุงู. ูุญู ุงููุนุงุฏูุฉ ุจูุงููุงูุ ูุญูููุง ุฅูู <span class="vocab-term">ุฏุงูุฉ ูุฑุชุจุทุฉ</span> ุนู ุทุฑูู ูุถุน ุฌููุน ุงูุญุฏูุฏ ูู ุทุฑู ูุงุญุฏ ูุงุณุชุจุฏุงู ุงูุตูุฑ ูู ุงูุทุฑู ุงูุขุฎุฑ ุจู <span class="math-eq">ุฏ(ุณ)</span>.</p>
                        </div>
                        <div class="p-4 bg-white rounded-lg border-l-4 border-blue-500">
                             <h3 class="text-xl font-semibold text-blue-700 mb-2">ุฌุฐุฑ ุงููุนุงุฏูุฉ ูุงูุญู ุงูุจูุงูู (ููู ุฌุฏุงู)</h3>
                             <p>ุญู ุงููุนุงุฏูุฉ ููุณูู <span class="vocab-term">ุงูุฌุฐุฑ</span>ุ ููู ููุณู <span class="vocab-term">ุตูุฑ ุงูุฏุงูุฉ</span>.</p>
                             <p class="font-bold mt-2">ุงููุฏู ุงูุฃุณุงุณู ูู ูุฐุง ุงูุฏุฑุณ ูู ุฅูุฌุงุฏ ุงูุญู ุจูุงููุงู. ุงูุญู ุงูุจูุงูู ูู ููุทุฉ ุชูุงุทุน ุงูุชูุซูู ุงูุจูุงูู ูุน ูุญูุฑ ุงูุณููุงุชุ ููู ุงูููุทุฉ ุงูุชู ุชููู ุนูุฏูุง ูููุฉ <span class="math-eq">ุต = ู</span>.</p>
                             <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-center">
                                <div>
                                    <h4 class="font-semibold">ููุฌุฏ ุญู (ุฌุฐุฑ ูุงุญุฏ)</h4>
                                    <svg viewBox="-5 -5 10 10" class="w-full h-40 bg-gray-50 border rounded-lg mt-2">
                                        <path d="M -5,1 L 5,1 M -5,2 L 5,2 M -5,3 L 5,3 M -5,4 L 5,4 M -5,-1 L 5,-1 M -5,-2 L 5,-2 M -5,-3 L 5,-3 M -5,-4 L 5,-4" stroke="#e5e7eb" stroke-width="0.15" />
                                        <path d="M 1,-5 L 1,5 M 2,-5 L 2,5 M 3,-5 L 3,5 M 4,-5 L 4,5 M -1,-5 L -1,5 M -2,-5 L -2,5 M -3,-5 L -3,5 M -4,-5 L -4,5" stroke="#e5e7eb" stroke-width="0.15" />
                                        <line x1="-5" y1="0" x2="5" y2="0" stroke="#9ca3af" stroke-width="0.2"/>
                                        <line x1="0" y1="-5" x2="0" y2="5" stroke="#9ca3af" stroke-width="0.2"/>
                                        <line x1="-1" y1="-4" x2="5" y2="2" stroke="#3b82f6" stroke-width="0.4"/>
                                        <circle cx="3" cy="0" r="0.3" fill="#16a34a" />
                                    </svg>
                                    <p class="mt-2 p-2 bg-green-100 rounded-md text-green-800 text-sm">ููุฌุฏ ุญู ุนูุฏ <span class="math-eq">ุณ = ูฃ</span> ูุฃู ุงูุฎุท ููุทุน ูุญูุฑ ุงูุณููุงุช.</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold">ูุง ููุฌุฏ ุญู ุญูููู</h4>
                                    <svg viewBox="-5 -5 10 10" class="w-full h-40 bg-gray-50 border rounded-lg mt-2">
                                         <path d="M -5,1 L 5,1 M -5,2 L 5,2 M -5,3 L 5,3 M -5,4 L 5,4 M -5,-1 L 5,-1 M -5,-2 L 5,-2 M -5,-3 L 5,-3 M -5,-4 L 5,-4" stroke="#e5e7eb" stroke-width="0.15" />
                                        <path d="M 1,-5 L 1,5 M 2,-5 L 2,5 M 3,-5 L 3,5 M 4,-5 L 4,5 M -1,-5 L -1,5 M -2,-5 L -2,5 M -3,-5 L -3,5 M -4,-5 L -4,5" stroke="#e5e7eb" stroke-width="0.15" />
                                        <line x1="-5" y1="0" x2="5" y2="0" stroke="#9ca3af" stroke-width="0.2"/>
                                        <line x1="0" y1="-5" x2="0" y2="5" stroke="#9ca3af" stroke-width="0.2"/>
                                        <line x1="-5" y1="2" x2="5" y2="2" stroke="#ef4444" stroke-width="0.4"/>
                                    </svg>
                                    <p class="mt-2 p-2 bg-red-100 rounded-md text-red-800 text-sm">ูุง ููุฌุฏ ุญู ุญูููู ูุฃู ุงูุฎุท ูุง ููุทุน ูุญูุฑ ุงูุณููุงุช ุฃุจุฏุงู.</p>
                                </div>
                             </div>
                        </div>
                    </div>
                </section>

                <!-- NEW Section: Interactive Examples for Related Function -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ูุซุงู: ุฅูุฌุงุฏ ุงูุฏุงูุฉ ุงููุฑุชุจุทุฉ</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Example 1 -->
                            <div id="interactive-container-3" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-2">ูุซุงู ูก: ูุนุงุฏูุฉ ุฌุงูุฒุฉ</p>
                                <p class="mb-4 text-gray-700"><strong>ุงููุนุงุฏูุฉ:</strong> <span class="math-eq">ูฃุณ - ูกูข = ู</span></p>
                                <div class="steps-container space-y-4 min-h-[150px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4">
                                        <p>ุงุถุบุท "ุงูุชุงูู" ูุฅูุฌุงุฏ ุงูุฏุงูุฉ ุงููุฑุชุจุทุฉ.</p>
                                    </div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                        <h4 class="font-bold">ุงูุฎุทูุฉ 1:</h4>
                                        <p>ุจูุง ุฃู ุงูุทุฑู ุงูุฃูุณุฑ ูุณุงูู ุตูุฑุ ูุณุชุจุฏูู ูุจุงุดุฑุฉ ุจู <span class="math-eq">ุฏ(ุณ)</span>.</p>
                                    </div>
                                    <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600">
                                        <h4 class="font-bold">ุงูุฏุงูุฉ ุงููุฑุชุจุทุฉ:</h4>
                                        <p class="text-center"><span class="math-eq">ุฏ(ุณ) = ูฃุณ - ูกูข</span></p>
                                    </div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                    <div>
                                        <button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                        <button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                    </div>
                                </div>
                            </div>
                            <!-- Example 2 -->
                            <div id="interactive-container-4" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-2">ูุซุงู ูข: ูุนุงุฏูุฉ ุชุญุชุงุฌ ูุชุฑุชูุจ</p>
                                <p class="mb-4 text-gray-700"><strong>ุงููุนุงุฏูุฉ:</strong> <span class="math-eq">ูคุณ + ูข = ูกู</span></p>
                                <div class="steps-container space-y-4 min-h-[150px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4">
                                        <p>ุงุถุบุท "ุงูุชุงูู" ูุฅูุฌุงุฏ ุงูุฏุงูุฉ ุงููุฑุชุจุทุฉ.</p>
                                    </div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                        <h4 class="font-bold">ุงูุฎุทูุฉ 1:</h4>
                                        <p>ูุฌุจ ุฃู ูุฌุนู ุงูุทุฑู ุงูุฃูุณุฑ ูุณุงูู ุตูุฑ. ูุทุฑุญ ูกู ูู ููุง ุงูุทุฑููู.</p>
                                        <p class="text-center"><span class="math-eq">ูคุณ + ูข - ูกู = ู</span></p>
                                    </div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                        <h4 class="font-bold">ุงูุฎุทูุฉ 2:</h4>
                                        <p>ูุจุณุท ุงููุนุงุฏูุฉ.</p>
                                        <p class="text-center"><span class="math-eq">ูคุณ - ูจ = ู</span></p>
                                    </div>
                                    <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600">
                                        <h4 class="font-bold">ุงูุฏุงูุฉ ุงููุฑุชุจุทุฉ:</h4>
                                        <p class="text-center"><span class="math-eq">ุฏ(ุณ) = ูคุณ - ูจ</span></p>
                                    </div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="4" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                    <div>
                                        <button data-example="4" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                        <button data-example="4" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 2: Solving the Equation -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ฏ ุซุงููุงู: ุญู ุงููุนุงุฏูุฉ <span class="math-eq">ูขุณ - ูจ = ู</span> ุฌุจุฑูุงู ูุจูุงููุงู</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                            <h3 class="font-bold text-xl mb-3 text-indigo-700">ุงูุทุฑููุฉ ุงูุฃููู: ุงูุญู ุงูุฌุจุฑู (ุชูุงุนูู)</h3>
                            <div class="steps-container space-y-4 min-h-[150px]">
                                <div class="interactive-placeholder text-center text-gray-500 p-4">
                                    <p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู ุงูุฌุจุฑู</p>
                                </div>
                                <div class="step-interactive p-2">
                                    <p><strong>ุงููุนุงุฏูุฉ ุงูุฃุตููุฉ:</strong> <span class="math-eq">ูขุณ - ูจ = ู</span></p>
                                </div>
                                <div class="step-interactive p-2">
                                    <p><strong>ุงูุฎุทูุฉ 1:</strong> ูุถูู ูจ ุฅูู ููุง ุงูุทุฑููู ููุชุฎูุต ูู -ูจ.</p>
                                    <p class="text-center"><span class="math-eq">ูขุณ = ูจ</span></p>
                                </div>
                                <div class="step-interactive p-2 bg-green-100 rounded-lg">
                                    <p><strong>ุงูุฎุทูุฉ 2:</strong> ููุณู ููุง ุงูุทุฑููู ุนูู ูข ูุฅูุฌุงุฏ ูููุฉ ุณ.</p>
                                    <p class="text-center"><strong class="text-green-800">ุงูุญู:</strong> <span class="math-eq">ุณ = ูค</span></p>
                                </div>
                            </div>
                            <div class="flex justify-between mt-6">
                                <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                <div>
                                    <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                    <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div>
                            <h3 class="font-bold text-xl mb-3 text-teal-700">ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุงูุญู ุงูุจูุงูู (ุจุดูู ุชูุงุนูู)</h3>
                            <div class="p-4 bg-teal-50 rounded-md mb-6">
                                <p>ูุญู ุงููุนุงุฏูุฉ ุจูุงููุงูุ ูุญูููุง ุฃููุงู ุฅูู ุฏุงูุฉ ูุฑุชุจุทุฉ: <span class="math-eq">ุฏ(ุณ) = ูขุณ - ูจ</span>. ุซู ูุจุฏุฃ ุจุชูุซูููุง.</p>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                                <div>
                                    <h4 class="font-bold text-lg mb-2">ุชูููู ุฌุฏูู</h4>
                                    <p class="mb-4 text-sm text-gray-600">ุงุถุบุท ุนูู ุงูุฃุฒุฑุงุฑ ูุจูุงุก ุงูุญู ุฎุทูุฉ ุจุฎุทูุฉ.</p>
                                    <table class="w-full border-collapse border border-slate-400 text-center">
                                        <thead class="bg-blue-100">
                                            <tr>
                                                <th class="p-2 border border-slate-300 highlight-s">ุณ</th>
                                                <th class="p-2 border border-slate-300">ูข<span class="highlight-s">ุณ</span> - ูจ</th>
                                                <th class="p-2 border border-slate-300">(ุณ, ุต)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="interactive-table-body"></tbody>
                                    </table>
                                     <div class="mt-4 grid grid-cols-3 gap-2">
                                        <button id="prev-step-btn" class="w-full bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors btn-disabled" disabled>ุงูุณุงุจู</button>
                                        <button id="next-step-btn" class="w-full bg-blue-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">ุงูุชุงูู</button>
                                        <button id="reset-step-btn" class="w-full bg-red-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">ุฅุนุงุฏุฉ</button>
                                    </div>
                                    <div id="table-conclusion" class="hidden mt-2 p-2 bg-yellow-100 rounded-md text-yellow-800 text-center">
                                        <p>ูุงุญุธ ูู ุงูุฌุฏูู ุฃู ุงูุญู ูู <span class="math-eq">ุณ = ูค</span> ูุฃู ูููุฉ <span class="math-eq">ุต</span> ุงูููุงุจูุฉ ููุง ุชุณุงูู <span class="math-eq">ู</span>.</p>
                                    </div>
                                </div>
                                <div>
                                     <h4 class="font-bold text-lg mb-2">ุงูุชูุซูู ุงูุจูุงูู</h4>
                                     <svg id="interactive-graph" viewBox="-10 -10 20 20" class="w-full h-72 bg-white border rounded-lg"></svg>
                                     <div id="graph-conclusion" class="hidden mt-2 p-2 bg-green-100 rounded-md text-green-800 text-center">
                                        <p>ุงูุฎุท ููุทุน ูุญูุฑ ุงูุณููุงุช ุนูุฏ ุงูููุทุฉ <span class="math-eq">ุณ = ูค</span>. ูุฐุง ูู <span class="vocab-term">ุญู ุงููุนุงุฏูุฉ</span>.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 3: Real-life Example (Interactive) -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ฅ ุซุงูุซุงู: ูุซุงู ูู ูุงูุน ุงูุญูุงุฉ (ุชูุงุนูู)</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                            <p class="text-lg font-semibold mb-2">ูุซุงู: ูุดููุฉ ุงูุฌุฒุฑ</p>
                            <p class="mb-4 text-gray-700"><strong>ุงููุณุฃูุฉ:</strong> ุชูุซู ุงูุฏุงูุฉ <span class="math-eq">ู = ูฆู - ูขู</span> ูุชูุฉ ุงูุฌุฒุฑ ุงููุชุจูู ุจุงูููููุฌุฑุงู ูู ูุญู ุฃุญูุฏ ุจุนุฏ ุจูุนู <span class="math-eq">ู</span> ููุณุงู. ุฃูุฌุฏ ุตูุฑ ุงูุฏุงูุฉุ ููุถูุญ ูุง ูุนููู ูู ูุฐุง ุงูุณูุงู.</p>
                            
                            <div class="steps-container space-y-4 min-h-[200px]">
                                <div class="interactive-placeholder text-center text-gray-500 p-4">
                                    <p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p>
                                </div>
                                
                                <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                    <h4 class="font-bold">ุงูุฎุทูุฉ 1: ููู "ุตูุฑ ุงูุฏุงูุฉ"</h4>
                                    <p>ุงููุทููุจ ูู ุฅูุฌุงุฏ "ุตูุฑ ุงูุฏุงูุฉ". ูุฐุง ูุนูู ุฃููุง ูุฑูุฏ ุฃู ูุนุฑู ูุชู ุชุตุจุญ ูููุฉ ุงูุฌุฒุฑ ุงููุชุจููุฉ (<span class="math-eq">ู</span>) ุชุณุงูู **ุตูุฑูุง**. ุจูุนูู ุขุฎุฑ: ูู ููุณุงู (<span class="math-eq">ู</span>) ูุฌุจ ุฃู ูุจูุน ุฃุญูุฏ ุญุชู ููุชูู ูู ุงูุฌุฒุฑุ</p>
                                </div>
                                
                                <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                    <h4 class="font-bold">ุงูุฎุทูุฉ 2: ุญู ุงููุนุงุฏูุฉ</h4>
                                    <p>ูุฃููุง ูุฑูุฏ ูุนุฑูุฉ ูุชู ุชูุชูู ุงููููุฉุ ูุฅููุง ูุนูุถ ุนู ุงููุชูุฉ ุงููุชุจููุฉ (<span class="math-eq">ู</span>) ุจุงููููุฉ <span class="math-eq">ู</span> ูู ุงููุนุงุฏูุฉ ุงูุฃุตููุฉ:</p>
                                    <p class="text-center my-2 p-2 bg-white rounded-md text-xl math-eq">ู = ูฆู - ูขู</p>
                                </div>

                                <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                    <h4 class="font-bold">ุชุฑุชูุจ ุงููุนุงุฏูุฉ</h4>
                                    <p>ูููู <span class="math-eq">-ูขู</span> ููุทุฑู ุงูุขุฎุฑ ูุชุชุบูุฑ ุฅุดุงุฑุชูุง.</p>
                                    <p class="text-center my-2 p-2 bg-white rounded-md text-xl math-eq">ูขู = ูฆู</p>
                                </div>

                                <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                    <h4 class="font-bold">ุฅูุฌุงุฏ ูููุฉ ู</h4>
                                    <p>ูุฅูุฌุงุฏ ูููุฉ <span class="math-eq">ู</span>ุ ููุณู ูฆู ุนูู ูข.</p>
                                    <p class="text-center my-2 p-2 bg-green-100 rounded-md text-2xl math-eq">ู = ูฃู</p>
                                </div>
                                
                                <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600">
                                    <h4 class="font-bold">ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ: ุชูุณูุฑ ุงูุญู</h4>
                                    <p>ุงูุญู ูู <span class="math-eq">ูฃู</span>. ููุฐุง ูุนูู ุฃู ุฃุญูุฏ ูุฌุจ ุฃู ูุจูุน <strong>ูฃู ููุณุงู</strong> ุญุชู ุชูุชูู ูู ูููุฉ ุงูุฌุฒุฑ ูุฏูู.</p>
                                </div>
                            </div>
                            
                            <div class="flex justify-between mt-6">
                                <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                <div>
                                    <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                    <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 4: Quiz -->
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">โ๏ธ ุฑุงุจุนุงู: ุญุงู ุฏูุฑู! ุงุฎุชุจุฑ ูููู</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">ูุชูุฌุชู ุงูููุงุฆูุฉ</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">๐ก ุดุฑุญ ุงูุฅุฌุงุจุฉ</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    // ===================================================================================
    // ุฏูุงู ูุดุชุฑูุฉ (ูุง ุชูู ุจุชุบููุฑ ูุฐุง ุงูุฌุฒุก)
    // ===================================================================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h1></a>`; } let userInfoHtml = ''; if (studentData) { userInfoHtml = `<div class="flex items-center gap-4"><span class="font-semibold">ุฃููุงูุ ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">ุฎุฑูุฌ</a></div>`; } else { userInfoHtml = `<p class="text-lg text-gray-600">ุฒุงุฆุฑ</p>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; const logoutLink = headerContainer.querySelector('#logout-link'); if(logoutLink) { logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); } }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">ยฉ 2024 ุฌููุน ุงูุญููู ูุญููุธุฉ | ุชุตููู ูุชุทููุฑ: ุฃ. ุนุจุฏุงูุนุฒูุฒ ุฎุงูุฏ ุงูุนุจูุงู</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) {
        currentQuestions = questions;
        const quizForm = document.getElementById('quizForm');
        if (!quizForm) return;
        if (questions.length === 0) {
            quizForm.innerHTML = `<p class="text-center text-gray-600">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุชุงุญุฉ ููุฐุง ุงูุฏุฑุณ ุญุงููุงู.</p>`;
            return;
        }
        let attemptsLeft;
        if (studentData) {
            const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 };
            attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts;
        } else {
            attemptsLeft = 1;
        }
        const attemptsCounter = document.getElementById('attempts-counter');
        if (attemptsCounter) {
            attemptsCounter.innerHTML = `ุงููุญุงููุงุช ุงููุชุจููุฉ: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`;
        }
        const quizHtml = questions.map((q, index) => {
            const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join('');
            
            let questionContentHTML;
            if (q.text.includes('<table')) {
                const title = q.text.split('<div')[0];
                const tableHTML = q.text.substring(q.text.indexOf('<div'));
                questionContentHTML = `<p class="font-bold text-lg">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${title}</p>${tableHTML}`;
            } else if (q.graph) {
                questionContentHTML = `<p class="font-bold text-lg">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p>${q.graph}`;
            } else {
                questionContentHTML = `<p class="font-bold text-lg">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p>`;
            }

            return `<div class="p-4 border-2 border-gray-200 rounded-lg">${questionContentHTML}<div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><button type="button" data-question-index="${index}" class="explain-btn hidden mt-2 text-xs text-blue-600 hover:underline">ุงุนุฑู ููุงุฐุงุ</button></div>`;
        }).join('');
        quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">ุชุญูู ูู ุฅุฌุงุจุงุชู</button>`;
        if (attemptsLeft <= 0) {
            const submitBtn = quizForm.querySelector('#submit-quiz-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'ูุง ุชูุฌุฏ ูุญุงููุงุช ูุชุจููุฉ';
            submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400');
        }
        quizForm.onsubmit = (e) => {
            e.preventDefault();
            let score = 0;
            questions.forEach((q, index) => {
                const userAnswer = e.target.elements[`q${index}`]?.value;
                const feedbackEl = document.getElementById(`feedback-q${index}`);
                if (userAnswer === q.correct) {
                    score++;
                    feedbackEl.textContent = 'โ ุฅุฌุงุจุฉ ุตุญูุญุฉ!';
                    feedbackEl.className = 'mt-2 text-sm font-bold text-green-600';
                } else {
                    feedbackEl.textContent = `โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ.`;
                    feedbackEl.className = 'mt-2 text-sm font-bold text-red-600';
                }
                quizForm.querySelector(`[data-question-index="${index}"]`).classList.remove('hidden');
            });
            const finalGrade = Math.round((score / questions.length) * 10);
            const resultsDiv = document.getElementById('quiz-results');
            resultsDiv.classList.remove('hidden');
            document.getElementById('quiz-score').textContent = `${finalGrade} / 10`;
            if (studentData) {
                saveGrade(lessonId, finalGrade, studentData.id);
                if (attemptsLeft - 1 > 0) {
                    document.getElementById('retake-quiz-btn').classList.remove('hidden');
                }
            } else {
                document.getElementById('save-status').textContent = 'ุชู ุนุฑุถ ูุชูุฌุชู. ุณุฌู ุงูุฏุฎูู ูุญูุธ ุชูุฏูู.';
            }
            e.target.querySelector('#submit-quiz-btn').disabled = true;
        };
    }
    function saveGrade(lessonId, grade, studentId) { if (!studentId) return; const saveStatus = document.getElementById('save-status'); saveStatus.textContent = 'ุฌุงุฑู ุญูุธ ูุชูุฌุชู...'; const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&lessonId=${lessonId}&grade=${grade}`; fetch(url) .then(res => res.json()) .then(result => { if (result.status === 'success') { saveStatus.textContent = 'โ ุชู ุญูุธ ูุชูุฌุชู ุจูุฌุงุญ! ุณุชุธูุฑ ูู ููุญุฉ ุงูุชุญูู ุนูุฏ ุงูุนูุฏุฉ.'; const studentData = JSON.parse(localStorage.getItem('currentStudent')); if (!studentData.lessons) studentData.lessons = {}; if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; } else { studentData.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(studentData)); } else { throw new Error(result.message); } }) .catch(error => { saveStatus.textContent = 'โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุฏุฑุฌุฉ.'; console.error("Save Grade Error:", error); }); }
    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }

    // ===================================================================================
    // ูุดุบู ุงูููุฏ (ูุง ุชูู ุจุชุบููุฑ ูุฐุง ุงูุฌุฒุก)
    // ===================================================================================
    document.addEventListener('DOMContentLoaded', () => {
        // ูุดุบู ุงูุฃูุซูุฉ ุงูุชูุงุนููุฉ ุงูุนุงูุฉ
        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            state[exampleId] = { currentIndex: -1, steps: container.querySelectorAll('.step-interactive'), placeholder: container.querySelector('.interactive-placeholder'), prevBtn: container.querySelector('.prev-btn'), nextBtn: container.querySelector('.next-btn'), resetBtn: container.querySelector('.reset-btn') };
            
            const updateButtons = () => {
                const isFirstStep = state[exampleId].currentIndex <= -1;
                const isLastStep = state[exampleId].currentIndex >= state[exampleId].steps.length - 1;
                state[exampleId].prevBtn.disabled = isFirstStep;
                state[exampleId].prevBtn.classList.toggle('btn-disabled', isFirstStep);
                
                if (isLastStep) {
                    state[exampleId].nextBtn.classList.add('hidden');
                    state[exampleId].resetBtn.classList.remove('hidden');
                } else {
                    state[exampleId].nextBtn.classList.remove('hidden');
                    state[exampleId].resetBtn.classList.add('hidden');
                }
            };
            
            const resetExample = () => {
                state[exampleId].steps.forEach(step => step.classList.remove('active'));
                state[exampleId].currentIndex = -1;
                if (state[exampleId].placeholder) {
                    state[exampleId].placeholder.classList.remove('hidden');
                }
                updateButtons();
            };

            state[exampleId].nextBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex < state[exampleId].steps.length - 1) {
                    if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.add('hidden');
                    }
                    state[exampleId].currentIndex++;
                    state[exampleId].steps[state[exampleId].currentIndex].classList.add('active');
                    updateButtons();
                }
            });

            state[exampleId].prevBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex > -1) {
                    state[exampleId].steps[state[exampleId].currentIndex].classList.remove('active');
                    state[exampleId].currentIndex--;
                     if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.remove('hidden');
                    }
                    updateButtons();
                }
            });

            if(state[exampleId].resetBtn) { state[exampleId].resetBtn.addEventListener('click', resetExample); }
            updateButtons();
        });

        // ===================================================================================
        // ููุฏ ุฎุงุต ุจุงูุฏุฑุณ (ููุง ูุชู ูุถุน ุงููุญุชูู ุงููุฎุตุต)
        // ===================================================================================
        
        // 1. ุชุญุฏูุฏ ูุนุฑูู ุงูุฏุฑุณ ูุจูุงูุงุชู
        const LESSON_ID = 'c2_l4_linear_equations'; 
        const LESSON_TITLE = "ุงูุฏุฑุณ ูข-ูค: ุญู ุงููุนุงุฏูุงุช ุงูุฎุทูุฉ ุจูุงููุงู";

        // 2. ุจูู ุงูุฃุณุฆูุฉ ุงูุฎุงุต ุจุงูุฏุฑุณ
        function generateQuiz() {
            const questionBank = [
                {
                    type: 'mcq', level: 'โญ', topic: 'concept', text: 'ูุงุฐุง ููุซู "ุตูุฑ ุงูุฏุงูุฉ" ูู ุงูุฑุณู ุงูุจูุงููุ',
                    options: [
                        { display: 'ุงูููุทุน ุงูุตุงุฏู', value: 'A' },
                        { display: 'ุงูููุทุน ุงูุณููู', value: 'B' },
                        { display: 'ููุทุฉ ุงูุฃุตู', value: 'C' },
                        { display: 'ููู ุงูุฎุท', value: 'D' }
                    ],
                    correct: 'B',
                    explanation: '<p>ุตูุฑ ุงูุฏุงูุฉ ูู ูููุฉ (ุณ) ุงูุชู ุชุฌุนู ูููุฉ ุงูุฏุงูุฉ (ุต) ุชุณุงูู ุตูุฑูุง. ุนูู ุงูุฑุณู ุงูุจูุงููุ ูุฐู ูู ุงูููุทุฉ ุงูุชู ููุทุน ูููุง ุงูุฎุท ูุญูุฑ ุงูุณููุงุชุ ูุชูุนุฑู ุจู "ุงูููุทุน ุงูุณููู".</p>'
                },
                {
                    type: 'mcq', level: 'โญ', topic: 'parent-function', text: 'ูุง ูู ุงูุฏุงูุฉ ุงููููุฏุฉ (ุงูุฃู) ูุฌููุน ุงูุฏูุงู ุงูุฎุทูุฉุ',
                    options: [
                        { display: '<span class="math-eq">ุฏ(ุณ) = ุณยฒ</span>', value: 'A' },
                        { display: '<span class="math-eq">ุฏ(ุณ) = ุณ</span>', value: 'B' },
                        { display: '<span class="math-eq">ุฏ(ุณ) = |ุณ|</span>', value: 'C' },
                        { display: '<span class="math-eq">ุฏ(ุณ) = ูก</span>', value: 'D' }
                    ],
                    correct: 'B',
                    explanation: '<p>ุงูุฏุงูุฉ <span class="math-eq">ุฏ(ุณ) = ุณ</span> ูู ุฃุจุณุท ุตูุฑุฉ ููุฏุงูุฉ ุงูุฎุทูุฉ ูุชุนุชุจุฑ ุงูุฏุงูุฉ ุงูุฃู ุงูุชู ุชูุจูู ุนูููุง ุฌููุน ุงูุฏูุงู ุงูุฎุทูุฉ ุงูุฃุฎุฑู ูู ุฎูุงู ุงูุชุญูููุงุช (ุฅุฒุงุญุฉุ ุชูุฏุฏุ ุงูุนูุงุณ).</p>'
                },
                {
                    type: 'mcq', level: 'โญโญ', topic: 'related-function', text: 'ูุง ูู ุงูุฏุงูุฉ ุงููุฑุชุจุทุฉ ุจุงููุนุงุฏูุฉ <span class="math-eq">ูฅุณ = ูขูฅ</span>ุ',
                    options: [
                        { display: '<span class="math-eq">ุฏ(ุณ) = ูฅุณ</span>', value: 'A' },
                        { display: '<span class="math-eq">ุฏ(ุณ) = ูฅุณ + ูขูฅ</span>', value: 'B' },
                        { display: '<span class="math-eq">ุฏ(ุณ) = ูฅุณ - ูขูฅ</span>', value: 'C' },
                        { display: '<span class="math-eq">ุฏ(ุณ) = ูขูฅ</span>', value: 'D' }
                    ],
                    correct: 'C',
                    explanation: '<p>ูุฅูุฌุงุฏ ุงูุฏุงูุฉ ุงููุฑุชุจุทุฉุ ูุฌุจ ุฃููุงู ุฃู ูุฌุนู ุฃุญุฏ ุทุฑูู ุงููุนุงุฏูุฉ ูุณุงูู ุตูุฑูุง. ูุทุฑุญ ูขูฅ ูู ุงูุทุฑููู: <span class="math-eq">ูฅุณ - ูขูฅ = ู</span>. ุซู ูุณุชุจุฏู ุงูุตูุฑ ุจู <span class="math-eq">ุฏ(ุณ)</span> ูุชุตุจุญ ุงูุฏุงูุฉ <span class="math-eq">ุฏ(ุณ) = ูฅุณ - ูขูฅ</span>.</p>'
                },
                {
                    type: 'mcq', level: 'โญโญ', topic: 'graph-reading', text: 'ูู ุงูุฑุณู ุงูุจูุงููุ ูุง ูู ุตูุฑ ุงูุฏุงูุฉุ',
                    graph: '<svg viewBox="-5 -5 10 10" class="w-full h-40 bg-white border rounded-lg mt-2"><path d="M -5,1 L 5,1 M -5,2 L 5,2 M -5,3 L 5,3 M -5,4 L 5,4 M -5,-1 L 5,-1 M -5,-2 L 5,-2 M -5,-3 L 5,-3 M -5,-4 L 5,-4" stroke="#d1d5db" stroke-width="0.15" /><path d="M 1,-5 L 1,5 M 2,-5 L 2,5 M 3,-5 L 3,5 M 4,-5 L 4,5 M -1,-5 L -1,5 M -2,-5 L -2,5 M -3,-5 L -3,5 M -4,-5 L -4,5" stroke="#d1d5db" stroke-width="0.15" /><line x1="-5" y1="0" x2="5" y2="0" stroke="#9ca3af" stroke-width="0.2" /><line x1="0" y1="-5" x2="0" y2="5" stroke="#9ca3af" stroke-width="0.2" /><line x1="0" y1="4" x2="4" y2="-4" stroke="#3b82f6" stroke-width="0.4" /><circle cx="2" cy="0" r="0.3" fill="#ef4444" /></svg>',
                    options: [
                        { display: '<span class="math-eq">ุณ = ู</span>', value: 'A' },
                        { display: '<span class="math-eq">ุณ = ูข</span>', value: 'B' },
                        { display: '<span class="math-eq">ุณ = -ูข</span>', value: 'C' },
                        { display: '<span class="math-eq">ุณ = ูค</span>', value: 'D' }
                    ],
                    correct: 'B',
                    explanation: '<p>ูุจุญุซ ุนู ุงูููุทุฉ ุงูุชู ููุทุน ูููุง ุงูุฎุท ุงููุณุชููู ูุญูุฑ ุงูุณููุงุช (ุงููุญูุฑ ุงูุฃููู). ูู ูุฐุง ุงูุฑุณูุ ููุทุน ุงูุฎุท ูุญูุฑ ุงูุณููุงุช ุนูุฏ ุงูููุทุฉ ุงูุชู ุชููู ูููุง <span class="math-eq">ุณ = ูข</span>.</p>'
                },
                {
                    type: 'mcq', level: 'โญโญ', topic: 'solve-equation', text: 'ุฃูุฌุฏ ุฌุฐุฑ ุงููุนุงุฏูุฉ <span class="math-eq">ูกู - ูฅุณ = ู</span>.',
                    options: [
                        { display: '<span class="math-eq">ูข</span>', value: 'A' },
                        { display: '<span class="math-eq">-ูข</span>', value: 'B' },
                        { display: '<span class="math-eq">ู.ูฅ</span>', value: 'C' },
                        { display: '<span class="math-eq">ูฅ</span>', value: 'D' }
                    ],
                    correct: 'A',
                    explanation: '<p>ูุฅูุฌุงุฏ ุงูุฌุฐุฑุ ูุญู ุงููุนุงุฏูุฉ. <span class="math-eq">ูกู - ูฅุณ = ู</span>. ูุถูู ูฅุณ ููุทุฑููู: <span class="math-eq">ูกู = ูฅุณ</span>. ุซู ููุณู ูกู ุนูู ูฅ ููุฌุฏ ุฃู ุณ = ูข.</p>'
                },
                {
                    type: 'mcq',
                    level: 'โญโญโญ',
                    topic: 'table-estimation',
                    text: `ูุง ุงูุชูุฏูุฑ ุงูุฃูุถู ููููุทุน ุงูุณููู ููุฏุงูุฉ ุงูุฎุทูุฉ ุงูููุซูุฉ ูู ุงูุฌุฏูู ุงูุชุงููุ
                            <div class="flex justify-center my-2">
                                <table class="w-1/2 text-center border">
                                    <thead class="bg-gray-200"><tr><th class="p-1 border">ุณ</th><th class="p-1 border">ุต</th></tr></thead>
                                    <tbody>
                                        <tr><td class="p-1 border">ู</td><td class="p-1 border">ูฅ</td></tr>
                                        <tr><td class="p-1 border">ูก</td><td class="p-1 border">ูฃ</td></tr>
                                        <tr><td class="p-1 border">ูข</td><td class="p-1 border">ูก</td></tr>
                                        <tr><td class="p-1 border">ูฃ</td><td class="p-1 border">-ูก</td></tr>
                                        <tr><td class="p-1 border">ูค</td><td class="p-1 border">-ูฃ</td></tr>
                                    </tbody>
                                </table>
                            </div>`,
                    options: [
                        { display: 'ุจูู ู ู ูก', value: 'A' },
                        { display: 'ุจูู ูข ู ูฃ', value: 'B' },
                        { display: 'ุจูู ูก ู ูข', value: 'C' },
                        { display: 'ุจูู ูฃ ู ูค', value: 'D' }
                    ],
                    correct: 'B',
                    explanation: `
                        <p class="mb-2">ุงูููุทุน ุงูุณููู (ุตูุฑ ุงูุฏุงูุฉ) ูุญุฏุซ ุนูุฏูุง ุชุชุบูุฑ ุฅุดุงุฑุฉ (ุต) ูู ููุฌุจุฉ ุฅูู ุณุงูุจุฉ. ุจุงููุธุฑ ุฅูู ุงูุฌุฏููุ ูุฌุฏ ุฃู ูููุฉ (ุต) ูุงูุช ูก (ููุฌุจุฉ) ุนูุฏูุง ูุงูุช ุณ = ูขุ ูุฃุตุจุญุช -ูก (ุณุงูุจุฉ) ุนูุฏูุง ุฃุตุจุญุช ุณ = ูฃ. ูุฐููุ ูุง ุจุฏ ุฃู ุงูุฎุท ูุฏ ูุทุน ูุญูุฑ ุงูุณููุงุช ูู ููุทุฉ ูุง ุจูู ุณ=ูข ู ุณ=ูฃ.</p>
                        <h4 class="font-bold mt-4 mb-2">ุชูุถูุญ ูุฑุฆู:</h4>
                        <div class="bg-gray-100 p-2 rounded-lg">
                            <svg id="animation-canvas" viewBox="-2 -6 8 12" class="w-full h-64 bg-white border rounded-lg"></svg>
                            <div class="mt-2 grid grid-cols-3 gap-2">
                                <button id="modal-prev-btn" class="w-full bg-blue-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">ุงูุณุงุจู</button>
                                <button id="modal-next-btn" class="w-full bg-blue-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">ุงูุชุงูู</button>
                                <button id="modal-reset-btn" class="w-full bg-red-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">ุฅุนุงุฏุฉ</button>
                            </div>
                        </div>
                    `
                },
                {
                    type: 'mcq', level: 'โญ', topic: 'related-function', text: 'ูุง ูู ุงูุฏุงูุฉ ุงููุฑุชุจุทุฉ ุจุงููุนุงุฏูุฉ <span class="math-eq">-ูขุณ + ูง = ู</span>ุ',
                    options: [
                        { display: '<span class="math-eq">ุฏ(ุณ) = ูขุณ + ูง</span>', value: 'A' },
                        { display: '<span class="math-eq">ุฏ(ุณ) = -ูขุณ + ูง</span>', value: 'B' },
                        { display: '<span class="math-eq">ุฏ(ุณ) = -ูขุณ - ูง</span>', value: 'C' },
                        { display: '<span class="math-eq">ุฏ(ุณ) = ูง</span>', value: 'D' }
                    ],
                    correct: 'B',
                    explanation: '<p>ุจูุง ุฃู ุฃุญุฏ ุทุฑูู ุงููุนุงุฏูุฉ ูุณุงูู ุตูุฑูุง ุจุงููุนูุ ูุฅููุง ุจุจุณุงุทุฉ ูุณุชุจุฏู ุงูุตูุฑ ุจู <span class="math-eq">ุฏ(ุณ)</span> ููุญุตูู ุนูู ุงูุฏุงูุฉ ุงููุฑุชุจุทุฉ: <span class="math-eq">ุฏ(ุณ) = -ูขุณ + ูง</span>.</p>'
                },
                 {
                    type: 'mcq', level: 'โญโญ', topic: 'graph-reading', text: 'ูู ุงูุฑุณู ุงูุจูุงููุ ูุง ูู ุตูุฑ ุงูุฏุงูุฉุ',
                    graph: '<svg viewBox="-5 -5 10 10" class="w-full h-40 bg-white border rounded-lg mt-2"><path d="M -5,1 L 5,1 M -5,2 L 5,2 M -5,3 L 5,3 M -5,4 L 5,4 M -5,-1 L 5,-1 M -5,-2 L 5,-2 M -5,-3 L 5,-3 M -5,-4 L 5,-4" stroke="#d1d5db" stroke-width="0.15" /><path d="M 1,-5 L 1,5 M 2,-5 L 2,5 M 3,-5 L 3,5 M 4,-5 L 4,5 M -1,-5 L -1,5 M -2,-5 L -2,5 M -3,-5 L -3,5 M -4,-5 L -4,5" stroke="#d1d5db" stroke-width="0.15" /><line x1="-5" y1="0" x2="5" y2="0" stroke="#9ca3af" stroke-width="0.2" /><line x1="0" y1="-5" x2="0" y2="5" stroke="#9ca3af" stroke-width="0.2" /><line x1="-5" y1="2" x2="1" y2="-4" stroke="#3b82f6" stroke-width="0.4" /><circle cx="-3" cy="0" r="0.3" fill="#ef4444" /></svg>',
                    options: [
                        { display: '<span class="math-eq">ุณ = ูข</span>', value: 'A' },
                        { display: '<span class="math-eq">ุณ = -ูฃ</span>', value: 'B' },
                        { display: '<span class="math-eq">ุณ = -ูก</span>', value: 'C' },
                        { display: '<span class="math-eq">ุณ = ู</span>', value: 'D' }
                    ],
                    correct: 'B',
                    explanation: '<p>ุจุงููุธุฑ ุฅูู ุงูุฑุณู ุงูุจูุงููุ ูุฌุฏ ุฃู ุงูุฎุท ุงููุณุชููู ูุชูุงุทุน ูุน ูุญูุฑ ุงูุณููุงุช ุนูุฏ ุงูููุทุฉ <span class="math-eq">ุณ = -ูฃ</span>. ูุฐุงุ ุตูุฑ ูุฐู ุงูุฏุงูุฉ ูู -ูฃ.</p>'
                },
                {
                    type: 'mcq', level: 'โญโญโญ', topic: 'solve-equation', text: 'ุฅุฐุง ูุงู ุตูุฑ ุงูุฏุงูุฉ <span class="math-eq">ุฏ(ุณ) = ู ุณ - ูกูข</span> ูู ูคุ ููุง ูููุฉ ุงูุซุงุจุช (ู)ุ',
                    options: [
                        { display: '<span class="math-eq">ูฃ</span>', value: 'A' },
                        { display: '<span class="math-eq">-ูฃ</span>', value: 'B' },
                        { display: '<span class="math-eq">ูค</span>', value: 'C' },
                        { display: '<span class="math-eq">ูกูข</span>', value: 'D' }
                    ],
                    correct: 'A',
                    explanation: '<p>ูุนูู ุฃู ุตูุฑ ุงูุฏุงูุฉ ูู ูคุ ุฃูู ุนูุฏ <span class="math-eq">ุณ = ูค</span>ุ ุชููู <span class="math-eq">ุฏ(ุณ) = ู</span>. ูุนูุถ ูู ุงููุนุงุฏูุฉ: <span class="math-eq">ู = ู(ูค) - ูกูข</span>. ูุถูู ูกูข ููุทุฑููู: <span class="math-eq">ูกูข = ูคู</span>. ูุฅูุฌุงุฏ ูููุฉ ูุ ููุณู ูกูข ุนูู ูคุ ูุชููู ูููุฉ ู = ูฃ.</p>'
                },
                {
                    type: 'mcq', level: 'โญ', topic: 'concept', text: 'ูุฑุงุฏู ูููุฉ "ุฌุฐุฑ" ุงููุนุงุฏูุฉ ูู...',
                    options: [
                        { display: 'ููู ุงูุฏุงูุฉ', value: 'A' },
                        { display: 'ุตูุฑ ุงูุฏุงูุฉ', value: 'B' },
                        { display: 'ูุฏู ุงูุฏุงูุฉ', value: 'C' },
                        { display: 'ูุฌุงู ุงูุฏุงูุฉ', value: 'D' }
                    ],
                    correct: 'B',
                    explanation: '<p>ุฌุฐุฑ ุงููุนุงุฏูุฉุ ูุญู ุงููุนุงุฏูุฉุ ูุตูุฑ ุงูุฏุงูุฉ ุงููุฑุชุจุทุฉ ุจูุงุ ูููุง ูุตุทูุญุงุช ุชุดูุฑ ุฅูู ููุณ ุงููููุฉุ ููู ุงูููุทุน ุงูุณููู ููุฑุณู ุงูุจูุงูู.</p>'
                },
                {
                    type: 'mcq', level: 'โญโญ', topic: 'solve-equation', text: 'ุญู ุงููุนุงุฏูุฉ <span class="inline-flex flex-col text-center leading-tight align-middle"><span>ุณ</span><span class="border-t border-current w-full"></span><span>ูข</span></span> + ูฅ = ู ูู:',
                    options: [
                        { display: '<span class="math-eq">ูกู</span>', value: 'A' },
                        { display: '<span class="math-eq">-ูฅ</span>', value: 'B' },
                        { display: '<span class="math-eq">-ูข.ูฅ</span>', value: 'C' },
                        { display: '<span class="math-eq">-ูกู</span>', value: 'D' }
                    ],
                    correct: 'D',
                    explanation: '<p>ูุญู ุงููุนุงุฏูุฉุ ูุทุฑุญ ูฅ ูู ุงูุทุฑููู: <span class="inline-flex flex-col text-center leading-tight align-middle"><span>ุณ</span><span class="border-t border-current w-full"></span><span>ูข</span></span> = -ูฅ. ุซู ูุถุฑุจ ุงูุทุฑููู ูู ูข ููุชุฎูุต ูู ุงูููุงู: ุณ = -ูกู.</p>'
                },
                {
                    type: 'mcq', level: 'โญโญโญ', topic: 'real-life', text: 'ูููุต ุฎุฒุงู ูุงุก ุจูุนุฏู ุซุงุจุช. ูููู ุชูุซูู ูููุฉ ุงููุงุก (ู) ุจุงููุชุฑ ุจุนุฏ (ุฒ) ุณุงุนุฉ ุจุงูุฏุงูุฉ <span class="math-eq">ู(ุฒ) = ูฅูู - ูขูฅุฒ</span>. ูุงุฐุง ููุซู ุตูุฑ ูุฐู ุงูุฏุงูุฉุ',
                    options: [
                        { display: 'ูููุฉ ุงููุงุก ุงูุฃูููุฉ', value: 'A' },
                        { display: 'ูุนุฏู ุงูููุตุงู ูู ุงูุณุงุนุฉ', value: 'B' },
                        { display: 'ุงูููุช ุงูุฐู ููุฑุบ ููู ุงูุฎุฒุงู', value: 'C' },
                        { display: 'ูุตู ูููุฉ ุงููุงุก', value: 'D' }
                    ],
                    correct: 'C',
                    explanation: '<p>ุตูุฑ ุงูุฏุงูุฉ ูู ูููุฉ (ุฒ) ุงูุชู ุชุฌุนู ูููุฉ ุงููุงุก (ู) ุชุณุงูู ุตูุฑูุง. ูู ูุฐุง ุงูุณูุงูุ ูู ููุซู ุงูุฒูู ุงููุงุฒู ุญุชู ุชุตุจุญ ูููุฉ ุงููุงุก ูู ุงูุฎุฒุงู ุตูุฑูุงุ ุฃู ุงูููุช ุงูุฐู ููุฑุบ ููู ุงูุฎุฒุงู ุชูุงููุง.</p>'
                }
            ];
            const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
            const questionCount = Math.min(shuffled.length, 5);
            return shuffled.slice(0, questionCount);
        }

        // 3. ุชุดุบูู ูุฅุนุฏุงุฏ ุงูุฏุฑุณ
        const student = getStudentFromStorage();
        buildHeader(student, LESSON_TITLE);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        
        // 4. ุฑุจุท ุงูุฃุญุฏุงุซ ูุงูุฃุฒุฑุงุฑ
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) { closeModalBtn.addEventListener('click', closeModal); }
        
        // 5. ููุฏ ูุฎุตุต ููุฑุณูู ุงููุชุญุฑูุฉ ูู ูุฐุง ุงูุฏุฑุณ
        // ุงูุฑุณูู ุงููุชุญุฑูุฉ ููุฌุฒุก ุงูุซุงูู (ุงูุฑุฆูุณู)
        const nextStepBtn = document.getElementById('next-step-btn');
        const prevStepBtn = document.getElementById('prev-step-btn');
        const resetStepBtn = document.getElementById('reset-step-btn');
        const tableBody = document.getElementById('interactive-table-body');
        const graph = document.getElementById('interactive-graph');
        let animationStep = 0;
        const animationData = [
            { s: 'ูข', calc: 'ูข(<span class="highlight-s">ูข</span>) - ูจ = -ูค', res: '-ูค', point: {x: 2, y: -4}, color: '#1d4ed8'},
            { s: 'ูค', calc: 'ูข(<span class="highlight-s">ูค</span>) - ูจ = ู', res: 'ู', point: {x: 4, y: 0}, color: '#ef4444'},
            { s: 'ูฅ', calc: 'ูข(<span class="highlight-s">ูฅ</span>) - ูจ = ูข', res: 'ูข', point: {x: 5, y: 2}, color: '#1d4ed8'}
        ];
        
        function drawGraphState(isAnimating = false) {
            initializeGraph();
            const graphConclusion = document.getElementById('graph-conclusion');
            graphConclusion.classList.add('hidden');
            const animationPromises = [];

            for (let i = 0; i < animationStep; i++) {
                const data = animationData[i];
                const px = data.point.x;
                const py = -data.point.y; 

                if (isAnimating && i === animationStep - 1) {
                    const promise = new Promise(resolve => {
                        const durationX = Math.abs(px) * 0.2;
                        const durationY = Math.abs(py) * 0.2;
                        
                        const pathX = createAnimatedPath(`M 0 0 H ${px}`, durationX);
                        graph.appendChild(pathX);
                        pathX.firstElementChild.beginElement();

                        setTimeout(() => {
                            const pathY = createAnimatedPath(`M ${px} 0 V ${py}`, durationY);
                            graph.appendChild(pathY);
                            pathY.firstElementChild.beginElement();

                            setTimeout(() => {
                                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                                circle.setAttribute('cx', px);
                                circle.setAttribute('cy', py);
                                circle.setAttribute('r', 0.3);
                                circle.setAttribute('fill', data.color);
                                graph.appendChild(circle);
                                resolve();
                            }, durationY * 1000);
                        }, durationX * 1000);
                    });
                    animationPromises.push(promise);
                } else {
                    const pathX = createStaticPath(`M 0 0 H ${px}`);
                    const pathY = createStaticPath(`M ${px} 0 V ${py}`);
                    const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    circle.setAttribute('cx', px);
                    circle.setAttribute('cy', py);
                    circle.setAttribute('r', 0.3);
                    circle.setAttribute('fill', data.color);
                    graph.appendChild(pathX);
                    graph.appendChild(pathY);
                    graph.appendChild(circle);
                }
            }

            Promise.all(animationPromises).then(() => {
                if (animationStep === animationData.length) {
                    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    line.setAttribute('x1', 1);
                    line.setAttribute('y1', 6);
                    line.setAttribute('x2', 6);
                    line.setAttribute('y2', -4);
                    line.setAttribute('stroke', '#3b82f6');
                    line.setAttribute('stroke-width', '0.4');
                    graph.insertBefore(line, graph.firstChild);
                    graphConclusion.classList.remove('hidden');
                }
            });
        }

        function createStaticPath(d) {
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute('d', d);
            path.setAttribute('stroke', '#a78bfa');
            path.setAttribute('stroke-width', '0.2');
            path.setAttribute('stroke-dasharray', '0.4 0.4');
            path.setAttribute('fill', 'none');
            return path;
        }

        function createAnimatedPath(d, dur) {
            const path = createStaticPath(d);
            const length = path.getTotalLength();
            path.style.strokeDasharray = length;
            path.style.strokeDashoffset = length;
            
            const animate = document.createElementNS("http://www.w3.org/2000/svg", "animate");
            animate.setAttribute('attributeName', 'stroke-dashoffset');
            animate.setAttribute('from', length);
            animate.setAttribute('to', '0');
            animate.setAttribute('dur', `${dur}s`);
            animate.setAttribute('fill', 'freeze');
            path.appendChild(animate);
            return path;
        }
        
        function updateTable() {
            tableBody.innerHTML = '';
             for (let i = 0; i < animationStep; i++) {
                const data = animationData[i];
                const newRow = tableBody.insertRow();
                newRow.innerHTML = `
                    <td class="border border-slate-300 p-2 align-middle text-center font-bold highlight-s">${data.s}</td>
                    <td class="border border-slate-300 p-2 align-middle text-center"><span class="math-eq">${data.calc}</span></td>
                    <td class="border border-slate-300 p-2 align-middle text-center"><span class="math-eq">(${data.s}, ${data.res})</span></td>
                `;
             }
        }

        function updateButtons() {
            const tableConclusion = document.getElementById('table-conclusion');
            prevStepBtn.disabled = animationStep === 0;
            nextStepBtn.disabled = animationStep === animationData.length;
            
            prevStepBtn.classList.toggle('btn-disabled', prevStepBtn.disabled);
            
            nextStepBtn.classList.toggle('btn-disabled', nextStepBtn.disabled);

            nextStepBtn.textContent = (animationStep === animationData.length) ? 'ุงูุชูู ุงูุดุฑุญ' : 'ุงูุชุงูู';
            
            if (animationStep >= 2) {
                tableConclusion.classList.remove('hidden');
            } else {
                tableConclusion.classList.add('hidden');
            }
        }

        function handleNextStep() {
            if (animationStep < animationData.length) {
                animationStep++;
                updateTable();
                drawGraphState(true);
                updateButtons();
            }
        }

        function handlePrevStep() {
            if (animationStep > 0) {
                animationStep--;
                updateTable();
                drawGraphState(false);
                updateButtons();
            }
        }

        function resetAnimation() {
            animationStep = 0;
            updateTable();
            initializeGraph();
            updateButtons();
        }

        function initializeGraph() {
            graph.innerHTML = '';
            let gridHtml = '';
            for(let i = -9; i <= 9; i++) {
                if (i === 0) continue;
                gridHtml += `<line x1="-10" y1="${i}" x2="10" y2="${i}" stroke="#d1d5db" stroke-width="0.15" />`;
                gridHtml += `<line x1="${i}" y1="-10" x2="${i}" y2="10" stroke="#d1d5db" stroke-width="0.15" />`;
            }
            gridHtml += '<line x1="-10" y1="0" x2="10" y2="0" stroke="#6b7280" stroke-width="0.2"/>';
            gridHtml += '<line x1="0" y1="-10" x2="0" y2="10" stroke="#6b7280" stroke-width="0.2"/>';
            gridHtml += '<text x="9.5" y="-0.5" font-size="0.8" fill="#374151" font-weight="bold">ุณ</text>';
            gridHtml += '<text x="0.5" y="-9.5" font-size="0.8" fill="#374151" font-weight="bold">ุต</text>';
            graph.innerHTML = gridHtml;
        }

        // ุงูุฑุณูู ุงููุชุญุฑูุฉ ููุงูุฐุฉ ุงูุดุฑุญ ูู ุงูุงุฎุชุจุงุฑ
        let modalAnimationStep = 0;
        const modalAnimationData = [ {x: 0, y: 5}, {x: 1, y: 3}, {x: 2, y: 1}, {x: 3, y: -1}, {x: 4, y: -3} ];

        function drawModalGraphState() {
            const svg = document.getElementById('animation-canvas');
            if (!svg) return;
            const scaleY = (y) => -y;
            svg.innerHTML = ''; 

            svg.innerHTML += '<path d="M -1,0 L 6,0 M 0,-6 L 0,6" stroke="#cccccc" stroke-width="0.08"/>';
            for(let i = -1; i <= 5; i++) { svg.innerHTML += '<line x1="'+i+'" y1="-6" x2="'+i+'" y2="6" stroke="#e5e7eb" stroke-width="0.05" />'; }
            for(let i = -5; i <= 5; i++) { svg.innerHTML += '<line x1="-1" y1="'+i+'" x2="6" y2="'+i+'" stroke="#e5e7eb" stroke-width="0.05" />'; }
            
            const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rect.setAttribute('x', 2);
            rect.setAttribute('y', -6);
            rect.setAttribute('width', 1);
            rect.setAttribute('height', 12);
            rect.setAttribute('fill', 'rgba(250, 204, 21, 0.3)');
            svg.appendChild(rect);
            svg.innerHTML += '<text x="2.5" y="-5" font-size="0.5" text-anchor="middle" fill="#ca8a04">ุงูุญู ููุง</text>';

            for (let i = 0; i < modalAnimationStep; i++) {
                const p = modalAnimationData[i];
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute('cx', p.x);
                circle.setAttribute('cy', scaleY(p.y));
                circle.setAttribute('r', '0.15');
                circle.setAttribute('fill', '#dc2626');
                svg.appendChild(circle);

                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute('x', p.x + 0.2);
                text.setAttribute('y', scaleY(p.y) - 0.2);
                text.setAttribute('font-size', '0.4');
                text.textContent = `(${p.x},${p.y})`;
                svg.appendChild(text);
            }

            if (modalAnimationStep === modalAnimationData.length) {
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute('x1', modalAnimationData[0].x);
                line.setAttribute('y1', scaleY(modalAnimationData[0].y));
                line.setAttribute('x2', modalAnimationData[4].x);
                line.setAttribute('y2', scaleY(modalAnimationData[4].y));
                line.setAttribute('stroke', '#3b82f6');
                line.setAttribute('stroke-width', '0.1');
                svg.insertBefore(line, svg.firstChild);
            }
        }

        function updateModalButtons() {
            const prevBtn = document.getElementById('modal-prev-btn');
            const nextBtn = document.getElementById('modal-next-btn');
            if (!prevBtn || !nextBtn) return;

            prevBtn.disabled = modalAnimationStep === 0;
            nextBtn.disabled = modalAnimationStep === modalAnimationData.length;
            prevBtn.classList.toggle('btn-disabled', prevBtn.disabled);
            nextBtn.classList.toggle('btn-disabled', nextBtn.disabled);
        }

        function handleModalNext() {
            if (modalAnimationStep < modalAnimationData.length) {
                modalAnimationStep++;
                drawModalGraphState();
                updateModalButtons();
            }
        }

        function handleModalPrev() {
            if (modalAnimationStep > 0) {
                modalAnimationStep--;
                drawModalGraphState();
                updateModalButtons();
            }
        }

        function resetModalAnimation() {
            modalAnimationStep = 0;
            drawModalGraphState();
            updateModalButtons();
        }

        // ุฑุจุท ุงูุฃุญุฏุงุซ ุงูุนุงูุฉ
        document.querySelector('#quizForm').addEventListener('click', function(event) {
            if (event.target.classList.contains('explain-btn')) {
                const index = event.target.getAttribute('data-question-index');
                showExplanation(index);
                if (currentQuestions[index].topic === 'table-estimation') {
                    modalAnimationStep = 0; 
                    const nextBtn = document.getElementById('modal-next-btn');
                    const prevBtn = document.getElementById('modal-prev-btn');
                    const resetBtn = document.getElementById('modal-reset-btn');
                    
                    if(nextBtn && prevBtn && resetBtn) {
                        nextBtn.addEventListener('click', handleModalNext);
                        prevBtn.addEventListener('click', handleModalPrev);
                        resetBtn.addEventListener('click', resetModalAnimation);
                    }
                    drawModalGraphState();
                    updateModalButtons();
                }
            }
        });
        
        closeModalBtn.addEventListener('click', closeModal);
        nextStepBtn.addEventListener('click', handleNextStep);
        prevStepBtn.addEventListener('click', handlePrevStep);
        resetStepBtn.addEventListener('click', resetAnimation);
        
        // --- Initial Load ---
        initializeGraph();
    });
    </script>
</body>
</html>

