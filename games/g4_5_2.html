<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- NEW: Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
    <title>ØªØ­Ø¯ÙŠ Ø§Ù„Ø¯Ù‚Ø© (Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø©)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- Ø§Ù„Ø®Ø·  Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ --- */
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #333; /* Ù„ÙˆÙ† Ø§Ø­ØªÙŠØ§Ø·ÙŠ */
            /* Ø§Ù„Ø®Ù„ÙÙŠØ© ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø§Ù„Ø¢Ù† Ø¹Ø¨Ø± JS */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            width: 100vw;
        }

        /* --- Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„ØµØ§Ø±Ù…Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª (Ù…Ù† Ù…Ù„ÙÙƒ) --- */
        .math-formula {
            direction: ltr;
            /* --- NEW: Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù…Ø´ÙƒÙ„Ø© BIDI --- */
            unicode-bidi: isolate;  /* Ø¹Ø²Ù„ Ø§ØªØ¬Ø§Ù‡ Ù‡Ø°Ù‡ Ø§Ù„ÙƒØªÙ„Ø© */
            display: inline-block;  /* Ø¶Ù…Ø§Ù† Ø£Ù†Ù‡Ø§ ÙƒØªÙ„Ø© ÙˆØ§Ø­Ø¯Ø© */
            /* --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ --- */
            font-family: 'Tajawal', sans-serif;
            font-weight: 700;
            color: #1E3A8A; /* Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ† */
            font-size: 1.1em;
        }
        
        .fraction {
            display: inline-block;
            vertical-align: middle;
            text-align: center;
            font-size: 0.9em;
            margin: 0 0.2em;
            line-height: 1.2;
        }
        .fraction .numerator {
            display: block;
            border-bottom: 2px solid #1E3A8A;
            padding: 0 0.2em;
        }
        .fraction .denominator {
            display: block;
            padding: 0 0.2em;
        }
        /* --- Ù†Ù‡Ø§ÙŠØ© Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª --- */

        /* --- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --- */
        .game-container {
            width: 100%;
            max-width: 400px; 
            margin: 1rem auto;
            /* Ø§Ù„Ø´ÙØ§ÙÙŠØ© 50% */
            background-color: rgba(255, 255, 255, 0.5); 
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        @media (max-width: 600px) {
            .game-container {
                margin: 0.5rem;
                padding: 0.75rem;
                max-width: 95vw;
            }
        }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ --- */
        #loading-screen {
            text-align: center;
            color: white;
            padding: 2rem 1.5rem;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 1.5rem;
            width: 90%;
            max-width: 320px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        #loading-screen h1 {
            font-size: 2rem;
        }
        
        #loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4ade80;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #start-button {
            display: none; /* ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø±Ù‡ Ø¹Ø¨Ø± JS */
            margin: 0 auto; /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ø²Ø± */
        }
        #welcome-content {
            display: none; /* ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø±Ù‡ Ø¹Ø¨Ø± JS */
        }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --- */
        .category-grid {
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 0.75rem;
        }
        .category-grid .category-item:nth-child(4),
        .category-grid .category-item:nth-child(5) {
        }
        .category-grid .category-item:nth-child(4) {
        }
        .category-grid .category-item:nth-child(5) {
        }
        .category-item {
            background-color: rgba(255, 255, 255, 0.7);
            border: 2px solid transparent;
            border-radius: 1rem;
            padding: 0.5rem;
            font-size: 2.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;

            flex-grow: 0; 
            flex-shrink: 1; 
            flex-basis: calc((100% - 1.5rem) / 3); 
            min-width: 100px; 
            
            aspect-ratio: 1 / 1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .category-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-color: #3b82f6;
        }
        /* ØªØ¶Ù„ÙŠÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© */
        .category-item.completed {
            background-color: rgba(220, 220, 220, 0.7);
            cursor: not-allowed;
            opacity: 0.6;
        }
        .category-item.completed::after {
            content: 'âœ“';
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #777;
        }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1) --- */
        #question-screen {
            display: none;
            position: relative;
            padding: 0.5rem;
        }
        /* Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© (Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙƒØ®Ù„ÙÙŠØ©) */
        #question-watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12rem;
            color: rgba(0, 0, 0, 0.05);
            opacity: 0.5;
            z-index: 0;
            user-select: none;
        }
        /* Ø¥Ø·Ø§Ø± Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ */
        .question-text-frame {
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #e5e7eb;
            border-radius: 1rem;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            position: relative;
            z-index: 1;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            position: relative;
            z-index: 1;
        }
        .option-button {
            background-color: rgba(255, 255, 255, 0.8); 
            border: 2px solid #d1d5db;
            border-radius: 0.75rem;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60px;
        }
        /* Ø¥Ø®ÙØ§Ø¡ Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± */
        .option-button input[type="radio"] {
            display: none;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©) */
        .option-button:not(.disabled):hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        /* Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© */
        .option-button.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .option-button.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .option-button.correct {
            border-color: #16a34a;
            background-color: #f0fdf4;
            color: #15803d;
            font-weight: bold;
            opacity: 1;
        }
        .option-button.incorrect {
            border-color: #dc2626;
            background-color: #fef2f2;
            color: #b91c1c;
            font-weight: bold;
            opacity: 1;
        }
        
        /* ÙˆÙ…ÙŠØ¶ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© */
        @keyframes flash-green {
            0%, 100% { background-color: #f0fdf4; }
            50% { background-color: #bbf7d0; }
        }
        .option-button.correct.flash {
            animation: flash-green 0.5s 3;
        }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø®Ø· Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯) --- */
        #graph-screen {
            display: none;
            padding: 0.5rem;
        }
        /* Ø¥Ø·Ø§Ø± Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©) */
        .graph-text-frame {
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #e5e7eb;
            border-radius: 1rem;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            position: relative;
            z-index: 1;
        }
        
        .number-line-container {
            width: 100%;
            padding: 2rem 1rem 2rem 1rem;
            position: relative;
            direction: ltr; /* Ù…Ù‡Ù… Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… */
            margin-bottom: 0.5rem;
        }
        .number-line-track {
            width: 100%;
            height: 8px;
            background-color: #3f3f46;
            border-radius: 4px;
            position: relative;
        }
        .number-line-points {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            max-width: 90%; 
            display: flex;
            justify-content: space-evenly; 
        }
        .number-line-point {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }
        .point-visual {
            width: 24px;
            height: 24px;
            margin-bottom: -28px;
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .point-visual .point-line {
            width: 3px;
            height: 24px;
            background-color: #4b5563;
            border-radius: 2px;
        }
        .point-visual .point-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 4px solid #3b82f6;
            background-color: white;
        }
        .point-visual .point-circle.closed {
            background-color: #3b82f6;
        }
        .point-label {
            margin-top: 30px;
            font-weight: 700;
            color: #1f2937;
            font-size: 1.1rem;
        }
        
        /* Ø­Ø§ÙˆÙŠØ© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„ØµØºÙŠØ±Ø© */
        .arrow-controls {
            position: absolute;
            bottom: 40px; /* ÙÙˆÙ‚ Ø§Ù„Ù†Ù‚Ø·Ø© */
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 0.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 0.5rem;
            padding: 0.25rem;
            z-index: 10;
            visibility: hidden; /* Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            opacity: 0;
            transition: all 0.2s ease;
        }
        .point-visual:not(.state-0) + .arrow-controls {
            visibility: visible;
            opacity: 1;
        }
        .arrow-control {
            font-size: 1.25rem;
            font-weight: bold;
            color: #9ca3af;
            cursor: pointer;
            padding: 0 0.25rem;
        }
        .arrow-control:hover {
            color: #3b82f6;
        }
        .arrow-control.active {
            color: #3b82f6;
        }

        /* Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø§Ù„Ù…Ù…ØªØ¯Ø© */
        .line-segment {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            height: 6px;
            background-color: #3b82f6;
            z-index: 1;
            display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            transition: all 0.2s ease;
        }
        /* Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ø£ÙŠÙ…Ù† (Ø§Ù„Ø£Ø²Ø±Ù‚) */
        .line-segment.right {
            left: 50%;
            width: 100px;
            border-top-right-radius: 3px;
            border-bottom-right-radius: 3px;
        }
        .line-segment.right::after {
            content: '';
            position: absolute;
            right: -12px;
            top: 50%;
            transform: translateY(-50%);
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 12px solid #3b82f6;
        }
        /* Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ø£ÙŠØ³Ø± (Ø§Ù„Ø£Ø®Ø¶Ø±) */
        .line-segment.left {
            right: 50%;
            width: 100px;
            background-color: #16a34a; /* Ø£Ø®Ø¶Ø± */
            border-top-left-radius: 3px;
            border-bottom-left-radius: 3px;
        }
        .line-segment.left::after {
            content: '';
            position: absolute;
            left: -12px;
            top: 50%;
            transform: translateY(-50%);
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-right: 12px solid #16a34a;
        }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„) --- */
        #finish-screen {
            display: none;
            padding: 1rem;
            text-align: center;
        }
        #leaderboard-loader {
            display: none;
        }
        #finish-game-wrapper {
            display: none;
            margin-top: 1.5rem;
        }

        /* --- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ù„Ù„Ø£Ø²Ø±Ø§Ø± --- */
        .bottom-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0.75rem;
            border-top: 1px solid #e5e7eb;
            margin-top: 0.75rem;
            gap: 0.5rem;
        }
        .bottom-bar > * {
            flex: 1;
        }
        /* Ø£Ø²Ø±Ø§Ø± CTA (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©) */
        .cta-button {
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            display: block;
        }
        .cta-button:hover {
            background-color: #2563eb;
        }
        .cta-button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        /* Ø²Ø± "Ø§Ø¹Ø±Ù Ù„Ù…Ø§Ø°Ø§ØŸ" (Ø«Ø§Ù†ÙˆÙŠ) */
        .secondary-button {
            background-color: #4b5563;
        }
        .secondary-button:hover {
            background-color: #374151;
        }
        /* Ø²Ø± "ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø³Ù…ÙŠ" (Ø£Ø®Ø¶Ø±) */
        .confirm-button {
            background-color: #166534; /* Ø£Ø®Ø¶Ø± Ø¯Ø§ÙƒÙ† */
            flex-grow: 2; /* ÙŠØ£Ø®Ø° Ù…Ø³Ø§Ø­Ø© Ø£ÙƒØ¨Ø± */
        }
        .confirm-button:hover {
            background-color: #15803d;
        }
        
        /* --- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†ØªÙŠØ¬Ø© (Ø¨ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±) --- */
        .feedback-box {
            flex: 1.5;
            text-align: center;
            font-weight: 700;
            padding: 0.6rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
        }
        .feedback-box.correct {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #86efac;
        }
        .feedback-box.incorrect {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        /* --- Ø¹Ù†Ø§ØµØ± Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª --- */
        .timer-display {
            background-color: #e0e7ff;
            color: #3730a3;
            border-radius: 0.5rem;
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
            font-weight: 700;
            text-align: center;
        }
        #total-timer {
            background-color: #ede9fe;
            color: #5b21b6;
            padding: 0.5rem 1rem;
            border-radius: 99px;
            margin-bottom: 0.75rem;
            display: inline-block;
        }

        /* --- NEW: Ø­Ø§ÙˆÙŠØ© Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ù†Ù‚Ø§Ø· --- */
        .stats-container {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        /* --- NEW: Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· --- */
        #total-points-display {
            background-color: #eef2ff;
            color: #4338ca;
            padding: 0.5rem 1rem;
            border-radius: 99px;
            font-size: 0.9rem;
            font-weight: 700;
        }
        .category-score {
            position: absolute;
            bottom: 5px;
            left: 10px; /* ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„ÙŠØ³Ø§Ø± */
            font-size: 0.9rem;
            font-weight: 800;
            color: #444;
        }
        .invisible {
            visibility: hidden;
            opacity: 0;
        }

        /* --- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) Ù„Ù„Ø´Ø±Ø­ --- */
        #modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 40;
            display: none;
        }
        #modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            width: 90%;
            max-width: 360px;
            z-index: 50;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            display: none;
        }
        #modal-close {
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            background-color: #f3f4f6;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .category-item.completed::after {
            content: 'âœ“';
            position: absolute;
            top: 5px;
            right: 10px; /* Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØµØ­ ØªØ¨Ù‚Ù‰ ÙŠÙ…ÙŠÙ† */
            font-size: 1.5rem;
            font-weight: bold;
            color: #6b7280;
        }
        #modal-close:hover {
            background-color: #e5e7eb;
        }

    </style>
</head>
<body class="bg-gray-200">

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (ØªØ­Ù…ÙŠÙ„ ÙˆØªØ¹Ù„ÙŠÙ…Ø§Øª) -->
    <div id="loading-screen">
        <div id="loading-spinner"></div>
        <p id="loading-text" class="text-lg font-semibold mb-4">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ©...</p>
        
        <div id="welcome-content">
            <!-- NEW: Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
            <h1 class="text-3xl font-bold mb-4">ØªØ­Ø¯ÙŠ Ø§Ù„Ø¯Ù‚Ø©</h1>
            <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„ØªÙŠ ÙŠØªÙ… ØªØ®ØµÙŠØµÙ‡Ø§ -->
            <p id="welcomeMessage" class="text-base mb-4">
                <!-- NEW: Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
                Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ "ØªØ­Ø¯ÙŠ Ø§Ù„Ø¯Ù‚Ø©"! Ù…Ù‡Ù…ØªÙƒ Ù‡ÙŠ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ† ÙÙŠ Ø¶Ø¨Ø· Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø­Ù„ 5 ØªØ­Ø¯ÙŠØ§Øª. ÙƒÙ„ ØªØ­Ø¯ÙŠ ÙŠØªÙƒÙˆÙ† Ù…Ù† Ù…Ø±Ø­Ù„ØªÙŠÙ†: Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©ØŒ Ø«Ù… ØªÙ…Ø«ÙŠÙ„Ù‡Ø§ Ø¹Ù„Ù‰ Ø®Ø· Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯.
            </p>
            <p class="text-sm text-gray-300 mb-6">
                ÙÙƒØ±Ø© ÙˆØªØµÙ…ÙŠÙ…: Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ø¨Ù„Ø§Ù†
            </p>
            <button id="start-button" class="cta-button confirm-button px-8 py-3 text-lg">
                Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©!
            </button>
        </div>
    </div>

    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŒ Ø§Ù„Ø³Ø¤Ø§Ù„ØŒ Ø§Ù„Ø±Ø³Ù…ØŒ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©) -->
    <div id="game-container" class="game-container hidden">

        <!-- 1. Ø´Ø§Ø´Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div id="main-screen">
            <!-- NEW: Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
            <h1 class="text-2xl font-bold text-center mb-1 text-gray-800">ØªØ­Ø¯ÙŠ Ø§Ù„Ø¯Ù‚Ø©</h1>
            <p class="text-center text-gray-600 mb-3">Ø§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ù„ØªØ¨Ø¯Ø£</p>
            
            <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ù…ØªÙˆÙ‚Ù Ù‡Ù†Ø§) -->
            <div class="stats-container">
                <div id="total-timer">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: Ù  Ø«Ø§Ù†ÙŠØ©</div>
                <!-- NEW: Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© -->
                <div id="total-points-display">Ø§Ù„Ù†Ù‚Ø§Ø·: Ù  / Ù¡Ù </div>
            </div>

            <div class="category-grid">
                <!-- NEW: Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© -->
                <div class="category-item" data-category="gear">âš™ï¸</div>
                <div class="category-item" data-category="robot">ğŸ¤–</div>
                <div class="category-item" data-category="rocket">ğŸš€</div>
                <div class="category-item" data-category="power">âš¡</div>
                <div class="category-item" data-category="data">ğŸ“¡</div>
            </div>
        </div>

        <!-- 2. Ø´Ø§Ø´Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰) -->
        <div id="question-screen">
            <!-- Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© -->
            <div id="question-watermark"></div>
            
            <!-- Ø¥Ø·Ø§Ø± Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ -->
            <div class="question-text-frame">
                <p id="question-context" class="text-gray-700 mb-2"></p>
                <p id="question-text" class="text-lg font-semibold text-gray-900"></p>
            </div>

            <div id="options-container" class="options-grid">
                <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¹Ø¨Ø± JS -->
            </div>
            
            <div class="bottom-bar">
                <button id="q-explain-button" class="cta-button secondary-button invisible">Ø§Ø¹Ø±Ù Ù„Ù…Ø§Ø°Ø§ØŸ</button>
                
                <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª (ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§) Ø£Ùˆ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
                <div id="question-timer" class="timer-display">Ø§Ù„ÙˆÙ‚Øª: Ù  Ø«</div>
                <div id="q-feedback-box" class="feedback-box"></div>
                
                <button id="q-next-button" class="cta-button" disabled>Ø§Ù„ØªØ§Ù„ÙŠ</button>
            </div>
        </div>

        <!-- 3. Ø´Ø§Ø´Ø© Ø®Ø· Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ (Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©) -->
        <div id="graph-screen">
            
            <!-- Ø¥Ø·Ø§Ø± Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©) -->
            <div class="graph-text-frame">
                <p id="graph-correct-answer" class="text-center font-bold text-lg mb-2"></p>
                <p class="text-base font-semibold text-gray-900 text-center">Ø§Ù„Ø¢Ù†ØŒ Ù‚Ù… Ø¨ØªÙ…Ø«ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø¹Ù„Ù‰ Ø®Ø· Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯:</p>
            </div>

            <div class="number-line-container">
                <div class="number-line-track"></div>
                <div id="number-line-points-container" class="number-line-points">
                    <!-- Ø§Ù„Ù†Ù‚Ø§Ø· ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¹Ø¨Ø± JS -->
                </div>
            </div>

            <div class="flex justify-center mb-2">
                <div id="graph-timer" class="timer-display hidden">Ø§Ù„ÙˆÙ‚Øª: Ù  Ø«</div>
            </div>

            <button id="g-check-button" class="cta-button confirm-button w-full">ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø³Ù…ÙŠ</button>

            <div class="bottom-bar hidden" id="g-bottom-bar">
                <button id="g-explain-button" class="cta-button secondary-button">Ø§Ø¹Ø±Ù Ù„Ù…Ø§Ø°Ø§ØŸ</button>
                <div id="g-feedback-box" class="feedback-box"></div>
                <button id="g-back-button" class="cta-button">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            </div>
        </div>

        <!-- 4. Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„) -->
        <div id="finish-screen">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">Ø£Ø­Ø³Ù†Øª! Ø£Ù†Ù‡ÙŠØª Ø§Ù„ØªØ­Ø¯ÙŠ</h1>
            
            <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->
            <div id="final-result-display" class="mb-6">
                <!-- ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© saveAndFinishGame -->
            </div>

            <!-- Ø­Ø§ÙˆÙŠØ© Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ -->
            <div id="leaderboard-loader" class="text-center">
                <div class="inline-block border-4 border-gray-300 border-t-blue-500 rounded-full w-10 h-10 animate-spin"></div>
                <p class="mt-2 text-gray-600">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„...</p>
            </div>
            <div id="leaderboard-container">
                <!-- ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© fetchAndShowLeaderboard -->
            </div>

            <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†ØµØ© -->
            <div id="finish-game-wrapper">
                <button id="finish-game-btn" class="cta-button confirm-button w-full text-lg py-3">
                    Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©
                </button>
            </div>
        </div>

    </div>

    <!-- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) Ù„Ù„Ø´Ø±Ø­ -->
    <div id="modal-backdrop"></div>
    <div id="modal">
        <div id="modal-close">âœ•</div>
        <h2 class="text-2xl font-bold text-center mb-4 text-blue-800">Ø§Ù„Ø´Ø±Ø­</h2>
        <p id="modal-explanation" class="text-gray-700 text-center"></p>
    </div>


    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ---
        const gameContainer = document.getElementById('game-container');
        const loadingScreen = document.getElementById('loading-screen');
        const mainScreen = document.getElementById('main-screen');
        const questionScreen = document.getElementById('question-screen');
        const graphScreen = document.getElementById('graph-screen');
        const finishScreen = document.getElementById('finish-screen');
        
        const qWatermark = document.getElementById('question-watermark');
        const qContext = document.getElementById('question-context');
        const qText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const qNextButton = document.getElementById('q-next-button');
        const qExplainButton = document.getElementById('q-explain-button');
        const qFeedbackBox = document.getElementById('q-feedback-box');
        const qTimerDisplay = document.getElementById('question-timer');

        const gCheckButton = document.getElementById('g-check-button');
        const gBottomBar = document.getElementById('g-bottom-bar');
        const gFeedbackBox = document.getElementById('g-feedback-box');
        const gExplainButton = document.getElementById('g-explain-button');
        const gBackButton = document.getElementById('g-back-button');
        const gGraphAnswer = document.getElementById('graph-correct-answer');
        const gPointsContainer = document.getElementById('number-line-points-container');
        const gTimerDisplay = document.getElementById('graph-timer');

        const totalTimerDisplay = document.getElementById('total-timer');
        
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modal = document.getElementById('modal');
        const modalExplanation = document.getElementById('modal-explanation');
        const modalClose = document.getElementById('modal-close');

        // --- NEW: Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø©) ---
        // --- ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¥Ù„Ù‰ Ø£Ø¹Ø¯Ø§Ø¯ ØµØ­ÙŠØ­Ø© ---
        const questionBank = {
            'gear': [ // âš™ï¸
                { 
                    context: "ÙÙŠ Ù‚Ø³Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©ØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø·Ø± (Ø³) Ø¥Ø­Ø¯Ù‰ Ø§Ù„ØªØ±ÙˆØ³ 50 Ù…Ù…ØŒ Ø¨Ù‡Ø§Ù…Ø´ Ø®Ø·Ø£ (tolerance) Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 1 Ù…Ù….", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø§Ù„Ù‚Ø·Ø± Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ Ù‡ÙŠ:", 
                    answer: "|Ø³ - 50| â‰¤ 1", 
                    options: ["|Ø³ - 50| â‰¤ 1", "|Ø³ - 50| â‰¥ 1", "|Ø³ - 1| â‰¤ 50", "|Ø³ + 50| â‰¤ 1"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² (c) Ù‡Ùˆ 50. Ù‡Ø§Ù…Ø´ Ø§Ù„Ø®Ø·Ø£ Ø£Ùˆ Ø§Ù„Ù…Ø³Ø§ÙØ© (d) Ù‡Ùˆ 1. 'Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ²' ØªØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ù…Ø³Ø§ÙØ© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ØµØºØ± Ù…Ù† Ø£Ùˆ ØªØ³Ø§ÙˆÙŠ Ù‡Ø§Ù…Ø´ Ø§Ù„Ø®Ø·Ø£. Ø§Ù„ØµÙŠØºØ© Ù‡ÙŠ |Ø³ - c| â‰¤ d.", 
                    graph: { type: 'and', points: [{ v: 49, c: true }, { v: 51, c: true }] } 
                },
                { 
                    context: "ÙŠØªÙ… ØªØµÙ†ÙŠØ¹ Ù…Ø³Ù…Ø§Ø± (Ø³) Ø¨Ø·ÙˆÙ„ Ù…Ø«Ø§Ù„ÙŠ 30 Ù…Ù…ØŒ ÙˆØ¨Ù‡Ø§Ù…Ø´ Ø®Ø·Ø£ Ù…Ø³Ù…ÙˆØ­ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 1 Ù…Ù….", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ Ù‡ÙŠ:", 
                    answer: "|Ø³ - 30| â‰¤ 1", 
                    options: ["|Ø³ - 30| < 1", "|Ø³ - 30| â‰¥ 1", "|Ø³ - 30| â‰¤ 1", "|Ø³ + 30| â‰¤ 1"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 30. Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© (Ù‡Ø§Ù…Ø´ Ø§Ù„Ø®Ø·Ø£) Ù‡ÙŠ 1. 'Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ²' ØªØ¹Ù†ÙŠ â‰¤. Ø§Ù„ØµÙŠØºØ© Ù‡ÙŠ |Ø³ - 30| â‰¤ 1.", 
                    graph: { type: 'and', points: [{ v: 29, c: true }, { v: 31, c: true }] } 
                },
                { 
                    context: "ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø³ÙÙ…Ùƒ (Ø³) Ø´Ø±ÙŠØ­Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© 10 Ù…Ù…ØŒ Ø¨Ù‡Ø§Ù…Ø´ Ø®Ø·Ø£ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 1 Ù…Ù….", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø§Ù„Ø³ÙÙ…Ùƒ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ Ù‡ÙŠ:", 
                    answer: "|Ø³ - 10| â‰¤ 1", 
                    options: ["|Ø³ - 10| â‰¤ 1", "|Ø³ - 1| â‰¤ 10", "|Ø³ - 10| > 1", "|Ø³ + 10| â‰¤ 1"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 10. Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© (Ù‡Ø§Ù…Ø´ Ø§Ù„Ø®Ø·Ø£) Ù‡ÙŠ 1. 'Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ²' ØªØ¹Ù†ÙŠ â‰¤. Ø§Ù„ØµÙŠØºØ© Ù‡ÙŠ |Ø³ - 10| â‰¤ 1.", 
                    graph: { type: 'and', points: [{ v: 9, c: true }, { v: 11, c: true }] } 
                }
            ],
            'robot': [ // ğŸ¤–
                { 
                    context: "Ø°Ø±Ø§Ø¹ Ø¢Ù„ÙŠ ÙŠÙ„ØªÙ‚Ø· Ø£Ø¬Ø²Ø§Ø¡. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…ÙˆÙ‚Ø¹Ù‡ (Ø³) Ø¶Ù…Ù† 1 Ù…Ù… *ØªÙ…Ø§Ù…Ø§Ù‹* Ù…Ù† Ù‡Ø¯ÙÙ‡ (120 Ù…Ù…) ÙˆØ¥Ù„Ø§ Ø³ÙŠÙØ´Ù„.", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØµØ­ÙŠØ­ Ù‡ÙŠ:", 
                    answer: "|Ø³ - 120| < 1", 
                    options: ["|Ø³ - 120| < 1", "|Ø³ - 120| â‰¤ 1", "|Ø³ - 1| < 120", "|Ø³ + 120| < 1"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 120. Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© 1. ÙƒÙ„Ù…Ø© 'Ø¶Ù…Ù† ØªÙ…Ø§Ù…Ø§Ù‹' ØªØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ù…Ø³Ø§ÙØ© |Ø³ - 120| ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† *Ø£Ù‚Ù„ Ù…Ù†* 1 (Ø§Ù„Ø£Ø·Ø±Ø§Ù ØºÙŠØ± Ù…Ø´Ù…ÙˆÙ„Ø©).", 
                    graph: { type: 'and', points: [{ v: 119, c: false }, { v: 121, c: false }] } 
                },
                { 
                    context: "ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­Ø§ÙØ¸ Ø±ÙˆØ¨ÙˆØª Ù„Ø­Ø§Ù… Ø¹Ù„Ù‰ Ù…Ø³Ø§ÙØ© (Ø³) Ø¹Ù† Ø§Ù„Ù‚Ø·Ø¹Ø©. Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© 200 Ù…Ù…ØŒ ÙˆÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø®Ø·Ø£ *Ø£Ù‚Ù„ ØªÙ…Ø§Ù…Ø§Ù‹* Ù…Ù† 1 Ù…Ù….", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ:", 
                    answer: "|Ø³ - 200| < 1", 
                    options: ["|Ø³ - 200| â‰¤ 1", "|Ø³ - 200| < 1", "|Ø³ - 1| < 200", "|Ø³ + 200| < 1"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 200. Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© 1. 'Ø£Ù‚Ù„ ØªÙ…Ø§Ù…Ø§Ù‹' ØªØ¹Ù†ÙŠ <. Ø§Ù„ØµÙŠØºØ© Ù‡ÙŠ |Ø³ - 200| < 1.", 
                    graph: { type: 'and', points: [{ v: 199, c: false }, { v: 201, c: false }] } 
                },
                { 
                    context: "ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙˆÙ‚Ù Ø±ÙˆØ¨ÙˆØª (Ø³) Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø·Ø© 50. ÙŠØ¹ØªØ¨Ø± Ø§Ù„ØªÙˆÙ‚Ù Ù†Ø§Ø¬Ø­Ø§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙˆÙ‚Ù *Ø£Ù‚Ù„ ØªÙ…Ø§Ù…Ø§Ù‹* Ù…Ù† 1 Ù…Ù….", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø§Ù„ØªÙˆÙ‚Ù Ø§Ù„Ù†Ø§Ø¬Ø­ Ù‡ÙŠ:", 
                    answer: "|Ø³ - 50| < 1", 
                    options: ["|Ø³ - 50| < 1", "|Ø³ - 50| â‰¤ 1", "|Ø³ - 1| < 50", "|Ø³ + 50| < 1"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 50. Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø© 1. 'Ø£Ù‚Ù„ ØªÙ…Ø§Ù…Ø§Ù‹' ØªØ¹Ù†ÙŠ <. Ø§Ù„ØµÙŠØºØ© Ù‡ÙŠ |Ø³ - 50| < 1.", 
                    graph: { type: 'and', points: [{ v: 49, c: false }, { v: 51, c: false }] } 
                }
            ],
            'rocket': [ // ğŸš€
                { 
                    context: "Ø¶ØºØ· ÙˆÙ‚ÙˆØ¯ Ø§Ù„ØµØ§Ø±ÙˆØ® (Ø³) ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 100 ÙˆØ­Ø¯Ø©. ÙŠÙ†Ø·Ù„Ù‚ Ø§Ù„Ø¥Ù†Ø°Ø§Ø± Ø¥Ø°Ø§ Ø²Ø§Ø¯ Ø£Ùˆ Ù†Ù‚Øµ Ø§Ù„Ø¶ØºØ· Ø¹Ù† 100 Ø¨Ù…Ù‚Ø¯Ø§Ø± *ÙŠØ³Ø§ÙˆÙŠ Ø£Ùˆ ÙŠØ²ÙŠØ¯ Ø¹Ù†* 5 ÙˆØ­Ø¯Ø§Øª.", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù†Ø°Ø§Ø± (Ø§Ù„Ø®Ø·Ø±) Ù‡ÙŠ:", 
                    answer: "|Ø³ - 100| â‰¥ 5", 
                    options: ["|Ø³ - 100| â‰¥ 5", "|Ø³ - 100| < 5", "|Ø³ - 5| â‰¥ 100", "|Ø³ + 100| â‰¥ 5"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 100. Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¹Ù† Ø§Ù„Ù…Ø±ÙƒØ² Ù‡ÙŠ |Ø³ - 100|. Ø§Ù„Ø¥Ù†Ø°Ø§Ø± ÙŠØ¹Ù…Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§ÙØ© (Ø§Ù„Ø®Ø·Ø£) 'ØªØ³Ø§ÙˆÙŠ Ø£Ùˆ ØªØ²ÙŠØ¯ Ø¹Ù†' 5. Ù‡Ø°Ø§ ØªÙ…Ø«ÙŠÙ„ (Ø£Ùˆ).", 
                    graph: { type: 'or', points: [{ v: 95, c: true }, { v: 105, c: true }] } 
                },
                { 
                    context: "ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙˆØ²Ù† (Ø³) Ù‚Ù…Ø± ØµÙ†Ø§Ø¹ÙŠ 300 ÙƒØ¬Ù…. ÙŠØªÙ… Ø±ÙØ¶Ù‡ Ø¥Ø°Ø§ Ø§Ø®ØªÙ„Ù Ø§Ù„ÙˆØ²Ù† Ø¨Ù…Ù‚Ø¯Ø§Ø± *ÙŠØ³Ø§ÙˆÙŠ Ø£Ùˆ ÙŠØ²ÙŠØ¯ Ø¹Ù†* 2 ÙƒØ¬Ù….", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…Ø±ÙÙˆØ¶ Ù‡ÙŠ:", 
                    answer: "|Ø³ - 300| â‰¥ 2", 
                    options: ["|Ø³ - 300| < 2", "|Ø³ - 300| â‰¥ 2", "|Ø³ - 2| â‰¥ 300", "|Ø³ + 300| â‰¥ 2"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 300. Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù (Ø§Ù„Ù…Ø³Ø§ÙØ©) Ù‡Ùˆ |Ø³ - 300|. ÙŠØªÙ… Ø§Ù„Ø±ÙØ¶ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø³Ø§ÙØ© 2 'Ø£Ùˆ Ø£ÙƒØ«Ø±'ØŒ Ø£ÙŠ â‰¥ 2.", 
                    graph: { type: 'or', points: [{ v: 298, c: true }, { v: 302, c: true }] } 
                },
                { 
                    context: "Ø³Ø±Ø¹Ø© ØµØ§Ø±ÙˆØ® (Ø³) Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù‡ÙŠ 800. ÙŠÙØ´Ù„ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ Ø¥Ø°Ø§ Ø§Ù†Ø­Ø±ÙØª Ø§Ù„Ø³Ø±Ø¹Ø© Ø¨Ù…Ù‚Ø¯Ø§Ø± *ÙŠØ³Ø§ÙˆÙŠ Ø£Ùˆ ÙŠØ²ÙŠØ¯ Ø¹Ù†* 50.", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø³Ø±Ø¹Ø© Ø§Ù„ÙØ´Ù„ Ù‡ÙŠ:", 
                    answer: "|Ø³ - 800| â‰¥ 50", 
                    options: ["|Ø³ - 800| â‰¥ 50", "|Ø³ - 800| < 50", "|Ø³ - 50| â‰¥ 800", "|Ø³ + 800| â‰¥ 50"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 800. Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù (Ø§Ù„Ù…Ø³Ø§ÙØ©) Ù‡Ùˆ |Ø³ - 800|. Ø§Ù„ÙØ´Ù„ ÙŠØ­Ø¯Ø« Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø³Ø§ÙØ© 50 'Ø£Ùˆ Ø£ÙƒØ«Ø±'ØŒ Ø£ÙŠ â‰¥ 50.", 
                    graph: { type: 'or', points: [{ v: 750, c: true }, { v: 850, c: true }] } 
                }
            ],
            'power': [ // âš¡
                { 
                    context: "Ø§Ù„Ø¬Ù‡Ø¯ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ (Ø³) ÙÙŠ Ù…Ø®ØªØ¨Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 220 ÙÙˆÙ„Øª. ÙŠØ¹Ù…Ù„ Ø¥Ù†Ø°Ø§Ø± Ø§Ù„Ø£Ù…Ø§Ù† Ø¥Ø°Ø§ Ø§Ø®ØªÙ„Ù Ø§Ù„Ø¬Ù‡Ø¯ Ø¨Ù…Ù‚Ø¯Ø§Ø± *Ø£ÙƒØ«Ø± Ù…Ù†* 5 ÙÙˆÙ„Øª.", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù†Ø°Ø§Ø± Ù‡ÙŠ:", 
                    answer: "|Ø³ - 220| > 5", 
                    options: ["|Ø³ - 220| < 5", "|Ø³ - 220| â‰¤ 5", "|Ø³ - 220| > 5", "|Ø³ - 5| > 220"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 220. Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù (Ø§Ù„Ù…Ø³Ø§ÙØ©) Ù‡Ùˆ |Ø³ - 220|. Ø§Ù„Ø¥Ù†Ø°Ø§Ø± ÙŠØ¹Ù…Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø³Ø§ÙØ© 'Ø£ÙƒØ«Ø± Ù…Ù†' 5ØŒ Ø£ÙŠ > 5. Ù‡Ø°Ø§ ØªÙ…Ø«ÙŠÙ„ (Ø£Ùˆ).", 
                    graph: { type: 'or', points: [{ v: 215, c: false }, { v: 225, c: false }] } 
                },
                { 
                    context: "Ø§Ù„Ø¬Ù‡Ø¯ (Ø³) ÙÙŠ Ø´Ø§Ø­Ù† ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 12 ÙÙˆÙ„Øª. ÙŠØ¹ØªØ¨Ø± Ø§Ù„Ø´Ø§Ø­Ù† ØªØ§Ù„ÙØ§Ù‹ Ø¥Ø°Ø§ Ø§Ø®ØªÙ„Ù Ø§Ù„Ø¬Ù‡Ø¯ Ø¨Ù…Ù‚Ø¯Ø§Ø± *Ø£ÙƒØ«Ø± Ù…Ù†* 1 ÙÙˆÙ„Øª.", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø§Ù„Ø´Ø§Ø­Ù† Ø§Ù„ØªØ§Ù„Ù Ù‡ÙŠ:", 
                    answer: "|Ø³ - 12| > 1", 
                    options: ["|Ø³ - 12| > 1", "|Ø³ - 12| < 1", "|Ø³ - 1| > 12", "|Ø³ + 12| > 1"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 12. Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù (Ø§Ù„Ù…Ø³Ø§ÙØ©) Ù‡Ùˆ |Ø³ - 12|. 'ØªØ§Ù„Ù' Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø³Ø§ÙØ© 'Ø£ÙƒØ«Ø± Ù…Ù†' 1ØŒ Ø£ÙŠ > 1.", 
                    graph: { type: 'or', points: [{ v: 11, c: false }, { v: 13, c: false }] } 
                },
                { 
                    context: "Ù…ØµØ¯Ø± Ø·Ø§Ù‚Ø© (Ø³) Ù‚ÙŠÙ…ØªÙ‡ 110 ÙÙˆÙ„Øª. ÙŠØ¹ØªØ¨Ø± *Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚* Ø¥Ø°Ø§ Ø§Ø®ØªÙ„Ù Ø¨Ù…Ù‚Ø¯Ø§Ø± *Ø£ÙƒØ«Ø± Ù…Ù†* 3 ÙÙˆÙ„Øª.", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø§Ù„Ø¬Ù‡Ø¯ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚ Ù‡ÙŠ:", 
                    answer: "|Ø³ - 110| > 3", 
                    options: ["|Ø³ - 110| < 3", "|Ø³ - 110| â‰¤ 3", "|Ø³ - 110| > 3", "|Ø³ - 3| > 110"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 110. Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù (Ø§Ù„Ù…Ø³Ø§ÙØ©) Ù‡Ùˆ |Ø³ - 110|. 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚' Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø³Ø§ÙØ© 'Ø£ÙƒØ«Ø± Ù…Ù†' 3ØŒ Ø£ÙŠ > 3.", 
                    graph: { type: 'or', points: [{ v: 107, c: false }, { v: 113, c: false }] } 
                }
            ],
            'data': [ // ğŸ“¡
                { 
                    context: "ØªØ±Ø¯Ø¯ Ø¥Ø´Ø§Ø±Ø© Ù‚Ù…Ø± ØµÙ†Ø§Ø¹ÙŠ (Ø³) ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 12 Ø¬ÙŠØ¬Ø§Ù‡Ø±ØªØ²ØŒ Ø¨Ø§Ù†Ø­Ø±Ø§Ù Ù…Ù‚Ø¨ÙˆÙ„ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 1 Ø¬ÙŠØ¬Ø§Ù‡Ø±ØªØ².", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø§Ù„ØªØ±Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ Ù‡ÙŠ:", 
                    answer: "|Ø³ - 12| â‰¤ 1", 
                    options: ["|Ø³ - 12| â‰¥ 1", "|Ø³ - 12| â‰¤ 1", "|Ø³ - 1| â‰¤ 12", "|Ø³ + 12| â‰¤ 1"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 12. Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù (Ø§Ù„Ù…Ø³Ø§ÙØ©) Ù‡Ùˆ |Ø³ - 12|. Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ 'Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ²' 1ØŒ Ø£ÙŠ â‰¤ 1.", 
                    graph: { type: 'and', points: [{ v: 11, c: true }, { v: 13, c: true }] } 
                },
                { 
                    context: "Ø³Ø±Ø¹Ø© Ù†Ù‚Ù„ Ø¨ÙŠØ§Ù†Ø§Øª (Ø³) ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 80 Ù…ÙŠØ¬Ø§Ø¨Øª/Ø«Ø§Ù†ÙŠØ©ØŒ Ø¨Ù‡Ø§Ù…Ø´ Ø®Ø·Ø£ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 2 Ù…ÙŠØ¬Ø§Ø¨Øª/Ø«Ø§Ù†ÙŠØ©.", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø© Ù‡ÙŠ:", 
                    answer: "|Ø³ - 80| â‰¤ 2", 
                    options: ["|Ø³ - 80| â‰¤ 2", "|Ø³ - 80| > 2", "|Ø³ - 2| â‰¤ 80", "|Ø³ + 80| â‰¤ 2"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 80. Ù‡Ø§Ù…Ø´ Ø§Ù„Ø®Ø·Ø£ (Ø§Ù„Ù…Ø³Ø§ÙØ©) Ù‡Ùˆ 2. 'Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ²' ØªØ¹Ù†ÙŠ â‰¤. Ø§Ù„ØµÙŠØºØ© Ù‡ÙŠ |Ø³ - 80| â‰¤ 2.", 
                    graph: { type: 'and', points: [{ v: 78, c: true }, { v: 82, c: true }] } 
                },
                { 
                    context: "Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© (Ø³) Ù„Ø®Ø§Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 20 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©ØŒ Ø¨Ù‡Ø§Ù…Ø´ Ø®Ø·Ø£ Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² 3 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©.", 
                    text: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØµÙ Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ Ù‡ÙŠ:", 
                    answer: "|Ø³ - 20| â‰¤ 3", 
                    options: ["|Ø³ - 20| < 3", "|Ø³ - 20| â‰¤ 3", "|Ø³ - 3| â‰¤ 20", "|Ø³ + 20| â‰¤ 3"], 
                    explanation: "Ø§Ù„Ù…Ø±ÙƒØ² Ù‡Ùˆ 20. Ù‡Ø§Ù…Ø´ Ø§Ù„Ø®Ø·Ø£ (Ø§Ù„Ù…Ø³Ø§ÙØ©) Ù‡Ùˆ 3. 'Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ²' ØªØ¹Ù†ÙŠ â‰¤. Ø§Ù„ØµÙŠØºØ© Ù‡ÙŠ |Ø³ - 20| â‰¤ 3.", 
                    graph: { type: 'and', points: [{ v: 17, c: true }, { v: 23, c: true }] } 
                }
            ]
        };
        // --- Ù†Ù‡Ø§ÙŠØ© Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ---

        // --- Ù…ØªØºÙŠØ±Ø§Øª Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ---
        let currentQuestion = null;
        let selectedOption = null;
        let questionAnswered = false;
        let graphAnswered = false;
        let categoryTimerInterval = null;
        let categorySeconds = 0;
        let totalSeconds = 0;
        let completedCategories = []; // Ù„ØªØªØ¨Ø¹ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
        // --- NEW: ØªØªØ¨Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ ÙØ¦Ø© ---
        let categoryPoints = {'gear': 0, 'robot': 0, 'rocket': 0, 'power': 0, 'data': 0};
        // Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙŠ ØªÙ… Ø¹Ø±Ø¶Ù‡Ø§ Ù…Ù† ÙƒÙ„ ÙØ¦Ø©
        let shownQuestions = { 'gear': [], 'robot': [], 'rocket': [], 'power': [], 'data': [] };
        // Ù„ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø®Ø· Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯
        let numberLineState = {};
        // Ù„ØªØªØ¨Ø¹ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø©
        let backTimerInterval = null;
        let backTimerSeconds = 0;

        // --- 1. Ø¢Ù„ÙŠØ© Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ ---
        // NEW: Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø©
        const backgroundUrl = 'https://ablan-math.github.io/img/g4/g4_5_2.png'; 
        
        function preloadBackground() {
            const img = new Image();
            img.src = backgroundUrl;
            img.onload = () => {
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®Ù„ÙÙŠØ©
                document.body.style.backgroundImage = `url(${backgroundUrl})`;
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙˆØ²Ø± Ø§Ù„Ø¨Ø¯Ø¡
                document.getElementById('loading-text').style.display = 'none';
                document.getElementById('loading-spinner').style.display = 'none';
                document.getElementById('welcome-content').style.display = 'block';
                document.getElementById('start-button').style.display = 'block';
            };
            img.onerror = () => {
                // ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ©
                document.body.style.backgroundColor = '#2c3e50'; // Ù„ÙˆÙ† Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                document.getElementById('loading-text').textContent = "ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ©. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡.";
                document.getElementById('welcome-content').style.display = 'block';
                document.getElementById('start-button').style.display = 'block';
            };
        }

        document.getElementById('start-button').addEventListener('click', () => {
            loadingScreen.style.display = 'none';
            gameContainer.style.display = 'block';
        });

        // --- 2. Ø¢Ù„ÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ---
        function showMainScreen() {
            mainScreen.style.display = 'block';
            questionScreen.style.display = 'none';
            graphScreen.style.display = 'none';
            finishScreen.style.display = 'none';

            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ù…ØªÙˆÙ‚Ù)
            stopTotalTimer();
            totalTimerDisplay.textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${toArabicNumerals(totalSeconds)} Ø«Ø§Ù†ÙŠØ©`;

            // --- NEW: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© ---
            const currentTotalPoints = Object.values(categoryPoints).reduce((a, b) => a + b, 0);
            document.getElementById('total-points-display').textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${toArabicNumerals(currentTotalPoints)} / ${toArabicNumerals(10)}`;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
            document.querySelectorAll('.category-item').forEach(item => {
                const category = item.dataset.category;
                
                // --- NEW: Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· ---
                let scoreDisplay = item.querySelector('.category-score');
                if (!scoreDisplay) {
                    scoreDisplay = document.createElement('div');
                    scoreDisplay.className = 'category-score';
                    item.appendChild(scoreDisplay);
                }

                if (completedCategories.includes(category)) {
                    item.classList.add('completed');
                    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
                    scoreDisplay.textContent = `${toArabicNumerals(categoryPoints[category])} / ${toArabicNumerals(2)}`;
                } else {
                    scoreDisplay.textContent = ''; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ø°Ø§ Ù„Ù… ØªÙƒØªÙ…Ù„
                }
            });

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‚Ø¯ Ø§ÙƒØªÙ…Ù„Øª
            if (completedCategories.length === 5) {
                showFinishScreen();
            }
        }

        document.querySelectorAll('.category-item').forEach(item => {
            item.addEventListener('click', () => {
                const category = item.dataset.category;
                if (completedCategories.includes(category)) return;
                
                // Ø§Ø®ØªÙŠØ§Ø± Ø³Ø¤Ø§Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù… ÙŠØªÙ… Ø¹Ø±Ø¶Ù‡ Ù…Ù† Ù‚Ø¨Ù„
                let availableQuestions = questionBank[category].filter((_, index) => !shownQuestions[category].includes(index));
                if (availableQuestions.length === 0) {
                    // Ø¥Ø°Ø§ ØªÙ… Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©ØŒ Ø£Ø¹Ø¯ ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                    shownQuestions[category] = [];
                    availableQuestions = questionBank[category];
                }
                const questionIndex = questionBank[category].indexOf(availableQuestions[Math.floor(Math.random() * availableQuestions.length)]);
                shownQuestions[category].push(questionIndex);
                
                currentQuestion = questionBank[category][questionIndex];
                currentQuestion.category = category; // Ø­ÙØ¸ Ø§Ù„ÙØ¦Ø© Ù„Ù„Ø¹ÙˆØ¯Ø©
                loadQuestion(currentQuestion);
            });
        });

        // --- 3. Ø¢Ù„ÙŠØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø§Ù„Ø³Ø¤Ø§Ù„) ---
        function loadQuestion(question) {
            mainScreen.style.display = 'none';
            questionScreen.style.display = 'block';
            
            qWatermark.textContent = document.querySelector(`.category-item[data-category="${question.category}"]`).textContent;
            // NEW: ØªØ·Ø¨ÙŠÙ‚ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
            qContext.textContent = toArabicNumerals(question.context);
            qText.textContent = toArabicNumerals(question.text);
            
            optionsContainer.innerHTML = '';
            question.options.forEach((optionText, index) => {
                const optionButton = document.createElement('label');
                optionButton.className = 'option-button';
                
                // NEW: ØªØ·Ø¨ÙŠÙ‚ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
                const arabicOptionText = toArabicNumerals(optionText);
                
                // --- NEW: Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ³Ù… <bdi> Ù„Ø¹Ø²Ù„ Ø§Ù„Ù†Øµ ---
                optionButton.innerHTML = `
                    <input type="radio" name="option" value="${optionText}"> <!-- Ø§Ù„Ù‚ÙŠÙ…Ø© ØªØ¨Ù‚Ù‰ Ø£ØµÙ„ÙŠØ© Ù„Ù„Ø¨Ø±Ù…Ø¬Ø© -->
                    <span class="math-formula"><bdi>${arabicOptionText.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</bdi></span>
                `;
                optionButton.addEventListener('click', () => selectOption(optionButton, optionText));
                optionsContainer.appendChild(optionButton);
            });
            
            resetQuestionScreen();
            startTotalTimer(qTimerDisplay); // Ø¨Ø¯Ø¡/Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯
        }
        
        function selectOption(button, optionText) {
            if (questionAnswered) return;
            
            selectedOption = optionText;
            document.querySelectorAll('.option-button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            qNextButton.disabled = false;
            
            // --- ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© ---
            checkQuestionAnswer();
        }

        function checkQuestionAnswer() {
            if (questionAnswered) return;
            questionAnswered = true;
            stopTotalTimer(); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©

            const isCorrect = (selectedOption === currentQuestion.answer);
            
            // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.option-button').forEach(btn => {
                const btnValue = btn.querySelector('input').value;
                btn.classList.add('disabled'); // ØªØ¹Ø·ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                
                if (btnValue === currentQuestion.answer) {
                    btn.classList.add('correct'); // ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ø§Ù„Ø£Ø®Ø¶Ø±
                }
                if (btnValue === selectedOption && !isCorrect) {
                    btn.classList.add('incorrect'); // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ù…Ø®ØªØ§Ø± Ø§Ù„Ø®Ø·Ø£ Ø¨Ø§Ù„Ø£Ø­Ù…Ø±
                    btn.classList.remove('selected');
                }
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙˆØ§Ù„ÙˆÙ…ÙŠØ¶
            if (isCorrect) {
                qFeedbackBox.textContent = "Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! Ø£Ø­Ø³Ù†Øª.";
                qFeedbackBox.className = 'feedback-box correct';
                categoryPoints[currentQuestion.category] += 1; // Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ù„Ù„ÙØ¦Ø©
            } else {
                qFeedbackBox.textContent = "Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©.";
                qFeedbackBox.className = 'feedback-box incorrect';
                // ÙˆÙ…ÙŠØ¶ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
                document.querySelector('.option-button.correct')?.classList.add('flash');
            }

            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ
            qTimerDisplay.classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ø¯Ø§Ø¯
            qFeedbackBox.style.display = 'block'; // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø©
            qExplainButton.classList.remove('invisible'); // Ø¥Ø¸Ù‡Ø§Ø± "Ø§Ø¹Ø±Ù Ù„Ù…Ø§Ø°Ø§ØŸ"
            
            // Ø¨Ø¯Ø¡ Ø¹Ø¯Ø§Ø¯ "Ø§Ù„ØªØ§Ù„ÙŠ" (8 Ø«ÙˆØ§Ù†Ù)
            startBackTimer(qNextButton, 8, loadGraphScreen);
        }

        function resetQuestionScreen() {
            questionAnswered = false;
            selectedOption = null;
            qNextButton.disabled = true;
            qNextButton.textContent = "Ø§Ù„ØªØ§Ù„ÙŠ";
            qExplainButton.classList.add('invisible');
            qFeedbackBox.style.display = 'none';
            qTimerDisplay.classList.remove('hidden'); // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ø¯Ø§Ø¯
            stopBackTimer(); // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ø¹Ø¯Ø§Ø¯ Ø³Ø§Ø¨Ù‚
        }

        qNextButton.addEventListener('click', () => {
            if (questionAnswered) {
                stopBackTimer();
                loadGraphScreen();
            }
        });

        // --- 4. Ø¢Ù„ÙŠØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø®Ø· Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯) ---
        function loadGraphScreen() {
            questionScreen.style.display = 'none';
            graphScreen.style.display = 'block';
            
            // --- NEW: Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ³Ù… <bdi> Ù„Ø¹Ø²Ù„ Ø§Ù„Ù†Øµ ---
            gGraphAnswer.innerHTML = `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: <span class="math-formula"><bdi>${toArabicNumerals(currentQuestion.answer).replace(/</g, '&lt;').replace(/>/g, '&gt;')}</bdi></span>`;
            
            // Ø¨Ù†Ø§Ø¡ Ø®Ø· Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯
            buildNumberLine();
            
            resetGraphScreen();
            startTotalTimer(gTimerDisplay); // Ø¨Ø¯Ø¡/Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯
        }

        // Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… (ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ§ØµÙ„Ø© Ø§Ù„Ø¹Ø´Ø±ÙŠØ©)
        function toArabicNumerals(numStr) {
            const arabicNumerals = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
            return String(numStr)
                .replace(/[0-9]/g, (d) => arabicNumerals[d]);
        }

        function buildNumberLine() {
            gPointsContainer.innerHTML = '';
            numberLineState = {}; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©
            
            const points = currentQuestion.graph.points;
            
            points.forEach(point => {
                const pointValue = point.v;
                numberLineState[pointValue] = { state: 0, left: false, right: false }; // 0 = line, 1 = open, 2 = closed

                const pointEl = document.createElement('div');
                pointEl.className = 'number-line-point';
                pointEl.dataset.value = pointValue;
                
                pointEl.innerHTML = `
                    <div class="point-visual state-0">
                        <div class="point-line"></div>
                        <div class="point-circle hidden"></div>
                    </div>
                    <div class="arrow-controls">
                        <span class="arrow-control" data-dir="left">âŸ¨</span>
                        <span class="arrow-control" data-dir="right">âŸ©</span>
                    </div>
                    <div class="point-label">${toArabicNumerals(pointValue)}</div>
                    <div class="line-segment left"></div>
                    <div class="line-segment right"></div>
                `;
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                pointEl.querySelector('.point-visual').addEventListener('click', () => togglePointState(pointValue));
                pointEl.querySelectorAll('.arrow-control').forEach(ctrl => {
                    ctrl.addEventListener('click', (e) => {
                        e.stopPropagation(); // Ù…Ù†Ø¹ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø·Ø© Ù†ÙØ³Ù‡Ø§
                        toggleArrowState(pointValue, ctrl.dataset.dir);
                    });
                });
                
                gPointsContainer.appendChild(pointEl);
            });
        }

        function togglePointState(value) {
            if (graphAnswered) return;
            const state = numberLineState[value];
            state.state = (state.state + 1) % 3; // 0 -> 1 -> 2 -> 0
            
            const visual = document.querySelector(`.number-line-point[data-value="${value}"] .point-visual`);
            const line = visual.querySelector('.point-line');
            const circle = visual.querySelector('.point-circle');
            
            visual.classList.remove('state-0', 'state-1', 'state-2');
            
            if (state.state === 0) { // Ø®Ø·
                visual.classList.add('state-0');
                line.classList.remove('hidden');
                circle.classList.add('hidden');
            } else if (state.state === 1) { // Ù…ÙØªÙˆØ­Ø©
                visual.classList.add('state-1');
                line.classList.add('hidden');
                circle.classList.remove('hidden', 'closed');
            } else { // Ù…ØºÙ„Ù‚Ø©
                visual.classList.add('state-2');
                line.classList.add('hidden');
                circle.classList.remove('hidden', 'closed');
                circle.classList.add('closed');
            }
        }

        function toggleArrowState(value, dir) {
            if (graphAnswered) return;
            const state = numberLineState[value];
            
            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            state[dir] = !state[dir];
            // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø³Ù‡Ù… Ø§Ù„Ù…Ø¹Ø§ÙƒØ³
            if (state[dir]) {
                state[dir === 'left' ? 'right' : 'left'] = false;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            const pointEl = document.querySelector(`.number-line-point[data-value="${value}"]`);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ø·ÙˆÙŠÙ„Ø©
            const leftSegment = pointEl.querySelector('.line-segment.left');
            const rightSegment = pointEl.querySelector('.line-segment.right');
            leftSegment.style.display = state.left ? 'block' : 'none';
            rightSegment.style.display = state.right ? 'block' : 'none';
            
            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØµØºÙŠØ±Ø©
            const leftCtrl = pointEl.querySelector('.arrow-control[data-dir="left"]');
            const rightCtrl = pointEl.querySelector('.arrow-control[data-dir="right"]');
            leftCtrl.classList.toggle('active', state.left);
            rightCtrl.classList.toggle('active', state.right);
        }

        gCheckButton.addEventListener('click', () => {
            if (graphAnswered) return;
            graphAnswered = true;
            stopTotalTimer(); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚

            const solution = currentQuestion.graph;
            let isCorrect = true;

            solution.points.forEach(point => {
                const userState = numberLineState[point.v];
                
                // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© (Ù…ÙØªÙˆØ­Ø©/Ù…ØºÙ„Ù‚Ø©)
                const userCircleState = (userState.state === 1) ? false : (userState.state === 2) ? true : null;
                if (userCircleState !== point.c) {
                    isCorrect = false;
                }
                
                // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø³Ù‡Ù…
                if (solution.type === 'or') {
                    if (point.v === solution.points[0].v && !userState.left) isCorrect = false; // ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø³Ù‡Ù… ÙŠØ³Ø§Ø± Ù„Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
                    if (point.v === solution.points[1].v && !userState.right) isCorrect = false; // ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø³Ù‡Ù… ÙŠÙ…ÙŠÙ† Ù„Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
                } else { // 'and'
                    // Ù„Ø§ Ù†Ø­ØªØ§Ø¬ Ø£Ø³Ù‡Ù… Ù…Ù…ØªØ¯Ø© Ù„Ù„Ù„Ø§Ù†Ù‡Ø§ÙŠØ© ÙÙŠ "ÙˆÙ"
                }
            });

            // Ø­Ø§Ù„Ø© "ÙˆÙ" Ø§Ù„Ø®Ø§ØµØ© (Ø§Ù„Ø®Ø· Ø¨ÙŠÙ†Ù‡Ù…Ø§)
            if (solution.type === 'and') {
                const p1 = numberLineState[solution.points[0].v];
                const p2 = numberLineState[solution.points[1].v];
                // ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø³Ù‡Ù… ÙŠÙ…ÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙˆØ³Ù‡Ù… ÙŠØ³Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
                if (!p1.right || !p2.left) {
                    isCorrect = false;
                }
            }
            
            if (isCorrect) {
                gFeedbackBox.textContent = "Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ ØµØ­ÙŠØ­! Ù…Ù…ØªØ§Ø².";
                gFeedbackBox.className = 'feedback-box correct';
                categoryPoints[currentQuestion.category] += 1; // Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ù„Ù„ÙØ¦Ø©
            } else {
                gFeedbackBox.textContent = "Ø§Ù„Ø±Ø³Ù… ØºÙŠØ± Ø¯Ù‚ÙŠÙ‚.";
                gFeedbackBox.className = 'feedback-box incorrect';
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ
            gCheckButton.classList.add('hidden');
            gBottomBar.classList.remove('hidden');
            gFeedbackBox.style.display = 'block';
            gTimerDisplay.classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ø¯Ø§Ø¯
            
            // Ø¨Ø¯Ø¡ Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© (8 Ø«ÙˆØ§Ù†Ù)
            startBackTimer(gBackButton, 8, showMainScreen);
        });

        gExplainButton.addEventListener('click', () => {
            // --- ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ø³Ù… Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø´Ø±Ø­ ---
            stopBackTimer(); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù…Ø¤Ù‚ØªØ§Ù‹
            showCorrectGraph();
            // Ù„Ø§ Ù†Ø³ØªØ£Ù†Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù‡Ù†Ø§ØŒ Ø¨Ù„ Ù†Ù†ØªØ¸Ø± Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        });
        
        function showCorrectGraph() {
            graphAnswered = true; // Ù…Ù†Ø¹ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            const solution = currentQuestion.graph;
            
            solution.points.forEach(point => {
                const value = point.v;
                const state = numberLineState[value];
                
                // 1. ÙØ±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
                const correctState = point.c ? 2 : 1; // 2=Ù…ØºÙ„Ù‚Ø©, 1=Ù…ÙØªÙˆØ­Ø©
                state.state = correctState;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„Ø¯Ø§Ø¦Ø±Ø©
                const visual = document.querySelector(`.number-line-point[data-value="${value}"] .point-visual`);
                const line = visual.querySelector('.point-line');
                const circle = visual.querySelector('.point-circle');
                
                visual.classList.remove('state-0', 'state-1', 'state-2');
                line.classList.add('hidden');
                circle.classList.remove('hidden', 'closed');
                
                if (correctState === 1) { // Ù…ÙØªÙˆØ­Ø©
                    visual.classList.add('state-1');
                } else { // Ù…ØºÙ„Ù‚Ø©
                    visual.classList.add('state-2');
                    circle.classList.add('closed');
                }
                
                // 2. ÙØ±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„ØµØ­ÙŠØ­Ø©
                state.left = false;
                state.right = false;
                if (solution.type === 'or') {
                    if (value === solution.points[0].v) state.left = true; // Ø³Ù‡Ù… ÙŠØ³Ø§Ø± Ù„Ù„Ø£ÙˆÙ„Ù‰
                    if (value === solution.points[1].v) state.right = true; // Ø³Ù‡Ù… ÙŠÙ…ÙŠÙ† Ù„Ù„Ø«Ø§Ù†ÙŠØ©
                } else if (solution.type === 'and') {
                    if (value === solution.points[0].v) state.right = true; // Ø³Ù‡Ù… ÙŠÙ…ÙŠÙ† Ù„Ù„Ø£ÙˆÙ„Ù‰
                    if (value === solution.points[1].v) state.left = true; // Ø³Ù‡Ù… ÙŠØ³Ø§Ø± Ù„Ù„Ø«Ø§Ù†ÙŠØ©
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„Ø£Ø³Ù‡Ù…
                const pointEl = document.querySelector(`.number-line-point[data-value="${value}"]`);
                pointEl.querySelector('.line-segment.left').style.display = state.left ? 'block' : 'none';
                pointEl.querySelector('.line-segment.right').style.display = state.right ? 'block' : 'none';
                pointEl.querySelector('.arrow-control[data-dir="left"]').classList.toggle('active', state.left);
                pointEl.querySelector('.arrow-control[data-dir="right"]').classList.toggle('active', state.right);
            });
        }


        gBackButton.addEventListener('click', () => {
            stopBackTimer();
            completedCategories.push(currentQuestion.category);
            showMainScreen();
        });

        function resetGraphScreen() {
            graphAnswered = false;
            gCheckButton.classList.remove('hidden');
            gBottomBar.classList.add('hidden');
            gFeedbackBox.style.display = 'none';
            gTimerDisplay.classList.remove('hidden'); // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ø¯Ø§Ø¯
            stopBackTimer();
        }
        
        // --- 5. Ø¢Ù„ÙŠØ© Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ---
        function showFinishScreen() {
            mainScreen.style.display = 'none';
            questionScreen.style.display = 'none';
            graphScreen.style.display = 'none';
            finishScreen.style.display = 'block';

            // --- NEW: Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ---
            const finalTotalPoints = Object.values(categoryPoints).reduce((a, b) => a + b, 0);

            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„
            saveAndFinishGame(finalTotalPoints, totalSeconds);
        }

        // --- 6. Ø¢Ù„ÙŠØ© Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) ---
        function showModal(explanation) {
            stopBackTimer(); // Ø¥ÙŠÙ‚Ø§Ù Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø©
            stopTotalTimer(); // Ø¥ÙŠÙ‚Ø§Ù Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª
            // NEW: ØªØ·Ø¨ÙŠÙ‚ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±Ø­
            modalExplanation.textContent = toArabicNumerals(explanation);
            modalBackdrop.style.display = 'block';
            modal.style.display = 'block';
        }

        function closeModal() {
            modalBackdrop.style.display = 'none';
            modal.style.display = 'none';
            // Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
            if (questionScreen.style.display === 'block') {
                startBackTimer(qNextButton, 8, loadGraphScreen); // Ø§Ø³ØªØ¦Ù†Ø§Ù Ø¹Ø¯Ø§Ø¯ "Ø§Ù„ØªØ§Ù„ÙŠ"
                startTotalTimer(qTimerDisplay); // Ø§Ø³ØªØ¦Ù†Ø§Ù Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª
            }
        }

        modalBackdrop.addEventListener('click', closeModal);
        modalClose.addEventListener('click', closeModal);
        qExplainButton.addEventListener('click', () => showModal(currentQuestion.explanation));

        // --- 7. Ø¢Ù„ÙŠØ© Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª ---
        function startTotalTimer(displayElement) {
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯
            displayElement.classList.remove('hidden');
            categorySeconds = 0; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø±Ø­Ù„Ø©
            updateTimerDisplay(displayElement, categorySeconds);

            if (categoryTimerInterval) clearInterval(categoryTimerInterval);
            categoryTimerInterval = setInterval(() => {
                categorySeconds++;
                totalSeconds++;
                updateTimerDisplay(displayElement, categorySeconds);
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø§Ù„Ù…ØªÙˆÙ‚Ù) ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
                totalTimerDisplay.textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${toArabicNumerals(totalSeconds)} Ø«Ø§Ù†ÙŠØ©`;
            }, 1000);
        }

        function stopTotalTimer() {
            clearInterval(categoryTimerInterval);
            categoryTimerInterval = null;
        }

        function updateTimerDisplay(element, seconds) {
            element.textContent = `Ø§Ù„ÙˆÙ‚Øª: ${toArabicNumerals(seconds)} Ø«`;
        }

        // --- 8. Ø¢Ù„ÙŠØ© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ---
        function startBackTimer(button, seconds, callback) {
            stopBackTimer(); // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ø¹Ø¯Ø§Ø¯ Ø³Ø§Ø¨Ù‚
            backTimerSeconds = seconds;
            
            const updateTimer = () => {
                button.textContent = `${button.id === 'g-back-button' ? 'Ø§Ù„Ø¹ÙˆØ¯Ø©' : 'Ø§Ù„ØªØ§Ù„ÙŠ'} (${toArabicNumerals(backTimerSeconds)})`;
                backTimerSeconds--;
                if (backTimerSeconds < 0) {
                    stopBackTimer();
                    callback(); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© (Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø£Ùˆ Ø§Ù„Ø¹ÙˆØ¯Ø©)
                }
            };
            
            updateTimer(); // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØ±ÙŠ
            backTimerInterval = setInterval(updateTimer, 1000);
        }

        function stopBackTimer() {
            clearInterval(backTimerInterval);
            backTimerInterval = null;
        }
        
        // --- Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ© ---
        preloadBackground();

        document.getElementById('start-button').addEventListener('click', () => {
            loadingScreen.style.display = 'none';
            gameContainer.classList.remove('hidden'); // <-- Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
        });

        // --- START OF CONNECTION & LEADERBOARD ENGINE ---
        (function() {
            // --- CONFIGURATION (Ø¹Ø¯Ù‘Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„ÙƒÙ„ Ù„Ø¹Ø¨Ø©) ---
            const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
            // NEW: Ù…Ø¹Ø±Ù Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯
            const GAME_ID = 'g4_5_2'; 
            const GAME_MAX_POINTS = 10; // 5 Ø£Ø³Ø¦Ù„Ø© * (1 Ù†Ù‚Ø·Ø© Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± + 1 Ù†Ù‚Ø·Ø© Ù„Ù„Ø±Ø³Ù…) = 10
            const PLATFORM_MAX_GRADE = 5;                     // Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©
            const METRIC_TYPE = 'time';                       // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹ÙŠØ§Ø±: 'time'
            const METRIC_LABEL = 'Ø§Ù„ÙˆÙ‚Øª (Ø«ÙˆØ§Ù†ÙŠ)';             // Ø§Ø³Ù… Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„

            // --- Read URL Parameters ---
            const urlParams = new URLSearchParams(window.location.search);
            const studentId = urlParams.get('studentId');
            const classId = urlParams.get('classId');
            const studentName = urlParams.get('studentName');

            let currentUser = (studentId && studentName) ? { id: studentId, name: studentName } : null;

            // --- CORE FUNCTIONS ---

            // 1. Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„ØªÙŠ ØªØ³ØªØ¯Ø¹ÙŠÙ‡Ø§ Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
            window.saveAndFinishGame = function(points, metricValue) {
                const finalPoints = parseFloat(points) || 0;
                const finalMetric = parseFloat(metricValue) || 0;
                const maxPoints = parseFloat(GAME_MAX_POINTS) || 1;
                const finalGrade = (finalPoints / maxPoints) * PLATFORM_MAX_GRADE;

                const resultDisplay = document.getElementById('final-result-display');
                if (resultDisplay) {
                    resultDisplay.innerHTML = `
                        <p class="text-gray-700">Ø§Ù„Ù†Ù‚Ø§Ø·: <span class="font-bold text-xl">${toArabicNumerals(finalPoints)} / ${toArabicNumerals(maxPoints)}</span></p>
                        <p class="text-blue-600">Ø§Ù„Ø¯Ø±Ø¬Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©: <span class="font-bold text-2xl">${toArabicNumerals(finalGrade.toFixed(1))} / ${toArabicNumerals(PLATFORM_MAX_GRADE)}</span></p>
                    `;
                }

                if (studentId && classId) {
                    const params = new URLSearchParams({
                        action: 'saveGrade',
                        studentId: studentId,
                        classId: classId,
                        itemId: GAME_ID,
                        grade: finalGrade.toFixed(2),
                        metricValue: Math.round(finalMetric).toString()
                    });
                    fetch(`${SCRIPT_URL}?${params.toString()}`)
                        .then(res => res.json())
                        .then(result => console.log('Save result:', result.status))
                        .catch(err => console.error("Save Error:", err))
                        .finally(fetchAndShowLeaderboard);
                } else {
                    console.log(`Visitor finished. Score: ${finalPoints}, Metric: ${finalMetric}`);
                    fetchAndShowLeaderboard();
                }
            }

            // 2. Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„
            function fetchAndShowLeaderboard() {
                const loader = document.getElementById('leaderboard-loader');
                const container = document.getElementById('leaderboard-container');
                if (!loader || !container) return;
                
                if (!classId) {
                    console.log("No classId found, skipping leaderboard for visitor.");
                    container.innerHTML = `<p class="text-center text-gray-500 mt-4">Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ Ù…ØªØ§Ø­ Ù„Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† ÙÙ‚Ø·.</p>`;
                    showFinishButton();
                    return;
                }

                loader.style.display = 'block';
                container.innerHTML = '';

                const params = new URLSearchParams({
                    action: 'getLeaderboard',
                    gameId: GAME_ID,
                    metricType: METRIC_TYPE,
                    classId: classId
                });

                fetch(`${SCRIPT_URL}?${params.toString()}`)
                    .then(res => res.json())
                    .then(response => {
                        if (response.status === 'success' && response.data) {
                            displayLeaderboard(response.data);
                        } else {
                            throw new Error(response.message || 'Failed to load leaderboard data.');
                        }
                    })
                    .catch(err => {
                        console.error("Leaderboard Error:", err);
                        container.innerHTML = `<p class="text-center text-red-500">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„.</p>`;
                    })
                    .finally(() => {
                        loader.style.display = 'none';
                        showFinishButton();
                    });
            }
            
            // 3. Ø¯Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„
            function displayLeaderboard(data) {
                const container = document.getElementById('leaderboard-container');
                if (!data || data.length === 0) {
                    container.innerHTML = `<p class="text-center text-gray-500 mt-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„!</p>`;
                    return;
                }

                let tableHTML = `
                    <div class="mt-6 border-t pt-4">
                        <h3 class="text-2xl font-bold text-center text-gray-800 mb-4">ğŸ† Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ ğŸ†</h3>
                        <table class="min-w-full bg-white shadow-md rounded-lg">
                            <thead class="bg-gray-800 text-white">
                                <tr>
                                    <th class="text-center py-2 px-3">Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                                    <th class="text-right py-2 px-3">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                    <th class="text-center py-2 px-3">Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                                    <th class="text-center py-2 px-3">${METRIC_LABEL}</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-700">`;

                data.forEach((player, index) => {
                    const rank = index + 1;
                    let rankDisplay = toArabicNumerals(rank);
                    if (rank === 1) rankDisplay = 'ğŸ¥‡';
                    if (rank === 2) rankDisplay = 'ğŸ¥ˆ';
                    if (rank === 3) rankDisplay = 'ğŸ¥‰';

                    const isCurrentUser = (currentUser && player.name === currentUser.name);
                    const rowClass = isCurrentUser ? 'bg-blue-100 font-bold' : (index % 2 === 0 ? 'bg-gray-100' : '');

                    tableHTML += `
                        <tr class="${rowClass}">
                            <td class="text-center py-2 px-3 text-xl">${rankDisplay}</td>
                            <td class="text-right py-2 px-3">${player.name}</td>
                            <td class="text-center py-2 px-3">${toArabicNumerals(player.grade.toFixed(1))}</td>
                            <td class="text-center py-2 px-3">${toArabicNumerals(player.metricValue)}</td>
                        </tr>`;
                });

                tableHTML += `</tbody></table></div>`;
                container.innerHTML = tableHTML;
            }

            // 4. Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡
            function showFinishButton() {
                const finishWrapper = document.getElementById('finish-game-wrapper');
                if (finishWrapper) {
                    finishWrapper.style.display = 'block';
                }
            }

            // 5. Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø²Ø± Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØªØ®ØµÙŠØµ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
            document.addEventListener('DOMContentLoaded', () => {
                // Personalize welcome message
                const welcomeMessage = document.getElementById('welcomeMessage');
                if (studentName && welcomeMessage) {
                    // NEW: Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    welcomeMessage.innerHTML = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ <span class="font-bold text-yellow-300">${studentName}</span>! ÙÙŠ "ØªØ­Ø¯ÙŠ Ø§Ù„Ø¯Ù‚Ø©". Ù…Ù‡Ù…ØªÙƒ Ù‡ÙŠ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ† ÙÙŠ Ø¶Ø¨Ø· Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø­Ù„ 5 ØªØ­Ø¯ÙŠØ§Øª.`;
                }

                const finishBtn = document.getElementById('finish-game-btn');
                if (finishBtn) {
                    finishBtn.addEventListener('click', () => {
                        window.parent.postMessage({ event: 'gameFinished', gameId: GAME_ID }, '*');
                    });
                }
            });
        })();
        // --- END OF CONNECTION & LEADERBOARD ENGINE ---

    </script>
</body>
</html>
