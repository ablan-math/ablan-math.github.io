<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- STEP 1: ุนููุงู ุงูุตูุญุฉ -->
    <title>ุงูุฏุฑุณ ูค-ูฃ: ุญู ุงููุชุจุงููุงุช ุงููุชุนุฏุฏุฉ ุงูุฎุทูุงุช | ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .vocab-term-alt { background-color: #dbeafe; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-number { background-color: #fef9c3; border: 1px solid #fde047; color: #b45309; font-weight: bold; padding: 0 5px; border-radius: 4px; }
        .math-eq { font-family: "Courier New", monospace; font-size: 1.1rem; font-weight: bold; color: #4338ca; background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 2px 8px; border-radius: 6px; display: inline-block; vertical-align: middle; }
        .math-eq .highlight-number { padding: 0; border: none; } /* Style for highlighted numbers inside math-eq */
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }

        /* CSS for Number Line */
        .number-line-wrapper { margin-top: 1rem; padding: 1rem 0; }
        .number-line { position: relative; width: 100%; height: 2px; background-color: #374151; }
        .number-line::before, .number-line::after { content: ''; position: absolute; top: 50%; transform: translateY(-50%); width: 0; height: 0; border-style: solid; }
        .number-line::before { left: -1px; border-width: 6px 8px 6px 0; border-color: transparent #374151 transparent transparent; }
        .number-line::after { right: -1px; border-width: 6px 0 6px 8px; border-color: transparent transparent transparent #374151; }
        .ticks-container { position: relative; width: 100%; height: 2rem; }
        .tick { position: absolute; bottom: 0; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; font-size: 0.875rem; }
        .tick::before { content: ''; width: 2px; height: 8px; background-color: #374151; margin-bottom: 4px; }
        .solution-line { position: absolute; top: 50%; transform: translateY(-50%); height: 4px; background-color: #2563eb; }
        .solution-point { position: absolute; top: 50%; transform: translate(-50%, -50%); width: 12px; height: 12px; border-radius: 9999px; border: 2px solid #2563eb; }
        .solution-point.open { background-color: #fff; }
        .solution-point.closed { background-color: #2563eb; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">ุงูุฏุฑุณ ูค-ูฃ: ุญู ุงููุชุจุงููุงุช ุงููุชุนุฏุฏุฉ ุงูุฎุทูุงุช</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; ุงูุนูุฏุฉ ุฅูู ุงูููุฑุณ</a>
                </header>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ก ุฃููุงู: ุงูููููู ุงูุฃุณุงุณู</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-4">
                        <p>ูุญู ูุชุจุงููุฉ ูุชุนุฏุฏุฉ ุงูุฎุทูุงุชุ ูููู ุจุชุจุณูุท ูู ุทุฑู ูู ุทุฑูู ุงููุชุจุงููุฉ ุฃููุงูุ ุซู ูุณุชุฎุฏู ุงูุนูููุงุช ุงูุนูุณูุฉ ูุนุฒู ุงููุชุบูุฑ. ูุฐุง ูุดุจู ุฅูู ุญุฏ ูุจูุฑ ุญู ุงููุนุงุฏูุงุช ุงููุชุนุฏุฏุฉ ุงูุฎุทูุงุช.</p>
                        <p class="font-bold">ุงููุฑู ุงูุฃุณุงุณู ุงูุฐู ูุฌุจ ุชุฐูุฑู ุฏุงุฆููุง ูู:</p>
                        <div class="p-4 bg-red-100 rounded-lg border border-red-300">
                            <h3 class="text-xl font-semibold text-red-700 mb-2">ุชุฐูุฑ ุฃู ุชุนูุณ ุงุชุฌุงู ุฅุดุงุฑุฉ ุงููุชุจุงููุฉ!</h3>
                            <p class="text-center">ุนูุฏ ุถุฑุจ ุทุฑูู ุงููุชุจุงููุฉ ุฃู ูุณูุชููุง ุนูู ุนุฏุฏ <span class="vocab-term bg-red-100 text-red-800">ุณุงูุจ</span>ุ ูุฌุจ <span class="vocab-term-alt bg-red-200 text-red-900">ุนูุณ ุงุชุฌุงู</span> ุฅุดุงุฑุฉ ุงููุชุจุงููุฉ.</p>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ฏ ุซุงููุงู: ุฃูุซูุฉ ุชูุงุนููุฉ</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="flex flex-col space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                
                                <!-- ุงููุซุงู ุงูุชูุงุนูู 1 -->
                                <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูก: ุญู ุงููุชุจุงููุฉ <span class="math-eq">ูกูกุณ + ูกูฃ โค ูคูฆ</span></p>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูก: ุงุทุฑุญ ูกูฃ ูู ุงูุทุฑููู</h4><p class="text-center"><span class="math-eq">ูกูกุณ + ูกูฃ <span class="highlight-number">- ูกูฃ</span> โค ูคูฆ <span class="highlight-number">- ูกูฃ</span></span></p><p class="text-center mt-2"><span class="math-eq">ูกูกุณ โค ูฃูฃ</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูข: ุงูุณู ุงูุทุฑููู ุนูู ูกูก</h4><p class="text-center"><span class="math-eq"><span class="fraction"><span>ูกูกุณ</span><span class="frac-bar"></span><span class="highlight-number">ูกูก</span></span> โค <span class="fraction"><span>ูฃูฃ</span><span class="frac-bar"></span><span class="highlight-number">ูกูก</span></span></span></p><p class="text-center mt-2"><span class="math-eq">ุณ โค ูฃ</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูฃ: ูุฌููุนุฉ ุงูุญู</h4><p class="text-center"><span class="math-eq">{ุณ | ุณ โค ูฃ}</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุฎุทูุฉ ูค: ุงูุชูุซูู ุงูุจูุงูู</h4>
                                            <div class="number-line-wrapper">
                                                <div class="ticks-container">
                                                    <div class="tick" style="left: 25%;"><span>ูข</span></div>
                                                    <div class="tick" style="left: 50%;"><span>ูฃ</span></div>
                                                    <div class="tick" style="left: 75%;"><span>ูค</span></div>
                                                    <div class="number-line">
                                                        <div class="solution-line" style="left: 0%; width: 50%;"></div>
                                                        <div class="solution-point closed" style="left: 50%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- ุงููุซุงู ุงูุชูุงุนูู 2 -->
                                <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูข: ุญู ุงููุชุจุงููุฉ <span class="math-eq">ูฆู - ูก > ูฃู + ูจ</span></p>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูก: ุงุฌูุน ุงููุชุบูุฑุงุช ูู ุทุฑู ูุงุญุฏ</h4><p class="text-center"><span class="math-eq">ูฆู <span class="highlight-number">- ูฃู</span> - ูก > ูฃู <span class="highlight-number">- ูฃู</span> + ูจ</span></p><p class="text-center mt-2"><span class="math-eq">ูฃู - ูก > ูจ</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูข: ุฃุถู ูก ุฅูู ุงูุทุฑููู</h4><p class="text-center"><span class="math-eq">ูฃู - ูก <span class="highlight-number">+ ูก</span> > ูจ <span class="highlight-number">+ ูก</span></span></p><p class="text-center mt-2"><span class="math-eq">ูฃู > ูฉ</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูฃ: ุงูุณู ุงูุทุฑููู ุนูู ูฃ</h4><p class="text-center"><span class="math-eq"><span class="fraction"><span>ูฃู</span><span class="frac-bar"></span><span class="highlight-number">ูฃ</span></span> > <span class="fraction"><span>ูฉ</span><span class="frac-bar"></span><span class="highlight-number">ูฃ</span></span></span></p><p class="text-center mt-2"><span class="math-eq">ู > ูฃ</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุฎุทูุฉ ูค: ุงูุชูุซูู ุงูุจูุงูู</h4>
                                            <div class="number-line-wrapper">
                                                <div class="ticks-container">
                                                    <div class="tick" style="left: 25%;"><span>ูข</span></div>
                                                    <div class="tick" style="left: 50%;"><span>ูฃ</span></div>
                                                    <div class="tick" style="left: 75%;"><span>ูค</span></div>
                                                    <div class="number-line">
                                                        <div class="solution-line" style="left: 50%; width: 50%;"></div>
                                                        <div class="solution-point open" style="left: 50%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ุงููุซุงู ุงูุชูุงุนูู 3 -->
                                <div id="interactive-container-3" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูฃ: ุฎุงุตูุฉ ุงูุชูุฒูุน <span class="math-eq">ูค(ุฃ - ูข) < ูข(ุฃ + ูจ)</span></p>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูก: ุงุณุชุฎุฏู ุฎุงุตูุฉ ุงูุชูุฒูุน</h4><p class="text-center"><span class="math-eq">ูคุฃ - ูจ < ูขุฃ + ูกูฆ</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูข: ุงุทุฑุญ ูขุฃ ูู ุงูุทุฑููู</h4><p class="text-center"><span class="math-eq">ูคุฃ <span class="highlight-number">- ูขุฃ</span> - ูจ < ูขุฃ <span class="highlight-number">- ูขุฃ</span> + ูกูฆ</span></p><p class="text-center mt-2"><span class="math-eq">ูขุฃ - ูจ < ูกูฆ</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูฃ: ุฃุถู ูจ ุฅูู ุงูุทุฑููู</h4><p class="text-center"><span class="math-eq">ูขุฃ < ูขูค</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูค: ุงูุณู ุงูุทุฑููู ุนูู ูข</h4><p class="text-center"><span class="math-eq">ุฃ < ูกูข</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุฎุทูุฉ ูฅ: ุงูุชูุซูู ุงูุจูุงูู</h4>
                                            <div class="number-line-wrapper">
                                                <div class="ticks-container">
                                                    <div class="tick" style="left: 25%;"><span>ูกูก</span></div>
                                                    <div class="tick" style="left: 50%;"><span>ูกูข</span></div>
                                                    <div class="tick" style="left: 75%;"><span>ูกูฃ</span></div>
                                                    <div class="number-line">
                                                        <div class="solution-line" style="left: 0%; width: 50%;"></div>
                                                        <div class="solution-point open" style="left: 50%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ุงููุซุงู ุงูุชูุงุนูู 4 -->
                                <div id="interactive-container-4" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูค: ุญุงูุฉ ุฎุงุตุฉ (ูุฌููุนุฉ ุฎุงููุฉ)</p>
                                    <p class="text-center mb-4"><span class="math-eq">ูจุต + ูฃ > ูจุต + ูง</span></p>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูก: ุงุทุฑุญ ูจุต ูู ุงูุทุฑููู</h4><p class="text-center"><span class="math-eq">ูจุต <span class="highlight-number">- ูจุต</span> + ูฃ > ูจุต <span class="highlight-number">- ูจุต</span> + ูง</span></p></div>
                                        <div class="step-interactive p-4 bg-red-100 rounded-lg step-box border-red-500"><h4 class="font-bold text-red-800">ุงูุฎุทูุฉ ูข: ุงูุชุจุณูุท ูุงูุชุญููู</h4><p class="text-center"><span class="math-eq">ูฃ > ูง</span></p><p class="mt-2 text-center">ูุฐู ุงูุนุจุงุฑุฉ <span class="font-bold">ุฎุงุทุฆุฉ</span> ุฏุงุฆููุง.</p></div>
                                        <div class="step-interactive p-4 bg-yellow-100 rounded-lg step-box border-yellow-500"><h4 class="font-bold text-yellow-800">ุงูุฎุทูุฉ ูฃ: ุงูุญู</h4><p class="mt-2 text-center">ุจูุง ุฃูู ูุง ุชูุฌุฏ ูููุฉ ูููุชุบูุฑ 'ุต' ุชุฌุนู ุงููุชุจุงููุฉ ุตุญูุญุฉุ ูุฅู ูุฌููุนุฉ ุงูุญู ูู <span class="vocab-term">ุงููุฌููุนุฉ ุงูุฎุงููุฉ</span>.</p><p class="text-center font-bold text-2xl mt-4">โ</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="4" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="4" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="4" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <!-- ูุณู ุฌุฏูุฏ: ูุชุงุจุฉ ุงููุชุจุงููุงุช ูุญููุง -->
                            <div class="mt-8 pt-6 border-t-2 border-blue-200">
                                <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">ูุชุงุจุฉ ุงููุชุจุงููุงุช ูุญููุง</h3>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <!-- ุงููุซุงู ุงูุชูุงุนูู 5 -->
                                <div id="interactive-container-5" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-2">ูุซุงู ูฅ: "ุฎูุณุฉ ูุงูุต ุณุชุฉ ุฃูุซุงู ุนุฏุฏ ุฃูุจุฑ ูู ุฃุฑุจุนุฉ ุฃูุซุงู ุฐูู ุงูุนุฏุฏ ุฒุงุฆุฏ ูคูฅ."</p>
                                    <div class="steps-container space-y-4 min-h-[300px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <!-- ุงูุฎุทูุฉ 1 ุงููุฎุตุตุฉ -->
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                            <h4 class="font-bold">ุงูุฎุทูุฉ ูก: ุชุฑุฌูุฉ ุงูุฌููุฉ ุฅูู ูุชุจุงููุฉ</h4>
                                            <div class="text-center my-2 p-3 bg-indigo-50 rounded-md">
                                                <div class="flex justify-center items-center flex-wrap gap-x-2 gap-y-1 text-lg">
                                                    <div class="flex flex-col items-center"><span class="math-eq">ูฅ</span><span class="text-xs font-semibold text-gray-600">ุฎูุณุฉ</span></div>
                                                    <div class="flex flex-col items-center"><span class="math-eq">-</span><span class="text-xs font-semibold text-gray-600">ูุงูุต</span></div>
                                                    <div class="flex flex-col items-center"><span class="math-eq">ูฆู</span><span class="text-xs font-semibold text-gray-600">ุณุชุฉ ุฃูุซุงู</span></div>
                                                    <div class="flex flex-col items-center"><span class="math-eq text-red-600">></span><span class="text-xs font-semibold text-gray-600">ุฃูุจุฑ ูู</span></div>
                                                    <div class="flex flex-col items-center"><span class="math-eq">ูคู</span><span class="text-xs font-semibold text-gray-600">ุฃุฑุจุนุฉ ุฃูุซุงู</span></div>
                                                    <div class="flex flex-col items-center"><span class="math-eq">+</span><span class="text-xs font-semibold text-gray-600">ุฒุงุฆุฏ</span></div>
                                                    <div class="flex flex-col items-center"><span class="math-eq">ูคูฅ</span><span class="text-xs font-semibold text-gray-600">ูคูฅ</span></div>
                                                </div>
                                            </div>
                                            <p class="text-center font-bold mt-2"><span class="math-eq">ูฅ - ูฆู > ูคู + ูคูฅ</span></p>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูข: ุงุฌูุน ุงููุชุบูุฑุงุช ูู ุทุฑู</h4><p class="text-center"><span class="math-eq">ูฅ - ูฆู <span class="highlight-number">- ูคู</span> > ูคู <span class="highlight-number">- ูคู</span> + ูคูฅ</span></p><p class="text-center mt-2"><span class="math-eq">ูฅ - ูกูู > ูคูฅ</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูฃ: ุงุฌูุน ุงูุซูุงุจุช ูู ุงูุทุฑู ุงูุขุฎุฑ</h4><p class="text-center"><span class="math-eq">ูฅ <span class="highlight-number">- ูฅ</span> - ูกูู > ูคูฅ <span class="highlight-number">- ูฅ</span></span></p><p class="text-center mt-2"><span class="math-eq">-ูกูู > ูคู</span></p></div>
                                        <div class="step-interactive p-4 bg-red-100 rounded-lg step-box border-red-500"><h4 class="font-bold text-red-800">ุงูุฎุทูุฉ ูค: ุงูุณู ุนูู -ูกู (ูุงุนูุณ ุงูุฅุดุงุฑุฉ)</h4><p class="text-center"><span class="math-eq"><span class="fraction"><span>-ูกูู</span><span class="frac-bar"></span><span class="highlight-number">-ูกู</span></span> < <span class="fraction"><span>ูคู</span><span class="frac-bar"></span><span class="highlight-number">-ูกู</span></span></span></p><p class="text-center mt-2"><span class="math-eq">ู < -ูค</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุฎุทูุฉ ูฅ: ูุฌููุนุฉ ุงูุญู</h4><p class="text-center">ูุฌููุนุฉ ุงูุญู ูู <span class="math-eq">{ู | ู < -ูค}</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="5" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="5" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="5" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- ุงููุซุงู ุงูุชูุงุนูู 6 -->
                                <div id="interactive-container-6" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-2">ูุซุงู ูฆ: "ุฃุฑุจุนุฉ ุฃูุซุงู ุนุฏุฏ ุฒุงุฆุฏ ุซูุงููุฉ ูุง ูุฒูุฏ ุนู ุงูุนุฏุฏ ูุงูุต ุซูุงุซุฉ ุนุดุฑ."</p>
                                    <div class="steps-container space-y-4 min-h-[300px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <!-- ุงูุฎุทูุฉ 1 ุงููุฎุตุตุฉ -->
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                            <h4 class="font-bold">ุงูุฎุทูุฉ ูก: ุชุฑุฌูุฉ ุงูุฌููุฉ ุฅูู ูุชุจุงููุฉ</h4>
                                            <div class="text-center my-2 p-3 bg-indigo-50 rounded-md">
                                                <p class="text-xs text-blue-700 font-bold mb-2">ุชูููุญ: "ูุง ูุฒูุฏ ุนู" ุชุนูู "ุฃุตุบุฑ ูู ุฃู ูุณุงูู (โค)"</p>
                                                <div class="flex justify-center items-center flex-wrap gap-x-2 gap-y-1 text-lg">
                                                    <div class="flex flex-col items-center"><span class="math-eq">ูคุณ</span><span class="text-xs font-semibold text-gray-600">ุฃุฑุจุนุฉ ุฃูุซุงู</span></div>
                                                    <div class="flex flex-col items-center"><span class="math-eq">+</span><span class="text-xs font-semibold text-gray-600">ุฒุงุฆุฏ</span></div>
                                                    <div class="flex flex-col items-center"><span class="math-eq">ูจ</span><span class="text-xs font-semibold text-gray-600">ุซูุงููุฉ</span></div>
                                                    <div class="flex flex-col items-center"><span class="math-eq text-red-600">โค</span><span class="text-xs font-semibold text-gray-600">ูุง ูุฒูุฏ ุนู</span></div>
                                                    <div class="flex flex-col items-center"><span class="math-eq">ุณ</span><span class="text-xs font-semibold text-gray-600">ุงูุนุฏุฏ</span></div>
                                                    <div class="flex flex-col items-center"><span class="math-eq">-</span><span class="text-xs font-semibold text-gray-600">ูุงูุต</span></div>
                                                    <div class="flex flex-col items-center"><span class="math-eq">ูกูฃ</span><span class="text-xs font-semibold text-gray-600">ุซูุงุซุฉ ุนุดุฑ</span></div>
                                                </div>
                                            </div>
                                            <p class="text-center font-bold mt-2"><span class="math-eq">ูคุณ + ูจ โค ุณ - ูกูฃ</span></p>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูข: ุงุฌูุน ุงููุชุบูุฑุงุช ูู ุทุฑู</h4><p class="text-center"><span class="math-eq">ูคุณ <span class="highlight-number">- ุณ</span> + ูจ โค ุณ <span class="highlight-number">- ุณ</span> - ูกูฃ</span></p><p class="text-center mt-2"><span class="math-eq">ูฃุณ + ูจ โค -ูกูฃ</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูฃ: ุงุฌูุน ุงูุซูุงุจุช ูู ุงูุทุฑู ุงูุขุฎุฑ</h4><p class="text-center"><span class="math-eq">ูฃุณ + ูจ <span class="highlight-number">- ูจ</span> โค -ูกูฃ <span class="highlight-number">- ูจ</span></span></p><p class="text-center mt-2"><span class="math-eq">ูฃุณ โค -ูขูก</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ูค: ุงูุณู ุนูู ูฃ</h4><p class="text-center"><span class="math-eq"><span class="fraction"><span>ูฃุณ</span><span class="frac-bar"></span><span class="highlight-number">ูฃ</span></span> โค <span class="fraction"><span>-ูขูก</span><span class="frac-bar"></span><span class="highlight-number">ูฃ</span></span></span></p><p class="text-center mt-2"><span class="math-eq">ุณ โค -ูง</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุฎุทูุฉ ูฅ: ูุฌููุนุฉ ุงูุญู</h4><p class="text-center">ูุฌููุนุฉ ุงูุญู ูู <span class="math-eq">{ุณ | ุณ โค -ูง}</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="6" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="6" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="6" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </section>

                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">โ๏ธ ุซุงูุซุงู: ุญุงู ุฏูุฑู! ุงุฎุชุจุฑ ูููู</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">ูุชูุฌุชู ุงูููุงุฆูุฉ</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>

    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">๐ก ุดุฑุญ ุงูุฅุฌุงุจุฉ</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <div id="smartExplanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full border-t-4 border-purple-500">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-purple-800">๐ง ุงูุญู ุงูุฐูู</h3>
                <button id="closeSmartModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="smartExplanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <script>
    // URL for Google Apps Script (for saving grades, replace with your actual URL)
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3; // Maximum quiz attempts allowed for logged-in students
    let currentQuestions = []; // To hold the questions for the current quiz instance

    // Function to get student data from localStorage
    function getStudentFromStorage() {
        const studentDataString = localStorage.getItem('currentStudent');
        if (studentDataString) {
            try {
                return JSON.parse(studentDataString);
            } catch (e) {
                console.error("Error parsing student data from localStorage:", e);
                return null;
            }
        }
        return null;
    }

    // Function to build the main header
    function buildHeader(studentData, lessonTitle = null) {
        const headerContainer = document.getElementById('main-header');
        if (!headerContainer) return;

        let titleHtml;
        if (lessonTitle) {
            titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`;
        } else {
            titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h1></a>`;
        }

        let userInfoHtml = '';
        if (studentData) {
            userInfoHtml = `<div class="flex items-center gap-4"><span class="font-semibold">ุฃููุงูุ ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">ุฎุฑูุฌ</a></div>`;
        } else {
            userInfoHtml = `<p class="text-lg text-gray-600">ุฒุงุฆุฑ</p>`;
        }

        headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`;
        
        const logoutLink = headerContainer.querySelector('#logout-link');
        if(logoutLink) {
            logoutLink.addEventListener('click', () => {
                localStorage.removeItem('currentStudent');
            });
        }
    }

    // Function to build the main footer
    function buildFooter() {
        const footerContainer = document.getElementById('main-footer');
        if (!footerContainer) return;
        footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">ยฉ 2024 ุฌููุน ุงูุญููู ูุญููุธุฉ | ุชุตููู ูุชุทููุฑ: ุฃ. ุนุจุฏุงูุนุฒูุฒ ุฎุงูุฏ ุงูุนุจูุงู</p></div>`;
    }

    // Function to initialize the quiz
    function initializeQuiz(lessonId, questions, studentData) {
        currentQuestions = questions;
        const quizForm = document.getElementById('quizForm');
        if (!quizForm) return;

        if (questions.length === 0) {
            quizForm.innerHTML = `<p class="text-center text-gray-600">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุชุงุญุฉ ููุฐุง ุงูุฏุฑุณ ุญุงููุงู.</p>`;
            return;
        }

        let attemptsLeft;
        if (studentData) {
            const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 };
            attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts;
        } else {
            attemptsLeft = 1; // Guests get one attempt
        }

        const attemptsCounter = document.getElementById('attempts-counter');
        if (attemptsCounter) {
            attemptsCounter.innerHTML = `ุงููุญุงููุงุช ุงููุชุจููุฉ: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`;
        }
        
        const quizHtml = questions.map((q, index) => {
            const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join('');
            const smartButtonHTML = q.smartExplanation ? `<button type="button" id="smart-explain-btn-${index}" class="hidden mt-2 text-xs text-purple-600 hover:underline font-semibold">๐ง ุงูุญู ุงูุฐูู</button>` : '';
            return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div class="flex items-center space-x-4 space-x-reverse">${smartButtonHTML}<button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">ุงุนุฑู ููุงุฐุงุ</button></div></div>`;
        }).join('');

        quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">ุชุญูู ูู ุฅุฌุงุจุงุชู</button>`;

        questions.forEach((q, index) => {
            const explainBtn = document.getElementById(`explain-btn-${index}`);
            if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index));
            if (q.smartExplanation) {
                const smartExplainBtn = document.getElementById(`smart-explain-btn-${index}`);
                if(smartExplainBtn) smartExplainBtn.addEventListener('click', () => showSmartExplanation(index));
            }
        });

        if (attemptsLeft <= 0) {
            const submitBtn = quizForm.querySelector('#submit-quiz-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'ูุง ุชูุฌุฏ ูุญุงููุงุช ูุชุจููุฉ';
            submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400');
        }

        quizForm.onsubmit = (e) => {
            e.preventDefault();
            let score = 0;
            questions.forEach((q, index) => {
                const userAnswer = e.target.elements[`q${index}`]?.value;
                const feedbackEl = document.getElementById(`feedback-q${index}`);
                if (userAnswer === q.correct) {
                    score++;
                    feedbackEl.textContent = 'โ ุฅุฌุงุจุฉ ุตุญูุญุฉ!';
                    feedbackEl.className = 'mt-2 text-sm font-bold text-green-600';
                } else {
                    feedbackEl.textContent = `โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ.`;
                    feedbackEl.className = 'mt-2 text-sm font-bold text-red-600';
                }
                document.getElementById(`explain-btn-${index}`).classList.remove('hidden');
                if (q.smartExplanation) {
                    document.getElementById(`smart-explain-btn-${index}`).classList.remove('hidden');
                }
            });

            const finalGrade = Math.round((score / questions.length) * 10);
            const resultsDiv = document.getElementById('quiz-results');
            resultsDiv.classList.remove('hidden');
            document.getElementById('quiz-score').textContent = `${finalGrade} / 10`;

            if (studentData) {
                saveGrade(lessonId, finalGrade, studentData.id);
                if (attemptsLeft - 1 > 0) {
                    document.getElementById('retake-quiz-btn').classList.remove('hidden');
                }
            } else {
                document.getElementById('save-status').textContent = 'ุชู ุนุฑุถ ูุชูุฌุชู. ุณุฌู ุงูุฏุฎูู ูุญูุธ ุชูุฏูู.';
            }
            e.target.querySelector('#submit-quiz-btn').disabled = true;
        };
    }

    // Function to save grade to Google Sheet via Apps Script
    function saveGrade(lessonId, grade, studentId) {
        if (!studentId) return;
        const saveStatus = document.getElementById('save-status');
        saveStatus.textContent = 'ุฌุงุฑู ุญูุธ ูุชูุฌุชู...';
        const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&lessonId=${lessonId}&grade=${grade}`;
        fetch(url)
            .then(res => res.json())
            .then(result => {
                if (result.status === 'success') {
                    saveStatus.textContent = 'โ ุชู ุญูุธ ูุชูุฌุชู ุจูุฌุงุญ! ุณุชุธูุฑ ูู ููุญุฉ ุงูุชุญูู ุนูุฏ ุงูุนูุฏุฉ.';
                    // Update localStorage
                    const studentData = JSON.parse(localStorage.getItem('currentStudent'));
                    if (!studentData.lessons) studentData.lessons = {};
                    // Save the highest grade and increment attempts
                    if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) {
                        studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 };
                    } else {
                        studentData.lessons[lessonId].attempts++;
                    }
                    localStorage.setItem('currentStudent', JSON.stringify(studentData));
                } else {
                    throw new Error(result.message);
                }
            })
            .catch(error => {
                saveStatus.textContent = 'โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุฏุฑุฌุฉ.';
                console.error("Save Grade Error:", error);
            });
    }

    // Functions to show/hide explanation modals
    function showExplanation(questionIndex) {
        const modal = document.getElementById('explanationModal');
        const explanationText = document.getElementById('explanationText');
        if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) {
            explanationText.innerHTML = currentQuestions[questionIndex].explanation;
            modal.classList.remove('hidden');
        }
    }

    function closeModal() {
        const modal = document.getElementById('explanationModal');
        if(modal) modal.classList.add('hidden');
    }
    
    function showSmartExplanation(questionIndex) {
        const modal = document.getElementById('smartExplanationModal');
        const explanationText = document.getElementById('smartExplanationText');
        if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].smartExplanation) {
            explanationText.innerHTML = currentQuestions[questionIndex].smartExplanation;
            modal.classList.remove('hidden');
        }
    }

    function closeSmartModal() {
        const modal = document.getElementById('smartExplanationModal');
        if(modal) modal.classList.add('hidden');
    }
    
    // --- LESSON SPECIFIC DATA ---
    const LESSON_ID = 'c4_l3'; // Unique ID for this lesson
    
    // Function to generate quiz questions for this lesson
    function generateQuiz() { 
        const questionBank = [
            { 
                type: 'mcq', level: 'โญ', text: `ุญู ุงููุชุจุงููุฉ <span class="math-eq">ูคุณ + ูง โค ูกูฉ</span>`,
                options: [ 
                    { display: 'ุณ โค ูฃ', value: 'A' }, { display: 'ุณ โฅ ูฃ', value: 'B' }, 
                    { display: 'ุณ โค ูฆ.ูฅ', value: 'C' }, { display: 'ุณ โฅ ูฆ.ูฅ', value: 'D' }
                ], 
                correct: 'A',
                explanation: `<p>ูุญู ุงููุชุจุงููุฉุ ูุจุฏุฃ ุจุนุฒู ุงูุญุฏ ุงูุฐู ูุญุชูู ุนูู ุงููุชุบูุฑ.</p><p>ูก. ุงุทุฑุญ ูง ูู ุงูุทุฑููู: <span class="math-eq">ูคุณ โค ูกูฉ - ูง</span>  &larr;  <span class="math-eq">ูคุณ โค ูกูข</span></p><p>ูข. ุงูุณู ุงูุทุฑููู ุนูู ูค: <span class="math-eq">ุณ โค ูฃ</span></p><p>ุจูุง ุฃููุง ูุณููุง ุนูู ุนุฏุฏ ููุฌุจุ ูุฅู ุงุชุฌุงู ุงูุฅุดุงุฑุฉ ูุง ูุชุบูุฑ.</p>`,
            },
            { 
                type: 'mcq', level: 'โญโญ', text: `ุญู ุงููุชุจุงููุฉ <span class="math-eq">ูฉู + ูข < ูฅู - ูฆ</span>`,
                options: [ 
                    { display: 'ู < -ูข', value: 'A' }, { display: 'ู > -ูข', value: 'B' }, 
                    { display: 'ู < ูข', value: 'C' }, { display: 'ู < -ูก', value: 'D' }
                ], 
                correct: 'A',
                explanation: `<p>ูก. ุงุฌูุน ุงููุชุบูุฑุงุช ูู ุทุฑู ูุงุญุฏ. ูุทุฑุญ ูฅู ูู ุงูุทุฑููู:</p><p><span class="math-eq">ูฉู - ูฅู + ูข < ูฅู - ูฅู - ูฆ</span> &larr; <span class="math-eq">ูคู + ูข < -ูฆ</span></p><p>ูข. ุงุทุฑุญ ูข ูู ุงูุทุฑููู:</p><p><span class="math-eq">ูคู < -ูฆ - ูข</span> &larr; <span class="math-eq">ูคู < -ูจ</span></p><p>ูฃ. ุงูุณู ุงูุทุฑููู ุนูู ูค:</p><p><span class="math-eq">ู < -ูข</span></p>`,
                smartExplanation: `<p>ุงูุธุฑ ุฅูู ุทุฑูู ุงููุชุจุงููุฉ. ูููู ูฅู ุฅูู ุงููุณุงุฑ (ูฉู - ูฅู = ูคู) ููููู ูข ุฅูู ุงููููู (-ูฆ - ูข = -ูจ). ุชุตุจุญ ุงููุชุจุงููุฉ <span class="math-eq">ูคู < -ูจ</span>. ูุณูุฉ -ูจ ุนูู ูค ุชุนุทู -ูข. ุงูุญู ูู <span class="math-eq">ู < -ูข</span>.</p>`
            },
            { 
                type: 'mcq', level: 'โญโญ', text: `ูุง ุญู ุงููุชุจุงููุฉ <span class="math-eq">ูฅ(ุจ - ูข) > ูขุจ + ูจ</span>ุ`,
                options: [ 
                    { display: 'ุจ > ูฆ', value: 'A' }, { display: 'ุจ < ูฆ', value: 'B' }, 
                    { display: 'ุจ > ูข', value: 'C' }, { display: 'ุจ > -ูข/ูฃ', value: 'D' }
                ], 
                correct: 'A',
                explanation: `<p>ูก. ุงุณุชุฎุฏู ุฎุงุตูุฉ ุงูุชูุฒูุน ุนูู ุงูุทุฑู ุงูุฃูุณุฑ:</p><p><span class="math-eq">ูฅุจ - ูกู > ูขุจ + ูจ</span></p><p>ูข. ุงุทุฑุญ ูขุจ ูู ุงูุทุฑููู:</p><p><span class="math-eq">ูฃุจ - ูกู > ูจ</span></p><p>ูฃ. ุฃุถู ูกู ุฅูู ุงูุทุฑููู:</p><p><span class="math-eq">ูฃุจ > ูกูจ</span></p><p>ูค. ุงูุณู ุงูุทุฑููู ุนูู ูฃ:</p><p><span class="math-eq">ุจ > ูฆ</span></p>`
            },
            { 
                type: 'mcq', level: 'โญโญโญ', text: `ุญู ุงููุชุจุงููุฉ <span class="math-eq">-ูฃ(ู + ูค) โฅ ูกูข</span>`,
                options: [ 
                    { display: 'ู โฅ -ูจ', value: 'A' }, { display: 'ู โค ู', value: 'B' }, 
                    { display: 'ู โค -ูจ', value: 'C' }, { display: 'ู โฅ ู', value: 'D' }
                ], 
                correct: 'C',
                explanation: `<p>ููุงู ุทุฑููุชุงู ููุญู:</p><p><b>ุงูุทุฑููุฉ ุงูุฃููู: ุงููุณูุฉ ุฃููุงู</b></p><p>ูก. ุงูุณู ุงูุทุฑููู ุนูู -ูฃ ู<span class="text-red-600 font-bold">ุงุนูุณ ุงุชุฌุงู ุงูุฅุดุงุฑุฉ</span>:</p><p><span class="math-eq">ู + ูค โค ูกูข / (-ูฃ)</span> &larr; <span class="math-eq">ู + ูค โค -ูค</span></p><p>ูข. ุงุทุฑุญ ูค ูู ุงูุทุฑููู: <span class="math-eq">ู โค -ูจ</span></p><p><b>ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุงูุชูุฒูุน ุฃููุงู</b></p><p>ูก. ูุฒุน -ูฃ ุนูู ุงูููุณ: <span class="math-eq">-ูฃู - ูกูข โฅ ูกูข</span></p><p>ูข. ุฃุถู ูกูข ุฅูู ุงูุทุฑููู: <span class="math-eq">-ูฃู โฅ ูขูค</span></p><p>ูฃ. ุงูุณู ุนูู -ูฃ ู<span class="text-red-600 font-bold">ุงุนูุณ ุงุชุฌุงู ุงูุฅุดุงุฑุฉ</span>: <span class="math-eq">ู โค -ูจ</span></p>`,
                smartExplanation: `<p>ุจูุฌุฑุฏ ุฃู ุชุฑู ุฃูู ุณุชูุณู ุนูู <span class="math-eq">-ูฃ</span>ุ ุชุฐูุฑ ุฃู ุชุนูุณ ุงูุฅุดุงุฑุฉ ูู <span class="math-eq">โฅ</span> ุฅูู <span class="math-eq">โค</span>. ูุฐุง ููุบู ุงูุฎูุงุฑูู (ุฃ) ู (ุฏ). ุงูุขู ุญู ุงููุณุฃูุฉ: <span class="math-eq">ู+ูค โค -ูค</span>ุ ุฅุฐู <span class="math-eq">ู โค -ูจ</span>.</p>`
            },
            { 
                type: 'mcq', level: 'โญโญโญ', text: `ูุง ูุฌููุนุฉ ุญู ุงููุชุจุงููุฉ <span class="math-eq">ูจ(ุณ - ูก) + ูค < ูจุณ</span>ุ`,
                options: [ 
                    { display: 'ุณ < ูค', value: 'A' }, { display: 'ุงููุฌููุนุฉ ุงูุฎุงููุฉ (โ)', value: 'B' }, 
                    { display: 'ูุฌููุนุฉ ุงูุฃุนุฏุงุฏ ุงูุญููููุฉ (โ)', value: 'C' }, { display: 'ุณ > -ูค', value: 'D' }
                ], 
                correct: 'C',
                explanation: `<p>ูก. ุจุณูุท ุงูุทุฑู ุงูุฃูุณุฑ ุจุงูุชูุฒูุน: <span class="math-eq">ูจุณ - ูจ + ูค < ูจุณ</span></p><p>ูข. ุงุฌูุน ุงูุญุฏูุฏ ุงููุชุดุงุจูุฉ: <span class="math-eq">ูจุณ - ูค < ูจุณ</span></p><p>ูฃ. ุงุทุฑุญ ูจุณ ูู ุงูุทุฑููู: <span class="math-eq">-ูค < ู</span></p><p>ูค. ุงูุนุจุงุฑุฉ ุงููุงุชุฌุฉ <span class="math-eq">-ูค < ู</span> ุตุญูุญุฉ ุฏุงุฆููุง. ูุฐุง ูุนูู ุฃู ุงููุชุจุงููุฉ ุงูุฃุตููุฉ ุตุญูุญุฉ ูุฃู ูููุฉ ุญููููุฉ ูููุชุบูุฑ ุณ.</p><p>ุฅุฐูุ ูุฌููุนุฉ ุงูุญู ูู ูุฌููุนุฉ ุงูุฃุนุฏุงุฏ ุงูุญููููุฉ (โ).</p>`
            },
            { 
                type: 'mcq', level: 'โญโญ', text: `ุฃู ูุชุจุงููุฉ ุชูุซู ุงูุฌููุฉ: 'ูุงุชุฌ ุถุฑุจ ุนุฏุฏ ูู -ูฅ ุซู ุฅุถุงูุฉ ูก ุฃูุจุฑ ูู ูขูก'ุ`,
                options: [ 
                    { display: '<span class="math-eq">-ูฅู + ูก > ูขูก</span>', value: 'A' }, { display: '<span class="math-eq">-ูฅู + ูก < ูขูก</span>', value: 'B' }, 
                    { display: '<span class="math-eq">ูฅู + ูก > ูขูก</span>', value: 'C' }, { display: '<span class="math-eq">-ูฅ(ู+ูก) > ูขูก</span>', value: 'D' }
                ], 
                correct: 'A',
                explanation: `<p>ููุญูู ุงูุฌููุฉ:</p><ul><li>"ูุงุชุฌ ุถุฑุจ ุนุฏุฏ ูู -ูฅ": <span class="math-eq">-ูฅู</span></li><li>"ุซู ุฅุถุงูุฉ ูก": <span class="math-eq">-ูฅู + ูก</span></li><li>"ุฃูุจุฑ ูู ูขูก": <span class="math-eq">> ูขูก</span></li></ul><p>ุฅุฐูุ ุงููุชุจุงููุฉ ุงูุตุญูุญุฉ ูู <span class="math-eq">-ูฅู + ูก > ูขูก</span>.</p>`
            },
            { 
                type: 'mcq', level: 'โญโญโญ', text: `ูุง ุญู ุงููุชุจุงููุฉ ุงูุชู ุชูุซู: 'ุซูุงุซุฉ ุฃูุซุงู ุนุฏุฏ ูุงูุต ุฃุฑุจุนุฉ ูุง ููู ุนู ุฎูุณุฉ ุฃูุซุงู ุงูุนุฏุฏ ุฒุงุฆุฏ ุนุดุฑุฉ'ุ`,
                options: [ 
                    { display: 'ุณ โค -ูง', value: 'A' }, { display: 'ุณ โฅ -ูง', value: 'B' }, 
                    { display: 'ุณ โค ูง', value: 'C' }, { display: 'ุณ โฅ ูง', value: 'D' }
                ], 
                correct: 'A',
                explanation: `<p>ูก. ูุชุฑุฌู ุงูุฌููุฉ ุฅูู ูุชุจุงููุฉ. "ูุง ููู ุนู" ุชุนูู "ุฃูุจุฑ ูู ุฃู ูุณุงูู (โฅ)".</p><p><span class="math-eq">ูฃุณ - ูค โฅ ูฅุณ + ูกู</span></p><p>ูข. ูุทุฑุญ ูฅุณ ูู ุงูุทุฑููู: <span class="math-eq">-ูขุณ - ูค โฅ ูกู</span></p><p>ูฃ. ูุถูู ูค ุฅูู ุงูุทุฑููู: <span class="math-eq">-ูขุณ โฅ ูกูค</span></p><p>ูค. ููุณู ุนูู -ูข ู <span class="text-red-600 font-bold">ูุนูุณ ุงุชุฌุงู ุงูุฅุดุงุฑุฉ</span>: <span class="math-eq">ุณ โค -ูง</span></p>`
            }
        ];
        
        // Shuffle the question bank to get a random set of questions
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        // Select the first 5 questions, or fewer if the bank is smaller
        const questionCount = Math.min(shuffled.length, 7); // Increased to 7 to allow new questions to appear
        return shuffled.slice(0, questionCount);
    }

    // Main script execution on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
        // --- Initialize Interactive Examples ---
        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            state[exampleId] = { 
                currentIndex: -1, 
                steps: container.querySelectorAll('.step-interactive'), 
                placeholder: container.querySelector('.interactive-placeholder'), 
                prevBtn: container.querySelector('.prev-btn'), 
                nextBtn: container.querySelector('.next-btn'), 
                resetBtn: container.querySelector('.reset-btn') 
            };

            const resetExample = () => {
                state[exampleId].steps.forEach(step => step.classList.remove('active'));
                state[exampleId].currentIndex = -1;
                if (state[exampleId].placeholder) {
                    state[exampleId].placeholder.classList.remove('hidden');
                }
                updateButtons();
            };

            const updateButtons = () => { 
                const isFirstStep = state[exampleId].currentIndex <= -1; 
                const isLastStep = state[exampleId].currentIndex >= state[exampleId].steps.length - 1; 
                if (!state[exampleId].prevBtn) return; // Guard against missing buttons
                state[exampleId].prevBtn.disabled = isFirstStep; 
                if (isLastStep) { 
                    state[exampleId].nextBtn.classList.add('hidden'); 
                    state[exampleId].resetBtn.classList.remove('hidden'); 
                } else { 
                    state[exampleId].nextBtn.classList.remove('hidden'); 
                    state[exampleId].resetBtn.classList.add('hidden'); 
                } 
            };
            
            if(state[exampleId].nextBtn) {
                state[exampleId].nextBtn.addEventListener('click', () => {
                    if (state[exampleId].currentIndex < state[exampleId].steps.length - 1) {
                        if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                            state[exampleId].placeholder.classList.add('hidden');
                        }
                        state[exampleId].currentIndex++;
                        state[exampleId].steps[state[exampleId].currentIndex].classList.add('active');
                        updateButtons();
                    }
                });
            }

            if(state[exampleId].prevBtn) {
                state[exampleId].prevBtn.addEventListener('click', () => {
                    if (state[exampleId].currentIndex > -1) {
                        if(state[exampleId].steps[state[exampleId].currentIndex]) {
                           state[exampleId].steps[state[exampleId].currentIndex].classList.remove('active');
                        }
                        state[exampleId].currentIndex--;
                         if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                            state[exampleId].placeholder.classList.remove('hidden');
                        }
                        updateButtons();
                    }
                });
            }

            if(state[exampleId].resetBtn) { state[exampleId].resetBtn.addEventListener('click', resetExample); }
            updateButtons(); // Initial button state
        });

        // --- Initialize Page Structure and Quiz ---
        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        
        buildHeader(student, lessonTitle);
        buildFooter();
        
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);

        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) {
            retakeBtn.addEventListener('click', () => {
                window.location.reload();
            });
        }
        
        // --- Setup Modal Close Buttons ---
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
        
        const closeSmartModalBtn = document.getElementById('closeSmartModalBtn');
        if(closeSmartModalBtn) closeSmartModalBtn.addEventListener('click', closeSmartModal);
    });
    </script>
</body>
</html>
