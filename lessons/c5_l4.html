<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุฏุฑุณ ูฅ-ูค: ุญู ูุธุงู ูู ูุนุงุฏูุชูู ุจุงูุญุฐู ุจุงุณุชุนูุงู ุงูุถุฑุจ | ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #9333ea; /* purple-600 */ }
        .math-eq { font-family: "Courier New", monospace; font-size: 1.2rem; font-weight: bold; color: #4338ca; background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 4px 10px; border-radius: 6px; display: inline-flex; align-items: center; vertical-align: middle; transition: all 0.3s ease-in-out; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
        .highlight-number {
            background-color: #fef9c3; /* yellow-100 */
            color: #b45309; /* amber-700 */
            padding: 1px 5px;
            border-radius: 4px;
            border: 1px solid #fde047; /* yellow-300 */
            font-weight: bold;
        }
        .target-term {
            outline: 2px solid #ef4444; /* red-500 */
            box-shadow: 0 0 10px #f43f5e;
            border-radius: 4px;
            transition: all 0.3s ease-in-out;
        }
        .eq-1-color { color: #2563eb; /* blue-600 */ }
        .eq-2-color { color: #16a34a; /* green-600 */ }
        .eq-3-color { color: #9333ea; /* purple-600 */ }
        .eq-4-color { color: #c2410c; /* orange-600 */ }
        .eq-5-color { color: #0891b2; /* cyan-600 */ }
        .eq-1-bg { background-color: #dbeafe; border-color: #93c5fd; }
        .eq-2-bg { background-color: #dcfce7; border-color: #86efac; }
        .eq-3-bg { background-color: #f3e8ff; border-color: #d8b4fe; }
        .eq-4-bg { background-color: #ffedd5; border-color: #fed7aa; }
        .eq-5-bg { background-color: #cffafe; border-color: #a5f3fc; }
        .temp-comment {
            transition: opacity 0.3s ease-in-out;
            min-height: 56px; /* To prevent layout shift for two lines */
        }
        .multiplier {
            transition: all 0.3s ease-in-out;
            opacity: 0;
            transform: translateX(-10px);
            font-size: 1.1rem; /* Smaller font size */
        }
        .multiplier.visible {
            opacity: 1;
            transform: translateX(0);
        }
        .visual-workspace .math-eq { width: 100%; text-align: center; }
        .visual-workspace {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .visual-workspace.visible {
            opacity: 1;
        }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid currentColor; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-purple-800">ุงูุฏุฑุณ ูฅ-ูค: ุญู ูุธุงู ูู ูุนุงุฏูุชูู ุจุงูุญุฐู ุจุงุณุชุนูุงู ุงูุถุฑุจ</h1>
                </header>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ก ุฃููุงู: ุงูููููู ุงูุฃุณุงุณู</h2>
                    <div class="p-4 bg-purple-50 rounded-lg space-y-3">
                        <p>ูุญู ูุธุงู ูุนุงุฏูุงุช ุจุงูุญุฐูุ ูุฏ ูุญุชุงุฌ ูุถุฑุจ ุฅุญุฏู ุงููุนุงุฏูุชูู ุฃู ููุชูููุง ูู ุนุฏุฏ ุซุงุจุช ูุฌุนู ูุนุงููุงุช ุฃุญุฏ ุงููุชุบูุฑูู ูุชุนุงูุณุฉ.</p>
                        <ol class="list-decimal pr-8 space-y-2">
                            <li><strong>ุงูุฎุทูุฉ ูก:</strong> ุงุฎุชุฑ ูุชุบูุฑุงู ูุญุฐููุ ูุงุถุฑุจ ุงููุนุงุฏูุงุช ูู ุฃุนุฏุงุฏ ููุงุณุจุฉ ูุฌุนู ูุนุงููู ูุฐุง ุงููุชุบูุฑ ูุชุนุงูุณูู (ูุซู <span class="highlight-number">ูฆ</span> ู <span class="highlight-number">-ูฆ</span>).</li>
                            <li><strong>ุงูุฎุทูุฉ ูข:</strong> ุงุฌูุน ุงููุนุงุฏูุชูู ุงูุฌุฏูุฏุชูู ููุชุฎูุต ูู ุงููุชุบูุฑุ ูุญู ุงููุนุงุฏูุฉ ุงููุงุชุฌุฉ.</li>
                            <li><strong>ุงูุฎุทูุฉ ูฃ:</strong> ุนููุถ ุงููููุฉ ุงููุงุชุฌุฉ ูู ุฃู ูู ุงููุนุงุฏูุงุช ุงูุฃุตููุฉ ูุฅูุฌุงุฏ ูููุฉ ุงููุชุบูุฑ ุงูุซุงูู.</li>
                        </ol>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ฏ ุซุงููุงู: ุฃูุซูุฉ ุชูุงุนููุฉ</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="flex flex-col space-y-8">
                            
                            <!-- ุตู ุงูุฃูุซูุฉ ุงูุฃูู -->
                            <div class="grid md:grid-cols-2 gap-8">
                                <!-- ุงููุซุงู ุงูุฃูู -->
                                <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-2">ูุซุงู ูก: ุถุฑุจ ุฅุญุฏู ุงููุนุงุฏูุชูู</p>
                                    <div class="mb-4 p-3 bg-gray-100 rounded-lg text-center">
                                        <p class="font-semibold mb-2">ุญู ุงููุธุงู ุงูุขุชู:</p>
                                        <div class="inline-block text-left">
                                            <p class="math-eq eq-1-bg eq-1-color">ูขุณ + ุต = ูขูฃ</p><br>
                                            <p class="math-eq eq-2-bg eq-2-color">ูฃุณ + ูขุต = ูฃูง</p>
                                        </div>
                                    </div>
                                    <div id="visual-workspace-1" class="visual-workspace space-y-3 text-center min-h-[250px] flex flex-col justify-center items-center">
                                        <div class="inline-flex flex-col items-center space-y-2">
                                            <div class="flex items-center justify-start gap-4 w-full">
                                                <div id="multiplier-1" class="multiplier font-bold text-red-500 w-16 text-center"></div>
                                                <p id="eq1-visual-1" class="math-eq eq-1-bg eq-1-color flex-1">ูขุณ + <span>ุต</span> = ูขูฃ</p>
                                            </div>
                                            <div class="flex items-center justify-start gap-4 w-full">
                                                <div class="w-16"></div> <!-- Placeholder for alignment -->
                                                <p id="eq2-visual-1" class="math-eq eq-2-bg eq-2-color flex-1">ูฃุณ + <span>ูขุต</span> = ูฃูง</p>
                                            </div>
                                            <div class="flex items-center justify-start gap-4 w-full">
                                                <div class="w-16"></div> <!-- Placeholder for alignment -->
                                                <div class="flex flex-col items-center flex-1">
                                                    <div id="addition-line-1" class="border-t-2 border-gray-700 my-2 opacity-0 transition-opacity w-full"></div>
                                                    <p id="result-visual-1" class="math-eq opacity-0 w-full"></p>
                                                    <p id="simplified-result-visual-1" class="math-eq opacity-0 w-full"></p>
                                                </div>
                                            </div>
                                        </div>
                                        <p id="temp-comment-1" class="temp-comment text-purple-700 font-semibold"></p>
                                    </div>
                                    <div class="steps-container-text-1 space-y-4">
                                         <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ุงูุชุงููุฉ: ุงูุชุนููุถ</h4><p>ุจุนุฏ ุฅูุฌุงุฏ ูููุฉ <span class="math-eq">ุณ = ูฉ</span>ุ ูุนูุถูุง ูู ุงููุนุงุฏูุฉ ุงูุฃููู ุงูุฃุตููุฉ ูุฅูุฌุงุฏ ูููุฉ (ุต).</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุญู ูุฅูุฌุงุฏ ุต</h4><p><span class="math-eq eq-1-bg eq-1-color">ูข(ูฉ) + ุต = ูขูฃ</span><br><span class="math-eq">ูกูจ + ุต = ูขูฃ</span><br><span class="math-eq">ุต = ูฅ</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุญู ุงูููุงุฆู</h4><p>ุงูุญู ูู ุงูุฒูุฌ ุงููุฑุชุจ <span class="math-eq">(ูฉ, ูฅ)</span>.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- ุงููุซุงู ุงูุซุงูู -->
                                <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                                     <p class="text-lg font-semibold mb-2">ูุซุงู ูข: ุถุฑุจ ููุชุง ุงููุนุงุฏูุชูู</p>
                                    <div class="mb-4 p-3 bg-gray-100 rounded-lg text-center">
                                        <p class="font-semibold mb-2">ุญู ุงููุธุงู ุงูุขุชู:</p>
                                        <div class="inline-block text-left">
                                            <p class="math-eq eq-1-bg eq-1-color">ูคุณ + ูฃุต = ูจ</p><br>
                                            <p class="math-eq eq-2-bg eq-2-color">ูฃุณ - ูฅุต = -ูขูฃ</p>
                                        </div>
                                    </div>
                                    <div id="visual-workspace-2" class="visual-workspace space-y-3 text-center min-h-[250px] flex flex-col justify-center items-center">
                                        <div class="inline-flex flex-col items-center space-y-2">
                                            <div class="flex items-center justify-start gap-4 w-full">
                                                <div id="multiplier-2a" class="multiplier font-bold text-red-500 w-16 text-center"></div>
                                                <p id="eq1-visual-2" class="math-eq eq-1-bg eq-1-color flex-1">ูคุณ + <span>ูฃุต</span> = ูจ</p>
                                            </div>
                                            <div class="flex items-center justify-start gap-4 w-full">
                                                <div id="multiplier-2b" class="multiplier font-bold text-red-500 w-16 text-center"></div>
                                                <p id="eq2-visual-2" class="math-eq eq-2-bg eq-2-color flex-1">ูฃุณ - <span>ูฅุต</span> = -ูขูฃ</p>
                                            </div>
                                            <div class="flex items-center justify-start gap-4 w-full">
                                                <div class="w-16"></div> <!-- Placeholder for alignment -->
                                                <div class="flex flex-col items-center flex-1">
                                                    <div id="addition-line-2" class="border-t-2 border-gray-700 my-2 opacity-0 transition-opacity w-full"></div>
                                                    <p id="result-visual-2" class="math-eq opacity-0 w-full"></p>
                                                    <p id="simplified-result-visual-2" class="math-eq opacity-0 w-full"></p>
                                                </div>
                                            </div>
                                        </div>
                                        <p id="temp-comment-2" class="temp-comment text-purple-700 font-semibold"></p>
                                    </div>
                                    <div class="steps-container-text-2 space-y-4">
                                         <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ุงูุชุงููุฉ: ุงูุชุนููุถ</h4><p>ุจุนุฏ ุฅูุฌุงุฏ ูููุฉ <span class="math-eq">ุณ = -ูก</span>ุ ูุนูุถูุง ูู ุงููุนุงุฏูุฉ ุงูุฃููู ุงูุฃุตููุฉ ูุฅูุฌุงุฏ ูููุฉ (ุต).</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุญู ูุฅูุฌุงุฏ ุต</h4><p><span class="math-eq eq-1-bg eq-1-color">ูค(-ูก) + ูฃุต = ูจ</span><br><span class="math-eq">-ูค + ูฃุต = ูจ</span><br><span class="math-eq">ูฃุต = ูกูข</span> โธ <span class="math-eq">ุต = ูค</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุญู ุงูููุงุฆู</h4><p>ุงูุญู ูู ุงูุฒูุฌ ุงููุฑุชุจ <span class="math-eq">(-ูก, ูค)</span>.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ุตู ุงูุฃูุซูุฉ ุงูุซุงูู -->
                            <div>
                                <!-- ุงููุซุงู ุงูุซุงูุซ -->
                                <div id="interactive-container-3" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-2">ูุซุงู ูฃ: ูุณุงุฆู ูู ูุงูุน ุงูุญูุงุฉ</p>
                                    <div class="mb-4 p-3 bg-gray-100 rounded-lg">
                                        <p class="font-semibold mb-2 text-center">ุงููุณุฃูุฉ:</p>
                                        <p>ุงุดุชุฑู ุฃุญูุฏ <span class="highlight-number">ูฃ</span> ุฏูุงุชุฑ ู <span class="highlight-number">ูค</span> ุฃููุงู ุจูุจูุบ <span class="highlight-number">ูฃูฉ</span> ุฑูุงูุงู. ูุงุดุชุฑู ุตุฏููู ุฏูุชุฑูู ู <span class="highlight-number">ูฅ</span> ุฃููุงู ูู ููุณ ุงูููุน ุจูุจูุบ <span class="highlight-number">ูฃูจ</span> ุฑูุงูุงู. ููุง ุซูู ุงูุฏูุชุฑ ุงููุงุญุฏ ูุงูููู ุงููุงุญุฏุ</p>
                                    </div>
                                    <div id="visual-workspace-3" class="visual-workspace space-y-3 text-center min-h-[250px] flex flex-col justify-center items-center">
                                        <div class="inline-flex flex-col items-center space-y-2">
                                            <div class="flex items-center justify-start gap-4 w-full">
                                                <div id="multiplier-3a" class="multiplier font-bold text-red-500 w-16 text-center"></div>
                                                <p id="eq1-visual-3" class="math-eq eq-1-bg eq-1-color flex-1 opacity-0"><span>ูฃุฏ</span> + ูคู = ูฃูฉ</p>
                                            </div>
                                            <div class="flex items-center justify-start gap-4 w-full">
                                                <div id="multiplier-3b" class="multiplier font-bold text-red-500 w-16 text-center"></div>
                                                <p id="eq2-visual-3" class="math-eq eq-2-bg eq-2-color flex-1 opacity-0"><span>ูขุฏ</span> + ูฅู = ูฃูจ</p>
                                            </div>
                                            <div class="flex items-center justify-start gap-4 w-full">
                                                <div class="w-16"></div> <!-- Placeholder for alignment -->
                                                <div class="flex flex-col items-center flex-1">
                                                    <div id="addition-line-3" class="border-t-2 border-gray-700 my-2 opacity-0 transition-opacity w-full"></div>
                                                    <p id="result-visual-3" class="math-eq opacity-0 w-full"></p>
                                                    <p id="simplified-result-visual-3" class="math-eq opacity-0 w-full"></p>
                                                </div>
                                            </div>
                                        </div>
                                        <p id="temp-comment-3" class="temp-comment text-purple-700 font-semibold"></p>
                                    </div>
                                    <div class="steps-container-text-3 space-y-4">
                                         <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ุงูุชุงููุฉ: ุงูุชุนููุถ</h4><p>ุจุนุฏ ุฅูุฌุงุฏ ูููุฉ ุงูููู (ู) = <span class="highlight-number">ูค</span> ุฑูุงูุงุชุ ูุนูุถูุง ูู ุงููุนุงุฏูุฉ ุงูุฃููู ุงูุฃุตููุฉ ูุฅูุฌุงุฏ ุซูู ุงูุฏูุชุฑ (ุฏ).</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุญู ูุฅูุฌุงุฏ ุฏ</h4><p><span class="math-eq eq-1-bg eq-1-color">ูฃุฏ + ูค(ูค) = ูฃูฉ</span><br><span class="math-eq">ูฃุฏ + ูกูฆ = ูฃูฉ</span><br><span class="math-eq">ูฃุฏ = ูขูฃ</span><br><span class="math-eq">ุฏ = ูง</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุญู ุงูููุงุฆู</h4><p>ุซูู ุงูุฏูุชุฑ = <span class="highlight-number">ูง</span> ุฑูุงูุ ูุซูู ุงูููู = <span class="highlight-number">ูค</span> ุฑูุงู.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </section>
                
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">โ๏ธ ุฑุงุจุนุงู: ุญุงู ุฏูุฑู! ุงุฎุชุจุฑ ูููู</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">ูุชูุฌุชู ุงูููุงุฆูุฉ</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ</button>
                    </div>
                </section>

            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">๐ก ุดุฑุญ ุงูุฅุฌุงุจุฉ</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <div id="smartExplanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full border-t-4 border-purple-500">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-purple-800">๐ง ุงูุญู ุงูุฐูู</h3>
                <button id="closeSmartModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="smartExplanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    
    <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    // --- SCRIPT GENERAL ---
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) {
        const headerContainer = document.getElementById('main-header');
        if (!headerContainer) return;
        let titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h2><h1 class="text-xl font-bold text-purple-700 leading-tight">${lessonTitle}</h1></div>`;
        let userInfoHtml = '';
        if (studentData && studentData.name) {
            userInfoHtml = `
                <div class="text-left">
                    <div class="flex items-center gap-4">
                        <span class="font-semibold text-lg">ุฃููุงูุ ${studentData.name}</span>
                        <a href="../index.html" id="logout-link" class="text-sm bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">ุฎุฑูุฌ</a>
                    </div>
                    <a href="../index.html" class="text-sm text-blue-600 hover:underline">&larr; ุงูุนูุฏุฉ ุฅูู ุงูููุฑุณ</a>
                </div>`;
        } else {
            userInfoHtml = `
                <div class="text-left">
                    <p class="text-lg text-gray-600 font-semibold">ุฒุงุฆุฑ</p>
                    <a href="../index.html" class="text-sm text-blue-600 hover:underline">&larr; ุงูุนูุฏุฉ ุฅูู ุงูููุฑุณ</a>
                </div>`;
        }
        headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`;
        const logoutLink = headerContainer.querySelector('#logout-link');
        if (logoutLink) {
            logoutLink.addEventListener('click', () => {
                localStorage.removeItem('currentStudent');
            });
        }
    }
    function buildFooter() {
        const footerContainer = document.getElementById('main-footer');
        if (!footerContainer) return;
        footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">ยฉ 2024 ุฌููุน ุงูุญููู ูุญููุธุฉ | ุชุตููู ูุชุทููุฑ: ุฃ. ุนุจุฏุงูุนุฒูุฒ ุฎุงูุฏ ุงูุนุจูุงู</p></div>`;
    }
    function initializeQuiz(lessonId, questions, studentData, classId) { 
        currentQuestions = questions; 
        const quizForm = document.getElementById('quizForm'); 
        if (!quizForm) return; 
        if (questions.length === 0) { 
            quizForm.innerHTML = `<p class="text-center text-gray-600">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุชุงุญุฉ ููุฐุง ุงูุฏุฑุณ ุญุงููุงู.</p>`; 
            return; 
        } 
        let attemptsLeft; 
        if (studentData) { 
            const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; 
            attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; 
        } else { 
            attemptsLeft = 1; 
        } 
        const attemptsCounter = document.getElementById('attempts-counter'); 
        if (attemptsCounter) { 
            attemptsCounter.innerHTML = `ุงููุญุงููุงุช ุงููุชุจููุฉ: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; 
        } 
        const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); const smartButtonHTML = q.smartExplanation ? `<button type="button" id="smart-explain-btn-${index}" class="hidden mt-2 text-xs text-purple-600 hover:underline font-semibold">๐ง ุงูุญู ุงูุฐูู</button>` : ''; return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div class="flex items-center space-x-4 space-x-reverse">${smartButtonHTML}<button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">ุงุนุฑู ููุงุฐุงุ</button></div></div>`; }).join(''); 
        quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">ุชุญูู ูู ุฅุฌุงุจุงุชู</button>`; 
        questions.forEach((q, index) => { 
            const explainBtn = document.getElementById(`explain-btn-${index}`); 
            if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); 
            if (q.smartExplanation) { 
                const smartExplainBtn = document.getElementById(`smart-explain-btn-${index}`); 
                if(smartExplainBtn) smartExplainBtn.addEventListener('click', () => showSmartExplanation(index)); 
            } 
        }); 
        if (attemptsLeft <= 0) { 
            const submitBtn = quizForm.querySelector('#submit-quiz-btn'); 
            submitBtn.disabled = true; 
            submitBtn.textContent = 'ูุง ุชูุฌุฏ ูุญุงููุงุช ูุชุจููุฉ'; 
            submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); 
        } 
        quizForm.onsubmit = (e) => { 
            e.preventDefault(); 
            let score = 0; 
            questions.forEach((q, index) => { 
                const userAnswer = e.target.elements[`q${index}`]?.value; 
                const feedbackEl = document.getElementById(`feedback-q${index}`); 
                if (userAnswer === q.correct) { 
                    score++; 
                    feedbackEl.textContent = 'โ ุฅุฌุงุจุฉ ุตุญูุญุฉ!'; 
                    feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; 
                } else { 
                    feedbackEl.textContent = `โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ.`; 
                    feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; 
                } 
                document.getElementById(`explain-btn-${index}`).classList.remove('hidden'); 
                if (q.smartExplanation) { 
                    document.getElementById(`smart-explain-btn-${index}`).classList.remove('hidden'); 
                } 
            }); 
            const finalGrade = Math.round((score / questions.length) * 10); 
            const resultsDiv = document.getElementById('quiz-results'); 
            resultsDiv.classList.remove('hidden'); 
            document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; 
            if (studentData) { 
                saveGrade(lessonId, finalGrade, studentData.id, classId); 
                if (attemptsLeft - 1 > 0) { 
                    document.getElementById('retake-quiz-btn').classList.remove('hidden'); 
                } 
            } else { 
                document.getElementById('save-status').textContent = 'ุชู ุนุฑุถ ูุชูุฌุชู. ุณุฌู ุงูุฏุฎูู ูุญูุธ ุชูุฏูู.'; 
            } 
            e.target.querySelector('#submit-quiz-btn').disabled = true; 
        }; 
    }
    function saveGrade(lessonId, grade, studentId, classId) { 
        const saveStatus = document.getElementById('save-status');
        if (!studentId || !classId) {
            console.error("Student ID or Class ID is missing from the URL.");
            saveStatus.textContent = 'ุฎุทุฃ: ูุง ูููู ุญูุธ ูุชูุฌุชู. ุจูุงูุงุช ุงูุทุงูุจ ุบูุฑ ููุชููุฉ.';
            return;
        }
        saveStatus.textContent = 'ุฌุงุฑู ุญูุธ ูุชูุฌุชู...'; 
        const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&classId=${classId}&lessonId=${lessonId}&grade=${grade}`; 
        fetch(url, { method: 'POST', body: '' }) 
            .then(res => res.json()) 
            .then(result => { 
                if (result.status === 'success') { 
                    saveStatus.textContent = 'โ ุชู ุญูุธ ูุชูุฌุชู ุจูุฌุงุญ! ุณุชุธูุฑ ูู ููุญุฉ ุงูุชุญูู ุนูุฏ ุงูุนูุฏุฉ.'; 
                    const studentData = JSON.parse(localStorage.getItem('currentStudent')); 
                    if (studentData) {
                        if (!studentData.lessons) studentData.lessons = {}; 
                        if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { 
                            studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; 
                        } else { 
                            studentData.lessons[lessonId].attempts++; 
                        } 
                        localStorage.setItem('currentStudent', JSON.stringify(studentData)); 
                    }
                } else { 
                    throw new Error(result.message || 'Unknown error from Apps Script'); 
                } 
            }) 
            .catch(error => { 
                saveStatus.textContent = 'โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุฏุฑุฌุฉ.'; 
                console.error("Save Grade Error:", error); 
            }); 
    }
    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { document.getElementById('explanationModal').classList.add('hidden'); }
    function showSmartExplanation(questionIndex) { const modal = document.getElementById('smartExplanationModal'); const explanationText = document.getElementById('smartExplanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].smartExplanation) { explanationText.innerHTML = currentQuestions[questionIndex].smartExplanation; modal.classList.remove('hidden'); } }
    function closeSmartModal() { document.getElementById('smartExplanationModal').classList.add('hidden'); }
    // --- END SCRIPT GENERAL ---

    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const studentIdFromUrl = urlParams.get('studentId');
        const classIdFromUrl = urlParams.get('classId');

        const studentFromStorage = getStudentFromStorage();
        let student = null;

        if (studentIdFromUrl && studentFromStorage && studentFromStorage.id === studentIdFromUrl) {
            student = studentFromStorage;
        }

        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        
        const LESSON_ID = 'c5_l4';
        const quizQuestions = generateQuiz();
        initializeQuiz(LESSON_ID, quizQuestions, student, classIdFromUrl);
        
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        document.getElementById('closeModalBtn').addEventListener('click', closeModal);
        document.getElementById('closeSmartModalBtn').addEventListener('click', closeSmartModal);

        // --- Interactive Examples Setup ---
        const examples = {
            '1': {
                totalSteps: 9,
                workspace: document.getElementById('visual-workspace-1'),
                multiplier: document.getElementById('multiplier-1'),
                eq1: document.getElementById('eq1-visual-1'),
                eq2: document.getElementById('eq2-visual-1'),
                line: document.getElementById('addition-line-1'),
                result: document.getElementById('result-visual-1'),
                simplifiedResult: document.getElementById('simplified-result-visual-1'),
                comment: document.getElementById('temp-comment-1'),
                textSteps: document.querySelectorAll('.steps-container-text-1 .step-interactive'),
                runStep: runStep1,
            },
            '2': {
                totalSteps: 11,
                workspace: document.getElementById('visual-workspace-2'),
                multiplierA: document.getElementById('multiplier-2a'),
                multiplierB: document.getElementById('multiplier-2b'),
                eq1: document.getElementById('eq1-visual-2'),
                eq2: document.getElementById('eq2-visual-2'),
                line: document.getElementById('addition-line-2'),
                result: document.getElementById('result-visual-2'),
                simplifiedResult: document.getElementById('simplified-result-visual-2'),
                comment: document.getElementById('temp-comment-2'),
                textSteps: document.querySelectorAll('.steps-container-text-2 .step-interactive'),
                runStep: runStep2,
            },
            '3': {
                totalSteps: 17,
                workspace: document.getElementById('visual-workspace-3'),
                multiplierA: document.getElementById('multiplier-3a'),
                multiplierB: document.getElementById('multiplier-3b'),
                eq1: document.getElementById('eq1-visual-3'),
                eq2: document.getElementById('eq2-visual-3'),
                line: document.getElementById('addition-line-3'),
                result: document.getElementById('result-visual-3'),
                simplifiedResult: document.getElementById('simplified-result-visual-3'),
                comment: document.getElementById('temp-comment-3'),
                textSteps: document.querySelectorAll('.steps-container-text-3 .step-interactive'),
                runStep: runStep3,
            }
        };

        Object.keys(examples).forEach(key => {
            const ex = examples[key];
            ex.currentIndex = -1;
            ex.nextBtn = document.querySelector(`button.next-btn[data-example="${key}"]`);
            ex.prevBtn = document.querySelector(`button.prev-btn[data-example="${key}"]`);
            ex.resetBtn = document.querySelector(`button.reset-btn[data-example="${key}"]`);
            setupExample(ex);
        });

        function setupExample(ex) {
            ex.nextBtn.addEventListener('click', () => {
                if (ex.currentIndex < ex.totalSteps) {
                    ex.currentIndex++;
                    ex.runStep(ex.currentIndex);
                }
            });
            ex.prevBtn.addEventListener('click', () => {
                if (ex.currentIndex > -1) {
                    ex.currentIndex--;
                    ex.runStep(ex.currentIndex);
                }
            });
            ex.resetBtn.addEventListener('click', () => {
                ex.currentIndex = -1;
                ex.runStep(ex.currentIndex);
            });
            ex.runStep(-1); // Initial setup
        }

        function updateButtons(ex) {
            ex.prevBtn.disabled = ex.currentIndex <= -1;
            if (ex.currentIndex >= ex.totalSteps) {
                ex.nextBtn.classList.add('hidden');
                ex.resetBtn.classList.remove('hidden');
            } else {
                ex.nextBtn.classList.remove('hidden');
                ex.resetBtn.classList.add('hidden');
            }
        }

        // --- Step Runners for each example ---
        function runStep1(index) {
            const ex = examples['1'];
            // Reset
            ex.workspace.classList.remove('visible');
            ex.eq1.innerHTML = 'ูขุณ + <span>ุต</span> = ูขูฃ';
            ex.eq2.innerHTML = 'ูฃุณ + <span>ูขุต</span> = ูฃูง';
            ex.eq1.querySelector('span').classList.remove('target-term');
            ex.eq2.querySelector('span').classList.remove('target-term');
            ex.comment.textContent = '';
            ex.multiplier.classList.remove('visible');
            ex.eq1.className = 'math-eq eq-1-bg eq-1-color flex-1';
            ex.line.style.opacity = '0';
            ex.result.style.opacity = '0';
            ex.simplifiedResult.style.opacity = '0';
            ex.textSteps.forEach(s => s.classList.remove('active'));

            // Apply
            if (index >= 0) ex.workspace.classList.add('visible');
            if (index >= 1) {
                ex.eq1.querySelector('span').classList.add('target-term');
                ex.eq2.querySelector('span').classList.add('target-term');
                ex.comment.textContent = 'ูุญุฐู (ุต)ุ ูุถุฑุจ ุงููุนุงุฏูุฉ ุงูุฃููู ูู (-ูข).';
            }
            if (index >= 2) {
                ex.comment.textContent = '';
                ex.multiplier.textContent = 'ร (-ูข)';
                ex.multiplier.classList.add('visible');
            }
            if (index >= 3) {
                ex.multiplier.classList.remove('visible');
                ex.eq1.innerHTML = '-ูคุณ - ูขุต = -ูคูฆ';
                ex.eq1.className = 'math-eq eq-3-bg eq-3-color flex-1';
                ex.eq2.querySelector('span').classList.remove('target-term');
            }
            if (index >= 4) {
                ex.comment.textContent = 'ุงูุขูุ ูุฌูุน ุงููุนุงุฏูุชูู.';
                ex.line.style.opacity = '1';
            }
            if (index >= 5) {
                ex.comment.textContent = '';
                ex.result.innerHTML = '-ุณ + ู = -ูฉ';
                ex.result.style.opacity = '1';
            }
            if (index >= 6) {
                ex.comment.textContent = 'ูุจุณุท ุงููุนุงุฏูุฉ.';
            }
            if (index >= 7) {
                ex.comment.textContent = '';
                ex.simplifiedResult.innerHTML = 'ุณ = ูฉ';
                ex.simplifiedResult.className = 'math-eq bg-green-200 border-green-600 w-full';
                ex.simplifiedResult.style.opacity = '1';
            }
            if (index >= 8) ex.textSteps[0].classList.add('active');
            if (index >= 9) ex.textSteps[1].classList.add('active');
            if (index >= 10) ex.textSteps[2].classList.add('active');
            
            updateButtons(ex);
        }

        function runStep2(index) {
            const ex = examples['2'];
            // Reset
            ex.workspace.classList.remove('visible');
            ex.eq1.innerHTML = 'ูคุณ + <span>ูฃุต</span> = ูจ';
            ex.eq2.innerHTML = 'ูฃุณ - <span>ูฅุต</span> = -ูขูฃ';
            ex.eq1.querySelector('span').classList.remove('target-term');
            ex.eq2.querySelector('span').classList.remove('target-term');
            ex.comment.textContent = '';
            ex.multiplierA.classList.remove('visible');
            ex.multiplierB.classList.remove('visible');
            ex.eq1.className = 'math-eq eq-1-bg eq-1-color flex-1';
            ex.eq2.className = 'math-eq eq-2-bg eq-2-color flex-1';
            ex.line.style.opacity = '0';
            ex.result.style.opacity = '0';
            ex.simplifiedResult.style.opacity = '0';
            ex.textSteps.forEach(s => s.classList.remove('active'));

            // Apply
            if (index >= 0) ex.workspace.classList.add('visible');
            if (index >= 1) {
                ex.eq1.querySelector('span').classList.add('target-term');
                ex.eq2.querySelector('span').classList.add('target-term');
                ex.comment.textContent = 'ูุญุฐู (ุต)ุ ูุถุฑุจ ุงูุฃููู ูู (ูฅ) ูุงูุซุงููุฉ ูู (ูฃ).';
            }
            if (index >= 2) {
                ex.comment.textContent = '';
                ex.multiplierA.textContent = 'ร (ูฅ)';
                ex.multiplierA.classList.add('visible');
            }
            if (index >= 3) {
                ex.eq1.innerHTML = 'ูขูุณ + ูกูฅุต = ูคู';
                ex.eq1.className = 'math-eq eq-4-bg eq-4-color flex-1';
            }
            if (index >= 4) {
                ex.multiplierB.textContent = 'ร (ูฃ)';
                ex.multiplierB.classList.add('visible');
            }
            if (index >= 5) {
                ex.multiplierA.classList.remove('visible');
                ex.multiplierB.classList.remove('visible');
                ex.eq2.innerHTML = 'ูฉุณ - ูกูฅุต = -ูฆูฉ';
                ex.eq2.className = 'math-eq eq-5-bg eq-5-color flex-1';
            }
            if (index >= 6) {
                ex.comment.textContent = 'ุงูุขูุ ูุฌูุน ุงููุนุงุฏูุชูู.';
                ex.line.style.opacity = '1';
            }
            if (index >= 7) {
                ex.comment.textContent = '';
                ex.result.innerHTML = 'ูขูฉุณ = -ูขูฉ';
                ex.result.style.opacity = '1';
            }
            if (index >= 8) {
                ex.comment.textContent = 'ูุจุณุท ูุฅูุฌุงุฏ (ุณ).';
            }
            if (index >= 9) {
                ex.comment.textContent = '';
                ex.simplifiedResult.innerHTML = 'ุณ = -ูก';
                ex.simplifiedResult.className = 'math-eq bg-green-200 border-green-600 w-full';
                ex.simplifiedResult.style.opacity = '1';
            }
            if (index >= 10) ex.textSteps[0].classList.add('active');
            if (index >= 11) ex.textSteps[1].classList.add('active');
            if (index >= 12) ex.textSteps[2].classList.add('active');

            updateButtons(ex);
        }
        
        function runStep3(index) {
            const ex = examples['3'];
            // Reset
            ex.workspace.classList.remove('visible');
            ex.eq1.innerHTML = '<span>ูฃุฏ</span> + ูคู = ูฃูฉ';
            ex.eq2.innerHTML = '<span>ูขุฏ</span> + ูฅู = ูฃูจ';
            ex.eq1.className = 'math-eq eq-1-bg eq-1-color flex-1 opacity-0';
            ex.eq2.className = 'math-eq eq-2-bg eq-2-color flex-1 opacity-0';
            ex.eq1.querySelector('span').classList.remove('target-term');
            ex.eq2.querySelector('span').classList.remove('target-term');
            ex.comment.textContent = '';
            ex.comment.className = 'temp-comment text-purple-700 font-semibold';
            ex.multiplierA.classList.remove('visible');
            ex.multiplierB.classList.remove('visible');
            ex.line.style.opacity = '0';
            ex.result.style.opacity = '0';
            ex.simplifiedResult.style.opacity = '0';
            ex.textSteps.forEach(s => s.classList.remove('active'));

            // Apply
            if (index >= 0) ex.workspace.classList.add('visible');
            if (index >= 1) {
                ex.comment.innerHTML = "ุฃููุงูุ ูุญุฏุฏ ุงููุชุบูุฑุงุช:<br> <span class='font-bold text-blue-600'>ุฏ = ุซูู ุงูุฏูุชุฑ</span>, <span class='font-bold text-green-600'>ู = ุซูู ุงูููู</span>";
            }
            if (index >= 2) {
                ex.comment.innerHTML = "<span class='text-blue-600'>ูู ุฌููุฉ 'ูฃ ุฏูุงุชุฑ ู ูค ุฃููุงู ุจูุจูุบ ูฃูฉ ุฑูุงูุงู'ุ ูููู ุงููุนุงุฏูุฉ ุงูุฃููู.</span>";
            }
            if (index >= 3) {
                 ex.eq1.classList.remove('opacity-0');
                 ex.comment.innerHTML = '';
            }
            if (index >= 4) {
                 ex.comment.innerHTML = "<span class='text-green-600'>ููู ุฌููุฉ 'ุฏูุชุฑูู ู ูฅ ุฃููุงู ุจูุจูุบ ูฃูจ ุฑูุงูุงู'ุ ูููู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ.</span>";
            }
            if (index >= 5) {
                ex.eq2.classList.remove('opacity-0');
                ex.comment.innerHTML = '';
            }
            if (index >= 6) {
                ex.eq1.querySelector('span').classList.add('target-term');
                ex.eq2.querySelector('span').classList.add('target-term');
                ex.comment.textContent = 'ูุญุฐู (ุฏ)ุ ูุถุฑุจ ุงูุฃููู ูู (ูข) ูุงูุซุงููุฉ ูู (-ูฃ).';
            }
            if (index >= 7) {
                ex.comment.textContent = '';
                ex.multiplierA.textContent = 'ร (ูข)';
                ex.multiplierA.classList.add('visible');
            }
            if (index >= 8) {
                ex.eq1.innerHTML = 'ูฆุฏ + ูจู = ูงูจ';
                ex.eq1.className = 'math-eq eq-4-bg eq-4-color flex-1';
            }
            if (index >= 9) {
                ex.multiplierB.textContent = 'ร (-ูฃ)';
                ex.multiplierB.classList.add('visible');
            }
            if (index >= 10) {
                ex.multiplierA.classList.remove('visible');
                ex.multiplierB.classList.remove('visible');
                ex.eq2.innerHTML = '-ูฆุฏ - ูกูฅู = -ูกูกูค';
                ex.eq2.className = 'math-eq eq-5-bg eq-5-color flex-1';
            }
            if (index >= 11) {
                ex.comment.textContent = 'ุงูุขูุ ูุฌูุน ุงููุนุงุฏูุชูู.';
                ex.line.style.opacity = '1';
            }
            if (index >= 12) {
                ex.comment.textContent = '';
                ex.result.innerHTML = '-ูงู = -ูฃูฆ';
                ex.result.style.opacity = '1';
            }
            if (index >= 13) {
                ex.comment.textContent = 'ูุจุณุท ูุฅูุฌุงุฏ (ู).';
            }
            if (index >= 14) {
                ex.comment.textContent = '';
                ex.simplifiedResult.innerHTML = 'ู = ูค';
                ex.simplifiedResult.className = 'math-eq bg-green-200 border-green-600 w-full';
                ex.simplifiedResult.style.opacity = '1';
            }
            if (index >= 15) ex.textSteps[0].classList.add('active');
            if (index >= 16) ex.textSteps[1].classList.add('active');
            if (index >= 17) ex.textSteps[2].classList.add('active');

            updateButtons(ex);
        }
        
        function generateQuiz() {
            const questionBank = [
                {
                    type: 'mcq',
                    level: 'โญ',
                    topic: 'elimination_multiplication',
                    text: 'ูุญุฐู ุงููุชุบูุฑ (ุต) ูู ุงููุธุงู ุงูุชุงููุ ูู ุฃู ุนุฏุฏ ูุฌุจ ุถุฑุจ ุงููุนุงุฏูุฉ ุงูุฃูููุ <br><span class="math-eq eq-1-bg eq-1-color">ุณ + ุต = ูฅ</span><br><span class="math-eq eq-2-bg eq-2-color">ูขุณ - ูฃุต = ู</span>',
                    options: [
                        { display: '<span class="highlight-number">-ูข</span>', value: 'a' },
                        { display: '<span class="highlight-number">ูข</span>', value: 'b' },
                        { display: '<span class="highlight-number">ูฃ</span>', value: 'c' },
                        { display: '<span class="highlight-number">-ูฃ</span>', value: 'd' }
                    ],
                    correct: 'c',
                    explanation: 'ูุฌุนู ูุนุงูู (ุต) ูู ุงููุนุงุฏูุฉ ุงูุฃููู ูุนููุณุงู ุฌูุนูุงู ููุนุงูู (ุต) ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ (<span class="highlight-number">-ูฃ</span>)ุ ูุฌุจ ุฃู ูุฌุนูู <span class="highlight-number">+ูฃ</span>. ูุฐููุ ูุถุฑุจ ุงููุนุงุฏูุฉ ุงูุฃููู ูููุง ูู <span class="highlight-number">ูฃ</span>.'
                },
                {
                    type: 'mcq',
                    level: 'โญโญ',
                    topic: 'elimination_multiplication',
                    text: 'ูุง ูู ุญู ุงููุธุงู ุงูุชุงููุ<br><span class="math-eq">ูฅุณ + ูขุต = ูฆ</span><br><span class="math-eq">-ูขุณ + ุต = ูฃ</span>',
                    options: [
                        { display: '<span class="math-eq">(ู, ูฃ)</span>', value: 'a' },
                        { display: '<span class="math-eq">(ูข, -ูข)</span>', value: 'b' },
                        { display: '<span class="math-eq">(ูฃ, ู)</span>', value: 'c' },
                        { display: '<span class="math-eq">(ูค, -ูง)</span>', value: 'd' }
                    ],
                    correct: 'a',
                    explanation: `<div class='space-y-3 text-center'>
                        <p>ูุญู ูุฐุง ุงููุธุงูุ ุณูุณุชุฎุฏู ุงูุญุฐู ุจุงูุถุฑุจ. ูุฏููุง ูู ุฌุนู ูุนุงููุงุช 'ุต' ูุชุนุงูุณุฉ.</p>
                        <div class='p-2 bg-gray-50 rounded-lg'>
                            <h4 class='font-bold text-purple-700'>ุงูุฎุทูุฉ ูก: ุชุญุฏูุฏ ุนูููุฉ ุงูุถุฑุจ</h4>
                            <p>ุงููุนุงุฏูุชุงู ููุง:</p>
                            <div class="inline-block text-left">
                                <p class="math-eq eq-1-bg eq-1-color">ูฅุณ + ูขุต = ูฆ</p><br>
                                <p class="math-eq eq-2-bg eq-2-color">-ูขุณ + <span class='target-term'>ุต</span> = ูฃ</p>
                            </div>
                            <p class='mt-2'>ูุฌุนู ูุนุงูู 'ุต' ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ (<span class='highlight-number'>ูก</span>) ูุนููุณุงู ููุนุงูู 'ุต' ูู ุงูุฃููู (<span class='highlight-number'>ูข</span>)ุ ูุถุฑุจ ุงููุนุงุฏูุฉ ุงูุซุงููุฉ ูู <span class='highlight-number'>-ูข</span>.</p>
                        </div>
                        <div class='p-2 bg-gray-50 rounded-lg'>
                            <h4 class='font-bold text-purple-700'>ุงูุฎุทูุฉ ูข: ุชูููุฐ ุงูุถุฑุจ</h4>
                            <p><span class='font-bold text-red-500 text-lg'>ร (-ูข)</span> <span class="math-eq eq-2-bg eq-2-color">-ูขุณ + ุต = ูฃ</span></p>
                            <p class='text-2xl'>โฉ</p>
                            <p class="math-eq eq-3-bg eq-3-color">ูคุณ - ูขุต = -ูฆ</p>
                        </div>
                        <div class='p-2 bg-gray-50 rounded-lg'>
                            <h4 class='font-bold text-purple-700'>ุงูุฎุทูุฉ ูฃ: ุงูุญุฐู ุจุงูุฌูุน</h4>
                            <div class='inline-flex flex-col items-center'>
                                <p class="math-eq eq-1-bg eq-1-color">ูฅุณ + ูขุต = ูฆ</p>
                                <p class="math-eq eq-3-bg eq-3-color">ูคุณ - ูขุต = -ูฆ</p>
                                <div class='border-t-2 border-black w-full my-1'></div>
                                <p class="math-eq">ูฉุณ + ู = ู</p>
                                <p class='text-2xl'>โฉ</p>
                                <p class="math-eq bg-green-200">ุณ = ู</p>
                            </div>
                        </div>
                        <div class='p-2 bg-gray-50 rounded-lg'>
                            <h4 class='font-bold text-purple-700'>ุงูุฎุทูุฉ ูค: ุฅูุฌุงุฏ 'ุต'</h4>
                            <p>ูุนูุถ <span class='math-eq'>ุณ = ู</span> ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ ุงูุฃุตููุฉ:</p>
                            <p class="math-eq eq-2-bg eq-2-color">-ูข(ู) + ุต = ูฃ</p>
                            <p class="math-eq">ุต = ูฃ</p>
                            <p class='mt-2 font-bold'>ุฅุฐูุ ุงูุญู ูู <span class="math-eq bg-green-200">(ู, ูฃ)</span>.</p>
                        </div>
                    </div>`,
                    smartExplanation: 'ุฌุฑุจ ุงูุฎูุงุฑุงุช. ููุฎุชุจุฑ ุงูุฎูุงุฑ (ุฃ) <span class="math-eq">(ู, ูฃ)</span>:<br><strong>ุงููุนุงุฏูุฉ ูก:</strong> <span class="math-eq">ูฅ(ู) + ูข(ูฃ) = ูฆ</span> โธ <span class="math-eq">ูฆ = ูฆ</span> (ุตุญูุญ).<br><strong>ุงููุนุงุฏูุฉ ูข:</strong> <span class="math-eq">-ูข(ู) + ูฃ = ูฃ</span> โธ <span class="math-eq">ูฃ = ูฃ</span> (ุตุญูุญ).<br>ุจูุง ุฃู ุงูุฎูุงุฑ (ุฃ) ูุญูู ุงููุนุงุฏูุชููุ ููู ุงูุญู ุงูุตุญูุญ.'
                },
                {
                    type: 'mcq',
                    level: 'โญโญโญ',
                    topic: 'elimination_multiplication',
                    text: 'ุญู ุงููุธุงู:<br><span class="math-eq">ูฃุณ + ูคุต = -ูขูฅ</span><br><span class="math-eq">ูขุณ - ูฃุต = ูฆ</span>',
                    options: [
                        { display: '<span class="math-eq">(-ูฃ, -ูค)</span>', value: 'a' },
                        { display: '<span class="math-eq">(-ูง, -ูก)</span>', value: 'b' },
                        { display: '<span class="math-eq">(ูฃ, -ูก)</span>', value: 'c' },
                        { display: '<span class="math-eq">(ูก, -ูง)</span>', value: 'd' }
                    ],
                    correct: 'a',
                    explanation: `<div class='space-y-3 text-center'>
                        <p>ูุญู ูุฐุง ุงููุธุงูุ ุณูุณุชุฎุฏู ุงูุญุฐู ุจุงูุถุฑุจ. ูุฏููุง ูู ุฌุนู ูุนุงููุงุช 'ุต' ูุชุนุงูุณุฉ.</p>
                        <div class='p-2 bg-gray-50 rounded-lg'>
                            <h4 class='font-bold text-purple-700'>ุงูุฎุทูุฉ ูก: ุชุญุฏูุฏ ุนูููุฉ ุงูุถุฑุจ</h4>
                            <p>ูุฌุนู ูุนุงููู 'ุต' (<span class='highlight-number'>ูค</span> ู <span class='highlight-number'>-ูฃ</span>) ูุชุนุงูุณููุ ูุถุฑุจ ุงููุนุงุฏูุฉ ุงูุฃููู ูู <span class='highlight-number'>ูฃ</span> ูุงูุซุงููุฉ ูู <span class='highlight-number'>ูค</span>.</p>
                        </div>
                        <div class='p-2 bg-gray-50 rounded-lg'>
                            <h4 class='font-bold text-purple-700'>ุงูุฎุทูุฉ ูข: ุชูููุฐ ุงูุถุฑุจ</h4>
                            <p><span class='font-bold text-red-500 text-lg'>ร (ูฃ)</span> <span class="math-eq eq-1-bg eq-1-color">ูฃุณ + ูคุต = -ูขูฅ</span> โฉ <span class="math-eq eq-4-bg eq-4-color">ูฉุณ + ูกูขุต = -ูงูฅ</span></p>
                            <p><span class='font-bold text-red-500 text-lg'>ร (ูค)</span> <span class="math-eq eq-2-bg eq-2-color">ูขุณ - ูฃุต = ูฆ</span> โฉ <span class="math-eq eq-5-bg eq-5-color">ูจุณ - ูกูขุต = ูขูค</span></p>
                        </div>
                        <div class='p-2 bg-gray-50 rounded-lg'>
                            <h4 class='font-bold text-purple-700'>ุงูุฎุทูุฉ ูฃ: ุงูุญุฐู ุจุงูุฌูุน</h4>
                            <div class='inline-flex flex-col items-center'>
                                <p class="math-eq eq-4-bg eq-4-color">ูฉุณ + ูกูขุต = -ูงูฅ</p>
                                <p class="math-eq eq-5-bg eq-5-color">ูจุณ - ูกูขุต = ูขูค</p>
                                <div class='border-t-2 border-black w-full my-1'></div>
                                <p class="math-eq">ูกูงุณ = -ูฅูก</p>
                                <p class='text-2xl'>โฉ</p>
                                <p class="math-eq bg-green-200">ุณ = -ูฃ</p>
                            </div>
                        </div>
                        <div class='p-2 bg-gray-50 rounded-lg'>
                            <h4 class='font-bold text-purple-700'>ุงูุฎุทูุฉ ูค: ุฅูุฌุงุฏ 'ุต'</h4>
                            <p>ูุนูุถ <span class='math-eq'>ุณ = -ูฃ</span> ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ ุงูุฃุตููุฉ:</p>
                            <p class="math-eq eq-2-bg eq-2-color">ูข(-ูฃ) - ูฃุต = ูฆ</p>
                            <p class="math-eq">-ูฆ - ูฃุต = ูฆ</p>
                            <p class="math-eq">-ูฃุต = ูกูข</p>
                            <p class="math-eq">ุต = -ูค</p>
                            <p class='mt-2 font-bold'>ุฅุฐูุ ุงูุญู ูู <span class="math-eq bg-green-200">(-ูฃ, -ูค)</span>.</p>
                        </div>
                    </div>`
                },
                {
                    type: 'mcq',
                    level: 'โญโญโญ',
                    topic: 'word_problem',
                    text: 'ุณุนุฑ <span class="highlight-number">ูฃ</span> ุชุฐุงูุฑ ูููุจุงุฑ ูุชุฐูุฑุชูู ููุตุบุงุฑ ูุญุถูุฑ ูุจุงุฑุงุฉ ูู <span class="highlight-number">ูฃูจู</span> ุฑูุงูุงู. ูุณุนุฑ ุชุฐูุฑุชูู ูููุจุงุฑ ู<span class="highlight-number">ูฃ</span> ููุตุบุงุฑ ูู <span class="highlight-number">ูฃูขู</span> ุฑูุงูุงู. ูุง ุณุนุฑ ุชุฐูุฑุฉ ุงููุจุงุฑุ',
                    options: [
                        { display: 'ูฆู ุฑูุงู', value: 'a' },
                        { display: 'ูจู ุฑูุงู', value: 'b' },
                        { display: 'ูคู ุฑูุงู', value: 'c' },
                        { display: 'ูกูู ุฑูุงู', value: 'd' }
                    ],
                    correct: 'd',
                    explanation: 'ููุฑุถ ุณุนุฑ ุชุฐูุฑุฉ ุงููุจุงุฑ (ู) ูุณุนุฑ ุชุฐูุฑุฉ ุงูุตุบุงุฑ (ุต).<br><strong>ุงููุนุงุฏูุฉ ูก:</strong> <span class="math-eq">ูฃู + ูขุต = ูฃูจู</span><br><strong>ุงููุนุงุฏูุฉ ูข:</strong> <span class="math-eq">ูขู + ูฃุต = ูฃูขู</span><br>ูุญุฐู (ุต)ุ ูุถุฑุจ ุงูุฃููู ูู <span class="highlight-number">ูฃ</span> ูุงูุซุงููุฉ ูู <span class="highlight-number">-ูข</span>.<br><span class="math-eq">ูฉู + ูฆุต = ูกูกูคู</span><br><span class="math-eq">-ูคู - ูฆุต = -ูฆูคู</span><br>ูุฌูุน ุงููุนุงุฏูุชูู: <span class="math-eq">ูฅู = ูฅูู</span> โธ <span class="math-eq">ู = ูกูู</span>. ุฅุฐู ุณุนุฑ ุชุฐูุฑุฉ ุงููุจุงุฑ ูกูู ุฑูุงู.'
                },
                {
                    type: 'mcq',
                    level: 'โญโญ',
                    topic: 'special_case_infinite',
                    text: 'ุนูุฏ ุญู ุงููุธุงู: <span class="math-eq">ูขุณ - ุต = ูค</span> ู <span class="math-eq">ูฆุณ - ูฃุต = ูกูข</span> ุจุงูุญุฐูุ ูุงุฐุง ุชููู ุงููุชูุฌุฉุ',
                    options: [
                        { display: 'ุงูุญู ูู <span class="math-eq">(ู, ู)</span>', value: 'a' },
                        { display: 'ูุง ููุฌุฏ ุญู', value: 'b' },
                        { display: 'ููุฌุฏ ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู', value: 'c' },
                        { display: 'ุงูุญู ูู <span class="math-eq">(ูข, ู)</span>', value: 'd' }
                    ],
                    correct: 'c',
                    explanation: 'ูุถุฑุจ ุงููุนุงุฏูุฉ ุงูุฃููู ูู <span class="highlight-number">-ูฃ</span> ูุญุฐู (ุณ):<br><span class="math-eq">-ูฃ(ูขุณ - ุต = ูค)</span> โธ <span class="math-eq">-ูฆุณ + ูฃุต = -ูกูข</span>.<br>ุงูุขู ูุฌูุนูุง ูุน ุงููุนุงุฏูุฉ ุงูุซุงููุฉ <span class="math-eq">ูฆุณ - ูฃุต = ูกูข</span>.<br>ุงููุชูุฌุฉ ูู <span class="math-eq">ู = ู</span>. ูุฐู ุนุจุงุฑุฉ ุตุญูุญุฉ ุฏุงุฆูุงูุ ููุง ูุนูู ุฃู ุงููุนุงุฏูุชูู ูุชูุงูุฆุชูู (ููุณ ุงูุฎุท) ูููุฌุฏ ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู.',
                    smartExplanation: 'ูุงุญุธ ุฃู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ (<span class="math-eq">ูฆุณ - ูฃุต = ูกูข</span>) ูู ููุณูุง ุงููุนุงุฏูุฉ ุงูุฃููู (<span class="math-eq">ูขุณ - ุต = ูค</span>) ูููู ูุถุฑูุจุฉ ูู <span class="highlight-number">ูฃ</span>. ุฅุฐุง ูุงูุช ุฅุญุฏู ุงููุนุงุฏูุงุช ูู ูุถุงุนูุงุช ุงูุฃุฎุฑูุ ูููุง ููุซูุงู ููุณ ุงูุฎุทุ ูุจุงูุชุงูู ููุงู ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู.'
                },
                {
                    type: 'mcq',
                    level: 'โญ',
                    topic: 'elimination_multiplication',
                    text: 'ุญู ุงููุธุงู:<br><span class="math-eq">ูคุณ - ุต = ูฉ</span><br><span class="math-eq">ูขุณ + ูฃุต = -ูก</span>',
                    options: [
                        { display: '<span class="math-eq">(ูข, -ูก)</span>', value: 'a' },
                        { display: '<span class="math-eq">(-ูก, ูข)</span>', value: 'b' },
                        { display: '<span class="math-eq">(ูก, -ูฅ)</span>', value: 'c' },
                        { display: '<span class="math-eq">(ูฃ, ูฃ)</span>', value: 'd' }
                    ],
                    correct: 'a',
                    explanation: 'ูุถุฑุจ ุงููุนุงุฏูุฉ ุงูุฃููู ูู ูฃ ูุญุฐู ุต. <br> ูกูขุณ - ูฃุต = ูขูง <br> ูขุณ + ูฃุต = -ูก <br> ุจุงูุฌูุน: ูกูคุณ = ูขูฆ โธ ุณ = ูข. ุจุงูุชุนููุถ: ูค(ูข) - ุต = ูฉ โธ ูจ - ุต = ูฉ โธ ุต = -ูก. ุงูุญู ูู (ูข, -ูก).'
                },
                {
                    type: 'mcq',
                    level: 'โญ',
                    topic: 'elimination_multiplication',
                    text: 'ุญู ุงููุธุงู:<br><span class="math-eq">ุณ + ูขุต = ูจ</span><br><span class="math-eq">ูฃุณ + ุต = ูฉ</span>',
                    options: [
                        { display: '<span class="math-eq">(ูค, ูข)</span>', value: 'a' },
                        { display: '<span class="math-eq">(ูข, ูฃ)</span>', value: 'b' },
                        { display: '<span class="math-eq">(ู, ูค)</span>', value: 'c' },
                        { display: '<span class="math-eq">(ูฃ, ูข.ูฅ)</span>', value: 'd' }
                    ],
                    correct: 'b',
                    explanation: 'ูุถุฑุจ ุงููุนุงุฏูุฉ ุงูุซุงููุฉ ูู -ูข ูุญุฐู ุต. <br> ุณ + ูขุต = ูจ <br> -ูฆุณ - ูขุต = -ูกูจ <br> ุจุงูุฌูุน: -ูฅุณ = -ูกู โธ ุณ = ูข. ุจุงูุชุนููุถ: ูข + ูขุต = ูจ โธ ูขุต = ูฆ โธ ุต = ูฃ. ุงูุญู ูู (ูข, ูฃ).'
                },
                {
                    type: 'mcq',
                    level: 'โญโญ',
                    topic: 'elimination_multiplication',
                    text: 'ุญู ุงููุธุงู:<br><span class="math-eq">ูขุณ + ูฃุต = ูก</span><br><span class="math-eq">ูฃุณ + ูฅุต = ูข</span>',
                    options: [
                        { display: '<span class="math-eq">(-ูก, ูก)</span>', value: 'a' },
                        { display: '<span class="math-eq">(ูข, -ูก)</span>', value: 'b' },
                        { display: '<span class="math-eq">(ูก, -<span class="fraction"><span>ูก</span><span class="frac-bar"></span><span>ูฃ</span></span>)</span>', value: 'c' },
                        { display: '<span class="math-eq">(ูค, -ูฃ)</span>', value: 'd' }
                    ],
                    correct: 'a',
                    explanation: 'ูุถุฑุจ ุงูุฃููู ูู ูฃ ูุงูุซุงููุฉ ูู -ูข ูุญุฐู ุณ. <br> ูฆุณ + ูฉุต = ูฃ <br> -ูฆุณ - ูกูุต = -ูค <br> ุจุงูุฌูุน: -ุต = -ูก โธ ุต = ูก. ุจุงูุชุนููุถ: ูขุณ + ูฃ(ูก) = ูก โธ ูขุณ = -ูข โธ ุณ = -ูก. ุงูุญู ูู (-ูก, ูก).'
                },
                {
                    type: 'mcq',
                    level: 'โญโญ',
                    topic: 'word_problem',
                    text: 'ูุฌููุน ุนูุฑ ุฃุจ ูุงุจูู ูฆู ุนุงูุงู. ููุจู ูฅ ุณููุงุชุ ูุงู ุนูุฑ ุงูุฃุจ ุฃุฑุจุนุฉ ุฃุถุนุงู ุนูุฑ ุงุจูู. ูู ุนูุฑ ูู ููููุง ุงูุขูุ',
                    options: [
                        { display: 'ุงูุฃุจ ูฅูุ ุงูุงุจู ูกู', value: 'a' },
                        { display: 'ุงูุฃุจ ูคูฅุ ุงูุงุจู ูกูฅ', value: 'b' },
                        { display: 'ุงูุฃุจ ูคูุ ุงูุงุจู ูขู', value: 'c' },
                        { display: 'ุงูุฃุจ ูฅูฅุ ุงูุงุจู ูฅ', value: 'd' }
                    ],
                    correct: 'b',
                    explanation: 'ููุฑุถ ุนูุฑ ุงูุฃุจ (ุฃ) ูุนูุฑ ุงูุงุจู (ุจ). <br> ุฃ + ุจ = ูฆู <br> ุฃ - ูฅ = ูค(ุจ - ูฅ) โธ ุฃ - ูคุจ = -ูกูฅ. <br> ุจุทุฑุญ ุงููุนุงุฏูุชูู: ูฅุจ = ูงูฅ โธ ุจ = ูกูฅ. ุจุงูุชุนููุถ: ุฃ + ูกูฅ = ูฆู โธ ุฃ = ูคูฅ. ุนูุฑ ุงูุฃุจ ูคูฅ ูุงูุงุจู ูกูฅ.'
                },
                {
                    type: 'mcq',
                    level: 'โญโญ',
                    topic: 'special_case_no_solution',
                    text: 'ูุงุฐุง ูุญุฏุซ ุนูุฏ ุญู ุงููุธุงู:<br><span class="math-eq">ุณ - ูขุต = ูฅ</span><br><span class="math-eq">ูฃุณ - ูฆุต = ูกู</span>',
                    options: [
                        { display: 'ุญู ูุญูุฏ', value: 'a' },
                        { display: 'ูุง ููุฌุฏ ุญู', value: 'b' },
                        { display: 'ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู', value: 'c' },
                        { display: 'ุงูุญู ูู (ูก, -ูข)', value: 'd' }
                    ],
                    correct: 'b',
                    explanation: 'ูุถุฑุจ ุงููุนุงุฏูุฉ ุงูุฃููู ูู -ูฃ. <br> -ูฃุณ + ูฆุต = -ูกูฅ <br> ูฃุณ - ูฆุต = ูกู <br> ุจุงูุฌูุน ูุญุตู ุนูู: ู = -ูฅ. ูุฐู ุนุจุงุฑุฉ ุฎุงุทุฆุฉุ ูุฐุง ูุง ููุฌุฏ ุญู ูููุธุงู.'
                },
                {
                    type: 'mcq',
                    level: 'โญโญโญ',
                    topic: 'elimination_multiplication',
                    text: 'ุญู ุงููุธุงู:<br><span class="math-eq">ูฅุณ - ูขุต = -ูกูฉ</span><br><span class="math-eq">ูขุณ + ูฃุต = ู</span>',
                    options: [
                        { display: '<span class="math-eq">(ูก, ูกูข)</span>', value: 'a' },
                        { display: '<span class="math-eq">(-ูฅ, -ูฃ)</span>', value: 'b' },
                        { display: '<span class="math-eq">(ูฃ, -ูข)</span>', value: 'c' },
                        { display: '<span class="math-eq">(-ูฃ, ูข)</span>', value: 'd' }
                    ],
                    correct: 'd',
                    explanation: 'ูุถุฑุจ ุงูุฃููู ูู ูฃ ูุงูุซุงููุฉ ูู ูข ูุญุฐู ุต. <br> ูกูฅุณ - ูฆุต = -ูฅูง <br> ูคุณ + ูฆุต = ู <br> ุจุงูุฌูุน: ูกูฉุณ = -ูฅูง โธ ุณ = -ูฃ. ุจุงูุชุนููุถ: ูข(-ูฃ) + ูฃุต = ู โธ -ูฆ + ูฃุต = ู โธ ูฃุต = ูฆ โธ ุต = ูข. ุงูุญู ูู (-ูฃ, ูข).'
                },
                {
                    type: 'mcq',
                    level: 'โญโญโญ',
                    topic: 'word_problem',
                    text: 'ูู ูุญู ููุญููุงูุงุช ุงูุฃูููุฉุ ููุฌุฏ ุทููุฑ ููุทุท ููุท. ุฅุฐุง ูุงู ูุฌููุน ุงูุฑุคูุณ ูู ูขู ููุฌููุน ุงูุฃุฑุฌู ูู ูฅูคุ ููู ุนุฏุฏ ุงูุทููุฑ ูุงููุทุทุ',
                    options: [
                        { display: 'ูกู ุทููุฑ ู ูกู ูุทุท', value: 'a' },
                        { display: 'ูกูฅ ุทูุฑ ู ูฅ ูุทุท', value: 'b' },
                        { display: 'ูง ุทููุฑ ู ูกูฃ ูุทุฉ', value: 'c' },
                        { display: 'ูกูฃ ุทูุฑ ู ูง ูุทุท', value: 'd' }
                    ],
                    correct: 'd',
                    explanation: 'ููุฑุถ ุนุฏุฏ ุงูุทููุฑ (ุท) ูุนุฏุฏ ุงููุทุท (ู). <br> ุท + ู = ูขู (ูุนุงุฏูุฉ ุงูุฑุคูุณ) <br> ูขุท + ูคู = ูฅูค (ูุนุงุฏูุฉ ุงูุฃุฑุฌู). <br> ูุถุฑุจ ุงูุฃููู ูู -ูข: -ูขุท - ูขู = -ูคู. <br> ุจุงูุฌูุน ูุน ุงููุนุงุฏูุฉ ุงูุซุงููุฉ: ูขู = ูกูค โธ ู = ูง. ุจุงูุชุนููุถ: ุท + ูง = ูขู โธ ุท = ูกูฃ. ุงูุญู: ูกูฃ ุทูุฑ ู ูง ูุทุท.'
                }
            ];
            const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
            const questionCount = Math.min(shuffled.length, 5);
            return shuffled.slice(0, questionCount);
        }

    });
    </script>
</body>
</html>
