<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدرس ١-٤: حل المعادلات التي تحتوي متغيراً في طرفيها | منصة الرياضيات التفاعلية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-change { color: #ef4444; font-weight: bold; }
        
        /* === تعديل الرموز الرياضية === */
        .math-eq {
            font-family: "Courier New", monospace; /* خط عريض ومتباعد */
            font-size: 1.1rem; /* تكبير حجم الخط */
            font-weight: bold;
            color: #4338ca;
            background-color: #f3f4f6; /* خلفية رمادية فاتحة */
            border: 1px solid #d1d5db; /* إطار خفيف */
            padding: 2px 8px; /* هوامش داخلية */
            border-radius: 6px; /* زوايا دائرية */
            display: inline-block;
            vertical-align: middle; /* محاذاة أفضل مع النص */
            white-space: nowrap;
        }
        
        /* يجعل المعادلات داخل حاوية الخطوات تظهر بشكل عمودي */
        .math-steps .math-eq {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-5xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">الدرس ١-٤: حل المعادلات التي تحتوي متغيراً في طرفيها</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; العودة إلى الفهرس</a>
                </header>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفهوم الأساسي</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                        <p>لحل معادلة تحتوي متغيراً في طرفيها، هدفنا هو <strong class="text-red-600">جمع حدود المتغيرات في طرف، والأعداد الثابتة في الطرف الآخر</strong>، ثم نحل المعادلة كما تعلمنا في الدروس السابقة.</p>
                    </div>
                </section>
                
                <!-- Part 2: Solving Basic Equations -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: حل معادلات بسيطة</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:items-start">
                            <!-- Example 1 -->
                            <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4 text-center">مثال ١: حل المعادلة <span class="math-eq">٧س + ١٢ = ٣س - ٤</span></p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4 pt-16"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: جمع المتغيرات</h4><p>نطرح <span class="math-eq">٣س</span> من كلا الطرفين.</p><div class="math-steps text-center mt-2 space-y-1"><div class="math-eq">٧س <span class="highlight-change">- ٣س</span> + ١٢ = ٣س <span class="highlight-change">- ٣س</span> - ٤</div><div class="math-eq">٤س + ١٢ = -٤</div></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: جمع الثوابت</h4><p>نطرح <span class="math-eq">١٢</span> من كلا الطرفين.</p><div class="math-steps text-center mt-2 space-y-1"><div class="math-eq">٤س + ١٢ <span class="highlight-change">- ١٢</span> = -٤ <span class="highlight-change">- ١٢</span></div><div class="math-eq">٤س = -١٦</div></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: عزل المتغير</h4><p>نقسم كلا الطرفين على <span class="math-eq">٤</span>.</p><div class="math-steps text-center mt-2 flex justify-center items-center"><span class="fraction"><span>٤س</span><span class="frac-bar"></span><span>٤</span></span> = <span class="fraction"><span>-١٦</span><span class="frac-bar"></span><span>٤</span></span></div></div>
                                    <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">س = -٤</span>.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                             <!-- Example 2 -->
                            <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4 text-center">مثال ٢: حل المعادلة <span class="math-eq">٢ك + ٨ = ٥ك + ٢</span></p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                     <div class="interactive-placeholder text-center text-gray-500 p-4 pt-16"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                     <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: جمع المتغيرات</h4><p>نطرح <span class="math-eq">٢ك</span> من كلا الطرفين.</p><div class="math-steps text-center mt-2 space-y-1"><div class="math-eq">٢ك <span class="highlight-change">- ٢ك</span> + ٨ = ٥ك <span class="highlight-change">- ٢ك</span> + ٢</div><div class="math-eq">٨ = ٣ك + ٢</div></div></div>
                                     <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: جمع الثوابت</h4><p>نطرح <span class="math-eq">٢</span> من كلا الطرفين.</p><div class="math-steps text-center mt-2 space-y-1"><div class="math-eq">٨ <span class="highlight-change">- ٢</span> = ٣ك + ٢ <span class="highlight-change">- ٢</span></div><div class="math-eq">٦ = ٣ك</div></div></div>
                                     <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: عزل المتغير</h4><p>نقسم كلا الطرفين على <span class="math-eq">٣</span>.</p><div class="math-steps text-center mt-2 flex justify-center items-center"><span class="fraction"><span>٦</span><span class="frac-bar"></span><span>٣</span></span> = <span class="fraction"><span>٣ك</span><span class="frac-bar"></span><span>٣</span></span></div></div>
                                     <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">٢ = ك</span>.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Part 3: Special Cases -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثالثاً: معادلات خاصة (المتطابقة والمستحيلة)</h2>
                     <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:items-start">
                             <!-- Example 3 -->
                            <div id="interactive-container-3" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4 text-center">مثال ٣ (متطابقة): حل <span class="math-eq">٦(ن + ٤) = ٢(١٢ + ٣ن)</span></p>
                                <div class="steps-container space-y-4 min-h-[200px]">
                                     <div class="interactive-placeholder text-center text-gray-500 p-4 pt-16"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                     <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: فك الأقواس</h4><p>نوزع الضرب على الجمع في كلا الطرفين.</p><p class="math-eq text-center mt-2">٦ن + ٢٤ = ٢٤ + ٦ن</p></div>
                                     <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تحليل المعادلة</h4><p>لاحظ أن الطرف الأيمن للمعادلة يطابق الطرف الأيسر تماماً.</p></div>
                                     <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>هذا يعني أن المعادلة صحيحة دائماً <strong class="text-red-600">لأي قيمة</strong> للمتغير <span class="math-eq">ن</span>. مجموعة الحل هي <span class="vocab-term">جميع الأعداد الحقيقية</span>.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                             <!-- Example 4 -->
                            <div id="interactive-container-4" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4 text-center">مثال ٤ (مستحيلة الحل): حل <span class="math-eq">٣(٢م - ١) = ٦م + ٥</span></p>
                                <div class="steps-container space-y-4 min-h-[200px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4 pt-16"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: فك الأقواس</h4><p>نوزع الضرب على الجمع في الطرف الأيمن.</p><p class="math-eq text-center mt-2">٦م - ٣ = ٦م + ٥</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: جمع المتغيرات</h4><p>نطرح <span class="math-eq">٦م</span> من كلا الطرفين.</p><div class="math-steps text-center mt-2 space-y-1"><div class="math-eq">٦م <span class="highlight-change">- ٦م</span> - ٣ = ٦م <span class="highlight-change">- ٦م</span> + ٥</div><div class="math-eq">-٣ = ٥</div></div></div>
                                    <div class="step-interactive p-4 bg-red-200 rounded-lg step-box border-red-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>العبارة الناتجة <strong class="text-red-600">خاطئة دائماً</strong>. هذا يعني أنه لا توجد قيمة للمتغير <span class="math-eq">م</span> تجعل المعادلة صحيحة. مجموعة الحل هي <span class="vocab-term">المجموعة الخالية (∅)</span>.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="4" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="4" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="4" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Part 4: Number Theory Applications -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 رابعاً: تطبيقات على نظرية الأعداد</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:items-start">
                            <!-- Example 5 -->
                            <div id="interactive-container-5" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4 text-center">مثال ٥</p>
                                <p class="text-center mb-4">عددان زوجيان متتاليان، يقل أربعة أمثال أصغرهما عن مثلي أكبرهما بمقدار ١٢. فما العددان؟</p>
                                <div class="steps-container space-y-4 min-h-[320px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4 pt-16"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد المتغيرات</h4><p>نفرض أن العدد الأصغر هو <span class="math-eq">ن</span>، والأكبر هو <span class="math-eq">ن + ٢</span>.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: كتابة المعادلة</h4><p class="math-eq text-center mt-2">٤ن = ٢(ن + ٢) - ١٢</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: حل المعادلة (أ)</h4><p>أولاً، نفك القوس:</p><div class="math-steps text-center mt-2"><p class="math-eq">٤ن = ٢ن + ٤ - ١٢</p></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: حل المعادلة (ب)</h4><p>ثانياً، نبسط الطرف الأيسر:</p><div class="math-steps text-center mt-2"><p class="math-eq">٤ن = ٢ن - ٨</p></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: حل المعادلة (ج)</h4><p>ثالثاً، نطرح <span class="math-eq">٢ن</span> من الطرفين:</p><div class="math-steps text-center mt-2"><p class="math-eq">٤ن <span class="highlight-change">- ٢ن</span> = ٢ن - ٨ <span class="highlight-change">- ٢ن</span></p><p class="math-eq">٢ن = -٨</p></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: حل المعادلة (د)</h4><p>أخيراً، نقسم على <span class="math-eq">٢</span>:</p><div class="math-steps text-center mt-2"><p class="math-eq">ن = -٤</p></div></div>
                                    <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>العدد الأصغر هو <span class="math-eq">-٤</span>، والأكبر هو <span class="math-eq">-٢</span>.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="5" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="5" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="5" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                             <!-- Example 6 -->
                            <div id="interactive-container-6" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4 text-center">مثال ٦</p>
                                <p class="text-center mb-4">عمر أحمد يزيد ٦ سنوات عن عمر أخيه علي. بعد ٤ سنوات، سيصبح مجموع عمريهما ٤٠ سنة. فما عمر كل منهما الآن؟</p>
                                <div class="steps-container space-y-4 min-h-[320px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4 pt-16"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد المتغيرات</h4><div class="math-steps space-y-1"><p>عمر علي الآن = <span class="math-eq">س</span></p><p>عمر أحمد الآن = <span class="math-eq">س + ٦</span></p></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: كتابة المعادلة</h4><p>عمر علي بعد ٤ سنوات: <span class="math-eq">س + ٤</span></p><p>عمر أحمد بعد ٤ سنوات: <span class="math-eq">(س + ٦) + ٤</span></p><p class="math-eq text-center mt-2">(س + ٤) + (س + ١٠) = ٤٠</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: حل المعادلة (أ)</h4><p>أولاً، نجمع الحدود المتشابهة:</p><div class="math-steps text-center mt-2"><p class="math-eq">٢س + ١٤ = ٤٠</p></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: حل المعادلة (ب)</h4><p>ثانياً، نطرح <span class="math-eq">١٤</span> من الطرفين:</p><div class="math-steps text-center mt-2"><p class="math-eq">٢س = ٤٠ <span class="highlight-change">- ١٤</span></p><p class="math-eq">٢س = ٢٦</p></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 3: حل المعادلة (ج)</h4><p>أخيراً، نقسم على <span class="math-eq">٢</span>:</p><div class="math-steps text-center mt-2"><p class="math-eq">س = ١٣</p></div></div>
                                    <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>عمر علي الآن <span class="math-eq">١٣</span> سنة، وعمر أحمد <span class="math-eq">١٩</span> سنة.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="6" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="6" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="6" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Part 5: Geometry Application -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 خامساً: تطبيقات على الهندسة</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div id="interactive-container-7" class="p-4 bg-white rounded-lg shadow max-w-lg mx-auto">
                            <p class="text-lg font-semibold mb-4 text-center">مثال ٧</p>
                            <p class="text-center mb-2">أوجد قيمة <span class="math-eq">س</span> التي تجعل مساحتي المستطيلين متساويتين.</p>
                            <div class="flex flex-col md:flex-row items-center justify-center gap-16 py-8">
                                <div class="relative">
                                    <div class="w-40 h-32 bg-amber-300 border-2 border-amber-500 rounded-lg shadow-md"></div>
                                    <span class="absolute -bottom-7 left-1/2 -translate-x-1/2 text-lg font-bold text-gray-700">س</span>
                                    <span class="absolute -right-7 top-1/2 -translate-y-1/2 text-lg font-bold text-gray-700">١٢</span>
                                </div>
                                <div class="relative">
                                    <div class="w-32 h-40 bg-amber-300 border-2 border-amber-500 rounded-lg shadow-md"></div>
                                    <span class="absolute -bottom-7 left-1/2 -translate-x-1/2 text-lg font-bold text-gray-700">١٦</span>
                                    <span class="absolute -right-12 top-1/2 -translate-y-1/2 text-lg font-bold text-gray-700">س - ٢</span>
                                </div>
                            </div>
                            <div class="steps-container space-y-4 min-h-[250px]">
                                <div class="interactive-placeholder text-center text-gray-500 p-4 pt-12"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: كتابة المعادلة</h4><p>مساحة أ = مساحة ب</p><p class="text-center text-gray-600 text-sm my-2">الطول أ × العرض أ = الطول ب × العرض ب</p><p class="math-eq text-center mt-2">١٢س = ١٦(س - ٢)</p></div>
                                <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: حل المعادلة (أ)</h4><p>أولاً، نفك القوس:</p><div class="math-steps text-center mt-2"><p class="math-eq">١٢س = ١٦س - ٣٢</p></div></div>
                                <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: حل المعادلة (ب)</h4><p>ثانياً، نطرح <span class="math-eq">١٦س</span> من الطرفين:</p><div class="math-steps text-center mt-2"><p class="math-eq">١٢س <span class="highlight-change">- ١٦س</span> = ١٦س - ٣٢ <span class="highlight-change">- ١٦س</span></p><p class="math-eq">-٤س = -٣٢</p></div></div>
                                <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: حل المعادلة (ج)</h4><p>أخيراً، نقسم على <span class="math-eq">-٤</span>:</p><div class="math-steps text-center mt-2"><p class="math-eq flex justify-center items-center"><span class="fraction"><span>-٤س</span><span class="frac-bar"></span><span>-٤</span></span> = <span class="fraction"><span>-٣٢</span><span class="frac-bar"></span><span>-٤</span></span></p></div></div>
                                <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>قيمة <span class="math-eq">س</span> هي <span class="math-eq">٨</span>.</p></div>
                            </div>
                            <div class="flex justify-between mt-6">
                                <button data-example="7" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                <div>
                                    <button data-example="7" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                    <button data-example="7" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Part 6: Interactive Quiz -->
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">✍️ سادساً: حان دورك! اختبر فهمك</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">نتيجتك النهائية</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">إعادة الاختبار</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">💡 شرح الإجابة</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">منصة الرياضيات التفاعلية</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">منصة الرياضيات التفاعلية</h1></a>`; } let userInfoHtml = ''; if (studentData) { userInfoHtml = `<div class="flex items-center gap-4"><span class="font-semibold">أهلاً، ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">خروج</a></div>`; } else { userInfoHtml = `<p class="text-lg text-gray-600">زائر</p>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; const logoutLink = headerContainer.querySelector('#logout-link'); if(logoutLink) { logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); } }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">© 2024 جميع الحقوق محفوظة | تصميم وتطوير: أ. عبدالعزيز خالد العبلان</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">لا توجد أسئلة متاحة لهذا الدرس حالياً.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `المحاولات المتبقية: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div id="explanation-buttons-${index}" class="hidden mt-2 space-x-4"></div></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">تحقق من إجاباتي</button>`; if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'لا توجد محاولات متبقية'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = '✔ إجابة صحيحة!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `❌ إجابة خاطئة.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } const explanationBtnsContainer = document.getElementById(`explanation-buttons-${index}`); explanationBtnsContainer.classList.remove('hidden'); explanationBtnsContainer.innerHTML = `<button type="button" class="text-xs text-blue-600 hover:underline" onclick="showExplanation(${index}, 'explanation')">اعرف لماذا؟</button>`; if (q.smartExplanation) { explanationBtnsContainer.innerHTML += `<button type="button" class="text-xs text-purple-600 hover:underline" onclick="showExplanation(${index}, 'smartExplanation')">الحل الذكي 🧠</button>`; } }); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentData) { saveGrade(lessonId, finalGrade, studentData.id); if (attemptsLeft - 1 > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'تم عرض نتيجتك. سجل الدخول لحفظ تقدمك.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade, studentId) { if (!studentId) return; const saveStatus = document.getElementById('save-status'); saveStatus.textContent = 'جارٍ حفظ نتيجتك...'; const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&lessonId=${lessonId}&grade=${grade}`; fetch(url) .then(res => res.json()) .then(result => { if (result.status === 'success') { saveStatus.textContent = '✔ تم حفظ نتيجتك بنجاح! ستظهر في لوحة التحكم عند العودة.'; const studentData = JSON.parse(localStorage.getItem('currentStudent')); if (!studentData.lessons) studentData.lessons = {}; if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; } else { studentData.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(studentData)); } else { throw new Error(result.message); } }) .catch(error => { saveStatus.textContent = '❌ حدث خطأ أثناء حفظ الدرجة.'; console.error("Save Grade Error:", error); }); }
    window.showExplanation = function(questionIndex, type) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); const question = currentQuestions[questionIndex]; if(modal && explanationText && question) { const explanationContent = question[type]; if (explanationContent) { explanationText.innerHTML = explanationContent; modal.classList.remove('hidden'); } } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    
    // === محتوى الدرس المحدد ===
    const LESSON_ID = 'c1_l4'; 
    function generateQuiz() { 
        const questionBank = [
             { 
              id: 'number-theory-equation',
              type: 'mcq', 
              level: '⭐⭐⭐', 
              topic: 'word-to-equation', 
              text: 'عددان فرديان متتاليان، يقل مثلي أصغرهما عن ثلاثة أمثال أكبرهما بمقدار ٩. أي المعادلات التالية تمثل هذه المسألة؟ (افرض أن أصغر عدد هو ن)', 
              options: [ 
                  { display: '<span class="math-eq">٢ن = ٣(ن+٢) - ٩</span>', value: '2n = 3(n+2) - 9' }, 
                  { display: '<span class="math-eq">٣ن = ٢(ن+٢) + ٩</span>', value: '3n = 2(n+2) + 9' }, 
                  { display: '<span class="math-eq">٢ن = ٣(ن+١) - ٩</span>', value: '2n = 3(n+1) - 9' }, 
                  { display: '<span class="math-eq">٢ن = ٣ن + ٢ - ٩</span>', value: '2n = 3n+2-9' } 
              ], 
              correct: '2n = 3(n+2) - 9', 
              explanation: `<p class='mb-2'>لترجمة المسألة، نفككها كالتالي:</p>
                          <ul class='list-disc list-inside text-right space-y-1'>
                            <li>العدد الفردي الأصغر: <span class='math-eq'>ن</span></li>
                            <li>العدد الفردي الأكبر (التالي له): <span class='math-eq'>ن + ٢</span></li>
                            <li>"مثلي أصغرهما": <span class='math-eq'>٢ن</span></li>
                            <li>"ثلاثة أمثال أكبرهما": <span class='math-eq'>٣(ن + ٢)</span></li>
                            <li>عبارة "يقل عن ... بمقدار ٩" تعني أن الطرف الأول يساوي الطرف الثاني مطروحاً منه ٩.</li>
                          </ul>
                          <p class='mt-3 p-2 bg-green-100 rounded-md'>إذن، المعادلة الصحيحة هي: <span class='math-eq'>٢ن = ٣(ن + ٢) - ٩</span>.</p>`,
              smartExplanation: `<p>كلمة "يقل عن" تعني أن الطرف الأول هو الأصغر. "مثلي أصغرهما" (<span class='math-eq'>٢ن</span>) يجب أن يساوي "ثلاثة أمثال أكبرهما" (<span class='math-eq'>٣(ن+٢)</span>) بعد أن نطرح منه ٩.</p>`
            },
            { 
              id: 'number-theory-equation-2',
              type: 'mcq', 
              level: '⭐⭐⭐', 
              topic: 'word-to-equation', 
              text: 'عددان زوجيان متتاليان، يقل خمسة أمثال أكبرهما عن سبعة أمثال أصغرهما بمقدار ٤. أي المعادلات التالية تمثل هذه المسألة؟ (افرض أن أصغر عدد هو ن)', 
              options: [ 
                  { display: '<span class="math-eq">٥(ن+٢) = ٧ن - ٤</span>', value: '5(n+2) = 7n - 4' }, 
                  { display: '<span class="math-eq">٥(ن+٢) + ٤ = ٧ن</span>', value: '5(n+2) + 4 = 7n' }, 
                  { display: '<span class="math-eq">٧ن = ٥(ن+٢) - ٤</span>', value: '7n = 5(n+2) - 4' }, 
                  { display: '<span class="math-eq">٥ن = ٧(ن+٢) - ٤</span>', value: '5n = 7(n+2) - 4' } 
              ], 
              correct: '5(n+2) = 7n - 4', 
              explanation: `<p class='mb-2'>لترجمة المسألة، نفككها كالتالي:</p>
                          <ul class='list-disc list-inside text-right space-y-1'>
                            <li>العدد الزوجي الأصغر: <span class='math-eq'>ن</span></li>
                            <li>العدد الزوجي الأكبر (التالي له): <span class='math-eq'>ن + ٢</span></li>
                            <li>"خمسة أمثال أكبرهما": <span class='math-eq'>٥(ن + ٢)</span></li>
                            <li>"سبعة أمثال أصغرهما": <span class='math-eq'>٧ن</span></li>
                            <li>عبارة "يقل ... عن ... بمقدار ٤" تعني أن الطرف الأول (خمسة أمثال أكبرهما) يساوي الطرف الثاني (سبعة أمثال أصغرهما) مطروحاً منه ٤.</li>
                          </ul>
                          <p class='mt-3 p-2 bg-green-100 rounded-md'>إذن، المعادلة الصحيحة هي: <span class='math-eq'>٥(ن + ٢) = ٧ن - ٤</span>.</p>`,
              smartExplanation: `<p>كلمة "يقل عن" تعني أن الطرف الأول هو الأصغر. "خمسة أمثال أكبرهما" (<span class='math-eq'>٥(ن+٢)</span>) يجب أن يساوي "سبعة أمثال أصغرهما" (<span class='math-eq'>٧ن</span>) بعد أن نطرح منه ٤.</p>`
            },
            { type: 'mcq', level: '⭐', topic: 'both-sides', text: 'حل المعادلة: <span class="math-eq">٥س + ٢ = ٢س + ١٤</span>', 
              options: [ { display: '<span class="math-eq">٤</span>', value: '٤' }, { display: '<span class="math-eq">٦</span>', value: '٦' }, { display: '<span class="math-eq">٣</span>', value: '٣' }, { display: '<span class="math-eq">١٢</span>', value: '١٢' } ], 
              correct: '٤', 
              explanation: `<p class='mb-2'>نجمع المتغيرات في طرف والثوابت في الطرف الآخر.</p><div class='text-right space-y-2'><p>أولاً: نطرح ٢س من الطرفين: <span class='math-eq'>٥س <span class='highlight-change'>- ٢س</span> + ٢ = ٢س <span class='highlight-change'>- ٢س</span> + ١٤</span></p><p>ثانياً: نبسط: <span class='math-eq'>٣س + ٢ = ١٤</span></p><p>ثالثاً: نطرح ٢ من الطرفين: <span class='math-eq'>٣س + ٢ <span class='highlight-change'>- ٢</span> = ١٤ <span class='highlight-change'>- ٢</span></span></p><p>رابعاً: نبسط: <span class='math-eq'>٣س = ١٢</span></p><p>خامساً: نقسم الطرفين على ٣: <span class='math-eq flex justify-center items-center'><span class="fraction"><span>٣س</span><span class="frac-bar"></span><span>٣</span></span> = <span class="fraction"><span>١٢</span><span class="frac-bar"></span><span>٣</span></span></span></p><p>الحل: <span class='math-eq'>س = ٤</span></p></div>`,
              smartExplanation: `<p>لنجرب تعويض الخيار الأول (٤):</p><p>الطرف الأيمن: <span class='math-eq'>٥(٤) + ٢ = ٢٠ + ٢ = ٢٢</span></p><p>الطرف الأيسر: <span class='math-eq'>٢(٤) + ١٤ = ٨ + ١٤ = ٢٢</span></p><p>بما أن الطرفين متساويان، فالإجابة صحيحة.</p>`
            },
            { type: 'mcq', level: '⭐⭐', topic: 'parentheses', text: 'حل المعادلة: <span class="math-eq">٣(ك - ٥) = ٢(ك + ١)</span>', 
              options: [ { display: '<span class="math-eq">١٧</span>', value: '١٧' }, { display: '<span class="math-eq">-١٣</span>', value: '-١٣' }, { display: '<span class="math-eq">١٦</span>', value: '١٦' }, { display: '<span class="math-eq">٤</span>', value: '٤' } ], 
              correct: '١٧', 
              explanation: `<p class='mb-2'>نستخدم خاصية التوزيع أولاً.</p><div class='text-right space-y-2'><p>أولاً: فك الأقواس: <span class='math-eq'>٣ك - ١٥ = ٢ك + ٢</span></p><p>ثانياً: نطرح ٢ك من الطرفين: <span class='math-eq'>٣ك <span class='highlight-change'>- ٢ك</span> - ١٥ = ٢ك <span class='highlight-change'>- ٢ك</span> + ٢</span></p><p>ثالثاً: نبسط: <span class='math-eq'>ك - ١٥ = ٢</span></p><p>رابعاً: نضيف ١٥ للطرفين: <span class='math-eq'>ك - ١٥ <span class='highlight-change'>+ ١٥</span> = ٢ <span class='highlight-change'>+ ١٥</span></span></p><p>خامساً: الحل النهائي: <span class='math-eq'>ك = ١٧</span></p></div>`,
              smartExplanation: `<p>لنجرب تعويض الخيار (١٧):</p><p>الطرف الأيمن: <span class='math-eq'>٣(١٧ - ٥) = ٣(١٢) = ٣٦</span></p><p>الطرف الأيسر: <span class='math-eq'>٢(١٧ + ١) = ٢(١٨) = ٣٦</span></p><p>الطرفان متساويان، إذن الإجابة صحيحة.</p>`
            },
            { type: 'mcq', level: '⭐⭐⭐', topic: 'no-solution', text: 'ما هو حل المعادلة: <span class="math-eq">٨ + ٤م = ٤م - ١</span>؟', 
              options: [ { display: '<span class="math-eq">م = ٢</span>', value: '2' }, { display: '<span class="math-eq">جميع الأعداد الحقيقية</span>', value: 'all' }, { display: '<span class="math-eq">مستحيلة الحل (∅)</span>', value: 'none' }, { display: '<span class="math-eq">م = -٢</span>', value: '-2' } ], 
              correct: 'none', 
              explanation: `<p class='mb-2'>نحاول جمع المتغيرات في طرف.</p><div class='text-right space-y-2'><p>المعادلة: <span class='math-eq'>٨ + ٤م = ٤م - ١</span></p><p>نطرح ٤م من الطرفين: <span class='math-eq'>٨ + ٤م <span class='highlight-change'>- ٤م</span> = ٤م - ١ <span class='highlight-change'>- ٤م</span></span></p><p>نبسط لنجد: <span class='math-eq'>٨ = -١</span></p><p class='mt-2 p-2 bg-red-100 rounded-md'>بما أن العبارة "٨ = -١" خاطئة دائماً، فهذه المعادلة ليس لها حل. وتسمى معادلة مستحيلة الحل.</p></div>`,
              smartExplanation: `<p>بمجرد النظر، نلاحظ أن المتغير <span class='math-eq'>٤م</span> موجود في كلا الطرفين بنفس الإشارة. عند حذفهما، يتبقى <span class='math-eq'>٨ = -١</span> وهي عبارة خاطئة، مما يعني أن الحل هو المجموعة الخالية.</p>`
            },
            { type: 'mcq', level: '⭐⭐', topic: 'fractions', text: 'حل المعادلة: <span class="math-eq flex justify-center items-center"><span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span>ع - ٤ = <span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٤</span></span>ع</span>', 
              options: [ { display: '<span class="math-eq">ع = ١٦</span>', value: '16' }, { display: '<span class="math-eq">ع = -١٦</span>', value: '-16' }, { display: '<span class="math-eq">ع = ٨</span>', value: '8' }, { display: '<span class="math-eq">ع = -٨</span>', value: '-8' } ], 
              correct: '-16', 
              explanation: `<p class='mb-2'>للتخلص من الكسور، نضرب طرفي المعادلة في المضاعف المشترك الأصغر للمقامات (وهو ٤).</p><div class='text-right space-y-2'><p>المعادلة: <span class='math-eq'>٤ × (<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span>ع - ٤ ) = ٤ × ( <span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٤</span></span>ع )</span></p><p>نوزع الضرب: <span class='math-eq'>٢ع - ١٦ = ٣ع</span></p><p>نطرح ٢ع من الطرفين: <span class='math-eq'>٢ع <span class='highlight-change'>- ٢ع</span> - ١٦ = ٣ع <span class='highlight-change'>- ٢ع</span></span></p><p>نبسط: <span class='math-eq'>-١٦ = ع</span></p></div>` 
            },
            { type: 'mcq', level: '⭐⭐', topic: 'parentheses-2', text: 'حل المعادلة: <span class="math-eq">٧(أ - ٢) = ٤(أ + ١)</span>', 
              options: [ { display: '<span class="math-eq">أ = ٦</span>', value: '6' }, { display: '<span class="math-eq">أ = -٦</span>', value: '-6' }, { display: '<span class="math-eq">أ = ٣</span>', value: '3' }, { display: '<span class="math-eq">أ = ١٨</span>', value: '18' } ], 
              correct: '6', 
              explanation: `<p class='mb-2'>نبدأ بفك الأقواس في الطرفين.</p><div class='text-right space-y-2'><p>المعادلة: <span class='math-eq'>٧أ - ١٤ = ٤أ + ٤</span></p><p>نطرح ٤أ من الطرفين: <span class='math-eq'>٣أ - ١٤ = ٤</span></p><p>نضيف ١٤ للطرفين: <span class='math-eq'>٣أ = ١٨</span></p><p>نقسم الطرفين على ٣: <span class='math-eq flex justify-center items-center'><span class="fraction"><span>٣أ</span><span class="frac-bar"></span><span>٣</span></span> = <span class="fraction"><span>١٨</span><span class="frac-bar"></span><span>٣</span></span></span></p><p>الحل: <span class='math-eq'>أ = ٦</span></p></div>`,
              smartExplanation: `<p>لنجرب تعويض الخيار (٦):</p><p>الطرف الأيمن: <span class='math-eq'>٧(٦ - ٢) = ٧(٤) = ٢٨</span></p><p>الطرف الأيسر: <span class='math-eq'>٤(٦ + ١) = ٤(٧) = ٢٨</span></p><p>الطرفان متساويان، إذن الإجابة صحيحة.</p>`
            },
            { type: 'mcq', level: '⭐⭐⭐', topic: 'identity', text: 'ما هو حل المعادلة: <span class="math-eq">٣(٢ب - ١) - ٥ = ٦ب - ٨</span>؟', 
              options: [ { display: '<span class="math-eq">ب = ١</span>', value: '1' }, { display: '<span class="math-eq">جميع الأعداد الحقيقية</span>', value: 'all' }, { display: '<span class="math-eq">مستحيلة الحل (∅)</span>', value: 'none' }, { display: '<span class="math-eq">ب = ٠</span>', value: '0' } ], 
              correct: 'all', 
              explanation: `<p class='mb-2'>نبدأ بفك القوس وتبسيط الطرف الأيسر.</p><div class='text-right space-y-2'><p>المعادلة: <span class='math-eq'>٣(٢ب - ١) - ٥ = ٦ب - ٨</span></p><p>نفك القوس: <span class='math-eq'>٦ب - ٣ - ٥ = ٦ب - ٨</span></p><p>نبسط الطرف الأيسر: <span class='math-eq'>٦ب - ٨ = ٦ب - ٨</span></p><p class='mt-2 p-2 bg-green-100 rounded-md'>بما أن الطرفين متطابقان، فالمعادلة صحيحة لأي قيمة للمتغير ب. هذه المعادلة هي متطابقة.</p></div>`,
              smartExplanation: `<p>بمجرد فك القوس في الطرف الأيسر (<span class='math-eq'>٦ب - ٣</span>) ثم طرح ٥، نجد أنه يصبح <span class='math-eq'>٦ب - ٨</span>، وهو مطابق تماماً للطرف الأيمن. هذا يعني أنها متطابقة وحلها جميع الأعداد الحقيقية.</p>`
            },
            { type: 'mcq', level: '⭐', topic: 'simple-negatives', text: 'حل المعادلة: <span class="math-eq">٣ - ٤س = ١٨ + س</span>', 
              options: [ { display: '<span class="math-eq">-٣</span>', value: '-3' }, { display: '<span class="math-eq">٣</span>', value: '3' }, { display: '<span class="math-eq">-٥</span>', value: '-5' }, { display: '<span class="math-eq">٧</span>', value: '7' } ], 
              correct: '-3', 
              explanation: `<p class='mb-2'>نجمع المتغيرات في طرف والثوابت في الطرف الآخر.</p><div class='text-right space-y-2'><p>نضيف ٤س للطرفين: <span class='math-eq'>٣ - ٤س <span class='highlight-change'>+ ٤س</span> = ١٨ + س <span class='highlight-change'>+ ٤س</span></span></p><p>نبسط: <span class='math-eq'>٣ = ١٨ + ٥س</span></p><p>نطرح ١٨ من الطرفين: <span class='math-eq'>٣ <span class='highlight-change'>- ١٨</span> = ١٨ + ٥س <span class='highlight-change'>- ١٨</span></span></p><p>نبسط: <span class='math-eq'>-١٥ = ٥س</span></p><p>نقسم على ٥: <span class='math-eq'>-٣ = س</span></p></div>` 
            },
            { type: 'mcq', level: '⭐⭐', topic: 'parentheses-negatives', text: 'حل المعادلة: <span class="math-eq">٢(ص - ٦) = ٣(ص - ٤)</span>', 
              options: [ { display: '<span class="math-eq">ص = ٠</span>', value: '0' }, { display: '<span class="math-eq">ص = ٢٤</span>', value: '24' }, { display: '<span class="math-eq">ص = -٢٤</span>', value: '-24' }, { display: '<span class="math-eq">ص = ٤</span>', value: '4' } ], 
              correct: '0', 
              explanation: `<p class='mb-2'>نبدأ بفك الأقواس.</p><div class='text-right space-y-2'><p>المعادلة: <span class='math-eq'>٢ص - ١٢ = ٣ص - ١٢</span></p><p>نطرح ٢ص من الطرفين: <span class='math-eq'>-١٢ = ص - ١٢</span></p><p>نضيف ١٢ للطرفين: <span class='math-eq'>-١٢ <span class='highlight-change'>+ ١٢</span> = ص - ١٢ <span class='highlight-change'>+ ١٢</span></span></p><p>الحل: <span class='math-eq'>٠ = ص</span></p></div>`,
              smartExplanation: `<p>بمجرد فك الأقواس نجد <span class='math-eq'>٢ص - ١٢ = ٣ص - ١٢</span>. بما أن <span class='math-eq'>-١٢</span> موجود في الطرفين، يمكن حذفهما، ليتبقى <span class='math-eq'>٢ص = ٣ص</span>. هذا لا يتحقق إلا إذا كانت <span class='math-eq'>ص = ٠</span>.</p>`
            },
            { type: 'mcq', level: '⭐⭐⭐', topic: 'geometry-perimeter', text: 'مستطيل ومربع لهما نفس المحيط. طول المستطيل ١٠ سم وعرضه (س) سم. طول ضلع المربع (س+٢) سم. ما قيمة س؟', 
              options: [ { display: '<span class="math-eq">س = ٦</span>', value: '6' }, { display: '<span class="math-eq">س = ٤</span>', value: '4' }, { display: '<span class="math-eq">س = ٨</span>', value: '8' }, { display: '<span class="math-eq">س = ١٢</span>', value: '12' } ], 
              correct: '6', 
              explanation: `<p class='mb-2'>محيط المستطيل = ٢(الطول + العرض). محيط المربع = ٤ × طول الضلع.</p><div class='text-right space-y-2'><p>محيط المستطيل: <span class='math-eq'>٢(١٠ + س)</span></p><p>محيط المربع: <span class='math-eq'>٤(س + ٢)</span></p><p>المعادلة: <span class='math-eq'>٢(١٠ + س) = ٤(س + ٢)</span></p><p>نفك الأقواس: <span class='math-eq'>٢٠ + ٢س = ٤س + ٨</span></p><p>نطرح ٢س: <span class='math-eq'>٢٠ = ٢س + ٨</span></p><p>نطرح ٨: <span class='math-eq'>١٢ = ٢س</span></p><p>نقسم على ٢: <span class='math-eq'>٦ = س</span></p></div>` 
            },
            { type: 'mcq', level: '⭐⭐', topic: 'decimals-2', text: 'حل المعادلة: <span class="math-eq">١.٥ك + ٩ = ٣ك</span>', 
              options: [ { display: '<span class="math-eq">ك = ٦</span>', value: '6' }, { display: '<span class="math-eq">ك = ٣</span>', value: '3' }, { display: '<span class="math-eq">ك = -٦</span>', value: '-6' }, { display: '<span class="math-eq">ك = ٤.٥</span>', value: '4.5' } ], 
              correct: '6', 
              explanation: `<p class='mb-2'>نجمع المتغيرات في طرف.</p><div class='text-right space-y-2'><p>نطرح ١.٥ك من الطرفين: <span class='math-eq'>١.٥ك <span class='highlight-change'>- ١.٥ك</span> + ٩ = ٣ك <span class='highlight-change'>- ١.٥ك</span></span></p><p>نبسط: <span class='math-eq'>٩ = ١.٥ك</span></p><p>نقسم الطرفين على ١.٥: <span class='math-eq flex justify-center items-center'><span class="fraction"><span>٩</span><span class="frac-bar"></span><span>١.٥</span></span> = <span class="fraction"><span>١.٥ك</span><span class="frac-bar"></span><span>١.٥</span></span></span></p><p>الحل: <span class='math-eq'>٦ = ك</span></p></div>`,
              smartExplanation: `<p>ذهنياً، إذا نقلنا <span class='math-eq'>١.٥ك</span> للطرف الآخر، سيتبقى <span class='math-eq'>١.٥ك</span>. المعادلة تصبح: ما هو العدد الذي إذا ضرب في ١.٥ يعطي ٩؟ الجواب هو ٦.</p>`
            }
        ];
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random()); 
        const questionCount = Math.min(shuffled.length, 5); 
        return shuffled.slice(0, questionCount); 
    }

    document.addEventListener('DOMContentLoaded', () => {
        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            state[exampleId] = { currentIndex: -1, steps: container.querySelectorAll('.step-interactive'), placeholder: container.querySelector('.interactive-placeholder'), prevBtn: container.querySelector('.prev-btn'), nextBtn: container.querySelector('.next-btn'), resetBtn: container.querySelector('.reset-btn') };
            const resetExample = () => { state[exampleId].steps.forEach(step => step.classList.remove('active')); state[exampleId].currentIndex = -1; if (state[exampleId].placeholder) { state[exampleId].placeholder.classList.remove('hidden'); } updateButtons(); };
            const updateButtons = () => { const isFirstStep = state[exampleId].currentIndex <= -1; const isLastStep = state[exampleId].currentIndex >= state[exampleId].steps.length - 1; state[exampleId].prevBtn.disabled = isFirstStep; if (isLastStep) { state[exampleId].nextBtn.classList.add('hidden'); state[exampleId].resetBtn.classList.remove('hidden'); } else { state[exampleId].nextBtn.classList.remove('hidden'); state[exampleId].resetBtn.classList.add('hidden'); } };
            
            state[exampleId].nextBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex < state[exampleId].steps.length - 1) {
                    if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.add('hidden');
                    }
                    state[exampleId].currentIndex++;
                    state[exampleId].steps[state[exampleId].currentIndex].classList.add('active');
                    updateButtons();
                }
            });
            state[exampleId].prevBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex > -1) {
                    state[exampleId].steps[state[exampleId].currentIndex].classList.remove('active');
                    state[exampleId].currentIndex--;
                     if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.remove('hidden');
                    }
                    updateButtons();
                }
            });

            if(state[exampleId].resetBtn) { state[exampleId].resetBtn.addEventListener('click', resetExample); }
            updateButtons();
        });

        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) { closeModalBtn.addEventListener('click', closeModal); }
    });
    </script>
</body>
</html>
