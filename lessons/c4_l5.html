<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدرس ٤-٥: حل متباينات القيمة المطلقة | منصة الرياضيات التفاعلية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* نفس الأنماط التي قدمتها، مع تعديلات طفيفة إذا لزم الأمر */
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .vocab-term-alt { background-color: #dbeafe; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; min-height: 80px; display: flex; align-items: center; justify-content: center; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-number { background-color: #fef9c3; border: 1px solid #fde047; color: #b45309; font-weight: bold; padding: 0 5px; border-radius: 4px; }
        .math-eq { font-family: "Courier New", monospace; font-size: 1.1rem; font-weight: bold; color: #4338ca; background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 2px 8px; border-radius: 6px; display: inline-block; vertical-align: middle; }
        .math-eq .highlight-number { padding: 0; border: none; }
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
        .number-line-wrapper { margin-top: 1rem; padding: 1rem 0; }
        .number-line { position: relative; width: 100%; height: 2px; background-color: #374151; }
        .number-line::before, .number-line::after { content: ''; position: absolute; top: 50%; transform: translateY(-50%); width: 0; height: 0; border-style: solid; }
        .number-line::before { left: -1px; border-width: 6px 8px 6px 0; border-color: transparent #374151 transparent transparent; }
        .number-line::after { right: -1px; border-width: 6px 0 6px 8px; border-color: transparent transparent transparent #374151; }
        .ticks-container { position: relative; width: 100%; height: 2rem; }
        .tick { position: absolute; bottom: 0; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; font-size: 0.875rem; }
        .tick::before { content: ''; width: 2px; height: 8px; background-color: #374151; margin-bottom: 4px; }
        .solution-line { position: absolute; top: 50%; transform: translateY(-50%); height: 4px; background-color: #2563eb; }
        .solution-point { position: absolute; top: 50%; transform: translate(-50%, -50%); width: 12px; height: 12px; border-radius: 9999px; border: 2px solid #2563eb; }
        .solution-point.open { background-color: #fff; }
        .solution-point.closed { background-color: #2563eb; }

        /* Styles for number lines inside quiz options */
        .option-nl-wrapper { width: 100%; padding: 1rem 0.5rem; }
        .option-nl-ticks { position: relative; width: 100%; height: 1.5rem; }
        .option-nl-line { position: relative; width: 100%; height: 2px; background-color: #374151; }
        .option-nl-line::before, .option-nl-line::after { content: ''; position: absolute; top: 50%; transform: translateY(-50%); width: 0; height: 0; border-style: solid; }
        .option-nl-line::before { left: -1px; border-width: 4px 6px 4px 0; border-color: transparent #374151 transparent transparent; }
        .option-nl-line::after { right: -1px; border-width: 4px 0 4px 6px; border-color: transparent transparent transparent #374151; }
        .option-nl-tick { position: absolute; bottom: 0; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; font-size: 0.75rem; color: #4b5563; }
        .option-nl-tick::before { content: ''; width: 1px; height: 5px; background-color: #4b5563; margin-bottom: 2px; }
        .option-nl-sol-line { position: absolute; top: 50%; transform: translateY(-50%); height: 3px; background-color: #3b82f6; }
        .option-nl-sol-point { position: absolute; top: 50%; transform: translate(-50%, -50%); width: 10px; height: 10px; border-radius: 9999px; border: 2px solid #3b82f6; }
        .option-nl-sol-point.open { background-color: #fff; }
        .option-nl-sol-point.closed { background-color: #3b82f6; }
        
        /* New styles for sentence translation */
        .translation-box { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; padding: 1rem; background-color: #eef2ff; border-radius: 8px; }
        .translation-part { display: flex; flex-direction: column; align-items: center; }
        .translation-part .word { font-size: 0.875rem; color: #4b5563; padding: 0 8px; }
        .translation-part .symbol { font-weight: bold; font-size: 1.25rem; color: #4338ca; background-color: white; padding: 4px 12px; border: 1px solid #c7d2fe; border-radius: 6px; min-width: 40px; text-align: center;}

    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-green-800">الدرس ٤-٥: حل متباينات القيمة المطلقة</h1>
                    <!-- The old link was here and has been removed -->
                </header>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفهوم الأساسي</h2>
                    <div class="p-6 bg-green-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-green-700 mb-2">متباينات القيمة المطلقة (أصغر من)</h3>
                            <p class="text-gray-700">المتباينة على الصورة <span class="math-eq">|س| < ب</span> تعني أن المسافة بين <span class="vocab-term-alt">س</span> والصفر أقل من <span class="vocab-term-alt">ب</span>. يمكن حلها بتحويلها إلى متباينة مركبة بأداة الربط <span class="font-bold">"و"</span>.</p>
                            <div class="mt-4 p-4 bg-white rounded-lg border text-center">
                                <p>المتباينة: <span class="math-eq">|أ| < ب</span></p>
                                <p>تكافئ: <span class="math-eq">-ب < أ < ب</span></p>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">متباينات القيمة المطلقة (أكبر من)</h3>
                            <p class="text-gray-700">المتباينة على الصورة <span class="math-eq">|س| > ب</span> تعني أن المسافة بين <span class="vocab-term-alt">س</span> والصفر أكبر من <span class="vocab-term-alt">ب</span>. يمكن حلها بتحويلها إلى متباينة مركبة بأداة الربط <span class="font-bold">"أو"</span>.</p>
                             <div class="mt-4 p-4 bg-white rounded-lg border text-center">
                                <p>المتباينة: <span class="math-eq">|أ| > ب</span></p>
                                <p>تكافئ: <span class="math-eq">أ > ب</span> أو <span class="math-eq">أ < -ب</span></p>
                            </div>
                        </div>
                        <!-- قسم الحالات الخاصة المضاف -->
                        <div class="p-4 bg-yellow-100 rounded-lg border-l-4 border-yellow-500">
                             <h3 class="text-xl font-semibold text-yellow-800 mb-3">⚠️ ملاحظات هامة: حالات خاصة</h3>
                             <div class="space-y-4">
                                 <div>
                                     <h4 class="font-bold text-red-700">١. لا يوجد حل (المجموعة الخالية ∅)</h4>
                                     <p class="text-gray-700">تحدث هذه الحالة عندما تكون القيمة المطلقة (وهي دائماً موجبة أو صفر) أقل من عدد سالب. هذا مستحيل.</p>
                                     <p class="text-center mt-2">مثال: <span class="math-eq">|س - ٢| < -٣</span></p>
                                     <p class="text-center text-sm text-gray-600">الحل هو ∅ لأنه لا يمكن أن تكون القيمة المطلقة سالبة.</p>
                                 </div>
                                 <div>
                                     <h4 class="font-bold text-green-700">٢. الحل هو جميع الأعداد الحقيقية (ح)</h4>
                                     <p class="text-gray-700">تحدث هذه الحالة عندما تكون القيمة المطلقة (وهي دائماً موجبة أو صفر) أكبر من عدد سالب. هذا صحيح دائماً.</p>
                                     <p class="text-center mt-2">مثال: <span class="math-eq">|س + ٤| ≥ -١</span></p>
                                     <p class="text-center text-sm text-gray-600">الحل هو جميع الأعداد الحقيقية لأن القيمة المطلقة دائماً أكبر من أي عدد سالب.</p>
                                 </div>
                             </div>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: أمثلة تفاعلية</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        
                        <!-- قسم أمثلة القيمة المطلقة "أصغر من" -->
                        <div>
                            <h3 class="text-xl font-bold text-green-800 mb-4 border-b-2 border-green-200 pb-2">أمثلة على (<) و (≤)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-4">
                                <!-- المثال التفاعلي 1 -->
                                <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ١:</p>
                                        <p class="text-lg font-semibold mt-1">حل <span class="math-eq">|ن - ٨| ≤ ٢</span></p>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ١: اكتبها كمتباينة "و"</h4><p class="text-center"><span class="math-eq">-٢ ≤ ن - ٨ ≤ ٢</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٢: أضف ٨ لجميع الأطراف</h4><p class="text-center"><span class="math-eq">-٢ <span class="highlight-number">+٨</span> ≤ ن - ٨ <span class="highlight-number">+٨</span> ≤ ٢ <span class="highlight-number">+٨</span></span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٣: الحل النهائي</h4><p class="text-center"><span class="math-eq">٦ ≤ ن ≤ ١٠</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة ٤: التمثيل البياني</h4>
                                            <div class="number-line-wrapper">
                                                <div class="ticks-container">
                                                    <div class="tick" style="left: 20%;"><span>٦</span></div>
                                                    <div class="tick" style="left: 50%;"><span>٨</span></div>
                                                    <div class="tick" style="left: 80%;"><span>١٠</span></div>
                                                    <div class="number-line">
                                                        <div class="solution-line" style="left: 20%; width: 60%;"></div>
                                                        <div class="solution-point closed" style="left: 20%;"></div>
                                                        <div class="solution-point closed" style="left: 80%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- المثال التفاعلي 2 (مُعدل) -->
                                <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ٢:</p>
                                        <p class="text-lg font-semibold mt-1">حل <span class="math-eq">|٢ف + ١| ≤ ٩</span></p>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ١: اكتبها كمتباينة "و"</h4><p class="text-center"><span class="math-eq">-٩ ≤ ٢ف + ١ ≤ ٩</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٢: اطرح ١ من الأطراف</h4><p class="text-center"><span class="math-eq">-٩ <span class="highlight-number">-١</span> ≤ ٢ف ≤ ٩ <span class="highlight-number">-١</span></span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٣: التبسيط</h4><p class="text-center"><span class="math-eq">-١٠ ≤ ٢ف ≤ ٨</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٤: اقسم على ٢</h4><p class="text-center"><span class="math-eq"><span class="fraction"><span>-١٠</span><span class="frac-bar"></span><span class="highlight-number">٢</span></span> ≤ <span class="fraction"><span>٢ف</span><span class="frac-bar"></span><span class="highlight-number">٢</span></span> ≤ <span class="fraction"><span>٨</span><span class="frac-bar"></span><span class="highlight-number">٢</span></span></span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٥: الحل النهائي</h4><p class="text-center"><span class="math-eq">-٥ ≤ ف ≤ ٤</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة ٦: التمثيل البياني</h4>
                                            <div class="number-line-wrapper">
                                                <div class="ticks-container">
                                                    <div class="tick" style="left: 10%;"><span>-٥</span></div>
                                                    <div class="tick" style="left: 50%;"><span>٠</span></div>
                                                    <div class="tick" style="left: 90%;"><span>٤</span></div>
                                                    <div class="number-line">
                                                        <div class="solution-line" style="left: 10%; width: 80%;"></div>
                                                        <div class="solution-point closed" style="left: 10%;"></div>
                                                        <div class="solution-point closed" style="left: 90%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- قسم أمثلة القيمة المطلقة "أكبر من" -->
                        <div>
                            <h3 class="text-xl font-bold text-blue-800 mb-4 border-b-2 border-blue-200 pb-2">أمثلة على (>) و (≥)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-4">
                                <!-- المثال التفاعلي 3 -->
                                <div id="interactive-container-3" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ٣:</p>
                                        <p class="text-lg font-semibold mt-1">حل <span class="math-eq">|٢ك + ١| > ٧</span></p>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                            <h4 class="font-bold">الخطوة ١: اكتبها كمتباينة "أو"</h4>
                                            <div class="flex justify-around text-center mt-2">
                                                <p><span class="math-eq">٢ك + ١ > ٧</span></p>
                                                <p class="font-bold">أو</p>
                                                <p><span class="math-eq">٢ك + ١ < -٧</span></p>
                                            </div>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                            <h4 class="font-bold">الخطوة ٢: حل المتباينتين</h4>
                                            <div class="flex justify-around text-center mt-2">
                                                <div class="space-y-1">
                                                    <p><span class="math-eq" style="font-size: 1rem; padding: 2px 4px;">٢ك > ٧<span class="highlight-number">-١</span></span></p>
                                                    <p class="font-bold text-xl">↓</p>
                                                    <p><span class="math-eq">ك > ٣</span></p>
                                                </div>
                                                <div class="space-y-1">
                                                    <p><span class="math-eq" style="font-size: 1rem; padding: 2px 4px;">٢ك < -٧<span class="highlight-number">-١</span></span></p>
                                                    <p class="font-bold text-xl">↓</p>
                                                    <p><span class="math-eq">ك < -٤</span></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٣: الحل النهائي</h4>
                                            <p class="text-center"><span class="math-eq">ك > ٣</span> أو <span class="math-eq">ك < -٤</span></p>
                                        </div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة ٤: التمثيل البياني</h4>
                                            <div class="number-line-wrapper">
                                                <div class="ticks-container">
                                                    <div class="tick" style="left: 25%;"><span>-٤</span></div>
                                                    <div class="tick" style="left: 50%;"><span>٠</span></div>
                                                    <div class="tick" style="left: 75%;"><span>٣</span></div>
                                                    <div class="number-line">
                                                        <div class="solution-line" style="left: 0%; width: 25%;"></div>
                                                        <div class="solution-point open" style="left: 25%;"></div>
                                                        <div class="solution-line" style="left: 75%; width: 25%;"></div>
                                                        <div class="solution-point open" style="left: 75%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- المثال التفاعلي 4 (مُعدل) -->
                                <div id="interactive-container-4" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ٤ (فكرة جديدة):</p>
                                        <p class="text-lg font-semibold mt-1">حل <span class="math-eq">|٥ - ٢د| > ٣</span></p>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                            <h4 class="font-bold">الخطوة ١: اكتبها كمتباينة "أو"</h4>
                                            <div class="flex justify-around text-center mt-2">
                                                <p><span class="math-eq">٥ - ٢د > ٣</span></p>
                                                <p class="font-bold">أو</p>
                                                <p><span class="math-eq">٥ - ٢د < -٣</span></p>
                                            </div>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                            <h4 class="font-bold">الخطوة ٢: اطرح ٥ من الطرفين</h4>
                                            <div class="flex justify-around text-center mt-2">
                                                <div class="space-y-1">
                                                    <p><span class="math-eq" style="font-size: 1rem; padding: 2px 4px;">-٢د > ٣<span class="highlight-number">-٥</span></span></p>
                                                    <p class="font-bold text-xl">↓</p>
                                                    <p><span class="math-eq">-٢د > -٢</span></p>
                                                </div>
                                                <div class="space-y-1">
                                                    <p><span class="math-eq" style="font-size: 1rem; padding: 2px 4px;">-٢د < -٣<span class="highlight-number">-٥</span></span></p>
                                                    <p class="font-bold text-xl">↓</p>
                                                    <p><span class="math-eq">-٢د < -٨</span></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="step-interactive p-4 bg-yellow-100 rounded-lg step-box border-yellow-500"><h4 class="font-bold text-yellow-800">الخطوة ٣: اقسم على -٢ (انتبه!)</h4>
                                            <p class="text-center text-red-600 font-bold">عند القسمة على عدد سالب، يجب عكس اتجاه إشارة المتباينة.</p>
                                            <div class="flex justify-around text-center mt-2">
                                                 <p><span class="math-eq"><span class="fraction"><span>-٢د</span><span class="frac-bar"></span><span class="highlight-number">-٢</span></span> <span class="text-red-600 font-bold"><</span> <span class="fraction"><span>-٢</span><span class="frac-bar"></span><span class="highlight-number">-٢</span></span></span></p>
                                                 <p class="font-bold">أو</p>
                                                 <p><span class="math-eq"><span class="fraction"><span>-٢د</span><span class="frac-bar"></span><span class="highlight-number">-٢</span></span> <span class="text-red-600 font-bold">></span> <span class="fraction"><span>-٨</span><span class="frac-bar"></span><span class="highlight-number">-٢</span></span></span></p>
                                            </div>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box">
                                            <h4 class="font-bold">الخطوة ٤: الحل النهائي</h4>
                                            <p class="text-center"><span class="math-eq">د < ١</span> أو <span class="math-eq">د > ٤</span></p>
                                        </div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة ٥: التمثيل البياني</h4>
                                            <div class="number-line-wrapper">
                                                <div class="ticks-container">
                                                    <div class="tick" style="left: 25%;"><span>١</span></div>
                                                    <div class="tick" style="left: 50%;"><span>٢.٥</span></div>
                                                    <div class="tick" style="left: 75%;"><span>٤</span></div>
                                                    <div class="number-line">
                                                        <div class="solution-line" style="left: 0%; width: 25%;"></div>
                                                        <div class="solution-point open" style="left: 25%;"></div>
                                                        <div class="solution-line" style="left: 75%; width: 25%;"></div>
                                                        <div class="solution-point open" style="left: 75%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="4" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="4" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="4" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- قسم أمثلة من واقع الحياة -->
                        <div>
                            <h3 class="text-xl font-bold text-teal-800 mb-4 border-b-2 border-teal-200 pb-2">أمثلة من واقع الحياة</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-4">
                                <!-- المثال التفاعلي 5 (مُعدل) -->
                                <div id="interactive-container-5" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ٥ (مثبت السرعة):</p>
                                        <p class="text-lg mt-1">يحفظ مثبت سرعة السيارة عند ٨٨ كلم/ساعة، بزيادة أو نقصان مقداره ٥ كلم/ساعة. اكتب مدى السرعة الفعلية للسيارة.</p>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ١: كتابة المتباينة</h4>
                                            <p>الفكرة: المدى - أو الفرق - بين السرعة الفعلية (ع) والسرعة المركزية (٨٨) يجب أن يكون بين -٥ و ٥. ويُعبر عن هذا الفرق بالقيمة المطلقة بأنه لا يزيد عن ٥.</p>
                                            <p class="text-center mt-4"><span class="math-eq">|ع - ٨٨| ≤ ٥</span></p>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٢: حل المتباينة</h4><p>نحولها لمتباينة "و":</p><p class="text-center mt-2"><span class="math-eq">-٥ ≤ ع - ٨٨ ≤ ٥</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٣: أضف ٨٨ للأطراف</h4><p class="text-center"><span class="math-eq">-٥ <span class="highlight-number">+٨٨</span> ≤ ع ≤ ٥ <span class="highlight-number">+٨٨</span></span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة ٤: الحل النهائي</h4><p>مدى السرعة الفعلية هو:</p><p class="text-center mt-2"><span class="math-eq">٨٣ ≤ ع ≤ ٩٣</span></p><p class="text-center text-sm text-gray-600">أي أن سرعة السيارة تتراوح بين ٨٣ و ٩٣ كلم/ساعة.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="5" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="5" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="5" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- المثال التفاعلي 6 (مُعدل) -->
                                <div id="interactive-container-6" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ٦ (كيمياء):</p>
                                        <p class="text-lg mt-1">للحفاظ على مياه المسبح آمنة، يجب أن يكون مستوى الحموضة (ب) المثالي هو ٧٫٤، مع تفاوت لا يزيد عن ٠٫٢. اكتب متباينة تمثل مدى الحموضة المقبول.</p>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ١: كتابة المتباينة</h4>
                                            <p>الفكرة: الفرق بين مستوى الحموضة الفعلي (ب) والمستوى المثالي (٧٫٤) يجب أن يكون بين -٠٫٢ و ٠٫٢. ويُعبر عن هذا الفرق بالقيمة المطلقة بأنه لا يزيد عن ٠٫٢.</p>
                                            <p class="text-center mt-4"><span class="math-eq">|ب - ٧٫٤| ≤ ٠٫٢</span></p>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٢: حل المتباينة</h4><p>نحولها لمتباينة "و":</p><p class="text-center mt-2"><span class="math-eq">-٠٫٢ ≤ ب - ٧٫٤ ≤ ٠٫٢</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٣: أضف ٧٫٤ للأطراف</h4><p class="text-center"><span class="math-eq">-٠٫٢ <span class="highlight-number">+٧٫٤</span> ≤ ب ≤ ٠٫٢ <span class="highlight-number">+٧٫٤</span></span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة ٤: الحل النهائي</h4><p>مدى الحموضة المقبول هو:</p><p class="text-center mt-2"><span class="math-eq">٧٫٢ ≤ ب ≤ ٧٫٦</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="6" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="6" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="6" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 mt-8"> <!-- New container for example 7 -->
                                <!-- المثال التفاعلي 7 (جديد) -->
                                <div id="interactive-container-7" class="p-4 bg-white rounded-lg shadow">
                                    <div class="mb-4">
                                        <p class="text-lg font-semibold">مثال ٧ (سلامة الغذاء):</p>
                                        <p class="text-lg mt-1">يجب أن تبقى درجة حرارة ثلاجة الحليب عند ٥° مئوية. إذا اختلفت الدرجة الفعلية (د) عن ٥° بأكثر من درجتين، فإنها تتطلب فحصاً فورياً. اكتب متباينة تمثل درجات الحرارة التي تتطلب فحصاً.</p>
                                    </div>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ١: كتابة المتباينة</h4>
                                            <p>الفكرة: الفرق بين درجة الحرارة الفعلية (د) والمثالية (٥) يجب أن يكون "أكثر من" درجتين. هذا يعني أن القيمة المطلقة للفرق أكبر من ٢.</p>
                                            <p class="text-center mt-4"><span class="math-eq">|د - ٥| > ٢</span></p>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٢: حل المتباينة</h4><p>نحولها لمتباينة "أو":</p>
                                            <div class="flex justify-around text-center mt-2">
                                                <p><span class="math-eq">د - ٥ > ٢</span></p>
                                                <p class="font-bold">أو</p>
                                                <p><span class="math-eq">د - ٥ < -٢</span></p>
                                            </div>
                                        </div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة ٣: أضف ٥ للطرفين</h4>
                                            <div class="flex justify-around text-center mt-2">
                                                <p><span class="math-eq">د > ٧</span></p>
                                                <p class="font-bold">أو</p>
                                                <p><span class="math-eq">د < ٣</span></p>
                                            </div>
                                        </div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة ٤: الحل النهائي</h4><p>درجات الحرارة التي تتطلب فحصاً هي:</p><p class="text-center mt-2"><span class="math-eq">د < ٣</span> أو <span class="math-eq">د > ٧</span></p><p class="text-center text-sm text-gray-600">أي إذا كانت الحرارة أقل من ٣° أو أعلى من ٧°.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="7" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                        <div>
                                            <button data-example="7" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                            <button data-example="7" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </section>

                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">✍️ ثالثاً: حان دورك! اختبر فهمك</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">نتيجتك النهائية</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">إعادة الاختبار</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>

    <!-- Modals for explanations -->
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">💡 شرح الإجابة</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <div id="smartExplanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full border-t-4 border-purple-500">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-purple-800">🧠 الحل الذكي</h3>
                <button id="closeSmartModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="smartExplanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <script>
    // --- Start of JS modifications ---
    const urlParams = new URLSearchParams(window.location.search);
    const studentId = urlParams.get('studentId');
    const classId = urlParams.get('classId');
    // --- End of JS modifications ---

    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = [];
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { 
        const headerContainer = document.getElementById('main-header'); 
        if (!headerContainer) return; 
        let titleHtml; 
        if (lessonTitle) { 
            titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">منصة الرياضيات التفاعلية</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; 
        } else { 
            titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">منصة الرياضيات التفاعلية</h1></a>`; 
        } 
        let userInfoHtml = ''; 
        if (studentData) { 
            userInfoHtml = `<div class="text-left"><div class="flex items-center justify-end gap-4"><span class="font-semibold">أهلاً، ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">خروج</a></div><a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline mt-1 inline-block">&larr; العودة إلى الفهرس</a></div>`; 
        } else { 
            userInfoHtml = `<div class="text-left"><p class="text-lg text-gray-600">زائر</p><a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline mt-1 inline-block">&larr; العودة إلى الفهرس</a></div>`; 
        } 
        headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; 
        const logoutLink = headerContainer.querySelector('#logout-link'); 
        if(logoutLink) { 
            logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); 
        } 
    }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">© 2024 جميع الحقوق محفوظة | تصميم وتطوير: أ. عبدالعزيز خالد العبلان</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">لا توجد أسئلة متاحة لهذا الدرس حالياً.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `المحاولات المتبقية: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); const smartButtonHTML = q.smartExplanation ? `<button type="button" id="smart-explain-btn-${index}" class="hidden mt-2 text-xs text-purple-600 hover:underline font-semibold">🧠 الحل الذكي</button>` : ''; return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div class="flex items-center space-x-4 space-x-reverse">${smartButtonHTML}<button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">اعرف لماذا؟</button></div></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">تحقق من إجاباتي</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); if (q.smartExplanation) { const smartExplainBtn = document.getElementById(`smart-explain-btn-${index}`); if(smartExplainBtn) smartExplainBtn.addEventListener('click', () => showSmartExplanation(index)); } }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'لا توجد محاولات متبقية'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = '✔ إجابة صحيحة!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `❌ إجابة خاطئة.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden'); if (q.smartExplanation) { document.getElementById(`smart-explain-btn-${index}`).classList.remove('hidden'); } }); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentData) { saveGrade(lessonId, finalGrade); } else { document.getElementById('save-status').textContent = 'تم عرض نتيجتك. سجل الدخول لحفظ تقدمك.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade) { 
        const saveStatus = document.getElementById('save-status');
        if (!studentId || !classId) {
            saveStatus.textContent = 'خطأ: لا يمكن حفظ نتيجتك. بيانات الطالب أو الفصل مفقودة.';
            console.error("Student ID or Class ID is missing from the URL.");
            return;
        }
        saveStatus.textContent = 'جارٍ حفظ نتيجتك...'; 
        const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&classId=${classId}&lessonId=${lessonId}&grade=${grade}`; 
        fetch(url) .then(res => res.json()) .then(result => { if (result.status === 'success') { saveStatus.textContent = '✔ تم حفظ نتيجتك بنجاح! ستظهر في لوحة التحكم عند العودة.'; const studentData = JSON.parse(localStorage.getItem('currentStudent')); if (!studentData.lessons) studentData.lessons = {}; if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; } else { studentData.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(studentData)); } else { throw new Error(result.message); } }) .catch(error => { saveStatus.textContent = '❌ حدث خطأ أثناء حفظ الدرجة.'; console.error("Save Grade Error:", error); }); 
    }
    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    function showSmartExplanation(questionIndex) { const modal = document.getElementById('smartExplanationModal'); const explanationText = document.getElementById('smartExplanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].smartExplanation) { explanationText.innerHTML = currentQuestions[questionIndex].smartExplanation; modal.classList.remove('hidden'); } }
    function closeSmartModal() { const modal = document.getElementById('smartExplanationModal'); if(modal) modal.classList.add('hidden'); }
    
    const LESSON_ID = 'c4_l5';
    
    function generateQuiz() { 
        const questionBank = [
            { 
                type: 'mcq', level: '⭐', text: `أي متباينة تكافئ <span class="math-eq">|س| < ٥</span>؟`,
                options: [ 
                    { display: '<span class="math-eq">س < ٥</span>', value: 'A' }, 
                    { display: '<span class="math-eq">س < ٥</span> أو <span class="math-eq">س > -٥</span>', value: 'B' }, 
                    { display: '<span class="math-eq">-٥ < س < ٥</span>', value: 'C' }, 
                    { display: '<span class="math-eq">س > -٥</span>', value: 'D' }
                ], 
                correct: 'C',
                explanation: `<p>متباينة القيمة المطلقة مع علامة "أصغر من" (<) تتحول إلى متباينة مركبة بأداة الربط "و".</p><p>المتباينة <span class="math-eq">|س| < ٥</span> تعني أن س محصورة بين <span class="highlight-number">-٥</span> و <span class="highlight-number">٥</span>.</p>`,
            },
            { 
                type: 'mcq', level: '⭐⭐', text: `حل المتباينة <span class="math-eq">|ص - ٢| ≤ ٤</span>`,
                options: [ 
                    { display: '<span class="math-eq">-٢ ≤ ص ≤ ٦</span>', value: 'A' }, 
                    { display: '<span class="math-eq">ص ≤ ٦</span>', value: 'B' }, 
                    { display: '<span class="math-eq">ص ≥ -٢</span>', value: 'C' }, 
                    { display: '<span class="math-eq">ص ≤ -٢</span> أو <span class="math-eq">ص ≥ ٦</span>', value: 'D' }
                ], 
                correct: 'A',
                explanation: `<p>1. نحولها إلى متباينة مركبة "و": <span class="math-eq">-٤ ≤ ص - ٢ ≤ ٤</span></p><p>2. نضيف <span class="highlight-number">٢</span> لكل الأطراف: <span class="math-eq">-٤ + ٢ ≤ ص ≤ ٤ + ٢</span></p><p>3. نبسط للحصول على الحل: <span class="math-eq">-٢ ≤ ص ≤ ٦</span></p>`,
                smartExplanation: `<p>جرب تعويض قيمة في المنتصف، مثلاً <span class="math-eq">ص = ٠</span>. المتباينة تصبح <span class="math-eq">|٠ - ٢| = |-٢| = ٢</span>. بما أن <span class="math-eq">٢ ≤ ٤</span>، فالعبارة صحيحة. إذن، الصفر يجب أن يكون ضمن الحل. هذا يلغي الخيار (د).</p><p>جرب قيمة حدية، مثلاً <span class="math-eq">ص = ٦</span>. المتباينة تصبح <span class="math-eq">|٦ - ٢| = |٤| = ٤</span>. بما أن <span class="math-eq">٤ ≤ ٤</span>، فالعبارة صحيحة. إذن، الحل يجب أن يشمل ٦. هذا يلغي الخيارين (ب) و (ج) لأنهما لا يحددان الطرف الآخر.</p>`
            },
            { 
                type: 'mcq', level: '⭐⭐', text: `حل المتباينة <span class="math-eq">|٢أ + ١| > ٥</span>`,
                options: [ 
                    { display: '<span class="math-eq">-٣ < أ < ٢</span>', value: 'A' }, 
                    { display: '<span class="math-eq">أ > ٢</span>', value: 'B' }, 
                    { display: '<span class="math-eq">أ < -٣</span>', value: 'C' }, 
                    { display: '<span class="math-eq">أ > ٢</span> أو <span class="math-eq">أ < -٣</span>', value: 'D' }
                ], 
                correct: 'D',
                explanation: `<p>هذه متباينة "أكبر من"، لذا نحولها إلى متباينة مركبة بأداة الربط "أو".</p><p>الحالة الأولى: <span class="math-eq">٢أ + ١ > ٥</span> ← <span class="math-eq">٢أ > ٤</span> ← <span class="math-eq">أ > ٢</span>.</p><p>الحالة الثانية: <span class="math-eq">٢أ + ١ < -٥</span> ← <span class="math-eq">٢أ < -٦</span> ← <span class="math-eq">أ < -٣</span>.</p><p>الحل هو اتحاد الحلين: <span class="math-eq">أ > ٢</span> أو <span class="math-eq">أ < -٣</span>.</p>`,
            },
            {
                type: 'mcq', level: '⭐⭐', text: 'أي متباينة يمثلها الرسم البياني التالي؟<div class="option-nl-wrapper my-4"><div class="option-nl-ticks"><div class="option-nl-tick" style="left: 20%;"><span>-١</span></div><div class="option-nl-tick" style="left: 50%;"><span>٢</span></div><div class="option-nl-tick" style="left: 80%;"><span>٥</span></div><div class="option-nl-line"><div class="option-nl-sol-line" style="left: 0%; width: 20%;"></div><div class="option-nl-sol-point open" style="left: 20%;"></div><div class="option-nl-sol-line" style="left: 80%; width: 20%;"></div><div class="option-nl-sol-point open" style="left: 80%;"></div></div></div></div>',
                options: [
                    { value: 'A', display: `<span class="math-eq">|س - ٢| > ٣</span>` },
                    { value: 'B', display: `<span class="math-eq">|س - ٢| < ٣</span>` },
                    { value: 'C', display: `<span class="math-eq">|س - ٣| > ٢</span>` },
                    { value: 'D', display: `<span class="math-eq">|س - ٣| < ٢</span>` }
                ],
                correct: 'A',
                explanation: '<p>الرسم يمثل <span class="math-eq">س < -١</span> أو <span class="math-eq">س > ٥</span>. لإيجاد متباينة القيمة المطلقة، نوجد نقطة المنتصف: <span class="math-eq"><span class="fraction"><span>(-١+٥)</span><span class="frac-bar"></span><span>٢</span></span> = ٢</span>. ثم نوجد المسافة من المنتصف إلى أحد الطرفين: <span class="math-eq">|٥ - ٢| = ٣</span>. بما أن الأسهم تتجه للخارج، فالمتباينة تستخدم علامة "أكبر من": <span class="math-eq">|س - ٢| > ٣</span>.</p>',
                smartExplanation: `<p>بما أن العدد ٢ يقع في منتصف المسافة بين -١ و ٥، فإن العبارة داخل القيمة المطلقة ستكون <span class="math-eq">|س - ٢|</span>.</p><p>المسافة بين نقطة المنتصف (٢) وأحد الطرفين (٥) هي ٣ وحدات (<span class="math-eq">|٥ - ٢| = ٣</span>). ولأن التمثيل البياني يتجه للخارج، نستخدم علامة "أكبر من" (>).</p><p>إذًا، المتباينة هي <span class="math-eq">|س - ٢| > ٣</span>.</p>`
            },
            {
                type: 'mcq', level: '⭐⭐⭐', text: 'في إحدى الصناعات، يجب أن يكون قطر قضيب الحديد المنتج <span class="math-eq">٥.٦</span> سم، بهامش خطأ لا يزيد عن <span class="math-eq">٠.٠٢</span> سم. أي متباينة تمثل القطر المقبول (ق)؟',
                options: [
                    { display: '<span class="math-eq">|ق - ٠.٠٢| ≤ ٥.٦</span>', value: 'A' },
                    { display: '<span class="math-eq">|ق - ٥.٦| ≤ ٠.٠٢</span>', value: 'B' },
                    { display: '<span class="math-eq">|ق - ٥.٦| ≥ ٠.٠٢</span>', value: 'C' },
                    { display: '<span class="math-eq">|ق + ٥.٦| ≤ ٠.٠٢</span>', value: 'D' }
                ],
                correct: 'B',
                explanation: '<p>القيمة المطلقة تستخدم للتعبير عن المسافة أو الفرق. الجملة تعني أن "الفرق بين القطر الفعلي (ق) والقطر المثالي (٥.٦) يجب أن يكون أقل من أو يساوي (لا يزيد عن) هامش الخطأ (٠.٠٢)".</p><p>يترجم هذا مباشرة إلى المتباينة: <span class="math-eq">|ق - ٥.٦| ≤ ٠.٠٢</span>.</p>'
            },
            { 
                type: 'mcq', level: '⭐⭐', text: `ما هي مجموعة حل المتباينة <span class="math-eq">|س + ٣| < -٤</span>؟`,
                options: [ 
                    { display: '<span class="math-eq">{س | س < -٧}</span>', value: 'A' }, 
                    { display: '<span class="math-eq">{س | س > ١}</span>', value: 'B' }, 
                    { display: 'المجموعة الخالية (∅)', value: 'C' }, 
                    { display: 'جميع الأعداد الحقيقية', value: 'D' }
                ], 
                correct: 'C',
                explanation: `<p>القيمة المطلقة لأي عدد هي دائماً قيمة موجبة أو صفر. لذلك، من المستحيل أن تكون القيمة المطلقة أقل من عدد سالب مثل -٤. إذن، لا يوجد حل لهذه المتباينة.</p>`,
            },
            { 
                type: 'mcq', level: '⭐⭐', text: `ما هي مجموعة حل المتباينة <span class="math-eq">|س - ٩| ≥ -٥</span>؟`,
                options: [ 
                    { display: '<span class="math-eq">{س | س ≥ ١٤}</span>', value: 'A' }, 
                    { display: '<span class="math-eq">{س | س ≤ ٤}</span>', value: 'B' }, 
                    { display: 'المجموعة الخالية (∅)', value: 'C' }, 
                    { display: 'جميع الأعداد الحقيقية', value: 'D' }
                ], 
                correct: 'D',
                explanation: `<p>القيمة المطلقة دائماً تنتج قيمة موجبة أو صفر. أي قيمة موجبة أو صفر هي دائماً أكبر من أو تساوي عدداً سالباً مثل -٥. لذلك، هذه المتباينة صحيحة لجميع الأعداد الحقيقية.</p>`,
            },
            { 
                type: 'mcq', level: '⭐⭐⭐', text: `حل المتباينة <span class="math-eq">|<span class="fraction"><span>م</span><span class="frac-bar"></span><span>٢</span></span> - ١| ≥ ٣</span>`,
                options: [ 
                    { display: '<span class="math-eq">م ≥ ٨</span>', value: 'A' }, 
                    { display: '<span class="math-eq">م ≤ -٤</span>', value: 'B' }, 
                    { display: '<span class="math-eq">-٤ ≤ م ≤ ٨</span>', value: 'C' }, 
                    { display: '<span class="math-eq">م ≤ -٤</span> أو <span class="math-eq">م ≥ ٨</span>', value: 'D' }
                ], 
                correct: 'D',
                explanation: `<p>نحلها كمتباينة "أو".</p><p>الحالة الأولى: <span class="math-eq"><span class="fraction"><span>م</span><span class="frac-bar"></span><span>٢</span></span> - ١ ≥ ٣</span> ← <span class="math-eq"><span class="fraction"><span>م</span><span class="frac-bar"></span><span>٢</span></span> ≥ ٤</span> ← <span class="math-eq">م ≥ ٨</span>.</p><p>الحالة الثانية: <span class="math-eq"><span class="fraction"><span>م</span><span class="frac-bar"></span><span>٢</span></span> - ١ ≤ -٣</span> ← <span class="math-eq"><span class="fraction"><span>م</span><span class="frac-bar"></span><span>٢</span></span> ≤ -٢</span> ← <span class="math-eq">م ≤ -٤</span>.</p><p>الحل هو اتحاد الحلين.</p>`,
            },
            { 
                type: 'mcq', level: '⭐⭐⭐', text: `حل المتباينة <span class="math-eq">٢|س - ١| + ٤ ≤ ١٢</span>`,
                options: [ 
                    { display: '<span class="math-eq">-٣ ≤ س ≤ ٥</span>', value: 'A' }, 
                    { display: '<span class="math-eq">س ≤ ٥</span>', value: 'B' }, 
                    { display: '<span class="math-eq">س ≥ -٣</span>', value: 'C' }, 
                    { display: '<span class="math-eq">س ≤ -٣</span> أو <span class="math-eq">س ≥ ٥</span>', value: 'D' }
                ], 
                correct: 'A',
                explanation: `<p>أولاً، يجب عزل القيمة المطلقة.</p><p>١. اطرح ٤: <span class="math-eq">٢|س - ١| ≤ ٨</span></p><p>٢. اقسم على ٢: <span class="math-eq">|س - ١| ≤ ٤</span></p><p>٣. الآن حلها كمتباينة "و": <span class="math-eq">-٤ ≤ س - ١ ≤ ٤</span></p><p>٤. أضف ١: <span class="math-eq">-٣ ≤ س ≤ ٥</span></p>`,
            },
            {
                type: 'mcq', level: '⭐', text: 'أي تمثيل بياني يمثل حل المتباينة <span class="math-eq">|س| ≥ ٣</span>؟',
                options: [
                    { value: 'A', display: `<div class="option-nl-wrapper"><div class="option-nl-ticks"><div class="option-nl-tick" style="left: 20%;"><span>-٣</span></div><div class="option-nl-tick" style="left: 80%;"><span>٣</span></div><div class="option-nl-line"><div class="option-nl-sol-line" style="left: 0%; width: 20%;"></div><div class="option-nl-sol-point closed" style="left: 20%;"></div><div class="option-nl-sol-line" style="left: 80%; width: 20%;"></div><div class="option-nl-sol-point closed" style="left: 80%;"></div></div></div></div>` },
                    { value: 'B', display: `<div class="option-nl-wrapper"><div class="option-nl-ticks"><div class="option-nl-tick" style="left: 20%;"><span>-٣</span></div><div class="option-nl-tick" style="left: 80%;"><span>٣</span></div><div class="option-nl-line"><div class="option-nl-sol-line" style="left: 20%; width: 60%;"></div><div class="option-nl-sol-point closed" style="left: 20%;"></div><div class="option-nl-sol-point closed" style="left: 80%;"></div></div></div></div>` },
                    { value: 'C', display: `<div class="option-nl-wrapper"><div class="option-nl-ticks"><div class="option-nl-tick" style="left: 20%;"><span>-٣</span></div><div class="option-nl-tick" style="left: 80%;"><span>٣</span></div><div class="option-nl-line"><div class="option-nl-sol-line" style="left: 0%; width: 20%;"></div><div class="option-nl-sol-point open" style="left: 20%;"></div><div class="option-nl-sol-line" style="left: 80%; width: 20%;"></div><div class="option-nl-sol-point open" style="left: 80%;"></div></div></div></div>` },
                ],
                correct: 'A',
                explanation: '<p>المتباينة <span class="math-eq">|س| ≥ ٣</span> تعني <span class="math-eq">س ≥ ٣</span> أو <span class="math-eq">س ≤ -٣</span>.</p><p>هذا يمثل شعاعين متجهين للخارج. الإشارة <span class="math-eq">≥</span> تعني أن الدوائر عند <span class="highlight-number">-٣</span> و <span class="highlight-number">٣</span> يجب أن تكون مغلقة.</p>'
            },
            {
                type: 'mcq', level: '⭐⭐⭐', text: 'يجب أن تكون درجة حرارة محرك السيارة (د) بين ٧٥° و ١٠٥°. أي متباينة قيمة مطلقة تمثل هذا المدى؟',
                options: [
                    { display: '<span class="math-eq">|د - ٩٠| ≤ ١٥</span>', value: 'A' },
                    { display: '<span class="math-eq">|د - ١٥| ≤ ٩٠</span>', value: 'B' },
                    { display: '<span class="math-eq">|د - ٧٥| ≤ ٣٠</span>', value: 'C' },
                    { display: '<span class="math-eq">|د - ١٠٥| ≤ ٣٠</span>', value: 'D' }
                ],
                correct: 'A',
                explanation: '<p>لإيجاد المركز، نحسب المتوسط: <span class="math-eq">(٧٥ + ١٠٥) / ٢ = ٩٠</span>. لإيجاد مقدار التفاوت، نحسب المسافة من المركز إلى أحد الطرفين: <span class="math-eq">١٠٥ - ٩٠ = ١٥</span>. بما أن المدى يشمل الطرفين ("بين")، نستخدم علامة "أصغر من أو يساوي": <span class="math-eq">|د - ٩٠| ≤ ١٥</span>.</p>'
            },
            { 
                type: 'mcq', level: '⭐⭐', text: `حل المتباينة <span class="math-eq">|٣ن + ٦| < ١٥</span>`,
                options: [ 
                    { display: '<span class="math-eq">-٧ < ن < ٣</span>', value: 'A' }, 
                    { display: '<span class="math-eq">ن < ٣</span>', value: 'B' }, 
                    { display: '<span class="math-eq">ن > -٧</span>', value: 'C' }, 
                    { display: '<span class="math-eq">ن < -٧</span> أو <span class="math-eq">ن > ٣</span>', value: 'D' }
                ], 
                correct: 'A',
                explanation: `<p>نحلها كمتباينة "و":</p><p>١. <span class="math-eq">-١٥ < ٣ن + ٦ < ١٥</span></p><p>٢. اطرح ٦: <span class="math-eq">-٢١ < ٣ن < ٩</span></p><p>٣. اقسم على ٣: <span class="math-eq">-٧ < ن < ٣</span></p>`,
            }
        ];
        
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        const questionCount = Math.min(shuffled.length, 5);
        return shuffled.slice(0, questionCount);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            state[exampleId] = { currentIndex: -1, steps: container.querySelectorAll('.step-interactive'), placeholder: container.querySelector('.interactive-placeholder'), prevBtn: container.querySelector('.prev-btn'), nextBtn: container.querySelector('.next-btn'), resetBtn: container.querySelector('.reset-btn') };
            const resetExample = () => { state[exampleId].steps.forEach(step => step.classList.remove('active')); state[exampleId].currentIndex = -1; if (state[exampleId].placeholder) { state[exampleId].placeholder.classList.remove('hidden'); } updateButtons(); };
            const updateButtons = () => { 
                const isFirstStep = state[exampleId].currentIndex <= -1; 
                const isLastStep = state[exampleId].currentIndex >= state[exampleId].steps.length - 1; 
                state[exampleId].prevBtn.disabled = isFirstStep; 
                if (isLastStep) { 
                    state[exampleId].nextBtn.classList.add('hidden'); 
                    if(state[exampleId].resetBtn) state[exampleId].resetBtn.classList.remove('hidden'); 
                } else { 
                    state[exampleId].nextBtn.classList.remove('hidden'); 
                    if(state[exampleId].resetBtn) state[exampleId].resetBtn.classList.add('hidden'); 
                } 
            };
            
            state[exampleId].nextBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex < state[exampleId].steps.length - 1) {
                    if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.add('hidden');
                    }
                    state[exampleId].currentIndex++;
                    state[exampleId].steps[state[exampleId].currentIndex].classList.add('active');
                    updateButtons();
                }
            });
            state[exampleId].prevBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex > -1) {
                    if(state[exampleId].steps[state[exampleId].currentIndex]) {
                       state[exampleId].steps[state[exampleId].currentIndex].classList.remove('active');
                    }
                    state[exampleId].currentIndex--;
                     if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                         state[exampleId].placeholder.classList.remove('hidden');
                     }
                    updateButtons();
                }
            });

            if(state[exampleId].resetBtn) { state[exampleId].resetBtn.addEventListener('click', resetExample); }
            updateButtons();
        });

        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
        
        const closeSmartModalBtn = document.getElementById('closeSmartModalBtn');
        if(closeSmartModalBtn) closeSmartModalBtn.addEventListener('click', closeSmartModal);
    });
    </script>
</body>
</html>
