<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدرس ٣-٣: كتابة المعادلات بصيغة الميل ونقطة | منصة الرياضيات التفاعلية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-change { color: #ef4444; font-weight: bold; }
        .math-eq { font-family: "Courier New", monospace; font-size: 1.1rem; font-weight: bold; color: #4338ca; background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 2px 8px; border-radius: 6px; display: inline-block; vertical-align: middle; }
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .explanation-step { padding-right: 12px; margin-bottom: 1rem; border-right: 3px solid #1d4ed8; transition: opacity 0.5s ease-in-out; }
        .explanation-step:last-child { margin-bottom: 0; }
        .nav-btn:disabled { background-color: #9ca3af; cursor: not-allowed; }
        .highlight-val { color: #c026d3; font-weight: 700; } /* Style for highlighted numbers */
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">الدرس ٣-٣: كتابة المعادلات بصيغة الميل ونقطة</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; العودة إلى الفهرس</a>
                </header>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفهوم الأساسي</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">صيغة الميل ونقطة</h3>
                            <p>تُستخدم <span class="vocab-term">صيغة الميل ونقطة</span> لكتابة معادلة خط مستقيم إذا عُلم ميله (م) وإحداثيات نقطة يمر بها (س₁، ص₁).</p>
                            <div class="mt-4 p-4 bg-white rounded-lg border">
                                 <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-xl math-eq">ص - ص₁ = م (س - س₁)</p>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">الصورة القياسية للمعادلة الخطية</h3>
                            <p>يمكن إعادة كتابة أي معادلة خطية على <span class="vocab-term">الصورة القياسية</span>. وهي مفيدة لتحديد تقاطعات المحاور بسهولة.</p>
                             <div class="mt-4 p-4 bg-white rounded-lg border space-y-2">
                                 <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-xl math-eq">أ س + ب ص = ج</p>
                                 <p class="text-sm text-gray-600">حيث أ، ب، ج أعداد صحيحة، أ ≥ ٠، و أ، ب ليسا معًا صفرًا.</p>
                             </div>
                        </div>
                         <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">التحويل بين الصيغ</h3>
                            <p>يمكنك التحويل من صيغة الميل ونقطة إلى صيغ أخرى مثل صيغة الميل والمقطع (الدرس السابق) أو الصورة القياسية عن طريق التبسيط الجبري.</p>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: أمثلة تفاعلية</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <!-- النوع الأول: كتابة المعادلة بصيغة الميل ونقطة -->
                        <div class="p-6 bg-white rounded-lg space-y-4 mb-8 shadow">
                            <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">النوع الأول: كتابة المعادلة بصيغة الميل ونقطة</h3>
                            <div class="flex flex-col md:flex-row gap-6">
                                <div class="flex-1">
                                    <p class="mb-2"><b>مثال ١ (أ):</b> اكتب معادلة المستقيم الذي ميله ٧ ويمر بالنقطة (-٣، ٥).</p>
                                    <div class="border p-4 rounded-lg bg-white h-full flex flex-col">
                                        <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[150px]">
                                            <div id="interactive-explanation-1a" class="text-right"></div>
                                        </div>
                                        <div class="mt-4 flex justify-between items-center">
                                            <button id="interactive-back-1a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                            <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-1a">0</span> / 2</span>
                                            <button id="interactive-next-1a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <p class="mb-2"><b>مثال ١ (ب):</b> اكتب معادلة المستقيم الذي ميله <span class="math-eq">-<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span></span> ويمر بالنقطة (٠، -٢).</p>
                                    <div class="border p-4 rounded-lg bg-white h-full flex flex-col">
                                        <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[150px]">
                                            <div id="interactive-explanation-1b" class="text-right"></div>
                                        </div>
                                        <div class="mt-4 flex justify-between items-center">
                                            <button id="interactive-back-1b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                            <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-1b">0</span> / 2</span>
                                            <button id="interactive-next-1b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- النوع الثاني: التحويل إلى الصورة القياسية -->
                        <div class="p-6 bg-white rounded-lg space-y-4 mb-8 shadow">
                            <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">النوع الثاني: التحويل إلى الصورة القياسية</h3>
                            <div class="flex flex-col md:flex-row gap-6">
                                <div class="flex-1">
                                    <p class="mb-2"><b>مثال ٢ (أ):</b> اكتب المعادلة <span class="math-eq">ص - ١٠ = ٢(س - ٨)</span> بالصورة القياسية.</p>
                                    <div class="border p-4 rounded-lg bg-white h-full flex flex-col">
                                        <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[200px]">
                                            <div id="interactive-explanation-2a" class="text-right"></div>
                                        </div>
                                        <div class="mt-4 flex justify-between items-center">
                                            <button id="interactive-back-2a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                            <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-2a">0</span> / 3</span>
                                            <button id="interactive-next-2a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <p class="mb-2"><b>مثال ٢ (ب):</b> اكتب المعادلة <span class="math-eq">ص - ٦ = -٣(س + ٢)</span> بالصورة القياسية.</p>
                                    <div class="border p-4 rounded-lg bg-white h-full flex flex-col">
                                        <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[200px]">
                                            <div id="interactive-explanation-2b" class="text-right"></div>
                                        </div>
                                        <div class="mt-4 flex justify-between items-center">
                                            <button id="interactive-back-2b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                            <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-2b">0</span> / 2</span>
                                            <button id="interactive-next-2b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- النوع الثالث: التحويل إلى صيغة الميل والمقطع -->
                        <div class="p-6 bg-white rounded-lg space-y-4 shadow">
                            <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">النوع الثالث: التحويل إلى صيغة الميل والمقطع</h3>
                            <div class="flex flex-col md:flex-row gap-6">
                                <div class="flex-1">
                                    <p class="mb-2"><b>مثال ٣ (أ):</b> اكتب المعادلة <span class="math-eq">ص - ٦ = -٢(س - ٧)</span> بصيغة الميل والمقطع.</p>
                                    <div class="border p-4 rounded-lg bg-white h-full">
                                        <div class="bg-gray-100 p-4 rounded-lg border min-h-[150px]">
                                            <div id="interactive-explanation-3a" class="text-right"></div>
                                        </div>
                                        <div class="mt-4 flex justify-between items-center">
                                            <button id="interactive-back-3a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                            <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-3a">0</span> / 3</span>
                                            <button id="interactive-next-3a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <p class="mb-2"><b>مثال ٣ (ب):</b> اكتب المعادلة <span class="math-eq">٣ص + ٥ = ٢(س + ٧)</span> بصيغة الميل والمقطع.</p>
                                    <div class="border p-4 rounded-lg bg-white h-full">
                                        <div class="bg-gray-100 p-4 rounded-lg border min-h-[150px]">
                                            <div id="interactive-explanation-3b" class="text-right"></div>
                                        </div>
                                        <div class="mt-4 flex justify-between items-center">
                                            <button id="interactive-back-3b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                            <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-3b">0</span> / 4</span>
                                            <button id="interactive-next-3b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">✍️ رابعاً: حان دورك! اختبر فهمك</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">نتيجتك النهائية</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">إعادة الاختبار</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">💡 شرح الإجابة</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <div id="smartExplanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full border-t-4 border-purple-500">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-purple-800">🧠 الحل الذكي</h3>
                <button id="closeSmartModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="smartExplanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    // --- START: NEW TEMPLATE SCRIPT ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">منصة الرياضيات التفاعلية</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">منصة الرياضيات التفاعلية</h1></a>`; } let userInfoHtml = ''; if (studentData) { userInfoHtml = `<div class="flex items-center gap-4"><span class="font-semibold">أهلاً، ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">خروج</a></div>`; } else { userInfoHtml = `<p class="text-lg text-gray-600">زائر</p>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; const logoutLink = headerContainer.querySelector('#logout-link'); if(logoutLink) { logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); } }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">© 2024 جميع الحقوق محفوظة | تصميم وتطوير: أ. عبدالعزيز خالد العبلان</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">لا توجد أسئلة متاحة لهذا الدرس حالياً.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `المحاولات المتبقية: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); const smartButtonHTML = q.smartExplanation ? `<button type="button" id="smart-explain-btn-${index}" class="hidden mt-2 text-xs text-purple-600 hover:underline font-semibold">🧠 الحل الذكي</button>` : ''; return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div class="flex items-center space-x-4 space-x-reverse">${smartButtonHTML}<button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">اعرف لماذا؟</button></div></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">تحقق من إجاباتي</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); if (q.smartExplanation) { const smartExplainBtn = document.getElementById(`smart-explain-btn-${index}`); if(smartExplainBtn) smartExplainBtn.addEventListener('click', () => showSmartExplanation(index)); } }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'لا توجد محاولات متبقية'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = '✔ إجابة صحيحة!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `❌ إجابة خاطئة.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden'); if (q.smartExplanation) { document.getElementById(`smart-explain-btn-${index}`).classList.remove('hidden'); } }); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentData) { saveGrade(lessonId, finalGrade, studentData.id); if (attemptsLeft - 1 > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'تم عرض نتيجتك. سجل الدخول لحفظ تقدمك.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade, studentId) { if (!studentId) return; const saveStatus = document.getElementById('save-status'); saveStatus.textContent = 'جارٍ حفظ نتيجتك...'; const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&lessonId=${lessonId}&grade=${grade}`; fetch(url) .then(res => res.json()) .then(result => { if (result.status === 'success') { saveStatus.textContent = '✔ تم حفظ نتيجتك بنجاح! ستظهر في لوحة التحكم عند العودة.'; const studentData = JSON.parse(localStorage.getItem('currentStudent')); if (!studentData.lessons) studentData.lessons = {}; if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; } else { studentData.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(studentData)); } else { throw new Error(result.message); } }) .catch(error => { saveStatus.textContent = '❌ حدث خطأ أثناء حفظ الدرجة.'; console.error("Save Grade Error:", error); }); }
    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    function showSmartExplanation(questionIndex) { const modal = document.getElementById('smartExplanationModal'); const explanationText = document.getElementById('smartExplanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].smartExplanation) { explanationText.innerHTML = currentQuestions[questionIndex].smartExplanation; modal.classList.remove('hidden'); } }
    function closeSmartModal() { const modal = document.getElementById('smartExplanationModal'); if(modal) modal.classList.add('hidden'); }
    // --- END: NEW TEMPLATE SCRIPT ---

    // --- START: OLD INTERACTIVE EXAMPLES SCRIPT (as requested) ---
    const configs = {
        "1a": {
            totalSteps: 2,
            introText: `نبدأ بصيغة الميل ونقطة: <br><span class='math-eq'>ص - ص₁ = م (س - س₁)</span>.`,
            stepsContent: [
                { text: `<strong>1. نعوض بالمعطيات:</strong><br>الميل <span class='math-eq'>م = ٧</span>، والنقطة (<span class="text-red-600">-٣</span>، <span class="text-blue-600">٥</span>).<br><span class='math-eq'>ص - <span class="text-blue-600">٥</span> = ٧(س - (<span class="text-red-600">-٣</span>))</span>` },
                { text: `<strong>2. نبسط المعادلة:</strong><br>عند طرح عدد سالب، فإننا نجمع.<br><div class='text-center mt-2 p-2 bg-green-100 rounded-md'><span class='math-eq'>ص - ٥ = ٧(س + ٣)</span></div>` }
            ]
        },
        "1b": {
            totalSteps: 2,
            introText: `نبدأ بصيغة الميل ونقطة: <br><span class='math-eq'>ص - ص₁ = م (س - س₁)</span>.`,
            stepsContent: [
                { text: `<strong>1. نعوض بالمعطيات:</strong><br>الميل <span class='math-eq'>م = -<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span></span>، والنقطة (<span class="text-red-600">٠</span>، <span class="text-blue-600">-٢</span>).<br><span class='math-eq'>ص - (<span class="text-blue-600">-٢</span>) = -<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span>(س - <span class="text-red-600">٠</span>)</span>` },
                { text: `<strong>2. نبسط المعادلة:</strong><br><div class='text-center mt-2 p-2 bg-green-100 rounded-md'><span class='math-eq'>ص + ٢ = -<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span>س</span></div>` }
            ]
        },
        "2a": {
            totalSteps: 3, 
            introText: `المعادلة الأصلية: <span class='math-eq'>ص - ١٠ = ٢(س - ٨)</span><br>الهدف هو الوصول للصورة القياسية: <span class='math-eq'>أ س + ب ص = ج</span>.`,
            stepsContent: [
                { text: `<strong>الخطوة 1: فك الأقواس (خاصية التوزيع)</strong><br><span class='math-eq'>ص - ١٠ = ٢س - ١٦</span>` },
                { text: `<strong>الخطوة 2: نجمع <span style='color: #4f46e5;'>المتغيرات</span> و <span style='color: #db2777;'>الثوابت</span></strong><br>ننقل المتغيرات إلى طرف والثوابت إلى الطرف الآخر.<br><span class='math-eq'><span style='color: #4f46e5;'>-٢س + ص</span> = <span style='color: #db2777;'>-١٦ + ١٠</span></span><br><span class='math-eq'>-٢س + ص = -٦</span>` },
                { text: `<strong>الخطوة 3: نجعل معامل 'س' موجبًا</strong><br>نضرب المعادلة كلها في -١.<br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>٢س - ص = ٦</span></div>` }
            ]
        },
        "2b": {
            totalSteps: 2,
            introText: `المعادلة الأصلية: <span class='math-eq'>ص - ٦ = -٣(س + ٢)</span><br>الهدف هو الوصول للصورة القياسية: <span class='math-eq'>أ س + ب ص = ج</span>.`,
            stepsContent: [
                { text: `<strong>الخطوة 1: فك الأقواس (خاصية التوزيع)</strong><br><span class='math-eq'>ص - ٦ = -٣س - ٦</span>` },
                { text: `<strong>الخطوة 2: نجمع <span style='color: #4f46e5;'>المتغيرات</span> و <span style='color: #db2777;'>الثوابت</span></strong><br>ننقل المتغيرات إلى طرف والثوابت إلى الطرف الآخر.<br><span class='math-eq'><span style='color: #4f46e5;'>٣س + ص</span> = <span style='color: #db2777;'>-٦ + ٦</span></span><br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>٣س + ص = ٠</span></div>` }
            ]
        },
        "3a": {
            totalSteps: 3,
            introText: `المعادلة الأصلية: <span class='math-eq'>ص - ٦ = -٢(س - ٧)</span><br>الهدف هو الوصول لصيغة الميل والمقطع: <span class='math-eq'>ص = م س + ب</span>.`,
            stepsContent: [
                { text: `<strong>الخطوة 1: فك الأقواس (خاصية التوزيع)</strong><br><span class='math-eq'>ص - ٦ = -٢س + ١٤</span>` },
                { text: `<strong>الخطوة 2: نعزل المتغير 'ص'</strong><br>ننقل -٦ إلى الطرف الآخر.<br><span class='math-eq'>ص = -٢س + ١٤ + ٦</span>` },
                { text: `<strong>الخطوة 3: نبسط المعادلة</strong><br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>ص = -٢س + ٢٠</span></div>` }
            ]
        },
        "3b": {
            totalSteps: 4,
            introText: `المعادلة الأصلية: <span class='math-eq'>٣ص + ٥ = ٢(س + ٧)</span><br>الهدف هو الوصول لصيغة الميل والمقطع: <span class='math-eq'>ص = م س + ب</span>.`,
            stepsContent: [
                { text: `<strong>الخطوة 1: فك الأقواس (خاصية التوزيع)</strong><br><span class='math-eq'>٣ص + ٥ = ٢س + ١٤</span>` },
                { text: `<strong>الخطوة 2: نعزل الحد '٣ص'</strong><br>ننقل +٥ إلى الطرف الآخر.<br><span class='math-eq'>٣ص = ٢س + ١٤ - ٥</span><br><span class='math-eq'>٣ص = ٢س + ٩</span>` },
                { text: `<strong>الخطوة 3: نعزل المتغير 'ص'</strong><br>نقسم طرفي المعادلة على ٣.<br><span class='math-eq'>ص = <span class="fraction"><span>٢س + ٩</span><span class="frac-bar"></span><span>٣</span></span></span>`},
                { text: `<strong>الخطوة 4: نبسط المعادلة</strong><br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>ص = <span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>س + ٣</span></div>` }
            ]
        }
    };
    function createInteractiveSection(config) {
        let currentStep = 0;
        const renderStep = (step) => {
            if(config.stepCounter) config.stepCounter.textContent = step;
            let cumulativeHTML = `<div class="explanation-step" style="opacity:1; border: none; padding-right: 0;">${config.introText}</div>`;
            for (let i = 0; i < step; i++) {
                if(config.stepsContent[i]) {
                    cumulativeHTML += `<div class="explanation-step" style="opacity:1;">${config.stepsContent[i].text}</div>`;
                }
            }
            if(config.explanationDiv) config.explanationDiv.innerHTML = cumulativeHTML;
            if(config.backBtn) config.backBtn.disabled = (step === 0);
            if(config.nextBtn) config.nextBtn.textContent = (step === config.totalSteps) ? 'إعادة' : 'التالي';
        };
        if(config.nextBtn) config.nextBtn.addEventListener('click', () => {
            currentStep = (currentStep < config.totalSteps) ? currentStep + 1 : 0;
            renderStep(currentStep);
        });
        if(config.backBtn) config.backBtn.addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                renderStep(currentStep);
            }
        });
        renderStep(0);
    }
    // --- END: OLD INTERACTIVE EXAMPLES SCRIPT ---

    // --- START: MAIN SCRIPT INITIALIZATION ---
    const LESSON_ID = 'c3_l3'; 
    function generateQuiz() {
        const questionBank = [
            { 
                type: 'mcq',
                level: '⭐',
                text: `ما معادلة المستقيم الذي ميله <span class="highlight-val">٥</span> ويمر بالنقطة (<span class="highlight-val">٢</span>، <span class="highlight-val">٣</span>) بصيغة الميل ونقطة؟`,
                options: [ 
                    { display: 'ص - ٢ = ٥(س - ٣)', value: 'A' }, 
                    { display: 'ص - ٣ = ٥(س - ٢)', value: 'B' }, 
                    { display: 'ص + ٣ = ٥(س + ٢)', value: 'C' }, 
                    { display: 'ص = ٥س + ٣', value: 'D' }
                ], 
                correct: 'B',
                explanation: `<p><b>الهدف:</b> كتابة المعادلة بصيغة <span class="math-eq">ص - ص₁ = م (س - س₁)</span>.</p>
                              <p><b>المعطيات:</b> الميل <span class="math-eq">م=٥</span>، والنقطة (<span class="text-red-600">٢</span>، <span class="text-blue-600">٣</span>).</p>
                              <p><b>التعويض المباشر:</b></p>
                              <p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص - <span class="text-blue-600">٣</span> = ٥(س - <span class="text-red-600">٢</span>)</span></p>`,
                smartExplanation: `<h4>استراتيجية المطابقة السريعة:</h4><p>الصيغة العامة هي <span class="math-eq">ص - (رقم) = الميل (س - (رقم))</span>. بما أن النقطة هي (٢، ٣)، فيجب أن تكون المعادلة على شكل <span class="math-eq">ص - ٣ = ... (س - ٢)</span>. الخيار (B) هو الوحيد الذي يطابق هذا الشكل تماماً.</p>`
            },
            { 
                type: 'mcq', 
                level: '⭐⭐', 
                text: `اكتب المعادلة <span class="math-eq">ص - ١ = ٤(س + ٢)</span> بالصورة القياسية.`, 
                options: [ 
                    { display: '٤س - ص = -٩', value: 'A' }, 
                    { display: '٤س + ص = ٩', value: 'B' }, 
                    { display: 'ص = ٤س + ٩', value: 'C' }, 
                    { display: '٤س - ص = ٧', value: 'D' }
                ], 
                correct: 'A', 
                explanation: `<p><b>المعادلة الأصلية:</b> <span class="math-eq">ص - ١ = ٤(س + ٢)</span></p>
                               <p><b>1. فك الأقواس:</b> <span class="math-eq">ص - ١ = ٤س + ٨</span></p>
                               <p><b>2. نقل المتغيرات لطرف:</b> <span class="math-eq">-٤س + ص - ١ = ٨</span></p>
                               <p><b>3. نقل الثوابت للطرف الآخر:</b> <span class="math-eq">-٤س + ص = ٩</span></p>
                               <p><b>4. جعل معامل 'س' موجبًا:</b> نضرب في -١.</p>
                               <p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">٤س - ص = -٩</span></p>`,
                smartExplanation: `<h4>استراتيجية التحقق بالتعويض:</h4><p>اختر رقماً سهلاً لـ 'س'، وليكن <span class="math-eq">س = ٠</span>. عوض به في المعادلة الأصلية: <span class="math-eq">ص - ١ = ٤(٠ + ٢)</span> فتصبح <span class="math-eq">ص - ١ = ٨</span>، إذن <span class="math-eq">ص = ٩</span>. إذن النقطة (٠، ٩) يجب أن تحقق الإجابة الصحيحة.</p><p>لنجرب النقطة (٠، ٩) في الخيارات:</p><ul><li>(A): <span class="math-eq">٤(٠) - ٩ = -٩</span> (صحيح)</li><li>(B): <span class="math-eq">٤(٠) + ٩ = ٩</span> (صحيح)</li></ul><p>بما أن خيارين صحيحين، نجرب نقطة أخرى من المعادلة الأصلية، وهي (-٢، ١). لنجربها:</p><ul><li>(A): <span class="math-eq">٤(-٢) - ١ = -٩</span> (صحيح)</li><li>(B): <span class="math-eq">٤(-٢) + ١ = -٧</span> (خاطئ)</li></ul><p>الخيار (A) هو الوحيد الذي حقق النقطتين.</p>`
            },
            { 
                type: 'mcq', 
                level: '⭐⭐', 
                text: `اكتب المعادلة <span class="math-eq">ص + ٥ = -٢(س - ١)</span> بصيغة الميل والمقطع.`, 
                options: [ 
                    { display: 'ص = -٢س + ٧', value: 'A' }, 
                    { display: 'ص = -٢س - ٣', value: 'B' }, 
                    { display: 'ص = ٢س - ٣', value: 'C' }, 
                    { display: '٢س + ص = -٣', value: 'D' }
                ], 
                correct: 'B', 
                explanation: `<p><b>المعادلة الأصلية:</b> <span class="math-eq">ص + ٥ = -٢(س - ١)</span></p>
                               <p><b>1. فك الأقواس:</b> <span class="math-eq">ص + ٥ = -٢س + ٢</span></p>
                               <p><b>2. عزل 'ص':</b> ننقل +٥ للطرف الآخر.</p>
                               <p><span class="math-eq">ص = -٢س + ٢ - ٥</span></p>
                               <p><b>3. التبسيط:</b></p>
                               <p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = -٢س - ٣</span></p>`,
                smartExplanation: `<h4>استراتيجية تحديد المقطع الصادي:</h4><p>المقطع الصادي هو قيمة 'ص' عندما تكون <span class="math-eq">س = ٠</span>. لنعوض <span class="math-eq">س = ٠</span> في المعادلة الأصلية:</p><p><span class="math-eq">ص + ٥ = -٢(٠ - ١)</span></p><p><span class="math-eq">ص + ٥ = ٢</span></p><p><span class="math-eq">ص = -٣</span></p><p>الخيار الوحيد الذي فيه المقطع الصادي (الرقم الثابت) هو -٣ هو الخيار (B).</p>`
            },
            {
                type: 'mcq',
                level: '⭐',
                text: `معادلة المستقيم <span class="math-eq">ص + ١ = ٣(س - ٤)</span> تمر بأي نقطة من النقاط التالية؟`,
                options: [
                    { display: '(-١، ٤)', value: 'A' },
                    { display: '(-٤، ١)', value: 'B' },
                    { display: '(٤، -١)', value: 'C' },
                    { display: '(٣، ٤)', value: 'D' }
                ],
                correct: 'C',
                explanation: `<p>الصيغة هي <span class="math-eq">ص - ص₁ = م (س - س₁)</span>.</p>
                              <p>المعادلة المعطاة: <span class="math-eq">ص + ١ = ٣(س - ٤)</span>.</p>
                              <p>يمكننا إعادة كتابتها لتطابق الصيغة: <span class="math-eq">ص - (-١) = ٣(س - ٤)</span>.</p>
                              <p>بالمقارنة، نجد أن <span class="math-eq">س₁ = ٤</span> و <span class="math-eq">ص₁ = -١</span>.</p>
                              <p>إذن، النقطة هي <span class="math-eq">(٤، -١)</span>.</p>`,
                smartExplanation: `<h4>استراتيجية القراءة المباشرة:</h4><p>لاستخراج النقطة بسرعة، اعكس إشارة الرقم بجانب 'س' لتحصل على الإحداثي السيني، واعكس إشارة الرقم بجانب 'ص' لتحصل على الإحداثي الصادي.</p><p>في المعادلة <span class="math-eq">ص + ١ = ٣(س - ٤)</span>:</p><ul><li>عكس (-٤) هو ٤ &larr; (س)</li><li>عكس (+١) هو -١ &larr; (ص)</li></ul><p>إذن النقطة هي (٤، -١).</p>`
            },
            {
                type: 'mcq',
                level: '⭐⭐⭐',
                text: `ما معادلة المستقيم المار بالنقطتين (<span class="highlight-val">١</span>، <span class="highlight-val">٦</span>) و (<span class="highlight-val">٣</span>، <span class="highlight-val">١٠</span>) بصيغة الميل ونقطة؟`,
                options: [
                    { display: 'ص - ٦ = ٢(س - ١)', value: 'A' },
                    { display: 'ص - ١ = ٢(س - ٦)', value: 'B' },
                    { display: 'ص - ١٠ = -٢(س - ٣)', value: 'C' },
                    { display: 'ص = ٢س + ٤', value: 'D' }
                ],
                correct: 'A',
                explanation: `<p><b>الخطوة 1: إيجاد الميل (م)</b></p>
                              <p><span class="math-eq">م = <span class="fraction"><span>١٠ - ٦</span><span class="frac-bar"></span><span>٣ - ١</span></span> = <span class="fraction"><span>٤</span><span class="frac-bar"></span><span>٢</span></span> = ٢</span></p>
                              <p><b>الخطوة 2: استخدام صيغة الميل ونقطة</b></p>
                              <p>نستخدم الميل <span class="math-eq">م=٢</span> وإحدى النقطتين، ولتكن (<span class="text-red-600">١</span>، <span class="text-blue-600">٦</span>).</p>
                              <p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص - ٦ = ٢(س - ١)</span></p>
                              <p class="text-sm text-gray-600">(ملاحظة: استخدام النقطة الأخرى (٣، ١٠) سيعطي معادلة مكافئة: ص - ١٠ = ٢(س - ٣))</p>`,
                smartExplanation: `<h4>استراتيجية الميل أولاً:</h4><p>أولاً، احسب الميل بين النقطتين (١، ٦) و (٣، ١٠):</p><p><span class="math-eq">الميل = <span class="fraction"><span>فرق الصادات</span><span class="frac-bar"></span><span>فرق السينات</span></span> = <span class="fraction"><span>١٠ - ٦</span><span class="frac-bar"></span><span>٣ - ١</span></span> = <span class="fraction"><span>٤</span><span class="frac-bar"></span><span>٢</span></span> = ٢</span></p><p>بما أن الميل هو ٢، نستبعد الخيار (C) لأن ميله -٢. الآن، لنجرب النقطة (١، ٦) في الخيار (A):</p><p><span class="math-eq">ص - ٦ = ٢(س - ١)</span> &larr; <span class="math-eq">٦ - ٦ = ٢(١ - ١)</span> &larr; <span class="math-eq">٠ = ٠</span></p><p>المعادلة صحيحة.</p>`
            },
            { 
                type: 'mcq', 
                level: '⭐⭐', 
                text: `اكتب المعادلة <span class="math-eq">ص - ٥ = -١(س + ٣)</span> بالصورة القياسية.`, 
                options: [ 
                    { display: 'س + ص = ٢', value: 'A' }, 
                    { display: 'س - ص = ٢', value: 'B' }, 
                    { display: 'ص = -س + ٢', value: 'C' }, 
                    { display: 'س + ص = -٨', value: 'D' }
                ], 
                correct: 'A', 
                explanation: `<p><b>المعادلة الأصلية:</b> <span class="math-eq">ص - ٥ = -١(س + ٣)</span></p>
                               <p><b>1. فك الأقواس:</b> <span class="math-eq">ص - ٥ = -س - ٣</span></p>
                               <p><b>2. نقل المتغيرات لطرف:</b> <span class="math-eq">س + ص - ٥ = -٣</span></p>
                               <p><b>3. نقل الثوابت للطرف الآخر:</b> <span class="math-eq">س + ص = -٣ + ٥</span></p>
                               <p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">س + ص = ٢</span></p>`
            },
            {
                type: 'mcq',
                level: '⭐',
                text: `ما معادلة المستقيم الذي ميله <span class="highlight-val">غير معرف</span> ويمر بالنقطة (<span class="highlight-val">٤</span>، <span class="highlight-val">-٦</span>)؟`,
                options: [
                    { display: 'ص = -٦', value: 'A' },
                    { display: 'س = ٤', value: 'B' },
                    { display: 'ص = ٤', value: 'C' },
                    { display: 'س = -٦', value: 'D' }
                ],
                correct: 'B',
                explanation: `<p><b>1. صيغة الميل ونقطة:</b></p>
                              <p>نبدأ بصيغة الميل ونقطة: <span class="math-eq">ص - ص₁ = م (س - س₁)</span>.</p>
                              <p><b>2. فهم الميل غير المعرف:</b></p>
                              <p>الميل غير المعرف يعني أن المقام في صيغة الميل (<span class="fraction"><span>فرق الصادات</span><span class="frac-bar"></span><span>فرق السينات</span></span>) يساوي صفراً. يمكننا التعبير عن هذا الميل رمزياً بالكسر <span class="math-eq"><span class="fraction"><span>١</span><span class="frac-bar"></span><span>٠</span></span></span> لأغراض الحل.</p>
                              <p><b>3. التعويض في المعادلة:</b></p>
                              <p>نعوض بالنقطة (<span class="text-red-600">٤</span>، <span class="text-blue-600">-٦</span>) والميل في الصيغة:</p>
                              <p class="text-center"><span class="math-eq">ص - (-٦) = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٠</span></span> (س - ٤)</span></p>
                              <p class="text-center"><span class="math-eq">ص + ٦ = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٠</span></span> (س - ٤)</span></p>
                              <p><b>4. التبسيط لإيجاد المعادلة:</b></p>
                              <p>للتخلص من المقام، نضرب طرفي المعادلة في ٠:</p>
                              <p class="text-center"><span class="math-eq">٠ × (ص + ٦) = ١ × (س - ٤)</span></p>
                              <p>ينتج عن ذلك:</p>
                              <p class="text-center"><span class="math-eq">٠ = س - ٤</span></p>
                              <p>وبترتيب المعادلة نحصل على الحل النهائي:</p>
                              <p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">س = ٤</span></p>`,
                smartExplanation: `<h4>استراتيجية الحالة الخاصة:</h4><p>كلمة "ميل غير معرف" تعني مباشرة أن المستقيم رأسي. معادلة أي مستقيم رأسي تكون دائماً على الصورة <span class="math-eq">س = رقم</span>. بما أن النقطة هي (٤، -٦)، فإن قيمة 'س' الثابتة هي ٤. إذن المعادلة هي <span class="math-eq">س = ٤</span>.</p>`
            },
            { 
                type: 'mcq', 
                level: '⭐⭐', 
                text: `ما هي صيغة الميل والمقطع للمعادلة <span class="math-eq">ص - ٨ = ٣(س - ٢)</span>؟`, 
                options: [ 
                    { display: 'ص = ٣س + ٢', value: 'A' }, 
                    { display: 'ص = ٣س + ١٤', value: 'B' }, 
                    { display: 'ص = ٣س - ١٤', value: 'C' }, 
                    { display: '٣س - ص = -٢', value: 'D' }
                ], 
                correct: 'A', 
                explanation: `<p><b>المعادلة الأصلية:</b> <span class="math-eq">ص - ٨ = ٣(س - ٢)</span></p>
                               <p><b>1. فك الأقواس:</b> <span class="math-eq">ص - ٨ = ٣س - ٦</span></p>
                               <p><b>2. عزل 'ص':</b> <span class="math-eq">ص = ٣س - ٦ + ٨</span></p>
                               <p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = ٣س + ٢</span></p>`
            },
            {
                type: 'mcq',
                level: '⭐',
                text: `ما النقطة التي يمر بها المستقيم <span class="math-eq">ص + ٧ = -٤(س - ٩)</span>؟`,
                options: [
                    { display: '(٩، -٧)', value: 'A' },
                    { display: '(-٩، ٧)', value: 'B' },
                    { display: '(٩، ٧)', value: 'C' },
                    { display: '(-٤، -٧)', value: 'D' }
                ],
                correct: 'A',
                explanation: `<p>الصيغة هي <span class="math-eq">ص - ص₁ = م (س - س₁)</span>.</p>
                              <p>للمعادلة <span class="math-eq">ص + ٧ = -٤(س - ٩)</span>، نكتبها على الصورة <span class="math-eq">ص - (-٧) = -٤(س - ٩)</span>.</p>
                              <p>بالمقارنة، نجد أن <span class="math-eq">س₁ = ٩</span> و <span class="math-eq">ص₁ = -٧</span>.</p>
                              <p>إذن، النقطة هي <span class="math-eq">(٩، -٧)</span>.</p>`,
                smartExplanation: `<h4>استراتيجية القراءة المباشرة:</h4><p>لاستخراج النقطة بسرعة، اعكس إشارة الرقم بجانب 'س' لتحصل على الإحداثي السيني، واعكس إشارة الرقم بجانب 'ص' لتحصل على الإحداثي الصادي.</p><p>في المعادلة <span class="math-eq">ص + ٧ = -٤(س - ٩)</span>:</p><ul><li>عكس (-٩) هو ٩ &larr; (س)</li><li>عكس (+٧) هو -٧ &larr; (ص)</li></ul><p>إذن النقطة هي (٩، -٧).</p>`
            },
            {
                type: 'mcq',
                level: '⭐',
                text: `ما معادلة المستقيم الذي ميله <span class="highlight-val">٠</span> ويمر بالنقطة (<span class="highlight-val">٤</span>، <span class="highlight-val">-٦</span>)؟`,
                options: [
                    { display: 'ص = -٦', value: 'A' },
                    { display: 'س = ٤', value: 'B' },
                    { display: 'ص = ٤', value: 'C' },
                    { display: 'س = -٦', value: 'D' }
                ],
                correct: 'A',
                explanation: `<p>الميل يساوي صفر يعني أن الخط أفقي.</p>
                              <p>معادلة الخط الأفقي هي دائماً <span class="math-eq">ص = قيمة ثابتة</span>.</p>
                              <p>بما أن الخط يمر بالنقطة (٤، -٦)، فإن قيمة 'ص' الثابتة هي -٦.</p>
                              <p>إذن، المعادلة هي <span class="math-eq">ص = -٦</span>.</p>`,
                smartExplanation: `<h4>استراتيجية الحالة الخاصة:</h4><p>الميل صفر يعني أن الخط أفقي تماماً. معادلة أي خط أفقي تكون دائماً على الصورة <span class="math-eq">ص = رقم</span>. بما أن الخط يمر بالنقطة (٤، -٦)، فإن قيمة 'ص' ثابتة عند -٦. إذن المعادلة هي <span class="math-eq">ص = -٦</span>.</p>`
            },
            {
                type: 'mcq',
                level: '⭐⭐⭐',
                text: `اكتب معادلة المستقيم المار بالنقطتين (<span class="highlight-val">٢</span>، <span class="highlight-val">-١</span>) و (<span class="highlight-val">٤</span>، <span class="highlight-val">٥</span>) بالصورة القياسية.`,
                options: [
                    { display: '٣س - ص = ٧', value: 'A' },
                    { display: '٣س + ص = ٧', value: 'B' },
                    { display: 'ص = ٣س - ٧', value: 'C' },
                    { display: 'س - ٣ص = ٥', value: 'D' }
                ],
                correct: 'A',
                explanation: `<p><b>1. نجد الميل:</b> <span class="math-eq">م = <span class="fraction"><span>٥ - (-١)</span><span class="frac-bar"></span><span>٤ - ٢</span></span> = <span class="fraction"><span>٦</span><span class="frac-bar"></span><span>٢</span></span> = ٣</span>.</p>
                              <p><b>2. نستخدم صيغة الميل ونقطة (باستخدام النقطة (٤، ٥)):</b> <span class="math-eq">ص - ٥ = ٣(س - ٤)</span>.</p>
                              <p><b>3. فك الأقواس:</b> <span class="math-eq">ص - ٥ = ٣س - ١٢</span>.</p>
                              <p><b>4. نحول للصورة القياسية:</b> <span class="math-eq">-٣س + ص = -١٢ + ٥</span> &rarr; <span class="math-eq">-٣س + ص = -٧</span>.</p>
                              <p><b>5. نجعل معامل 'س' موجبًا:</b> <span class="math-eq">٣س - ص = ٧</span>.</p>`,
                smartExplanation: `<h4>استراتيجية التحقق بالتعويض:</h4><p>أسهل طريقة هي تجربة النقطتين في الخيارات. لنبدأ بالنقطة (٢، -١):</p><ul><li>(A): <span class="math-eq">٣(٢) - (-١) = ٧</span> (صحيح)</li><li>(B): <span class="math-eq">٣(٢) + (-١) = ٥</span> (خاطئ)</li></ul><p>لقد استبعدنا الخيار (B). الآن نجرب النقطة الثانية (٤، ٥) في الخيار (A):</p><ul><li>(A): <span class="math-eq">٣(٤) - ٥ = ١٢ - ٥ = ٧</span> (صحيح)</li></ul><p>بما أن الخيار (A) حقق النقطتين، فهو الإجابة الصحيحة.</p>`
            },
            {
                type: 'mcq',
                level: '⭐⭐⭐',
                text: `ما هي معادلة المستقيم الذي يقطع المحور السيني عند س = <span class="highlight-val">٥</span> والمحور الصادي عند ص = <span class="highlight-val">-٢</span>؟`,
                options: [
                    { display: 'ص = <span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٥</span></span>س - ٢', value: 'A' },
                    { display: 'ص = <span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٢</span></span>س - ٢', value: 'B' },
                    { display: 'ص = -٢س + ٥', value: 'C' },
                    { display: '٢س - ٥ص = ١٠', value: 'D' }
                ],
                correct: 'A',
                explanation: `<p>التقاطع مع المحور السيني عند ٥ يعني النقطة (٥، ٠).</p>
                              <p>التقاطع مع المحور الصادي عند -٢ يعني النقطة (٠، -٢). وهذا هو المقطع الصادي <span class="math-eq">ب = -٢</span>.</p>
                              <p><b>1. نجد الميل:</b> <span class="math-eq">م = <span class="fraction"><span>-٢ - ٠</span><span class="frac-bar"></span><span>٠ - ٥</span></span> = <span class="fraction"><span>-٢</span><span class="frac-bar"></span><span>-٥</span></span> = <span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٥</span></span></span>.</p>
                              <p><b>2. نكتب بصيغة الميل والمقطع (ص = م س + ب):</b></p>
                              <p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = <span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٥</span></span>س - ٢</span></p>`,
                smartExplanation: `<h4>استراتيجية استغلال المقطع الصادي:</h4><p>معلومة "يقطع المحور الصادي عند ص = -٢" تعني أن المقطع (ب) هو -٢. هذا يستبعد الخيار (C).<br>الآن نحسب الميل باستخدام النقطتين (٥، ٠) و (٠، -٢):</p><p><span class="math-eq">الميل = <span class="fraction"><span>فرق الصادات</span><span class="frac-bar"></span><span>فرق السينات</span></span> = <span class="fraction"><span>-٢ - ٠</span><span class="frac-bar"></span><span>٠ - ٥</span></span> = <span class="fraction"><span>-٢</span><span class="frac-bar"></span><span>-٥</span></span></span></p><p>سالب على سالب يعطي موجب، إذن الميل هو <span class="math-eq"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٥</span></span></span>. الخيار (A) هو الوحيد الذي ميله <span class="math-eq"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٥</span></span></span> ومقطعه -٢.</p>`
            },
            {
                type: 'mcq',
                level: '⭐⭐⭐',
                text: `تبدأ درجة حرارة سائل عند <span class="highlight-val">٢٥</span>°م، وتنخفض بمعدل <span class="highlight-val">٣</span>°م كل دقيقة. ما المعادلة التي تمثل درجة الحرارة (ص) بعد (س) دقيقة بصيغة الميل والمقطع؟`,
                options: [
                    { display: 'ص = -٣س + ٢٥', value: 'A' },
                    { display: 'ص = ٣س + ٢٥', value: 'B' },
                    { display: 'ص = ٢٥س - ٣', value: 'C' },
                    { display: 'ص = -٣س - ٢٥', value: 'D' }
                ],
                correct: 'A',
                explanation: `<p><b>المقطع الصادي (ب):</b> هو درجة الحرارة الابتدائية، إذن <span class="math-eq">ب = ٢٥</span>.</p>
                              <p><b>الميل (م):</b> هو معدل التغير. بما أن الحرارة "تنخفض"، فالميل سالب. إذن <span class="math-eq">م = -٣</span>.</p>
                              <p><b>المعادلة (ص = م س + ب):</b></p>
                              <p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = -٣س + ٢٥</span></p>`,
                smartExplanation: `<h4>استراتيجية الترجمة المباشرة:</h4><p>لنحول الكلمات إلى أرقام:</p><ul><li><b>"تبدأ درجة حرارة ... عند ٢٥°"</b>: هذه هي نقطة البداية أو المقطع الصادي (ب). إذن <span class="math-eq">ب = ٢٥</span>.</li><li><b>"تنخفض بمعدل ٣°"</b>: كلمة "معدل" تعني الميل (م)، وكلمة "تنخفض" تعني أن الميل سالب. إذن <span class="math-eq">م = -٣</span>.</li></ul><p>بتركيبها في صيغة <span class="math-eq">ص = م س + ب</span>، نحصل على <span class="math-eq">ص = -٣س + ٢٥</span>.</p>`
            }
        ];
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        const questionCount = Math.min(shuffled.length, 5);
        return shuffled.slice(0, questionCount);
    }

    document.addEventListener('DOMContentLoaded', () => {
        // --- Initialize Old Interactive Examples ---
        Object.keys(configs).forEach(key => {
            createInteractiveSection({
                nextBtn: document.getElementById(`interactive-next-${key}`),
                backBtn: document.getElementById(`interactive-back-${key}`),
                stepCounter: document.getElementById(`interactive-step-counter-${key}`),
                explanationDiv: document.getElementById(`interactive-explanation-${key}`),
                ...configs[key]
            });
        });

        // --- Initialize New Template Features ---
        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
        
        const closeSmartModalBtn = document.getElementById('closeSmartModalBtn');
        if(closeSmartModalBtn) closeSmartModalBtn.addEventListener('click', closeSmartModal);
    });
    // --- END: MAIN SCRIPT INITIALIZATION ---
    </script>
</body>
</html>
