<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© (6 ÙØ¦Ø§Øª)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #007bff;
            --primary-dark: #0056b3;
            --correct-color: #28a745;
            --correct-border: #208637;
            --incorrect-color: #dc3545;
            --incorrect-border: #b02a37;
            --light-gray: #f0f4f8;
            --dark-gray: #333;
            --border-color: #ccc;
            --secondary-color: #6c757d;
            --golden-color: #ffc107;
            --golden-dark: #e0a800;
            --golden-bg: #fff8e1;
            --golden-border: #ffc107;
        }

        /* --- Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„ÙˆÙ…ÙŠØ¶ --- */
        @keyframes flash-green {
            0%, 100% {
                background-color: var(--correct-color);
                color: #fff;
                transform: scale(1.05);
            }
            50% {
                background-color: #fff;
                color: var(--correct-color);
                transform: scale(1);
            }
        }
        
        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„ÙˆÙ…ÙŠØ¶ Ù„Ù„Ù‚ÙÙ„ Ø§Ù„Ù†Ø´Ø· */
        @keyframes pulse-lock {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 15px rgba(0, 123, 255, 0.7);
            }
        }
        @keyframes pulse-lock-golden {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 8px rgba(255, 193, 7, 0.3);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 15px rgba(255, 193, 7, 0.7);
            }
        }


        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--light-gray);
            color: var(--dark-gray);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 15px;
            box-sizing: border-box;
        }
        #splash-content {
            background-color: #ffffff;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            width: 95%;
            max-width: 400px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            border: 3px solid var(--primary-color);
        }
        #splash-content h2 {
            color: var(--primary-dark);
            margin-top: 0;
            font-size: 1.5rem;
        }
        #splash-welcome {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 15px;
        }
        #splash-author {
            font-size: 1.0rem;
            font-weight: 700;
            color: var(--secondary-color);
            margin-bottom: 25px;
            display: block;
        }
        #start-game-btn {
            padding: 12px 30px;
            font-size: 1.2rem;
            font-weight: 700;
            background: linear-gradient(145deg, #007bff, #0056b3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
        }
        #start-game-btn:active { transform: scale(0.98); }

        /* (ØªØ¹Ø¯ÙŠÙ„) Ø´Ø§Ø´Ø© Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ù‚ÙØ§Ù„ (ØªÙ… ØªØµØºÙŠØ±Ù‡Ø§ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨Ù‡Ø§) */
        #locks-hub-screen {
            width: 95%;
            max-width: 360px; /* (ØªØ¹Ø¯ÙŠÙ„) ØªÙ… ØªÙƒØ¨ÙŠØ±Ù‡ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ÙŠÙ†Ø§Ø³Ø¨ 3 Ø£Ø¹Ù…Ø¯Ø© */
            background-color: #ffffff;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            text-align: center;
            border: 2px solid #ddd;
            z-index: 1000;
        }
        #locks-hub-screen h2 {
            color: var(--primary-dark);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }
        #locks-hub-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* (ØªØ¹Ø¯ÙŠÙ„) 3x2 */
            gap: 10px; /* (ØªØ¹Ø¯ÙŠÙ„) ØªØµØºÙŠØ± Ø§Ù„Ù…Ø³Ø§ÙØ© */
            margin: 15px 0;
        }
        .lock-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: var(--light-gray);
            border-radius: 8px;
            padding: 10px 5px; 
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: not-allowed; 
            opacity: 0.6; 
        }
        .lock-item .lock-icon {
            font-size: 2.0rem; 
            color: var(--secondary-color);
        }
        .lock-item .lock-label {
            font-size: 0.8rem; 
            font-weight: 700;
            margin-top: 5px;
            color: var(--dark-gray);
            min-height: 2.4em; 
        }
        .lock-item .lock-score {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--secondary-color);
            min-height: 1.2em;
        }
        /* Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
        .lock-item.golden {
            /* (ØªØ¹Ø¯ÙŠÙ„) ØªÙ… Ø¥Ø²Ø§Ù„Ø© span 2 */
            background-color: var(--golden-bg);
            border-color: var(--golden-color);
        }
        .lock-item.golden .lock-icon {
            color: var(--golden-dark);
            font-size: 2.0rem; /* (ØªØ¹Ø¯ÙŠÙ„) ØªÙˆØ­ÙŠØ¯ Ø­Ø¬Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
        }
        /* Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ù…ÙƒØªÙ…Ù„ (Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥Ø¹Ø§Ø¯Ø©) */
        .lock-item.completed, .lock-item.failed {
            opacity: 1;
            cursor: pointer; 
        }
        .lock-item.completed {
            border-color: var(--correct-border);
            background-color: #eaf6ec;
        }
        .lock-item.completed .lock-icon {
            color: var(--correct-color);
        }
        .lock-item.completed .lock-score {
            color: var(--correct-color);
        }
        .lock-item.failed {
            border-color: var(--incorrect-border);
            background-color: #fbebee;
        }
        .lock-item.failed .lock-icon {
            color: var(--incorrect-color);
        }
        .lock-item.failed .lock-score {
            color: var(--incorrect-color);
        }
        /* Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ù…Ø¹Ø·Ù„ (Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·) */
        .lock-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #eee;
        }
        .lock-item.disabled .lock-icon {
            color: #999;
        }

        /* Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ù†Ø´Ø· (ÙŠÙˆÙ…Ø¶ ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„Ø¶ØºØ·) */
        .lock-item.active {
            animation: pulse-lock 1.5s infinite;
            border-color: var(--primary-color);
            cursor: pointer; 
            opacity: 1; 
        }
        .lock-item.golden.active {
            animation: pulse-lock-golden 1.5s infinite;
            border-color: var(--golden-dark);
        }
        #hub-status-message {
            font-size: 1.0rem; 
            font-weight: 700;
            color: var(--primary-dark);
            min-height: 1.5em;
        }


        /* (ØªØ¹Ø¯ÙŠÙ„) ØªÙ… ØªØµØºÙŠØ± Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .game-container {
            width: 95%;
            max-width: 340px; 
            background-color: #ffffff;
            border-radius: 12px;
            padding: 15px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            text-align: center;
            border: 2px solid #ddd;
            position: relative; 
            overflow: hidden; 
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
        .game-container.golden {
            border-color: var(--golden-border);
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
        }
        .game-container.golden #lock-icon { color: var(--golden-dark); }
        .game-container.golden #background-lock { color: var(--golden-dark); opacity: 0.4; }


        #background-lock {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scaleX(-1) rotate(-5deg);
            font-size: 250px; 
            color: var(--primary-color);
            opacity: 0.4; 
            z-index: 1; 
            transition: transform 0.3s ease; 
        }

        .game-content {
            position: relative;
            z-index: 2; 
        }

        #lock-icon {
            font-size: 30px; 
            color: var(--primary-color);
            margin-bottom: 10px;
            transform: rotate(5deg);
            transition: transform 0.3s ease; 
        }

        #welcomeMessage {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 10px;
            min-height: 25px; 
        }
        .game-container.golden #welcomeMessage {
            color: var(--golden-dark);
        }
        
        #problem {
            font-size: 1.4rem; 
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 15px;
            min-height: 50px; 
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap; 
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒØ³ÙˆØ± */
        .frac {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            margin: 0 4px;
            padding: 0 2px;
        }
        .frac-num {
            padding: 0 4px;
        }
        .frac-den {
            border-top: 2px solid var(--dark-gray);
            padding: 0 4px;
        }

        #stage1-logic {
            margin-bottom: 15px;
            min-height: 160px; 
        }
        
        #stage1-logic p {
            font-size: 1.0rem; 
            font-weight: 700;
            margin-bottom: 10px;
        }

        .logic-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .logic-btn {
            padding: 10px 0; 
            font-size: 1.1rem; 
            font-weight: 700;
            border: 2px solid var(--primary-color);
            background-color: #fff;
            color: var(--primary-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            width: 100px; 
        }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø²Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
        .game-container.golden .logic-btn {
            border-color: var(--golden-color);
            color: var(--golden-dark);
        }
        .game-container.golden .logic-btn.correct {
            background-color: var(--correct-color);
            border-color: var(--correct-border);
            color: #fff;
        }
        .game-container.golden .logic-btn.incorrect {
            background-color: var(--incorrect-color);
            border-color: var(--incorrect-border);
            color: #fff;
        }


        .logic-btn:disabled { cursor: not-allowed; opacity: 0.8; }
        .logic-btn.correct { background-color: var(--correct-color); border-color: var(--correct-border); color: #fff; }
        .logic-btn.incorrect { background-color: var(--incorrect-color); border-color: var(--incorrect-border); color: #fff; }
        .logic-btn.flash-correct { animation: flash-green 0.7s 2; }

        #stage1-hint {
            font-size: 0.9rem; 
            font-weight: 600;
            padding: 8px;
            border-radius: 6px;
        }
        #stage1-hint.correct { color: var(--correct-color); background-color: #eaf6ec; }
        #stage1-hint.incorrect { color: var(--incorrect-border); background-color: #fbebee; }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
        .game-container.golden #stage1-hint.correct { background-color: #f3f9e9; }
        .game-container.golden #stage1-hint.incorrect { background-color: #fbebee; }


        #stage1-next-btn {
            width: 100%;
            padding: 10px;
            font-size: 1.0rem;
            font-weight: 700;
            background: linear-gradient(145deg, #007bff, #0056b3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.2);
            margin-top: 10px;
        }
        #stage1-next-btn:active { transform: scale(0.98); }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø²Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
        .game-container.golden #stage1-next-btn {
            background: linear-gradient(145deg, var(--golden-color), var(--golden-dark));
            box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
        }


        #stage2-values {
            display: flex;
            flex-wrap: nowrap;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
            width: 100%;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .variable, .static-operator {
            font-size: 1.1rem; 
            font-weight: 700;
            color: #000;
        }
        .static-operator { color: var(--primary-dark); width: 20px; text-align: center; } 
        #logic-display {
            font-size: 1.0rem; 
            font-weight: 700;
            color: #000;
            width: 50px; 
            text-align: center;
            padding: 8px 4px;
            border: 2px solid transparent;
        }

        .value-input {
            width: 40px;
            padding: 8px 4px;
            font-size: 1.1rem;
            text-align: center;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            box-sizing: border-box;
            appearance: none; 
            font-family: 'Cairo', sans-serif;
            direction: ltr; 
        }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
        .game-container.golden .value-input {
             border-color: var(--golden-color);
        }
        .game-container.golden .value-input:focus {
             outline: 2px solid var(--golden-dark);
             border-color: var(--golden-dark);
        }

        /* (ØªØ¹Ø¯ÙŠÙ„) ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø¨Ù†Ù‚Ù„ Ø§Ù„Ø²Ø± Ø¥Ù„Ù‰ Ù‡Ù†Ø§ */
        #unlock-btn {
            width: 100%;
            padding: 10px; 
            font-size: 1.0rem; 
            font-weight: 700;
            background: linear-gradient(145deg, #007bff, #0056b3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.2);
        }
        #unlock-btn:active { transform: scale(0.98); box-shadow: 0 2px 4px rgba(0, 123, 255, 0.3); }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø²Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
        .game-container.golden #unlock-btn {
            background: linear-gradient(145deg, var(--golden-color), var(--golden-dark));
            box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
        }


        #post-answer-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .post-btn {
            flex: 1; 
            padding: 10px; 
            font-size: 0.9rem; 
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .post-btn.next { background-color: var(--primary-color); color: white; }
        .post-btn.why { background-color: var(--secondary-color); color: white; }
        .post-btn:active { transform: scale(0.98); }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø²Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
        .game-container.golden .post-btn.next {
             background-color: var(--golden-dark);
        }


        #feedback {
            margin-top: 10px;
            font-size: 0.95rem; 
            font-weight: 700;
            min-height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .correct { color: var(--correct-color); }
        .incorrect { color: var(--incorrect-color); }
        .partial { color: #ffc107; }

        .hidden { display: none !important; }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© --- */
        #modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: right; 
        }
        #modal-close-btn {
            position: absolute;
            top: 10px;
            left: 15px; 
            background: transparent;
            border: none;
            font-size: 2rem;
            color: #aaa;
            cursor: pointer;
        }
        #modal-title {
            color: var(--primary-dark);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        #modal-body {
            font-size: 1.0rem; 
            line-height: 1.6;
        }
        #modal-body b { color: var(--primary-dark); }
        
        .solution-columns {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            gap: 15px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        .solution-column {
            flex: 1;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 6px;
        }
        .solution-column h4 {
            margin-top: 0;
            margin-bottom: 5px;
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
        }
        /* ØªÙ†Ø³ÙŠÙ‚ ØªØ­Ø°ÙŠØ± Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ Ø³Ø§Ù„Ø¨ */
        .warning-text {
            color: var(--incorrect-border);
            font-weight: 700;
            background-color: var(--golden-bg);
            padding: 2px 4px;
            border-radius: 4px;
            display: inline-block;
        }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© */
        #final-screen {
            text-align: center;
            padding: 20px;
            width: 95%;
            max-width: 380px; 
            background-color: #ffffff;
            border-radius: 12px;
            padding: 20px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            text-align: center;
            border: 2px solid #ddd;
        }
        #final-screen h2 {
            color: var(--primary-dark);
            font-size: 1.8rem;
        }
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù„Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ (Ø¨Ø¯ÙˆÙ† Tailwind) */
        #final-result-display p {
            font-size: 1.1rem;
            margin: 5px 0;
        }
        #final-result-display span {
            font-weight: bold;
            font-size: 1.3rem;
        }
        #leaderboard-loader {
            font-size: 1.1rem;
            color: var(--secondary-color);
            padding: 20px;
        }
        #leaderboard-container {
            margin-top: 20px;
        }
        #leaderboard-container h3 {
            font-size: 1.5rem;
            color: var(--dark-gray);
            margin-bottom: 15px;
        }
        #leaderboard-container table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #leaderboard-container th, #leaderboard-container td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        #leaderboard-container th {
            background-color: var(--dark-gray);
            color: white;
            font-size: 0.9rem;
        }
        #leaderboard-container td {
            font-size: 1rem;
        }
        #leaderboard-container tr.current-user {
            background-color: var(--golden-bg);
            font-weight: bold;
        }
        #finish-game-wrapper {
            margin-top: 30px;
        }
        #finish-game-btn {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 700;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #finish-game-btn:hover {
            background-color: #5a6268;
        }

    </style>
</head>
<body>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div id="splash-screen">
        <div id="splash-content">
            <h2>ğŸ”’ Ù„Ø¹Ø¨Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© ğŸ”’</h2>
            <p id="splash-welcome">
                Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! Ø§Ù†Ø·Ù„Ù‚ ÙÙŠ Ø±Ø­Ù„Ø© Ù„ÙØªØ­ Ø§Ù„Ø£Ù‚ÙØ§Ù„ Ø§Ù„Ø³ØªØ©ØŒ Ø¨Ø¯Ø¡Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ù‚ÙØ§Ù„ Ø§Ù„Ø¨Ø³ÙŠØ·Ø© ÙˆÙˆØµÙˆÙ„Ø§Ù‹ Ø¥Ù„Ù‰ Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„Ù…Ù†ÙŠØ¹.
                <br>
                ÙƒÙ„ Ù‚ÙÙ„ ÙŠØªØ·Ù„Ø¨ Ù…Ù†Ùƒ Ø®Ø·ÙˆØªÙŠÙ†: <b>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¯Ø§Ø©</b> Ø§Ù„ØµØ­ÙŠØ­Ø© (Ùˆ/Ø£Ùˆ) Ø«Ù… <b>Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</b> Ø§Ù„ØµØ­ÙŠØ­Ø©.
            </p>
            <span id="splash-author">Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªØµÙ…ÙŠÙ…: Ø£. Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ø¨Ù„Ø§Ù†</span>
            <button id="start-game-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©!</button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ù‚ÙØ§Ù„ (Ù…Ø®ÙÙŠØ©) -->
    <div id="locks-hub-screen" class="hidden">
        <h2>Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ù‚ÙØ§Ù„</h2>
        <div id="locks-hub-grid">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø£Ù‚ÙØ§Ù„ Ù‡Ù†Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JS -->
        </div>
        <p id="hub-status-message">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
        <!-- (Ø¬Ø¯ÙŠØ¯) Ø²Ø± Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <button id="force-end-game-btn" class="post-btn why" style="width: 100%; margin-top: 15px; background-color: var(--secondary-color);">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© (ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø©)</button>
    </div>


    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© (Ù…Ø®ÙÙŠØ©) -->
    <div class="game-container hidden">
        
        <div id="background-lock">ğŸ”’</div>

        <div id="game-content" class="game-content">
            <div id="lock-icon">ğŸ”’</div>

            <p id="welcomeMessage"></p>
            
            <h2 id="problem">...</h2>

            <div id="stage1-logic">
                <p>Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¯Ø§Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ø­Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©:</p>
                <div class="logic-buttons">
                    <button id="btn-logic-wa" class="logic-btn">Ùˆ (ØªÙ‚Ø§Ø·Ø¹)</button>
                    <button id="btn-logic-aw" class="logic-btn">Ø£Ùˆ (Ø§ØªØ­Ø§Ø¯)</button>
                </div>
                <div id="stage1-hint" class="hidden"></div>
                <button id="stage1-next-btn" class="hidden">Ø§Ù„ØªØ§Ù„ÙŠ</button>
            </div>

            <div id="stage2-values" class="input-area hidden">
                <span class="variable">Ø³</span>
                <span id="op1" class="static-operator">â‰¥</span>
                <input type="text" class="value-input" id="val1" inputmode="numeric">
                <span id="logic-display">...</span> 
                <span class="variable">Ø³</span>
                <span id="op2" class="static-operator">â‰¤</span>
                <input type="text" class="value-input" id="val2" inputmode="numeric">
            </div>

            <!-- (ØªØ¹Ø¯ÙŠÙ„) ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø²Ø± Ø¥Ù„Ù‰ Ù‡Ù†Ø§ -->
            <button id="unlock-btn" class="hidden">Ø§ÙØªØ­ Ø§Ù„Ù‚ÙÙ„</button>

            <div id="post-answer-controls" class="hidden">
                <button id="btn-next" class="post-btn next">Ø§Ù„ØªØ§Ù„ÙŠ (8)</button>
                <button id="btn-why" class="post-btn why">Ø§Ø¹Ø±Ù Ù„Ù…Ø§Ø°Ø§ØŸ</button>
            </div>

            <div id="feedback"></div>
        </div> 
    </div>
    
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ù…Ø®ÙÙŠØ©) -->
    <div id="final-screen" class="hidden">
        <h2>ğŸ‰ Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ø¯ÙŠ! ğŸ‰</h2>
        <div id="final-result-display">
            <!-- ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JS -->
        </div>
        <div id="leaderboard-loader" style="display: none;">
            Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„...
        </div>
        <div id="leaderboard-container">
            <!-- ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JS -->
        </div>
        <div id="finish-game-wrapper" style="display: none;">
            <button id="finish-game-btn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©</button>
        </div>
    </div>


    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div id="modal-overlay" class="hidden">
        <div id="modal-content">
            <button id="modal-close-btn">&times;</button>
            <h3 id="modal-title">Ø´Ø±Ø­ Ø§Ù„Ø­Ù„</h3>
            <div id="modal-body">
                <!-- Ø§Ù„Ø´Ø±Ø­ Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ù‡Ù†Ø§ -->
            </div>
        </div>
    </div>


    <script>
        // --- ÙˆØ¸Ø§Ø¦Ù ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ---
        function toArabicNumerals(str) {
            const arabicNumerals = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
            if (str === null || str === undefined) return str;
            return String(str).replace(/[0-9]/g, d => arabicNumerals[parseInt(d)]);
        }

        function toWesternNumerals(str) {
            const arabicNumerals = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
            if (str === null || str === undefined) return str;
            return String(str).replace(/[Ù -Ù©]/g, d => arabicNumerals.indexOf(d));
        }

        // 1. Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (DOM)
        const gameContainer = document.querySelector('.game-container');
        const splashScreen = document.getElementById('splash-screen');
        const startGameBtn = document.getElementById('start-game-btn');
        const splashWelcomeEl = document.getElementById('splash-welcome');
        
        const locksHubScreen = document.getElementById('locks-hub-screen');
        const locksHubGrid = document.getElementById('locks-hub-grid');
        const hubStatusMessage = document.getElementById('hub-status-message');
        const forceEndGameBtn = document.getElementById('force-end-game-btn'); // (Ø¬Ø¯ÙŠØ¯)

        const gameContentEl = document.getElementById('game-content');
        const finalScreenEl = document.getElementById('final-screen');
        
        const lockIconEl = document.getElementById('lock-icon');
        const backgroundLockEl = document.getElementById('background-lock'); 
        const welcomeMessageEl = document.getElementById('welcomeMessage'); 
        const problemEl = document.getElementById('problem');
        const feedbackEl = document.getElementById('feedback');
        const unlockBtn = document.getElementById('unlock-btn');
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1
        const stage1El = document.getElementById('stage1-logic');
        const btnWa = document.getElementById('btn-logic-wa');
        const btnAw = document.getElementById('btn-logic-aw');
        const stage1HintEl = document.getElementById('stage1-hint');
        const stage1NextBtn = document.getElementById('stage1-next-btn'); 
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2
        const stage2El = document.getElementById('stage2-values');
        const val1Input = document.getElementById('val1');
        const val2Input = document.getElementById('val2');
        const op1El = document.getElementById('op1');
        const op2El = document.getElementById('op2');
        const logicDisplayEl = document.getElementById('logic-display');
        
        const postAnswerControlsEl = document.getElementById('post-answer-controls');
        const nextBtn = document.getElementById('btn-next');
        const whyBtn = document.getElementById('btn-why');
        const modalOverlay = document.getElementById('modal-overlay');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalBody = document.getElementById('modal-body');

        // 2. Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ù…Ø­Ø¯Ø« Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ - Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù€ question_list_review.md)
        const problemCategories = [
            // Ø§Ù„ÙØ¦Ø© 1: Ø£Ø³Ø§Ø³ÙŠØ©
            [
                { 
                    problem: "|Ø³| < 3", op1: "<", val1: 3, op2: ">", val2: -3, logic: "Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ØµØºØ± Ù…Ù† <) ØªØ¹Ù†ÙŠ 'ØªÙ‚Ø§Ø·Ø¹' (Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> |Ø³| < 3<br><b>1. Ø§Ù„Ù†ÙˆØ¹:</b> Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„Ø¹Ù„Ø§Ù…Ø© (< Ø£ØµØºØ± Ù…Ù†)ØŒ Ù†Ø³ØªØ®Ø¯Ù… 'Ùˆ' (ØªÙ‚Ø§Ø·Ø¹).<br><b>2. Ø§Ù„Ø­Ù„ (Ù…Ø¯Ù…Ø¬):</b><br>" +
                                 " -3 < Ø³ < 3 <br>(ÙˆÙ‡ÙŠ Ù†ÙØ³Ù‡Ø§: Ø³ > -3 <b>Ùˆ</b> Ø³ < 3)<br>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 3 Ùˆ -3"
                },
                { 
                    problem: "|Ø³| â‰¥ 5", op1: "â‰¥", val1: 5, op2: "â‰¤", val2: -5, logic: "Ø£Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ÙƒØ¨Ø± Ù…Ù† â‰¥) ØªØ¹Ù†ÙŠ 'Ø§ØªØ­Ø§Ø¯' (Ø£Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> |Ø³| â‰¥ 5<br><b>1. Ø§Ù„Ù†ÙˆØ¹:</b> Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„Ø¹Ù„Ø§Ù…Ø© (â‰¥ Ø£ÙƒØ¨Ø± Ù…Ù†)ØŒ Ù†Ø³ØªØ®Ø¯Ù… 'Ø£Ùˆ' (Ø§ØªØ­Ø§Ø¯).<br><b>2. Ø§Ù„Ø­Ù„:</b><br>" +
                                 "<div class='solution-columns'>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„ (Ø£)</h4><b>Ø³ â‰¥ 5</b></div>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø¨)</h4><b>Ø³ â‰¤ -5</b><br>(Ù†Ø¹ÙƒØ³ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© ÙˆØ§Ù„Ø±Ù‚Ù…)</div>" +
                                 "</div>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 5 Ùˆ -5"
                },
                { 
                    problem: "|Ø³| < 1", op1: "<", val1: 1, op2: ">", val2: -1, logic: "Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ØµØºØ± Ù…Ù† <) ØªØ¹Ù†ÙŠ 'ØªÙ‚Ø§Ø·Ø¹' (Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> |Ø³| < 1<br><b>1. Ø§Ù„Ù†ÙˆØ¹:</b> Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„Ø¹Ù„Ø§Ù…Ø© (< Ø£ØµØºØ± Ù…Ù†)ØŒ Ù†Ø³ØªØ®Ø¯Ù… 'Ùˆ' (ØªÙ‚Ø§Ø·Ø¹).<br><b>2. Ø§Ù„Ø­Ù„ (Ù…Ø¯Ù…Ø¬):</b><br>" +
                                 " -1 < Ø³ < 1 <br>(ÙˆÙ‡ÙŠ Ù†ÙØ³Ù‡Ø§: Ø³ > -1 <b>Ùˆ</b> Ø³ < 1)<br>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 1 Ùˆ -1"
                }
            ],
            // Ø§Ù„ÙØ¦Ø© 2: Ø¥Ø²Ø§Ø­Ø© Ø¨Ø³ÙŠØ·Ø©
            [
                { 
                    problem: "|Ø³ - 1| < 2", op1: "<", val1: 3, op2: ">", val2: -1, logic: "Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ØµØºØ± Ù…Ù† <) ØªØ¹Ù†ÙŠ 'ØªÙ‚Ø§Ø·Ø¹' (Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> |Ø³ - 1| < 2<br><b>1. Ø§Ù„Ù†ÙˆØ¹:</b> Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„Ø¹Ù„Ø§Ù…Ø© (< Ø£ØµØºØ± Ù…Ù†)ØŒ Ù†Ø³ØªØ®Ø¯Ù… 'Ùˆ' (ØªÙ‚Ø§Ø·Ø¹).<br><b>2. Ø§Ù„Ø­Ù„ (Ù…Ø¯Ù…Ø¬):</b><br>" +
                                 " -2 < Ø³ - 1 < 2 <br>(Ù†Ø¶ÙŠÙ 1 Ù„ÙƒÙ„ Ø§Ù„Ø£Ø·Ø±Ø§Ù)<br> -2 + 1 < Ø³ < 2 + 1<br>" +
                                 "<b>-1 < Ø³ < 3</b> (ÙˆÙ‡ÙŠ Ù†ÙØ³Ù‡Ø§: Ø³ > -1 <b>Ùˆ</b> Ø³ < 3)<br>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 3 Ùˆ -1"
                },
                { 
                    problem: "|Ø³ + 3| â‰¥ 4", op1: "â‰¥", val1: 1, op2: "â‰¤", val2: -7, logic: "Ø£Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ÙƒØ¨Ø± Ù…Ù† â‰¥) ØªØ¹Ù†ÙŠ 'Ø§ØªØ­Ø§Ø¯' (Ø£Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> |Ø³ + 3| â‰¥ 4<br><b>1. Ø§Ù„Ù†ÙˆØ¹:</b> Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„Ø¹Ù„Ø§Ù…Ø© (â‰¥ Ø£ÙƒØ¨Ø± Ù…Ù†)ØŒ Ù†Ø³ØªØ®Ø¯Ù… 'Ø£Ùˆ' (Ø§ØªØ­Ø§Ø¯).<br><b>2. Ø§Ù„Ø­Ù„:</b><br>" +
                                 "<div class='solution-columns'>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„ (Ø£)</h4>Ø³ + 3 â‰¥ 4<br>(Ù†Ø·Ø±Ø­ 3 Ù…Ù† Ø§Ù„Ø·Ø±ÙÙŠÙ†)<br><b>Ø³ â‰¥ 1</b></div>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø¨)</h4>Ø³ + 3 â‰¤ -4<br>(Ù†Ø¹ÙƒØ³ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© ÙˆØ§Ù„Ø±Ù‚Ù…)<br>(Ù†Ø·Ø±Ø­ 3 Ù…Ù† Ø§Ù„Ø·Ø±ÙÙŠÙ†)<br><b>Ø³ â‰¤ -7</b></div>" +
                                 "</div>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 1 Ùˆ -7"
                },
                { 
                    problem: "|Ø³ - 5| > 1", op1: ">", val1: 6, op2: "<", val2: 4, logic: "Ø£Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ÙƒØ¨Ø± Ù…Ù† >) ØªØ¹Ù†ÙŠ 'Ø§ØªØ­Ø§Ø¯' (Ø£Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> |Ø³ - 5| > 1<br><b>1. Ø§Ù„Ù†ÙˆØ¹:</b> Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„Ø¹Ù„Ø§Ù…Ø© (> Ø£ÙƒØ¨Ø± Ù…Ù†)ØŒ Ù†Ø³ØªØ®Ø¯Ù… 'Ø£Ùˆ' (Ø§ØªØ­Ø§Ø¯).<br><b>2. Ø§Ù„Ø­Ù„:</b><br>" +
                                 "<div class='solution-columns'>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„ (Ø£)</h4>Ø³ - 5 > 1<br>(Ù†Ø¶ÙŠÙ 5 Ù„Ù„Ø·Ø±ÙÙŠÙ†)<br><b>Ø³ > 6</b></div>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø¨)</h4>Ø³ - 5 < -1<br>(Ù†Ø¹ÙƒØ³ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© ÙˆØ§Ù„Ø±Ù‚Ù…)<br>(Ù†Ø¶ÙŠÙ 5 Ù„Ù„Ø·Ø±ÙÙŠÙ†)<br><b>Ø³ < 4</b></div>" +
                                 "</div>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 6 Ùˆ 4"
                }
            ],
            // Ø§Ù„ÙØ¦Ø© 3: Ù…Ø¹Ø§Ù…Ù„ Ù„Ù„Ù…ØªØºÙŠØ±
            [
                { 
                    problem: "|2Ø³| â‰¤ 6", op1: "â‰¤", val1: 3, op2: "â‰¥", val2: -3, logic: "Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ØµØºØ± Ù…Ù† â‰¤) ØªØ¹Ù†ÙŠ 'ØªÙ‚Ø§Ø·Ø¹' (Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> |2Ø³| â‰¤ 6<br><b>1. Ø§Ù„Ù†ÙˆØ¹:</b> 'Ùˆ' (ØªÙ‚Ø§Ø·Ø¹).<br><b>2. Ø§Ù„Ø­Ù„ (Ù…Ø¯Ù…Ø¬):</b><br>" +
                                 " -6 â‰¤ 2Ø³ â‰¤ 6 <br>(Ù†Ù‚Ø³Ù… ÙƒÙ„ Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø¹Ù„Ù‰ 2)<br>" +
                                 "<b>-3 â‰¤ Ø³ â‰¤ 3</b> (ÙˆÙ‡ÙŠ Ù†ÙØ³Ù‡Ø§: Ø³ â‰¥ -3 <b>Ùˆ</b> Ø³ â‰¤ 3)<br>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 3 Ùˆ -3"
                },
                { 
                    problem: "|3Ø³| > 9", op1: ">", val1: 3, op2: "<", val2: -3, logic: "Ø£Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ÙƒØ¨Ø± Ù…Ù† >) ØªØ¹Ù†ÙŠ 'Ø§ØªØ­Ø§Ø¯' (Ø£Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> |3Ø³| > 9<br><b>1. Ø§Ù„Ù†ÙˆØ¹:</b> 'Ø£Ùˆ' (Ø§ØªØ­Ø§Ø¯).<br><b>2. Ø§Ù„Ø­Ù„:</b><br>" +
                                 "<div class='solution-columns'>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„ (Ø£)</h4>3Ø³ > 9<br>(Ù†Ù‚Ø³Ù… Ø¹Ù„Ù‰ 3)<br><b>Ø³ > 3</b></div>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø¨)</h4>3Ø³ < -9<br>(Ù†Ø¹ÙƒØ³ ÙˆÙ†Ù‚Ø³Ù… Ø¹Ù„Ù‰ 3)<br><b>Ø³ < -3</b></div>" +
                                 "</div>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 3 Ùˆ -3"
                },
                { 
                    problem: "|5Ø³| â‰¤ 20", op1: "â‰¤", val1: 4, op2: "â‰¥", val2: -4, logic: "Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ØµØºØ± Ù…Ù† â‰¤) ØªØ¹Ù†ÙŠ 'ØªÙ‚Ø§Ø·Ø¹' (Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> |5Ø³| â‰¤ 20<br><b>1. Ø§Ù„Ù†ÙˆØ¹:</b> 'Ùˆ' (ØªÙ‚Ø§Ø·Ø¹).<br><b>2. Ø§Ù„Ø­Ù„ (Ù…Ø¯Ù…Ø¬):</b><br>" +
                                 " -20 â‰¤ 5Ø³ â‰¤ 20 <br>(Ù†Ù‚Ø³Ù… ÙƒÙ„ Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø¹Ù„Ù‰ 5)<br>" +
                                 "<b>-4 â‰¤ Ø³ â‰¤ 4</b> (ÙˆÙ‡ÙŠ Ù†ÙØ³Ù‡Ø§: Ø³ â‰¥ -4 <b>Ùˆ</b> Ø³ â‰¤ 4)<br>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 4 Ùˆ -4"
                }
            ],
            // Ø§Ù„ÙØ¦Ø© 4: ØªØªØ·Ù„Ø¨ Ø§Ù„Ø¹Ø²Ù„
            [
                { 
                    problem: "|Ø³| + 2 < 7", op1: "<", val1: 5, op2: ">", val2: -5, logic: "Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ØµØºØ± Ù…Ù† <) ØªØ¹Ù†ÙŠ 'ØªÙ‚Ø§Ø·Ø¹' (Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> |Ø³| + 2 < 7<br><b>1. Ø§Ù„Ø¹Ø²Ù„:</b> Ø£ÙˆÙ„Ø§Ù‹ØŒ Ù†Ø·Ø±Ø­ 2 Ù…Ù† Ø§Ù„Ø·Ø±ÙÙŠÙ†.<br> |Ø³| < 7 - 2  =>  <b>|Ø³| < 5</b><br>" +
                                 "<b>2. Ø§Ù„Ù†ÙˆØ¹:</b> 'Ùˆ' (ØªÙ‚Ø§Ø·Ø¹).<br><b>3. Ø§Ù„Ø­Ù„ (Ù…Ø¯Ù…Ø¬):</b><br>" +
                                 "<b>-5 < Ø³ < 5</b> (ÙˆÙ‡ÙŠ Ù†ÙØ³Ù‡Ø§: Ø³ > -5 <b>Ùˆ</b> Ø³ < 5)<br>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 5 Ùˆ -5"
                },
                { 
                    problem: "3|Ø³| â‰¥ 12", op1: "â‰¥", val1: 4, op2: "â‰¤", val2: -4, logic: "Ø£Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ÙƒØ¨Ø± Ù…Ù† â‰¥) ØªØ¹Ù†ÙŠ 'Ø§ØªØ­Ø§Ø¯' (Ø£Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> 3|Ø³| â‰¥ 12<br><b>1. Ø§Ù„Ø¹Ø²Ù„:</b> Ø£ÙˆÙ„Ø§Ù‹ØŒ Ù†Ù‚Ø³Ù… Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ 3.<br> |Ø³| â‰¥ 12 / 3  =>  <b>|Ø³| â‰¥ 4</b><br>" +
                                 "<b>2. Ø§Ù„Ù†ÙˆØ¹:</b> 'Ø£Ùˆ' (Ø§ØªØ­Ø§Ø¯).<br><b>3. Ø§Ù„Ø­Ù„:</b><br>" +
                                 "<div class='solution-columns'>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„ (Ø£)</h4><b>Ø³ â‰¥ 4</b></div>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø¨)</h4><b>Ø³ â‰¤ -4</b></div>" +
                                 "</div>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 4 Ùˆ -4"
                },
                { 
                    problem: "|Ø³ - 1| - 4 â‰¤ 2", op1: "â‰¤", val1: 7, op2: "â‰¥", val2: -5, logic: "Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ØµØºØ± Ù…Ù† â‰¤) ØªØ¹Ù†ÙŠ 'ØªÙ‚Ø§Ø·Ø¹' (Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> |Ø³ - 1| - 4 â‰¤ 2<br><b>1. Ø§Ù„Ø¹Ø²Ù„:</b> Ø£ÙˆÙ„Ø§Ù‹ØŒ Ù†Ø¶ÙŠÙ 4 Ù„Ù„Ø·Ø±ÙÙŠÙ†.<br> |Ø³ - 1| â‰¤ 2 + 4  =>  <b>|Ø³ - 1| â‰¤ 6</b><br>" +
                                 "<b>2. Ø§Ù„Ù†ÙˆØ¹:</b> 'Ùˆ' (ØªÙ‚Ø§Ø·Ø¹).<br><b>3. Ø§Ù„Ø­Ù„ (Ù…Ø¯Ù…Ø¬):</b><br>" +
                                 " -6 â‰¤ Ø³ - 1 â‰¤ 6 <br>(Ù†Ø¶ÙŠÙ 1 Ù„ÙƒÙ„ Ø§Ù„Ø£Ø·Ø±Ø§Ù)<br>" +
                                 "<b>-5 â‰¤ Ø³ â‰¤ 7</b> (ÙˆÙ‡ÙŠ Ù†ÙØ³Ù‡Ø§: Ø³ â‰¥ -5 <b>Ùˆ</b> Ø³ â‰¤ 7)<br>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 7 Ùˆ -5"
                }
            ],
            // Ø§Ù„ÙØ¦Ø© 5: Ù…Ø±ÙƒØ¨Ø©
            [
                { 
                    problem: "|2Ø³ - 1| < 5", op1: "<", val1: 3, op2: ">", val2: -2, logic: "Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ØµØºØ± Ù…Ù† <) ØªØ¹Ù†ÙŠ 'ØªÙ‚Ø§Ø·Ø¹' (Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> |2Ø³ - 1| < 5<br><b>1. Ø§Ù„Ù†ÙˆØ¹:</b> 'Ùˆ' (ØªÙ‚Ø§Ø·Ø¹).<br><b>2. Ø§Ù„Ø­Ù„ (Ù…Ø¯Ù…Ø¬):</b><br>" +
                                 " -5 < 2Ø³ - 1 < 5 <br>(Ù†Ø¶ÙŠÙ 1 Ù„ÙƒÙ„ Ø§Ù„Ø£Ø·Ø±Ø§Ù)<br> -4 < 2Ø³ < 6 <br>(Ù†Ù‚Ø³Ù… ÙƒÙ„ Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø¹Ù„Ù‰ 2)<br>" +
                                 "<b>-2 < Ø³ < 3</b> (ÙˆÙ‡ÙŠ Ù†ÙØ³Ù‡Ø§: Ø³ > -2 <b>Ùˆ</b> Ø³ < 3)<br>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 3 Ùˆ -2"
                },
                { 
                    problem: "5|Ø³ + 1| â‰¥ 10", op1: "â‰¥", val1: 1, op2: "â‰¤", val2: -3, logic: "Ø£Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ÙƒØ¨Ø± Ù…Ù† â‰¥) ØªØ¹Ù†ÙŠ 'Ø§ØªØ­Ø§Ø¯' (Ø£Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</b> 5|Ø³ + 1| â‰¥ 10<br><b>1. Ø§Ù„Ø¹Ø²Ù„:</b> Ù†Ù‚Ø³Ù… Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ 5.<br> |Ø³ + 1| â‰¥ 2<br>" +
                                 "<b>2. Ø§Ù„Ù†ÙˆØ¹:</b> 'Ø£Ùˆ' (Ø§ØªØ­Ø§Ø¯).<br><b>3. Ø§Ù„Ø­Ù„:</b><br>" +
                                 "<div class='solution-columns'>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„ (Ø£)</h4>Ø³ + 1 â‰¥ 2<br>(Ù†Ø·Ø±Ø­ 1)<br><b>Ø³ â‰¥ 1</b></div>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø¨)</h4>Ø³ + 1 â‰¤ -2<br>(Ù†Ø·Ø±Ø­ 1)<br><b>Ø³ â‰¤ -3</b></div>" +
                                 "</div>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 1 Ùˆ -3"
                },
                { 
                    problem: "|<span class='frac'><span class='frac-num'>Ù¡Ø³</span><span class='frac-den'>Ù¢</span></span> + Ù¡| - Ù¥ > Ù¢", 
                    op1: ">", val1: 12, op2: "<", val2: -16, logic: "Ø£Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ÙƒØ¨Ø± Ù…Ù† >) ØªØ¹Ù†ÙŠ 'Ø§ØªØ­Ø§Ø¯' (Ø£Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø© (Ù…Ø±ÙƒØ¨Ø©):</b> |(1/2)Ø³ + 1| - 5 > 2<br><b>1. Ø§Ù„Ø¹Ø²Ù„:</b> Ø£ÙˆÙ„Ø§Ù‹ØŒ Ù†Ø¶ÙŠÙ 5 Ù„Ù„Ø·Ø±ÙÙŠÙ†.<br> |(1/2)Ø³ + 1| > 7<br>" +
                                 "<b>2. Ø§Ù„Ù†ÙˆØ¹:</b> 'Ø£Ùˆ' (Ø§ØªØ­Ø§Ø¯).<br><b>3. Ø§Ù„Ø­Ù„:</b><br>" +
                                 "<div class='solution-columns'>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„ (Ø£)</h4>(1/2)Ø³ + 1 > 7<br>(1/2)Ø³ > 6<br>(Ù†Ø¶Ø±Ø¨ ÙÙŠ 2)<br><b>Ø³ > 12</b></div>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø¨)</h4>(1/2)Ø³ + 1 < -7<br>(1/2)Ø³ < -8<br>(Ù†Ø¶Ø±Ø¨ ÙÙŠ 2)<br><b>Ø³ < -16</b></div>" +
                                 "</div>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 12 Ùˆ -16"
                }
            ],
            // Ø§Ù„ÙØ¦Ø© 6: Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© (ØªØ­Ø¯ÙŠ)
            [
                { 
                    problem: "|Ù£ - <span class='frac'><span class='frac-num'>Ù¡Ø³</span><span class='frac-den'>Ù£</span></span>| - Ù¡ â‰¤ Ù¨", 
                    op1: "â‰¤", val1: 36, op2: "â‰¥", val2: -18, logic: "Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ØµØºØ± Ù…Ù† â‰¤) ØªØ¹Ù†ÙŠ 'ØªÙ‚Ø§Ø·Ø¹' (Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø© (Ø°Ù‡Ø¨ÙŠØ©):</b> |3 - (1/3)Ø³| - 1 â‰¤ 8<br><b>1. Ø§Ù„Ø¹Ø²Ù„:</b> Ø£ÙˆÙ„Ø§Ù‹ØŒ Ù†Ø¶ÙŠÙ 1 Ù„Ù„Ø·Ø±ÙÙŠÙ†.<br> |3 - (1/3)Ø³| â‰¤ 9<br>" +
                                 "<b>2. Ø§Ù„Ù†ÙˆØ¹:</b> 'Ùˆ' (ØªÙ‚Ø§Ø·Ø¹).<br><b>3. Ø§Ù„Ø­Ù„ (Ù…Ø¯Ù…Ø¬):</b><br>" +
                                 " -9 â‰¤ 3 - (1/3)Ø³ â‰¤ 9 <br>(Ù†Ø·Ø±Ø­ 3 Ù…Ù† ÙƒÙ„ Ø§Ù„Ø£Ø·Ø±Ø§Ù)<br> -12 â‰¤ -(1/3)Ø³ â‰¤ 6 <br>" +
                                 "<span class='warning-text'>(Ù†Ø¶Ø±Ø¨ ÙÙŠ -3 ÙˆÙ†Ø¹ÙƒØ³ ÙƒÙ„ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª)</span><br>" +
                                 " (-12) * (-3) â‰¥ Ø³ â‰¥ (6) * (-3) <br> 36 â‰¥ Ø³ â‰¥ -18 <br>" +
                                 "<b>-18 â‰¤ Ø³ â‰¤ 36</b> (ÙˆÙ‡ÙŠ Ù†ÙØ³Ù‡Ø§: Ø³ â‰¥ -18 <b>Ùˆ</b> Ø³ â‰¤ 36)<br>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 36 Ùˆ -18"
                },
                { 
                    // Ø³Ø¤Ø§Ù„Ùƒ Ø§Ù„Ù…Ø­Ø¯Ø«
                    problem: "|Ù¡ - <span class='frac'><span class='frac-num'>Ù¢Ø³</span><span class='frac-den'>Ù£</span></span>| - Ù¥ > Ù¢", 
                    op1: ">", val1: 12, op2: "<", val2: -9, logic: "Ø£Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ÙƒØ¨Ø± Ù…Ù† >) ØªØ¹Ù†ÙŠ 'Ø§ØªØ­Ø§Ø¯' (Ø£Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø© (Ø°Ù‡Ø¨ÙŠØ©):</b> |1 - (2/3)Ø³| - 5 > 2<br><b>1. Ø§Ù„Ø¹Ø²Ù„:</b> Ø£ÙˆÙ„Ø§Ù‹ØŒ Ù†Ø¶ÙŠÙ 5 Ù„Ù„Ø·Ø±ÙÙŠÙ†.<br> |1 - (2/3)Ø³| > 7<br>" +
                                 "<b>2. Ø§Ù„Ù†ÙˆØ¹:</b> 'Ø£Ùˆ' (Ø§ØªØ­Ø§Ø¯).<br><b>3. Ø§Ù„Ø­Ù„:</b><br>" +
                                 "<div class='solution-columns'>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„ (Ø£)</h4>1 - (2/3)Ø³ > 7<br>-(2/3)Ø³ > 6<br><span class='warning-text'>(2/3)Ø³ < -6</span><br>(Ù†Ø¶Ø±Ø¨ ÙÙŠ -1 ÙˆÙ†Ø¹ÙƒØ³)<br>(Ù†Ø¶Ø±Ø¨ ÙÙŠ 3/2)<br><b>Ø³ < -9</b></div>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø¨)</h4>1 - (2/3)Ø³ < -7<br>-(2/3)Ø³ < -8<br><span class='warning-text'>(2/3)Ø³ > 8</span><br>(Ù†Ø¶Ø±Ø¨ ÙÙŠ -1 ÙˆÙ†Ø¹ÙƒØ³)<br>(Ù†Ø¶Ø±Ø¨ ÙÙŠ 3/2)<br><b>Ø³ > 12</b></div>" +
                                 "</div>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 12 Ùˆ -9"
                },
                { 
                    problem: "|5 - 2Ø³| â‰¥ 3", op1: "â‰¤", val1: 1, op2: "â‰¥", val2: 4, logic: "Ø£Ùˆ", hint: "ØªÙ„Ù…ÙŠØ­: (Ø£ÙƒØ¨Ø± Ù…Ù† â‰¥) ØªØ¹Ù†ÙŠ 'Ø§ØªØ­Ø§Ø¯' (Ø£Ùˆ).",
                    explanation: "<b>Ø§Ù„Ù…Ø³Ø£Ù„Ø© (Ø°Ù‡Ø¨ÙŠØ©):</b> |5 - 2Ø³| â‰¥ 3<br><b>1. Ø§Ù„Ù†ÙˆØ¹:</b> 'Ø£Ùˆ' (Ø§ØªØ­Ø§Ø¯).<br><b>2. Ø§Ù„Ø­Ù„:</b><br>" +
                                 "<div class='solution-columns'>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„ (Ø£)</h4>5 - 2Ø³ â‰¥ 3<br>-2Ø³ â‰¥ 3 - 5<br>-2Ø³ â‰¥ -2<br><span class='warning-text'>Ø³ â‰¤ 1</span><br>(Ø§Ù†ØªØ¨Ù‡: Ø¹Ù†Ø¯ Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ -2ØŒ Ù†Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©!)</div>" +
                                   "<div class='solution-column'><h4>Ø§Ù„Ø­Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø¨)</h4>5 - 2Ø³ â‰¤ -3<br>-2Ø³ â‰¤ -3 - 5<br>-2Ø³ â‰¤ -8<br><span class='warning-text'>Ø³ â‰¥ 4</span><br>(Ø§Ù†ØªØ¨Ù‡: Ø¹Ù†Ø¯ Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ -2ØŒ Ù†Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©!)</div>" +
                                 "</div>" +
                                 "<b>Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù‡ÙŠ:</b> 1 Ùˆ 4"
                }
            ]
        ];
        
        let availableProblems = []; 
        let currentCategoryIndex = 0;
        let currentProblem;
        let userLogicScore = 0; 
        
        let totalGameScore = 0; 
        let gameStartTime = 0; 
        
        let categoryScores = new Array(6).fill(null); 
        let nextUnlockableCategory = 0; 
        let isRetry = false; 

        let autoAdvanceTimer = null;
        let countdownInterval = null;
        let secondsLeft = 8;

        // --- ÙˆØ¸Ø§Ø¦Ù Ø¨Ø¯Ø¡ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ---
        function startGame() {
            splashScreen.classList.add('hidden');
            
            gameStartTime = Date.now(); 
            totalGameScore = 0;
            currentCategoryIndex = 0;
            nextUnlockableCategory = 0;
            categoryScores = new Array(6).fill(null);
            
            availableProblems = problemCategories.map(category => [...category]);
            
            showLocksHub();
        }
        
        // (ØªØ¹Ø¯ÙŠÙ„) ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
        function showLocksHub() {
            gameContainer.classList.add('hidden');
            finalScreenEl.classList.add('hidden');
            locksHubScreen.classList.remove('hidden');
            
            locksHubGrid.innerHTML = '';
            
            let totalScoreSoFar = categoryScores.slice(0, 5).reduce((a, b) => a + (b || 0), 0);
            let allCategoriesDone = true;

            for (let i = 0; i < 6; i++) {
                const lockItem = document.createElement('div');
                lockItem.className = 'lock-item';
                lockItem.id = `lock-item-${i}`;
                
                const isGolden = (i === 5);
                const categoryNum = i + 1;
                
                let icon = 'ğŸ”’';
                let label = `Ø§Ù„Ù‚ÙÙ„ ${toArabicNumerals(categoryNum)}`;
                let scoreText = '- / -';
                
                if (isGolden) {
                    lockItem.classList.add('golden');
                    icon = 'ğŸ”‘';
                    label = 'Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ø°Ù‡Ø¨ÙŠ';
                }

                if (categoryScores[i] !== null) {
                    const score = categoryScores[i];
                    const maxScore = isGolden ? 4 : 2;
                    scoreText = `${toArabicNumerals(score)}/${toArabicNumerals(maxScore)}`;
                    
                    if (score === maxScore) {
                        lockItem.classList.add('completed');
                        icon = 'ğŸ”“';
                        if (isGolden) icon = 'ğŸ—ï¸';
                    } else {
                        lockItem.classList.add('failed');
                    }
                } else {
                    allCategoriesDone = false;
                }
                
                // Ù…Ù†Ø·Ù‚ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ù†Ø´Ø· Ø£Ùˆ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥Ø¹Ø§Ø¯Ø©
                // 1. Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ø°Ù‡Ø¨ÙŠ
                if (isGolden) {
                    if (nextUnlockableCategory < 5) { 
                        lockItem.classList.add('disabled');
                    } else if (totalScoreSoFar < 8 && categoryScores[i] === null) { 
                        lockItem.classList.add('disabled');
                        icon = 'â›”ï¸';
                        label = 'Ù…ØºÙ„Ù‚ (ØªØ­ØªØ§Ø¬ 8 Ù†Ù‚Ø§Ø·)';
                    } else if (categoryScores[i] === null) { 
                        lockItem.classList.add('active');
                    }
                
                // 2. Ø§Ù„Ø£Ù‚ÙØ§Ù„ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (1-5)
                } else {
                    if (i === nextUnlockableCategory) { 
                        lockItem.classList.add('active');
                    } else if (i > nextUnlockableCategory) { 
                        lockItem.classList.add('disabled');
                    }
                }


                lockItem.innerHTML = `
                    <div class="lock-icon">${icon}</div>
                    <div class="lock-label">${label}</div>
                    <div class="lock-score">${scoreText}</div>
                `;
                
                if (!lockItem.classList.contains('disabled')) {
                    lockItem.addEventListener('click', () => {
                        const retry = (categoryScores[i] !== null);
                        loadProblem(i, retry);
                    }, { once: true });
                }
                
                locksHubGrid.appendChild(lockItem);
            }
            
            // (ØªØ¹Ø¯ÙŠÙ„) Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© (ÙÙ‚Ø· Ø¥Ø°Ø§ Ø§ÙƒØªÙ…Ù„Øª ÙƒÙ„Ù‡Ø§)
            if (allCategoriesDone) {
                 hubStatusMessage.textContent = 'ğŸ‰ Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ø¯ÙŠ! ğŸ‰';
                 // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ
                 forceEndGameBtn.classList.add('hidden');
                 setTimeout(showFinalScreen, 2000); 
                 return;
            }
            
            // (ØªØ¹Ø¯ÙŠÙ„) Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ
            forceEndGameBtn.classList.remove('hidden');
            hubStatusMessage.textContent = toArabicNumerals(`Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©`);
        }


        // 3. (ØªØ¹Ø¯ÙŠÙ„) ÙˆØ¸ÙŠÙØ© ØªØ­Ù…ÙŠÙ„ Ù…Ø³Ø£Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function loadProblem(categoryIndex, retry = false) {
            locksHubScreen.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            
            clearInterval(countdownInterval);
            clearTimeout(autoAdvanceTimer);
            
            currentCategoryIndex = categoryIndex; 
            isRetry = retry; 

            if (isRetry) {
                totalGameScore -= (categoryScores[currentCategoryIndex] || 0);
            }

            const currentCategoryPool = availableProblems[currentCategoryIndex];
            if (currentCategoryPool.length === 0) {
                availableProblems[currentCategoryIndex] = [...problemCategories[currentCategoryIndex]];
            }
            
            const problemIndex = Math.floor(Math.random() * availableProblems[currentCategoryIndex].length);
            currentProblem = availableProblems[currentCategoryIndex][problemIndex];
            availableProblems[currentCategoryIndex].splice(problemIndex, 1);
            
            
            const categoryNum = currentCategoryIndex + 1;
            const isGolden = (currentCategoryIndex === 5);
            let categoryLabel = isGolden ? `ğŸ”‘ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø°Ù‡Ø¨ÙŠ!` : `Ø§Ù„ÙØ¦Ø© ${categoryNum} Ù…Ù† 6`;
            
            if (isRetry) {
                categoryLabel += " (Ø¥Ø¹Ø§Ø¯Ø©)";
            }

            if (isGolden) {
                welcomeMessageEl.textContent = toArabicNumerals(categoryLabel);
                gameContainer.classList.add('golden');
                lockIconEl.textContent = 'ğŸ”‘';
                backgroundLockEl.textContent = 'ğŸ—ï¸';
            } else {
                welcomeMessageEl.textContent = toArabicNumerals(categoryLabel);
                gameContainer.classList.remove('golden');
                lockIconEl.textContent = 'ğŸ”’';
                backgroundLockEl.textContent = 'ğŸ”’';
            }

            problemEl.innerHTML = toArabicNumerals(currentProblem.problem);
            op1El.textContent = toArabicNumerals(currentProblem.op1);
            op2El.textContent = toArabicNumerals(currentProblem.op2);
            
            feedbackEl.textContent = '';
            feedbackEl.className = '';
            val1Input.value = '';
            val2Input.value = '';
            userLogicScore = 0;
            
            stage1El.classList.remove('hidden');
            stage1HintEl.classList.add('hidden');
            stage1NextBtn.classList.add('hidden'); 
            stage2El.classList.add('hidden');
            postAnswerControlsEl.classList.add('hidden');
            
            unlockBtn.classList.add('hidden');

            btnWa.disabled = false;
            btnAw.disabled = false;
            btnWa.className = 'logic-btn';
            btnAw.className = 'logic-btn';
            
            lockIconEl.style.transform = 'rotate(5deg)'; 
            backgroundLockEl.style.transform = 'translate(-50%, -50%) scaleX(-1) rotate(-5deg)';
        }

        // 4. ÙˆØ¸ÙŠÙØ© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¯Ø§Ø© (Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1) 
        function selectLogic(choice) {
            btnWa.disabled = true;
            btnAw.disabled = true;

            const correctLogic = currentProblem.logic;
            const clickedBtn = (choice === 'Ùˆ') ? btnWa : btnAw;
            const correctBtn = (correctLogic === 'Ùˆ') ? btnWa : btnAw;

            if (choice === correctLogic) {
                userLogicScore = 1; 
                clickedBtn.classList.add('correct');
                stage1HintEl.textContent = toArabicNumerals("Ø£Ø­Ø³Ù†Øª! " + currentProblem.hint);
                stage1HintEl.className = 'correct';
            } else {
                userLogicScore = 0;
                clickedBtn.classList.add('incorrect');
                correctBtn.classList.add('flash-correct'); 
                stage1HintEl.textContent = toArabicNumerals("Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©. " + currentProblem.hint);
                stage1HintEl.className = 'incorrect';
            }
            stage1HintEl.classList.remove('hidden');
            stage1NextBtn.classList.remove('hidden'); 
        }

        // 5. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© 2 
        function transitionToStage2() {
            stage1El.classList.add('hidden');
            stage2El.classList.remove('hidden');
            unlockBtn.classList.remove('hidden'); 
            logicDisplayEl.textContent = toArabicNumerals(currentProblem.logic);
            feedbackEl.textContent = 'Ø§Ù„Ø¢Ù†ØŒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµØ­ÙŠØ­Ø©.';
            feedbackEl.className = '';
        }

        // 6. ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2)
        function checkAnswer() {
            const userVal1 = parseFloat(toWesternNumerals(val1Input.value));
            const userVal2 = parseFloat(toWesternNumerals(val2Input.value));

            if (isNaN(userVal1) || isNaN(userVal2)) {
                feedbackEl.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù…ÙŠÙ†';
                feedbackEl.className = 'incorrect';
                return;
            }
            let valuesCorrect = false;
            const correctValues = [currentProblem.val1, currentProblem.val2].sort((a,b) => a - b);
            const userValues = [userVal1, userVal2].sort((a,b) => a - b);
            
            if (userValues[0] === correctValues[0] && userValues[1] === correctValues[1]) {
                valuesCorrect = true;
            }
            
            const isGolden = (currentCategoryIndex === 5);
            const pointsPerPart = isGolden ? 2 : 1; 
            
            let logicPoints = userLogicScore * pointsPerPart;
            let valuePoints = (valuesCorrect ? 1 : 0) * pointsPerPart;
            let totalPointsForThisQ = logicPoints + valuePoints;
            
            totalGameScore += totalPointsForThisQ; 
            categoryScores[currentCategoryIndex] = totalPointsForThisQ; 
            
            if (!isRetry && currentCategoryIndex === nextUnlockableCategory) {
                nextUnlockableCategory++;
            }

            let feedbackMessage = "";
            let totalParts = isGolden ? 4 : 2; 

            if (totalPointsForThisQ === totalParts) { 
                feedbackMessage = `Ù…Ù…ØªØ§Ø²! (${toArabicNumerals(totalPointsForThisQ)}/${toArabicNumerals(totalParts)}) Ø§Ù„Ù‚ÙÙ„ ÙÙØªØ­!`;
                feedbackEl.className = 'correct';
                lockIconEl.textContent = (isGolden) ? 'ğŸ—ï¸' : 'ğŸ”“';
                backgroundLockEl.textContent = (isGolden) ? 'ğŸ—ï¸' : 'ğŸ”“';
                lockIconEl.style.transform = 'rotate(15deg)'; 
            } else if (totalPointsForThisQ > 0) { 
                feedbackMessage = (userLogicScore === 1 && !valuesCorrect) ? 
                    `Ø§Ù„Ø£Ø¯Ø§Ø© ÙƒØ§Ù†Øª ØµØ­ÙŠØ­Ø©ØŒ Ù„ÙƒÙ† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø®Ø§Ø·Ø¦Ø©. (${toArabicNumerals(totalPointsForThisQ)}/${toArabicNumerals(totalParts)})` : 
                    `Ø§Ù„Ø£Ø¯Ø§Ø© ÙƒØ§Ù†Øª Ø®Ø§Ø·Ø¦Ø©ØŒ Ù„ÙƒÙ† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø©. (${toArabicNumerals(totalPointsForThisQ)}/${toArabicNumerals(totalParts)})`;
                feedbackEl.className = 'partial';
                lockIconEl.style.transform = 'scale(1.1) rotate(-5deg)';
                setTimeout(() => { lockIconEl.style.transform = 'scale(1) rotate(5deg)'; }, 200); 
            } else { 
                feedbackMessage = `Ù„Ù„Ø£Ø³ÙØŒ Ø§Ù„Ø£Ø¯Ø§Ø© ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… Ø®Ø§Ø·Ø¦Ø©. (${toArabicNumerals(totalPointsForThisQ)}/${toArabicNumerals(totalParts)})`;
                feedbackEl.className = 'incorrect';
                lockIconEl.style.transform = 'scale(1.1) rotate(-5deg)';
                setTimeout(() => { lockIconEl.style.transform = 'scale(1) rotate(5deg)'; }, 200); 
            }
            feedbackEl.textContent = toArabicNumerals(feedbackMessage);

            unlockBtn.classList.add('hidden');
            postAnswerControlsEl.classList.remove('hidden');
            
            nextBtn.textContent = toArabicNumerals(`Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ø±ÙŠØ·Ø© (8)`);
            
            startNextQuestionTimer();
        }
        
        function returnToLocksHub() {
            clearInterval(countdownInterval);
            clearTimeout(autoAdvanceTimer);
            showLocksHub(); 
        }

        // 7. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø¤Ù‚Øª ÙˆØ§Ù„Ø´Ø±Ø­
        function startNextQuestionTimer() {
            clearInterval(countdownInterval);
            clearTimeout(autoAdvanceTimer);

            secondsLeft = 8;
            nextBtn.textContent = toArabicNumerals(`Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ø±ÙŠØ·Ø© (${secondsLeft})`);
            
            autoAdvanceTimer = setTimeout(returnToLocksHub, 8000); 

            countdownInterval = setInterval(() => { 
                secondsLeft--;
                nextBtn.textContent = toArabicNumerals(`Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ø±ÙŠØ·Ø© (${secondsLeft})`);

                if (secondsLeft <= 0) {
                    clearInterval(countdownInterval);
                }
            }, 1000);
        }

        function showExplanation() {
            clearInterval(countdownInterval);
            clearTimeout(autoAdvanceTimer);
            nextBtn.textContent = "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ø±ÙŠØ·Ø©";

            modalBody.innerHTML = toArabicNumerals(currentProblem.explanation);
            modalOverlay.classList.remove('hidden');
        }

        function hideModal() {
            modalOverlay.classList.add('hidden');
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
        function showFinalScreen() {
            locksHubScreen.classList.add('hidden');
            gameContainer.classList.add('hidden'); 
            finalScreenEl.classList.remove('hidden'); 
            gameContainer.classList.remove('golden'); 

            const totalTimeInSeconds = Math.round((Date.now() - gameStartTime) / 1000);
            
            if (window.saveAndFinishGame) {
                window.saveAndFinishGame(totalGameScore, totalTimeInSeconds);
            } else {
                console.error("Save function not found!");
                const resultDisplay = document.getElementById('final-result-display');
                if (resultDisplay) {
                    resultDisplay.innerHTML = `<p style="color: red;">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ù†ØµØ©.</p><p>Ø§Ù„Ù†Ù‚Ø§Ø·: <span>${toArabicNumerals(totalGameScore)} / ${toArabicNumerals(14)}</span></p>`;
                }
            }
        }


        // 8. Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        startGameBtn.addEventListener('click', startGame); 

        btnWa.addEventListener('click', () => selectLogic('Ùˆ'));
        btnAw.addEventListener('click', () => selectLogic('Ø£Ùˆ'));
        stage1NextBtn.addEventListener('click', transitionToStage2); 
        unlockBtn.addEventListener('click', checkAnswer);
        
        nextBtn.addEventListener('click', returnToLocksHub); 
        whyBtn.addEventListener('click', showExplanation);
        modalCloseBtn.addEventListener('click', hideModal);
        modalOverlay.addEventListener('click', function(e) {
            if (e.target === modalOverlay) {
                hideModal();
            }
        });
        
        // (Ø¬Ø¯ÙŠØ¯) Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ
        forceEndGameBtn.addEventListener('click', showFinalScreen);


    </script>

    <!-- 
    ======================================================
    Ù…Ø­Ø±Ùƒ Ø§Ù„Ø±Ø¨Ø· ÙˆØ³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„
    ======================================================
    -->
    <script>
    // --- START OF CONNECTION & LEADERBOARD ENGINE ---
    (function() {
        // --- CONFIGURATION ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
        const GAME_ID = 'g4_5_1';                       
        const GAME_MAX_POINTS = 14;                     
        const PLATFORM_MAX_GRADE = 5;                   
        const METRIC_TYPE = 'time';                     
        const METRIC_LABEL = 'Ø§Ù„ÙˆÙ‚Øª (Ø«ÙˆØ§Ù†ÙŠ)';           

        // --- Read URL Parameters ---
        const urlParams = new URLSearchParams(window.location.search);
        const studentId = urlParams.get('studentId');
        const classId = urlParams.get('classId');
        const studentName = urlParams.get('studentName');

        let currentUser = (studentId && studentName) ? { id: studentId, name: studentName } : null;

        // --- CORE FUNCTIONS ---

        // 1. Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        window.saveAndFinishGame = function(points, metricValue) {
            const finalPoints = parseFloat(points) || 0;
            const finalMetric = parseFloat(metricValue) || 0;
            const maxPoints = parseFloat(GAME_MAX_POINTS) || 1;
            const finalGrade = (finalPoints / maxPoints) * PLATFORM_MAX_GRADE;

            const resultDisplay = document.getElementById('final-result-display');
            if (resultDisplay) {
                resultDisplay.innerHTML = `
                    <p style="color: #333;">Ø§Ù„Ù†Ù‚Ø§Ø·: <span style="font-weight: bold; font-size: 1.3rem; color: #000;">${toArabicNumerals(finalPoints)} / ${toArabicNumerals(maxPoints)}</span></p>
                    <p style="color: var(--primary-dark);">Ø§Ù„Ø¯Ø±Ø¬Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©: <span style="font-weight: bold; font-size: 1.5rem;">${toArabicNumerals(finalGrade.toFixed(1))} / ${toArabicNumerals(PLATFORM_MAX_GRADE)}</span></p>
                `;
            }

            if (studentId && classId) {
                const params = new URLSearchParams({
                    action: 'saveGrade',
                    studentId: studentId,
                    classId: classId,
                    itemId: GAME_ID,
                    grade: finalGrade.toFixed(2),
                    metricValue: Math.round(finalMetric).toString()
                });
                fetch(`${SCRIPT_URL}?${params.toString()}`)
                    .then(res => res.json())
                    .then(result => console.log('Save result:', result.status))
                    .catch(err => console.error("Save Error:", err))
                    .finally(fetchAndShowLeaderboard);
            } else {
                console.log(`Visitor finished. Score: ${finalPoints}, Metric: ${finalMetric}`);
                fetchAndShowLeaderboard();
            }
        }

        // 2. Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„
        function fetchAndShowLeaderboard() {
            const loader = document.getElementById('leaderboard-loader');
            const container = document.getElementById('leaderboard-container');
            if (!loader || !container) return;
            
            if (!classId) {
                console.log("No classId found, skipping leaderboard for visitor.");
                container.innerHTML = `<p style="text-align: center; color: #555; margin-top: 15px;">Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ Ù…ØªØ§Ø­ Ù„Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† ÙÙ‚Ø·.</p>`;
                showFinishButton();
                return;
            }

            loader.style.display = 'block';
            container.innerHTML = '';

            const params = new URLSearchParams({
                action: 'getLeaderboard',
                gameId: GAME_ID,
                metricType: METRIC_TYPE,
                classId: classId
            });

            fetch(`${SCRIPT_URL}?${params.toString()}`)
                .then(res => res.json())
                .then(response => {
                    if (response.status === 'success' && response.data) {
                        displayLeaderboard(response.data);
                    } else {
                        throw new Error(response.message || 'Failed to load leaderboard data.');
                    }
                })
                .catch(err => {
                    console.error("Leaderboard Error:", err);
                    container.innerHTML = `<p style="text-align: center; color: red;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„.</p>`;
                })
                .finally(() => {
                    loader.style.display = 'none';
                    showFinishButton();
                });
        }
        
        // 3. Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„
        function displayLeaderboard(data) {
            const container = document.getElementById('leaderboard-container');
            if (!data || data.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: #555; margin-top: 15px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„!</p>`;
                return;
            }

            let tableHTML = `
                <div style="margin-top: 25px; border-top: 1px solid #eee; padding-top: 15px;">
                    <h3 style="text-align: center;">ğŸ† Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ ğŸ†</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                                <th style="text-align: right;">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                                <th>${METRIC_LABEL}</th>
                            </tr>
                        </thead>
                        <tbody>`;

            data.forEach((player, index) => {
                const rank = index + 1;
                let rankDisplay = toArabicNumerals(rank);
                if (rank === 1) rankDisplay = 'ğŸ¥‡';
                if (rank === 2) rankDisplay = 'ğŸ¥ˆ';
                if (rank === 3) rankDisplay = 'ğŸ¥‰';

                const isCurrentUser = (currentUser && player.name === currentUser.name);
                const rowClass = isCurrentUser ? 'class="current-user"' : (index % 2 === 0 ? 'style="background-color: #f9f9f9;"' : '');

                tableHTML += `
                    <tr ${rowClass}>
                        <td style="text-align: center; font-size: 1.2rem;">${rankDisplay}</td>
                        <td style="text-align: right;">${player.name}</td>
                        <td style="text-align: center;">${toArabicNumerals(player.grade.toFixed(1))}</td>
                        <td style="text-align: center;">${toArabicNumerals(player.metricValue)}</td>
                    </tr>`;
            });

            tableHTML += `</tbody></table></div>`;
            container.innerHTML = tableHTML;
        }

        // 4. Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡
        function showFinishButton() {
            const finishWrapper = document.getElementById('finish-game-wrapper');
            if (finishWrapper) {
                finishWrapper.style.display = 'block';
            }
        }

        // 5. ØªØ®ØµÙŠØµ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
        document.addEventListener('DOMContentLoaded', () => {
            const welcomeMessage = document.getElementById('splash-welcome');
            if (studentName && welcomeMessage) {
                welcomeMessage.innerHTML = `
                    Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ <span style="font-weight: bold; color: var(--primary-dark);">${studentName}</span>! 
                    <br>
                    Ø§Ù†Ø·Ù„Ù‚ ÙÙŠ Ø±Ø­Ù„Ø© Ù„ÙØªØ­ Ø§Ù„Ø£Ù‚ÙØ§Ù„ Ø§Ù„Ø³ØªØ©ØŒ Ø¨Ø¯Ø¡Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ù‚ÙØ§Ù„ Ø§Ù„Ø¨Ø³ÙŠØ·Ø© ÙˆÙˆØµÙˆÙ„Ø§Ù‹ Ø¥Ù„Ù‰ Ø§Ù„Ù‚ÙÙ„ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„Ù…Ù†ÙŠØ¹.
                    ÙƒÙ„ Ù‚ÙÙ„ ÙŠØªØ·Ù„Ø¨ Ù…Ù†Ùƒ Ø®Ø·ÙˆØªÙŠÙ†: <b>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¯Ø§Ø©</b> Ø§Ù„ØµØ­ÙŠØ­Ø© (Ùˆ/Ø£Ùˆ) Ø«Ù… <b>Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</b> Ø§Ù„ØµØ­ÙŠØ­Ø©.
                `;
            }

            const finishBtn = document.getElementById('finish-game-btn');
            if (finishBtn) {
                finishBtn.addEventListener('click', () => {
                    window.parent.postMessage({ event: 'gameFinished', gameId: GAME_ID }, '*');
                });
            }
        });
    })();
    // --- END OF CONNECTION & LEADERBOARD ENGINE ---
    </script>
</body>
</html>
