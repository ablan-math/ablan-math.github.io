<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة الرياضيات | أ. عبدالعزيز خالد العبلان</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* أنماط عامة وتنسيقات مخصصة */
        body { 
            font-family: 'Cairo', sans-serif; 
            display: grid;
            grid-template-rows: auto 1fr auto;
            min-height: 100vh; 
        }
        main { /* تم إزالة flex-grow: 1; */ }
        .hidden { display: none; }
        .view-section { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .step-box { 
            border-right: 4px solid #1d4ed8; 
            transition: all 0.3s ease-in-out;
            opacity: 1;
            transform: translateY(0);
        }
        .step-box.hidden {
            opacity: 0;
            transform: translateY(10px);
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            margin-bottom: 0;
            overflow: hidden;
            border-width: 0;
        }        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-change { color: #ef4444; font-weight: bold; }
        .math-eq {
            color: #4338ca;
            font-weight: bold;
            font-family: 'Cairo', 'SFMono-Regular', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
            background-color: #f5f3ff;
            padding: 2px 6px;
            border-radius: 6px;
            vertical-align: -2px;
            font-size: 1.05em;
            white-space: nowrap;
        }
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; line-height: 1.2em; }
        .fraction > span { display: block; padding: 0 0.2em; }
        .fraction > .frac-bar { border-top: 2px solid currentColor; }
        .quiz-graph-container { display: flex; justify-content: center; margin: 1rem 0; }
        .explanation-step { 
            padding: 0.75rem;
            margin-bottom: 1rem;  
            border-right: 4px solid #1d4ed8; 
            transition: opacity 0.5s ease-in-out;
            background-color: #f4f4f5;
            border-radius: 8px;
        }
        .explanation-step:last-child { margin-bottom: 0; }
        .step-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        .btn-disabled {
            background-color: #9ca3af !important;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .nav-btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        .solution-set {
            background-color: #eef2ff;
            color: #4338ca;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
            text-align: center;
        }
        .number-line-container {
            padding: 2rem 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        /* أنماط للعناصر التفاعلية التي قد تُستخدم في الدروس */
        .highlight-s { color: #2563eb; font-weight: bold; }
        .highlight-y { color: #dc2626; font-weight: bold; }
        .highlight-x { color: #16a34a; font-weight: bold; }
        .highlight-y-text { color: #dc2626; font-weight: bold; }
        .highlight-x-text { color: #16a34a; font-weight: bold; }
        .highlight-m-text { color: #ca8a04; font-weight: bold; }
        .highlight-r-text { color: #9333ea; font-weight: bold; }
        .animated-element { transition: opacity 0.3s ease-in-out, stroke 0.3s ease-in-out; }
        .substitution-value {
            color: #c026d3; /* fuchsia-600 */
            font-weight: bold;
            padding: 1px 4px;
            border-radius: 4px;
            background-color: #fce7f3; /* pink-100 */
        }
        .interactive-step {
            animation: fadeIn 0.5s ease-in-out;
        }
        .step-interactive {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            transform: translateY(10px);
        }
        .step-interactive.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
                .control-btn:disabled {
            background-color: #d1d5db;
            cursor: not-allowed;
            opacity: 0.6;
        }
    </style>
</head>
<body class="bg-gray-100">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 id="header-title" class="text-2xl font-bold text-blue-800">رياضيات الصف الثالث المتوسط</h1>
            <div id="user-info-header" class="hidden items-center gap-4">
                <span id="user-welcome-message" class="font-semibold"></span>
                <button id="dashboard-btn" class="bg-blue-100 text-blue-800 py-1 px-3 rounded-lg hover:bg-blue-200">لوحة التحكم</button>
                <button id="logout-btn" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">خروج</button>
            </div>
            <p class="text-lg text-gray-600" id="teacher-name">المعلم: عبدالعزيز خالد العبلان</p>
        </div>
    </header>

    <main class="container mx-auto px-6 py-8">
        <!-- واجهة تسجيل الدخول -->
        <div id="login-view" class="view-section max-w-md mx-auto">
            <div class="bg-white p-8 rounded-xl shadow-lg text-center">
                <h2 class="text-3xl font-bold mb-2">أهلاً بك</h2>
                <p class="text-gray-600 mb-6">أدخل رقم هويتك للدخول كطالب مسجل</p>
                <form id="login-form">
                    <div class="mb-4"><input type="text" id="login-id" placeholder="رقم الهوية / الإقامة" class="w-full text-center text-lg px-3 py-3 border rounded-lg" required></div>
                    <button type="submit" id="login-submit-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 text-lg flex justify-center items-center"><span id="login-submit-text">دخول</span><div id="login-loader" class="loader hidden"></div></button>
                </form>
                <div id="login-error" class="hidden mt-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg"></div>
                <div class="mt-8"><p class="text-gray-600 mb-2">أو</p><button id="visitor-btn" class="font-bold text-gray-700 hover:underline">المتابعة كزائر</button></div>
            </div>
        </div>

        <!-- واجهة المحتوى الرئيسية (الفهرس) -->
        <div id="main-content-view" class="hidden view-section">
            <div id="dashboard-section" class="hidden bg-blue-50 p-6 rounded-lg shadow-lg mb-12 border-l-4 border-blue-500">
                <h3 class="text-2xl font-bold text-center mb-6">لوحة التحكم</h3>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="text-xl font-bold text-blue-700 mb-3">معلوماتك المسجلة</h4>
                        <div class="bg-white p-4 rounded-lg border space-y-2"><p><strong>الاسم:</strong> <span id="display-name"></span></p><p><strong>رقم الهوية:</strong> <span id="display-id"></span></p><p><strong>الصف:</strong> <span id="display-class"></span></p><p><strong>رقم الجوال:</strong> <span id="display-phone"></span></p></div>
                    </div>
                    <div>
                        <h4 class="text-xl font-bold text-blue-700 mb-3">ملخص الدرجات</h4>
                        <div class="bg-white p-4 rounded-lg border space-y-2"><p><strong>درجة تحديد المستوى:</strong> <span id="total-level_test" class="font-bold">0</span></p><p><strong>مجموع الفصل الأول:</strong> <span id="total-c1" class="font-bold">0</span></p><p><strong>مجموع الفصل الثاني:</strong> <span id="total-c2" class="font-bold">0</span></p><p><strong>مجموع الفصل الثالث:</strong> <span id="total-c3" class="font-bold">0</span></p><p><strong>مجموع الفصل الرابع:</strong> <span id="total-c4" class="font-bold">0</span></p></div>
                    </div>
                </div>
            </div>
            <div class="text-center mb-10"><button id="level-test-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition duration-300 text-center">ابدأ اختبار تحديد المستوى</button></div>
            <div class="bg-white p-6 rounded-lg shadow-lg"><h3 class="text-2xl font-bold text-center mb-6">فهرس الفصول الدراسية</h3><div id="accordion-container" class="space-y-4"></div></div>
        </div>
        
        <!-- واجهة عرض الدرس (سيتم ملؤها بالمحتوى) -->
        <div id="lesson-view" class="hidden view-section"></div>
    </main>

    <footer class="bg-gray-200 py-4">
        <div class="container mx-auto px-6 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
            <p class="text-gray-600 text-sm">© 2024 جميع الحقوق محفوظة | تصميم وتطوير: أ. عبدالعزيز خالد العبلان</p>
            <div class="flex items-center space-x-4" dir="ltr">
                <a id="share-twitter" href="#" target="_blank" aria-label="Share on Twitter" class="text-gray-600 hover:text-blue-500 transition-colors">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg>
                </a>
                <a id="share-whatsapp" href="#" target="_blank" aria-label="Share on WhatsApp" class="text-gray-600 hover:text-green-500 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.04C6.5 2.04 2 6.53 2 12.06c0 1.66.41 3.23 1.21 4.6l-1.17 4.25 4.35-1.15c1.33.73 2.83 1.12 4.39 1.12 5.5 0 9.96-4.49 9.96-10.02S17.5 2.04 12 2.04zM16.56 14.26c-.16-.08-1.02-.5-1.18-.56-.16-.06-.28-.08-.41.08-.13.16-.44.56-.55.68-.1.12-.21.14-.38.06-.17-.08-1.02-.38-1.94-1.2-.72-.64-1.2-1.43-1.36-1.67-.16-.24-.02-.37.07-.49.08-.1.18-.26.27-.39.09-.12.12-.21.18-.35.06-.14.03-.26 0-.34-.03-.08-.41-1-.56-1.37-.16-.37-.32-.32-.44-.32h-.18c-.14 0-.36.06-.55.24-.18.18-.7.68-.7 1.65 0 .97.72 1.92.82 2.06.1.14 1.41 2.18 3.43 3.07.49.21.88.34 1.18.43.52.15 1 .13 1.35-.05.4-.18 1.18-.96 1.35-1.29.16-.32.16-.6.11-.68-.05-.08-.17-.13-.35-.21z"/></svg>
                </a>
                <span class="text-gray-600 text-sm">:شاركنا</span>
            </div>
        </div>
    </footer>

    <!-- نافذة منبثقة لشرح الإجابة -->
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">💡 شرح الإجابة</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700"></div>
        </div>
    </div>

    <script>
    // =================================================================
    // == 1. الإعدادات والبيانات الأساسية
    // =================================================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    let currentStudent = null;
    let activeQuizQuestions = [];
    const MAX_ATTEMPTS = 3;

    // --- قاعدة بيانات المنهج (قوالب دروس فارغة) ---
    const curriculum = {
        // === الفصل الأول: المعادلات الخطية ===
        'c1_l1': { title: 'الدرس ١-١: المعادلات', content:  `
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: مفردات وأساسيات الدرس</h2>
                    <div class="space-y-4">
                        <div class="p-4 bg-blue-50 rounded-lg"><p>في هذا الدرس، سنبني على ما تعلمناه سابقاً عن العبارات الجبرية، وسنتعلم كيف نحل أنواعًا مختلفة من المعادلات.</p></div>
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h3 class="font-bold text-lg mb-2">المفردات الأساسية:</h3>
                            <ul class="list-inside space-y-3">
                                <li><span class="vocab-term">الجملة المفتوحة:</span> هي جملة رياضية تحتوي على متغير، مثل: <span class="math-eq">س + ٣ = ٧</span> أو <span class="math-eq">ص + ٣</span>.</li>
                                <li><span class="vocab-term">المعادلة:</span> هي نوع خاص من الجمل المفتوحة، حيث يجب أن تحتوي على إشارة المساواة (<span class="math-eq">=</span>).</li>
                                <li><span class="vocab-term">مجموعة التعويض:</span> هي مجموعة من الأعداد التي نعوض بها عن قيمة المتغير.</li>
                                <li><span class="vocab-term">مجموعة الحل:</span> هي مجموعة العناصر من مجموعة التعويض التي تجعل المعادلة صحيحة.</li>
                                <li><span class="vocab-term">المتطابقة:</span> هي معادلة تكون صحيحة لـ <strong>جميع</strong> قيم المتغير التي نعوض بها. مثال: <span class="math-eq">٢(س + ٣) = ٢س + ٦</span>. مهما كانت قيمة س، سيبقى طرفا المعادلة متساويين.</li>
                            </ul>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg mt-4">
                            <h4 class="font-bold text-lg mb-2 text-red-800">متى لا يكون للمعادلة حل؟ (المعادلة المستحيلة)</h4>
                            <p>لا يكون للمعادلة حل عندما تؤدي تبسيطاتها إلى عبارة خاطئة دائماً، بغض النظر عن قيمة المتغير. مثال: <span class="math-eq">س + ٥ = س + ١</span>. إذا طرحنا 'س' من الطرفين، نحصل على <span class="math-eq">٥ = ١</span>، وهي عبارة خاطئة. لذا، لا يوجد أي قيمة للمتغير 'س' يمكن أن تجعل هذه المعادلة صحيحة، وتكون مجموعة الحل هي المجموعة الخالية { }.</p>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: حل معادلة بمتغير واحد</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <p class="text-lg font-semibold mb-4">مثال سهل: حل المعادلة <span class="math-eq">ك + ٥ = ٧</span>، إذا كانت مجموعة التعويض هي <span class="math-eq">{١، ٢، ٣، ٤}</span>.</p>
                        <div id="interactive-example-1">
                            <div class="space-y-4">
                                <!-- Steps will be dynamically inserted here -->
                            </div>
                            <!-- Navigation -->
                            <div class="flex justify-between items-center mt-4">
                                <button id="prev-btn-1" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition nav-btn">السابق</button>
                                <span id="step-counter-1" class="text-sm font-bold text-gray-600"></span>
                                <button id="next-btn-1" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition nav-btn">التالي</button>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثالثاً: حل معادلة بمتغيرين</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <p class="text-lg font-semibold mb-4">مثال: أوجد مجموعة حل المعادلة <span class="math-eq">ص = ٨ - ٢س</span>، إذا كان <span class="math-eq">س ∈ {١، ٢، ٣}</span>.</p>
                         <div id="interactive-example-2">
                            <div class="space-y-4">
                                <!-- Steps will be dynamically inserted here -->
                            </div>
                            <!-- Navigation -->
                            <div class="flex justify-between items-center mt-4">
                                <button id="prev-btn-2" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition nav-btn">السابق</button>
                                <span id="step-counter-2" class="text-sm font-bold text-gray-600"></span>
                                <button id="next-btn-2" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition nav-btn">التالي</button>
                            </div>
                        </div>
                    </div>
                </section>
            `, 
            generateQuiz: () => { 
                const questionBank = [
                    // Question 1
                    { type: 'mcq', level: '⭐', topic: 'vocabulary', text: 'أي من التالي هو مثال على جملة مفتوحة وليست معادلة؟', options: [ { display: '<span class="math-eq">٥س - ٢</span>', value: '٥س - ٢' }, { display: '<span class="math-eq">٩ + ٧ = ١٦</span>', value: '٩ + ٧ = ١٦' }, { display: '<span class="math-eq">١٢ > ٤</span>', value: '١٢ > ٤' }, { display: '<span class="math-eq">س = ٥</span>', value: 'س = ٥' } ], correct: '٥س - ٢', explanation: `<p>الجملة المفتوحة تحتوي متغيراً، ولكنها لا تحتوي بالضرورة على علامة مساواة لتكون معادلة.</p><p class='mt-2 p-2 bg-gray-100 rounded-md'><span class='math-eq'>٥س - ٢</span> هي جملة مفتوحة لأنها تعتمد على قيمة س.</p>` },
                    // Question 2
                    { type: 'mcq', level: '⭐⭐', topic: 'vocabulary', text: 'إذا كانت المعادلة هي <span class="math-eq">س + ٤ = ٩</span> و<span class="vocab-term">مجموعة التعويض</span> هي <span class="math-eq">{٣, ٤, ٥, ٦}</span>، فما هي <span class="vocab-term">مجموعة الحل</span>؟', options: [ { display: '<span class="math-eq">{٣}</span>', value: '{٣}' }, { display: '<span class="math-eq">{٥}</span>', value: '{٥}' }, { display: '<span class="math-eq">{٣, ٤, ٥}</span>', value: '{٣, ٤, ٥}' }, { display: '<span class="math-eq">{٤}</span>', value: '{٤}' } ], correct: '{٥}', explanation: `<p>نعوض بكل عنصر في المعادلة:</p><ul class='list-disc pr-5 mt-2'><li>عند <span class="math-eq">س=٣</span>: <span class="math-eq">٣+٤ = ٧</span> (خطأ)</li><li>عند <span class="math-eq">س=٤</span>: <span class="math-eq">٤+٤ = ٨</span> (خطأ)</li><li class='text-green-600 font-bold'>عند <span class="math-eq">س=٥</span>: <span class="math-eq">٥+٤ = ٩</span> (صحيح)</li><li>عند <span class="math-eq">س=٦</span>: <span class="math-eq">٦+٤ = ١٠</span> (خطأ)</li></ul><p class='mt-2 p-2 bg-green-100 rounded-md'>إذن، مجموعة الحل هي <span class="math-eq">{٥}</span>.</p>` },
                    // Question 3
                    { type: 'mcq', level: '⭐', topic: 'oneVariable', text: 'حل المعادلة: <span class="math-eq">س - ٤ = ٦</span>.', options: [ { display: '<span class="math-eq">٢</span>', value: '٢' }, { display: '<span class="math-eq">١٠</span>', value: '١٠' }, { display: '<span class="math-eq">٢٤</span>', value: '٢٤' }, { display: '<span class="math-eq">-٢</span>', value: '-٢' } ], correct: '١٠', explanation: `<p class='mb-2'>الهدف هو عزل المتغير <span class="math-eq">س</span> في طرف لوحده.</p><div class='text-right space-y-2'><p>أولاً: المعادلة الأصلية: <span class='math-eq'>س - ٤ = ٦</span></p><p>ثانياً: نضيف ٤ للطرفين للتخلص من (-٤): <span class='math-eq'>س - ٤ <span class='highlight-change'>+ ٤</span> = ٦ <span class='highlight-change'>+ ٤</span></span></p><p>ثالثاً: نبسط المعادلة: <span class='math-eq'>س = ١٠</span></p><p class='mt-2 p-2 bg-green-100 rounded-md'>إذن، الحل الصحيح هو ١٠.</p></div>` },
                    // Question 4
                    { type: 'mcq', level: '⭐⭐', topic: 'oneVariable', text: 'حل المعادلة: <span class="math-eq">٣ن + ١ = ١٦</span>.', options: [ { display: '<span class="math-eq">٥</span>', value: '٥' }, { display: '<span class="math-eq">٦</span>', value: '٦' }, { display: '<span class="math-eq">١٥</span>', value: '١٥' }, { display: '<span class="math-eq">٤</span>', value: '٤' } ], correct: '٥', explanation: `<p class='mb-2'>الهدف هو عزل المتغير <span class="math-eq">ن</span>. نتخلص من الجمع أولاً ثم الضرب.</p><div class='text-right space-y-2'><p>أولاً: المعادلة الأصلية: <span class='math-eq'>٣ن + ١ = ١٦</span></p><p>ثانياً: نطرح ١ من الطرفين: <span class='math-eq'>٣ن + ١ <span class='highlight-change'>- ١</span> = ١٦ <span class='highlight-change'>- ١</span></span></p><p>ثالثاً: نبسط المعادلة: <span class='math-eq'>٣ن = ١٥</span></p><p>رابعاً: نقسم الطرفين على ٣: <span class='math-eq flex justify-center items-center'><span class="fraction"><span>٣ن</span><span class="border-t-2 border-current"></span><span>٣</span></span> = <span class="fraction"><span>١٥</span><span class="border-t-2 border-current"></span><span>٣</span></span></span></p><p>خامساً: الحل النهائي: <span class='math-eq'>ن = ٥</span></p><p class='mt-2 p-2 bg-green-100 rounded-md'>إذن، الحل الصحيح هو ٥.</p></div>` },
                    // Question 5 (Identity)
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'identity', text: 'أي من المعادلات التالية تعتبر <span class="vocab-term">متطابقة</span>؟', options: [ { display: '<span class="math-eq">س + ٥ = ١٠</span>', value: 'س + ٥ = ١٠' }, { display: '<span class="math-eq">٣(س + ٢) = ٣س + ٦</span>', value: '٣(س + ٢) = ٣س + ٦' }, { display: '<span class="math-eq">س = س + ١</span>', value: 'س = س + ١' }, { display: '<span class="math-eq">٢س = ٨</span>', value: '٢س = ٨' } ], correct: '٣(س + ٢) = ٣س + ٦', explanation: `<p>المتطابقة هي معادلة صحيحة لجميع قيم المتغير. إذا وزعنا الضرب على الجمع في الطرف الأيمن من المعادلة <span class="math-eq">٣(س + ٢)</span>، نحصل على <span class="math-eq">٣س + ٦</span>، وهو نفس الطرف الأيسر. لذا هي متطابقة.</p>` },
                    // Question 6 (No Solution)
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'noSolution', text: 'ما هي مجموعة حل المعادلة <span class="math-eq">ن + ٨ = ن - ٢</span>؟', options: [ { display: '<span class="math-eq">{١٠}</span>', value: '{١٠}' }, { display: '<span class="math-eq">{-٦}</span>', value: '{-٦}' }, { display: '<span class="math-eq">{كل الأعداد الحقيقية}</span>', value: 'all' }, { display: '<span class="math-eq">{ } (لا يوجد حل)</span>', value: 'none' } ], correct: 'none', explanation: `<p>إذا حاولنا حل المعادلة وطرحنا <span class="math-eq">ن</span> من الطرفين، سنحصل على العبارة الخاطئة <span class="math-eq">٨ = -٢</span>. هذا يعني أنه لا توجد قيمة لـ <span class="math-eq">ن</span> تجعل المعادلة صحيحة، وبالتالي فمجموعة الحل فارغة.</p>` },
                    // Question 7 (Variation)
                    { type: 'mcq', level: '⭐⭐', topic: 'oneVariable', text: 'حل المعادلة: <span class="math-eq">١٥ = ٢ب - ٣</span>.', options: [ { display: '<span class="math-eq">٩</span>', value: '٩' }, { display: '<span class="math-eq">٦</span>', value: '٦' }, { display: '<span class="math-eq">١٨</span>', value: '١٨' }, { display: '<span class="math-eq">-٩</span>', value: '-٩' } ], correct: '٩', explanation: `<p>الهدف هو عزل المتغير <span class="math-eq">ب</span>.</p><div class='text-right space-y-2'><p>أولاً: <span class='math-eq'>١٥ <span class='highlight-change'>+ ٣</span> = ٢ب - ٣ <span class='highlight-change'>+ ٣</span></span></p><p>ثانياً: <span class='math-eq'>١٨ = ٢ب</span></p><p>ثالثاً: نقسم الطرفين على ٢: <span class='math-eq'>٩ = ب</span></p></div>` },
                    // Question 8 (Variation)
                    { type: 'mcq', level: '⭐⭐', topic: 'twoVariables', text: 'إذا كان <span class="math-eq">(٣، ص)</span> حلاً للمعادلة <span class="math-eq">ص = ٥س - ٩</span>، فما قيمة <span class="math-eq">ص</span>؟', options: [ { display: '<span class="math-eq">١٥</span>', value: '١٥' }, { display: '<span class="math-eq">-١</span>', value: '-١' }, { display: '<span class="math-eq">٦</span>', value: '٦' }, { display: '<span class="math-eq">٢٤</span>', value: '٢٤' } ], correct: '٦', explanation: `<p>نعوض عن قيمة <span class="math-eq">س</span> بـ <span class="math-eq">٣</span> في المعادلة:</p><p class='math-eq'>ص = ٥(٣) - ٩</p><p class='math-eq'>ص = ١٥ - ٩</p><p class='math-eq'>ص = ٦</p>` },
                    // Question 9 (Identity Variation)
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'identity', text: 'أي العبارات التالية تجعل المعادلة <span class="math-eq">٤(م - ١) = ...</span> متطابقة؟', options: [ { display: '<span class="math-eq">٤م - ١</span>', value: '٤م - ١' }, { display: '<span class="math-eq">م - ٤</span>', value: 'م - ٤' }, { display: '<span class="math-eq">٤م - ٤</span>', value: '٤م - ٤' }, { display: '<span class="math-eq">٤م</span>', value: '٤م' } ], correct: '٤م - ٤', explanation: `<p>لكي تكون المعادلة متطابقة، يجب أن يكون الطرفان متساويين. باستخدام خاصية التوزيع، نضرب ٤ في كل حد داخل القوس:</p><p class='math-eq'>٤ × م = ٤م</p><p class='math-eq'>٤ × -١ = -٤</p><p>إذن، الطرف الآخر يجب أن يكون <span class="math-eq">٤م - ٤</span>.</p>` },
                    // Question 10 (No Solution Variation)
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'noSolution', text: 'حل المعادلة <span class="math-eq">٧ + ٢س = ٢(س + ١)</span>.', options: [ { display: '<span class="math-eq">س = ٥</span>', value: 'س = ٥' }, { display: '<span class="math-eq">{ } (لا يوجد حل)</span>', value: 'none' }, { display: '<span class="math-eq">{كل الأعداد الحقيقية}</span>', value: 'all' }, { display: '<span class="math-eq">س = -٥</span>', value: 'س = -٥' } ], correct: 'none', explanation: `<p>أولاً، نبسط الطرف الأيمن: <span class="math-eq">٧ + ٢س = ٢س + ٢</span>.</p><p>ثانياً، نطرح <span class="math-eq">٢س</span> من الطرفين، فنحصل على <span class="math-eq">٧ = ٢</span>.</p><p>بما أن هذه العبارة خاطئة، فالمعادلة ليس لها حل.</p>` },
                    // Question 11
                    { type: 'mcq', level: '⭐', topic: 'vocabulary', text: 'ماذا تسمى المعادلة التي تكون صحيحة لجميع قيم المتغير؟', options: [ { display: 'معادلة مستحيلة', value: 'impossible' }, { display: 'جملة مفتوحة', value: 'open' }, { display: 'متطابقة', value: 'identity' }, { display: 'مجموعة حل', value: 'solution' } ], correct: 'identity', explanation: `<p>المعادلة التي تكون صحيحة دائمًا، بغض النظر عن قيمة المتغير، تسمى <span class="vocab-term">متطابقة</span>.</p>` },
                    // Question 12 (NEW)
                    { type: 'mcq', level: '⭐⭐', topic: 'writing', text: 'اشترى أحمد كتابًا بسعر يزيد ٥ ريالات عن سعر قلمه. إذا كان سعر الكتاب ٣٠ ريالاً، فما المعادلة التي تمثل سعر القلم (ق)؟', options: [ { display: '<span class="math-eq">ق - ٥ = ٣٠</span>', value: 'ق - ٥ = ٣٠' }, { display: '<span class="math-eq">ق + ٥ = ٣٠</span>', value: 'ق + ٥ = ٣٠' }, { display: '<span class="math-eq">٥ق = ٣٠</span>', value: '٥ق = ٣٠' }, { display: '<span class="math-eq">ق = ٣٠ + ٥</span>', value: 'ق = ٣٠ + ٥' } ], correct: 'ق + ٥ = ٣٠', explanation: `<p>سعر الكتاب (<span class="math-eq">٣٠</span>) يساوي سعر القلم (<span class="math-eq">ق</span>) مضافًا إليه <span class="math-eq">٥</span>. لذلك، المعادلة الصحيحة هي <span class="math-eq">ق + ٥ = ٣٠</span>.</p>` }
                ];
                return [...questionBank].sort(() => Math.random() - 0.5).slice(0, 5);
            } 
        },
        'c1_l2': { title: 'الدرس ١-٢: حل المعادلات ذات الخطوة الواحدة', content: `
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفهوم الأساسي</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                        <p>لحل معادلة، هدفنا هو <span class="vocab-term">عزل المتغير</span> في طرف لوحده. لفعل ذلك، نستخدم <span class="vocab-term">العمليات العكسية</span>.</p>
                        <p>تذكر دائماً: <strong class="text-red-600">أي عملية تجريها على طرف من المعادلة، يجب أن تجريها على الطرف الآخر أيضاً</strong>. عندما تفعل ذلك، فأنت تنشئ <span class="vocab-term">معادلات متكافئة</span>، وهي معادلات لها نفس الحل.</p>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: الحل بالجمع أو الطرح</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="p-6 bg-gray-50 rounded-lg">
                            <p class="text-lg font-semibold mb-4 h-14">مثال (الحل بالجمع): حل المعادلة <span class="math-eq">ص - ٢٧ = ١٩</span></p>
                            <div class="space-y-4">
                                <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد العملية</h4><p>المتغير <span class="math-eq">ص</span> مطروح منه <span class="math-eq">٢٧</span>. العملية العكسية للطرح هي الجمع.</p></div>
                                <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تطبيق العملية العكسية</h4><p>نضيف <span class="math-eq">٢٧</span> إلى <strong class="text-red-600">كلا الطرفين</strong>.</p><p class="math-eq text-center mt-2">ص - ٢٧ <span class="highlight-change">+ ٢٧</span> = ١٩ <span class="highlight-change">+ ٢٧</span></p></div>
                                <div class="p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">ص = ٤٦</span></p></div>
                            </div>
                        </div>
                        <div class="p-6 bg-gray-50 rounded-lg">
                            <p class="text-lg font-semibold mb-4 h-14">مثال (الحل بالطرح): حل المعادلة <span class="math-eq">م + ١٢ = ١٥</span></p>
                            <div class="space-y-4">
                                <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد العملية</h4><p>المتغير <span class="math-eq">م</span> مضاف إليه <span class="math-eq">١٢</span>. العملية العكسية للجمع هي الطرح.</p></div>
                                <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تطبيق العملية العكسية</h4><p>نطرح <span class="math-eq">١٢</span> من <strong class="text-red-600">كلا الطرفين</strong>.</p><p class="math-eq text-center mt-2">م + ١٢ <span class="highlight-change">- ١٢</span> = ١٥ <span class="highlight-change">- ١٢</span></p></div>
                                <div class="p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">م = ٣</span></p></div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثالثاً: الحل بالضرب أو القسمة</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="p-6 bg-gray-50 rounded-lg">
                            <p class="text-lg font-semibold mb-4 h-14">مثال (الحل بالقسمة): حل المعادلة <span class="math-eq">٤ل = ٥٢</span></p>
                               <div class="space-y-4">
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد العملية</h4><p>المتغير <span class="math-eq">ل</span> مضروب في <span class="math-eq">٤</span>. العملية العكسية للضرب هي القسمة.</p></div>
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تطبيق العملية العكسية</h4><p>نقسم <strong class="text-red-600">كلا الطرفين</strong> على <span class="math-eq">٤</span>.</p>
                                    <p class="math-eq text-center mt-2 flex justify-center items-center"><span class="fraction"><span>٤ل</span><span class="frac-bar"></span><span>٤</span></span> = <span class="fraction"><span>٥٢</span><span class="frac-bar"></span><span>٤</span></span></p>
                                    </div>
                                    <div class="p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">ل = ١٣</span></p></div>
                                </div>
                        </div>
                        <div class="p-6 bg-gray-50 rounded-lg">
                            <p class="text-lg font-semibold mb-4 h-14">مثال (الحل بالضرب): حل المعادلة <span class="math-eq"><span class="fraction"><span>س</span><span class="frac-bar"></span><span>٦</span></span> = ٨</span></p>
                               <div class="space-y-4">
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد العملية</h4><p>المتغير <span class="math-eq">س</span> مقسوم على <span class="math-eq">٦</span>. العملية العكسية للقسمة هي الضرب.</p></div>
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تطبيق العملية العكسية</h4><p>نضرب <strong class="text-red-600">كلا الطرفين</strong> في <span class="math-eq">٦</span>.</p>
                                    <p class="math-eq text-center mt-2"><span class="fraction"><span>س</span><span class="frac-bar"></span><span>٦</span></span> <span class="highlight-change">× ٦</span> = ٨ <span class="highlight-change">× ٦</span></p>
                                    </div>
                                    <div class="p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">س = ٤٨</span></p></div>
                                </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                           <div class="p-6 bg-gray-50 rounded-lg">
                                <p class="text-lg font-semibold mb-4 h-20">مثال (التعامل مع الكسور): حل المعادلة <span class="math-eq"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span> ق = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span></span></p>
                                 <div class="space-y-4">
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد العملية</h4><p>المتغير <span class="math-eq">ق</span> مضروب في الكسر. العملية العكسية هي الضرب في <span class="vocab-term">مقلوب الكسر</span>.</p></div>
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تطبيق العملية العكسية</h4><p>نضرب <strong class="text-red-600">كلا الطرفين</strong> في مقلوب الكسر وهو <span class="math-eq"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span>.</p>
                                    <p class="math-eq text-center mt-2"><span class="highlight-change"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span> × <span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span> ق = <span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span> × <span class="highlight-change"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span></p>
                                    </div>
                                    <div class="p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">ق = <span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٤</span></span></span></p></div>
                                </div>
                            </div>
                        <div class="p-6 bg-gray-50 rounded-lg">
                            <p class="text-lg font-semibold mb-4 h-20">مثال (التعامل مع مقلوب كسر سالب): حل المعادلة <span class="math-eq"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٥</span></span> ف = -٩</span></p>
                            <div class="space-y-4">
                                <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تحديد العملية</h4><p>المتغير <span class="math-eq">ف</span> مضروب في الكسر. العملية العكسية هي الضرب في مقلوب الكسر.</p></div>
                                <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تطبيق العملية العكسية</h4><p>نضرب <strong class="text-red-600">كلا الطرفين</strong> في مقلوب الكسر وهو <span class="math-eq"><span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٣</span></span></span>.</p>
                                <p class="math-eq text-center mt-2"><span class="highlight-change"><span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٣</span></span></span> × <span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٥</span></span> ف = -٩ × <span class="highlight-change"><span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٣</span></span></span></p>
                                </div>
                                <div class="p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">ف = -١٥</span></p></div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 رابعاً: كتابة المعادلات وحلها</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="p-6 bg-gray-50 rounded-lg">
                            <p class="text-lg font-semibold mb-4 h-20">مثال: اكتب معادلة تمثل الجملة "ستة أمثال عدد تساوي ١٣٢"، ثم حلها.</p>
                            <div class="space-y-4">
                                <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: ترجمة الجملة</h4><p>"ستة أمثال عدد" تترجم إلى <span class="math-eq">٦س</span>. "تساوي ١٣٢" تترجم إلى <span class="math-eq">= ١٣٢</span>.</p><p class="mt-2">إذن، المعادلة هي: <span class="math-eq">٦س = ١٣٢</span></p></div>
                                <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: حل المعادلة</h4><p>لحل المعادلة، نقسم كلا الطرفين على <span class="math-eq">٦</span>.</p>
                                <p class="math-eq text-center mt-2 flex justify-center items-center"><span class="fraction"><span>٦س</span><span class="frac-bar"></span><span>٦</span></span> = <span class="fraction"><span>١٣٢</span><span class="frac-bar"></span><span>٦</span></span></p>
                                </div>
                                <div class="p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>بعد التبسيط، نجد أن <span class="math-eq">س = ٢٢</span></p></div>
                            </div>
                        </div>
                        <div class="p-6 bg-blue-50 rounded-lg">
                            <p class="text-lg font-semibold mb-4 h-20">مثال: اكتب معادلة تمثل الجملة "أقل من عدد بعشرة يساوي ٢٥"، ثم حلها.</p>
                            <div class="space-y-4">
                                <div class="p-4 bg-white rounded-lg step-box border-blue-600"><h4 class="font-bold text-blue-800">الخطوة 1: ترجمة الجملة</h4><p>"أقل من عدد بعشرة" تترجم إلى <span class="math-eq">س - ١٠</span>. "يساوي ٢٥" تترجم إلى <span class="math-eq">= ٢٥</span>.</p><p class="mt-2">إذن، المعادلة هي: <span class="math-eq text-blue-700">س - ١٠ = ٢٥</span></p></div>
                                <div class="p-4 bg-white rounded-lg step-box border-blue-600"><h4 class="font-bold text-blue-800">الخطوة 2: حل المعادلة</h4><p>لحل المعادلة، نضيف <span class="math-eq">١٠</span> إلى كلا الطرفين.</p>
                                <p class="math-eq text-center mt-2">س - ١٠ <span class="highlight-change">+ ١٠</span> = ٢٥ <span class="highlight-change">+ ١٠</span></p>
                                </div>
                                <div class="p-4 bg-green-100 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>بعد التبسيط، نجد أن <span class="math-eq">س = ٣٥</span></p></div>
                            </div>
                        </div>
                    </div>
                </section>
            `, 
            generateQuiz: () => {
                const questionBank = [
                    { type: 'mcq', level: '⭐', topic: 'addition', text: 'حل المعادلة: <span class="math-eq">س + ١٠ = ٣٥</span>', options: [ { display: '<span class="math-eq">٤٥</span>', value: '٤٥' }, { display: '<span class="math-eq">٢٥</span>', value: '٢٥' }, { display: '<span class="math-eq">٣.٥</span>', value: '٣.٥' }, { display: '<span class="math-eq">-٢٥</span>', value: '-٢٥' } ], correct: '٢٥', explanation: `<p class='mb-2'>لحل المعادلة، نطرح <span class="math-eq">١٠</span> من كلا الطرفين.</p><div class='text-right space-y-2'><p>أولاً: <span class='math-eq'>س + ١٠ <span class='highlight-change'>- ١٠</span> = ٣٥ <span class='highlight-change'>- ١٠</span></span></p><p>ثانياً: <span class='math-eq'>س = ٢٥</span></p></div>` },
                    { type: 'mcq', level: '⭐', topic: 'subtraction', text: 'حل المعادلة: <span class="math-eq">ك - ١٣ = ٥</span>', options: [ { display: '<span class="math-eq">٨</span>', value: '٨' }, { display: '<span class="math-eq">-٨</span>', value: '-٨' }, { display: '<span class="math-eq">١٨</span>', value: '١٨' }, { display: '<span class="math-eq">-١٨</span>', value: '-١٨' } ], correct: '١٨', explanation: `<p class='mb-2'>لحل المعادلة، نضيف <span class="math-eq">١٣</span> إلى كلا الطرفين.</p><div class='text-right space-y-2'><p>أولاً: <span class='math-eq'>ك - ١٣ <span class='highlight-change'>+ ١٣</span> = ٥ <span class='highlight-change'>+ ١٣</span></span></p><p>ثانياً: <span class='math-eq'>ك = ١٨</span></p></div>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'division', text: 'حل المعادلة: <span class="math-eq">-٨س = ٩٦</span>', options: [ { display: '<span class="math-eq">١٢</span>', value: '١٢' }, { display: '<span class="math-eq">١٠٤</span>', value: '١٠٤' }, { display: '<span class="math-eq">-١٢</span>', value: '-١٢' }, { display: '<span class="math-eq">-٨٨</span>', value: '-٨٨' } ], correct: '-١٢', explanation: `<p class='mb-2'>لحل المعادلة، نقسم كلا الطرفين على <span class="math-eq">-٨</span>.</p><div class='text-right space-y-2 flex justify-center items-center'><p>أولاً: <span class='math-eq'><span class="fraction"><span>-٨س</span><span class="frac-bar"></span><span class='highlight-change'>-٨</span></span> = <span class="fraction"><span>٩٦</span><span class="frac-bar"></span><span class='highlight-change'>-٨</span></span></span></p></div><p class='text-center mt-2'>ثانياً: <span class='math-eq'>س = -١٢</span></p>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'multiplication', text: 'حل المعادلة: <span class="math-eq"><span class="fraction"><span>ص</span><span class="frac-bar"></span><span>٧</span></span> = -٤</span>', options: [ { display: '<span class="math-eq">٣</span>', value: '٣' }, { display: '<span class="math-eq">-٢٨</span>', value: '-٢٨' }, { display: '<span class="math-eq">٢٨</span>', value: '٢٨' }, { display: '<span class="math-eq">-١١</span>', value: '-١١' } ], correct: '-٢٨', explanation: `<p class='mb-2'>لحل المعادلة، نضرب كلا الطرفين في <span class="math-eq">٧</span>.</p><div class='text-right space-y-2 flex justify-center items-center'><p>أولاً: <span class='math-eq'><span class="fraction"><span>ص</span><span class="frac-bar"></span><span>٧</span></span> <span class='highlight-change'>× ٧</span> = -٤ <span class='highlight-change'>× ٧</span></span></p></div><p class='text-center mt-2'>ثانياً: <span class='math-eq'>ص = -٢٨</span></p>` },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'writing', text: 'ما حل المعادلة التي تمثل "ثلثا عدد يساوي سالب ثمانية"؟', options: [ { display: '<span class="math-eq">-١٢</span>', value: '-١٢' }, { display: '<span class="math-eq">-١٦</span>', value: '-١٦' }, { display: '<span class="math-eq flex justify-center items-center">-٥<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٣</span></span></span>', value: '-16/3' }, { display: '<span class="math-eq">١٢</span>', value: '١٢' } ], correct: '-١٢', explanation: `<p class='mb-2'>أولاً، نكتب المعادلة: <span class="math-eq"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>س = -٨</span></p><p class='mb-2'>ثانياً، نحل بضرب الطرفين في مقلوب الكسر <span class="math-eq"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span></p><p class='math-eq text-center'>س = -٨ × <span class="highlight-change"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span></p><p class='math-eq text-center'>س = <span class="fraction"><span>-٢٤</span><span class="frac-bar"></span><span>٢</span></span> = -١٢</p>` },
                    { type: 'mcq', level: '⭐', topic: 'subtraction', text: 'حل المعادلة: <span class="math-eq">ن - ٦ = -١٥</span>', options: [ { display: '<span class="math-eq">-٩</span>', value: '-٩' }, { display: '<span class="math-eq">-٢١</span>', value: '-٢١' }, { display: '<span class="math-eq">٩</span>', value: '٩' }, { display: '<span class="math-eq">٢١</span>', value: '٢١' } ], correct: '-٩', explanation: `<p class='mb-2'>لحل المعادلة، نضيف <span class="math-eq">٦</span> إلى كلا الطرفين.</p><div class='text-right space-y-2'><p>أولاً: <span class='math-eq'>ن - ٦ <span class='highlight-change'>+ ٦</span> = -١٥ <span class='highlight-change'>+ ٦</span></span></p><p>ثانياً: <span class='math-eq'>ن = -٩</span></p></div>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'multiplication', text: 'حل المعادلة: <span class="math-eq">-٣ف = -٢٧</span>', options: [ { display: '<span class="math-eq">-٩</span>', value: '-٩' }, { display: '<span class="math-eq">٩</span>', value: '٩' }, { display: '<span class="math-eq">-٣٠</span>', value: '-٣٠' }, { display: '<span class="math-eq">-٢٤</span>', value: '-٢٤' } ], correct: '٩', explanation: `<p class='mb-2'>لحل المعادلة، نقسم كلا الطرفين على <span class="math-eq">-٣</span>.</p><div class='text-right space-y-2 flex justify-center items-center'><p>أولاً: <span class='math-eq'><span class="fraction"><span>-٣ف</span><span class="frac-bar"></span><span class='highlight-change'>-٣</span></span> = <span class="fraction"><span>-٢٧</span><span class="frac-bar"></span><span class='highlight-change'>-٣</span></span></span></p></div><p class='text-center mt-2'>ثانياً: <span class='math-eq'>ف = ٩</span></p>` },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'division', text: 'حل المعادلة: <span class="math-eq"><span class="fraction"><span>ب</span><span class="frac-bar"></span><span>-٤</span></span> = -١٢</span>', options: [ { display: '<span class="math-eq">٣</span>', value: '٣' }, { display: '<span class="math-eq">-٣</span>', value: '-٣' }, { display: '<span class="math-eq">٤٨</span>', value: '٤٨' }, { display: '<span class="math-eq">-٤٨</span>', value: '-٤٨' } ], correct: '٤٨', explanation: `<p class='mb-2'>لحل المعادلة، نضرب كلا الطرفين في <span class="math-eq">-٤</span>.</p><div class='text-right space-y-2 flex justify-center items-center'><p>أولاً: <span class='math-eq'><span class="fraction"><span>ب</span><span class="frac-bar"></span><span>-٤</span></span> <span class='highlight-change'>× -٤</span> = -١٢ <span class='highlight-change'>× -٤</span></span></p></div><p class='text-center mt-2'>ثانياً: <span class='math-eq'>ب = ٤٨</span></p>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'writing', text: 'عدد نقص بمقدار ٨ فأصبح ١٥. ما هي المعادلة التي تمثل هذه الجملة؟', options: [ { display: '<span class="math-eq">س + ٨ = ١٥</span>', value: 'س + ٨ = ١٥' }, { display: '<span class="math-eq">س - ٨ = ١٥</span>', value: 'س - ٨ = ١٥' }, { display: '<span class="math-eq">٨ - س = ١٥</span>', value: '٨ - س = ١٥' }, { display: '<span class="math-eq">٨س = ١٥</span>', value: '٨س = ١٥' } ], correct: 'س - ٨ = ١٥', explanation: `<p class='mb-2'>"عدد" يمثل بـ <span class="math-eq">س</span>. "نقص بمقدار ٨" يعني نطرح <span class="math-eq">٨</span>. "فأصبح ١٥" يعني يساوي <span class="math-eq">١٥</span>. إذن المعادلة هي <span class="math-eq">س - ٨ = ١٥</span></p>` },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'fractions', text: 'حل المعادلة: <span class="math-eq"><span class="fraction"><span>٤</span><span class="frac-bar"></span><span>٥</span></span> م = ٢٨</span>', options: [ { display: '<span class="math-eq">٣٥</span>', value: '٣٥' }, { display: '<span class="math-eq">٢٢.٤</span>', value: '٢٢.٤' }, { display: '<span class="math-eq">٢٨.٨</span>', value: '٢٨.٨' }, { display: '<span class="math-eq">٣٢</span>', value: '٣٢' } ], correct: '٣٥', explanation: `<p class='mb-2'>لحل المعادلة، نضرب كلا الطرفين في مقلوب الكسر وهو <span class="math-eq"><span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٤</span></span></span></p><p class='math-eq text-center'>م = ٢٨ × <span class="highlight-change"><span class="fraction"><span>٥</span><span class="frac-bar"></span><span>٤</span></span></span></p><p class='math-eq text-center'>م = <span class="fraction"><span>٢٨ × ٥</span><span class="frac-bar"></span><span>٤</span></span> = <span class="fraction"><span>١٤٠</span><span class="frac-bar"></span><span>٤</span></span> = ٣٥</p>` },
                    { type: 'mcq', level: '⭐', topic: 'writing', text: 'ما هي المعادلة التي تمثل الجملة: "عدد مضاف إليه ١٤ يساوي ٣"؟', options: [ { display: '<span class="math-eq">س + ١٤ = ٣</span>', value: 'س + ١٤ = ٣' }, { display: '<span class="math-eq">س - ١٤ = ٣</span>', value: 'س - ١٤ = ٣' }, { display: '<span class="math-eq">١٤س = ٣</span>', value: '١٤س = ٣' }, { display: '<span class="math-eq">٣ + س = ١٤</span>', value: '٣ + س = ١٤' } ], correct: 'س + ١٤ = ٣', explanation: `<p class='mb-2'>"عدد مضاف إليه ١٤" يترجم إلى <span class="math-eq">س + ١٤</span>. "يساوي ٣" يترجم إلى <span class="math-eq">= ٣</span>. إذن المعادلة هي <span class="math-eq">س + ١٤ = ٣</span></p>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'writing', text: 'ما هي المعادلة التي تمثل الجملة: "ناتج قسمة عدد على ٥ يساوي -١٠"؟', options: [ { display: '<span class="math-eq">س + ٥ = -١٠</span>', value: 'س + ٥ = -١٠' }, { display: '<span class="math-eq"><span class="fraction"><span>س</span><span class="frac-bar"></span><span>٥</span></span> = -١٠</span>', value: 'س/٥ = -١٠' }, { display: '<span class="math-eq">٥س = -١٠</span>', value: '٥س = -١٠' }, { display: '<span class="math-eq">س - ٥ = -١٠</span>', value: 'س - ٥ = -١٠' } ], correct: 'س/٥ = -١٠', explanation: `<p class='mb-2'>"ناتج قسمة عدد على ٥" يترجم إلى <span class="math-eq"><span class="fraction"><span>س</span><span class="frac-bar"></span><span>٥</span></span></span>. "يساوي -١٠" يترجم إلى <span class="math-eq">= -١٠</span>. إذن المعادلة هي <span class="math-eq"><span class="fraction"><span>س</span><span class="frac-bar"></span><span>٥</span></span> = -١٠</span></p>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'writing', text: 'ترجم الجملة التالية إلى معادلة: "ناتج ضرب عدد في سالب سبعة هو ٤٩".', options: [ { display: '<span class="math-eq">س - ٧ = ٤٩</span>', value: 'س - ٧ = ٤٩' }, { display: '<span class="math-eq">س + (-٧) = ٤٩</span>', value: 'س + (-٧) = ٤٩' }, { display: '<span class="math-eq">-٧س = ٤٩</span>', value: '-٧س = ٤٩' }, { display: '<span class="math-eq"><span class="fraction"><span>س</span><span class="frac-bar"></span><span>-٧</span></span> = ٤٩</span>', value: 'س/-٧ = ٤٩' } ], correct: '-٧س = ٤٩', explanation: `<p class='mb-2'>"ناتج ضرب عدد في سالب سبعة" يترجم إلى <span class="math-eq">-٧س</span>. "هو ٤٩" يترجم إلى <span class="math-eq">= ٤٩</span>. إذن المعادلة هي <span class="math-eq">-٧س = ٤٩</span></p>` }
                ];
                return [...questionBank].sort(() => Math.random() - 0.5).slice(0, 5);
            } },
        'c1_l3': { title: 'الدرس ١-٣: حل المعادلات متعددة الخطوات', content:`
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفهوم الأساسي</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                        <p>في هذا الدرس، سنحل <span class="vocab-term">معادلات متعددة الخطوات</span>، وهي معادلات تتطلب أكثر من عملية واحدة لحلها. المفتاح هو <strong class="text-red-600">التخلص من عمليات الجمع والطرح أولاً</strong>، ثم التخلص من عمليات الضرب والقسمة.</p>
                        <p>سنتعلم أيضاً عن <span class="vocab-term">نظرية الأعداد</span> لحل مسائل تتضمن <span class="vocab-term">أعداداً صحيحة متتالية</span>.</p>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: حل معادلة متعددة الخطوات</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Example 1 -->
                            <div>
                                <p class="text-lg font-semibold mb-4">مثال ١: حل المعادلة <span class="math-eq">٥س + ٩ = ٢٤</span>.</p>
                                <div class="space-y-4">
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: التخلص من الجمع</h4><p>نطرح <span class="math-eq">٩</span> من كلا الطرفين.</p><p class="math-eq text-center mt-2">٥س + ٩ <span class="highlight-change">- ٩</span> = ٢٤ <span class="highlight-change">- ٩</span></p><p class="math-eq text-center mt-2">٥س = ١٥</p></div>
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: التخلص من الضرب</h4><p>نقسم كلا الطرفين على <span class="math-eq">٥</span>.</p><p class="math-eq text-center mt-2 flex justify-center items-center"><span class="fraction"><span>٥س</span><span class="frac-bar"></span><span>٥</span></span> = <span class="fraction"><span>١٥</span><span class="frac-bar"></span><span>٥</span></span></p></div>
                                    <div class="p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">س = ٣</span>.</p></div>
                                </div>
                            </div>
                            <!-- Example 2: Fractions -->
                            <div>
                                <p class="text-lg font-semibold mb-4">مثال ٢: معادلة تتضمن كسوراً <span class="math-eq"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>س + ٤ = ٢</span>.</p>
                                <div class="space-y-4">
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: التخلص من الجمع</h4><p>نطرح <span class="math-eq">٤</span> من كلا الطرفين.</p><p class="math-eq text-center mt-2"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>س + ٤ <span class="highlight-change">- ٤</span> = ٢ <span class="highlight-change">- ٤</span></p><p class="math-eq text-center mt-2"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>س = -٢</p></div>
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: التخلص من الكسر</h4><p>نضرب الطرفين في مقلوب الكسر <span class="math-eq"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span>.</p><p class="math-eq text-center mt-2 flex justify-center items-center"><span class="highlight-change"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span> × </span><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>س = -٢ <span class="highlight-change">× <span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span></p></div>
                                    <div class="p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">س = -٣</span>.</p></div>
                                </div>
                            </div>
                        </div>
                        <hr class="border-gray-300 my-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Example 3: Distribution -->
                            <div>
                                <p class="text-lg font-semibold mb-4">مثال ٣: خاصية التوزيع <span class="math-eq">٣(س - ٥) = ١٢</span>.</p>
                                <div class="space-y-4">
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: التوزيع</h4><p>نضرب <span class="math-eq">٣</span> في كل حد داخل القوس.</p><p class="math-eq text-center mt-2">٣س - ١٥ = ١٢</p></div>
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: التخلص من الطرح</h4><p>نضيف <span class="math-eq">١٥</span> إلى كلا الطرفين.</p><p class="math-eq text-center mt-2">٣س - ١٥ <span class="highlight-change">+ ١٥</span> = ١٢ <span class="highlight-change">+ ١٥</span></p><p class="math-eq text-center mt-2">٣س = ٢٧</p></div>
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 3: التخلص من الضرب</h4><p>نقسم كلا الطرفين على <span class="math-eq">٣</span>.</p><p class="math-eq text-center mt-2 flex justify-center items-center"><span class="fraction"><span>٣س</span><span class="frac-bar"></span><span>٣</span></span> = <span class="fraction"><span>٢٧</span><span class="frac-bar"></span><span>٣</span></span></p></div>
                                    <div class="p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 4: الحل النهائي</h4><p><span class="math-eq">س = ٩</span>.</p></div>
                                </div>
                            </div>
                            <!-- Example 4: Variables on both sides -->
                            <div>
                                <p class="text-lg font-semibold mb-4">مثال ٤: متغيرات في الطرفين <span class="math-eq">٦(ن - ٢) = ٢ن</span>.</p>
                                <div class="space-y-4">
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: التوزيع</h4><p>نطبق خاصية التوزيع على الطرف الأيمن.</p><p class="math-eq text-center mt-2">٦ن - ١٢ = ٢ن</p></div>
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: تجميع المتغيرات</h4><p>نطرح <span class="math-eq">٢ن</span> من كلا الطرفين.</p><p class="math-eq text-center mt-2">٦ن <span class="highlight-change">- ٢ن</span> - ١٢ = ٢ن <span class="highlight-change">- ٢ن</span></p><p class="math-eq text-center mt-2">٤ن - ١٢ = ٠</p></div>
                                    <div class="p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 3: حل المعادلة</h4><p>نضيف ١٢ للطرفين ثم نقسم على ٤.</p><p class="math-eq text-center mt-2">٤ن = ١٢</p><p class="math-eq text-center mt-2 flex justify-center items-center"><span class="fraction"><span>٤ن</span><span class="frac-bar"></span><span>٤</span></span> = <span class="fraction"><span>١٢</span><span class="frac-bar"></span><span>٤</span></span></p></div>
                                    <div class="p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 4: الحل النهائي</h4><p><span class="math-eq">ن = ٣</span>.</p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثالثاً: حل مسائل الأعداد المتتالية</h2>
                    <div class="p-4 bg-indigo-50 rounded-lg mb-6 text-gray-700 space-y-3">
                        <p><strong class="text-indigo-800">توضيح هام:</strong></p>
                        <ul class="list-disc pr-6 space-y-2">
                            <li><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded"><strong>الأعداد الصحيحة المتتالية:</strong></span> الفارق بينها ١ (مثل: ن، ن+١، ن+٢).</li>
                            <li><span class="bg-purple-100 text-purple-800 px-2 py-1 rounded"><strong>الأعداد الزوجية أو الفردية المتتالية:</strong></span> الفارق بينها ٢ (مثل: ن، ن+٢، ن+٤).</li>
                        </ul>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Interactive Example 1 -->
                        <div id="interactive-example-1" class="p-6 bg-blue-50 rounded-lg border-2 border-blue-200">
                            <p class="text-lg font-semibold mb-4">مثال ١: أوجد ثلاثة أعداد صحيحة متتالية مجموعها <span class="math-eq">٦٣</span>.</p>
                            <div class="space-y-4">
                                <div class="step-interactive active p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تعريف المتغيرات</h4><p>نفرض أن الأعداد هي: <span class="math-eq">ن</span>، <span class="math-eq">ن + ١</span>، <span class="math-eq">ن + ٢</span>.</p></div>
                                <div class="step-interactive p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: كتابة المعادلة</h4><p class="math-eq text-center mt-2">ن + (ن + ١) + (ن + ٢) = ٦٣</p></div>
                                <div class="step-interactive p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 3: حل المعادلة</h4><p>نبسط بجمع الحدود المتشابهة: <span class="math-eq">٣ن + ٣ = ٦٣</span></p><p>نطرح ٣ من الطرفين: <span class="math-eq">٣ن = ٦٠</span></p><p>نقسم على ٣: <span class="math-eq">ن = ٢٠</span></p></div>
                                <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 4: إيجاد الأعداد</h4><p>الأعداد هي: <span class="math-eq">٢٠، ٢١، ٢٢</span>.</p></div>
                            </div>
                            <div class="flex justify-between mt-6">
                                <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">التالي</button>
                            </div>
                        </div>
                        <!-- Interactive Example 2 -->
                        <div id="interactive-example-2" class="p-6 bg-purple-50 rounded-lg border-2 border-purple-200">
                            <p class="text-lg font-semibold mb-4">مثال ٢: أوجد ثلاثة أعداد فردية متتالية مجموعها <span class="math-eq">٧٥</span>.</p>
                            <div class="space-y-4">
                                <div class="step-interactive active p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تعريف المتغيرات</h4><p>نفرض أن الأعداد هي: <span class="math-eq">ن</span>، <span class="math-eq">ن + ٢</span>، <span class="math-eq">ن + ٤</span>.</p></div>
                                <div class="step-interactive p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 2: كتابة المعادلة</h4><p class="math-eq text-center mt-2">ن + (ن + ٢) + (ن + ٤) = ٧٥</p></div>
                                <div class="step-interactive p-4 bg-white rounded-lg step-box"><h4 class="font-bold">الخطوة 3: حل المعادلة</h4><p>نبسط بجمع الحدود المتشابهة: <span class="math-eq">٣ن + ٦ = ٧٥</span></p><p>نطرح ٦ من الطرفين: <span class="math-eq">٣ن = ٦٩</span></p><p>نقسم على ٣: <span class="math-eq">ن = ٢٣</span></p></div>
                                <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة 4: إيجاد الأعداد</h4><p>الأعداد هي: <span class="math-eq">٢٣، ٢٥، ٢٧</span>.</p></div>
                            </div>
                            <div class="flex justify-between mt-6">
                                <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                <button data-example="2" class="next-btn bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed">التالي</button>
                            </div>
                        </div>
                    </div>
                </section>
            `, 
            generateQuiz: () => {
                const questionBank = [
                    { type: 'mcq', level: '⭐', topic: 'multi-step', text: 'حل المعادلة: <span class="math-eq">٢س + ١ = ٧</span>', 
                      options: [ { display: '<span class="math-eq">٤</span>', value: '٤' }, { display: '<span class="math-eq">٣</span>', value: '٣' }, { display: '<span class="math-eq">٥</span>', value: '٥' }, { display: '<span class="math-eq">٦</span>', value: '٦' } ], 
                      correct: '٣', 
                      explanation: `<p class='mb-2'>نتخلص من الجمع أولاً ثم الضرب.</p><div class='text-right space-y-2'><p>أولاً: نطرح ١ من الطرفين: <span class='math-eq'>٢س + ١ <span class='highlight-change'>- ١</span> = ٧ <span class='highlight-change'>- ١</span></span></p><p>ثانياً: نبسط: <span class='math-eq'>٢س = ٦</span></p><p>ثالثاً: نقسم الطرفين على ٢: <span class='math-eq flex justify-center items-center'><span class="fraction"><span>٢س</span><span class="frac-bar"></span><span>٢</span></span> = <span class="fraction"><span>٦</span><span class="frac-bar"></span><span>٢</span></span></span></p><p>رابعاً: الحل النهائي: <span class='math-eq'>س = ٣</span></p></div>` 
                    },
                    { type: 'mcq', level: '⭐⭐', topic: 'multi-step', text: 'حل المعادلة: <span class="math-eq">-١ = ٥ + ٢ن</span>', 
                      options: [ { display: '<span class="math-eq">-٣</span>', value: '-٣' }, { display: '<span class="math-eq">٣</span>', value: '٣' }, { display: '<span class="math-eq">-٢</span>', value: '-٢' }, { display: '<span class="math-eq">٢</span>', value: '٢' } ], 
                      correct: '-٣', 
                      explanation: `<p class='mb-2'>نتخلص من الجمع أولاً ثم الضرب.</p><div class='text-right space-y-2'><p>أولاً: نطرح ٥ من الطرفين: <span class='math-eq'>-١ <span class='highlight-change'>- ٥</span> = ٥ + ٢ن <span class='highlight-change'>- ٥</span></span></p><p>ثانياً: نبسط: <span class='math-eq'>-٦ = ٢ن</span></p><p>ثالثاً: نقسم الطرفين على ٢: <span class='math-eq flex justify-center items-center'><span class="fraction"><span>-٦</span><span class="frac-bar"></span><span>٢</span></span> = <span class="fraction"><span>٢ن</span><span class="frac-bar"></span><span>٢</span></span></span></p><p>رابعاً: الحل النهائي: <span class='math-eq'>-٣ = ن</span></p></div>` 
                    },
                    { type: 'mcq', level: '⭐⭐', topic: 'consecutive', text: 'أوجد ثلاثة أعداد صحيحة متتالية مجموعها <span class="math-eq">٣٣</span>.', 
                      options: [ { display: '٩، ١٠، ١١', value: '٩، ١٠، ١١' }, { display: '١١، ١٢، ١٣', value: '١١، ١٢، ١٣' }, { display: '١٠، ١١، ١٢', value: '١٠، ١١، ١٢' }, { display: '٣٢، ٣٣، ٣٤', value: '٣٢، ٣٣، ٣٤' } ], 
                      correct: '١٠، ١١، ١٢', 
                      explanation: `<p class='mb-2'>نفرض الأعداد: <span class="math-eq">ن</span>، <span class="math-eq">ن+١</span>، <span class="math-eq">ن+٢</span>.</p><div class='text-right space-y-2'><p>أولاً: المعادلة: <span class='math-eq'>ن + (ن+١) + (ن+٢) = ٣٣</span></p><p>ثانياً: نبسط بجمع الحدود المتشابهة: <span class='math-eq'>٣ن + ٣ = ٣٣</span></p><p>ثالثاً: نطرح ٣ من الطرفين: <span class='math-eq'>٣ن + ٣ <span class='highlight-change'>- ٣</span> = ٣٣ <span class='highlight-change'>- ٣</span></span></p><p>رابعاً: نبسط: <span class='math-eq'>٣ن = ٣٠</span></p><p>خامساً: نقسم على ٣: <span class='math-eq'>ن = ١٠</span></p><p class='mt-2 p-2 bg-green-100 rounded-md'>إذن الأعداد هي ١٠، ١١، ١٢.</p></div>` 
                    },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'multi-step', text: 'حل المعادلة: <span class="math-eq flex justify-center items-center"><span class="fraction"><span>ك - ٥</span><span class="frac-bar"></span><span>-٢</span></span> = ٨</span>', 
                      options: [ { display: '<span class="math-eq">-١١</span>', value: '-١١' }, { display: '<span class="math-eq">-٢١</span>', value: '-٢١' }, { display: '<span class="math-eq">٢١</span>', value: '٢١' }, { display: '<span class="math-eq">١١</span>', value: '١١' } ], 
                      correct: '-١١', 
                      explanation: `<p class='mb-2'>نتخلص من القسمة أولاً ثم الطرح.</p><div class='text-right space-y-2'>
                                  <p>أولاً: نضرب كلا الطرفين في <span class="math-eq">-٢</span>:</p>
                                  <p class="math-eq text-center flex justify-center items-center">
                                     <span class="fraction"><span>ك - ٥</span><span class="frac-bar"></span><span>-٢</span></span> <span class="highlight-change">× (-٢)</span> = ٨ <span class="highlight-change">× (-٢)</span>
                                  </p>
                                  <p>ثانياً: نبسط:</p>
                                  <p class="math-eq text-center">ك - ٥ = -١٦</p>
                                  <p>ثالثاً: نضيف <span class="math-eq">٥</span> لكلا الطرفين:</p>
                                  <p class="math-eq text-center">ك - ٥ <span class="highlight-change">+ ٥</span> = -١٦ <span class="highlight-change">+ ٥</span></p>
                                  <p>رابعاً: الحل النهائي:</p>
                                  <p class="math-eq text-center">ك = -١١</p>
                                </div>` 
                    },
                    { 
                      type: 'mcq', 
                      level: '⭐⭐⭐', 
                      topic: 'consecutive-equation', 
                      text: 'ثلاثة أعداد <strong>فردية</strong> متتالية مجموعها ٧٥. ما المعادلة التي تمثل هذه المسألة؟ (افرض أن أصغر عدد هو ن)', 
                      options: [
                          { display: '<span class="math-eq">ن + (ن+١) + (ن+٢) = ٧٥</span>', value: 'q1_opt1' },
                          { display: '<span class="math-eq">ن + (ن+٢) + (ن+٤) = ٧٥</span>', value: 'q1_opt2' },
                          { display: '<span class="math-eq">٣ن = ٧٥</span>', value: 'q1_opt3' },
                          { display: '<span class="math-eq">ن(ن+٢)(ن+٤) = ٧٥</span>', value: 'q1_opt4' }
                      ], 
                      correct: 'q1_opt2', 
                      explanation: `<p class='mb-2'>لأن الأعداد <strong>فردية</strong> متتالية، فإن الفارق بين كل عدد والذي يليه هو ٢. إذا كان العدد الأول هو <span class="math-eq">ن</span>، فالعدد الثاني هو <span class="math-eq">ن+٢</span>، والثالث هو <span class="math-eq">ن+٤</span>. مجموعهم هو المعادلة الصحيحة.</p>`
                    },
                    { 
                      type: 'mcq', 
                      level: '⭐⭐', 
                      topic: 'consecutive-equation', 
                      text: 'ما المعادلة التي تمثل المسألة: \'ثلاثة أعداد صحيحة متتالية مجموعها ٣٣\'؟', 
                      options: [
                          { display: '<span class="math-eq">٣ن = ٣٣</span>', value: 'q2_opt1' },
                          { display: '<span class="math-eq">ن + (ن+٢) + (ن+٤) = ٣٣</span>', value: 'q2_opt2' },
                          { display: '<span class="math-eq">ن + (ن+١) + (ن+٢) = ٣٣</span>', value: 'q2_opt3' },
                          { display: '<span class="math-eq">ن + (ن-١) + (ن-٢) = ٣٣</span>', value: 'q2_opt4' }
                      ], 
                      correct: 'q2_opt3', 
                      explanation: `<p class='mb-2'>لأن الأعداد <strong>صحيحة</strong> متتالية، فإن الفارق بين كل عدد والذي يليه هو ١. إذا كان العدد الأول هو <span class="math-eq">ن</span>، فالعدد الثاني هو <span class="math-eq">ن+١</span>، والثالث هو <span class="math-eq">ن+٢</span>. مجموعهم هو المعادلة الصحيحة.</p><p>المعادلة <span class="math-eq">ن + (ن+١) + (ن+٢) = ٣٣</span> تبسط إلى <span class="math-eq">٣ن + ٣ = ٣٣</span>.</p>`
                    },
                    { 
                      type: 'mcq', 
                      level: '⭐⭐', 
                      topic: 'fraction-equation', 
                      text: 'حل المعادلة: <span class="math-eq"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>س + ٤ = ٢</span>', 
                      options: [
                          { display: '<span class="math-eq">-٣</span>', value: '-٣' },
                          { display: '<span class="math-eq">٣</span>', value: '٣' },
                          { display: '<span class="math-eq">-٩</span>', value: '-٩' },
                          { display: '<span class="math-eq">٩</span>', value: '٩' }
                      ], 
                      correct: '-٣', 
                      explanation: `<p class='mb-2'>أولاً نطرح ٤ من الطرفين: <span class="math-eq"><span class="fraction"><span>٢</span><span class="frac-bar"></span><span>٣</span></span>س = -٢</span>. ثم نضرب الطرفين في مقلوب الكسر وهو <span class="math-eq"><span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span></span>. فيكون الحل <span class="math-eq">س = -٢ × <span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٢</span></span> = -٣</span>.</p>`
                    },
                    { 
                      type: 'mcq', 
                      level: '⭐⭐⭐', 
                      topic: 'distribution-equation', 
                      text: 'حل المعادلة: <span class="math-eq">٣(س - ٥) = ١٢</span>', 
                      options: [
                          { display: '<span class="math-eq">٩</span>', value: '٩' },
                          { display: '<span class="math-eq">-١</span>', value: '-١' },
                          { display: '<span class="math-eq">٥.٦</span>', value: '٥.٦' },
                          { display: '<span class="math-eq">٢٧</span>', value: '٢٧' }
                      ], 
                      correct: '٩', 
                      explanation: `<p class='mb-2'>أولاً نوزع الضرب على القوس: <span class="math-eq">٣س - ١٥ = ١٢</span>. ثم نضيف ١٥ للطرفين: <span class="math-eq">٣س = ٢٧</span>. أخيراً نقسم على ٣ لنجد أن <span class="math-eq">س = ٩</span>.</p>`
                    },
                    {
                      type: 'mcq',
                      level: '⭐⭐⭐',
                      topic: 'real-life',
                      text: 'اشترك أحمد في نادٍ رياضي برسوم تسجيل ٥٠ ريالاً واشتراك شهري ٢٥ ريالاً. إذا كانت التكلفة الإجمالية التي دفعها أحمد هي ٢٢٥ ريالاً، فما عدد الأشهر التي اشترك فيها؟',
                      options: [
                          { display: '٦ أشهر', value: '6' },
                          { display: '٧ أشهر', value: '7' },
                          { display: '٨ أشهر', value: '8' },
                          { display: '٩ أشهر', value: '9' }
                      ],
                      correct: '7',
                      explanation: `<p class='mb-2'>المعادلة هي: <span class='math-eq'>٢٥س + ٥٠ = ٢٢٥</span>، حيث س هو عدد الأشهر.</p><p>نطرح ٥٠ من الطرفين: <span class='math-eq'>٢٥س = ١٧٥</span>.</p><p>نقسم الطرفين على ٢٥: <span class='math-eq'>س = ٧</span>.</p><p>إذن، اشترك أحمد لمدة ٧ أشهر.</p>`
                    },
                    {
                      type: 'mcq',
                      level: '⭐⭐⭐',
                      topic: 'distribution-negative',
                      text: 'حل المعادلة: <span class="math-eq">-٢(س + ٣) = -١٤</span>',
                      options: [
                          { display: '<span class="math-eq">٤</span>', value: '4' },
                          { display: '<span class="math-eq">-١٠</span>', value: '-10' },
                          { display: '<span class="math-eq">٥</span>', value: '5' },
                          { display: '<span class="math-eq">-٥</span>', value: '-5' }
                      ],
                      correct: '4',
                      explanation: `<p class='mb-2'>أولاً، نوزع -٢ على القوس: <span class='math-eq'>-٢س - ٦ = -١٤</span>.</p><p>ثانياً، نضيف ٦ للطرفين: <span class='math-eq'>-٢س = -٨</span>.</p><p>ثالثاً، نقسم الطرفين على -٢: <span class='math-eq'>س = ٤</span>.</p>`
                    },
                    {
                      type: 'mcq',
                      level: '⭐⭐',
                      topic: 'fraction-equation',
                      text: 'حل المعادلة: <span class="math-eq">١٠ = <span class="fraction"><span>س</span><span class="frac-bar"></span><span>٤</span></span> + ٣</span>',
                      options: [
                          { display: '<span class="math-eq">٢٨</span>', value: '28' },
                          { display: '<span class="math-eq">٧</span>', value: '7' },
                          { display: '<span class="math-eq">١٣</span>', value: '13' },
                          { display: '<span class="math-eq">٥٢</span>', value: '52' }
                      ],
                      correct: '28',
                      explanation: `<p class='mb-2'>أولاً، نطرح ٣ من الطرفين: <span class='math-eq'>٧ = <span class="fraction"><span>س</span><span class="frac-bar"></span><span>٤</span></span></span>.</p><p>ثانياً، نضرب الطرفين في ٤ للتخلص من القسمة: <span class='math-eq'>٧ × ٤ = س</span>.</p><p>إذن، الحل هو <span class='math-eq'>س = ٢٨</span>.</p>`
                    },
                    {
                      type: 'mcq',
                      level: '⭐',
                      topic: 'multi-step',
                      text: 'حل المعادلة: <span class="math-eq">٧س - ١١ = -٤٦</span>',
                      options: [
                        { display: '<span class="math-eq">-٥</span>', value: '-5' },
                        { display: '<span class="math-eq">٥</span>', value: '5' },
                        { display: '<span class="math-eq">-٨</span>', value: '-8' },
                        { display: '<span class="math-eq">٨</span>', value: '8' }
                      ],
                      correct: '-5',
                      explanation: `<p class='mb-2'>أولاً، نضيف ١١ للطرفين: <span class='math-eq'>٧س = -٣٥</span>.</p><p>ثانياً، نقسم الطرفين على ٧: <span class='math-eq'>س = -٥</span>.</p>`
                    }
                ];
                return [...questionBank].sort(() => Math.random() - 0.5).slice(0, 5);
            }  },
        'c1_l4': {
            title: 'الدرس ١-٤: حل المعادلات التي تحتوي متغيراً في طرفيها',
            content: `
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفهوم الأساسي</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                        <p>لحل معادلة تحتوي متغيراً في طرفيها، هدفنا هو <strong class="text-red-600">جمع حدود المتغيرات في طرف، والأعداد الثابتة في الطرف الآخر</strong>، ثم نحل المعادلة كما تعلمنا في الدروس السابقة.</p>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: حل معادلات بسيطة</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:items-start">
                        <!-- Example 1 -->
                        <div class="p-6 bg-gray-50 rounded-lg interactive-example flex flex-col">
                            <p class="text-lg font-semibold mb-4 text-center">مثال ١: حل المعادلة <span class="math-eq">٧س + ١٢ = ٣س - ٤</span></p>
                            <div class="steps-container space-y-4 flex-grow">
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 1: جمع المتغيرات</h4><p>نطرح <span class="math-eq">٣س</span> من كلا الطرفين.</p><div class="math-steps text-center mt-2 space-y-1"><div class="math-eq">٧س <span class="highlight-change">- ٣س</span> + ١٢ = ٣س <span class="highlight-change">- ٣س</span> - ٤</div><div class="math-eq">٤س + ١٢ = -٤</div></div></div>
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 2: جمع الثوابت</h4><p>نطرح <span class="math-eq">١٢</span> من كلا الطرفين.</p><div class="math-steps text-center mt-2 space-y-1"><div class="math-eq">٤س + ١٢ <span class="highlight-change">- ١٢</span> = -٤ <span class="highlight-change">- ١٢</span></div><div class="math-eq">٤س = -١٦</div></div></div>
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 3: عزل المتغير</h4><p>نقسم كلا الطرفين على <span class="math-eq">٤</span>.</p><div class="math-eq text-center mt-2 flex justify-center items-center"><span class="fraction"><span>٤س</span><span class="frac-bar"></span><span>٤</span></span> = <span class="fraction"><span>-١٦</span><span class="frac-bar"></span><span>٤</span></span></div></div>
                                <div class="step-box hidden p-4 bg-green-100 rounded-lg border-green-500"><h4 class="font-bold">الخطوة 4: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">س = -٤</span>.</p></div>
                            </div>
                            <div class="flex justify-center items-center space-x-4 mt-4">
                                <button class="prev-btn control-btn bg-gray-300 text-gray-700 font-bold py-2 px-6 rounded-lg transition-colors duration-200">السابق</button>
                                <div class="step-counter text-gray-600 font-semibold w-24 text-center"></div>
                                <button class="next-btn control-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-200">التالي</button>
                            </div>
                        </div>
                        <!-- Example 2 -->
                        <div class="p-6 bg-gray-50 rounded-lg interactive-example flex flex-col">
                            <p class="text-lg font-semibold mb-4 text-center">مثال ٢: حل المعادلة <span class="math-eq">٢ك + ٨ = ٥ك + ٢</span></p>
                               <div class="steps-container space-y-4 flex-grow">
                                    <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 1: جمع المتغيرات</h4><p>نطرح <span class="math-eq">٢ك</span> من كلا الطرفين.</p><div class="math-steps text-center mt-2 space-y-1"><div class="math-eq">٢ك <span class="highlight-change">- ٢ك</span> + ٨ = ٥ك <span class="highlight-change">- ٢ك</span> + ٢</div><div class="math-eq">٨ = ٣ك + ٢</div></div></div>
                                    <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 2: جمع الثوابت</h4><p>نطرح <span class="math-eq">٢</span> من كلا الطرفين.</p><div class="math-steps text-center mt-2 space-y-1"><div class="math-eq">٨ <span class="highlight-change">- ٢</span> = ٣ك + ٢ <span class="highlight-change">- ٢</span></div><div class="math-eq">٦ = ٣ك</div></div></div>
                                    <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 3: عزل المتغير</h4><p>نقسم كلا الطرفين على <span class="math-eq">٣</span>.</p><div class="math-eq text-center mt-2 flex justify-center items-center"><span class="fraction"><span>٦</span><span class="frac-bar"></span><span>٣</span></span> = <span class="fraction"><span>٣ك</span><span class="frac-bar"></span><span>٣</span></span></div></div>
                                    <div class="step-box hidden p-4 bg-green-100 rounded-lg border-green-500"><h4 class="font-bold">الخطوة 4: الحل النهائي</h4><p>نبسط المعادلة لنجد الحل: <span class="math-eq">٢ = ك</span>.</p></div>
                                </div>
                            <div class="flex justify-center items-center space-x-4 mt-4">
                                <button class="prev-btn control-btn bg-gray-300 text-gray-700 font-bold py-2 px-6 rounded-lg transition-colors duration-200">السابق</button>
                                <div class="step-counter text-gray-600 font-semibold w-24 text-center"></div>
                                <button class="next-btn control-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-200">التالي</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثالثاً: معادلات خاصة (المتطابقة والمستحيلة)</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:items-start">
                        <!-- Example 3 -->
                        <div class="p-6 bg-gray-50 rounded-lg interactive-example flex flex-col">
                            <p class="text-lg font-semibold mb-4 text-center">مثال ٣ (متطابقة): حل <span class="math-eq">٦(ن + ٤) = ٢(١٢ + ٣ن)</span></p>
                            <div class="steps-container space-y-4 flex-grow">
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 1: فك الأقواس</h4><p>نوزع الضرب على الجمع في كلا الطرفين.</p><p class="math-eq text-center mt-2">٦ن + ٢٤ = ٢٤ + ٦ن</p></div>
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 2: تحليل المعادلة</h4><p>لاحظ أن الطرف الأيمن للمعادلة يطابق الطرف الأيسر تماماً.</p></div>
                                <div class="step-box hidden p-4 bg-green-100 rounded-lg border-green-500"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>هذا يعني أن المعادلة صحيحة دائماً <strong class="text-red-600">لأي قيمة</strong> للمتغير <span class="math-eq">ن</span>. مجموعة الحل هي <span class="vocab-term">جميع الأعداد الحقيقية</span>.</p></div>
                            </div>
                            <div class="flex justify-center items-center space-x-4 mt-4">
                                <button class="prev-btn control-btn bg-gray-300 text-gray-700 font-bold py-2 px-6 rounded-lg transition-colors duration-200">السابق</button>
                                <div class="step-counter text-gray-600 font-semibold w-24 text-center"></div>
                                <button class="next-btn control-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-200">التالي</button>
                            </div>
                        </div>
                        <!-- Example 4 -->
                        <div class="p-6 bg-gray-50 rounded-lg interactive-example flex flex-col">
                            <p class="text-lg font-semibold mb-4 text-center">مثال ٤ (مستحيلة الحل): حل <span class="math-eq">٣(٢م - ١) = ٦م + ٥</span></p>
                            <div class="steps-container space-y-4 flex-grow">
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 1: فك الأقواس</h4><p>نوزع الضرب على الجمع في الطرف الأيمن.</p><p class="math-eq text-center mt-2">٦م - ٣ = ٦م + ٥</p></div>
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 2: جمع المتغيرات</h4><p>نطرح <span class="math-eq">٦م</span> من كلا الطرفين.</p><div class="math-steps text-center mt-2 space-y-1"><div class="math-eq">٦م <span class="highlight-change">- ٦م</span> - ٣ = ٦م <span class="highlight-change">- ٦م</span> + ٥</div><div class="math-eq">-٣ = ٥</div></div></div>
                                <div class="step-box hidden p-4 bg-red-100 rounded-lg border-red-500"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>العبارة الناتجة <strong class="text-red-600">خاطئة دائماً</strong>. هذا يعني أنه لا توجد قيمة للمتغير <span class="math-eq">م</span> تجعل المعادلة صحيحة. مجموعة الحل هي <span class="vocab-term">المجموعة الخالية (∅)</span>.</p></div>
                            </div>
                            <div class="flex justify-center items-center space-x-4 mt-4">
                                <button class="prev-btn control-btn bg-gray-300 text-gray-700 font-bold py-2 px-6 rounded-lg transition-colors duration-200">السابق</button>
                                <div class="step-counter text-gray-600 font-semibold w-24 text-center"></div>
                                <button class="next-btn control-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-200">التالي</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 رابعاً: تطبيقات على نظرية الأعداد</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:items-start">
                        <!-- Example 5 -->
                        <div class="p-6 bg-gray-50 rounded-lg interactive-example flex flex-col">
                            <p class="text-lg font-semibold mb-4 text-center">مثال ٥</p>
                            <p class="text-center mb-4">عددان زوجيان متتاليان، يقل أربعة أمثال أصغرهما عن مثلي أكبرهما بمقدار ١٢. فما العددان؟</p>
                            <div class="steps-container space-y-4 flex-grow">
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 1: تحديد المتغيرات</h4><p>نفرض أن العدد الأصغر هو <span class="math-eq">ن</span>، والأكبر هو <span class="math-eq">ن + ٢</span>.</p></div>
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 2: كتابة المعادلة</h4><p class="math-eq text-center mt-2">٤ن = ٢(ن + ٢) - ١٢</p></div>
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 3: حل المعادلة</h4><div class="text-sm space-y-2"><p>أولاً، نفك القوس: <span class="math-eq">٤ن = ٢ن + ٤ - ١٢</span></p><p>ثانياً، نبسط: <span class="math-eq">٤ن = ٢ن - ٨</span></p><p>ثالثاً، نطرح <span class="math-eq">٢ن</span>: <span class="math-eq">٢ن = -٨</span></p><p>أخيراً، نقسم على <span class="math-eq">٢</span>: <span class="math-eq">ن = -٤</span></p></div></div>
                                <div class="step-box hidden p-4 bg-green-100 rounded-lg border-green-500"><h4 class="font-bold">الخطوة 4: الحل النهائي</h4><p>العدد الأصغر هو <span class="math-eq">-٤</span>، والأكبر هو <span class="math-eq">-٢</span>.</p></div>
                            </div>
                            <div class="flex justify-center items-center space-x-4 mt-4">
                                <button class="prev-btn control-btn bg-gray-300 text-gray-700 font-bold py-2 px-6 rounded-lg transition-colors duration-200">السابق</button>
                                <div class="step-counter text-gray-600 font-semibold w-24 text-center"></div>
                                <button class="next-btn control-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-200">التالي</button>
                            </div>
                        </div>
                        <!-- Example 6 -->
                        <div class="p-6 bg-gray-50 rounded-lg interactive-example flex flex-col">
                            <p class="text-lg font-semibold mb-4 text-center">مثال ٦</p>
                            <p class="text-center mb-4">عمر أحمد يزيد ٦ سنوات عن عمر أخيه علي. بعد ٤ سنوات، سيصبح مجموع عمريهما ٤٠ سنة. فما عمر كل منهما الآن؟</p>
                            <div class="steps-container space-y-4 flex-grow">
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 1: تحديد المتغيرات</h4><div class="math-steps space-y-1"><p>عمر علي الآن = <span class="math-eq">س</span></p><p>عمر أحمد الآن = <span class="math-eq">س + ٦</span></p></div></div>
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 2: كتابة المعادلة</h4><p>عمر علي بعد ٤ سنوات: <span class="math-eq">س + ٤</span></p><p>عمر أحمد بعد ٤ سنوات: <span class="math-eq">(س + ٦) + ٤</span></p><p class="math-eq text-center mt-2">(س + ٤) + (س + ١٠) = ٤٠</p></div>
                                <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 3: حل المعادلة</h4><div class="text-sm space-y-2"><p>أولاً، نجمع الحدود المتشابهة: <span class="math-eq">٢س + ١٤ = ٤٠</span></p><p>ثانياً، نطرح <span class="math-eq">١٤</span>: <span class="math-eq">٢س = ٢٦</span></p><p>أخيراً، نقسم على <span class="math-eq">٢</span>: <span class="math-eq">س = ١٣</span></p></div></div>
                                <div class="step-box hidden p-4 bg-green-100 rounded-lg border-green-500"><h4 class="font-bold">الخطوة 4: الحل النهائي</h4><p>عمر علي الآن <span class="math-eq">١٣</span> سنة، وعمر أحمد <span class="math-eq">١٩</span> سنة.</p></div>
                            </div>
                            <div class="flex justify-center items-center space-x-4 mt-4">
                                <button class="prev-btn control-btn bg-gray-300 text-gray-700 font-bold py-2 px-6 rounded-lg transition-colors duration-200">السابق</button>
                                <div class="step-counter text-gray-600 font-semibold w-24 text-center"></div>
                                <button class="next-btn control-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-200">التالي</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 خامساً: تطبيقات على الهندسة</h2>
                    <div class="p-6 bg-gray-50 rounded-lg interactive-example max-w-lg mx-auto flex flex-col">
                        <p class="text-lg font-semibold mb-4 text-center">مثال ٧</p>
                        <p class="text-center mb-2">أوجد قيمة <span class="math-eq">س</span> التي تجعل مساحتي المستطيلين متساويتين.</p>
                        <div class="flex justify-center my-2 space-x-4 space-x-reverse">
                            <div class="border-2 p-2 text-center text-sm">المستطيل أ<br>الطول: <span class="math-eq">١٢</span><br>العرض: <span class="math-eq">س</span></div>
                            <div class="border-2 p-2 text-center text-sm">المستطيل ب<br>الطول: <span class="math-eq">١٦</span><br>العرض: <span class="math-eq">س - ٢</span></div>
                        </div>
                        <div class="steps-container space-y-4 flex-grow">
                            <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 1: كتابة المعادلة</h4><p>مساحة أ = مساحة ب</p><p class="math-eq text-center mt-2">١٢س = ١٦(س - ٢)</p></div>
                            <div class="step-box hidden p-4 bg-white rounded-lg"><h4 class="font-bold">الخطوة 2: حل المعادلة</h4><div class="text-sm space-y-2"><p>أولاً، نفك القوس: <span class="math-eq">١٢س = ١٦س - ٣٢</span></p><p>ثانياً، نطرح <span class="math-eq">١٦س</span> من الطرفين: <span class="math-eq">١٢س <span class="highlight-change">- ١٦س</span> = ١٦س - ٣٢ <span class="highlight-change">- ١٦س</span></span></p><p>نبسط: <span class="math-eq">-٤س = -٣٢</span></p><p>أخيراً، نقسم على <span class="math-eq">-٤</span>: <span class="math-eq flex justify-center items-center"><span class="fraction"><span>-٤س</span><span class="frac-bar"></span><span>-٤</span></span> = <span class="fraction"><span>-٣٢</span><span class="frac-bar"></span><span>-٤</span></span></span></p></div></div>
                            <div class="step-box hidden p-4 bg-green-100 rounded-lg border-green-500"><h4 class="font-bold">الخطوة 3: الحل النهائي</h4><p>قيمة <span class="math-eq">س</span> هي <span class="math-eq">٨</span>.</p></div>
                        </div>
                        <div class="flex justify-center items-center space-x-4 mt-4">
                            <button class="prev-btn control-btn bg-gray-300 text-gray-700 font-bold py-2 px-6 rounded-lg transition-colors duration-200">السابق</button>
                            <div class="step-counter text-gray-600 font-semibold w-24 text-center"></div>
                            <button class="next-btn control-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-200">التالي</button>
                        </div>
                    </div>
                </section>
            `, 
            generateQuiz: () => {
                const questionBank = [
                    { 
                      id: 'number-theory-equation',
                      type: 'mcq', 
                      level: '⭐⭐⭐', 
                      topic: 'word-to-equation', 
                      text: 'عددان فرديان متتاليان، يقل مثلي أصغرهما عن ثلاثة أمثال أكبرهما بمقدار ٩. أي المعادلات التالية تمثل هذه المسألة؟ (افرض أن أصغر عدد هو ن)', 
                      options: [ 
                          { display: '<span class="math-eq">٢ن = ٣(ن+٢) - ٩</span>', value: '2n = 3(n+2) - 9' }, 
                          { display: '<span class="math-eq">٣ن = ٢(ن+٢) + ٩</span>', value: '3n = 2(n+2) + 9' }, 
                          { display: '<span class="math-eq">٢ن = ٣(ن+١) - ٩</span>', value: '2n = 3(n+1) - 9' }, 
                          { display: '<span class="math-eq">٢ن = ٣ن + ٢ - ٩</span>', value: '2n = 3n+2-9' } 
                      ], 
                      correct: '2n = 3(n+2) - 9', 
                      explanation: `<p class='mb-2'>لترجمة المسألة، نفككها كالتالي:</p>
                                      <ul class='list-disc list-inside text-right space-y-1'>
                                        <li>العدد الفردي الأصغر: <span class='math-eq'>ن</span></li>
                                        <li>العدد الفردي الأكبر (التالي له): <span class='math-eq'>ن + ٢</span></li>
                                        <li>"مثلي أصغرهما": <span class='math-eq'>٢ن</span></li>
                                        <li>"ثلاثة أمثال أكبرهما": <span class='math-eq'>٣(ن + ٢)</span></li>
                                        <li>عبارة "يقل عن ... بمقدار ٩" تعني أن الطرف الأول يساوي الطرف الثاني مطروحاً منه ٩.</li>
                                      </ul>
                                      <p class='mt-3 p-2 bg-green-100 rounded-md'>إذن، المعادلة الصحيحة هي: <span class='math-eq'>٢ن = ٣(ن + ٢) - ٩</span>.</p>`
                    },
                    { 
                      id: 'number-theory-equation-2',
                      type: 'mcq', 
                      level: '⭐⭐⭐', 
                      topic: 'word-to-equation', 
                      text: 'عددان زوجيان متتاليان، يقل خمسة أمثال أكبرهما عن سبعة أمثال أصغرهما بمقدار ٤. أي المعادلات التالية تمثل هذه المسألة؟ (افرض أن أصغر عدد هو ن)', 
                      options: [ 
                          { display: '<span class="math-eq">٥(ن+٢) = ٧ن - ٤</span>', value: '5(n+2) = 7n - 4' }, 
                          { display: '<span class="math-eq">٥(ن+٢) + ٤ = ٧ن</span>', value: '5(n+2) + 4 = 7n' }, 
                          { display: '<span class="math-eq">٧ن = ٥(ن+٢) - ٤</span>', value: '7n = 5(n+2) - 4' }, 
                          { display: '<span class="math-eq">٥ن = ٧(ن+٢) - ٤</span>', value: '5n = 7(n+2) - 4' } 
                      ], 
                      correct: '5(n+2) = 7n - 4', 
                      explanation: `<p class='mb-2'>لترجمة المسألة، نفككها كالتالي:</p>
                                      <ul class='list-disc list-inside text-right space-y-1'>
                                        <li>العدد الزوجي الأصغر: <span class='math-eq'>ن</span></li>
                                        <li>العدد الزوجي الأكبر (التالي له): <span class='math-eq'>ن + ٢</span></li>
                                        <li>"خمسة أمثال أكبرهما": <span class='math-eq'>٥(ن + ٢)</span></li>
                                        <li>"سبعة أمثال أصغرهما": <span class='math-eq'>٧ن</span></li>
                                        <li>عبارة "يقل ... عن ... بمقدار ٤" تعني أن الطرف الأول (خمسة أمثال أكبرهما) يساوي الطرف الثاني (سبعة أمثال أصغرهما) مطروحاً منه ٤.</li>
                                      </ul>
                                      <p class='mt-3 p-2 bg-green-100 rounded-md'>إذن، المعادلة الصحيحة هي: <span class='math-eq'>٥(ن + ٢) = ٧ن - ٤</span>.</p>`
                    },
                    { type: 'mcq', level: '⭐', topic: 'both-sides', text: 'حل المعادلة: <span class="math-eq">٥س + ٢ = ٢س + ١٤</span>', 
                      options: [ { display: '<span class="math-eq">٤</span>', value: '٤' }, { display: '<span class="math-eq">٦</span>', value: '٦' }, { display: '<span class="math-eq">٣</span>', value: '٣' }, { display: '<span class="math-eq">١٢</span>', value: '١٢' } ], 
                      correct: '٤', 
                      explanation: `<p class='mb-2'>نجمع المتغيرات في طرف والثوابت في الطرف الآخر.</p><div class='text-right space-y-2'><p>أولاً: نطرح ٢س من الطرفين: <span class='math-eq'>٥س <span class='highlight-change'>- ٢س</span> + ٢ = ٢س <span class='highlight-change'>- ٢س</span> + ١٤</span></p><p>ثانياً: نبسط: <span class='math-eq'>٣س + ٢ = ١٤</span></p><p>ثالثاً: نطرح ٢ من الطرفين: <span class='math-eq'>٣س + ٢ <span class='highlight-change'>- ٢</span> = ١٤ <span class='highlight-change'>- ٢</span></span></p><p>رابعاً: نبسط: <span class='math-eq'>٣س = ١٢</span></p><p>خامساً: نقسم الطرفين على ٣: <span class='math-eq flex justify-center items-center'><span class="fraction"><span>٣س</span><span class="frac-bar"></span><span>٣</span></span> = <span class="fraction"><span>١٢</span><span class="frac-bar"></span><span>٣</span></span></span></p><p>الحل: <span class='math-eq'>س = ٤</span></p></div>` 
                    },
                    { type: 'mcq', level: '⭐⭐', topic: 'parentheses', text: 'حل المعادلة: <span class="math-eq">٣(ك - ٥) = ٢(ك + ١)</span>', 
                      options: [ { display: '<span class="math-eq">١٧</span>', value: '١٧' }, { display: '<span class="math-eq">-١٣</span>', value: '-١٣' }, { display: '<span class="math-eq">١٦</span>', value: '١٦' }, { display: '<span class="math-eq">٤</span>', value: '٤' } ], 
                      correct: '١٧', 
                      explanation: `<p class='mb-2'>نستخدم خاصية التوزيع أولاً.</p><div class='text-right space-y-2'><p>أولاً: فك الأقواس: <span class='math-eq'>٣ك - ١٥ = ٢ك + ٢</span></p><p>ثانياً: نطرح ٢ك من الطرفين: <span class='math-eq'>٣ك <span class='highlight-change'>- ٢ك</span> - ١٥ = ٢ك <span class='highlight-change'>- ٢ك</span> + ٢</span></p><p>ثالثاً: نبسط: <span class='math-eq'>ك - ١٥ = ٢</span></p><p>رابعاً: نضيف ١٥ للطرفين: <span class='math-eq'>ك - ١٥ <span class='highlight-change'>+ ١٥</span> = ٢ <span class='highlight-change'>+ ١٥</span></span></p><p>خامساً: الحل النهائي: <span class='math-eq'>ك = ١٧</span></p></div>` 
                    },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'no-solution', text: 'ما هو حل المعادلة: <span class="math-eq">٨ + ٤م = ٤م - ١</span>؟', 
                      options: [ { display: '<span class="math-eq">م = ٢</span>', value: '2' }, { display: '<span class="math-eq">جميع الأعداد الحقيقية</span>', value: 'all' }, { display: '<span class="math-eq">مستحيلة الحل (∅)</span>', value: 'none' }, { display: '<span class="math-eq">م = -٢</span>', value: '-2' } ], 
                      correct: 'none', 
                      explanation: `<p class='mb-2'>نحاول جمع المتغيرات في طرف.</p><div class='text-right space-y-2'><p>المعادلة: <span class='math-eq'>٨ + ٤م = ٤م - ١</span></p><p>نطرح ٤م من الطرفين: <span class='math-eq'>٨ + ٤م <span class='highlight-change'>- ٤م</span> = ٤م - ١ <span class='highlight-change'>- ٤م</span></span></p><p>نبسط لنجد: <span class='math-eq'>٨ = -١</span></p><p class='mt-2 p-2 bg-red-100 rounded-md'>بما أن العبارة "٨ = -١" خاطئة دائماً، فهذه المعادلة ليس لها حل. وتسمى معادلة مستحيلة الحل.</p></div>` 
                    },
                    { type: 'mcq', level: '⭐⭐', topic: 'fractions', text: 'حل المعادلة: <span class="math-eq flex justify-center items-center"><span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span>ع - ٤ = <span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٤</span></span>ع</span>', 
                      options: [ { display: '<span class="math-eq">ع = ١٦</span>', value: '16' }, { display: '<span class="math-eq">ع = -١٦</span>', value: '-16' }, { display: '<span class="math-eq">ع = ٨</span>', value: '8' }, { display: '<span class="math-eq">ع = -٨</span>', value: '-8' } ], 
                      correct: '-16', 
                      explanation: `<p class='mb-2'>للتخلص من الكسور، نضرب طرفي المعادلة في المضاعف المشترك الأصغر للمقامات (وهو ٤).</p><div class='text-right space-y-2'><p>المعادلة: <span class='math-eq'>٤ × (<span class="fraction"><span>١</span><span class="frac-bar"></span><span>٢</span></span>ع - ٤ ) = ٤ × ( <span class="fraction"><span>٣</span><span class="frac-bar"></span><span>٤</span></span>ع )</span></p><p>نوزع الضرب: <span class='math-eq'>٢ع - ١٦ = ٣ع</span></p><p>نطرح ٢ع من الطرفين: <span class='math-eq'>٢ع <span class='highlight-change'>- ٢ع</span> - ١٦ = ٣ع <span class='highlight-change'>- ٢ع</span></span></p><p>نبسط: <span class='math-eq'>-١٦ = ع</span></p></div>` 
                    },
                    { type: 'mcq', level: '⭐⭐', topic: 'parentheses-2', text: 'حل المعادلة: <span class="math-eq">٧(أ - ٢) = ٤(أ + ١)</span>', 
                      options: [ { display: '<span class="math-eq">أ = ٦</span>', value: '6' }, { display: '<span class="math-eq">أ = -٦</span>', value: '-6' }, { display: '<span class="math-eq">أ = ٣</span>', value: '3' }, { display: '<span class="math-eq">أ = ١٨</span>', value: '18' } ], 
                      correct: '6', 
                      explanation: `<p class='mb-2'>نبدأ بفك الأقواس في الطرفين.</p><div class='text-right space-y-2'><p>المعادلة: <span class='math-eq'>٧أ - ١٤ = ٤أ + ٤</span></p><p>نطرح ٤أ من الطرفين: <span class='math-eq'>٣أ - ١٤ = ٤</span></p><p>نضيف ١٤ للطرفين: <span class='math-eq'>٣أ = ١٨</span></p><p>نقسم الطرفين على ٣: <span class='math-eq flex justify-center items-center'><span class="fraction"><span>٣أ</span><span class="frac-bar"></span><span>٣</span></span> = <span class="fraction"><span>١٨</span><span class="frac-bar"></span><span>٣</span></span></span></p><p>الحل: <span class='math-eq'>أ = ٦</span></p></div>` 
                    },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'identity', text: 'ما هو حل المعادلة: <span class="math-eq">٣(٢ب - ١) - ٥ = ٦ب - ٨</span>؟', 
                      options: [ { display: '<span class="math-eq">ب = ١</span>', value: '1' }, { display: '<span class="math-eq">جميع الأعداد الحقيقية</span>', value: 'all' }, { display: '<span class="math-eq">مستحيلة الحل (∅)</span>', value: 'none' }, { display: '<span class="math-eq">ب = ٠</span>', value: '0' } ], 
                      correct: 'all', 
                      explanation: `<p class='mb-2'>نبدأ بفك القوس وتبسيط الطرف الأيسر.</p><div class='text-right space-y-2'><p>المعادلة: <span class='math-eq'>٣(٢ب - ١) - ٥ = ٦ب - ٨</span></p><p>نفك القوس: <span class='math-eq'>٦ب - ٣ - ٥ = ٦ب - ٨</span></p><p>نبسط الطرف الأيسر: <span class='math-eq'>٦ب - ٨ = ٦ب - ٨</span></p><p class='mt-2 p-2 bg-green-100 rounded-md'>بما أن الطرفين متطابقان، فالمعادلة صحيحة لأي قيمة للمتغير ب. هذه المعادلة هي متطابقة.</p></div>`
                    },
                    { type: 'mcq', level: '⭐', topic: 'simple-negatives', text: 'حل المعادلة: <span class="math-eq">٣ - ٤س = ١٨ + س</span>', 
                      options: [ { display: '<span class="math-eq">-٣</span>', value: '-3' }, { display: '<span class="math-eq">٣</span>', value: '3' }, { display: '<span class="math-eq">-٥</span>', value: '-5' }, { display: '<span class="math-eq">٧</span>', value: '7' } ], 
                      correct: '-3', 
                      explanation: `<p class='mb-2'>نجمع المتغيرات في طرف والثوابت في الطرف الآخر.</p><div class='text-right space-y-2'><p>نضيف ٤س للطرفين: <span class='math-eq'>٣ - ٤س <span class='highlight-change'>+ ٤س</span> = ١٨ + س <span class='highlight-change'>+ ٤س</span></span></p><p>نبسط: <span class='math-eq'>٣ = ١٨ + ٥س</span></p><p>نطرح ١٨ من الطرفين: <span class='math-eq'>٣ <span class='highlight-change'>- ١٨</span> = ١٨ + ٥س <span class='highlight-change'>- ١٨</span></span></p><p>نبسط: <span class='math-eq'>-١٥ = ٥س</span></p><p>نقسم على ٥: <span class='math-eq'>-٣ = س</span></p></div>` 
                    },
                    { type: 'mcq', level: '⭐⭐', topic: 'parentheses-negatives', text: 'حل المعادلة: <span class="math-eq">٢(ص - ٦) = ٣(ص - ٤)</span>', 
                      options: [ { display: '<span class="math-eq">ص = ٠</span>', value: '0' }, { display: '<span class="math-eq">ص = ٢٤</span>', value: '24' }, { display: '<span class="math-eq">ص = -٢٤</span>', value: '-24' }, { display: '<span class="math-eq">ص = ٤</span>', value: '4' } ], 
                      correct: '0', 
                      explanation: `<p class='mb-2'>نبدأ بفك الأقواس.</p><div class='text-right space-y-2'><p>المعادلة: <span class='math-eq'>٢ص - ١٢ = ٣ص - ١٢</span></p><p>نطرح ٢ص من الطرفين: <span class='math-eq'>-١٢ = ص - ١٢</span></p><p>نضيف ١٢ للطرفين: <span class='math-eq'>-١٢ <span class='highlight-change'>+ ١٢</span> = ص - ١٢ <span class='highlight-change'>+ ١٢</span></span></p><p>الحل: <span class='math-eq'>٠ = ص</span></p></div>` 
                    },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'geometry-perimeter', text: 'مستطيل ومربع لهما نفس المحيط. طول المستطيل ١٠ سم وعرضه (س) سم. طول ضلع المربع (س+٢) سم. ما قيمة س؟', 
                      options: [ { display: '<span class="math-eq">س = ٦</span>', value: '6' }, { display: '<span class="math-eq">س = ٤</span>', value: '4' }, { display: '<span class="math-eq">س = ٨</span>', value: '8' }, { display: '<span class="math-eq">س = ١٢</span>', value: '12' } ], 
                      correct: '6', 
                      explanation: `<p class='mb-2'>محيط المستطيل = ٢(الطول + العرض). محيط المربع = ٤ × طول الضلع.</p><div class='text-right space-y-2'><p>محيط المستطيل: <span class='math-eq'>٢(١٠ + س)</span></p><p>محيط المربع: <span class='math-eq'>٤(س + ٢)</span></p><p>المعادلة: <span class='math-eq'>٢(١٠ + س) = ٤(س + ٢)</span></p><p>نفك الأقواس: <span class='math-eq'>٢٠ + ٢س = ٤س + ٨</span></p><p>نطرح ٢س: <span class='math-eq'>٢٠ = ٢س + ٨</span></p><p>نطرح ٨: <span class='math-eq'>١٢ = ٢س</span></p><p>نقسم على ٢: <span class='math-eq'>٦ = س</span></p></div>` 
                    },
                    { type: 'mcq', level: '⭐⭐', topic: 'decimals-2', text: 'حل المعادلة: <span class="math-eq">١.٥ك + ٩ = ٣ك</span>', 
                      options: [ { display: '<span class="math-eq">ك = ٦</span>', value: '6' }, { display: '<span class="math-eq">ك = ٣</span>', value: '3' }, { display: '<span class="math-eq">ك = -٦</span>', value: '-6' }, { display: '<span class="math-eq">ك = ٤.٥</span>', value: '4.5' } ], 
                      correct: '6', 
                      explanation: `<p class='mb-2'>نجمع المتغيرات في طرف.</p><div class='text-right space-y-2'><p>نطرح ١.٥ك من الطرفين: <span class='math-eq'>١.٥ك <span class='highlight-change'>- ١.٥ك</span> + ٩ = ٣ك <span class='highlight-change'>- ١.٥ك</span></span></p><p>نبسط: <span class='math-eq'>٩ = ١.٥ك</span></p><p>نقسم الطرفين على ١.٥: <span class='math-eq flex justify-center items-center'><span class="fraction"><span>٩</span><span class="frac-bar"></span><span>١.٥</span></span> = <span class="fraction"><span>١.٥ك</span><span class="frac-bar"></span><span>١.٥</span></span></span></p><p>الحل: <span class='math-eq'>٦ = ك</span></p></div>` 
                    }
                ];
                return [...questionBank].sort(() => Math.random() - 0.5).slice(0, 5);
            }
        },
        'c1_l5': {
            title: 'الدرس ١-٥: حل المعادلات التي تتضمن القيمة المطلقة',
            content:`<section class="mb-12">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: مفهوم القيمة المطلقة</h2>
                <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                    <p>القيمة المطلقة لعدد هي المسافة بين ذلك العدد والصفر على خط الأعداد. وبما أنها مسافة، فهي <strong class="text-red-600">دائماً موجبة أو صفر</strong>.</p>
                    <div class="text-center">
                        <p>نرمز للقيمة المطلقة بالرمز <span class="math-eq">| |</span>. مثال:</p>
                        <p class="math-block">| -٥ | = ٥</p>
                        <p class="math-block">| ٥ | = ٥</p>
                    </div>
                </div>
            </section>
            <section class="mb-12">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="text-3xl ml-2">🚀</span> ثانياً: أمثلة تفاعلية
                </h2>
                <div class="space-y-8">
                    <!-- Part A -->
                    <div>
                        <h3 class="text-xl font-bold text-gray-700 mb-2">أ) حساب قيمة عبارات القيمة المطلقة</h3>
                        <div class="p-4 bg-indigo-50 rounded-lg mb-4">
                            <p class="font-semibold text-center text-indigo-800">احسب قيمة كل عبارة، إذا كانت: <span class="math-eq">ف = -٣</span>، <span class="math-eq">هـ = ٥</span>، <span class="math-eq">د = -٤</span></p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div id="eval-ex1" class="interactive-card"></div>
                            <div id="eval-ex2" class="interactive-card"></div>
                            <div id="eval-ex3" class="interactive-card"></div>
                            <div id="eval-ex4" class="interactive-card"></div>
                        </div>
                    </div>
                    <!-- Part B -->
                    <div>
                        <h3 class="text-xl font-bold text-gray-700 mb-4">ب) حل معادلات القيمة المطلقة</h3>
                        <div class="grid grid-cols-1 gap-8">
                            <div id="solve-ex1" class="interactive-card"></div>
                            <div id="solve-ex2" class="interactive-card"></div>
                        </div>
                    </div>
                    <!-- Part C -->
                    <div>
                        <h3 class="text-xl font-bold text-gray-700 mb-4">ج) كتابة معادلة القيمة المطلقة</h3>
                        <div class="grid grid-cols-1">
                            <div id="write-ex1" class="interactive-card"></div>
                        </div>
                    </div>
                </div>
            </section>`, 
            generateQuiz: () => {
                const questionBank = [
                    { type: 'mcq', level: '⭐', topic: 'evaluate', text: 'إذا كانت <span class="math-eq">ف = -٣</span>، <span class="math-eq">د = -٤</span>، فما قيمة <span class="math-eq">| ف + د |</span>؟', options: [ { display: '<span class="math-eq">٧</span>', value: '7' }, { display: '<span class="math-eq">-٧</span>', value: '-7' }, { display: '<span class="math-eq">١</span>', value: '1' }, { display: '<span class="math-eq">-١</span>', value: '-1' } ], correct: '7', explanation: `<p class='mb-2'>نعوض عن المتغيرات بقيمها.</p><div class='text-right space-y-2'><p>أولاً: <span class='math-block'>| (-٣) + (-٤) |</span></p><p>ثانياً: <span class='math-block'>| -٧ | = ٧</span></p></div>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'solve', text: 'حل المعادلة: <span class="math-block">| ف + ٥ | = ١٧</span>', options: [ { display: '<span class="math-eq">{١٢}</span>', value: '{12}' }, { display: '<span class="math-eq">{١٢, -٢٢}</span>', value: '{12, -22}' }, { display: '<span class="math-eq">{-١٢, ٢٢}</span>', value: '{-12, 22}' }, { display: '<span class="math-eq">{٢٢}</span>', value: '{22}' } ], correct: '{12, -22}', explanation: `<p class='mb-2'>نفصل المعادلة إلى حالتين لأن ما بداخل القيمة المطلقة يمكن أن يكون موجباً أو سالباً:</p><div class='grid grid-cols-1 md:grid-cols-2 gap-2 text-center mt-2'><div class='space-y-1 p-2 bg-gray-100 rounded'><p class='font-bold'>الحالة الأولى (موجب)</p><p class='math-block'>ف + ٥ = ١٧</p><p>نطرح ٥ من الطرفين:</p><p class='math-block'>ف = ١٧ - ٥</p><p class='math-block'>ف = ١٢</p></div><div class='space-y-1 p-2 bg-gray-100 rounded'><p class='font-bold'>الحالة الثانية (سالب)</p><p class='math-block'>ف + ٥ = -١٧</p><p>نطرح ٥ من الطرفين:</p><p class='math-block'>ف = -١٧ - ٥</p><p class='math-block'>ف = -٢٢</p></div></div><p class='mt-3 p-2 bg-green-100 rounded-md text-center'>إذن، مجموعة الحل هي {١٢، -٢٢}.</p>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'no-solution', text: 'حل المعادلة: <span class="math-block">| ٢س - ٣ | = -١١</span>', options: [ { display: '<span class="math-eq">{٧, -٤}</span>', value: '{7, -4}' }, { display: '<span class="math-eq">{-٧, ٤}</span>', value: '{-7, 4}' }, { display: '<span class="math-eq">مجموعة خالية (∅)</span>', value: '∅' }, { display: '<span class="math-eq">{٧}</span>', value: '{7}' } ], correct: '∅', explanation: `<p class='mb-2'>القيمة المطلقة لا يمكن أن تساوي عدداً سالباً أبداً، لأنها تمثل مسافة.</p><p class='mt-2 p-2 bg-yellow-100 rounded-md'>لذلك، لا يوجد حل لهذه المعادلة، ومجموعة الحل هي المجموعة الخالية (∅).</p></div>` },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'writing', text: 'اكتب معادلة تتضمن قيمة مطلقة للتمثيل الذي نقطة منتصفه <span class="math-eq">٢٧</span> والمسافة من المنتصف لكل طرف هي <span class="math-eq">٢</span>.', options: [ { display: '<span class="math-eq">|س - ٢| = ٢٧</span>', value: '|س - 2| = 27' }, { display: '<span class="math-eq">|س + ٢٧| = ٢</span>', value: '|س + 27| = 2' }, { display: '<span class="math-eq">|س - ٢٧| = ٢</span>', value: '|س - 27| = 2' }, { display: '<span class="math-eq">|س + ٢| = ٢٧</span>', value: '|س + 2| = 27' } ], correct: '|س - 27| = 2', explanation: `<p class='mb-2'>الصيغة العامة هي: |المتغير - نقطة المنتصف| = المسافة.</p><div class='text-right space-y-2'><p>نقطة المنتصف = ٢٧</p><p>المسافة = ٢</p><p class='mt-2 p-2 bg-green-100 rounded-md'>إذن، المعادلة هي: |س - ٢٧| = ٢</p></div>` },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'writing-from-graph', text: 'اكتب معادلة القيمة المطلقة للتمثيل البياني التالي:', options: [ { display: '<span class="math-eq">|س - ٦| = ٤</span>', value: '|س - 6| = 4' }, { display: '<span class="math-eq">|س - ٤| = ٦</span>', value: '|س - 4| = 6' }, { display: '<span class="math-eq">|س + ٤| = ٦</span>', value: '|س + 4| = 6' }, { display: '<span class="math-eq">|س + ٦| = ٤</span>', value: '|س + 6| = 4' } ], correct: '|س - 6| = 4', explanation: `<p class='mb-2'>أولاً، نوجد نقطة المنتصف بين ٢ و ١٠: <span class="math-block"><span class="fraction"><span>٢ + ١٠</span><span class="frac-bar"></span><span>٢</span></span> = <span class="fraction"><span>١٢</span><span class="frac-bar"></span><span>٢</span></span> = ٦</span>.</p><p class='mb-2'>ثانياً، نوجد المسافة من المنتصف (٦) إلى أي من النقطتين: <span class="math-block">١٠ - ٦ = ٤</span>.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>إذن، المعادلة هي |س - ٦| = ٤.</p>`, graph: `<svg viewBox="0 0 200 60" class="mx-auto my-2 w-full max-w-xs h-auto"><defs><marker id="arrowhead-1-5" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#4a5568"/></marker></defs><line x1="10" y1="30" x2="190" y2="30" stroke="#4a5568" stroke-width="2" marker-start="url(#arrowhead-1-5)" marker-end="url(#arrowhead-1-5)" /><g font-size="10" font-family="sans-serif" fill="#4a5568" text-anchor="middle"><text x="30" y="50">٢</text><line x1="30" y1="25" x2="30" y2="35" stroke="#4a5568" stroke-width="1.5" /><text x="170" y="50">١٠</text><line x1="170" y1="25" x2="170" y2="35" stroke="#4a5568" stroke-width="1.5" /></g><circle cx="30" cy="30" r="4" fill="#3b82f6" /><circle cx="170" cy="30" r="4" fill="#3b82f6" /></svg>` },
                    { type: 'mcq', level: '⭐', topic: 'evaluate', text: 'إذا كانت <span class="math-eq">هـ = ٥</span>، <span class="math-eq">د = -٤</span>، فما قيمة <span class="math-block">| ٢د - هـ |</span>؟', options: [ { display: '<span class="math-eq">١٣</span>', value: '13' }, { display: '<span class="math-eq">-١٣</span>', value: '-13' }, { display: '<span class="math-eq">٣</span>', value: '3' }, { display: '<span class="math-eq">-٣</span>', value: '-3' } ], correct: '13', explanation: `<p class='mb-2'>نعوض عن المتغيرات بقيمها.</p><div class='text-right space-y-2'><p><span class='math-block'>| ٢(-٤) - ٥ |</span></p><p><span class='math-block'>| -٨ - ٥ |</span></p><p><span class='math-block'>| -١٣ | = ١٣</span></p></div>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'solve', text: 'حل المعادلة: <span class="math-block">| س - ٨ | = ٣</span>', options: [ { display: '<span class="math-eq">{١١, ٥}</span>', value: '{11, 5}' }, { display: '<span class="math-eq">{-١١, -٥}</span>', value: '{-11, -5}' }, { display: '<span class="math-eq">{١١}</span>', value: '{11}' }, { display: '<span class="math-eq">{٥}</span>', value: '{5}' } ], correct: '{11, 5}', explanation: `<p class='mb-2'>نفصل المعادلة إلى حالتين:</p><div class='grid grid-cols-1 md:grid-cols-2 gap-2 text-center mt-2'><div class='space-y-1 p-2 bg-gray-100 rounded'><p class='font-bold'>الحالة الأولى</p><p class='math-block'>س - ٨ = ٣</p><p class='math-block'>س = ٣ + ٨</p><p class='math-block'>س = ١١</p></div><div class='space-y-1 p-2 bg-gray-100 rounded'><p class='font-bold'>الحالة الثانية</p><p class='math-block'>س - ٨ = -٣</p><p class='math-block'>س = -٣ + ٨</p><p class='math-block'>س = ٥</p></div></div><p class='mt-3 p-2 bg-green-100 rounded-md text-center'>إذن، مجموعة الحل هي {١١، ٥}.</p>` },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'solve', text: 'حل المعادلة: <span class="math-block">٣|س + ٦| = ٩</span>', options: [ { display: '<span class="math-eq">{-٣, -٩}</span>', value: '{-3, -9}' }, { display: '<span class="math-eq">{٣, ٩}</span>', value: '{3, 9}' }, { display: '<span class="math-eq">{-٣}</span>', value: '{-3}' }, { display: '<span class="math-eq">مجموعة خالية (∅)</span>', value: '∅' } ], correct: '{-3, -9}', explanation: `<p class='mb-2'>أولاً، نقسم الطرفين على ٣ لعزل القيمة المطلقة:</p><p class='math-block text-center'>|س + ٦| = ٣</p><p class='mb-2'>ثم نفصل المعادلة إلى حالتين:</p><div class='grid grid-cols-1 md:grid-cols-2 gap-2 text-center mt-2'><div class='space-y-1 p-2 bg-gray-100 rounded'><p class='font-bold'>الحالة الأولى</p><p class='math-block'>س + ٦ = ٣</p><p class='math-block'>س = ٣ - ٦</p><p class='math-block'>س = -٣</p></div><div class='space-y-1 p-2 bg-gray-100 rounded'><p class='font-bold'>الحالة الثانية</p><p class='math-block'>س + ٦ = -٣</p><p class='math-block'>س = -٣ - ٦</p><p class='math-block'>س = -٩</p></div></div><p class='mt-3 p-2 bg-green-100 rounded-md text-center'>إذن، مجموعة الحل هي {-٣، -٩}.</p>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'solve', text: 'حل المعادلة: <span class="math-block">|٤س - ٨| = ٠</span>', options: [ { display: '<span class="math-eq">{٢}</span>', value: '{2}' }, { display: '<span class="math-eq">{-٢}</span>', value: '{-2}' }, { display: '<span class="math-eq">{٢, -٢}</span>', value: '{2, -2}' }, { display: '<span class="math-eq">مجموعة خالية (∅)</span>', value: '∅' } ], correct: '{2}', explanation: `<p class='mb-2'>عندما تساوي القيمة المطلقة صفراً، هناك حل واحد فقط.</p><div class='text-right space-y-2'><p><span class='math-block'>٤س - ٨ = ٠</span></p><p><span class='math-block'>٤س = ٨</span></p><p><span class='math-block'>س = ٢</span></p></div>` },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'writing-from-points', text: 'اكتب معادلة القيمة المطلقة التي حلولها هي <span class="math-eq">-٢</span> و <span class="math-eq">٨</span>.', options: [ { display: '<span class="math-eq">|س - ٣| = ٥</span>', value: '|س - 3| = 5' }, { display: '<span class="math-eq">|س - ٥| = ٣</span>', value: '|س - 5| = 3' }, { display: '<span class="math-eq">|س + ٣| = ٥</span>', value: '|س + 3| = 5' }, { display: '<span class="math-eq">|س + ٥| = ٣</span>', value: '|س + 5| = 3' } ], correct: '|س - 3| = 5', explanation: `<p class='mb-2'>أولاً، نوجد نقطة المنتصف: <span class="math-block"><span class="fraction"><span>(-٢) + ٨</span><span class="frac-bar"></span><span>٢</span></span> = <span class="fraction"><span>٦</span><span class="frac-bar"></span><span>٢</span></span> = ٣</span>.</p><p class='mb-2'>ثانياً، نوجد المسافة من المنتصف (٣) إلى أي من النقطتين: <span class="math-block">٨ - ٣ = ٥</span>.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>إذن، المعادلة هي |س - ٣| = ٥.</p>` },
                    { type: 'mcq', level: '⭐', topic: 'evaluate', text: 'إذا كانت <span class="math-eq">ف = -٣</span>، <span class="math-eq">هـ = ٥</span>، فما قيمة <span class="math-block">-|ف + هـ|</span>؟', options: [ { display: '<span class="math-eq">-٢</span>', value: '-2' }, { display: '<span class="math-eq">٢</span>', value: '2' }, { display: '<span class="math-eq">٨</span>', value: '8' }, { display: '<span class="math-eq">-٨</span>', value: '-8' } ], correct: '-2', explanation: `<p class='mb-2'>نحسب ما بداخل القيمة المطلقة أولاً ثم نطبق الإشارة السالبة.</p><div class='text-right space-y-2'><p><span class='math-block'>-|(-٣) + ٥|</span></p><p><span class='math-block'>-|٢|</span></p><p><span class='math-block'>= -٢</span></p></div>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'solve', text: 'حل المعادلة: <span class="math-block">-|س| = -٥</span>', options: [ { display: '<span class="math-eq">{٥, -٥}</span>', value: '{5, -5}' }, { display: '<span class="math-eq">{٥}</span>', value: '{5}' }, { display: '<span class="math-eq">{-٥}</span>', value: '{-5}' }, { display: '<span class="math-eq">مجموعة خالية (∅)</span>', value: '∅' } ], correct: '{5, -5}', explanation: `<p class='mb-2'>أولاً، نضرب الطرفين في -١ للتخلص من الإشارة السالبة خارج القيمة المطلقة.</p><p class='math-block text-center'>|س| = ٥</p><p class='mt-2'>وهذا يعني أن <span class='math-eq'>س = ٥</span> أو <span class='math-eq'>س = -٥</span>.</p>` }
                ];
                const shuffledBank = [...questionBank].sort(() => Math.random() - 0.5);
                return shuffledBank.slice(0, 5); // Select 5 random questions
            }  },
        
        // === الفصل الثاني: العلاقات والدوال الخطية ===
        'c2_l1': { title: 'الدرس ٢-١: العلاقات', content: '<!-- سيتم إضافة محتوى الدرس هنا -->', generateQuiz: () => { /* سيتم إضافة اختبار الدرس هنا */ return []; } },
        'c2_l2': { title: 'الدرس ٢-٢: الدوال', content: '<!-- سيتم إضافة محتوى الدرس هنا -->', generateQuiz: () => { /* سيتم إضافة اختبار الدرس هنا */ return []; } },
        'c2_l3': { title: 'الدرس ٢-٣: تمثيل المعادلات الخطية بيانياً', content: '<!-- سيتم إضافة محتوى الدرس هنا -->', generateQuiz: () => { /* سيتم إضافة اختبار الدرس هنا */ return []; } },
        
        'c2_l4': { 
            title: 'الدرس ٢-٤: حل المعادلات الخطية بيانياً', 
            content: `
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفاهيم الأساسية</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">الدالة المولّدة (الأم) للدوال الخطية</h3>
                            <p>أبسط دالة خطية هي <span class="math-eq">د(س) = س</span>. وتُسمى <span class="vocab-term">الدالة المولدة (الأم)</span> لمجموعة الدوال الخطية. جميع الدوال الخطية الأخرى ما هي إلا تحويلات لهذه الدالة الأم.</p>
                            <div class="mt-4 p-4 bg-white rounded-lg border grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
                                <div class="space-y-2">
                                   <p><strong>التمثيل البياني:</strong> خط مستقيم يمر بنقطة الأصل.</p>
                                   <p><strong>المجال:</strong> جميع الأعداد الحقيقية.</p>
                                   <p><strong>المدى:</strong> جميع الأعداد الحقيقية.</p>
                                </div>
                                <div>
                                    <svg viewBox="-5 -5 10 10" class="w-full h-40 bg-white border rounded-lg">
                                        <path d="M -5,1 L 5,1 M -5,2 L 5,2 M -5,3 L 5,3 M -5,4 L 5,4 M -5,-1 L 5,-1 M -5,-2 L 5,-2 M -5,-3 L 5,-3 M -5,-4 L 5,-4" stroke="#d1d5db" stroke-width="0.15" />
                                        <path d="M 1,-5 L 1,5 M 2,-5 L 2,5 M 3,-5 L 3,5 M 4,-5 L 4,5 M -1,-5 L -1,5 M -2,-5 L -2,5 M -3,-5 L -3,5 M -4,-5 L -4,5" stroke="#d1d5db" stroke-width="0.15" />
                                        <line x1="-5" y1="0" x2="5" y2="0" stroke="#9ca3af" stroke-width="0.2"/><line x1="0" y1="-5" x2="0" y2="5" stroke="#9ca3af" stroke-width="0.2"/>
                                        <text x="4.5" y="-0.5" font-size="0.8" fill="#9ca3af">س</text><text x="0.5" y="-4.5" font-size="0.8" fill="#9ca3af">ص</text>
                                        <line x1="-4.5" y1="-4.5" x2="4.5" y2="4.5" stroke="#3b82f6" stroke-width="0.4"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">حل المعادلة، الجذر، والصفر</h3>
                            <p>حل المعادلة هو أي قيمة للمتغير تجعل المعادلة صحيحة. ويُسمى حل المعادلة أيضاً <span class="vocab-term">الجذر</span>.</p>
                            <p>لإيجاد جذر المعادلة، نربطها بدالة. فمثلاً، الدالة المرتبطة بالمعادلة <span class="math-eq">٢س - ٨ = ٠</span> هي <span class="math-eq">د(س) = ٢س - ٨</span>.</p>
                            <p class="font-bold mt-2">جذر المعادلة هو نفسه <span class="vocab-term">صفر الدالة</span>، وهو قيمة <span class="math-eq">س</span> التي تجعل <span class="math-eq">د(س) = ٠</span>. بيانياً، هو المقطع السيني للرسم البياني للدالة.</p>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: إيجاد الحل بيانياً (بشكل تفاعلي)</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                            <div>
                                <h3 class="font-bold text-lg mb-2">الخطوة ١: تكوين جدول</h3>
                                <p class="mb-4 text-sm text-gray-600">اضغط على الأزرار لبناء الحل خطوة بخطوة.</p>
                                <table class="w-full border-collapse border border-slate-400 text-center">
                                    <thead class="bg-blue-100">
                                        <tr>
                                            <th class="p-2 border border-slate-300 highlight-s">س</th>
                                            <th class="p-2 border border-slate-300">٢<span class="highlight-s">س</span> - ٨</th>
                                            <th class="p-2 border border-slate-300">(س, ص)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="interactive-table-body"></tbody>
                                </table>
                                 <div class="mt-4 grid grid-cols-3 gap-2">
                                    <button id="prev-step-btn" class="w-full bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors btn-disabled" disabled>السابق</button>
                                    <button id="next-step-btn" class="w-full bg-blue-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">التالي</button>
                                    <button id="reset-step-btn" class="w-full bg-red-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">إعادة</button>
                                </div>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg mb-2">الخطوة ٢: التمثيل البياني</h3>
                                <svg id="interactive-graph" viewBox="-10 -10 20 20" class="w-full h-72 bg-white border rounded-lg"></svg>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🥕 ثالثاً: مثال من واقع الحياة (مشكلة الجزر)</h2>
                    <div class="p-6 bg-yellow-50 rounded-lg border-2 border-yellow-200">
                        <p class="mb-4 text-lg"><strong>المسألة:</strong> تمثل الدالة <span class="math-eq">و = ٦٠ - ٢ن</span> كتلة الجزر المتبقي بالكيلوجرام في محل أحمد بعد بيعه <span class="math-eq">ن</span> كيساً. أوجد صفر الدالة، ووضّح ما يعنيه في هذا السياق.</p>
                        <h3 class="text-xl font-semibold mb-3">شرح مبسط:</h3>
                        <div class="explanation-step">
                            <h4 class="font-bold text-lg mb-1">1. ما هو "صفر الدالة"؟</h4>
                            <p>ببساطة، هو أن نجد عدد الأكياس (<span class="math-eq">ن</span>) التي تجعل كمية الجزر المتبقية (<span class="math-eq">و</span>) تساوي صفرًا. أي، متى يبيع أحمد كل الجزر؟</p>
                        </div>
                        <div class="explanation-step">
                            <h4 class="font-bold text-lg mb-1">2. كيف نجد الحل؟</h4>
                            <p>نضع قيمة (<span class="math-eq">و</span>) تساوي 0 في المعادلة ونحلها:</p>
                            <p class="text-center my-2 p-2 bg-white rounded-md text-xl math-eq">٠ = ٦٠ - ٢ن</p>
                            <p>لحلها، انقل <span class="math-eq">٢ن</span> للطرف الآخر (تتغير إشارتها):</p>
                            <p class="text-center my-2 p-2 bg-white rounded-md text-xl math-eq">٢ن = ٦٠</p>
                            <p>الآن، لإيجاد قيمة <span class="math-eq">ن</span>، نقسم ٦٠ على ٢:</p>
                            <p class="text-center my-2 p-2 bg-green-100 rounded-md text-2xl math-eq">ن = ٣٠</p>
                        </div>
                        <div>
                            <h4 class="font-bold text-lg mb-1">3. ماذا يعني الحل؟</h4>
                            <p class="mt-2 p-4 bg-green-100 border-r-4 border-green-500 text-lg">الحل هو <span class="math-eq">٣٠</span>. وهذا يعني أن أحمد يجب أن يبيع <strong>٣٠ كيساً</strong> حتى تنتهي كل كمية الجزر لديه.</p>
                        </div>
                    </div>
                </section>
                <script>
                (function() {
                    const nextStepBtn = document.getElementById('next-step-btn');
                    const prevStepBtn = document.getElementById('prev-step-btn');
                    const resetStepBtn = document.getElementById('reset-step-btn');
                    const tableBody = document.getElementById('interactive-table-body');
                    const graph = document.getElementById('interactive-graph');
                    
                    if (!nextStepBtn) return;

                    let animationStep = 0;
                    const animationData = [
                        { s: '٢', calc: '٢(<span class="highlight-s">٢</span>) - ٨ = -٤', res: '-٤', point: {x: 2, y: -4}, color: '#1d4ed8'},
                        { s: '٤', calc: '٢(<span class="highlight-s">٤</span>) - ٨ = ٠', res: '٠', point: {x: 4, y: 0}, color: '#ef4444'},
                        { s: '٥', calc: '٢(<span class="highlight-s">٥</span>) - ٨ = ٢', res: '٢', point: {x: 5, y: 2}, color: '#1d4ed8'}
                    ];
                    
                    function drawGraphState() {
                        initializeGraph();
                        for (let i = 0; i < animationStep; i++) {
                            const data = animationData[i];
                            const px = data.point.x;
                            const py = -data.point.y;
                            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                            circle.setAttribute('cx', px);
                            circle.setAttribute('cy', py);
                            circle.setAttribute('r', 0.3);
                            circle.setAttribute('fill', data.color);
                            graph.appendChild(circle);
                        }
                        if (animationStep === animationData.length) {
                            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                            line.setAttribute('x1', 1); line.setAttribute('y1', 6);
                            line.setAttribute('x2', 6); line.setAttribute('y2', -4);
                            line.setAttribute('stroke', '#3b82f6');
                            line.setAttribute('stroke-width', '0.4');
                            graph.insertBefore(line, graph.firstChild);
                        }
                    }

                    function updateTable() {
                        tableBody.innerHTML = '';
                        for (let i = 0; i < animationStep; i++) {
                            const data = animationData[i];
                            const newRow = tableBody.insertRow();
                            newRow.innerHTML = \`
                                <td class="border border-slate-300 p-2 font-bold highlight-s">\${data.s}</td>
                                <td class="border border-slate-300 p-2 math-eq">\${data.calc}</td>
                                <td class="border border-slate-300 p-2 math-eq">(\${data.s}, \${data.res})</td>
                            \`;
                        }
                    }

                    function updateButtons() {
                        prevStepBtn.disabled = animationStep === 0;
                        nextStepBtn.disabled = animationStep === animationData.length;
                        prevStepBtn.classList.toggle('btn-disabled', prevStepBtn.disabled);
                        nextStepBtn.classList.toggle('btn-disabled', nextStepBtn.disabled);
                        nextStepBtn.textContent = (animationStep === animationData.length) ? 'اكتمل' : 'التالي';
                    }

                    function handleNextStep() { if (animationStep < animationData.length) { animationStep++; updateTable(); drawGraphState(); updateButtons(); } }
                    function handlePrevStep() { if (animationStep > 0) { animationStep--; updateTable(); drawGraphState(); updateButtons(); } }
                    function resetAnimation() { animationStep = 0; updateTable(); initializeGraph(); updateButtons(); }

                    function initializeGraph() {
                        graph.innerHTML = '';
                        let gridHtml = '';
                        for(let i = -9; i <= 9; i++) {
                            if (i === 0) continue;
                            gridHtml += \`<line x1="-10" y1="\${i}" x2="10" y2="\${i}" stroke="#d1d5db" stroke-width="0.15" />\`;
                            gridHtml += \`<line x1="\${i}" y1="-10" x2="\${i}" y2="10" stroke="#d1d5db" stroke-width="0.15" />\`;
                        }
                        gridHtml += '<line x1="-10" y1="0" x2="10" y2="0" stroke="#6b7280" stroke-width="0.2"/>';
                        gridHtml += '<line x1="0" y1="-10" x2="0" y2="10" stroke="#6b7280" stroke-width="0.2"/>';
                        gridHtml += '<text x="9.5" y="-0.5" font-size="0.8" fill="#374151" font-weight="bold">س</text>';
                        gridHtml += '<text x="0.5" y="-9.5" font-size="0.8" fill="#374151" font-weight="bold">ص</text>';
                        graph.innerHTML = gridHtml;
                    }

                    nextStepBtn.addEventListener('click', handleNextStep);
                    prevStepBtn.addEventListener('click', handlePrevStep);
                    resetStepBtn.addEventListener('click', resetAnimation);
                    
                    initializeGraph();
                })();
                <\/script>
            `, 
            generateQuiz: () => { 
                const questionBank = [
                    { type: 'mcq', level: '⭐', topic: 'concept', text: 'ماذا يمثل "صفر الدالة" في الرسم البياني؟', options: [ { display: 'المقطع الصادي', value: 'A' }, { display: 'المقطع السيني', value: 'B' }, { display: 'نقطة الأصل', value: 'C' }, { display: 'ميل الخط', value: 'D' } ], correct: 'B', explanation: '<p>صفر الدالة هو قيمة (س) التي تجعل قيمة الدالة (ص) تساوي صفرًا. على الرسم البياني، هذه هي النقطة التي يقطع فيها الخط محور السينات، وتُعرف بـ "المقطع السيني".</p>' },
                    { type: 'mcq', level: '⭐', topic: 'parent-function', text: 'ما هي الدالة المولدة (الأم) لجميع الدوال الخطية؟', options: [ { display: '<span class="math-eq">د(س) = س²</span>', value: 'A' }, { display: '<span class="math-eq">د(س) = س</span>', value: 'B' }, { display: '<span class="math-eq">د(س) = |س|</span>', value: 'C' }, { display: '<span class="math-eq">د(س) = ١</span>', value: 'D' } ], correct: 'B', explanation: '<p>الدالة <span class="math-eq">د(س) = س</span> هي أبسط صورة للدالة الخطية وتعتبر الدالة الأم التي تُبنى عليها جميع الدوال الخطية الأخرى من خلال التحويلات (إزاحة، تمدد، انعكاس).</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'solve-equation', text: 'ما هو حل المعادلة <span class="math-eq">٣س + ١٥ = ٠</span>؟', options: [ { display: '<span class="math-eq">٥</span>', value: 'A' }, { display: '<span class="math-eq">١٥</span>', value: 'B' }, { display: '<span class="math-eq">-٥</span>', value: 'C' }, { display: '<span class="math-eq">-١٥</span>', value: 'D' } ], correct: 'C', explanation: '<p>لحل المعادلة <span class="math-eq">٣س + ١٥ = ٠</span>، نطرح ١٥ من الطرفين: <span class="math-eq">٣س = -١٥</span>. ثم نقسم الطرفين على ٣ لنجد أن س = -٥.</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'graph-reading', text: 'من الرسم البياني، ما هو صفر الدالة؟', graph: '<svg viewBox="-5 -5 10 10" class="w-full h-40 bg-white border rounded-lg mt-2"><path d="M -5,1 L 5,1 M -5,2 L 5,2 M -5,3 L 5,3 M -5,4 L 5,4 M -5,-1 L 5,-1 M -5,-2 L 5,-2 M -5,-3 L 5,-3 M -5,-4 L 5,-4" stroke="#d1d5db" stroke-width="0.15" /><path d="M 1,-5 L 1,5 M 2,-5 L 2,5 M 3,-5 L 3,5 M 4,-5 L 4,5 M -1,-5 L -1,5 M -2,-5 L -2,5 M -3,-5 L -3,5 M -4,-5 L -4,5" stroke="#d1d5db" stroke-width="0.15" /><line x1="-5" y1="0" x2="5" y2="0" stroke="#9ca3af" stroke-width="0.2" /><line x1="0" y1="-5" x2="0" y2="5" stroke="#9ca3af" stroke-width="0.2" /><line x1="0" y1="4" x2="4" y2="-4" stroke="#3b82f6" stroke-width="0.4" /><circle cx="2" cy="0" r="0.3" fill="#ef4444" /></svg>', options: [ { display: '<span class="math-eq">س = ٠</span>', value: 'A' }, { display: '<span class="math-eq">س = ٢</span>', value: 'B' }, { display: '<span class="math-eq">س = -٢</span>', value: 'C' }, { display: '<span class="math-eq">س = ٤</span>', value: 'D' } ], correct: 'B', explanation: '<p>نبحث عن النقطة التي يقطع فيها الخط المستقيم محور السينات (المحور الأفقي). في هذا الرسم، يقطع الخط محور السينات عند النقطة التي تكون فيها <span class="math-eq">س = ٢</span>.</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'solve-equation', text: 'أوجد جذر المعادلة <span class="math-eq">١٠ - ٥س = ٠</span>.', options: [ { display: '<span class="math-eq">٢</span>', value: 'A' }, { display: '<span class="math-eq">-٢</span>', value: 'B' }, { display: '<span class="math-eq">٠.٥</span>', value: 'C' }, { display: '<span class="math-eq">٥</span>', value: 'D' } ], correct: 'A', explanation: '<p>لإيجاد الجذر، نحل المعادلة. <span class="math-eq">١٠ - ٥س = ٠</span>. نضيف ٥س للطرفين: <span class="math-eq">١٠ = ٥س</span>. ثم نقسم ١٠ على ٥ لنجد أن س = ٢.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'table-estimation', text: `ما التقدير الأفضل للمقطع السيني للدالة الخطية الممثلة في الجدول التالي؟<div class="flex justify-center my-2"><table class="w-1/2 text-center border"> <thead class="bg-gray-200"><tr><th class="p-1 border">س</th><th class="p-1 border">ص</th></tr></thead><tbody><tr><td class="p-1 border">٠</td><td class="p-1 border">٥</td></tr><tr><td class="p-1 border">١</td><td class="p-1 border">٣</td></tr><tr><td class="p-1 border">٢</td><td class="p-1 border">١</td></tr><tr><td class="p-1 border">٣</td><td class="p-1 border">-١</td></tr><tr><td class="p-1 border">٤</td><td class="p-1 border">-٣</td></tr></tbody></table></div>`, options: [ { display: 'بين ٠ و ١', value: 'A' }, { display: 'بين ٢ و ٣', value: 'B' }, { display: 'بين ١ و ٢', value: 'C' }, { display: 'بين ٣ و ٤', value: 'D' } ], correct: 'B', explanation: `<p class="mb-2">المقطع السيني (صفر الدالة) يحدث عندما تتغير إشارة (ص) من موجبة إلى سالبة. بالنظر إلى الجدول، نجد أن قيمة (ص) كانت ١ (موجبة) عندما كانت س = ٢، وأصبحت -١ (سالبة) عندما أصبحت س = ٣. لذلك، لا بد أن الخط قد قطع محور السينات في نقطة ما بين س=٢ و س=٣.</p><h4 class="font-bold mt-4 mb-2">توضيح مرئي:</h4><div class="bg-gray-100 p-2 rounded-lg"><svg data-interactive-graph="modal" viewBox="-2 -6 8 12" class="w-full h-64 bg-white border rounded-lg"></svg><div class="mt-2 grid grid-cols-3 gap-2"><button data-action="modal-prev" class="w-full bg-blue-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">السابق</button><button data-action="modal-next" class="w-full bg-blue-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">التالي</button><button data-action="modal-reset" class="w-full bg-red-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">إعادة</button></div></div>` },
                    { type: 'mcq', level: '⭐', topic: 'concept', text: 'ما هي الدالة المرتبطة بالمعادلة <span class="math-eq">٤س - ٢٠ = ٠</span>؟', options: [ { display: '<span class="math-eq">د(س) = ٤س</span>', value: 'A' }, { display: '<span class="math-eq">د(س) = ٢٠</span>', value: 'B' }, { display: '<span class="math-eq">د(س) = ٤س - ٢٠</span>', value: 'C' }, { display: '<span class="math-eq">د(س) = ٥</span>', value: 'D' } ], correct: 'C', explanation: '<p>لتحويل معادلة صفرية إلى دالة مرتبطة، نستبدل الصفر بـ <span class="math-eq">د(س)</span> أو <span class="math-eq">ص</span>. فتصبح الدالة <span class="math-eq">د(س) = ٤س - ٢٠</span>.</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'graph-reading', text: 'من الرسم البياني، ما هو صفر الدالة؟', graph: '<svg viewBox="-5 -5 10 10" class="w-full h-40 bg-white border rounded-lg mt-2"><path d="M -5,1 L 5,1 M -5,2 L 5,2 M -5,3 L 5,3 M -5,4 L 5,4 M -5,-1 L 5,-1 M -5,-2 L 5,-2 M -5,-3 L 5,-3 M -5,-4 L 5,-4" stroke="#d1d5db" stroke-width="0.15" /><path d="M 1,-5 L 1,5 M 2,-5 L 2,5 M 3,-5 L 3,5 M 4,-5 L 4,5 M -1,-5 L -1,5 M -2,-5 L -2,5 M -3,-5 L -3,5 M -4,-5 L -4,5" stroke="#d1d5db" stroke-width="0.15" /><line x1="-5" y1="0" x2="5" y2="0" stroke="#9ca3af" stroke-width="0.2" /><line x1="0" y1="-5" x2="0" y2="5" stroke="#9ca3af" stroke-width="0.2" /><line x1="-5" y1="2" x2="1" y2="-4" stroke="#3b82f6" stroke-width="0.4" /><circle cx="-3" cy="0" r="0.3" fill="#ef4444" /></svg>', options: [ { display: '<span class="math-eq">س = ٢</span>', value: 'A' }, { display: '<span class="math-eq">س = -٣</span>', value: 'B' }, { display: '<span class="math-eq">س = -١</span>', value: 'C' }, { display: '<span class="math-eq">س = ٠</span>', value: 'D' } ], correct: 'B', explanation: '<p>بالنظر إلى الرسم البياني، نجد أن الخط المستقيم يتقاطع مع محور السينات عند النقطة <span class="math-eq">س = -٣</span>. لذا، صفر هذه الدالة هو -٣.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'solve-equation', text: 'إذا كان صفر الدالة <span class="math-eq">د(س) = ك س - ١٢</span> هو ٤، فما قيمة الثابت (ك)؟', options: [ { display: '<span class="math-eq">٣</span>', value: 'A' }, { display: '<span class="math-eq">-٣</span>', value: 'B' }, { display: '<span class="math-eq">٤</span>', value: 'C' }, { display: '<span class="math-eq">١٢</span>', value: 'D' } ], correct: 'A', explanation: '<p>معنى أن صفر الدالة هو ٤، أنه عند <span class="math-eq">س = ٤</span>، تكون <span class="math-eq">د(س) = ٠</span>. نعوض في المعادلة: <span class="math-eq">٠ = ك(٤) - ١٢</span>. نضيف ١٢ للطرفين: <span class="math-eq">١٢ = ٤ك</span>. لإيجاد قيمة ك، نقسم ١٢ على ٤، فتكون قيمة ك = ٣.</p>' },
                    { type: 'mcq', level: '⭐', topic: 'concept', text: 'مرادف كلمة "جذر" المعادلة هو...', options: [ { display: 'ميل الدالة', value: 'A' }, { display: 'صفر الدالة', value: 'B' }, { display: 'مدى الدالة', value: 'C' }, { display: 'مجال الدالة', value: 'D' } ], correct: 'B', explanation: '<p>جذر المعادلة، وحل المعادلة، وصفر الدالة المرتبطة بها، كلها مصطلحات تشير إلى نفس القيمة، وهي المقطع السيني للرسم البياني.</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'solve-equation', text: 'حل المعادلة <span class="inline-flex flex-col text-center leading-tight align-middle"><span>س</span><span class="border-t border-current w-full"></span><span>٢</span></span> + ٥ = ٠ هو:', options: [ { display: '<span class="math-eq">١٠</span>', value: 'A' }, { display: '<span class="math-eq">-٥</span>', value: 'B' }, { display: '<span class="math-eq">-٢.٥</span>', value: 'C' }, { display: '<span class="math-eq">-١٠</span>', value: 'D' } ], correct: 'D', explanation: '<p>لحل المعادلة، نطرح ٥ من الطرفين: <span class="inline-flex flex-col text-center leading-tight align-middle"><span>س</span><span class="border-t border-current w-full"></span><span>٢</span></span> = -٥. ثم نضرب الطرفين في ٢ للتخلص من المقام: س = -١٠.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'real-life', text: 'ينقص خزان ماء بمعدل ثابت. يمكن تمثيل كمية الماء (ل) باللتر بعد (ز) ساعة بالدالة <span class="math-eq">ل(ز) = ٥٠٠ - ٢٥ز</span>. ماذا يمثل صفر هذه الدالة؟', options: [ { display: 'كمية الماء الأولية', value: 'A' }, { display: 'معدل النقصان في الساعة', value: 'B' }, { display: 'الوقت الذي يفرغ فيه الخزان', value: 'C' }, { display: 'نصف كمية الماء', value: 'D' } ], correct: 'C', explanation: '<p>صفر الدالة هو قيمة (ز) التي تجعل كمية الماء (ل) تساوي صفرًا. في هذا السياق، هو يمثل الزمن اللازم حتى تصبح كمية الماء في الخزان صفرًا، أي الوقت الذي يفرغ فيه الخزان تمامًا.</p>' }
                ];
                return [...questionBank].sort(() => 0.5 - Math.random()).slice(0, 5);
            } 
        },

        'c2_l5': { title: 'الدرس ٢-٥: معدل التغير والميل', content: `
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفاهيم الأساسية</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">معدل التغير</h3>
                            <p>معدل التغير هو نسبة تصف كيف تتغير كمية ما بالنسبة لتغير كمية أخرى. إنه يخبرنا بمدى سرعة تغير شيء ما.</p>
                            <div class="mt-4 p-4 bg-white rounded-lg border">
                                <p class="text-lg text-center font-bold">صيغة معدل التغير</p>
                                <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-xl">
                                    <span class="math-eq">معدل التغير = <span class="fraction"><span>التغير في ص</span><span>التغير في س</span></span> = <span class="fraction"><span>ص₂ - ص₁</span><span>س₂ - س₁</span></span></span>
                                </p>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">الميل</h3>
                            <p>في الدوال الخطية، يكون معدل التغير ثابتًا. ويُسمى معدل التغير الثابت هذا <span class="vocab-term">الميل</span>.</p>
                            <p class="font-bold mt-2">ميل الخط المستقيم هو نسبة التغير الرأسي (الارتفاع) إلى التغير الأفقي (الامتداد).</p>
                        </div>
                        <div class="mt-6">
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">ملخص حالات الميل</h3>
                            <div id="slope-summary-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 text-center"></div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: حساب معدل التغير من جدول</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-8 gap-y-12">
                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-gray-700">المثال 1: معدل التغير الثابت</h3>
                                <p>يوضح الجدول المجاور عدد الكيلومترات التي قطعها خالد بدراجته. هل معدل التغير ثابت؟</p>
                                <div class="grid grid-cols-[3rem_1fr_3rem] gap-x-1 items-center">
                                    <div class="relative h-full">
                                        <div id="table-const-vis-1a" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-green-600" style="top: 33%; left: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-x font-mono" style="top: 33%; left: -0.5rem;">+٣٠</span>
                                        </div>
                                        <div id="table-const-vis-2a" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-green-600" style="top: 66%; left: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-x font-mono" style="top: 66%; left: -0.5rem;">+٣٠</span>
                                        </div>
                                    </div>
                                    <table class="w-full border-collapse border border-slate-400 text-center">
                                        <thead class="bg-blue-100"><tr><th class="p-2 border border-slate-300">الزمن (س)</th><th class="p-2 border border-slate-300">المسافة (ص)</th></tr></thead>
                                        <tbody><tr id="table-const-row-1"><td class="p-2 border border-slate-300 font-mono">٣٠</td><td class="p-2 border border-slate-300 font-mono">١٠</td></tr><tr id="table-const-row-2"><td class="p-2 border border-slate-300 font-mono">٦٠</td><td class="p-2 border border-slate-300 font-mono">٢٠</td></tr><tr id="table-const-row-3"><td class="p-2 border border-slate-300 font-mono">٩٠</td><td class="p-2 border border-slate-300 font-mono">٣٠</td></tr></tbody>
                                    </table>
                                    <div class="relative h-full">
                                        <div id="table-const-vis-1b" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-red-600" style="top: 33%; right: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-y font-mono" style="top: 33%; right: -0.5rem;">+١٠</span>
                                        </div>
                                        <div id="table-const-vis-2b" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-red-600" style="top: 66%; right: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-y font-mono" style="top: 66%; right: -0.5rem;">+١٠</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-white p-4 rounded-lg border min-h-[200px]"><div id="table-const-explanation" class="text-right"></div></div>
                                <div class="mt-4 flex justify-between items-center"><button id="table-const-back" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button><span class="text-sm font-bold text-gray-600">الخطوة <span id="table-const-step-counter">0</span> / 4</span><button id="table-const-next" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-indigo-700">التالي</button></div>
                            </div>
                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-gray-700">المثال 2: معدل التغير غير الثابت</h3>
                                <p>يوضح الجدول التالي أرباح متجر صغير بالأيام. هل معدل التغير ثابت؟</p>
                                <div class="grid grid-cols-[3rem_1fr_3rem] gap-x-1 items-center">
                                    <div class="relative h-full">
                                        <div id="table-nonconst-vis-1a" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-green-600" style="top: 33%; left: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-x font-mono" style="top: 33%; left: -0.5rem;">+٤</span>
                                        </div>
                                        <div id="table-nonconst-vis-2a" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-green-600" style="top: 66%; left: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-x font-mono" style="top: 66%; left: -0.5rem;">+٢</span>
                                        </div>
                                    </div>
                                    <table class="w-full border-collapse border border-slate-400 text-center">
                                        <thead class="bg-orange-100"><tr><th class="p-2 border border-slate-300">اليوم (س)</th><th class="p-2 border border-slate-300">الأرباح (ص)</th></tr></thead>
                                        <tbody><tr id="table-nonconst-row-1"><td class="p-2 border border-slate-300 font-mono">١</td><td class="p-2 border border-slate-300 font-mono">١٠٠</td></tr><tr id="table-nonconst-row-2"><td class="p-2 border border-slate-300 font-mono">٥</td><td class="p-2 border border-slate-300 font-mono">٣٠٠</td></tr><tr id="table-nonconst-row-3"><td class="p-2 border border-slate-300 font-mono">٧</td><td class="p-2 border border-slate-300 font-mono">٧٠٠</td></tr></tbody>
                                    </table>
                                    <div class="relative h-full">
                                        <div id="table-nonconst-vis-1b" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-red-600" style="top: 33%; right: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-y font-mono" style="top: 33%; right: -1.5rem;">+٢٠٠</span>
                                        </div>
                                        <div id="table-nonconst-vis-2b" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-red-600" style="top: 66%; right: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-y font-mono" style="top: 66%; right: -1.5rem;">+٤٠٠</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-white p-4 rounded-lg border min-h-[200px]"><div id="table-nonconst-explanation" class="text-right"></div></div>
                                <div class="mt-4 flex justify-between items-center"><button id="table-nonconst-back" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button><span class="text-sm font-bold text-gray-600">الخطوة <span id="table-nonconst-step-counter">0</span> / 4</span><button id="table-nonconst-next" class="nav-btn bg-orange-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-orange-700">التالي</button></div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">📈 ثالثاً: إيجاد الميل من الرسم البياني</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-gray-700">المثال ١: معدل التغير الثابت (الميل)</h3>
                                <p>لإيجاد الميل، نحدد نقطتين على الخط، ثم نحسب "الارتفاع" و "الامتداد" بينهما.</p>
                                <div class="text-center">
                                    <svg id="slope-animation-svg-constant" viewBox="-2 -2 12 12" class="w-full h-72 bg-white border rounded-lg">
                                        <path d="M 0,1 L 10,1 M 0,2 L 10,2 M 0,3 L 10,3 M 0,4 L 10,4 M 0,5 L 10,5 M 0,6 L 10,6 M 0,7 L 10,7 M 0,8 L 10,8 M 0,9 L 10,9" stroke="#e5e7eb" stroke-width="0.1" /><path d="M 1,0 L 1,10 M 2,0 L 2,10 M 3,0 L 3,10 M 4,0 L 4,10 M 5,0 L 5,10 M 6,0 L 6,10 M 7,0 L 7,10 M 8,0 L 8,10 M 9,0 L 9,10" stroke="#e5e7eb" stroke-width="0.1" /><line x1="0" y1="0" x2="0" y2="10" stroke="#6b7280" stroke-width="0.2"/><line x1="0" y1="10" x2="10" y2="10" stroke="#6b7280" stroke-width="0.2"/><line x1="0" y1="2" x2="8" y2="10" stroke="#3b82f6" stroke-width="0.3"/><circle cx="2" cy="4" r="0.25" fill="#ef4444" /><text x="1.5" y="3.5" font-size="0.6" font-weight="bold">(٢, ٦)</text><circle cx="6" cy="8" r="0.25" fill="#ef4444" /><text x="6.5" y="8.5" font-size="0.6" font-weight="bold">(٦, ٢)</text><g id="anim-const-step-1" class="animated-element" opacity="0"><line x1="2" y1="4" x2="2" y2="8" stroke="#dc2626" stroke-width="0.2" stroke-dasharray="0.4 0.4" /></g><g id="anim-const-step-2" class="animated-element" opacity="0"><text x="0.8" y="6" fill="#dc2626" font-size="0.7">-٤</text></g><g id="anim-const-step-3" class="animated-element" opacity="0"><line x1="2" y1="8" x2="6" y2="8" stroke="#16a34a" stroke-width="0.2" stroke-dasharray="0.4 0.4" /></g><g id="anim-const-step-4" class="animated-element" opacity="0"><text x="4" y="9" fill="#16a34a" font-size="0.7" text-anchor="middle">٤</text></g>
                                    </svg>
                                    <div id="animation-explanation-constant" class="mt-4 p-4 bg-white rounded-lg border text-right min-h-[150px]"></div>
                                    <div class="mt-4 flex justify-between items-center"><button id="slope-anim-back-constant" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button><span class="text-sm font-bold text-gray-600">الخطوة <span id="step-counter-constant">0</span> / 3</span><button id="slope-anim-next-constant" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-indigo-700">التالي</button></div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-gray-700">المثال ٢: معدل التغير غير الثابت</h3>
                                <p>يوضح الرسم أرباح شركة بالألف ريال خلال عدة أعوام. هل معدل التغير ثابت؟</p>
                                <div class="text-center">
                                    <svg id="slope-animation-svg-non-constant" viewBox="0 0 100 80" class="w-full h-72 bg-white border rounded-lg">
                                        <line x1="10" y1="5" x2="10" y2="70" stroke="#6b7280" stroke-width="0.5"/><line x1="10" y1="70" x2="95" y2="70" stroke="#6b7280" stroke-width="0.5"/><text x="5" y="10" font-size="4" fill="#374151">الأرباح</text><text x="50" y="78" font-size="4" fill="#374151" text-anchor="middle">العام</text>
                                        <g font-size="3.5" text-anchor="middle" fill="#6b7280"><text x="5" y="65.5">٨</text><line x1="10" y1="65" x2="95" y2="65" stroke="#e5e7eb" stroke-width="0.25"/><text x="5" y="54.5">٩</text><line x1="10" y1="53.75" x2="95" y2="53.75" stroke="#e5e7eb" stroke-width="0.25"/><text x="5" y="43.5">١٠</text><line x1="10" y1="42.5" x2="95" y2="42.5" stroke="#e5e7eb" stroke-width="0.25"/><text x="5" y="32.5">١١</text><line x1="10" y1="31.25" x2="95" y2="31.25" stroke="#e5e7eb" stroke-width="0.25"/><text x="5" y="21.5">١٢</text><line x1="10" y1="20" x2="95" y2="20" stroke="#e5e7eb" stroke-width="0.25"/></g>
                                        <g font-size="3.5" text-anchor="middle" fill="#6b7280"><text x="23.3" y="75">٢٦</text><line x1="23.3" y1="5" x2="23.3" y2="70" stroke="#e5e7eb" stroke-width="0.25"/><text x="46.6" y="75">٢٨</text><line x1="46.6" y1="5" x2="46.6" y2="70" stroke="#e5e7eb" stroke-width="0.25"/><text x="69.9" y="75">٣٠</text><line x1="69.9" y1="5" x2="69.9" y2="70" stroke="#e5e7eb" stroke-width="0.25"/><text x="93.2" y="75">٣٢</text><line x1="93.2" y1="5" x2="93.2" y2="70" stroke="#e5e7eb" stroke-width="0.25"/></g>
                                        <line id="nc-line-1" class="animated-element" x1="23.3" y1="65" x2="46.6" y2="53.75" stroke="#f97316" stroke-width="1"/><line id="nc-line-2" class="animated-element" x1="46.6" y1="53.75" x2="69.9" y2="31.25" stroke="#f97316" stroke-width="1"/><line id="nc-line-3" class="animated-element" x1="69.9" y1="31.25" x2="93.2" y2="20" stroke="#f97316" stroke-width="1"/>
                                        <circle cx="23.3" cy="65" r="1.2" fill="#f97316" /><circle cx="46.6" cy="53.75" r="1.2" fill="#f97316" /><circle cx="69.9" cy="31.25" r="1.2" fill="#f97316" /><circle cx="93.2" cy="20" r="1.2" fill="#f97316" />
                                        <g id="nc-anim-group-1" class="animated-element" opacity="0"><line x1="46.6" y1="65" x2="46.6" y2="53.75" stroke="#dc2626" stroke-width="0.5" stroke-dasharray="1 1"/><line x1="23.3" y1="65" x2="46.6" y2="65" stroke="#16a34a" stroke-width="0.5" stroke-dasharray="1 1"/><text x="48" y="60" font-size="4" fill="#dc2626">+١</text><text x="35" y="68" font-size="4" fill="#16a34a" text-anchor="middle">+٢</text></g>
                                        <g id="nc-anim-group-2" class="animated-element" opacity="0"><line x1="69.9" y1="53.75" x2="69.9" y2="31.25" stroke="#dc2626" stroke-width="0.5" stroke-dasharray="1 1"/><line x1="46.6" y1="53.75" x2="69.9" y2="53.75" stroke="#16a34a" stroke-width="0.5" stroke-dasharray="1 1"/><text x="71.3" y="42.5" font-size="4" fill="#dc2626">+٢</text><text x="58.25" y="57" font-size="4" fill="#16a34a" text-anchor="middle">+٢</text></g>
                                        <g id="nc-anim-group-3" class="animated-element" opacity="0"><line x1="93.2" y1="31.25" x2="93.2" y2="20" stroke="#dc2626" stroke-width="0.5" stroke-dasharray="1 1"/><line x1="69.9" y1="31.25" x2="93.2" y2="31.25" stroke="#16a34a" stroke-width="0.5" stroke-dasharray="1 1"/><text x="94.5" y="26" font-size="4" fill="#dc2626">+١</text><text x="81.55" y="34.5" font-size="4" fill="#16a34a" text-anchor="middle">+٢</text></g>
                                    </svg>
                                    <div id="animation-explanation-non-constant" class="mt-4 p-4 bg-white rounded-lg border text-right min-h-[150px]"></div>
                                    <div class="mt-4 flex justify-between items-center"><button id="slope-anim-back-non-constant" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button><span class="text-sm font-bold text-gray-600">الخطوة <span id="step-counter-non-constant">0</span> / 7</span><button id="slope-anim-next-non-constant" class="nav-btn bg-orange-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-orange-700">التالي</button></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🔍 رابعاً: تطبيقات على الميل</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div>
                            <h3 class="text-xl font-bold text-gray-700 mb-4">أمثلة تفاعلية: إيجاد الميل بمعلومية نقطتين</h3>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div class="bg-white p-4 rounded-lg border space-y-2">
                                    <p><strong>مثال ١:</strong> أوجد ميل المستقيم المار بالنقطتين (س<sub class="text-sm">١</sub>, ص<sub class="text-sm">١</sub>) = (<span class="highlight-x">٢</span>، <span class="highlight-y">١</span>) و (س<sub class="text-sm">٢</sub>, ص<sub class="text-sm">٢</sub>) = (<span class="highlight-x">٥</span>، <span class="highlight-y">٧</span>).</p>
                                    <div class="bg-gray-50 p-4 rounded-lg border min-h-[150px]"><div id="slope-ex1-explanation" class="text-right text-xl"></div></div>
                                    <div class="mt-4 flex justify-between items-center"><button id="slope-ex1-back" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button><span class="text-sm font-bold text-gray-600">الخطوة <span id="slope-ex1-step-counter">0</span> / 4</span><button id="slope-ex1-next" class="nav-btn bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">التالي</button></div>
                                </div>
                                <div class="bg-white p-4 rounded-lg border space-y-2">
                                    <p><strong>مثال ٢:</strong> أوجد ميل المستقيم المار بالنقطتين (س<sub class="text-sm">١</sub>, ص<sub class="text-sm">١</sub>) = (<span class="highlight-x">-٣</span>، <span class="highlight-y">٤</span>) و (س<sub class="text-sm">٢</sub>, ص<sub class="text-sm">٢</sub>) = (<span class="highlight-x">١</span>، <span class="highlight-y">-٢</span>).</p>
                                    <div class="bg-gray-50 p-4 rounded-lg border min-h-[150px]"><div id="slope-ex2-explanation" class="text-right text-xl"></div></div>
                                    <div class="mt-4 flex justify-between items-center"><button id="slope-ex2-back" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button><span class="text-sm font-bold text-gray-600">الخطوة <span id="slope-ex2-step-counter">0</span> / 4</span><button id="slope-ex2-next" class="nav-btn bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">التالي</button></div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-700 mb-4">تدريب تفاعلي: إيجاد الإحداثي المجهول</h3>
                            <div class="space-y-4">
                                <p class="text-lg"><strong>المسألة:</strong> أوجد قيمة (ر) التي تجعل ميل المستقيم المار بالنقطتين (س<sub class="text-sm">١</sub>, ص<sub class="text-sm">١</sub>) = (<span class="highlight-x">١</span>، <span class="highlight-y">٤</span>) و (س<sub class="text-sm">٢</sub>, ص<sub class="text-sm">٢</sub>) = (<span class="highlight-x">-٥</span>، <span class="highlight-y">ر</span>) يساوي <span class="math-eq"><span class="fraction"><span>١</span><span>٣</span></span></span>.</p>
                                <div class="bg-white p-4 rounded-lg border min-h-[200px]"><div id="interactive-solver-explanation" class="text-right text-xl"></div></div>
                                <div class="mt-4 flex justify-between items-center"><button id="solver-back" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button><span class="text-sm font-bold text-gray-600">الخطوة <span id="solver-step-counter">0</span> / 7</span><button id="solver-next" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-indigo-700">التالي</button></div>
                            </div>
                        </div>
                    </div>
                </section>
                <script>
                    (function() {
                        if (document.getElementById('lesson-2-5-script-executed')) return;
                        const lessonScriptTag = document.createElement('div');
                        lessonScriptTag.id = 'lesson-2-5-script-executed';
                        document.body.appendChild(lessonScriptTag);

                        const fractionHTML = (num, den) => \`<span class="fraction"><span>\${num}</span><span>\${den}</span></span>\`;
                        
                        const slopeSummarySVG = \`
                            <div class="p-2 bg-white rounded-lg border"><svg viewBox="0 0 20 20" class="w-full h-24"><line x1="1" y1="10" x2="19" y2="10" stroke="#9ca3af" stroke-width="0.5"/><line x1="10" y1="1" x2="10" y2="19" stroke="#9ca3af" stroke-width="0.5"/><line x1="1" y1="15" x2="9" y2="5" stroke="#2563eb" stroke-width="1.2"/></svg><p class="font-bold mt-1 text-sm">ميل موجب</p></div>
                            <div class="p-2 bg-white rounded-lg border"><svg viewBox="0 0 20 20" class="w-full h-24"><line x1="1" y1="10" x2="19" y2="10" stroke="#9ca3af" stroke-width="0.5"/><line x1="10" y1="1" x2="10" y2="19" stroke="#9ca3af" stroke-width="0.5"/><line x1="1" y1="5" x2="9" y2="15" stroke="#dc2626" stroke-width="1.2"/></svg><p class="font-bold mt-1 text-sm">ميل سالب</p></div>
                            <div class="p-2 bg-white rounded-lg border"><svg viewBox="0 0 20 20" class="w-full h-24"><line x1="1" y1="10" x2="19" y2="10" stroke="#9ca3af" stroke-width="0.5"/><line x1="10" y1="1" x2="10" y2="19" stroke="#9ca3af" stroke-width="0.5"/><line x1="2" y1="5" x2="18" y2="5" stroke="#16a34a" stroke-width="1.2"/></svg><p class="font-bold mt-1 text-sm">ميل صفر</p></div>
                            <div class="p-2 bg-white rounded-lg border"><svg viewBox="0 0 20 20" class="w-full h-24"><line x1="1" y1="10" x2="19" y2="10" stroke="#9ca3af" stroke-width="0.5"/><line x1="10" y1="1" x2="10" y2="19" stroke="#9ca3af" stroke-width="0.5"/><line x1="15" y1="2" x2="15" y2="18" stroke="#ca8a04" stroke-width="1.2"/></svg><p class="font-bold mt-1 text-sm">ميل غير معرف</p></div>
                        \`;
                        
                        function createInteractiveSection(config) {
                            let currentStep = 0;
                            const renderStep = (step) => {
                                config.stepCounter.textContent = step;
                                let cumulativeHTML = '';
                                if (step === 0) {
                                    cumulativeHTML = config.stepsContent[0].text;
                                } else {
                                    for (let i = 1; i <= step; i++) {
                                        cumulativeHTML += \`<div class="explanation-step">\${config.stepsContent[i].text}</div>\`;
                                    }
                                }
                                config.explanationDiv.innerHTML = cumulativeHTML;
                                if (config.customRender) config.customRender(step);
                                config.backBtn.disabled = (step === 0);
                                config.nextBtn.textContent = (step === config.totalSteps) ? 'إعادة' : 'التالي';
                            };
                            config.nextBtn.addEventListener('click', () => {
                                currentStep = (currentStep < config.totalSteps) ? currentStep + 1 : 0;
                                renderStep(currentStep);
                            });
                            config.backBtn.addEventListener('click', () => {
                                if (currentStep > 0) { currentStep--; renderStep(currentStep); }
                            });
                            renderStep(0);
                        }

                        createInteractiveSection({
                            nextBtn: document.getElementById('table-const-next'), backBtn: document.getElementById('table-const-back'), stepCounter: document.getElementById('table-const-step-counter'), explanationDiv: document.getElementById('table-const-explanation'), totalSteps: 4,
                            stepsContent: [
                                { text: "اضغط 'التالي' للتحقق إذا كان معدل التغير ثابتًا." },
                                { text: \`<strong>1. نحسب المعدل بين النقطتين الأولى والثانية:</strong><br><div class="math-eq text-center mt-2">\${fractionHTML('التغير في ص', 'التغير في س')} = \${fractionHTML('١٠', '٣٠')} = \${fractionHTML('١', '٣')}</div>\` },
                                { text: \`<strong>2. نحسب المعدل بين النقطتين الثانية والثالثة:</strong><br><div class="math-eq text-center mt-2">\${fractionHTML('التغير في ص', 'التغير في س')} = \${fractionHTML('١٠', '٣٠')} = \${fractionHTML('١', '٣')}</div>\` },
                                { text: \`<strong>3. المقارنة:</strong><br>المعدل في الحالتين = <span class="math-eq">\${fractionHTML('١','٣')}</span>.\`},
                                { text: \`<strong>الاستنتاج:</strong><br>بما أن المعدل متساوٍ، فإن <span class="font-bold text-green-600">معدل التغير ثابت</span>.\`}
                            ],
                            customRender: (step) => {
                                document.getElementById('table-const-vis-1a').style.opacity = step >= 1 ? '1' : '0';
                                document.getElementById('table-const-vis-1b').style.opacity = step >= 1 ? '1' : '0';
                                document.getElementById('table-const-vis-2a').style.opacity = step >= 2 ? '1' : '0';
                                document.getElementById('table-const-vis-2b').style.opacity = step >= 2 ? '1' : '0';
                                document.getElementById('table-const-row-1').classList.toggle('bg-blue-100', step === 1);
                                document.getElementById('table-const-row-2').classList.toggle('bg-blue-100', step === 1 || step === 2);
                                document.getElementById('table-const-row-3').classList.toggle('bg-blue-100', step === 2);
                            }
                        });

                        createInteractiveSection({
                            nextBtn: document.getElementById('table-nonconst-next'), backBtn: document.getElementById('table-nonconst-back'), stepCounter: document.getElementById('table-nonconst-step-counter'), explanationDiv: document.getElementById('table-nonconst-explanation'), totalSteps: 4,
                            stepsContent: [
                                { text: "اضغط 'التالي' للتحقق إذا كان معدل التغير ثابتًا." },
                                { text: \`<strong>1. نحسب المعدل بين اليوم الأول والخامس:</strong><br><div class="math-eq text-center mt-2">\${fractionHTML('التغير في ص', 'التغير في س')} = \${fractionHTML('٢٠٠', '٤')} = ٥٠</div>\` },
                                { text: \`<strong>2. نحسب المعدل بين اليوم الخامس والسابع:</strong><br><div class="math-eq text-center mt-2">\${fractionHTML('التغير في ص', 'التغير في س')} = \${fractionHTML('٤٠٠', '٢')} = ٢٠٠</div>\` },
                                { text: \`<strong>3. المقارنة:</strong><br>المعدل الأول <span class="math-eq">٥٠</span> لا يساوي المعدل الثاني <span class="math-eq">٢٠٠</span>.\`},
                                { text: \`<strong>الاستنتاج:</strong><br>بما أن المعدل مختلف، فإن <span class="font-bold text-red-600">معدل التغير غير ثابت</span>.\`}
                            ],
                            customRender: (step) => {
                                document.getElementById('table-nonconst-vis-1a').style.opacity = step >= 1 ? '1' : '0';
                                document.getElementById('table-nonconst-vis-1b').style.opacity = step >= 1 ? '1' : '0';
                                document.getElementById('table-nonconst-vis-2a').style.opacity = step >= 2 ? '1' : '0';
                                document.getElementById('table-nonconst-vis-2b').style.opacity = step >= 2 ? '1' : '0';
                                document.getElementById('table-nonconst-row-1').classList.toggle('bg-orange-100', step === 1);
                                document.getElementById('table-nonconst-row-2').classList.toggle('bg-orange-100', step === 1 || step === 2);
                                document.getElementById('table-nonconst-row-3').classList.toggle('bg-orange-100', step === 2);
                            }
                        });

                        createInteractiveSection({
                            nextBtn: document.getElementById('slope-anim-next-constant'), backBtn: document.getElementById('slope-anim-back-constant'), stepCounter: document.getElementById('step-counter-constant'), explanationDiv: document.getElementById('animation-explanation-constant'), totalSteps: 3,
                            stepsContent: [
                                { text: "اضغط على 'التالي' لبدء الشرح خطوة بخطوة." },
                                { text: "<strong>1. نجد التغير الرأسي (الارتفاع):</strong> أربع خطوات للأسفل (-٤)." },
                                { text: "<strong>2. نجد التغير الأفقي (الامتداد):</strong> أربع خطوات لليمين (+٤)." },
                                { text: \`<strong>3. نحسب الميل:</strong><br><div class="p-2 bg-blue-100 rounded-md text-blue-800 text-lg mt-2">الميل = \${fractionHTML('الارتفاع','الامتداد')} = \${fractionHTML('-٤','٤')} = -١</div>\` }
                            ],
                            customRender: (step) => {
                                document.getElementById('anim-const-step-1').style.opacity = step >= 1 ? '1' : '0';
                                document.getElementById('anim-const-step-2').style.opacity = step >= 1 ? '1' : '0';
                                document.getElementById('anim-const-step-3').style.opacity = step >= 2 ? '1' : '0';
                                document.getElementById('anim-const-step-4').style.opacity = step >= 2 ? '1' : '0';
                            }
                        });

                        createInteractiveSection({
                            nextBtn: document.getElementById('slope-anim-next-non-constant'), backBtn: document.getElementById('slope-anim-back-non-constant'), stepCounter: document.getElementById('step-counter-non-constant'), explanationDiv: document.getElementById('animation-explanation-non-constant'), totalSteps: 7,
                            stepsContent: [
                                { text: "اضغط 'التالي' لتحليل معدل التغير لكل فترة." },
                                { text: \`<strong>الفترة الأولى (بين عامي ٢٦ و ٢٨):</strong><br>يظهر الرسم امتدادًا بمقدار ٢ و ارتفاعًا بمقدار ١.\` },
                                { text: \`معدل التغير = <div class="math-eq inline-block">\${fractionHTML('١','٢')}</div>\` },
                                { text: \`<strong>الفترة الثانية (بين عامي ٢٨ و ٣٠):</strong><br>يظهر الرسم امتدادًا بمقدار ٢ و ارتفاعًا بمقدار ٢.\` },
                                { text: \`معدل التغير = <div class="math-eq inline-block">\${fractionHTML('٢','٢')} = ١</div>\` },
                                { text: \`<strong>الفترة الثالثة (بين عامي ٣٠ و ٣٢):</strong><br>يظهر الرسم امتدادًا بمقدار ٢ و ارتفاعًا بمقدار ١.\` },
                                { text: \`معدل التغير = <div class="math-eq inline-block">\${fractionHTML('١','٢')}</div>\` },
                                { text: \`<strong>الاستنتاج:</strong><br>بما أن المعدلات (\${fractionHTML('١','٢')}، ١، \${fractionHTML('١','٢')}) مختلفة، فإن <span class="font-bold text-red-600">معدل التغير غير ثابت</span>.\` }
                            ],
                            customRender: (step) => {
                                const anim1 = document.getElementById('nc-anim-group-1'); const anim2 = document.getElementById('nc-anim-group-2'); const anim3 = document.getElementById('nc-anim-group-3');
                                anim1.style.opacity = (step >= 1 && step < 3) ? '1' : '0';
                                anim2.style.opacity = (step >= 3 && step < 5) ? '1' : '0';
                                anim3.style.opacity = (step >= 5 && step < 7) ? '1' : '0';
                                document.getElementById('nc-line-1').style.stroke = (step >= 1 && step < 3) ? '#dc2626' : '#f97316';
                                document.getElementById('nc-line-2').style.stroke = (step >= 3 && step < 5) ? '#dc2626' : '#f97316';
                                document.getElementById('nc-line-3').style.stroke = (step >= 5 && step < 7) ? '#dc2626' : '#f97316';
                            }
                        });

                        createInteractiveSection({
                            nextBtn: document.getElementById('slope-ex1-next'), backBtn: document.getElementById('slope-ex1-back'), stepCounter: document.getElementById('slope-ex1-step-counter'), explanationDiv: document.getElementById('slope-ex1-explanation'), totalSteps: 4,
                            stepsContent: [
                                { text: "اضغط 'التالي' لبدء الحل." },
                                { text: \`<strong>1. كتابة صيغة الميل:</strong><br><div class="math-eq text-center mt-2">م = \${fractionHTML('ص₂ - ص₁', 'س₂ - س₁')}</div>\` },
                                { text: \`<strong>2. التعويض في الصيغة:</strong><br><div class="math-eq text-center mt-2">م = \${fractionHTML('<span class="highlight-y">٧</span> - <span class="highlight-y">١</span>', '<span class="highlight-x">٥</span> - <span class="highlight-x">٢</span>')}</div>\` },
                                { text: \`<strong>3. تبسيط الكسر:</strong><br><div class="math-eq text-center mt-2">م = \${fractionHTML('٦', '٣')}</div>\` },
                                { text: \`<strong>4. الحل النهائي:</strong><br><div class="p-2 bg-green-100 rounded-md inline-block mt-2"><span class="math-eq text-green-700">م = ٢</span></div>\` }
                            ],
                            customRender: () => {}
                        });

                        createInteractiveSection({
                            nextBtn: document.getElementById('slope-ex2-next'), backBtn: document.getElementById('slope-ex2-back'), stepCounter: document.getElementById('slope-ex2-step-counter'), explanationDiv: document.getElementById('slope-ex2-explanation'), totalSteps: 4,
                            stepsContent: [
                                { text: "اضغط 'التالي' لبدء الحل." },
                                { text: \`<strong>1. كتابة صيغة الميل:</strong><br><div class="math-eq text-center mt-2">م = \${fractionHTML('ص₂ - ص₁', 'س₂ - س₁')}</div>\` },
                                { text: \`<strong>2. التعويض في الصيغة:</strong><br><div class="math-eq text-center mt-2">م = \${fractionHTML('<span class="highlight-y">-٢</span> - <span class="highlight-y">٤</span>', '<span class="highlight-x">١</span> - (<span class="highlight-x">-٣</span>)')}</div>\` },
                                { text: \`<strong>3. تبسيط الكسر:</strong><br><div class="math-eq text-center mt-2">م = \${fractionHTML('-٦', '٤')}</div>\` },
                                { text: \`<strong>4. الحل النهائي:</strong><br><div class="p-2 bg-green-100 rounded-md inline-block mt-2"><span class="math-eq text-green-700">م = -\${fractionHTML('٣', '٢')}</span></div>\` }
                            ],
                            customRender: () => {}
                        });

                        createInteractiveSection({
                            nextBtn: document.getElementById('solver-next'), backBtn: document.getElementById('solver-back'), stepCounter: document.getElementById('solver-step-counter'), explanationDiv: document.getElementById('interactive-solver-explanation'), totalSteps: 7,
                            stepsContent: [
                                { text: "اضغط 'التالي' لبدء حل المسألة خطوة بخطوة." },
                                { text: \`<strong>1. كتابة صيغة الميل:</strong><br><div class="math-eq text-center mt-2">م = \${fractionHTML('ص<sub class="text-sm">٢</sub> - ص<sub class="text-sm">١</sub>', 'س<sub class="text-sm">٢</sub> - س<sub class="text-sm">١</sub>')}</div>\` },
                                { text: \`<strong>2. التعويض بالقيم:</strong><br><div class="math-eq text-center mt-2">\${fractionHTML('١','٣')} = \${fractionHTML('<span class="highlight-y">ر</span> - <span class="highlight-y">٤</span>','<span class="highlight-x">-٥</span> - <span class="highlight-x">١</span>')}</div>\` },
                                { text: \`<strong>3. تبسيط المقام:</strong><br><div class="math-eq text-center mt-2">\${fractionHTML('١','٣')} = \${fractionHTML('ر - ٤','-٦')}</div>\` },
                                { text: \`<strong>4. الضرب التبادلي:</strong><br><div class="math-eq text-center mt-2">١ × (-٦) = ٣ × (ر - ٤)</div>\` },
                                { text: \`<strong>5. تبسيط المعادلة:</strong><br><div class="math-eq text-center mt-2">-٦ = ٣ر - ١٢</div>\` },
                                { text: \`<strong>6. حل المعادلة (جمع ١٢ للطرفين):</strong><br><div class="math-eq text-center mt-2">٦ = ٣ر</div>\` },
                                { text: \`<strong>7. الحل النهائي (القسمة على ٣):</strong><br><div class="p-2 bg-green-100 rounded-md inline-block mt-2"><span class="math-eq text-green-700">ر = ٢</span></div>\` }
                            ],
                            customRender: () => {}
                        });
                        
                        const slopeSummaryContainer = document.getElementById('slope-summary-container');
                        if(slopeSummaryContainer) {
                            slopeSummaryContainer.innerHTML = slopeSummarySVG;
                        }
                    })();
                <\/script>
            `, 
            generateQuiz: () => {
                const fractionHTML = (num, den) => `<span class="fraction"><span>${num}</span><span>${den}</span></span>`;
                const questionBank = [
                    { type: 'mcq', level: '⭐', topic: 'concept', text: 'ماذا يصف معدل التغير؟', options: [ { display: 'نقطة بداية الدالة', value: 'A' }, { display: 'كيف تتغير كمية ما بالنسبة لأخرى', value: 'B' }, { display: 'أعلى قيمة تصل إليها الدالة', value: 'C' }, { display: 'طول الخط المستقيم', value: 'D' } ], correct: 'B', explanation: '<p>معدل التغير هو نسبة تقارن مقدار التغير في كمية (مثل المسافة) بمقدار التغير في كمية أخرى (مثل الزمن).</p>' },
                    { type: 'mcq', level: '⭐', topic: 'concept', text: 'في دالة خطية، اسم آخر لمعدل التغير هو:', options: [ { display: 'المقطع السيني', value: 'A' }, { display: 'الميل', value: 'B' }, { display: 'نقطة الأصل', value: 'C' }, { display: 'المجال', value: 'D' } ], correct: 'B', explanation: '<p>الميل هو الاسم الذي يطلق على معدل التغير الثابت في أي دالة خطية.</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'concept', text: 'عندما يتحرك الخط المستقيم للأعلى عند التحرك من اليسار إلى اليمين، يكون ميله:', options: [ { display: 'موجبًا', value: 'A' }, { display: 'سالبًا', value: 'B' }, { display: 'صفرًا', value: 'C' }, { display: 'غير معرف', value: 'D' } ], correct: 'A', explanation: '<p>الميل الموجب يعني أن الخط يتجه صعودًا عند النظر إليه من اليسار إلى اليمين.</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'table-rate', text: 'من الجدول، هل معدل التغير ثابت؟ وإذا كان كذلك، فما قيمته؟', graph: `<div class="flex justify-center my-2"><table class="w-2/3 text-center border"> <thead class="bg-gray-200"><tr><th class="p-1 border">س</th><th class="p-1 border">ص</th></tr></thead> <tbody> <tr><td class="p-1 border">٢</td><td class="p-1 border">٥</td></tr> <tr><td class="p-1 border">٤</td><td class="p-1 border">١٠</td></tr> <tr><td class="p-1 border">٦</td><td class="p-1 border">١٥</td></tr> </tbody></table></div>`, options: [ { display: `نعم، ثابت ويساوي <span class="math-eq">${fractionHTML('5','2')}</span>`, value: 'A' }, { display: `نعم، ثابت ويساوي <span class="math-eq">${fractionHTML('2','5')}</span>`, value: 'B' }, { display: 'لا، غير ثابت', value: 'C' }, { display: 'نعم، ثابت ويساوي ٥', value: 'D' } ], correct: 'A', explanation: `<p>المعدل بين النقطتين الأولى والثانية هو ${fractionHTML('١٠ - ٥','٤ - ٢')} = ${fractionHTML('٥','٢')}.<br>المعدل بين النقطتين الثانية والثالثة هو ${fractionHTML('١٥ - ١٠','٦ - ٤')} = ${fractionHTML('٥','٢')}.<br>بما أن المعدل متساوٍ، فهو ثابت.</p>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'table-rate', text: 'من الجدول، هل معدل التغير ثابت؟', graph: `<div class="flex justify-center my-2"><table class="w-2/3 text-center border"> <thead class="bg-gray-200"><tr><th class="p-1 border">س</th><th class="p-1 border">ص</th></tr></thead> <tbody> <tr><td class="p-1 border">١</td><td class="p-1 border">١٠</td></tr> <tr><td class="p-1 border">٢</td><td class="p-1 border">٢٠</td></tr> <tr><td class="p-1 border">٤</td><td class="p-1 border">٥٠</td></tr> </tbody></table></div>`, options: [ { display: 'نعم، ثابت ويساوي ١٠', value: 'A' }, { display: 'لا، غير ثابت', value: 'B' }, { display: 'نعم، ثابت ويساوي ١٥', value: 'C' }, { display: 'نعم، ثابت ويساوي ١٢.٥', value: 'D' } ], correct: 'B', explanation: `<p>المعدل بين النقطتين الأولى والثانية هو ${fractionHTML('٢٠ - ١٠','٢ - ١')} = ١٠.<br>المعدل بين النقطتين الثانية والثالثة هو ${fractionHTML('٥٠ - ٢٠','٤ - ٢')} = ${fractionHTML('٣٠','٢')} = ١٥.<br>بما أن ١٠ ≠ ١٥، فالمعدل غير ثابت.</p>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'graph-rate', text: 'من الرسم البياني، ما قيمة الميل؟', graph: '<svg viewBox="-1 -1 7 7" class="w-full h-40 bg-white border rounded-lg mt-2"><path d="M 0,1 L 6,1 M 0,2 L 6,2 M 0,3 L 6,3 M 0,4 L 6,4 M 0,5 L 6,5 M 1,0 L 1,6 M 2,0 L 2,6 M 3,0 L 3,6 M 4,0 L 4,6 M 5,0 L 5,6" stroke="#e5e7eb" stroke-width="0.1" /><line x1="0" y1="6" x2="0" y2="0" stroke="#9ca3af" stroke-width="0.15" /><line x1="0" y1="6" x2="6" y2="6" stroke="#9ca3af" stroke-width="0.15" /><line x1="1" y1="5" x2="3" y2="1" stroke="#3b82f6" stroke-width="0.3" /><circle cx="1" cy="5" r="0.15" fill="#ef4444" /><circle cx="3" cy="1" r="0.15" fill="#ef4444" /></svg>', options: [ { display: '٢', value: 'A' }, { display: '-٢', value: 'B' }, { display: 'لا، غير ثابت', value: 'C' }, { display: `-${fractionHTML('1','2')}`, value: 'D' } ], correct: 'B', explanation: `<p>الخط يمر بالنقطتين (١، ٥) و (٣، ١).<br>الميل = ${fractionHTML('١ - ٥','٣ - ١')} = ${fractionHTML('-٤','٢')} = -٢.</p>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'two-point-calc', text: 'أوجد ميل المستقيم المار بالنقطتين (٢, ٥) و (٤, ٩).', options: [ { display: '<span class="math-eq">٢</span>', value: 'A' }, { display: `<span class="math-eq">${fractionHTML('١','٢')}</span>`, value: 'B' }, { display: '<span class="math-eq">-٢</span>', value: 'C' }, { display: '<span class="math-eq">٤</span>', value: 'D' } ], correct: 'A', explanation: `<p>الميل = ${fractionHTML('٩ - ٥','٤ - ٢')} = ${fractionHTML('٤','٢')} = ٢.</p>` },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'two-point-calc', text: 'أوجد ميل المستقيم المار بالنقطتين (-١, ٣) و (٢, -٣).', options: [ { display: '<span class="math-eq">٢</span>', value: 'A' }, { display: '<span class="math-eq">٠</span>', value: 'B' }, { display: '<span class="math-eq">-٢</span>', value: 'C' }, { display: '<span class="math-eq">غير معرف</span>', value: 'D' } ], correct: 'C', explanation: `<p>الميل = ${fractionHTML('-٣ - ٣','٢ - (-١)')} = ${fractionHTML('-٦','٣')} = -٢.</p>` },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'find-coordinate', text: 'أوجد قيمة (ر) التي تجعل ميل المستقيم المار بالنقطتين (٢، ر) و (٥، ٨) يساوي ٢.', options: [ { display: '٢', value: 'A' }, { display: '١٤', value: 'B' }, { display: '٤', value: 'C' }, { display: '١', value: 'D' } ], correct: 'A', explanation: `<p>نستخدم صيغة الميل: ٢ = ${fractionHTML('٨ - ر', '٥ - ٢')}.<br>٢ = ${fractionHTML('٨ - ر', '٣')}.<br>٦ = ٨ - ر.<br>إذًا، ر = ٢.</p>` },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'real-life', text: 'طابعة تطبع ١٢٠ صفحة في ٤ دقائق. ما هو معدل تغير عدد الصفحات المطبوعة في الدقيقة؟', options: [ { display: '٣٠ صفحة/دقيقة', value: 'A' }, { display: '٤٨٠ صفحة/دقيقة', value: 'B' }, { display: '٤٠ صفحة/دقيقة', value: 'C' }, { display: '١٢٠ صفحة/دقيقة', value: 'D' } ], correct: 'A', explanation: `<p>معدل التغير = ${fractionHTML('١٢٠ صفحة','٤ دقائق')} = ٣٠ صفحة/دقيقة.</p>` }
                ];
                const shuffledQuestions = [...questionBank].sort(() => Math.random() - 0.5);
                return shuffledQuestions.slice(0, 5);
            } },
        'c2_l6': { title: 'الدرس ٢-٦: المتتابعات الحسابية كدوال خطية', content:  `
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفاهيم الأساسية</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">المتتابعة الحسابية</h3>
                            <p>التعبير اللفظي: المتتابعة الحسابية نمط عددي يزيد أو ينقص بمقدار ثابت يُسمى <span class="vocab-term">أساس المتتابعة</span> (د).</p>
                            <div class="mt-4 space-y-4">
                                <div class="bg-white p-3 rounded-lg border">
                                    <p><strong>مثال (زيادة):</strong> ٣، ٥، ٧، ٩، ١١، ...</p>
                                    <p class="text-green-600 font-bold">هنا، كل حد يزيد بمقدار ٢ عن الحد الذي يسبقه. إذن، الأساس د = ٢.</p>
                                </div>
                                <div class="bg-white p-3 rounded-lg border">
                                    <p><strong>مثال (نقصان):</strong> ٣٣، ٢٩، ٢٥، ٢١، ١٧، ...</p>
                                    <p class="text-red-600 font-bold">هنا، كل حد ينقص بمقدار ٤ عن الحد الذي يسبقه. إذن، الأساس د = -٤.</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">الحد النوني في متتابعة حسابية</h3>
                            <p>يُعبّر عن الحد النوني (أ<sub class="font-bold">ن</sub>) لمتتابعة حسابية حدها الأول (أ<sub class="font-bold">١</sub>)، وأساسها (د) بالصيغة التالية، حيث (ن) عدد صحيح موجب.</p>
                            <div class="mt-4 p-4 bg-white rounded-lg border">
                                <p class="text-lg text-center font-bold">صيغة الحد النوني</p>
                                <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-xl math-eq">
                                    أ<sub class="font-bold">ن</sub> = أ<sub class="font-bold">١</sub> + (ن - ١) د
                                </p>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: تمييز المتتابعات</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4">
                        <p>هل المتتابعات التالية حسابية أم لا؟ اتبع الخطوات التفاعلية لمعرفة ذلك.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Example 1: Arithmetic -->
                            <div class="border p-4 rounded-lg bg-white">
                                <h3 class="font-bold text-center mb-2 text-lg">مثال 1: متتابعة حسابية</h3>
                                <div class="text-center my-4">
                                    <span id="seq-box-1" class="sequence-box">٥</span>
                                    <span id="diff-1" class="diff-arrow plus">&nbsp;</span>
                                    <span id="seq-box-2" class="sequence-box">١١</span>
                                    <span id="diff-2" class="diff-arrow plus">&nbsp;</span>
                                    <span id="seq-box-3" class="sequence-box">١٧</span>
                                    <span id="diff-3" class="diff-arrow plus">&nbsp;</span>
                                    <span id="seq-box-4" class="sequence-box">٢٣</span>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg border min-h-[150px]">
                                    <div id="identify-explanation-1" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="identify-anim-back-1" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="identify-step-counter-1">0</span> / 4</span>
                                    <button id="identify-anim-next-1" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                            <!-- Example 2: Not Arithmetic -->
                            <div class="border p-4 rounded-lg bg-white">
                                <h3 class="font-bold text-center mb-2 text-lg">مثال 2: ليست حسابية</h3>
                                <div class="text-center my-4">
                                    <span id="seq-box-2-1" class="sequence-box">١</span>
                                    <span id="diff-2-1" class="diff-arrow plus">&nbsp;</span>
                                    <span id="seq-box-2-2" class="sequence-box">٢</span>
                                    <span id="diff-2-2" class="diff-arrow plus">&nbsp;</span>
                                    <span id="seq-box-2-3" class="sequence-box">٤</span>
                                    <span id="diff-2-3" class="diff-arrow plus">&nbsp;</span>
                                    <span id="seq-box-2-4" class="sequence-box">٧</span>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg border min-h-[150px]">
                                    <div id="identify-explanation-2" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="identify-anim-back-2" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="identify-step-counter-2">0</span> / 4</span>
                                    <button id="identify-anim-next-2" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🔍 ثالثاً: إيجاد الحدود التالية (تفاعلي)</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4">
                        <p>أوجد الحدود التالية في المتتابعات الحسابية التالية.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Example 1: Positive Difference -->
                            <div class="border p-4 rounded-lg bg-white">
                                <h3 class="font-bold text-center mb-2 text-lg">مثال 1: أساس موجب</h3>
                                <div class="text-center my-4 flex justify-center items-center flex-wrap">
                                    <span id="next-term-box-1" class="sequence-box">٢</span>
                                    <span id="next-term-diff-1" class="diff-arrow plus">&nbsp;</span>
                                    <span id="next-term-box-2" class="sequence-box">٥</span>
                                    <span id="next-term-diff-2" class="diff-arrow plus">&nbsp;</span>
                                    <span id="next-term-box-3" class="sequence-box">٨</span>
                                    <span id="next-term-diff-3" class="diff-arrow plus">&nbsp;</span>
                                    <span id="next-term-box-4" class="sequence-box">١١</span>
                                    <span id="next-term-diff-4" class="diff-arrow plus">&nbsp;</span>
                                    <span id="next-term-box-5" class="sequence-box text-gray-400">?</span>
                                    <span id="next-term-diff-5" class="diff-arrow plus">&nbsp;</span>
                                    <span id="next-term-box-6" class="sequence-box text-gray-400">?</span>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg border min-h-[120px]">
                                    <div id="next-term-explanation-1" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="next-term-back-1" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="next-term-counter-1">0</span> / 4</span>
                                    <button id="next-term-next-1" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                            <!-- Example 2: Negative Difference -->
                            <div class="border p-4 rounded-lg bg-white">
                                <h3 class="font-bold text-center mb-2 text-lg">مثال 2: أساس سالب</h3>
                                <div class="text-center my-4 flex justify-center items-center flex-wrap">
                                    <span id="next-term-2-box-1" class="sequence-box">٢٠</span>
                                    <span id="next-term-2-diff-1" class="diff-arrow minus">&nbsp;</span>
                                    <span id="next-term-2-box-2" class="sequence-box">١٥</span>
                                    <span id="next-term-2-diff-2" class="diff-arrow minus">&nbsp;</span>
                                    <span id="next-term-2-box-3" class="sequence-box">١٠</span>
                                    <span id="next-term-2-diff-3" class="diff-arrow minus">&nbsp;</span>
                                    <span id="next-term-2-box-4" class="sequence-box">٥</span>
                                    <span id="next-term-2-diff-4" class="diff-arrow minus">&nbsp;</span>
                                    <span id="next-term-2-box-5" class="sequence-box text-gray-400">?</span>
                                    <span id="next-term-2-diff-5" class="diff-arrow minus">&nbsp;</span>
                                    <span id="next-term-2-box-6" class="sequence-box text-gray-400">?</span>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg border min-h-[120px]">
                                    <div id="next-term-explanation-2" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="next-term-back-2" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="next-term-counter-2">0</span> / 4</span>
                                    <button id="next-term-next-2" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">📈 رابعاً: كتابة معادلة الحد النوني (طريقتان)</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4">
                        <p>اكتب معادلة الحد النوني للمتتابعة الحسابية: ٣، ١٠، ١٧، ٢٤، ...</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Method 1: Formal Formula -->
                            <div class="border p-4 rounded-lg bg-white">
                                <h3 class="font-bold text-center mb-2 text-lg">الطريقة الرسمية (بالصيغة)</h3>
                                <div class="bg-gray-50 p-4 rounded-lg border min-h-[280px]">
                                    <div id="nth-term-formal-explanation" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="nth-term-formal-back" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="nth-term-formal-counter">0</span> / 5</span>
                                    <button id="nth-term-formal-next" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                            <!-- Method 2: Mental Math -->
                            <div class="border p-4 rounded-lg bg-white">
                                <h3 class="font-bold text-center mb-2 text-lg">الطريقة الذهنية (السريعة)</h3>
                                <div class="bg-gray-50 p-4 rounded-lg border min-h-[280px]">
                                    <div id="nth-term-mental-explanation" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="nth-term-mental-back" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="nth-term-mental-counter">0</span> / 3</span>
                                    <button id="nth-term-mental-next" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <script>
                (function() {
                    function createInteractiveSection(config) {
                        let currentStep = 0;
                        const renderStep = (step) => {
                            if(config.stepCounter) config.stepCounter.textContent = step;
                            let cumulativeHTML = '';
                            if (step === 0) {
                                cumulativeHTML = config.stepsContent[0].text;
                            } else {
                                for (let i = 1; i <= step; i++) {
                                    cumulativeHTML += '<div class="explanation-step">' + config.stepsContent[i].text + '</div>';
                                }
                            }
                            if(config.explanationDiv) config.explanationDiv.innerHTML = cumulativeHTML;
                            if (config.customRender) {
                                config.customRender(step);
                            }
                            if(config.backBtn) {
                                config.backBtn.disabled = (step === 0);
                                config.backBtn.classList.toggle('btn-disabled', config.backBtn.disabled);
                            }
                            if(config.nextBtn) config.nextBtn.textContent = (step === config.totalSteps) ? 'إعادة' : 'التالي';
                        };
                        
                        if(config.nextBtn) config.nextBtn.addEventListener('click', () => {
                            currentStep = (currentStep < config.totalSteps) ? currentStep + 1 : 0;
                            renderStep(currentStep);
                        });
                        
                        if(config.backBtn) config.backBtn.addEventListener('click', () => {
                            if (currentStep > 0) {
                                currentStep--;
                                renderStep(currentStep);
                            }
                        });
                        
                        renderStep(0);
                    }

                    // --- Interactive Section 2, Example 1 (Arithmetic) ---
                    createInteractiveSection({
                        nextBtn: document.getElementById('identify-anim-next-1'),
                        backBtn: document.getElementById('identify-anim-back-1'),
                        stepCounter: document.getElementById('identify-step-counter-1'),
                        explanationDiv: document.getElementById('identify-explanation-1'),
                        totalSteps: 4,
                        stepsContent: [
                            { text: "نتحقق من أن الفرق بين كل حدين متتاليين ثابت." },
                            { text: "<strong>1. الفرق بين الحد الثاني والأول:</strong><br><span class='math-eq'>١١ - ٥ = ٦</span>" },
                            { text: "<strong>2. الفرق بين الحد الثالث والثاني:</strong><br><span class='math-eq'>١٧ - ١١ = ٦</span>" },
                            { text: "<strong>3. الفرق بين الحد الرابع والثالث:</strong><br><span class='math-eq'>٢٣ - ١٧ = ٦</span>" },
                            { text: '<strong>4. النتيجة:</strong> بما أن الفرق ثابت ويساوي ٦، فالمتتابعة <span class="font-bold text-green-600">حسابية</span> وأساسها (د) هو ٦.' }
                        ],
                        customRender: (step) => {
                            for(let i=1; i<=3; i++) {
                                const diffEl = document.getElementById('diff-' + i);
                                if(diffEl) {
                                    diffEl.style.opacity = '0';
                                    diffEl.innerHTML = '&nbsp;';
                                }
                            }
                            for(let i=1; i<=4; i++) {
                                const seqBox = document.getElementById('seq-box-' + i);
                                if(seqBox) seqBox.classList.remove('bg-blue-100');
                            }
                            if (step >= 1) {
                                document.getElementById('seq-box-1').classList.add('bg-blue-100');
                                document.getElementById('seq-box-2').classList.add('bg-blue-100');
                                const diff1 = document.getElementById('diff-1');
                                diff1.innerHTML = '+٦';
                                diff1.style.opacity = '1';
                            }
                            if (step >= 2) {
                                document.getElementById('seq-box-3').classList.add('bg-blue-100');
                                const diff2 = document.getElementById('diff-2');
                                diff2.innerHTML = '+٦';
                                diff2.style.opacity = '1';
                            }
                            if (step >= 3) {
                                document.getElementById('seq-box-4').classList.add('bg-blue-100');
                                const diff3 = document.getElementById('diff-3');
                                diff3.innerHTML = '+٦';
                                diff3.style.opacity = '1';
                            }
                        }
                    });
                    
                    // --- Interactive Section 2, Example 2 (Not Arithmetic) ---
                    createInteractiveSection({
                        nextBtn: document.getElementById('identify-anim-next-2'),
                        backBtn: document.getElementById('identify-anim-back-2'),
                        stepCounter: document.getElementById('identify-step-counter-2'),
                        explanationDiv: document.getElementById('identify-explanation-2'),
                        totalSteps: 4,
                        stepsContent: [
                            { text: "نتحقق من أن الفرق بين كل حدين متتاليين ثابت." },
                            { text: "<strong>1. الفرق بين الحد الثاني والأول:</strong><br><span class='math-eq'>٢ - ١ = ١</span>" },
                            { text: "<strong>2. الفرق بين الحد الثالث والثاني:</strong><br><span class='math-eq'>٤ - ٢ = ٢</span>" },
                            { text: "<strong>3. الفرق بين الحد الرابع والثالث:</strong><br><span class='math-eq'>٧ - ٤ = ٣</span>" },
                            { text: '<strong>4. النتيجة:</strong> بما أن الفرق <span class="font-bold text-red-600">غير ثابت</span>، فالمتتابعة <span class="font-bold text-red-600">ليست حسابية</span>.' }
                        ],
                        customRender: (step) => {
                            const diffs = ['+١', '+٢', '+٣'];
                            for(let i=1; i<=3; i++) {
                                const diffEl = document.getElementById('diff-2-' + i);
                                if(diffEl) {
                                    diffEl.style.opacity = '0';
                                    diffEl.innerHTML = '&nbsp;';
                                }
                            }
                            for(let i=1; i<=4; i++) {
                                const seqBox = document.getElementById('seq-box-2-' + i);
                                if(seqBox) seqBox.classList.remove('bg-blue-100');
                            }
                            if (step >= 1) {
                                document.getElementById('seq-box-2-1').classList.add('bg-blue-100');
                                document.getElementById('seq-box-2-2').classList.add('bg-blue-100');
                                const diff1 = document.getElementById('diff-2-1');
                                diff1.innerHTML = diffs[0];
                                diff1.style.opacity = '1';
                            }
                            if (step >= 2) {
                                document.getElementById('seq-box-2-3').classList.add('bg-blue-100');
                                const diff2 = document.getElementById('diff-2-2');
                                diff2.innerHTML = diffs[1];
                                diff2.style.opacity = '1';
                            }
                            if (step >= 3) {
                                document.getElementById('seq-box-2-4').classList.add('bg-blue-100');
                                const diff3 = document.getElementById('diff-2-3');
                                diff3.innerHTML = diffs[2];
                                diff3.style.opacity = '1';
                            }
                        }
                    });

                    // --- Interactive Section 3, Example 1 (Positive Difference) ---
                    createInteractiveSection({
                        nextBtn: document.getElementById('next-term-next-1'),
                        backBtn: document.getElementById('next-term-back-1'),
                        stepCounter: document.getElementById('next-term-counter-1'),
                        explanationDiv: document.getElementById('next-term-explanation-1'),
                        totalSteps: 4,
                        stepsContent: [
                            { text: "نكتشف النمط (الأساس) أولاً ثم نطبقه لإيجاد الحدود التالية." },
                            { text: "<strong>1. نوجد الفرق بين الحدين الأولين:</strong><br><span class='math-eq'>٥ - ٢ = ٣</span>. الأساس هو +٣." },
                            { text: "<strong>2. نستخدم الأساس لإيجاد الحد الخامس:</strong><br><span class='math-eq'>١١ + ٣ = ١٤</span>." },
                            { text: "<strong>3. نكرر العملية لإيجاد الحد السادس:</strong><br><span class='math-eq'>١٤ + ٣ = ١٧</span>." },
                            { text: "<strong>4. الحدود التالية هي ١٤ و ١٧.</strong>" }
                        ],
                        customRender: (step) => {
                            for(let i = 1; i <= 5; i++) {
                                if(document.getElementById('next-term-diff-' + i)) document.getElementById('next-term-diff-' + i).style.opacity = '0';
                                if(document.getElementById('next-term-box-' + i)) document.getElementById('next-term-box-' + i).classList.remove('bg-blue-100', 'bg-green-100');
                            }
                            document.getElementById('next-term-box-5').textContent = '?';
                            document.getElementById('next-term-box-5').classList.add('text-gray-400');
                            document.getElementById('next-term-box-6').textContent = '?';
                            document.getElementById('next-term-box-6').classList.add('text-gray-400');

                            if (step >= 1) {
                                document.getElementById('next-term-box-1').classList.add('bg-blue-100');
                                document.getElementById('next-term-box-2').classList.add('bg-blue-100');
                                document.getElementById('next-term-diff-1').innerHTML = '+٣';
                                document.getElementById('next-term-diff-1').style.opacity = '1';
                            }
                            if (step >= 2) {
                                  document.getElementById('next-term-box-4').classList.add('bg-blue-100');
                                  document.getElementById('next-term-diff-4').innerHTML = '+٣';
                                  document.getElementById('next-term-diff-4').style.opacity = '1';
                                  const box5 = document.getElementById('next-term-box-5');
                                  box5.textContent = '١٤';
                                  box5.classList.remove('text-gray-400');
                                  box5.classList.add('bg-green-100');
                            }
                            if (step >= 3) {
                                  document.getElementById('next-term-box-5').classList.add('bg-blue-100');
                                  document.getElementById('next-term-diff-5').innerHTML = '+٣';
                                  document.getElementById('next-term-diff-5').style.opacity = '1';
                                  const box6 = document.getElementById('next-term-box-6');
                                  box6.textContent = '١٧';
                                  box6.classList.remove('text-gray-400');
                                  box6.classList.add('bg-green-100');
                            }
                        }
                    });

                    // --- Interactive Section 3, Example 2 (Negative Difference) ---
                    createInteractiveSection({
                        nextBtn: document.getElementById('next-term-next-2'),
                        backBtn: document.getElementById('next-term-back-2'),
                        stepCounter: document.getElementById('next-term-counter-2'),
                        explanationDiv: document.getElementById('next-term-explanation-2'),
                        totalSteps: 4,
                        stepsContent: [
                            { text: "نكتشف النمط (الأساس) أولاً ثم نطبقه لإيجاد الحدود التالية." },
                            { text: "<strong>1. نوجد الفرق بين الحدين الأولين:</strong><br><span class='math-eq'>١٥ - ٢٠ = -٥</span>. الأساس هو -٥." },
                            { text: "<strong>2. نستخدم الأساس لإيجاد الحد الخامس:</strong><br><span class='math-eq'>٥ + (-٥) = ٠</span>." },
                            { text: "<strong>3. نكرر العملية لإيجاد الحد السادس:</strong><br><span class='math-eq'>٠ + (-٥) = -٥</span>." },
                            { text: "<strong>4. الحدود التالية هي ٠ و -٥.</strong>" }
                        ],
                        customRender: (step) => {
                            for(let i = 1; i <= 5; i++) {
                                if(document.getElementById('next-term-2-diff-' + i)) document.getElementById('next-term-2-diff-' + i).style.opacity = '0';
                                if(document.getElementById('next-term-2-box-' + i)) document.getElementById('next-term-2-box-' + i).classList.remove('bg-blue-100', 'bg-green-100');
                            }
                            document.getElementById('next-term-2-box-5').textContent = '?';
                            document.getElementById('next-term-2-box-5').classList.add('text-gray-400');
                            document.getElementById('next-term-2-box-6').textContent = '?';
                            document.getElementById('next-term-2-box-6').classList.add('text-gray-400');

                            if (step >= 1) {
                                document.getElementById('next-term-2-box-1').classList.add('bg-blue-100');
                                document.getElementById('next-term-2-box-2').classList.add('bg-blue-100');
                                document.getElementById('next-term-2-diff-1').innerHTML = '-٥';
                                document.getElementById('next-term-2-diff-1').style.opacity = '1';
                            }
                            if (step >= 2) {
                                  document.getElementById('next-term-2-box-4').classList.add('bg-blue-100');
                                  document.getElementById('next-term-2-diff-4').innerHTML = '-٥';
                                  document.getElementById('next-term-2-diff-4').style.opacity = '1';
                                  const box5 = document.getElementById('next-term-2-box-5');
                                  box5.textContent = '٠';
                                  box5.classList.remove('text-gray-400');
                                  box5.classList.add('bg-green-100');
                            }
                            if (step >= 3) {
                                  document.getElementById('next-term-2-box-5').classList.add('bg-blue-100');
                                  document.getElementById('next-term-2-diff-5').innerHTML = '-٥';
                                  document.getElementById('next-term-2-diff-5').style.opacity = '1';
                                  const box6 = document.getElementById('next-term-2-box-6');
                                  box6.textContent = '-٥';
                                  box6.classList.remove('text-gray-400');
                                  box6.classList.add('bg-green-100');
                            }
                        }
                    });

                    // --- Interactive Section 4: Formal Method ---
                    createInteractiveSection({
                        nextBtn: document.getElementById('nth-term-formal-next'),
                        backBtn: document.getElementById('nth-term-formal-back'),
                        stepCounter: document.getElementById('nth-term-formal-counter'),
                        explanationDiv: document.getElementById('nth-term-formal-explanation'),
                        totalSteps: 5,
                        stepsContent: [
                            { text: "نستخدم الصيغة العامة ونعوض فيها بالقيم." },
                            { text: "<strong>1. نبدأ بصيغة الحد النوني:</strong><br><span class='math-eq text-center mt-2 block'>أ<sub class='font-bold'>ن</sub> = أ<sub class='font-bold'>١</sub> + (ن - ١) د</span>" },
                            { text: "<strong>2. نحدد الحد الأول (أ<sub class='font-bold'>١</sub>) والأساس (د):</strong><br>الحد الأول <span class='math-eq'>أ<sub class='font-bold'>١</sub> = ٣</span>.<br>الأساس <span class='math-eq'>د = ١٠ - ٣ = ٧</span>." },
                            { text: "<strong>3. نعوض بالقيم في الصيغة:</strong><br><span class='math-eq text-center mt-2 block'>أ<sub class='font-bold'>ن</sub> = <span class='text-red-600'>٣</span> + (ن - ١) × <span class='text-green-600'>٧</span></span>" },
                            { text: "<strong>4. نستخدم خاصية التوزيع:</strong><br><span class='math-eq text-center mt-2 block'>أ<sub class='font-bold'>ن</sub> = ٣ + ٧ن - ٧</span>" },
                            { text: "<strong>5. نجمع الحدود المتشابهة:</strong><br><span class='math-eq text-center mt-2 block p-2 bg-green-100 rounded-md'>أ<sub class='font-bold'>ن</sub> = ٧ن - ٤</span>" }
                        ]
                    });

                    // --- Interactive Section 4: Mental Method ---
                    createInteractiveSection({
                        nextBtn: document.getElementById('nth-term-mental-next'),
                        backBtn: document.getElementById('nth-term-mental-back'),
                        stepCounter: document.getElementById('nth-term-mental-counter'),
                        explanationDiv: document.getElementById('nth-term-mental-explanation'),
                        totalSteps: 3,
                        stepsContent: [
                            { text: "هذه طريقة سريعة لإيجاد المعادلة مباشرة." },
                            { text: "<strong>1. نوجد الأساس (د):</strong><br><span class='math-eq'>١٠ - ٣ = ٧</span>.<br>إذن، الحد النوني يبدأ بـ <span class='math-eq'>٧ن</span>." },
                            { text: "<strong>2. نقارن الحد النوني الابتدائي بالحد الأول:</strong><br>الحد الأول الفعلي هو <span class='math-eq text-red-600'>٣</span>. والفرق بينه وبين الأساس هو <span class='math-eq'>٣ - ٧ = -٤</span>." },
                            { text: "<strong>3. نكتب المعادلة النهائية:</strong><br>نضيف الفرق الذي أوجدناه إلى الحد النوني الابتدائي.<br><span class='math-eq text-center mt-2 block p-2 bg-green-100 rounded-md'>أ<sub class='font-bold'>ن</sub> = ٧ن - ٤</span>" }
                        ]
                    });
                })();
                <\/script>
            `, 
            generateQuiz: () => { 
                const fractionHTML = (num, den) => `<span class="fraction"><span>${num}</span><span class="frac-bar"></span><span>${den}</span></span>`;
                const questionBank = [
                    { type: 'mcq', level: '⭐', topic: 'concept', text: 'ما هو الاسم الذي يطلق على المقدار الثابت الذي يضاف لكل حد في المتتابعة الحسابية؟', options: [ { display: 'الحد الأول', value: 'A' }, { display: 'الحد النوني', value: 'B' }, { display: 'الأساس', value: 'C' }, { display: 'المتغير', value: 'D' } ], correct: 'C', explanation: '<p>يُسمى المقدار الثابت الذي يضاف (أو يطرح) في المتتابعة الحسابية بـ "الأساس" ويرمز له بالرمز (د).</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'identify', text: 'أي من المتتابعات التالية تُعد متتابعة حسابية؟', options: [ { display: '١، ٢، ٤، ٨، ...', value: 'A' }, { display: '١٠، ٧، ٤، ١، ...', value: 'B' }, { display: '١، -١، ٢، -٢، ...', value: 'C' }, { display: '١، ٤، ٩، ١٦، ...', value: 'D' } ], correct: 'B', explanation: '<p>المتتابعة (ب) هي الحسابية لأن الفرق بين كل حدين متتاليين ثابت ويساوي -٣. (٧-١٠ = -٣، ٤-٧ = -٣).</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'find-difference', text: 'ما أساس المتتابعة الحسابية: -٥، -١، ٣، ٧، ...؟', options: [ { display: '-٤', value: 'A' }, { display: '٤', value: 'B' }, { display: '٥', value: 'C' }, { display: '-٥', value: 'D' } ], correct: 'B', explanation: '<p>لإيجاد الأساس، نطرح أي حد من الذي يسبقه. على سبيل المثال: (-١) - (-٥) = -١ + ٥ = ٤.</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'next-term', text: 'أوجد الحد التالي في المتتابعة الحسابية: ٢، ٩، ١٦، ٢٣، ...', options: [ { display: '٢٩', value: 'A' }, { display: '٣٠', value: 'B' }, { display: '٧', value: 'C' }, { display: '٣١', value: 'D' } ], correct: 'B', explanation: '<p>أولاً، نوجد الأساس: ٩ - ٢ = ٧. ثم نضيف الأساس إلى الحد الأخير: ٢٣ + ٧ = ٣٠.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'nth-term-formula', text: 'ما معادلة الحد النوني للمتتابعة: ٤، ٩، ١٤، ١٩، ...؟', options: [ { display: 'أ<sub class="font-bold">ن</sub> = ٤ن + ٥', value: 'A' }, { display: 'أ<sub class="font-bold">ن</sub> = ٥ن + ٤', value: 'B' }, { display: 'أ<sub class="font-bold">ن</sub> = ٥ن - ١', value: 'C' }, { display: 'أ<sub class="font-bold">ن</sub> = ٤ن - ١', value: 'D' } ], correct: 'C', explanation: '<p>الحد الأول أ<sub class="font-bold">١</sub> = ٤ والأساس د = ٩ - ٤ = ٥. نطبق الصيغة: أ<sub class="font-bold">ن</sub> = أ<sub class="font-bold">١</sub> + (ن - ١)د = ٤ + (ن - ١)٥ = ٤ + ٥ن - ٥ = ٥ن - ١.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'find-term', text: 'استخدم المعادلة أ<sub class="font-bold">ن</sub> = ٣ن - ٨ لإيجاد الحد العاشر في المتتابعة.', options: [ { display: '٢٢', value: 'A' }, { display: '٣٠', value: 'B' }, { display: '٣٨', value: 'C' }, { display: '١٥', value: 'D' } ], correct: 'A', explanation: '<p>لإيجاد الحد العاشر، نعوض عن ن بـ ١٠ في المعادلة: أ<sub class="font-bold">١٠</sub> = ٣(١٠) - ٨ = ٣٠ - ٨ = ٢٢.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'find-rank', text: 'ما ترتيب الحد الذي قيمته (٥٥) في المتتابعة الحسابية: ١٠، ١٥، ٢٠، ...؟', options: [ { display: 'الحد العاشر', value: 'A' }, { display: 'الحد التاسع', value: 'B' }, { display: 'الحد الحادي عشر', value: 'C' }, { display: 'الحد الخامس', value: 'D' } ], correct: 'A', explanation: `<div id="explanation-wrapper-q0"><div id="formal-solution-q0"><div class="space-y-3 text-right"><p><strong>1. تحديد المعطيات:</strong></p><ul class="list-disc pr-6"><li>الحد المطلوب (أ<sub class="font-bold">ن</sub>): <span class="math-eq text-red-600">٥٥</span></li><li>الحد الأول (أ<sub class="font-bold">١</sub>): <span class="math-eq text-green-600">١٠</span></li><li>الأساس (د): <span class="math-eq text-blue-600">١٥ - ١٠ = ٥</span></li></ul><p><strong>2. كتابة الصيغة والتعويض:</strong></p><p class="math-eq text-center bg-gray-100 p-2 rounded-md">أ<sub class="font-bold">ن</sub> = أ<sub class="font-bold">١</sub> + (ن - ١) د</p><p class="math-eq text-center"><span class="text-red-600">٥٥</span> = <span class="text-green-600">١٠</span> + (ن - ١) <span class="text-blue-600">٥</span></p><p><strong>3. حل المعادلة لإيجاد (ن):</strong></p><div class="text-center space-y-2"><p class="math-eq">٤٥ = (ن - ١) × ٥</p><div><p class="math-eq">٩ = ن - ١</p><p class="text-xs text-gray-500 italic">(بقسمة الطرفين على ٥)</p></div><div><p class="math-eq"><span class="p-1 bg-green-100 rounded-md">ن = ١٠</span></p><p class="text-xs text-gray-500 italic">(بإضافة ١ للطرفين)</p></div></div></div><button onclick="window.toggleSolution('q0', 'mental')" class="mt-4 w-full bg-purple-100 text-purple-700 font-bold py-2 px-4 rounded-lg hover:bg-purple-200">عرض الحل الذهني</button></div><div id="mental-solution-q0" style="display: none;"><div class="space-y-3 text-right"><p><strong>1. إيجاد معادلة الحد النوني (ذهنياً):</strong></p><ul class="list-disc pr-6"><li>الأساس (د) = <span class="math-eq text-blue-600">٥</span>. إذن المعادلة تبدأ بـ <span class="math-eq">٥ن</span>.</li><li>الحد الأول <span class="math-eq text-green-600">١٠</span>. الفرق عن الأساس: <span class="math-eq">١٠ - ٥ = ٥</span>.</li><li>المعادلة هي: <span class="math-eq bg-gray-100 p-1 rounded-md">أ<sub class="font-bold">ن</sub> = ٥ن + ٥</span>.</li></ul><p><strong>2. مساواة المعادلة بقيمة الحد المطلوب:</strong></p><p class="math-eq text-center">٥ن + ٥ = <span class="text-red-600">٥٥</span></p><p><strong>3. حل المعادلة لإيجاد (ن):</strong></p><div class="text-center space-y-2"><p class="math-eq">٥ن = ٥٥ - ٥</p><p class="math-eq">٥ن = ٥٠</p><div><p class="math-eq"><span class="p-1 bg-green-100 rounded-md">ن = ١٠</span></p><p class="text-xs text-gray-500 italic">(بقسمة الطرفين على ٥)</p></div></div></div><button onclick="window.toggleSolution('q0', 'formal')" class="mt-4 w-full bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300">العودة للحل الرسمي</button></div></div>` },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'find-rank', text: 'ما ترتيب الحد الذي قيمته (٢) في المتتابعة الحسابية: ٢٦، ٢٣، ٢٠، ...؟', options: [ { display: 'الحد الثامن', value: 'A' }, { display: 'الحد التاسع', value: 'B' }, { display: 'الحد السابع', value: 'C' }, { display: 'الحد العاشر', value: 'D' } ], correct: 'B', explanation: `<div id="explanation-wrapper-q1"><div id="formal-solution-q1"><div class="space-y-3 text-right"><p><strong>1. تحديد المعطيات:</strong></p><ul class="list-disc pr-6"><li>الحد المطلوب (أ<sub class="font-bold">ن</sub>): <span class="math-eq text-red-600">٢</span></li><li>الحد الأول (أ<sub class="font-bold">١</sub>): <span class="math-eq text-green-600">٢٦</span></li><li>الأساس (د): <span class="math-eq text-blue-600">٢٣ - ٢٦ = -٣</span></li></ul><p><strong>2. كتابة الصيغة والتعويض:</strong></p><p class="math-eq text-center bg-gray-100 p-2 rounded-md">أ<sub class="font-bold">ن</sub> = أ<sub class="font-bold">١</sub> + (ن - ١) د</p><p class="math-eq text-center"><span class="text-red-600">٢</span> = <span class="text-green-600">٢٦</span> + (ن - ١) (<span class="text-blue-600">-٣</span>)</p><p><strong>3. حل المعادلة لإيجاد (ن):</strong></p><div class="text-center space-y-2"><p class="math-eq">-٢٤ = (ن - ١) × -٣</p><div><p class="math-eq">٨ = ن - ١</p><p class="text-xs text-gray-500 italic">(بقسمة الطرفين على -٣)</p></div><div><p class="math-eq"><span class="p-1 bg-green-100 rounded-md">ن = ٩</span></p><p class="text-xs text-gray-500 italic">(بإضافة ١ للطرفين)</p></div></div></div><button onclick="window.toggleSolution('q1', 'mental')" class="mt-4 w-full bg-purple-100 text-purple-700 font-bold py-2 px-4 rounded-lg hover:bg-purple-200">عرض الحل الذهني</button></div><div id="mental-solution-q1" style="display: none;"><div class="space-y-3 text-right"><p><strong>1. إيجاد معادلة الحد النوني (ذهنياً):</strong></p><ul class="list-disc pr-6"><li>الأساس (د) = <span class="math-eq text-blue-600">-٣</span>. إذن المعادلة تبدأ بـ <span class="math-eq">-٣ن</span>.</li><li>الحد الأول <span class="math-eq text-green-600">٢٦</span>. الفرق عن الأساس: <span class="math-eq">٢٦ - (-٣) = ٢٩</span>.</li><li>المعادلة هي: <span class="math-eq bg-gray-100 p-1 rounded-md">أ<sub class="font-bold">ن</sub> = -٣ن + ٢٩</span>.</li></ul><p><strong>2. مساواة المعادلة بقيمة الحد المطلوب:</strong></p><p class="math-eq text-center">-٣ن + ٢٩ = <span class="text-red-600">٢</span></p><p><strong>3. حل المعادلة لإيجاد (ن):</strong></p><div class="text-center space-y-2"><p class="math-eq">-٣ن = ٢ - ٢٩</p><p class="math-eq">-٣ن = -٢٧</p><div><p class="math-eq"><span class="p-1 bg-green-100 rounded-md">ن = ٩</span></p><p class="text-xs text-gray-500 italic">(بقسمة الطرفين على -٣)</p></div></div></div><button onclick="window.toggleSolution('q1', 'formal')" class="mt-4 w-full bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300">العودة للحل الرسمي</button></div></div>` },
                    { type: 'mcq', level: '⭐⭐', topic: 'identify', text: 'أي من المتتابعات التالية ليست حسابية؟', options: [ { display: '١، ٢، ٣، ٤', value: 'A' }, { display: '٥، ١٠، ١٥، ٢٠', value: 'B' }, { display: '٢، ٤، ٨، ١٦', value: 'C' }, { display: '٥٠، ٤٠، ٣٠، ٢٠', value: 'D' } ], correct: 'C', explanation: '<p>المتتابعة (ج) ليست حسابية لأن الفرق بين حدودها غير ثابت (هندسية، تضرب في ٢ كل مرة).</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'next-term', text: 'أوجد الحدود الثلاثة التالية في المتتابعة: -٨، -٦، -٤، ...', options: [ { display: '-٢، ٠، ٢', value: 'A' }, { display: '-٦، -٨، -١٠', value: 'B' }, { display: '٠، ٢، ٤', value: 'C' }, { display: '-٢، ١، ٣', value: 'D' } ], correct: 'A', explanation: '<p>الأساس هو (-٦) - (-٨) = ٢. الحدود التالية هي -٤+٢=-٢، -٢+٢=٠، ٠+٢=٢.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'nth-term-formula', text: 'ما معادلة الحد النوني للمتتابعة: ١٣، ٨، ٣، -٢، ...؟', options: [ { display: 'أ<sub class="font-bold">ن</sub> = -٥ن + ١٨', value: 'A' }, { display: 'أ<sub class="font-bold">ن</sub> = ٥ن + ٨', value: 'B' }, { display: 'أ<sub class="font-bold">ن</sub> = ١٣ن - ٥', value: 'C' }, { display: 'أ<sub class="font-bold">ن</sub> = -٥ن - ١٨', value: 'D' } ], correct: 'A', explanation: '<p>الحد الأول ١٣ والأساس -٥. باستخدام الطريقة الذهنية: المعادلة تبدأ بـ -٥ن. للوصول من -٥ إلى ١٣ (الحد الأول)، نحتاج لإضافة ١٨. إذن المعادلة هي أ<sub class="font-bold">ن</sub> = -٥ن + ١٨.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'find-term', text: 'ما هو الحد العشرون في المتتابعة التي حدها الأول ٥ وأساسها ٣؟', options: [ { display: '٦٠', value: 'A' }, { display: '٦٢', value: 'B' }, { display: '٦٥', value: 'C' }, { display: '٥٩', value: 'D' } ], correct: 'B', explanation: `<p>نستخدم الصيغة أ<sub class="font-bold">ن</sub> = أ<sub class="font-bold">١</sub> + (ن-١)د. نعوض بالقيم: أ<sub class="font-bold">٢٠</sub> = ٥ + (٢٠-١) × ٣ = ٥ + (١٩ × ٣) = ٥ + ٥٧ = ٦٢.</p>` }
                ];
                return [...questionBank].sort(() => 0.5 - Math.random()).slice(0, 5);
            } 
         },

        // === الفصل الثالث: الدوال الخطية ===
        'c3_l1': { title: 'الدرس ٣-١: تمثيل المعادلات المكتوبة بصيغة الميل والمقطع بيانياً', content: `
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفاهيم الأساسية</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">صيغة الميل والمقطع</h3>
                            <p>التعبير اللفظي: يمكن كتابة معادلة أي خط مستقيم (غير رأسي) باستعمال ميله (م) والمقطع الصادي (ب) وهو الإحداثي الصادي لنقطة تقاطع المستقيم مع محور الصادات.</p>
                            <div class="mt-4 p-4 bg-white rounded-lg border">
                                <p class="text-lg text-center font-bold">صيغة الميل والمقطع</p>
                                <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-2xl math-eq">ص = م س + ب</p>
                                <div class="flex justify-around mt-2 text-center">
                                    <p><strong>م:</strong> الميل</p>
                                    <p><strong>ب:</strong> المقطع الصادي</p>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                            <div class="bg-white p-3 rounded-lg border text-center">
                                <p><strong>مثال ١:</strong> <span class="math-eq">ص = ٣س + ٢</span></p>
                                <p class="text-green-600 font-bold">الميل (م) = ٣</p>
                                <p class="text-blue-600 font-bold">المقطع (ب) = ٢</p>
                            </div>
                            <div class="bg-white p-3 rounded-lg border text-center">
                                <p><strong>مثال ٢:</strong> <span class="math-eq">ص = -٢س + ١</span></p>
                                <p class="text-green-600 font-bold">الميل (م) = -٢</p>
                                <p class="text-blue-600 font-bold">المقطع (ب) = ١</p>
                            </div>
                            <div class="bg-white p-3 rounded-lg border text-center">
                                <p><strong>مثال ٣:</strong> <span class="math-eq">ص = <span class="fraction"><span>١</span><span>٢</span></span> س - ٣</span></p>
                                <p class="text-green-600 font-bold">الميل (م) = <span class="fraction"><span>١</span><span>٢</span></span></p>
                                <p class="text-blue-600 font-bold">المقطع (ب) = -٣</p>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">✍️ ثانياً: كتابة المعادلة (تفاعلي)</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="border p-4 rounded-lg bg-white">
                                <p class="text-center font-bold">مثال ١: اكتب معادلة المستقيم الذي ميله <span class="math-eq">-٣</span> ومقطعه الصادي <span class="math-eq">٥</span>.</p>
                                <div class="bg-gray-50 p-4 mt-2 rounded-lg border min-h-[250px]">
                                    <div id="write-eq-explanation-1" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="write-eq-back-1" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="write-eq-counter-1">0</span> / 4</span>
                                    <button id="write-eq-next-1" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                            <div class="border p-4 rounded-lg bg-white">
                                <p class="text-center font-bold">مثال ٢: اكتب معادلة المستقيم الذي ميله <span class="math-eq">٤</span> ومقطعه الصادي <span class="math-eq">-٢</span>.</p>
                                <div class="bg-gray-50 p-4 mt-2 rounded-lg border min-h-[250px]">
                                    <div id="write-eq-explanation-2" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="write-eq-back-2" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="write-eq-counter-2">0</span> / 4</span>
                                    <button id="write-eq-next-2" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">📊 ثالثاً: تمثيل المعادلة بيانياً (تفاعلي)</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div class="border p-4 rounded-lg bg-white">
                            <h3 class="text-xl font-bold text-center mb-2">مثال ١: ميل موجب</h3>
                            <p class="text-center">مثل المعادلة <span class="math-eq">ص = <span class="fraction"><span>٢</span><span>٣</span></span>س - ١</span> بيانياً.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-4">
                                <div class="border p-4 rounded-lg bg-white">
                                    <div class="bg-gray-50 p-4 rounded-lg border min-h-[340px]">
                                        <div id="graph-eq-explanation-1" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="graph-eq-back-1" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="graph-eq-counter-1">0</span> / 4</span>
                                        <button id="graph-eq-next-1" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                                <div class="graph-container">
                                    <div class="graph-grid"></div>
                                    <div class="graph-axis x-axis"></div>
                                    <div class="graph-axis y-axis"></div>
                                    <div id="graph-rise-line-1" class="graph-movement-line graph-rise"></div>
                                    <div id="graph-run-line-1" class="graph-movement-line graph-run"></div>
                                    <div id="graph-rise-text-1" class="graph-movement-text graph-rise-text"></div>
                                    <div id="graph-run-text-1" class="graph-movement-text graph-run-text"></div>
                                    <div id="graph-point-1-1" class="graph-point"></div>
                                    <div id="graph-point-1-2" class="graph-point"></div>
                                    <div id="graph-line-1" class="graph-line" style="width: 0; top: 0; left: 0;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="border p-4 rounded-lg bg-white">
                            <h3 class="text-xl font-bold text-center mb-2">مثال ٢: ميل سالب (أصعب)</h3>
                            <p class="text-center">مثل المعادلة <span class="math-eq">ص + <span class="fraction"><span>١</span><span>٤</span></span>س = ٢</span> بيانياً.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-4">
                                <div class="border p-4 rounded-lg bg-white">
                                    <div class="bg-gray-50 p-4 rounded-lg border min-h-[340px]">
                                        <div id="graph-eq-explanation-2" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="graph-eq-back-2" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="graph-eq-counter-2">0</span> / 5</span>
                                        <button id="graph-eq-next-2" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                                <div class="graph-container">
                                    <div class="graph-grid"></div>
                                    <div class="graph-axis x-axis"></div>
                                    <div class="graph-axis y-axis"></div>
                                    <div id="graph-rise-line-2" class="graph-movement-line graph-rise"></div>
                                    <div id="graph-run-line-2" class="graph-movement-line graph-run"></div>
                                    <div id="graph-rise-text-2" class="graph-movement-text graph-rise-text"></div>
                                    <div id="graph-run-text-2" class="graph-movement-text graph-run-text"></div>
                                    <div id="graph-point-2-1" class="graph-point"></div>
                                    <div id="graph-point-2-2" class="graph-point"></div>
                                    <div id="graph-line-2" class="graph-line" style="width: 0; top: 0; left: 0;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🏢 رابعاً: من واقع الحياة</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="border p-4 rounded-lg bg-white">
                                <h3 class="font-bold text-center mb-2">مثال ١: تكلفة ثابتة ومتغيرة</h3>
                                <p>لدى شركة سيارات أجرة رسم ثابت مقداره <span class="math-eq">٤</span> ريالات، يضاف إليه <span class="math-eq">٢</span> ريال لكل كيلومتر تقطعه السيارة. اكتب معادلة تمثل التكلفة (ص) لعدد (س) من الكيلومترات.</p>
                                <div class="bg-gray-50 p-4 mt-2 rounded-lg border min-h-[220px]">
                                    <div id="life-eq-explanation-1" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="life-eq-back-1" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="life-eq-counter-1">0</span> / 3</span>
                                    <button id="life-eq-next-1" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                            <div class="border p-4 rounded-lg bg-white">
                                <h3 class="font-bold text-center mb-2">مثال ٢: قيمة ابتدائية وتناقص (أصعب)</h3>
                                <p>بطارية هاتف مشحونة بالكامل (١٠٠٪). إذا كانت تفقد <span class="math-eq">١٥٪</span> من شحنها كل ساعة من الاستخدام، اكتب معادلة تمثل النسبة المئوية المتبقية من الشحن (ص) بعد (س) ساعة.</p>
                                <div class="bg-gray-50 p-4 mt-2 rounded-lg border min-h-[220px]">
                                    <div id="life-eq-explanation-2" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="life-eq-back-2" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="life-eq-counter-2">0</span> / 4</span>
                                    <button id="life-eq-next-2" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <script>
                (function() {
                    function createInteractiveSection(config) {
                        let currentStep = 0;
                        const renderStep = (step) => {
                            if(config.stepCounter) config.stepCounter.textContent = step;
                            let cumulativeHTML = '';
                            if (step === 0) {
                                cumulativeHTML = '<div class="explanation-step" style="border-color: transparent;">' + config.stepsContent[0].text + '</div>';
                            } else {
                                for (let i = 1; i <= step; i++) {
                                    cumulativeHTML += '<div class="explanation-step">' + config.stepsContent[i].text + '</div>';
                                }
                            }
                            if(config.explanationDiv) config.explanationDiv.innerHTML = cumulativeHTML;
                            if (config.customRender) {
                                config.customRender(step);
                            }
                            if(config.backBtn) {
                                config.backBtn.disabled = (step === 0);
                                config.backBtn.classList.toggle('btn-disabled', config.backBtn.disabled);
                            }
                            if(config.nextBtn) config.nextBtn.textContent = (step === config.totalSteps) ? 'إعادة' : 'التالي';
                        };
                        
                        if(config.nextBtn) config.nextBtn.addEventListener('click', () => {
                            currentStep = (currentStep < config.totalSteps) ? currentStep + 1 : 0;
                            renderStep(currentStep);
                        });
                        
                        if(config.backBtn) config.backBtn.addEventListener('click', () => {
                            if (currentStep > 0) {
                                currentStep--;
                                renderStep(currentStep);
                            }
                        });
                        
                        renderStep(0);
                    }

                    createInteractiveSection({
                        nextBtn: document.getElementById('write-eq-next-1'),
                        backBtn: document.getElementById('write-eq-back-1'),
                        stepCounter: document.getElementById('write-eq-counter-1'),
                        explanationDiv: document.getElementById('write-eq-explanation-1'),
                        totalSteps: 4,
                        stepsContent: [
                            { text: "نبدأ بكتابة الصيغة العامة لمعادلة المستقيم." },
                            { text: "<strong>1. الصيغة العامة:</strong><br><span class='math-eq text-center mt-2 block'>ص = م س + ب</span>" },
                            { text: "<strong>2. تحديد المعطيات:</strong><br>الميل <span class='math-eq'>م = -٣</span><br>المقطع الصادي <span class='math-eq'>ب = ٥</span>" },
                            { text: "<strong>3. نعوض بالقيم في الصيغة:</strong><br><span class='math-eq text-center mt-2 block'>ص = (-٣)س + (٥)</span>" },
                            { text: "<strong>4. المعادلة النهائية:</strong><br><span class='math-eq text-center mt-2 block p-2 bg-green-100 rounded-md'>ص = -٣س + ٥</span>" }
                        ]
                    });
                    
                    createInteractiveSection({
                        nextBtn: document.getElementById('write-eq-next-2'),
                        backBtn: document.getElementById('write-eq-back-2'),
                        stepCounter: document.getElementById('write-eq-counter-2'),
                        explanationDiv: document.getElementById('write-eq-explanation-2'),
                        totalSteps: 4,
                        stepsContent: [
                            { text: "نبدأ بكتابة الصيغة العامة لمعادلة المستقيم." },
                            { text: "<strong>1. الصيغة العامة:</strong><br><span class='math-eq text-center mt-2 block'>ص = م س + ب</span>" },
                            { text: "<strong>2. تحديد المعطيات:</strong><br>الميل <span class='math-eq'>م = ٤</span><br>المقطع الصادي <span class='math-eq'>ب = -٢</span>" },
                            { text: "<strong>3. نعوض بالقيم في الصيغة:</strong><br><span class='math-eq text-center mt-2 block'>ص = (٤)س + (-٢)</span>" },
                            { text: "<strong>4. المعادلة النهائية:</strong><br><span class='math-eq text-center mt-2 block p-2 bg-green-100 rounded-md'>ص = ٤س - ٢</span>" }
                        ]
                    });
                    
                    createInteractiveSection({
                        nextBtn: document.getElementById('graph-eq-next-1'),
                        backBtn: document.getElementById('graph-eq-back-1'),
                        stepCounter: document.getElementById('graph-eq-counter-1'),
                        explanationDiv: document.getElementById('graph-eq-explanation-1'),
                        totalSteps: 4,
                        stepsContent: [
                            { text: "لتمثيل المعادلة بيانياً، نحتاج إلى نقطتين على الأقل." },
                            { text: "<strong>1. نحدد المقطع الصادي (ب):</strong><br>من المعادلة، نجد أن <span class='math-eq'>ب = -١</span>. هذه هي النقطة الأولى (٠، -١)." },
                            { text: "<strong>2. نستخدم الميل (م) لإيجاد نقطة أخرى:</strong><br>الميل <span class='math-eq'>م = <span class='fraction'><span>٢</span><span>٣</span></span></span>. هذا يعني تحرك رأسي (بسط) وتحرك أفقي (مقام)." },
                            { text: "<strong>3. نبدأ من المقطع الصادي (٠، -١):</strong><br>نتحرك وحدتين للأعلى (لأن البسط ٢) و٣ وحدات لليمين (لأن المقام ٣) للوصول إلى النقطة الثانية (٣، ١)." },
                            { text: "<strong>4. نرسم خطاً مستقيماً يمر بالنقطتين.</strong>" }
                        ],
                        customRender: (step) => {
                            const p1 = document.getElementById('graph-point-1-1'); const p2 = document.getElementById('graph-point-1-2'); const line = document.getElementById('graph-line-1'); const riseLine = document.getElementById('graph-rise-line-1'); const runLine = document.getElementById('graph-run-line-1'); const riseText = document.getElementById('graph-rise-text-1'); const runText = document.getElementById('graph-run-text-1'); const unit = 20;
                            p1.style.opacity = '0'; p2.style.opacity = '0'; line.style.width = '0px'; riseLine.style.opacity = '0'; runLine.style.opacity = '0'; riseText.style.opacity = '0'; runText.style.opacity = '0';
                            if (step >= 1) { p1.style.opacity = '1'; p1.style.top = 'calc(50% + ' + (1 * unit) + 'px)'; p1.style.left = '50%'; }
                            if (step >= 3) {
                                riseLine.style.opacity = '1'; riseText.style.opacity = '1'; runLine.style.opacity = '1'; runText.style.opacity = '1';
                                riseLine.style.top = 'calc(50% - ' + (1 * unit) + 'px)'; riseLine.style.left = '50%'; riseLine.style.height = (2 * unit) + 'px'; riseLine.style.borderLeftWidth = '2px';
                                runLine.style.top = 'calc(50% - ' + (1 * unit) + 'px)'; runLine.style.left = '50%'; runLine.style.width = (3 * unit) + 'px'; runLine.style.borderTopWidth = '2px';
                                riseText.textContent = '+٢'; riseText.style.top = 'calc(50%)'; riseText.style.left = 'calc(50% - 20px)';
                                runText.textContent = '+٣'; runText.style.top = 'calc(50% - ' + (1 * unit) + 'px - 15px)'; runText.style.left = 'calc(50% + ' + (1.5 * unit) + 'px)';
                                p2.style.opacity = '1'; p2.style.top = 'calc(50% - ' + (1 * unit) + 'px)'; p2.style.left = 'calc(50% + ' + (3 * unit) + 'px)';
                            }
                            if (step >= 4) {
                                line.style.top = 'calc(50% + ' + (1 * unit) + 'px)'; line.style.left = '50%'; const rise = -2 * unit; const run = 3 * unit; const angle = Math.atan2(rise, run) * (180 / Math.PI); const length = Math.sqrt(rise*rise + run*run); line.style.transform = 'rotate(' + angle + 'deg) translate(-' + (length * 2) + 'px, 0)'; line.style.width = (length * 5) + 'px';
                            }
                        }
                    });

                    createInteractiveSection({
                        nextBtn: document.getElementById('graph-eq-next-2'),
                        backBtn: document.getElementById('graph-eq-back-2'),
                        stepCounter: document.getElementById('graph-eq-counter-2'),
                        explanationDiv: document.getElementById('graph-eq-explanation-2'),
                        totalSteps: 5,
                        stepsContent: [
                            { text: "أولاً، يجب أن تكون المعادلة على صيغة الميل والمقطع (ص = م س + ب)." },
                            { text: "<strong>1. نعيد ترتيب المعادلة:</strong><br>ننقل <span class='math-eq'>+<span class='fraction'><span>١</span><span>٤</span></span>س</span> إلى الطرف الآخر بعكس إشارته.<br><span class='math-eq text-center mt-2 block p-2 bg-blue-100 rounded-md'>ص = -<span class='fraction'><span>١</span><span>٤</span></span>س + ٢</span>" },
                            { text: "<strong>2. نحدد المقطع الصادي (ب):</strong><br>الآن المعادلة على الصيغة الصحيحة. نجد أن <span class='math-eq'>ب = ٢</span>. هذه هي النقطة الأولى (٠، ٢)." },
                            { text: "<strong>3. نستخدم الميل (م) لإيجاد نقطة أخرى:</strong><br>الميل <span class='math-eq'>م = -<span class='fraction'><span>١</span><span>٤</span></span></span>. هذا يعني تحرك للأسفل ١ (بسط) ولليمين ٤ (مقام)." },
                            { text: "<strong>4. نمثل الحركة:</strong><br>بدءاً من (٠، ٢)، نتحرك للأسفل ١ ولليمين ٤ لنصل إلى النقطة (٤، ١)." },
                            { text: "<strong>5. نرسم الخط المستقيم</strong> الذي يمر بالنقطتين."}
                        ],
                        customRender: (step) => {
                            const p1 = document.getElementById('graph-point-2-1'); const p2 = document.getElementById('graph-point-2-2'); const line = document.getElementById('graph-line-2'); const riseLine = document.getElementById('graph-rise-line-2'); const runLine = document.getElementById('graph-run-line-2'); const riseText = document.getElementById('graph-rise-text-2'); const runText = document.getElementById('graph-run-text-2'); const unit = 20;
                            p1.style.opacity = '0'; p2.style.opacity = '0'; line.style.width = '0px'; riseLine.style.opacity = '0'; runLine.style.opacity = '0'; riseText.style.opacity = '0'; runText.style.opacity = '0';
                            if (step >= 2) { p1.style.opacity = '1'; p1.style.top = 'calc(50% - ' + (2 * unit) + 'px)'; p1.style.left = '50%'; }
                            if (step >= 4) {
                                riseLine.style.opacity = '1'; riseText.style.opacity = '1'; runLine.style.opacity = '1'; runText.style.opacity = '1';
                                riseLine.style.top = 'calc(50% - ' + (2 * unit) + 'px)'; riseLine.style.left = '50%'; riseLine.style.height = (1 * unit) + 'px'; riseLine.style.borderLeftWidth = '2px';
                                runLine.style.top = 'calc(50% - ' + (1 * unit) + 'px)'; runLine.style.left = '50%'; runLine.style.width = (4 * unit) + 'px'; runLine.style.borderTopWidth = '2px';
                                riseText.textContent = '-١'; riseText.style.top = 'calc(50% - ' + (1.5 * unit) + 'px)'; riseText.style.left = 'calc(50% - 15px)';
                                runText.textContent = '+٤'; runText.style.top = 'calc(50% - ' + (1 * unit) + 'px - 15px)'; runText.style.left = 'calc(50% + ' + (2 * unit) + 'px)';
                                p2.style.opacity = '1'; p2.style.top = 'calc(50% - ' + (1 * unit) + 'px)'; p2.style.left = 'calc(50% + ' + (4 * unit) + 'px)';
                            }
                            if (step >= 5) {
                                line.style.top = 'calc(50% - ' + (2 * unit) + 'px)'; line.style.left = '50%'; const rise = 1 * unit; const run = 4 * unit; const angle = Math.atan2(rise, run) * (180 / Math.PI); const length = Math.sqrt(rise*rise + run*run); line.style.transform = 'rotate(' + angle + 'deg) translate(-' + (length * 1.5) + 'px, 0)'; line.style.width = (length * 4) + 'px';
                            }
                        }
                    });

                    createInteractiveSection({
                        nextBtn: document.getElementById('life-eq-next-1'),
                        backBtn: document.getElementById('life-eq-back-1'),
                        stepCounter: document.getElementById('life-eq-counter-1'),
                        explanationDiv: document.getElementById('life-eq-explanation-1'),
                        totalSteps: 3,
                        stepsContent: [
                            { text: "نحلل المسألة لتحديد الميل والمقطع الصادي." },
                            { text: "<strong>1. نحدد المقطع الصادي (ب):</strong><br>هو القيمة الثابتة التي لا تتغير، وهي الرسم الثابت. إذن <span class='math-eq'>ب = ٤</span>." },
                            { text: "<strong>2. نحدد الميل (م):</strong><br>هو معدل التغير، أي التكلفة لكل كيلومتر. إذن <span class='math-eq'>م = ٢</span>." },
                            { text: "<strong>3. نكتب المعادلة بصيغة الميل والمقطع:</strong><br><span class='math-eq text-center mt-2 block p-2 bg-green-100 rounded-md'>ص = ٢س + ٤</span>" }
                        ]
                    });
                    
                    createInteractiveSection({
                        nextBtn: document.getElementById('life-eq-next-2'),
                        backBtn: document.getElementById('life-eq-back-2'),
                        stepCounter: document.getElementById('life-eq-counter-2'),
                        explanationDiv: document.getElementById('life-eq-explanation-2'),
                        totalSteps: 4,
                        stepsContent: [
                            { text: "نحلل المسألة لتحديد الميل والمقطع الصادي." },
                            { text: "<strong>1. نحدد المقطع الصادي (ب):</strong><br>هو القيمة الابتدائية، وهي نسبة شحن البطارية قبل الاستخدام. إذن <span class='math-eq'>ب = ١٠٠</span>." },
                            { text: "<strong>2. نحدد الميل (م):</strong><br>هو معدل التغير، أي مقدار النقصان في الشحن كل ساعة. بما أنه نقصان، فالميل سالب." },
                            { text: "<strong>3. قيمة الميل:</strong><br>تفقد البطارية ١٥٪ كل ساعة، إذن <span class='math-eq'>م = -١٥</span>." },
                            { text: "<strong>4. نكتب المعادلة بصيغة الميل والمقطع:</strong><br><span class='math-eq text-center mt-2 block p-2 bg-green-100 rounded-md'>ص = -١٥س + ١٠٠</span>" }
                        ]
                    });
                })();
                <\/script>
            `, 
            generateQuiz: () => { 
                const fractionHTML = (num, den) => `<span class="fraction"><span>${num}</span><span class="frac-bar"></span><span>${den}</span></span>`;
                const questionBank = [
                    { type: 'mcq', level: '⭐', topic: 'identify', text: 'في المعادلة ص = ٥س - ٣، ما هو المقطع الصادي؟', options: [ { display: '٥', value: 'A' }, { display: 'س', value: 'B' }, { display: '-٣', value: 'C' }, { display: '٣', value: 'D' } ], correct: 'C', explanation: '<p>في صيغة الميل والمقطع (ص = م س + ب)، يمثل الرمز (ب) المقطع الصادي. في هذه المعادلة، ب = -٣.</p>' },
                    { type: 'mcq', level: '⭐', topic: 'identify', text: 'في المعادلة ص = -س + ٧، ما هو الميل؟', options: [ { display: '١', value: 'A' }, { display: '-١', value: 'B' }, { display: '٧', value: 'C' }, { display: '-٧', value: 'D' } ], correct: 'B', explanation: '<p>في صيغة الميل والمقطع (ص = م س + ب)، يمثل الرمز (م) الميل. في هذه المعادلة، ص = (-١)س + ٧، إذن الميل م = -١.</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'write-equation', text: 'اكتب معادلة المستقيم الذي ميله ٢ ومقطعه الصادي -٤.', options: [ { display: 'ص = -٤س + ٢', value: 'A' }, { display: 'ص = ٢س - ٤', value: 'B' }, { display: 'ص = ٢س + ٤', value: 'C' }, { display: 'ص = ٤س - ٢', value: 'D' } ], correct: 'B', explanation: '<p>نعوض مباشرة في الصيغة ص = م س + ب. مع م = ٢ و ب = -٤، نحصل على ص = ٢س - ٤.</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'write-equation', text: 'ما هي معادلة المستقيم الذي ميله <span class="fraction"><span>١</span><span>٢</span></span> ومقطعه الصادي ٣؟', options: [ { display: 'ص = ٣س + <span class="fraction"><span>١</span><span>٢</span></span>', value: 'A' }, { display: 'ص = س + <span class="fraction"><span>٣</span><span>٢</span></span>', value: 'B' }, { display: 'ص = <span class="fraction"><span>١</span><span>٢</span></span> س + ٣', value: 'C' }, { display: 'ص = <span class="fraction"><span>١</span><span>٢</span></span> س - ٣', value: 'D' } ], correct: 'C', explanation: '<p>نعوض مباشرة في الصيغة ص = م س + ب. مع م = <span class="fraction"><span>١</span><span>٢</span></span> و ب = ٣، نحصل على ص = <span class="fraction"><span>١</span><span>٢</span></span> س + ٣.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'application', text: 'تبلغ تكلفة الاشتراك في نادٍ رياضي ١٠٠ ريال شهرياً، بالإضافة إلى ٥٠ ريالاً كرسم تسجيل لمرة واحدة. أي معادلة تمثل التكلفة (ص) لعدد (س) من الشهور؟', options: [ { display: 'ص = ٥٠س + ١٠٠', value: 'A' }, { display: 'ص = ١٠٠س + ٥٠', value: 'B' }, { display: 'ص = ١٥٠س', value: 'C' }, { display: 'ص = ٥٠س - ١٠٠', value: 'D' } ], correct: 'B', explanation: '<p>رسم التسجيل هو مبلغ ثابت يُدفع مرة واحدة، لذا فهو المقطع الصادي (ب = ٥٠). التكلفة الشهرية هي معدل التغير، لذا هي الميل (م = ١٠٠). المعادلة هي ص = ١٠٠س + ٥٠.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'graph-to-equation', text: 'مستقيم يمر بالنقطة (٠، ١) والنقطة (٢، ٥). ما هي معادلته؟', options: [ { display: 'ص = ٢س + ١', value: 'A' }, { display: 'ص = س + ٢', value: 'B' }, { display: 'ص = -٢س + ١', value: 'C' }, { display: 'ص = ٥س + ٢', value: 'D' } ], correct: 'A', explanation: '<p>أولاً، نحدد المقطع الصادي من النقطة (٠، ١)، إذن ب = ١. ثانياً، نحسب الميل: م = <span class="fraction"><span>٥-١</span><span>٢-٠</span></span> = <span class="fraction"><span>٤</span><span>٢</span></span> = ٢. إذن المعادلة هي ص = ٢س + ١.</p>' },
                    { type: 'mcq', level: '⭐⭐', topic: 'write-equation', text: 'ما معادلة المستقيم الذي ميله ٤ ومقطعه الصادي -٢؟', options: [ { display: 'ص = ٤س - ٢', value: 'A' }, { display: 'ص = -٢س + ٤', value: 'B' }, { display: 'ص = ٤س + ٢', value: 'C' }, { display: 'ص = ٢س - ٤', value: 'D' } ], correct: 'A', explanation: '<p>بتطبيق صيغة الميل والمقطع ص = م س + ب، نعوض عن م بـ ٤ وعن ب بـ -٢ لنحصل على ص = ٤س - ٢.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'write-equation-rearranged', text: 'أي معادلة تمثل مستقيماً ميله -٢ ومقطعه الصادي ٣؟', options: [ { display: 'ص + ٢س = ٣', value: 'A' }, { display: 'ص - ٢س = ٣', value: 'B' }, { display: '٢ص + س = ٦', value: 'C' }, { display: 'ص + ٣ = -٢س', value: 'D' } ], correct: 'A', explanation: '<p>المعادلة هي ص = -٢س + ٣. بنقل -٢س إلى الطرف الآخر، تصبح المعادلة ص + ٢س = ٣.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'graph-to-equation', text: 'مستقيم مقطعه الصادي عند (٠، -١) وميله <span class="fraction"><span>٢</span><span>٣</span></span>. ما هي معادلته؟', options: [ { display: 'ص = <span class="fraction"><span>٢</span><span>٣</span></span>س - ١', value: 'A' }, { display: 'ص = <span class="fraction"><span>٣</span><span>٢</span></span>س - ١', value: 'B' }, { display: 'ص = -س + <span class="fraction"><span>٢</span><span>٣</span></span>', value: 'C' }, { display: 'ص = <span class="fraction"><span>٢</span><span>٣</span></span>س + ١', value: 'D' } ], correct: 'A', explanation: '<p>بما أن المقطع الصادي ب = -١ والميل م = <span class="fraction"><span>٢</span><span>٣</span></span>، فإن المعادلة هي ص = <span class="fraction"><span>٢</span><span>٣</span></span>س - ١.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'identify-from-rearranged', text: 'ما هو ميل المستقيم الذي معادلته ٣ص - ٦س = ٩؟', options: [ { display: '-٢', value: 'A' }, { display: '٦', value: 'B' }, { display: '٣', value: 'C' }, { display: '٢', value: 'D' } ], correct: 'D', explanation: '<p>يجب أولاً وضع المعادلة على صيغة الميل والمقطع (ص = م س + ب). ٣ص = ٦س + ٩. ثم نقسم على ٣: ص = ٢س + ٣. إذن الميل (م) هو ٢.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'application', text: 'باستخدام معادلة سيارة الأجرة ص = ٢س + ٤، ما تكلفة رحلة لمسافة ١٠ كيلومترات؟', options: [ { display: '٢٤ ريال', value: 'A' }, { display: '١٦ ريال', value: 'B' }, { display: '٢٠ ريال', value: 'C' }, { display: '١٤ ريال', value: 'D' } ], correct: 'A', explanation: '<p>نعوض عن س (المسافة) بـ ١٠ في المعادلة: ص = ٢(١٠) + ٤ = ٢٠ + ٤ = ٢٤ ريال.</p>' },
                    { type: 'mcq', level: '⭐⭐⭐', topic: 'application', text: 'باستخدام معادلة البطارية ص = -١٥س + ١٠٠، كم ستكون نسبة الشحن بعد ٣ ساعات؟', options: [ { display: '٤٥٪', value: 'A' }, { display: '٥٥٪', value: 'B' }, { display: '٧٠٪', value: 'C' }, { display: '٨٥٪', value: 'D' } ], correct: 'B', explanation: '<p>نعوض عن س (الساعات) بـ ٣ في المعادلة: ص = -١٥(٣) + ١٠٠ = -٤٥ + ١٠٠ = ٥٥٪.</p>' }
                ];
                return [...questionBank].sort(() => 0.5 - Math.random()).slice(0, 5);
            }  },
        'c3_l2': { title: 'الدرس ٣-٢: كتابة المعادلات بصيغة الميل والمقطع', content:`
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفاهيم الأساسية</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">كتابة معادلة مستقيم بمعرفة ميله ونقطة يمر بها</h3>
                            <p>إذا عُلم ميل المستقيم (م) ونقطة يمر بها (س₁, ص₁)، يمكننا كتابة معادلته بصيغة الميل والمقطع <span class="math-eq">ص = م س + ب</span> باتباع الخطوات التالية:</p>
                            <div class="mt-4 space-y-4">
                                <div class="bg-white p-3 rounded-lg border">
                                    <p><strong>الخطوة 1:</strong> عوض بالميل (م) وإحداثيات النقطة (س₁، ص₁) في المعادلة <span class="math-eq">ص = م س + ب</span>.</p>
                                    <p><strong>الخطوة 2:</strong> حل المعادلة لإيجاد قيمة المقطع الصادي (ب).</p>
                                    <p><strong>الخطوة 3:</strong> اكتب المعادلة النهائية بتعويض الميل (م) والمقطع الصادي (ب).</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">كتابة معادلة مستقيم بمعرفة نقطتين يمر بهما</h3>
                            <p>إذا عُلمت نقطتان يمر بهما المستقيم، يمكننا كتابة معادلته باتباع الخطوات التالية:</p>
                               <div class="mt-4 p-4 bg-white rounded-lg border space-y-2">
                                    <p><strong>الخطوة 1:</strong> أوجد ميل المستقيم (م) باستخدام النقطتين وصيغة الميل.</p>
                                    <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-xl">
                                        <span class="math-eq">م = <span class="fraction"><span>ص₂ - ص₁</span><span>س₂ - س₁</span></span></span>
                                    </p>
                                    <p><strong>الخطوة 2:</strong> اختر إحدى النقطتين، ثم اتبع نفس خطوات الطريقة السابقة لإيجاد المقطع الصادي (ب) وكتابة المعادلة.</p>
                               </div>
                        </div>
                         <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">مفردات جديدة: التنبؤ الخطي</h3>
                            <p>يُستخدم <span class="vocab-term">التنبؤ الخطي</span> لعمل تنبؤات حول قيم تقع خارج نطاق مجموعة البيانات المتوفرة. وذلك عن طريق إيجاد معادلة الخط المستقيم التي تمثل العلاقة بين متغيرين، ثم استخدام هذه المعادلة لتقدير قيمة مجهولة.</p>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: أمثلة تفاعلية</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4 mb-8">
                        <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">النوع الأول: إيجاد المعادلة من ميل ونقطة</h3>
                        <div class="flex flex-col md:flex-row gap-6">
                            <div class="flex-1">
                                <p class="mb-2"><b>مثال ١ (أ):</b> اكتب معادلة المستقيم الذي ميله ٤ ويمر بالنقطة (٢، ٥).</p>
                                <div class="border p-4 rounded-lg bg-white h-full">
                                    <div class="bg-gray-100 p-4 rounded-lg border min-h-[150px]">
                                        <div id="interactive-explanation-1a" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-1a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-1a">0</span> / 3</span>
                                        <button id="interactive-next-1a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <p class="mb-2"><b>مثال ١ (ب):</b> اكتب معادلة المستقيم الذي ميله -٢ ويمر بالنقطة (-١، ٦).</p>
                                <div class="border p-4 rounded-lg bg-white h-full">
                                    <div class="bg-gray-100 p-4 rounded-lg border min-h-[150px]">
                                        <div id="interactive-explanation-1b" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-1b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-1b">0</span> / 3</span>
                                        <button id="interactive-next-1b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4 mb-8">
                        <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">النوع الثاني: إيجاد المعادلة من نقطتين</h3>
                        <div class="flex flex-col md:flex-row gap-6">
                               <div class="flex-1">
                                <p class="mb-2"><b>مثال ٢ (أ):</b> اكتب معادلة المستقيم المار بالنقطتين (١، ٢) و (٣، ٨).</p>
                                <div class="border p-4 rounded-lg bg-white h-full">
                                    <div class="bg-gray-100 p-4 rounded-lg border min-h-[150px]">
                                        <div id="interactive-explanation-2a" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-2a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-2a">0</span> / 3</span>
                                        <button id="interactive-next-2a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <p class="mb-2"><b>مثال ٢ (ب):</b> اكتب معادلة المستقيم المار بالنقطتين (٢، ٥) و (٤، ١).</p>
                                <div class="border p-4 rounded-lg bg-white h-full">
                                    <div class="bg-gray-100 p-4 rounded-lg border min-h-[150px]">
                                        <div id="interactive-explanation-2b" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-2b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-2b">0</span> / 3</span>
                                        <button id="interactive-next-2b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4">
                        <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">النوع الثالث: التنبؤ الخطي</h3>
                           <div class="flex flex-col md:flex-row gap-6">
                            <div class="flex-1">
                                <p class="mb-2"><b>مثال ٣ (أ):</b> يتقاضى طلال أجرة أسبوعية قدرها ٣٥١ ريالاً مقابل ساعات عمله الأساسية. فإذا عمل ٥ ساعات إضافية وتقاضى ٤١٦ ريالاً، اكتب معادلة خطية لإيجاد أجرته (ص) إذا عمل (س) ساعة إضافية. ثم تنبأ بأجرته إذا عمل ٨ ساعات إضافية.</p>
                                <div class="border p-4 rounded-lg bg-white h-full">
                                    <div class="bg-gray-100 p-4 rounded-lg border min-h-[210px]">
                                        <div id="interactive-explanation-3a" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-3a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-3a">0</span> / 5</span>
                                        <button id="interactive-next-3a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <p class="mb-2"><b>مثال ٣ (ب):</b> يدفع علي اشتراكاً في نادٍ رياضي. بعد شهرين (س=٢)، كان مجموع ما دفعه 300 ريال. بعد 5 أشهر (س=٥)، كان المجموع 600 ريال. كم سيدفع بعد 8 أشهر؟</p>
                                <div class="border p-4 rounded-lg bg-white h-full">
                                    <div class="bg-gray-100 p-4 rounded-lg border min-h-[210px]">
                                        <div id="interactive-explanation-3b" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-3b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-3b">0</span> / 4</span>
                                        <button id="interactive-next-3b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `, 
            generateQuiz: () => {
                const fractionHTML = (num, den) => `<span class="fraction"><span>${num}</span><span>${den}</span></span>`;
                const questionBank = [
                    { type: 'mcq', level: '⭐', text: 'ما معادلة المستقيم الذي ميله ٣ ويمر بالنقطة (٢، ١)؟', options: [ { display: 'ص = ٣س - ٥', value: 'A' }, { display: 'ص = ٣س + ١', value: 'B' }, { display: 'ص = ٢س + ٣', value: 'C' }, { display: 'ص = س + ٣', value: 'D' } ], correct: 'A', explanation: `<p><b>الهدف:</b> إيجاد معادلة المستقيم بصيغة <span class="math-eq">ص = م س + ب</span>.</p><p><b>الخطوة 1: التعويض بالميل والنقطة</b></p><p>نعوض الميل <span class="math-eq">م=٣</span> والنقطة (<span class="highlight-x">٢</span>، <span class="highlight-y">١</span>) في المعادلة.</p><p class="text-center"><span class="math-eq"><span class="highlight-y">١</span> = ٣(<span class="highlight-x">٢</span>) + ب</span></p><p><b>الخطوة 2: إيجاد المقطع (ب)</b></p><p><span class="math-eq">١ = ٦ + ب</span></p><p>بطرح ٦ من الطرفين، نجد أن <span class="math-eq">ب = -٥</span>.</p><p><b>الخطوة 3: كتابة المعادلة النهائية</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = ٣س - ٥</span></p>` },
                    { type: 'mcq', level: '⭐⭐', text: 'ما معادلة المستقيم المار بالنقطتين (١، ٦) و (٣، ١٠)؟', options: [ { display: 'ص = س + ٥', value: 'A' }, { display: 'ص = ٢س + ٤', value: 'B' }, { display: 'ص = -٢س + ٨', value: 'C' }, { display: 'ص = ٤س + ٢', value: 'D' } ], correct: 'B', explanation: `<p><b>الخطوة 1: إيجاد الميل (م)</b></p><p>نستخدم النقطتين (<span class="highlight-x">١</span>، <span class="highlight-y">٦</span>) و (<span class="highlight-x">٣</span>، <span class="highlight-y">١٠</span>).</p><p class="text-center"><span class="math-eq">م = <span class="fraction"><span>١٠ - ٦</span><span>٣ - ١</span></span> = <span class="fraction"><span>٤</span><span>٢</span></span> = ٢</span></p><p><b>الخطوة 2: إيجاد المقطع (ب)</b></p><p>نستخدم الميل <span class="math-eq">م=٢</span> وإحدى النقاط، مثلاً (<span class="highlight-x">١</span>، <span class="highlight-y">٦</span>)، ونعوض في <span class="math-eq">ص = م س + ب</span>.</p><p><span class="math-eq"><span class="highlight-y">٦</span> = ٢(<span class="highlight-x">١</span>) + ب</span></p><p><span class="math-eq">٦ = ٢ + ب</span> &larr; <span class="math-eq">ب = ٤</span></p><p><b>الخطوة 3: كتابة المعادلة النهائية</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = ٢س + ٤</span></p>` },
                    { type: 'mcq', level: '⭐⭐⭐', text: 'إذا كانت تكلفة استئجار سيارة ليوم واحد هي ٩٠ ريالاً، بالإضافة إلى ريالين لكل كيلومتر مقطوع. ما المعادلة التي تمثل التكلفة (ص) لقطع (س) كيلومتر؟', options: [ { display: 'ص = ٩٠س + ٢', value: 'A' }, { display: 'ص = ٢س + ٩٠', value: 'B' }, { display: 'ص = ٩٢س', value: 'C' }, { display: 'ص = ٢س - ٩٠', value: 'D' } ], correct: 'B', explanation: `<p><b>الخطوة 1: تحديد المقطع الصادي (ب)</b></p><p>المقطع (ب) هو التكلفة الأولية أو الثابتة، وهي هنا ٩٠ ريالاً. إذن <span class="math-eq">ب = ٩٠</span>.</p><p><b>الخطوة 2: تحديد الميل (م)</b></p><p>الميل (م) هو معدل التغير، وهو هنا ريالان لكل كيلومتر. إذن <span class="math-eq">م = ٢</span>.</p><p><b>الخطوة 3: كتابة المعادلة النهائية</b></p><p>نعوض (م) و (ب) في صيغة <span class="math-eq">ص = م س + ب</span>.</p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = ٢س + ٩٠</span></p>` },
                    { type: 'mcq', level: '⭐', text: 'ما معادلة المستقيم الذي ميله -١ ويمر بالنقطة (٥، -٢)؟', options: [ { display: 'ص = -س + ٣', value: 'A' }, { display: 'ص = -س - ٧', value: 'B' }, { display: 'ص = س - ٧', value: 'C' }, { display: 'ص = ٥س - ٢', value: 'D' } ], correct: 'A', explanation: `<p><b>الخطوة 1: التعويض بالميل والنقطة</b></p><p>نعوض الميل <span class="math-eq">م=-١</span> والنقطة (<span class="highlight-x">٥</span>، <span class="highlight-y">-٢</span>) في المعادلة <span class="math-eq">ص = م س + ب</span>.</p><p class="text-center"><span class="math-eq"><span class="highlight-y">-٢</span> = -١(<span class="highlight-x">٥</span>) + ب</span></p><p><b>الخطوة 2: إيجاد المقطع (ب)</b></p><p><span class="math-eq">-٢ = -٥ + ب</span></p><p>بإضافة ٥ للطرفين، نجد أن <span class="math-eq">ب = ٣</span>.</p><p><b>الخطوة 3: كتابة المعادلة النهائية</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = -س + ٣</span></p>` },
                    { type: 'mcq', level: '⭐', text: 'ما معادلة المستقيم الذي ميله <span class="fraction"><span>١</span><span>٢</span></span> ويمر بالنقطة (٤، ١)؟', options: [ { display: 'ص = ٢س - ٧', value: 'A' }, { display: 'ص = <span class="fraction"><span>١</span><span>٢</span></span>س + ١', value: 'B' }, { display: 'ص = <span class="fraction"><span>١</span><span>٢</span></span>س - ١', value: 'C' }, { display: 'ص = ٤س + ١', value: 'D' } ], correct: 'C', explanation: `<p><b>الخطوة 1: التعويض بالميل والنقطة</b></p><p>نعوض الميل <span class="math-eq">م = <span class="fraction"><span>١</span><span>٢</span></span></span> والنقطة (<span class="highlight-x">٤</span>، <span class="highlight-y">١</span>) في المعادلة <span class="math-eq">ص = م س + ب</span>.</p><p class="text-center"><span class="math-eq"><span class="highlight-y">١</span> = <span class="fraction"><span>١</span><span>٢</span></span>(<span class="highlight-x">٤</span>) + ب</span></p><p><b>الخطوة 2: إيجاد المقطع (ب)</b></p><p><span class="math-eq">١ = ٢ + ب</span></p><p>بطرح ٢ من الطرفين، نجد أن <span class="math-eq">ب = -١</span>.</p><p><b>الخطوة 3: كتابة المعادلة النهائية</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = <span class="fraction"><span>١</span><span>٢</span></span>س - ١</span></p>` },
                    { type: 'mcq', level: '⭐⭐', text: 'ما معادلة المستقيم المار بنقطة الأصل (٠، ٠) والنقطة (٢، ٦)؟', options: [ { display: 'ص = ٦س + ٢', value: 'A' }, { display: 'ص = ٣س', value: 'B' }, { display: 'ص = ٢س + ٦', value: 'C' }, { display: 'ص = -٣س', value: 'D' } ], correct: 'B', explanation: `<p><b>الخطوة 1: إيجاد الميل (م)</b></p><p>نستخدم النقطتين (<span class="highlight-x">٠</span>، <span class="highlight-y">٠</span>) و (<span class="highlight-x">٢</span>، <span class="highlight-y">٦</span>).</p><p class="text-center"><span class="math-eq">م = <span class="fraction"><span>٦ - ٠</span><span>٢ - ٠</span></span> = <span class="fraction"><span>٦</span><span>٢</span></span> = ٣</span></p><p><b>الخطوة 2: إيجاد المقطع (ب)</b></p><p>بما أن المستقيم يمر بنقطة الأصل، فإن المقطع الصادي <span class="math-eq">ب = ٠</span>.</p><p><b>الخطوة 3: كتابة المعادلة النهائية</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = ٣س</span></p>` },
                    { type: 'mcq', level: '⭐⭐', text: 'ما معادلة المستقيم المار بالنقطتين (-٢، ٤) و (١، -٢)؟', options: [ { display: 'ص = ٢س + ٨', value: 'A' }, { display: 'ص = -٢س - ٨', value: 'B' }, { display: 'ص = -٢س', value: 'C' }, { display: 'ص = -<span class="fraction"><span>١</span><span>٢</span></span>س + ٣', value: 'D' } ], correct: 'C', explanation: `<p><b>الخطوة 1: إيجاد الميل (م)</b></p><p>نستخدم النقطتين (<span class="highlight-x">-٢</span>، <span class="highlight-y">٤</span>) و (<span class="highlight-x">١</span>، <span class="highlight-y">-٢</span>).</p><p class="text-center"><span class="math-eq">م = <span class="fraction"><span>-٢ - ٤</span><span>١ - (-٢)</span></span> = <span class="fraction"><span>-٦</span><span>٣</span></span> = -٢</span></p><p><b>الخطوة 2: إيجاد المقطع (ب)</b></p><p>نستخدم الميل <span class="math-eq">م=-٢</span> والنقطة (<span class="highlight-x">١</span>، <span class="highlight-y">-٢</span>).</p><p class="text-center"><span class="math-eq"><span class="highlight-y">-٢</span> = -٢(<span class="highlight-x">١</span>) + ب</span></p><p><span class="math-eq">-٢ = -٢ + ب</span> &larr; <span class="math-eq">ب = ٠</span></p><p><b>الخطوة 3: كتابة المعادلة النهائية</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = -٢س</span></p>` },
                    { type: 'mcq', level: '⭐⭐', text: 'ما معادلة المستقيم المار بالنقطتين (-٤، ٢) و (١، ٧)؟', options: [ { display: 'ص = س + ٦', value: 'A' }, { display: 'ص = س - ٦', value: 'B' }, { display: 'ص = -س + ٢', value: 'C' }, { display: 'ص = ٥س + ٢٢', value: 'D' } ], correct: 'A', explanation: `<p><b>الخطوة 1: إيجاد الميل (م)</b></p><p>نستخدم النقطتين (<span class="highlight-x">-٤</span>، <span class="highlight-y">٢</span>) و (<span class="highlight-x">١</span>، <span class="highlight-y">٧</span>).</p><p class="text-center"><span class="math-eq">م = <span class="fraction"><span>٧ - ٢</span><span>١ - (-٤)</span></span> = <span class="fraction"><span>٥</span><span>٥</span></span> = ١</span></p><p><b>الخطوة 2: إيجاد المقطع (ب)</b></p><p>نستخدم الميل <span class="math-eq">م=١</span> والنقطة (<span class="highlight-x">١</span>، <span class="highlight-y">٧</span>).</p><p class="text-center"><span class="math-eq"><span class="highlight-y">٧</span> = ١(<span class="highlight-x">١</span>) + ب</span></p><p><span class="math-eq">٧ = ١ + ب</span> &larr; <span class="math-eq">ب = ٦</span></p><p><b>الخطوة 3: كتابة المعادلة النهائية</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = س + ٦</span></p>` },
                    { type: 'mcq', level: '⭐⭐⭐', text: 'باقة جوال تكلفتها الشهرية الثابتة ٥٠ ريالاً، بالإضافة إلى نصف ريال لكل دقيقة اتصال إضافية. ما المعادلة التي تمثل التكلفة (ص) لـ (س) دقيقة إضافية؟', options: [ { display: 'ص = ٥٠س + <span class="fraction"><span>١</span><span>٢</span></span>', value: 'A' }, { display: 'ص = <span class="fraction"><span>١</span><span>٢</span></span>س + ٥٠', value: 'B' }, { display: 'ص = ٥٠<span class="fraction"><span>١</span><span>٢</span></span>س', value: 'C' }, { display: 'ص = ٥٠س', value: 'D' } ], correct: 'B', explanation: `<p><b>الخطوة 1: تحديد المقطع الصادي (ب)</b></p><p>المقطع (ب) هو التكلفة الثابتة، وهي هنا ٥٠ ريالاً. إذن <span class="math-eq">ب = ٥٠</span>.</p><p><b>الخطوة 2: تحديد الميل (م)</b></p><p>الميل (م) هو تكلفة الدقيقة الإضافية، وهو هنا نصف ريال. إذن <span class="math-eq">م = <span class="fraction"><span>١</span><span>٢</span></span></span>.</p><p><b>الخطوة 3: كتابة المعادلة النهائية</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = <span class="fraction"><span>١</span><span>٢</span></span>س + ٥٠</span></p>` },
                    { type: 'mcq', level: '⭐⭐⭐', text: 'طول نبتة ١٠ سم، وتنمو بمعدل ٢ سم كل أسبوع. ما المعادلة التي تمثل طولها (ص) بعد (س) أسبوع؟', options: [ { display: 'ص = ١٠س + ٢', value: 'A' }, { display: 'ص = ١٢س', value: 'B' }, { display: 'ص = ٢س + ١٠', value: 'C' }, { display: 'ص = ٢س - ١٠', value: 'D' } ], correct: 'C', explanation: `<p><b>الخطوة 1: تحديد المقطع الصادي (ب)</b></p><p>المقطع (ب) هو الطول الابتدائي للنبتة، وهو هنا ١٠ سم. إذن <span class="math-eq">ب = ١٠</span>.</p><p><b>الخطوة 2: تحديد الميل (م)</b></p><p>الميل (م) هو معدل النمو، وهو هنا ٢ سم لكل أسبوع. إذن <span class="math-eq">م = ٢</span>.</p><p><b>الخطوة 3: كتابة المعادلة النهائية</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = ٢س + ١٠</span></p>` }
                ];
                const shuffledQuestions = [...questionBank].sort(() => Math.random() - 0.5);
                return shuffledQuestions.slice(0, 5);
            } },
        'c3_l3': { title: 'الدرس ٣-٣: كتابة المعادلات بصيغة الميل ونقطة', content: `
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفاهيم الأساسية</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">صيغة الميل ونقطة</h3>
                            <p>تُستخدم <span class="vocab-term">صيغة الميل ونقطة</span> لكتابة معادلة خط مستقيم إذا عُلم ميله (م) وإحداثيات نقطة يمر بها (س₁، ص₁).</p>
                            <div class="mt-4 p-4 bg-white rounded-lg border">
                                 <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-xl math-eq">ص - ص₁ = م (س - س₁)</p>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">الصورة القياسية للمعادلة الخطية</h3>
                            <p>يمكن إعادة كتابة أي معادلة خطية على <span class="vocab-term">الصورة القياسية</span>. وهي مفيدة لتحديد تقاطعات المحاور بسهولة.</p>
                               <div class="mt-4 p-4 bg-white rounded-lg border space-y-2">
                                    <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-xl math-eq">أ س + ب ص = ج</p>
                                    <p class="text-sm text-gray-600">حيث أ، ب، ج أعداد صحيحة، أ ≥ ٠، و أ، ب ليسا معًا صفرًا.</p>
                               </div>
                        </div>
                         <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">التحويل بين الصيغ</h3>
                            <p>يمكنك التحويل من صيغة الميل ونقطة إلى صيغ أخرى مثل صيغة الميل والمقطع (الدرس السابق) أو الصورة القياسية عن طريق التبسيط الجبري.</p>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: أمثلة تفاعلية</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4 mb-8">
                        <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">النوع الأول: كتابة المعادلة بصيغة الميل ونقطة</h3>
                        <div class="flex flex-col md:flex-row gap-6">
                            <div class="flex-1">
                                <p class="mb-2"><b>مثال ١ (أ):</b> اكتب معادلة المستقيم الذي ميله ٧ ويمر بالنقطة (-٣، ٥).</p>
                                <div class="border p-4 rounded-lg bg-white h-full flex flex-col">
                                    <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[150px]">
                                        <div id="interactive-explanation-1a" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-1a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-1a">0</span> / 2</span>
                                        <button id="interactive-next-1a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <p class="mb-2"><b>مثال ١ (ب):</b> اكتب معادلة المستقيم الذي ميله <span class="math-eq">-<span class="fraction"><span>١</span><span>٣</span></span></span> ويمر بالنقطة (٠، -٢).</p>
                                <div class="border p-4 rounded-lg bg-white h-full flex flex-col">
                                    <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[150px]">
                                        <div id="interactive-explanation-1b" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-1b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-1b">0</span> / 2</span>
                                        <button id="interactive-next-1b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4 mb-8">
                        <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">النوع الثاني: التحويل إلى الصورة القياسية</h3>
                        <div class="flex flex-col md:flex-row gap-6">
                               <div class="flex-1">
                                <p class="mb-2"><b>مثال ٢ (أ):</b> اكتب المعادلة <span class="math-eq">ص - ١٠ = ٢(س - ٨)</span> بالصورة القياسية.</p>
                                <div class="border p-4 rounded-lg bg-white h-full flex flex-col">
                                    <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[200px]">
                                        <div id="interactive-explanation-2a" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-2a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-2a">0</span> / 3</span>
                                        <button id="interactive-next-2a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <p class="mb-2"><b>مثال ٢ (ب):</b> اكتب المعادلة <span class="math-eq">ص - ٦ = -٣(س + ٢)</span> بالصورة القياسية.</p>
                                <div class="border p-4 rounded-lg bg-white h-full flex flex-col">
                                    <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[200px]">
                                        <div id="interactive-explanation-2b" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-2b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-2b">0</span> / 2</span>
                                        <button id="interactive-next-2b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4">
                        <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">النوع الثالث: التحويل إلى صيغة الميل والمقطع</h3>
                           <div class="flex flex-col md:flex-row gap-6">
                            <div class="flex-1">
                                <p class="mb-2"><b>مثال ٣ (أ):</b> اكتب المعادلة <span class="math-eq">ص - ٦ = -٢(س - ٧)</span> بصيغة الميل والمقطع.</p>
                                <div class="border p-4 rounded-lg bg-white h-full">
                                    <div class="bg-gray-100 p-4 rounded-lg border min-h-[150px]">
                                        <div id="interactive-explanation-3a" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-3a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-3a">0</span> / 3</span>
                                        <button id="interactive-next-3a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <p class="mb-2"><b>مثال ٣ (ب):</b> اكتب المعادلة <span class="math-eq">٣ص + ٥ = ٢(س + ٧)</span> بصيغة الميل والمقطع.</p>
                                <div class="border p-4 rounded-lg bg-white h-full">
                                    <div class="bg-gray-100 p-4 rounded-lg border min-h-[150px]">
                                        <div id="interactive-explanation-3b" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-3b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-3b">0</span> / 4</span>
                                        <button id="interactive-next-3b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `, 
            generateQuiz: () => {
                const fractionHTML = (num, den) => `<span class="fraction"><span>${num}</span><span>${den}</span></span>`;
                const questionBank = [
                     { type: 'mcq', level: '⭐', text: `ما معادلة المستقيم الذي ميله ٥ ويمر بالنقطة (٢، ٣) بصيغة الميل ونقطة؟`, options: [ { display: 'ص - ٢ = ٥(س - ٣)', value: 'A' }, { display: 'ص - ٣ = ٥(س - ٢)', value: 'B' }, { display: 'ص + ٣ = ٥(س + ٢)', value: 'C' }, { display: 'ص = ٥س + ٣', value: 'D' } ], correct: 'B', explanation: `<p><b>الهدف:</b> كتابة المعادلة بصيغة <span class="math-eq">ص - ص₁ = م (س - س₁)</span>.</p><p><b>المعطيات:</b> الميل <span class="math-eq">م=٥</span>، والنقطة (<span class="highlight-x">٢</span>، <span class="highlight-y">٣</span>).</p><p><b>التعويض المباشر:</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص - <span class="highlight-y">٣</span> = ٥(س - <span class="highlight-x">٢</span>)</span></p>` },
                    { type: 'mcq', level: '⭐⭐', text: `اكتب المعادلة <span class="math-eq">ص - ١ = ٤(س + ٢)</span> بالصورة القياسية.`, options: [ { display: '٤س - ص = -٩', value: 'A' }, { display: '٤س + ص = ٩', value: 'B' }, { display: 'ص = ٤س + ٩', value: 'C' }, { display: '٤س - ص = ٧', value: 'D' } ], correct: 'A', explanation: `<p><b>المعادلة الأصلية:</b> <span class="math-eq">ص - ١ = ٤(س + ٢)</span></p><p><b>1. فك الأقواس:</b> <span class="math-eq">ص - ١ = ٤س + ٨</span></p><p><b>2. نقل المتغيرات لطرف:</b> <span class="math-eq">-٤س + ص - ١ = ٨</span></p><p><b>3. نقل الثوابت للطرف الآخر:</b> <span class="math-eq">-٤س + ص = ٩</span></p><p><b>4. جعل معامل 'س' موجبًا:</b> نضرب في -١.</p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">٤س - ص = -٩</span></p>` },
                    { type: 'mcq', level: '⭐⭐', text: `اكتب المعادلة <span class="math-eq">ص + ٥ = -٢(س - ١)</span> بصيغة الميل والمقطع.`, options: [ { display: 'ص = -٢س + ٧', value: 'A' }, { display: 'ص = -٢س - ٣', value: 'B' }, { display: 'ص = ٢س - ٣', value: 'C' }, { display: '٢س + ص = -٣', value: 'D' } ], correct: 'B', explanation: `<p><b>المعادلة الأصلية:</b> <span class="math-eq">ص + ٥ = -٢(س - ١)</span></p><p><b>1. فك الأقواس:</b> <span class="math-eq">ص + ٥ = -٢س + ٢</span></p><p><b>2. عزل 'ص':</b> ننقل +٥ للطرف الآخر.</p><p><span class="math-eq">ص = -٢س + ٢ - ٥</span></p><p><b>3. التبسيط:</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = -٢س - ٣</span></p>` },
                    { type: 'mcq', level: '⭐', text: `معادلة المستقيم <span class="math-eq">ص + ١ = ٣(س - ٤)</span> تمر بأي نقطة من النقاط التالية؟`, options: [ { display: '(-١، ٤)', value: 'A' }, { display: '(-٤، ١)', value: 'B' }, { display: '(٤، -١)', value: 'C' }, { display: '(٣، ٤)', value: 'D' } ], correct: 'C', explanation: `<p>الصيغة هي <span class="math-eq">ص - ص₁ = م (س - س₁)</span>.</p><p>المعادلة المعطاة: <span class="math-eq">ص + ١ = ٣(س - ٤)</span>.</p><p>يمكننا إعادة كتابتها لتطابق الصيغة: <span class="math-eq">ص - (-١) = ٣(س - ٤)</span>.</p><p>بالمقارنة، نجد أن <span class="math-eq">س₁ = ٤</span> و <span class="math-eq">ص₁ = -١</span>.</p><p>إذن، النقطة هي <span class="math-eq">(٤، -١)</span>.</p>` },
                    { type: 'mcq', level: '⭐⭐⭐', text: `ما معادلة المستقيم المار بالنقطتين (١، ٦) و (٣، ١٠) بصيغة الميل ونقطة؟`, options: [ { display: 'ص - ٦ = ٢(س - ١)', value: 'A' }, { display: 'ص - ١ = ٢(س - ٦)', value: 'B' }, { display: 'ص - ١٠ = -٢(س - ٣)', value: 'C' }, { display: 'ص = ٢س + ٤', value: 'D' } ], correct: 'A', explanation: `<p><b>الخطوة 1: إيجاد الميل (م)</b></p><p><span class="math-eq">م = <span class="fraction"><span>١٠ - ٦</span><span>٣ - ١</span></span> = <span class="fraction"><span>٤</span><span>٢</span></span> = ٢</span></p><p><b>الخطوة 2: استخدام صيغة الميل ونقطة</b></p><p>نستخدم الميل <span class="math-eq">م=٢</span> وإحدى النقطتين، ولتكن (<span class="highlight-x">١</span>، <span class="highlight-y">٦</span>).</p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص - ٦ = ٢(س - ١)</span></p><p class="text-sm text-gray-600">(ملاحظة: استخدام النقطة الأخرى (٣، ١٠) سيعطي معادلة مكافئة: ص - ١٠ = ٢(س - ٣))</p>` },
                    { type: 'mcq', level: '⭐⭐', text: `اكتب المعادلة <span class="math-eq">ص - ٥ = -١(س + ٣)</span> بالصورة القياسية.`, options: [ { display: 'س + ص = ٢', value: 'A' }, { display: 'س - ص = ٢', value: 'B' }, { display: 'ص = -س + ٢', value: 'C' }, { display: 'س + ص = -٨', value: 'D' } ], correct: 'A', explanation: `<p><b>المعادلة الأصلية:</b> <span class="math-eq">ص - ٥ = -١(س + ٣)</span></p><p><b>1. فك الأقواس:</b> <span class="math-eq">ص - ٥ = -س - ٣</span></p><p><b>2. نقل المتغيرات لطرف:</b> <span class="math-eq">س + ص - ٥ = -٣</span></p><p><b>3. نقل الثوابت للطرف الآخر:</b> <span class="math-eq">س + ص = -٣ + ٥</span></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">س + ص = ٢</span></p>` },
                    { type: 'mcq', level: '⭐⭐', text: `ما هي صيغة الميل والمقطع للمعادلة <span class="math-eq">ص - ٨ = ٣(س - ٢)</span>؟`, options: [ { display: 'ص = ٣س + ٢', value: 'A' }, { display: 'ص = ٣س + ١٤', value: 'B' }, { display: 'ص = ٣س - ١٤', value: 'C' }, { display: '٣س - ص = -٢', value: 'D' } ], correct: 'A', explanation: `<p><b>المعادلة الأصلية:</b> <span class="math-eq">ص - ٨ = ٣(س - ٢)</span></p><p><b>1. فك الأقواس:</b> <span class="math-eq">ص - ٨ = ٣س - ٦</span></p><p><b>2. عزل 'ص':</b> <span class="math-eq">ص = ٣س - ٦ + ٨</span></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = ٣س + ٢</span></p>` },
                    { type: 'mcq', level: '⭐', text: `ما النقطة التي يمر بها المستقيم <span class="math-eq">ص + ٧ = -٤(س - ٩)</span>؟`, options: [ { display: '(٩، -٧)', value: 'A' }, { display: '(-٩، ٧)', value: 'B' }, { display: '(٩، ٧)', value: 'C' }, { display: '(-٤، -٧)', value: 'D' } ], correct: 'A', explanation: `<p>الصيغة هي <span class="math-eq">ص - ص₁ = م (س - س₁)</span>.</p><p>للمعادلة <span class="math-eq">ص + ٧ = -٤(س - ٩)</span>، نكتبها على الصورة <span class="math-eq">ص - (-٧) = -٤(س - ٩)</span>.</p><p>بالمقارنة، نجد أن <span class="math-eq">س₁ = ٩</span> و <span class="math-eq">ص₁ = -٧</span>.</p><p>إذن، النقطة هي <span class="math-eq">(٩، -٧)</span>.</p>` },
                    { type: 'mcq', level: '⭐', text: `ما معادلة المستقيم الذي ميله ٠ ويمر بالنقطة (٤، -٦)؟`, options: [ { display: 'ص = -٦', value: 'A' }, { display: 'س = ٤', value: 'B' }, { display: 'ص = ٤', value: 'C' }, { display: 'س = -٦', value: 'D' } ], correct: 'A', explanation: `<p>الميل يساوي صفر يعني أن الخط أفقي.</p><p>معادلة الخط الأفقي هي دائماً <span class="math-eq">ص = قيمة ثابتة</span>.</p><p>بما أن الخط يمر بالنقطة (٤، -٦)، فإن قيمة 'ص' الثابتة هي -٦.</p><p>إذن، المعادلة هي <span class="math-eq">ص = -٦</span>.</p>` },
                    { type: 'mcq', level: '⭐⭐⭐', text: `اكتب معادلة المستقيم المار بالنقطتين (٢، -١) و (٤، ٥) بالصورة القياسية.`, options: [ { display: '٣س - ص = ٧', value: 'A' }, { display: '٣س + ص = ٧', value: 'B' }, { display: 'ص = ٣س - ٧', value: 'C' }, { display: 'س - ٣ص = ٥', value: 'D' } ], correct: 'A', explanation: `<p><b>1. نجد الميل:</b> <span class="math-eq">م = <span class="fraction"><span>٥ - (-١)</span><span>٤ - ٢</span></span> = <span class="fraction"><span>٦</span><span>٢</span></span> = ٣</span>.</p><p><b>2. نستخدم صيغة الميل ونقطة (باستخدام النقطة (٤، ٥)):</b> <span class="math-eq">ص - ٥ = ٣(س - ٤)</span>.</p><p><b>3. فك الأقواس:</b> <span class="math-eq">ص - ٥ = ٣س - ١٢</span>.</p><p><b>4. نحول للصورة القياسية:</b> <span class="math-eq">-٣س + ص = -١٢ + ٥</span> &rarr; <span class="math-eq">-٣س + ص = -٧</span>.</p><p><b>5. نجعل معامل 'س' موجبًا:</b> <span class="math-eq">٣س - ص = ٧</span>.</p>` },
                    { type: 'mcq', level: '⭐⭐⭐', text: `ما هي معادلة المستقيم الذي يقطع المحور السيني عند س = ٥ والمحور الصادي عند ص = -٢؟`, options: [ { display: 'ص = <span class="fraction"><span>٢</span><span>٥</span></span>س - ٢', value: 'A' }, { display: 'ص = <span class="fraction"><span>٥</span><span>٢</span></span>س - ٢', value: 'B' }, { display: 'ص = -٢س + ٥', value: 'C' }, { display: '٢س - ٥ص = ١٠', value: 'D' } ], correct: 'A', explanation: `<p>التقاطع مع المحور السيني عند ٥ يعني النقطة (٥، ٠).</p><p>التقاطع مع المحور الصادي عند -٢ يعني النقطة (٠، -٢). وهذا هو المقطع الصادي <span class="math-eq">ب = -٢</span>.</p><p><b>1. نجد الميل:</b> <span class="math-eq">م = <span class="fraction"><span>-٢ - ٠</span><span>٠ - ٥</span></span> = <span class="fraction"><span>-٢</span><span>-٥</span></span> = <span class="fraction"><span>٢</span><span>٥</span></span></span>.</p><p><b>2. نكتب بصيغة الميل والمقطع (ص = م س + ب):</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = <span class="fraction"><span>٢</span><span>٥</span></span>س - ٢</span></p>` },
                    { type: 'mcq', level: '⭐⭐⭐', text: `تبدأ درجة حرارة سائل عند ٢٥°م، وتنخفض بمعدل ٣°م كل دقيقة. ما المعادلة التي تمثل درجة الحرارة (ص) بعد (س) دقيقة بصيغة الميل والمقطع؟`, options: [ { display: 'ص = -٣س + ٢٥', value: 'A' }, { display: 'ص = ٣س + ٢٥', value: 'B' }, { display: 'ص = ٢٥س - ٣', value: 'C' }, { display: 'ص = -٣س - ٢٥', value: 'D' } ], correct: 'A', explanation: `<p><b>المقطع الصادي (ب):</b> هو درجة الحرارة الابتدائية، إذن <span class="math-eq">ب = ٢٥</span>.</p><p><b>الميل (م):</b> هو معدل التغير. بما أن الحرارة "تنخفض"، فالميل سالب. إذن <span class="math-eq">م = -٣</span>.</p><p><b>المعادلة (ص = م س + ب):</b></p><p class="text-center p-2 bg-green-100 rounded-md"><span class="math-eq">ص = -٣س + ٢٥</span></p>` }
                ];
                const shuffledQuestions = [...questionBank].sort(() => Math.random() - 0.5);
                return shuffledQuestions.slice(0, 5);
            } },
        'c3_l4': { title: 'الدرس ٣-٤: المستقيمات المتوازية والمستقيمات المتعامدة', content:  `
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفاهيم الأساسية</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">المستقيمان المتوازيان</h3>
                            <p>يكون المستقيمان غير الرأسيين متوازيين إذا وفقط إذا كان لهما <span class="vocab-term">الميل نفسه</span>.</p>
                            <div class="mt-4 p-4 bg-white rounded-lg border">
                                <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-xl math-eq"> م₁ = م₂ </p>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">المستقيمان المتعامدان</h3>
                            <p>يكون المستقيمان غير الرأسيين متعامدين إذا وفقط إذا كان <span class="vocab-term">حاصل ضرب ميليهما يساوي -١</span>.</p>
                            <div class="mt-4 p-4 bg-white rounded-lg border space-y-2">
                                <div class="flex justify-center items-center gap-4">
                                    <p class="flex-1 text-center my-2 p-3 bg-indigo-50 rounded-md text-xl math-eq"> م₁ × م₂ = -١ </p>
                                    <span class="text-gray-500 font-bold">أو</span>
                                    <p class="flex-1 text-center my-2 p-3 bg-indigo-50 rounded-md text-xl math-eq"> م₁ = -<span class="fraction"><span>١</span><span>م₂</span></span></p>
                                </div>
                                <p class="text-sm text-gray-600">هذا يعني أن ميل أحدهما هو مقلوب معكوس ميل الآخر.</p>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">مثال ١: تحديد علاقة المستقيمات</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">أ) أمثلة مباشرة (لا تحتاج إلى حل)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-sm">
                                    <p class="mb-2 text-lg">ص = <span class="text-red-600 font-bold">٤</span>س + ٣</p>
                                    <p class="mb-3 text-lg">ص = <span class="text-blue-600 font-bold">٤</span>س - ٥</p>
                                    <p class="text-sm text-gray-600">الميلان: م₁ = <span class="text-red-600 font-bold">٤</span>، م₂ = <span class="text-blue-600 font-bold">٤</span></p>
                                    <p class="mt-2 p-2 bg-green-100 text-green-800 rounded-md font-bold text-center">بما أن م₁ = م₂، فالمستقيمان متوازيان.</p>
                                </div>
                                <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-sm">
                                    <p class="mb-2 text-lg">ص = <span class="text-red-600 font-bold">-<span class="fraction"><span>١</span><span>٣</span></span></span>س + ٢</p>
                                    <p class="mb-3 text-lg">ص = <span class="text-blue-600 font-bold">٣</span>س - ١</p>
                                    <p class="text-sm text-gray-600">الميلان: م₁ = <span class="text-red-600 font-bold">-<span class="fraction"><span>١</span><span>٣</span></span></span>، م₂ = <span class="text-blue-600 font-bold">٣</span></p>
                                    <p class="mt-2 p-2 bg-purple-100 text-purple-800 rounded-md font-bold text-center">بما أن -<span class="fraction"><span>١</span><span>٣</span></span> × ٣ = -١، فالمستقيمان متعامدان.</p>
                                </div>
                                <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-sm">
                                    <p class="mb-2 text-lg">ص = <span class="text-red-600 font-bold">٢</span>س + ١</p>
                                    <p class="mb-3 text-lg">ص = <span class="text-blue-600 font-bold">-٢</span>س + ١</p>
                                    <p class="text-sm text-gray-600">الميلان: م₁ = <span class="text-red-600 font-bold">٢</span>، م₂ = <span class="text-blue-600 font-bold">-٢</span></p>
                                    <p class="mt-2 p-2 bg-yellow-100 text-yellow-800 rounded-md font-bold text-center">الميلان مختلفان وحاصل ضربهما لا يساوي -١، إذن غير ذلك.</p>
                                </div>
                                <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-sm">
                                    <p class="mb-2 text-lg">ص = س + ٧</p>
                                    <p class="mb-3 text-lg">ص = <span class="text-blue-600 font-bold">-</span>س + ٣</p>
                                    <p class="text-sm text-gray-600">الميلان: م₁ = <span class="text-red-600 font-bold">١</span>، م₂ = <span class="text-blue-600 font-bold">-١</span></p>
                                    <p class="mt-2 p-2 bg-purple-100 text-purple-800 rounded-md font-bold text-center">بما أن ١ × -١ = -١، فالمستقيمان متعامدان.</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">ب) أمثلة تحتاج خطوة واحدة للحل</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-sm">
                                    <p class="mb-2 text-lg">ص = <span class="text-red-600 font-bold">-٢</span>س + ٣</p>
                                    <p class="mb-3 text-lg"><span class="text-blue-600">٢</span>س + ص = ١٠</p>
                                    <p class="text-sm text-gray-600"><b>حل المعادلة الثانية:</b> ص = <span class="text-blue-600 font-bold">-٢</span>س + ١٠</p>
                                    <p class="text-sm mt-2 text-gray-600">الميلان: م₁ = <span class="text-red-600 font-bold">-٢</span>، م₂ = <span class="text-blue-600 font-bold">-٢</span></p>
                                    <p class="mt-2 p-2 bg-green-100 text-green-800 rounded-md font-bold text-center">بما أن م₁ = م₂، فالمستقيمان متوازيان.</p>
                                </div>
                                <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-sm">
                                    <p class="mb-2 text-lg">ص = <span class="text-red-600 font-bold"><span class="fraction"><span>١</span><span>٢</span></span></span>س - ١</p>
                                    <p class="mb-3 text-lg"><span class="text-blue-600">٤</span>س + <span class="text-blue-600">٢</span>ص = ٨</p>
                                    <p class="text-sm text-gray-600"><b>حل المعادلة الثانية:</b> ٢ص = -٤س + ٨، وبالقسمة على ٢ تصبح ص = <span class="text-blue-600 font-bold">-٢</span>س + ٤</p>
                                    <p class="text-sm mt-2 text-gray-600">الميلان: م₁ = <span class="text-red-600 font-bold"><span class="fraction"><span>١</span><span>٢</span></span></span>، م₂ = <span class="text-blue-600 font-bold">-٢</span></p>
                                    <p class="mt-2 p-2 bg-purple-100 text-purple-800 rounded-md font-bold text-center">بما أن <span class="fraction"><span>١</span><span>٢</span></span> × -٢ = -١، فالمستقيمان متعامدان.</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">ج) أمثلة تحتاج خطوتين للحل</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-sm space-y-2">
                                    <p class="text-lg font-semibold">المعادلتان:</p>
                                    <p class="text-lg text-center"><span class="text-red-600">٣</span>س + <span class="text-red-600">٥</span>ص = ١٠</p>
                                    <p class="text-lg text-center"><span class="text-blue-600">٥</span>ص = <span class="text-blue-600">-٣</span>س - ٥</p>
                                    <div class="pt-2 border-t">
                                        <p class="text-sm"><b>حل المعادلة الأولى:</b></p>
                                        <p class="text-xs text-gray-500">١. ننقل ٣س للطرف الآخر: <span class="math-eq">٥ص = -٣س + ١٠</span></p>
                                        <p class="text-xs text-gray-500">٢. نقسم على ٥: <span class="math-eq">ص = -<span class="fraction"><span>٣</span><span>٥</span></span>س + ٢</span>. الميل م₁ = <span class="text-red-600 font-bold">-<span class="fraction"><span>٣</span><span>٥</span></span></span></p>
                                    </div>
                                    <div class="pt-2 border-t">
                                        <p class="text-sm"><b>حل المعادلة الثانية:</b></p>
                                        <p class="text-xs text-gray-500">١. نقسم على ٥: <span class="math-eq">ص = -<span class="fraction"><span>٣</span><span>٥</span></span>س - ١</span>. الميل م₂ = <span class="text-blue-600 font-bold">-<span class="fraction"><span>٣</span><span>٥</span></span></span></p>
                                    </div>
                                    <p class="mt-2 p-2 bg-green-100 text-green-800 rounded-md font-bold text-center">بما أن الميلين متساويان، فالمستقيمان متوازيان.</p>
                                </div>
                                <div class="p-4 bg-white rounded-lg border border-gray-200 shadow-sm space-y-2">
                                    <p class="text-lg font-semibold">المعادلتان:</p>
                                    <p class="text-lg text-center"><span class="text-red-600">٥</span>س - <span class="text-red-600">٣</span>ص = ٦</p>
                                    <p class="text-lg text-center"><span class="text-blue-600">٣</span>س + <span class="text-blue-600">٥</span>ص = ١٠</p>
                                    <div class="pt-2 border-t">
                                        <p class="text-sm"><b>حل المعادلة الأولى:</b></p>
                                        <p class="text-xs text-gray-500">١. ننقل ٥س للطرف الآخر: <span class="math-eq">-٣ص = -٥س + ٦</span></p>
                                        <p class="text-xs text-gray-500">٢. نقسم على -٣: <span class="math-eq">ص = <span class="fraction"><span>-٥</span><span>-٣</span></span>س + <span class="fraction"><span>٦</span><span>-٣</span></span></span></p>
                                        <p class="text-xs text-gray-500">٣. نبسط: <span class="math-eq">ص = <span class="fraction"><span>٥</span><span>٣</span></span>س - ٢</span>. الميل م₁ = <span class="text-red-600 font-bold"><span class="fraction"><span>٥</span><span>٣</span></span></span></p>
                                    </div>
                                    <div class="pt-2 border-t">
                                        <p class="text-sm"><b>حل المعادلة الثانية:</b></p>
                                        <p class="text-xs text-gray-500">١. ننقل ٣س للطرف الآخر: <span class="math-eq">٥ص = -٣س + ١٠</span></p>
                                        <p class="text-xs text-gray-500">٢. نقسم على ٥: <span class="math-eq">ص = -<span class="fraction"><span>٣</span><span>٥</span></span>س + ٢</span>. الميل م₂ = <span class="text-blue-600 font-bold">-<span class="fraction"><span>٣</span><span>٥</span></span></span></p>
                                    </div>
                                    <p class="mt-2 p-2 bg-purple-100 text-purple-800 rounded-md font-bold text-center">بما أن <span class="fraction"><span>٥</span><span>٣</span></span> × -<span class="fraction"><span>٣</span><span>٥</span></span> = -١، فالمستقيمان متعامدان.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">مثال ٢: كتابة معادلات المستقيمات (تفاعلي)</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4 mb-8">
                        <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">النوع الأول: كتابة معادلة مستقيم موازٍ</h3>
                        <div class="flex flex-col md:flex-row gap-6">
                            <div class="flex-1">
                                <p class="mb-2"><b>تمرين (أ):</b> اكتب معادلة المستقيم المار بالنقطة (-١، -٥) وموازٍ للمستقيم <span class="math-eq">ص = ٣س + ٢</span>.</p>
                                <div class="border p-4 rounded-lg bg-white h-full flex flex-col">
                                    <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[200px]">
                                        <div id="interactive-explanation-1a" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-1a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-1a">0</span> / 4</span>
                                        <button id="interactive-next-1a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <p class="mb-2"><b>تمرين (ب):</b> اكتب معادلة المستقيم المار بالنقطة (٤، ٠) وموازٍ للمستقيم <span class="math-eq">٢س + ص = ١</span>.</p>
                                <div class="border p-4 rounded-lg bg-white h-full flex flex-col">
                                    <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[200px]">
                                        <div id="interactive-explanation-1b" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-1b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-1b">0</span> / 5</span>
                                        <button id="interactive-next-1b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-4 mb-8">
                        <h3 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">النوع الثاني: كتابة معادلة مستقيم متعامد</h3>
                        <div class="flex flex-col md:flex-row gap-6">
                            <div class="flex-1">
                                <p class="mb-2"><b>تمرين (ج):</b> اكتب معادلة المستقيم المار بالنقطة (٦، -١) ومتعامد مع المستقيم <span class="math-eq">ص = -٢س + ٥</span>.</p>
                                <div class="border p-4 rounded-lg bg-white h-full flex flex-col">
                                    <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[200px]">
                                        <div id="interactive-explanation-2a" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-2a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-2a">0</span> / 4</span>
                                        <button id="interactive-next-2a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <p class="mb-2"><b>تمرين (د):</b> اكتب معادلة المستقيم المار بالنقطة (-٤، ٣) ومتعامد مع المستقيم <span class="math-eq">٢س - ٥ص = ١٠</span>.</p>
                                <div class="border p-4 rounded-lg bg-white h-full flex flex-col">
                                    <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[200px]">
                                        <div id="interactive-explanation-2b" class="text-right"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="interactive-back-2b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-2b">0</span> / 5</span>
                                        <button id="interactive-next-2b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `, 
            generateQuiz: () => {
                const questionBank = [
                    { level: '⭐', text: `ما ميل المستقيم الموازي للمستقيم <span class="math-eq">ص = ٥س - ٣</span>؟`, options: [ { display: '٥', value: 'A' }, { display: '-٣', value: 'B' }, { display: '-<span class="fraction"><span>١</span><span>٥</span></span>', value: 'C' }, { display: '<span class="fraction"><span>١</span><span>٥</span></span>', value: 'D' } ], correct: 'A', explanation: `<p>المستقيمات المتوازية لها الميل نفسه.</p><p>ميل المستقيم المعطى <span class="math-eq">ص = <span class="text-red-600 font-bold">٥</span>س - ٣</span> هو <span class="text-red-600 font-bold">٥</span>.</p><p>إذن، ميل المستقيم الموازي له هو أيضاً <span class="text-red-600 font-bold">٥</span>.</p>` },
                    { level: '⭐', text: `ما ميل المستقيم المتعامد مع المستقيم <span class="math-eq">ص = -٤س + ١</span>؟`, options: [ { display: '-٤', value: 'A' }, { display: '٤', value: 'B' }, { display: '-<span class="fraction"><span>١</span><span>٤</span></span>', value: 'C' }, { display: '<span class="fraction"><span>١</span><span>٤</span></span>', value: 'D' } ], correct: 'D', explanation: `<p>ميل المستقيم المعطى هو <span class="math-eq">م₁ = <span class="text-red-600 font-bold">-٤</span></span>.</p><p>ميل المستقيم المتعامد هو معكوس مقلوب الميل الأول.</p><p>مقلوب <span class="text-red-600 font-bold">-٤</span> هو <span class="math-eq">-<span class="fraction"><span>١</span><span>٤</span></span></span>.</p><p>معكوس الإشارة هو <span class="math-eq"><span class="text-blue-600 font-bold"><span class="fraction"><span>١</span><span>٤</span></span></span></span>.</p>` },
                    { level: '⭐⭐', text: `ما معادلة المستقيم المار بالنقطة (٢، ٣) وموازٍ للمستقيم <span class="math-eq">ص = ٢س + ١</span>؟`, options: [ { display: 'ص = ٢س - ١', value: 'A' }, { display: 'ص = ٢س + ٣', value: 'B' }, { display: 'ص = -<span class="fraction"><span>١</span><span>٢</span></span>س + ٤', value: 'C' }, { display: 'ص - ٣ = ٢(س - ٢)', value: 'D' } ], correct: 'A', explanation: `<p><b>1. ميل المستقيم المعطى:</b> <span class="math-eq">م = <span class="text-red-600 font-bold">٢</span></span>.</p><p><b>2. ميل المستقيم الموازي:</b> <span class="math-eq">م = <span class="text-red-600 font-bold">٢</span></span>.</p><p><b>3. استخدام صيغة الميل ونقطة:</b> <span class="math-eq">ص - <span class="text-blue-600 font-bold">٣</span> = <span class="text-red-600 font-bold">٢</span>(س - <span class="text-green-600 font-bold">٢</span>)</span>.</p><p><b>4. التحويل لصيغة الميل والمقطع:</b><br>نفك القوس: <span class="math-eq">ص - ٣ = ٢س - ٤</span><br>ننقل -٣: <span class="math-eq">ص = ٢س - ١</span></p>` },
                    { level: '⭐⭐', text: `ما معادلة المستقيم المار بالنقطة (١، ٨) ومتعامد مع المستقيم <span class="math-eq">ص = <span class="fraction"><span>١</span><span>٤</span></span>س + ٥</span>؟`, options: [ { display: 'ص = -٤س + ١٢', value: 'A' }, { display: 'ص = <span class="fraction"><span>١</span><span>٤</span></span>س + ٧.٧٥', value: 'B' }, { display: 'ص = ٤س + ٤', value: 'C' }, { display: 'ص = -٤س + ٨', value: 'D' } ], correct: 'A', explanation: `<p><b>1. ميل المستقيم المعطى:</b> <span class="math-eq">م₁ = <span class="text-red-600 font-bold"><span class="fraction"><span>١</span><span>٤</span></span></span></span>.</p><p><b>2. ميل المستقيم المتعامد:</b> معكوس مقلوب <span class="text-red-600 font-bold"><span class="fraction"><span>١</span><span>٤</span></span></span> هو <span class="math-eq">م₂ = <span class="text-blue-600 font-bold">-٤</span></span>.</p><p><b>3. استخدام صيغة الميل ونقطة:</b> <span class="math-eq">ص - <span class="text-green-600 font-bold">٨</span> = <span class="text-blue-600 font-bold">-٤</span>(س - <span class="purple-600 font-bold">١</span>)</span>.</p><p><b>4. التحويل لصيغة الميل والمقطع:</b><br>نفك القوس: <span class="math-eq">ص - ٨ = -٤س + ٤</span><br>ننقل -٨: <span class="math-eq">ص = -٤س + ١٢</span></p>` },
                    { level: '⭐⭐⭐', text: `أي من المعادلات التالية تمثل مستقيماً متعامداً مع <span class="math-eq">٣س + ٢ص = ٦</span>؟`, options: [ { display: 'ص = -<span class="fraction"><span>٣</span><span>٢</span></span>س + ٥', value: 'A' }, { display: 'ص = <span class="fraction"><span>٣</span><span>٢</span></span>س + ١', value: 'B' }, { display: 'ص = <span class="fraction"><span>٢</span><span>٣</span></span>س - ٢', value: 'C' }, { display: 'ص = -<span class="fraction"><span>٢</span><span>٣</span></span>س + ٤', value: 'D' } ], correct: 'C', explanation: `<p><b>1. نوجد ميل المستقيم المعطى:</b></p><p class='text-sm'>المعادلة الأصلية: <span class="math-eq"><span class="text-red-600 font-bold">٣</span>س + <span class="text-blue-600 font-bold">٢</span>ص = ٦</span></p><p class='text-sm'>ننقل <span class="text-red-600 font-bold">٣</span>س للطرف الآخر: <span class="math-eq"><span class="text-blue-600 font-bold">٢</span>ص = -<span class="text-red-600 font-bold">٣</span>س + ٦</span></p><p class='text-sm'>نقسم الطرفين على <span class="text-blue-600 font-bold">٢</span>: <span class="math-eq">ص = -<span class="fraction"><span>٣</span><span>٢</span></span>س + ٣</span></p><p>إذن، ميل المستقيم المعطى هو <span class="math-eq">م₁ = -<span class="fraction"><span>٣</span><span>٢</span></span></span>.</p><p><b>2. نوجد ميل المستقيم المتعامد:</b></p><p>ميل المستقيم المتعامد هو معكوس مقلوب الميل الأول.</p><p><span class="math-eq">م₂ = <span class="fraction"><span>٢</span><span>٣</span></span></span>.</p><p><b>3. نبحث عن المعادلة التي ميلها <span class="fraction"><span>٢</span><span>٣</span></span>:</b></p><p>الإجابة الصحيحة هي <span class="math-eq">ص = <span class="fraction"><span>٢</span><span>٣</span></span>س - ٢</span>.</p>` },
                    { level: '⭐', text: `ما العلاقة بين المستقيمين <span class="math-eq">٦س + ٢ص = ٨</span> و <span class="math-eq">ص = -٣س - ٢</span>؟`, options: [ { display: 'متوازيان', value: 'A' }, { display: 'متعامدان', value: 'B' }, { display: 'متقاطعان وغير متعامدين', value: 'C' }, { display: 'متطابقان', value: 'D' } ], correct: 'A', explanation: `<p><b>1. نوجد ميل المستقيم الأول:</b></p><p class='text-sm'>المعادلة: <span class="math-eq">٦س + ٢ص = ٨</span></p><p class='text-sm'>ننقل ٦س: <span class="math-eq">٢ص = -٦س + ٨</span></p><p class='text-sm'>نقسم على ٢: <span class="math-eq">ص = -٣س + ٤</span></p><p>إذن، ميل المستقيم الأول هو <span class="math-eq">م₁ = <span class="text-red-600 font-bold">-٣</span></span>.</p><p><b>2. نوجد ميل المستقيم الثاني:</b></p><p>المعادلة <span class="math-eq">ص = -٣س - ٢</span> جاهزة بصيغة الميل والمقطع.</p><p>ميل المستقيم الثاني هو <span class="math-eq">م₂ = <span class="text-blue-600 font-bold">-٣</span></span>.</p><p><b>3. نقارن الميلين:</b></p><p>بما أن <span class="text-red-600 font-bold">-٣</span> = <span class="text-blue-600 font-bold">-٣</span>، فالمستقيمان متوازيان.</p>` },
                    { level: '⭐', text: `ما ميل المستقيم المتعامد مع المستقيم <span class="math-eq">س = ٥</span>؟`, options: [ { display: '٠', value: 'A' }, { display: '١', value: 'B' }, { display: 'غير معرف', value: 'C' }, { display: '-١', value: 'D' } ], correct: 'A', explanation: `<p>المستقيم <span class="math-eq">س = ٥</span> هو مستقيم رأسي.</p><p>ميل المستقيم الرأسي غير معرف.</p><p>المستقيم المتعامد مع مستقيم رأسي هو مستقيم أفقي.</p><p>ميل أي مستقيم أفقي يساوي <span class="text-red-600 font-bold">٠</span>.</p>` },
                    { level: '⭐⭐', text: `ما معادلة المستقيم المار بالنقطة (-٣، -١) وموازٍ للمستقيم <span class="math-eq">ص = -٢س + ٥</span>؟`, options: [ { display: 'ص = -٢س - ٧', value: 'A' }, { display: 'ص = -٢س - ١', value: 'B' }, { display: 'ص = <span class="fraction"><span>١</span><span>٢</span></span>س + ٠.٥', value: 'C' }, { display: 'ص = -٢س + ٥', value: 'D' } ], correct: 'A', explanation: `<p><b>1. ميل المستقيم المعطى:</b> <span class="math-eq">م = <span class="text-red-600 font-bold">-٢</span></span>.</p><p><b>2. ميل المستقيم الموازي:</b> <span class="math-eq">م = <span class="text-red-600 font-bold">-٢</span></span>.</p><p><b>3. استخدام صيغة الميل ونقطة:</b> <span class="math-eq">ص - (<span class="text-blue-600 font-bold">-١</span>) = <span class="text-red-600 font-bold">-٢</span>(س - (<span class="text-green-600 font-bold">-٣</span>))</span>.</p><p><b>4. التحويل لصيغة الميل والمقطع:</b><br>نبسط: <span class="math-eq">ص + ١ = -٢(س + ٣)</span><br>نفك القوس: <span class="math-eq">ص + ١ = -٢س - ٦</span><br>ننقل ١: <span class="math-eq">ص = -٢س - ٧</span></p>` },
                    { level: '⭐⭐', text: `ما معادلة المستقيم المار بالنقطة (٤، -٢) ومتعامد مع المستقيم <span class="math-eq">ص = -٤س + ١</span>؟`, options: [ { display: 'ص = <span class="fraction"><span>١</span><span>٤</span></span>س - ٣', value: 'A' }, { display: 'ص = -٤س + ١٤', value: 'B' }, { display: 'ص = <span class="fraction"><span>١</span><span>٤</span></span>س - ١', value: 'C' }, { display: 'ص = ٤س - ١٨', value: 'D' } ], correct: 'A', explanation: `<p><b>1. ميل المستقيم المعطى:</b> <span class="math-eq">م₁ = <span class="text-red-600 font-bold">-٤</span></span>.</p><p><b>2. ميل المستقيم المتعامد:</b> معكوس مقلوب <span class="text-red-600 font-bold">-٤</span> هو <span class="math-eq">م₂ = <span class="text-blue-600 font-bold"><span class="fraction"><span>١</span><span>٤</span></span></span></span>.</p><p><b>3. استخدام صيغة الميل ونقطة:</b> <span class="math-eq">ص - (<span class="text-green-600 font-bold">-٢</span>) = <span class="text-blue-600 font-bold"><span class="fraction"><span>١</span><span>٤</span></span></span>(س - <span class="purple-600 font-bold">٤</span>)</span>.</p><p><b>4. التحويل لصيغة الميل والمقطع:</b><br>نبسط: <span class="math-eq">ص + ٢ = <span class="fraction"><span>١</span><span>٤</span></span>س - ١</span><br>ننقل ٢: <span class="math-eq">ص = <span class="fraction"><span>١</span><span>٤</span></span>س - ٣</span></p>` },
                    { level: '⭐⭐', text: `ما العلاقة بين المستقيمين <span class="math-eq">ص - ٢ = ٣(س - ١)</span> و <span class="math-eq">ص = -<span class="fraction"><span>١</span><span>٣</span></span>س + ٤</span>؟`, options: [ { display: 'متوازيان', value: 'A' }, { display: 'متعامدان', value: 'B' }, { display: 'متقاطعان وغير متعامدين', value: 'C' }, { display: 'متطابقان', value: 'D' } ], correct: 'B', explanation: `<p><b>1. ميل المستقيم الأول:</b> المعادلة بصيغة الميل ونقطة، إذن الميل هو <span class="math-eq">م₁ = <span class="text-red-600 font-bold">٣</span></span>.</p><p><b>2. ميل المستقيم الثاني:</b> المعادلة بصيغة الميل والمقطع، إذن الميل هو <span class="math-eq">م₂ = <span class="text-blue-600 font-bold">-<span class="fraction"><span>١</span><span>٣</span></span></span></span>.</p><p><b>3. نتحقق من العلاقة:</b><br>حاصل ضرب الميلين: <span class="math-eq"><span class="text-red-600 font-bold">٣</span> × (<span class="text-blue-600 font-bold">-<span class="fraction"><span>١</span><span>٣</span></span></span>) = -١</span>.</p><p>بما أن حاصل الضرب يساوي -١، فالمستقيمان متعامدان.</p>` },
                    { level: '⭐⭐⭐', text: `اكتب معادلة المستقيم المار بالنقطة (٢، ٥) ومتعامد مع المستقيم <span class="math-eq">٤س + ص = ٧</span> بصيغة الميل والمقطع.`, options: [ { display: 'ص = <span class="fraction"><span>١</span><span>٤</span></span>س + ٤.٥', value: 'A' }, { display: 'ص = -٤س + ١٣', value: 'B' }, { display: 'ص = <span class="fraction"><span>١</span><span>٤</span></span>س - ٤.٥', value: 'C' }, { display: 'ص = -٤س + ٥', value: 'D' } ], correct: 'A', explanation: `<p><b>1. نوجد ميل المستقيم المعطى:</b><br><span class="math-eq">٤س + ص = ٧</span> ننقل ٤س فتصبح <span class="math-eq">ص = -٤س + ٧</span>. إذن <span class="math-eq">م₁ = <span class="text-red-600 font-bold">-٤</span></span>.</p><p><b>2. ميل المستقيم المتعامد:</b> معكوس مقلوب <span class="text-red-600 font-bold">-٤</span> هو <span class="math-eq">م₂ = <span class="text-blue-600 font-bold"><span class="fraction"><span>١</span><span>٤</span></span></span></span>.</p><p><b>3. استخدام صيغة الميل ونقطة:</b> <span class="math-eq">ص - <span class="text-green-600 font-bold">٥</span> = <span class="text-blue-600 font-bold"><span class="fraction"><span>١</span><span>٤</span></span></span>(س - <span class="purple-600 font-bold">٢</span>)</span>.</p><p><b>4. التحويل لصيغة الميل والمقطع:</b><br>نفك القوس: <span class="math-eq">ص - ٥ = <span class="fraction"><span>١</span><span>٤</span></span>س - <span class="fraction"><span>٢</span><span>٤</span></span></span><br>نبسط وننقل -٥: <span class="math-eq">ص = <span class="fraction"><span>١</span><span>٤</span></span>س - ٠.٥ + ٥</span><br>الناتج النهائي: <span class="math-eq">ص = <span class="fraction"><span>١</span><span>٤</span></span>س + ٤.٥</span></p>` },
                    { level: '⭐⭐⭐', text: `أي وصف يصف المستقيمين <span class="math-eq">٢س - ٥ص = -٣</span> و <span class="math-eq">٥س + ٢ص = ٦</span>؟`, options: [ { display: 'متوازيان', value: 'A' }, { display: 'متعامدان', value: 'B' }, { display: 'متقاطعان وغير متعامدين', value: 'C' }, { display: 'متطابقان', value: 'D' } ], correct: 'B', explanation: `<p><b>1. نوجد ميل المستقيم الأول:</b><br><span class="math-eq">٢س - ٥ص = -٣</span> ننقل ٢س: <span class="math-eq">-٥ص = -٢س - ٣</span> نقسم على -٥: <span class="math-eq">ص = <span class="text-red-600 font-bold"><span class="fraction"><span>٢</span><span>٥</span></span></span>س + <span class="fraction"><span>٣</span><span>٥</span></span></span>. إذن <span class="math-eq">م₁ = <span class="text-red-600 font-bold"><span class="fraction"><span>٢</span><span>٥</span></span></span></span>.</p><p><b>2. نوجد ميل المستقيم الثاني:</b><br><span class="math-eq">٥س + ٢ص = ٦</span> ننقل ٥س: <span class="math-eq">٢ص = -٥س + ٦</span> نقسم على ٢: <span class="math-eq">ص = <span class="text-blue-600 font-bold">-<span class="fraction"><span>٥</span><span>٢</span></span></span>س + ٣</span>. إذن <span class="math-eq">م₂ = <span class="text-blue-600 font-bold">-<span class="fraction"><span>٥</span><span>٢</span></span></span></span>.</p><p><b>3. نتحقق من العلاقة:</b><br>حاصل ضرب الميلين: <span class="math-eq">(<span class="text-red-600 font-bold"><span class="fraction"><span>٢</span><span>٥</span></span></span>) × (<span class="text-blue-600 font-bold">-<span class="fraction"><span>٥</span><span>٢</span></span></span>) = -١</span>.</p><p>بما أن حاصل الضرب يساوي -١، فالمستقيمان متعامدان.</p>` }
                ];
                return [...questionBank].sort(() => Math.random() - 0.5).slice(0, 5);
            }  },
        
        // === الفصل الرابع: المتباينات الخطية ===
        'c4_l1': { title: 'الدرس ٤-١: حل المتباينات بالجمع أو بالطرح', content: `
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفاهيم الأساسية</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h3 class="text-xl font-semibold text-blue-700 mb-2">خاصية الجمع للمتباينات</h3>
                                <p>إذا أُضيف العدد نفسه إلى كل من طرفي متباينة صحيحة، فإن المتباينة الناتجة تبقى صحيحة.</p>
                                <div class="mt-4 p-4 bg-white rounded-lg border">
                                    <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-lg md:text-xl math-eq">
                                        إذا كان أ > ب،<br> فإن أ + <span class="text-red-600">ج</span> > ب + <span class="text-red-600">ج</span>
                                    </p>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold text-blue-700 mb-2">خاصية الطرح للمتباينات</h3>
                                <p>إذا طُرح العدد نفسه من كل من طرفي متباينة صحيحة، فإن المتباينة الناتجة تبقى صحيحة.</p>
                                <div class="mt-4 p-4 bg-white rounded-lg border">
                                    <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-lg md:text-xl math-eq">
                                        إذا كان أ > ب،<br> فإن أ - <span class="text-red-600">ج</span> > ب - <span class="text-red-600">ج</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">المفردات الجديدة</h3>
                            <p><span class="vocab-term">المجموعة:</span> هي تجمع من الأشياء أو الأعداد المتميزة.</p>
                            <p class="mt-2"><span class="vocab-term">الصفة المميزة للمجموعة:</span> طريقة مختصرة لوصف مجموعة الحلول، مثل: <span class="math-eq">{س | س > ٥}</span> وتقرأ "مجموعة كل الأعداد س حيث س أكبر من ٥".</p>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">✍️ ثانياً: أمثلة تفاعلية</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="border p-4 rounded-lg bg-white h-full flex flex-col shadow-sm">
                                <p class="mb-2 font-bold">أ) حل متباينة باستعمال الجمع: <span class="math-eq">س - ١٢ ≥ ٨</span></p>
                                <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[320px]">
                                    <div id="interactive-explanation-1a" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="interactive-back-1a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-1a">0</span> / 4</span>
                                    <button id="interactive-next-1a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                            <div class="border p-4 rounded-lg bg-white h-full flex flex-col shadow-sm">
                                <p class="mb-2 font-bold">ب) حل متباينة باستعمال الطرح: <span class="math-eq">م + ١٩ > ٥٦</span></p>
                                <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[320px]">
                                    <div id="interactive-explanation-1b" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="interactive-back-1b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-1b">0</span> / 4</span>
                                    <button id="interactive-next-1b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="border p-4 rounded-lg bg-white h-full flex flex-col shadow-sm">
                                <p class="mb-2 font-bold">ج) متغير في طرفي المتباينة: <span class="math-eq">٥ن - ١ < ٤ن + ٦</span></p>
                                <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[320px]">
                                    <div id="interactive-explanation-2a" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="interactive-back-2a" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-2a">0</span> / 5</span>
                                    <button id="interactive-next-2a" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                            <div class="border p-4 rounded-lg bg-white h-full flex flex-col shadow-sm">
                                <p class="mb-2 font-bold">د) متغير في طرفي المتباينة: <span class="math-eq">٣س + ٦ ≤ ٢س + ٨</span></p>
                                <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[320px]">
                                    <div id="interactive-explanation-2b" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="interactive-back-2b" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-2b">0</span> / 5</span>
                                    <button id="interactive-next-2b" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">📝 ثالثاً: المسائل اللفظية</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-4">ملخص المفهوم: العبارات التي تدل على المتباينات</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-center border-collapse">
                                    <thead>
                                        <tr class="bg-blue-600 text-white">
                                            <th class="p-3 border border-blue-400">&lt;</th>
                                            <th class="p-3 border border-blue-400">&gt;</th>
                                            <th class="p-3 border border-blue-400">≤</th>
                                            <th class="p-3 border border-blue-400">≥</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white">
                                        <tr>
                                            <td class="p-3 border">أقل من<br>أصغر من</td>
                                            <td class="p-3 border">أكبر من<br>أكثر من</td>
                                            <td class="p-3 border">أقل من أو يساوي<br>على الأكثر<br>لا يزيد على</td>
                                            <td class="p-3 border">أكبر من أو يساوي<br>على الأقل<br>لا يقل عن</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="mt-8">
                            <h3 class="text-xl font-semibold text-gray-700 mb-4 border-t pt-4">و) تدريبات على كتابة المتباينات (دون حل)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="p-4 bg-white rounded-lg border">
                                    <p class="mb-2">١. يجب أن يكون عمرك <span class="math-eq">ع</span> <span class="font-bold text-red-600">أكبر من</span> ١٨ عاماً للتصويت.</p>
                                    <p class="text-center mt-2 solution-set"><span class="math-eq">ع > ١٨</span></p>
                                </div>
                                <div class="p-4 bg-white rounded-lg border">
                                    <p class="mb-2">٢. يجب أن تكون درجة حرارة التجمد <span class="math-eq">د</span> <span class="font-bold text-red-600">أقل من</span> ٠ درجة مئوية.</p>
                                    <p class="text-center mt-2 solution-set"><span class="math-eq">د < ٠</span></p>
                                </div>
                                <div class="p-4 bg-white rounded-lg border">
                                    <p class="mb-2">٣. يجب أن يكون معك <span class="math-eq">م</span> من المال <span class="font-bold text-red-600">على الأقل</span> ٥ ريالات لدخول الحديقة.</p>
                                    <p class="text-center mt-2 solution-set"><span class="math-eq">م ≥ ٥</span></p>
                                </div>
                                <div class="p-4 bg-white rounded-lg border">
                                    <p class="mb-2">٤. سعة خزان الوقود <span class="math-eq">س</span> <span class="font-bold text-red-600">لا تزيد على</span> ٥٠ لتراً.</p>
                                    <p class="text-center mt-2 solution-set"><span class="math-eq">س ≤ ٥٠</span></p>
                                </div>
                                <div class="p-4 bg-white rounded-lg border">
                                    <p class="mb-2">٥. ناتج <span class="font-bold text-red-600">جمع</span> عدد <span class="math-eq">س</span> إلى ٨ هو <span class="font-bold text-red-600">أصغر من</span> ٢٠.</p>
                                    <p class="text-center mt-2 solution-set"><span class="math-eq">س + ٨ < ٢٠</span></p>
                                </div>
                                <div class="p-4 bg-white rounded-lg border">
                                    <p class="mb-2">٦. ناتج <span class="font-bold text-red-600">طرح</span> ٦ من عدد <span class="math-eq">ص</span> هو <span class="font-bold text-red-600">أكبر من</span> ١٠.</p>
                                    <p class="text-center mt-2 solution-set"><span class="math-eq">ص - ٦ > ١٠</span></p>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="border p-4 rounded-lg bg-white h-full flex flex-col shadow-sm">
                                <p class="mb-2 font-bold">ز) مسألة لفظية (مثال محلول): مع خالد ١٩٥ ريالاً ويريد أن ينفقها في مركز تجاري. اشترى قميصاً بمبلغ ٧٥ ريالاً، ويريد أن يشتري بنطالاً. ما المبلغ الذي يمكن أن يدفعه للبنطال؟</p>
                                <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[320px]">
                                    <div id="interactive-explanation-verbal-1" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="interactive-back-verbal-1" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-verbal-1">0</span> / 3</span>
                                    <button id="interactive-next-verbal-1" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                            <div class="border p-4 rounded-lg bg-white h-full flex flex-col shadow-sm">
                                <p class="mb-2 font-bold">ح) مسألة لفظية (مثال محلول): تريد سارة أن تدخر ٥٠٠ ريال على الأقل. إذا كان لديها ٢١٠ ريالات، فما المبلغ الإضافي الذي يجب أن تدخره؟</p>
                                <div class="bg-gray-100 p-4 rounded-lg border flex-grow min-h-[320px]">
                                    <div id="interactive-explanation-verbal-2" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="interactive-back-verbal-2" class="nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="interactive-step-counter-verbal-2">0</span> / 3</span>
                                    <button id="interactive-next-verbal-2" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 text-sm">التالي</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `, 
            generateQuiz: () => {
                const questionBank = [
                    { type: 'mcq', level: '⭐', text: `حل المتباينة التالية: <span class="math-eq">س + ٤ < ٩</span>`, options: [ { display: 'س < ٥', value: 'A' }, { display: 'س > ٥', value: 'B' }, { display: 'س < ١٣', value: 'C' }, { display: 'س > ١٣', value: 'D' } ], correct: 'A', explanation: `<p>لحل المتباينة <span class="math-eq">س + ٤ < ٩</span>، نطرح ٤ من الطرفين.</p><p><span class="math-eq">س + ٤ - ٤ < ٩ - ٤</span></p><p>إذن، الحل هو <span class="math-eq">س < ٥</span>.</p>` },
                    { type: 'mcq', level: '⭐', text: `حل المتباينة التالية: <span class="math-eq">ص - ٣ ≥ ٧</span>`, options: [ { display: 'ص ≥ ٤', value: 'A' }, { display: 'ص ≤ ٤', value: 'B' }, { display: 'ص ≥ ١٠', value: 'C' }, { display: 'ص ≤ ١٠', value: 'D' } ], correct: 'C', explanation: `<p>لحل المتباينة <span class="math-eq">ص - ٣ ≥ ٧</span>، نضيف ٣ إلى الطرفين.</p><p><span class="math-eq">ص - ٣ + ٣ ≥ ٧ + ٣</span></p><p>إذن، الحل هو <span class="math-eq">ص ≥ ١٠</span>.</p>` },
                    { type: 'mcq', level: '⭐⭐', text: `حل المتباينة التالية: <span class="math-eq">٨ ≤ ف + ١٣</span>`, options: [ { display: 'ف ≥ -٥', value: 'A' }, { display: 'ف ≤ -٥', value: 'B' }, { display: 'ف ≥ ٢١', value: 'C' }, { display: 'ف ≤ ٢١', value: 'D' } ], correct: 'A', explanation: `<p>لحل المتباينة <span class="math-eq">٨ ≤ ف + ١٣</span>، نطرح ١٣ من الطرفين.</p><p><span class="math-eq">٨ - ١٣ ≤ ف + ١٣ - ١٣</span></p><p>نبسط: <span class="math-eq">-٥ ≤ ف</span>، والتي تكافئ <span class="math-eq">ف ≥ -٥</span>.</p>` },
                    { type: 'mcq', level: '⭐⭐', text: `ما هي المتباينة التي تعبر عن الجملة "ناتج جمع عدد و ٧ أكبر من ١٥"؟`, options: [ { display: 'س + ٧ < ١٥', value: 'A' }, { display: 'س + ٧ ≤ ١٥', value: 'B' }, { display: 'س + ٧ > ١٥', value: 'C' }, { display: 'س + ٧ ≥ ١٥', value: 'D' } ], correct: 'C', explanation: `<p>الجملة "ناتج جمع عدد و ٧" تترجم إلى <span class="math-eq">س + ٧</span>.</p><p>علامة "أكبر من" هي <span class="math-eq">></span>.</p><p>إذن، المتباينة الكاملة هي <span class="math-eq">س + ٧ > ١٥</span>.</p>` },
                    { type: 'mcq', level: '⭐⭐⭐', text: `حل المتباينة التالية: <span class="math-eq">٩ن - ١ > ١٠ن</span>`, options: [ { display: 'ن < -١', value: 'A' }, { display: 'ن > -١', value: 'B' }, { display: 'ن < ١', value: 'C' }, { display: 'ن > ١', value: 'D' } ], correct: 'A', explanation: `<p><b>1. المتباينة الأصلية:</b> <span class="math-eq">٩ن - ١ > ١٠ن</span>.</p><p><b>2. نطرح ٩ن من الطرفين:</b> <span class="math-eq">٩ن - ٩ن - ١ > ١٠ن - ٩ن</span>.</p><p><b>3. نبسط:</b> <span class="math-eq">-١ > ن</span>.</p><p><b>4. إعادة الترتيب:</b> <span class="math-eq">ن < -١</span>.</p>` },
                    { type: 'mcq', level: '⭐⭐', text: `أي من الأعداد التالية ينتمي لمجموعة حل المتباينة <span class="math-eq">ك - ٩ ≤ -٤</span>؟`, options: [ { display: '٦', value: 'A' }, { display: '٧', value: 'B' }, { display: '٨', value: 'C' }, { display: '٥', value: 'D' } ], correct: 'D', explanation: `<p><b>1. نحل المتباينة أولاً:</b> <span class="math-eq">ك - ٩ ≤ -٤</span>.</p><p><b>2. نضيف ٩ للطرفين:</b> <span class="math-eq">ك - ٩ + ٩ ≤ -٤ + ٩</span>.</p><p><b>3. نبسط:</b> <span class="math-eq">ك ≤ ٥</span>.</p><p><b>4. نتحقق من الخيارات:</b> العدد الوحيد الذي يحقق الشرط "أصغر من أو يساوي ٥" هو العدد ٥.</p>` },
                    { type: 'mcq', level: '⭐⭐⭐', text: `حل المتباينة التالية: <span class="math-eq">٥هـ + ٢ ≤ ٤هـ - ١</span>`, options: [ { display: 'هـ ≤ -٣', value: 'A' }, { display: 'هـ ≥ -٣', value: 'B' }, { display: 'هـ ≤ ١', value: 'C' }, { display: 'هـ ≥ ١', value: 'D' } ], correct: 'A', explanation: `<p><b>1. المتباينة الأصلية:</b> <span class="math-eq">٥هـ + ٢ ≤ ٤هـ - ١</span>.</p><p><b>2. نطرح ٤هـ من الطرفين:</b> <span class="math-eq">٥هـ - ٤هـ + ٢ ≤ ٤هـ - ٤هـ - ١</span>.</p><p><b>3. نبسط:</b> <span class="math-eq">هـ + ٢ ≤ -١</span>.</p><p><b>4. نطرح ٢ من الطرفين:</b> <span class="math-eq">هـ + ٢ - ٢ ≤ -١ - ٢</span>.</p><p><b>5. الحل النهائي:</b> <span class="math-eq">هـ ≤ -٣</span>.</p>` },
                    { type: 'mcq', level: '⭐⭐', text: `ناتج طرح ٥ من عدد ما، هو على الأقل ١٢. اكتب المتباينة التي تمثل هذه الجملة.`, options: [ { display: 'س - ٥ ≥ ١٢', value: 'A' }, { display: 'س - ٥ ≤ ١٢', value: 'B' }, { display: '٥ - س ≥ ١٢', value: 'C' }, { display: 'س + ٥ ≥ ١٢', value: 'D' } ], correct: 'A', explanation: `<p>عبارة "ناتج طرح ٥ من عدد ما" تترجم إلى <span class="math-eq">س - ٥</span>.</p><p>عبارة "على الأقل" تعني "أكبر من أو يساوي" (≥).</p><p>إذن، المتباينة هي <span class="math-eq">س - ٥ ≥ ١٢</span>.</p>` },
                    { type: 'mcq', level: '⭐⭐', text: `أي من المتباينات التالية حلها هو <span class="math-eq">ن ≥ -٢</span>؟`, options: [ { display: 'ن + ٣ ≥ ١', value: 'A' }, { display: 'ن - ١ ≥ ١', value: 'B' }, { display: 'ن + ٥ ≥ ٨', value: 'C' }, { display: 'ن - ٢ ≥ -٣', value: 'D' } ], correct: 'A', explanation: `<p>نحل الخيار الأول: <span class="math-eq">ن + ٣ ≥ ١</span>.</p><p>نطرح ٣ من الطرفين: <span class="math-eq">ن ≥ ١ - ٣</span>.</p><p>إذن، <span class="math-eq">ن ≥ -٢</span>. وهو الحل المطلوب.</p>` },
                    { type: 'mcq', level: '⭐', text: `ما هي الجملة التي تمثل المتباينة <span class="math-eq">س - ٥ > ١٠</span>؟`, options: [ { display: 'عدد مطروح منه ٥ أكبر من ١٠', value: 'A' }, { display: 'عدد مطروح منه ٥ أصغر من ١٠', value: 'B' }, { display: 'مجموع عدد و ٥ أكبر من ١٠', value: 'C' }, { display: '٥ مطروح من عدد أكبر من ١٠', value: 'D' } ], correct: 'A', explanation: `<p>المتباينة <span class="math-eq">س - ٥ > ١٠</span> تقرأ حرفياً: عدد (س) مطروح منه ٥ هو أكبر من (>) ١٠.</p>` },
                    { type: 'mcq', level: '⭐⭐⭐', text: `حل المتباينة التالية: <span class="math-eq">-٢ + ف ≤ -٧ + ٢ف</span>`, options: [ { display: 'ف ≥ ٥', value: 'A' }, { display: 'ف ≤ ٥', value: 'B' }, { display: 'ف ≥ -٩', value: 'C' }, { display: 'ف ≤ -٩', value: 'D' } ], correct: 'A', explanation: `<p><b>1. نطرح ف من الطرفين:</b> <span class="math-eq">-٢ ≤ -٧ + ف</span>.</p><p><b>2. نضيف ٧ للطرفين:</b> <span class="math-eq">-٢ + ٧ ≤ ف</span>.</p><p><b>3. نبسط:</b> <span class="math-eq">٥ ≤ ف</span>، والتي تكافئ <span class="math-eq">ف ≥ ٥</span>.</p>` },
                    { type: 'mcq', level: '⭐⭐', text: `يريد سائق قطع مسافة لا تقل عن ٣٠٠ كم. إذا قطع ١٢٠ كم بالفعل، فما المتباينة التي تمثل المسافة المتبقية <span class="math-eq">م</span> التي يجب عليه قطعها؟`, options: [ { display: '١٢٠ + م ≥ ٣٠٠', value: 'A' }, { display: '١٢٠ + م ≤ ٣٠٠', value: 'B' }, { display: 'م - ١٢٠ ≥ ٣٠٠', value: 'C' }, { display: '٣٠٠ - م ≤ ١٢٠', value: 'D' } ], correct: 'A', explanation: `<p>المسافة المقطوعة (١٢٠ كم) زائد المسافة المتبقية (<span class="math-eq">م</span>) يجب أن تكون "لا تقل عن" (≥) ٣٠٠ كم.</p><p>إذن، المتباينة هي <span class="math-eq">١٢٠ + م ≥ ٣٠٠</span>.</p>` }
                ];
                return [...questionBank].sort(() => Math.random() - 0.5).slice(0, 5);
            }  },
        'c4_l2': { title: 'الدرس ٤-٢: حل المتباينات بالضرب أو بالقسمة', content: '<!-- سيتم إضافة محتوى الدرس هنا -->', generateQuiz: () => { /* سيتم إضافة اختبار الدرس هنا */ return []; } },
        'c4_l3': { title: 'الدرس ٤-٣: حل المتباينات المتعددة الخطوات', content: '<!-- سيتم إضافة محتوى الدرس هنا -->', generateQuiz: () => { /* سيتم إضافة اختبار الدرس هنا */ return []; } },
        'c4_l4': { title: 'الدرس ٤-٤: حل المتباينات المركبة', content: '<!-- سيتم إضافة محتوى الدرس هنا -->', generateQuiz: () => { /* سيتم إضافة اختبار الدرس هنا */ return []; } },
        'c4_l5': { title: 'الدرس ٤-٥: حل المتباينات التي تتضمن القيمة المطلقة', content: '<!-- سيتم إضافة محتوى الدرس هنا -->', generateQuiz: () => { /* سيتم إضافة اختبار الدرس هنا */ return []; } },
    };

    // =================================================================
    // == 2. مراجع عناصر واجهة المستخدم
    // =================================================================
    const allViews = document.querySelectorAll('.view-section');
    const loginView = document.getElementById('login-view');
    const mainContentView = document.getElementById('main-content-view');
    const lessonView = document.getElementById('lesson-view');
    const userInfoHeader = document.getElementById('user-info-header');
    const teacherName = document.getElementById('teacher-name');
    const headerTitle = document.getElementById('header-title');
    const userWelcomeMessage = document.getElementById('user-welcome-message');
    const dashboardSection = document.getElementById('dashboard-section');
    const loginForm = document.getElementById('login-form');
    const loginSubmitBtn = document.getElementById('login-submit-btn');
    const explanationModal = document.getElementById('explanationModal');
    const explanationText = document.getElementById('explanationText');
    const closeModalBtn = document.getElementById('closeModalBtn');

    // =================================================================
    // == 3. المنطق الأساسي للتطبيق
    // =================================================================

    /**
     * يخفي كل الواجهات الرئيسية ويظهر الواجهة المحددة.
     * @param {HTMLElement} viewToShow عنصر الواجهة المراد إظهاره.
     */
    function showView(viewToShow) {
        allViews.forEach(v => v.classList.add('hidden'));
        viewToShow.classList.remove('hidden');
    }

    /**
     * يبني قائمة الفهرس الرئيسية (الأكورديون) مع الفصول والدروس.
     * @param {object | null} studentData بيانات الطالب المسجل، أو null للزائر.
     */
    function buildAccordion(studentData) {
        const accordionContainer = document.getElementById('accordion-container');
        accordionContainer.innerHTML = '';
        const chapters = { c1: [], c2: [], c3: [], c4: [] };
        Object.keys(curriculum).forEach(lessonId => {
            const chapterId = lessonId.substring(0, 2);
            if (chapters[chapterId]) {
                curriculum[lessonId].id = lessonId;
                chapters[chapterId].push(curriculum[lessonId]);
            }
        });
        const chapterTitles = { c1: "الفصل ١: المعادلات الخطية", c2: "الفصل ٢: العلاقات والدوال الخطية", c3: "الفصل ٣: الدوال الخطية", c4: "الفصل ٤: المتباينات الخطية" };
        
        Object.keys(chapters).forEach(chapterId => {
            if (chapters[chapterId].length === 0) return;
            const lessonsHtml = chapters[chapterId].map(lesson => `
                <li class="flex justify-between items-center">
                    <button data-lesson-id="${lesson.id}" class="lesson-link text-gray-600 hover:text-indigo-600 text-right">${lesson.title}</button>
                    <span id="grade-${lesson.id}" class="grade-display bg-gray-200 text-gray-700 text-sm font-bold px-2 py-1 rounded">-</span>
                </li>
            `).join('');
            const chapterHtml = `
                <div class="border border-gray-200 rounded-lg">
                    <button class="chapter-toggle w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100">
                        <h4 class="text-xl font-bold text-blue-700">${chapterTitles[chapterId]}</h4>
                        <svg class="w-6 h-6 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="lessons-list hidden p-4 border-t border-gray-200">
                        <ul class="space-y-3">${lessonsHtml}</ul>
                    </div>
                </div>`;
            accordionContainer.innerHTML += chapterHtml;
        });

        document.querySelectorAll('.chapter-toggle').forEach(btn => btn.onclick = () => {
            btn.nextElementSibling.classList.toggle('hidden');
            btn.querySelector('svg').classList.toggle('rotate-180');
        });
        document.querySelectorAll('.lesson-link').forEach(btn => btn.onclick = () => showLessonView(btn.dataset.lessonId));
        if(studentData) {
            updateGradesOnAccordion(studentData.lessons);
        } else {
            // بالنسبة للزائر، نخفي خانة الدرجة
            document.querySelectorAll('.grade-display').forEach(el => el.classList.add('hidden'));
        }
    }

    /**
     * يحدّث عرض الدرجات في قائمة الفهرس.
     * @param {object} lessons بيانات دروس الطالب.
     */
    function updateGradesOnAccordion(lessons) {
        if (!lessons) return;
        Object.keys(lessons).forEach(lessonId => {
            const gradeSpan = document.getElementById(`grade-${lessonId}`);
            if (gradeSpan) {
                const grade = lessons[lessonId].grade;
                gradeSpan.textContent = grade;
                gradeSpan.className = 'grade-display text-sm font-bold px-2 py-1 rounded';
                if (grade >= 5) {
                    gradeSpan.classList.add('bg-green-200', 'text-green-800');
                } else {
                    gradeSpan.classList.add('bg-red-200', 'text-red-800');
                }
            }
        });
    }

    /**
     * يعرض محتوى واختبار درس معين.
     * @param {string} lessonId المعرّف الخاص بالدرس.
     */
    function showLessonView(lessonId) {
        const lesson = curriculum[lessonId];
        if (!lesson || (lesson.content && lesson.content.includes('<!-- سيتم إضافة محتوى الدرس هنا -->'))) {
            alert('عفواً، محتوى هذا الدرس لم تتم إضافته بعد.');
            return;
        }

        let attemptsLeft;
        if (currentStudent) {
            // منطق الطالب المسجل
            const studentLessonData = currentStudent.lessons?.[lessonId] || { attempts: 0 };
            attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts;
        } else {
            // منطق الزائر
            const visitorAttempts = JSON.parse(sessionStorage.getItem('visitorAttempts')) || {};
            attemptsLeft = visitorAttempts[lessonId] ? 0 : 1;
        }

        activeQuizQuestions = lesson.generateQuiz();
        
        const contentHtml = lesson.content;
        
        const quizHtml = activeQuizQuestions.map((q, index) => {
            const borderColorClass = q.level === '⭐' ? 'border-green-300' : (q.level === '⭐⭐' ? 'border-blue-300' : 'border-red-300');
            const optionsHTML = q.options.map((opt, optIndex) => `
                <div>
                    <input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}">
                    <label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label>
                </div>
            `).join('');
            const questionBody = `<div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div>`;

            return `
                <div class="p-4 border-2 ${borderColorClass} rounded-lg">
                    <p class="font-bold">${index + 1}. <span class="text-yellow-400">${q.level || ''}</span> ${q.text}</p>
                    ${q.graph ? `<div class="quiz-graph-container">${q.graph}</div>` : ''}
                    ${questionBody}
                    <div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div>
                    <button type="button" data-action="show-explanation" data-index="${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline" id="explain-btn-${index}">اعرف لماذا؟</button>
                </div>`;
        }).join('');

        lessonView.innerHTML = `
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 class="text-3xl font-bold text-blue-800">${lesson.title}</h1>
                    <button data-action="back-to-main" class="text-sm text-blue-600 hover:underline">&larr; العودة إلى الفهرس</button>
                </header>
                
                ${contentHtml}
                
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">✍️ اختبر فهمك</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600">المحاولات المتبقية: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span></div>
                    </div>
                    ${!currentStudent ? '<p id="visitor-quiz-message" class="text-center text-blue-600 font-bold mb-4 p-3 bg-blue-50 rounded-lg">لديك محاولة واحدة كزائر.</p>' : ''}
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8">${quizHtml}</form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">نتيجتك النهائية</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button data-action="retake-quiz" data-lesson-id="${lessonId}" class="mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">إعادة الاختبار</button>
                    </div>
                </section>
            </div>`;
        
        // يشغل السكريبت الخاص بالدرس بعد عرض المحتوى
        initializeLessonScripts(lessonId);
        
        showView(lessonView);
        initializeQuizInteractivity(lessonId, attemptsLeft);
    }
    
    /**
     * يجهز معالجات الأحداث الخاصة بنموذج الاختبار.
     * @param {string} lessonId المعرّف الخاص بالدرس الحالي.
     * @param {number} attemptsLeft عدد المحاولات المتبقية.
     */
    function initializeQuizInteractivity(lessonId, attemptsLeft) {
        const quizForm = document.getElementById('quizForm');
        if (!quizForm) return;

        const submitQuizBtn = document.createElement('button');
        submitQuizBtn.id = 'submit-quiz-btn';
        submitQuizBtn.type = 'submit';
        submitQuizBtn.className = 'w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8';
        submitQuizBtn.textContent = 'تحقق من إجاباتي';
        quizForm.appendChild(submitQuizBtn);

        const retakeQuizBtn = document.querySelector('[data-action="retake-quiz"]');

        if (attemptsLeft > 0) {
            quizForm.onsubmit = (e) => {
                e.preventDefault();
                let score = 0;
                activeQuizQuestions.forEach((q, index) => {
                    const userAnswer = e.target.elements[`q${index}`]?.value;
                    const feedbackEl = document.getElementById(`feedback-q${index}`);
                    if (userAnswer === q.correct) {
                        score++;
                        feedbackEl.textContent = '✔ إجابة صحيحة!';
                        feedbackEl.className = 'mt-2 text-sm font-bold feedback-correct';
                    } else {
                        feedbackEl.textContent = `❌ إجابة خاطئة.`;
                        feedbackEl.className = 'mt-2 text-sm font-bold feedback-incorrect';
                    }
                    document.getElementById(`explain-btn-${index}`).classList.remove('hidden');
                });
                
                const finalGrade = Math.round((score / activeQuizQuestions.length) * 10);
                document.getElementById('quiz-score').textContent = `${finalGrade} / 10`;
                document.getElementById('quiz-results').classList.remove('hidden');
                submitQuizBtn.disabled = true;
                submitQuizBtn.classList.add('btn-disabled');

                if (currentStudent) {
                    // منطق الطالب المسجل
                    if (attemptsLeft - 1 <= 0) { 
                        retakeQuizBtn.disabled = true; 
                        retakeQuizBtn.textContent = 'لا توجد محاولات أخرى';
                        retakeQuizBtn.classList.add('btn-disabled');
                    }
                    saveGrade(lessonId, finalGrade);
                } else {
                    // منطق الزائر
                    const visitorAttempts = JSON.parse(sessionStorage.getItem('visitorAttempts')) || {};
                    visitorAttempts[lessonId] = true;
                    sessionStorage.setItem('visitorAttempts', JSON.stringify(visitorAttempts));
                    
                    const saveStatus = document.getElementById('save-status');
                    saveStatus.textContent = 'تم عرض نتيجتك. سجل الدخول لحفظ تقدمك.';
                    saveStatus.className = 'mt-4 text-sm font-semibold text-blue-600';
                    retakeQuizBtn.disabled = true;
                    retakeQuizBtn.textContent = 'لا توجد محاولات أخرى';
                    retakeQuizBtn.classList.add('btn-disabled');
                }
            };
        } else {
            submitQuizBtn.disabled = true;
            submitQuizBtn.classList.add('btn-disabled');
            submitQuizBtn.textContent = 'لا توجد محاولات متبقية';
            retakeQuizBtn.classList.add('hidden');
            if (!currentStudent) {
                document.getElementById('visitor-quiz-message').textContent = 'لقد استنفدت محاولتك الوحيدة كزائر لهذا الدرس.';
            }
        }
    }

    /**
     * يحفظ درجة الطالب في الواجهة الخلفية (فقط إذا كان الطالب مسجلاً).
     * @param {string} lessonId المعرّف الخاص بالدرس.
     * @param {number} grade الدرجة المحسوبة.
     */
    function saveGrade(lessonId, grade) {
        if (!currentStudent) return; // لا يحفظ الدرجة للزائر
        const saveStatus = document.getElementById('save-status');
        saveStatus.innerHTML = `<div class="flex items-center justify-center text-yellow-600"><div class="loader mr-2"></div> جارٍ حفظ نتيجتك...</div>`;
        const url = `${SCRIPT_URL}?action=saveGrade&studentId=${currentStudent.id}&lessonId=${lessonId}&grade=${grade}`;
        
        fetch(url).then(res => res.json()).then(result => {
            if (result.status === 'success') {
                saveStatus.textContent = '✔ تم حفظ نتيجتك بنجاح!';
                saveStatus.className = 'mt-4 text-sm font-semibold text-green-600';
                if (!currentStudent.lessons) currentStudent.lessons = {};
                if (!currentStudent.lessons[lessonId]) currentStudent.lessons[lessonId] = { grade: 0, attempts: 0};
                currentStudent.lessons[lessonId].grade = grade;
                currentStudent.lessons[lessonId].attempts++;
                updateGradesOnAccordion(currentStudent.lessons);
            } else { throw new Error(result.message); }
        }).catch(error => {
            saveStatus.textContent = '❌ حدث خطأ أثناء حفظ الدرجة.';
            saveStatus.className = 'mt-4 text-sm font-semibold text-red-600';
        });
    }

    /**
     * يعرض الشاشة الرئيسية، بما في ذلك لوحة التحكم للمستخدمين المسجلين.
     * @param {object | null} studentData بيانات الطالب المسجل.
     */
    function showMainScreen(studentData) {
        if (studentData) { // عرض للمستخدم المسجل
            dashboardSection.classList.remove('hidden');
            userWelcomeMessage.textContent = `أهلاً، ${studentData.name}`;
            ['name', 'id', 'class', 'phone'].forEach(key => document.getElementById(`display-${key}`).textContent = studentData[key] || '-');
            const totals = { level_test: 0, c1: 0, c2: 0, c3: 0, c4: 0 };
            if(studentData.lessons){
                Object.keys(studentData.lessons).forEach(lessonId => {
                    const chapterId = lessonId.substring(0, 2);
                    if(totals.hasOwnProperty(chapterId)){ totals[chapterId] += studentData.lessons[lessonId].grade; }
                });
            }
            ['level_test', 'c1', 'c2', 'c3', 'c4'].forEach(key => {
                const totalEl = document.getElementById(`total-${key}`);
                if(totalEl) totalEl.textContent = totals[key] || 0;
            });
            buildAccordion(studentData);
            userInfoHeader.classList.remove('hidden');
            teacherName.classList.add('hidden');
        } else { // عرض للزائر
            dashboardSection.classList.add('hidden');
            buildAccordion(null);
            userInfoHeader.classList.add('hidden');
            teacherName.classList.remove('hidden');
        }
        showView(mainContentView);
        headerTitle.textContent = 'رياضيات الصف الثالث المتوسط';
    }

    /**
     * يعالج عملية تسجيل دخول الطالب.
     * @param {string} studentId رقم الهوية الذي أدخله الطالب.
     */
    function handleLogin(studentId) {
        const loader = document.getElementById('login-loader');
        const errorDiv = document.getElementById('login-error');
        loader.classList.remove('hidden');
        loginSubmitBtn.disabled = true;
        errorDiv.classList.add('hidden');
        
        fetch(`${SCRIPT_URL}?action=getStudentData&studentId=${studentId}`).then(res => res.json()).then(result => {
            if (result.status === 'success' && result.data) {
                currentStudent = result.data;
                sessionStorage.setItem('studentId', result.data.id);
                showMainScreen(result.data);
            } else {
                sessionStorage.removeItem('studentId');
                errorDiv.textContent = 'رقم الهوية غير مسجل.';
                errorDiv.classList.remove('hidden');
            }
        }).catch(err => {
            errorDiv.textContent = 'خطأ في الاتصال بالخادم.';
            errorDiv.classList.remove('hidden');
        }).finally(() => {
            loader.classList.add('hidden');
            loginSubmitBtn.disabled = false;
        });
    }

    /**
     * يظهر نافذة الشرح لسؤال في الاختبار.
     * @param {number} index فهرس السؤال.
     */
    window.showExplanation = function(index) {
        const question = activeQuizQuestions[index];
        if (!question || !question.explanation) return;

        explanationText.innerHTML = ''; // Clear previous content

        // Check if the explanation is an interactive object or a simple string
        if (typeof question.explanation === 'object' && question.explanation.isInteractive) {
            const interactiveContainer = document.createElement('div');
            
            if (question.explanation.tableHTML) {
                const tableDiv = document.createElement('div');
                tableDiv.innerHTML = question.explanation.tableHTML;
                interactiveContainer.appendChild(tableDiv);
            }

            const explanationDiv = document.createElement('div');
            explanationDiv.className = 'text-right text-base mb-4 min-h-[100px]';
            const navContainer = document.createElement('div');
            navContainer.className = 'flex justify-between items-center';
            
            const backBtn = document.createElement('button');
            backBtn.className = 'nav-btn bg-gray-500 text-white font-medium py-2 px-4 rounded-lg hover:bg-gray-600 text-sm';
            backBtn.textContent = 'رجوع';

            const stepCounter = document.createElement('span');
            stepCounter.className = 'text-xs font-bold text-gray-600';

            const nextBtn = document.createElement('button');
            nextBtn.className = 'nav-btn bg-blue-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-blue-700 text-sm';
            nextBtn.textContent = 'التالي';

            navContainer.append(backBtn, stepCounter, nextBtn);
            interactiveContainer.append(explanationDiv, navContainer);
            explanationText.appendChild(interactiveContainer);
            
            let currentStep = 0;
            const { totalSteps, stepsContent, tableHTML } = question.explanation;

            const renderStep = (step) => {
                stepCounter.textContent = `الخطوة ${step} / ${totalSteps}`;
                explanationDiv.innerHTML = '';
                if (step > 0) {
                    for (let i = 0; i < step; i++) {
                        explanationDiv.innerHTML += `<div class="explanation-step">${stepsContent[i].text}</div>`;
                    }
                }
                
                if (tableHTML) {
                    const rowsToHighlight = stepsContent[step-1]?.highlightRows || [];
                    const allRows = interactiveContainer.querySelectorAll(`tr[data-expl-row]`);
                    allRows.forEach((row, idx) => {
                        row.classList.toggle('bg-blue-100', rowsToHighlight.includes(idx));
                    });
                }

                backBtn.disabled = (step === 0);
                nextBtn.disabled = (step === totalSteps);
            };

            nextBtn.addEventListener('click', () => {
                if (currentStep < totalSteps) {
                    currentStep++;
                    renderStep(currentStep);
                }
            });

            backBtn.addEventListener('click', () => {
                if (currentStep > 0) {
                    currentStep--;
                    renderStep(currentStep);
                }
            });

            renderStep(0); // Initial render

        } else {
            // Handle simple string explanation
            let fullExplanation = question.explanation;
            if (question.topic === 'concept') {
                const slopeSummarySVG = `
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <div class="p-2 bg-white rounded-lg border"><svg viewBox="0 0 20 20" class="w-full h-24"><line x1="1" y1="10" x2="19" y2="10" stroke="#9ca3af" stroke-width="0.5"/><line x1="10" y1="1" x2="10" y2="19" stroke="#9ca3af" stroke-width="0.5"/><line x1="1" y1="15" x2="9" y2="5" stroke="#2563eb" stroke-width="1.2"/></svg><p class="font-bold mt-1 text-sm">ميل موجب</p></div>
                        <div class="p-2 bg-white rounded-lg border"><svg viewBox="0 0 20 20" class="w-full h-24"><line x1="1" y1="10" x2="19" y2="10" stroke="#9ca3af" stroke-width="0.5"/><line x1="10" y1="1" x2="10" y2="19" stroke="#9ca3af" stroke-width="0.5"/><line x1="1" y1="5" x2="9" y2="15" stroke="#dc2626" stroke-width="1.2"/></svg><p class="font-bold mt-1 text-sm">ميل سالب</p></div>
                        <div class="p-2 bg-white rounded-lg border"><svg viewBox="0 0 20 20" class="w-full h-24"><line x1="1" y1="10" x2="19" y2="10" stroke="#9ca3af" stroke-width="0.5"/><line x1="10" y1="1" x2="10" y2="19" stroke="#9ca3af" stroke-width="0.5"/><line x1="2" y1="5" x2="18" y2="5" stroke="#16a34a" stroke-width="1.2"/></svg><p class="font-bold mt-1 text-sm">ميل صفر</p></div>
                        <div class="p-2 bg-white rounded-lg border"><svg viewBox="0 0 20 20" class="w-full h-24"><line x1="1" y1="10" x2="19" y2="10" stroke="#9ca3af" stroke-width="0.5"/><line x1="10" y1="1" x2="10" y2="19" stroke="#9ca3af" stroke-width="0.5"/><line x1="15" y1="2" x2="15" y2="18" stroke="#ca8a04" stroke-width="1.2"/></svg><p class="font-bold mt-1 text-sm">ميل غير معرف</p></div>
                    </div>
                `;
                fullExplanation = slopeSummarySVG + question.explanation;
            }
            explanationText.innerHTML = fullExplanation;
        }
        
        explanationModal.classList.remove('hidden');
    }

    /**
     * يجهز روابط المشاركة في التذييل.
     */
    function initializeShareButtons() {
        const shareText = encodeURIComponent('أدعوك للاستفادة من منصة الرياضيات للمعلم عبدالعزيز العبلان:');
        const pageUrl = encodeURIComponent("https://sites.google.com/view/mathablan/");

        const whatsappLink = document.getElementById('share-whatsapp');
        const twitterLink = document.getElementById('share-twitter');

        if (whatsappLink) {
            whatsappLink.href = `https://api.whatsapp.com/send?text=${shareText}%20${pageUrl}`;
        }

        if (twitterLink) {
            twitterLink.href = `https://twitter.com/intent/tweet?text=${shareText}&url=${pageUrl}`;
        }
    }
    
    /**
     * يشغل السكريبتات الخاصة بكل درس على حدة
     * @param {string} lessonId المعرف الخاص بالدرس
     */
    function initializeLessonScripts(lessonId) {
        // --- دالة عامة للتحكم في الأمثلة التفاعلية ---
        function createInteractiveSection(config) {
            let currentStep = 0;
            const renderStep = (step) => {
                if(config.stepCounter) config.stepCounter.textContent = step;
                
                let introHTML = config.introText ? `<div class="explanation-step" style="opacity:1; border: none; padding: 0; background: none;">${config.introText}</div>` : '';
                let stepsHTML = '';

                if (config.layout === 'grid') {
                    let gridItems = '';
                    for (let i = 0; i < step; i++) {
                        const item = config.stepsContent[i];
                        if (item && !item.fullWidth) {
                            gridItems += `<div class="explanation-step">${item.text}</div>`;
                            if (item.action) setTimeout(item.action, 0);
                        }
                    }
                    stepsHTML = `<div class="step-grid">${gridItems}</div>`;
                    
                    let fullWidthItemsHTML = '';
                    for (let i = 0; i < step; i++) {
                        const item = config.stepsContent[i];
                        if (item && item.fullWidth) {
                            fullWidthItemsHTML += `<div class="explanation-step">${item.text}</div>`;
                            if (item.action) setTimeout(item.action, 0);
                        }
                    }
                    stepsHTML += fullWidthItemsHTML;

                } else {
                    // Original linear layout logic
                    for (let i = 0; i < step; i++) {
                        const item = config.stepsContent[i];
                        if(item) {
                            stepsHTML += `<div class="explanation-step" style="border-right-width: 3px;">${item.text}</div>`;
                            if (item.action) setTimeout(item.action, 0);
                        }
                    }
                }

                if(config.explanationDiv) config.explanationDiv.innerHTML = introHTML + stepsHTML;
                
                if(config.backBtn) config.backBtn.disabled = (step === 0);
                if(config.nextBtn) config.nextBtn.textContent = (step === config.totalSteps) ? 'إعادة' : 'التالي';
            };
            
            if(config.nextBtn) {
                const newNextBtn = config.nextBtn.cloneNode(true);
                config.nextBtn.parentNode.replaceChild(newNextBtn, config.nextBtn);
                config.nextBtn = newNextBtn;
                config.nextBtn.addEventListener('click', () => {
                    currentStep = (currentStep < config.totalSteps) ? currentStep + 1 : 0;
                    renderStep(currentStep);
                });
            }
            
            if(config.backBtn) {
                const newBackBtn = config.backBtn.cloneNode(true);
                config.backBtn.parentNode.replaceChild(newBackBtn, config.backBtn);
                config.backBtn = newBackBtn;
                config.backBtn.addEventListener('click', () => {
                    if (currentStep > 0) {
                        currentStep--;
                        renderStep(currentStep);
                    }
                });
            }
            
            renderStep(0);
        }

        // =================================================================
        // == بداية منطقة السكريبتات الخاصة بالدروس
        // =================================================================
        switch(lessonId) {
            case 'c1_l1':
                (function() {
                     function setupHybridExample(exampleId, stepsContent) {
                        const container = document.getElementById(`interactive-example-${exampleId}`);
                        if (!container) return;

                        const stepsContainer = container.querySelector('.space-y-4');
                        const nextBtn = container.querySelector(`#next-btn-${exampleId}`);
                        const prevBtn = container.querySelector(`#prev-btn-${exampleId}`);
                        const counterEl = container.querySelector(`#step-counter-${exampleId}`);
                        
                        let mainIndex = 0;
                        let subIndex = 0;

                        const totalStates = stepsContent.reduce((acc, val) => acc + (Array.isArray(val) ? val.length : 1), 0);
                        let currentState = 0;

                        function showState() {
                            stepsContainer.innerHTML = '';

                            for (let i = 0; i <= mainIndex; i++) {
                                const stepData = stepsContent[i];
                                let contentToShow = '';

                                if (Array.isArray(stepData)) {
                                    // It's a group of sub-steps
                                    if (i < mainIndex) {
                                        // This is a completed group, show its last sub-step
                                        contentToShow = stepData[stepData.length - 1];
                                    } else {
                                        // This is the current group, show the current sub-step
                                        contentToShow = stepData[subIndex];
                                    }
                                } else {
                                    // It's a simple, cumulative step
                                    contentToShow = stepData;
                                }
                                
                                const stepDiv = document.createElement('div');
                                stepDiv.innerHTML = contentToShow;
                                // The actual element is the first child of the div
                                stepsContainer.appendChild(stepDiv.firstElementChild);
                            }

                            // Update counter and buttons
                            counterEl.textContent = `الخطوة ${currentState + 1} من ${totalStates}`;
                            prevBtn.disabled = currentState === 0;
                            prevBtn.classList.toggle('btn-disabled', currentState === 0);
                            nextBtn.disabled = currentState === totalStates - 1;
                            nextBtn.classList.toggle('btn-disabled', currentState === totalStates - 1);
                        }

                        nextBtn.addEventListener('click', () => {
                            if (currentState >= totalStates - 1) return;
                            currentState++;

                            const currentGroup = stepsContent[mainIndex];
                            if (Array.isArray(currentGroup) && subIndex < currentGroup.length - 1) {
                                subIndex++;
                            } else {
                                if (mainIndex < stepsContent.length - 1) {
                                   mainIndex++;
                                   subIndex = 0;
                                }
                            }
                            showState();
                        });

                        prevBtn.addEventListener('click', () => {
                            if (currentState <= 0) return;
                            currentState--;

                            const currentGroup = stepsContent[mainIndex];
                            if (Array.isArray(currentGroup) && subIndex > 0) {
                                subIndex--;
                            } else {
                                 if (mainIndex > 0) {
                                     mainIndex--;
                                     const newGroup = stepsContent[mainIndex];
                                     if (Array.isArray(newGroup)) {
                                         subIndex = newGroup.length - 1;
                                     } else {
                                         subIndex = 0;
                                     }
                                 }
                            }
                            showState();
                        });

                        showState();
                    }
                    
                    // Content for Example 1
                    const ex1_steps = [
                        // Main Step 0
                        `<div class="p-4 bg-white rounded-lg step-box interactive-step"><h4 class="font-bold">الخطوة 1: التعويض</h4><p>نعوض عن المتغير <span class="math-eq">ك</span> بكل <span class="vocab-term">عنصر</span> من <span class="vocab-term">مجموعة التعويض</span>.</p></div>`,
                        // Main Step 1 (Group of replacing sub-steps)
                        [
                            // Sub-step 0
                            `<div class="p-4 bg-white rounded-lg step-box interactive-step"><h4 class="font-bold">الخطوة 2: التحقق</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">قيمة <span class="math-eq">ك</span></th><th class="p-2">التعويض في <span class="math-eq">ك + ٥</span></th><th class="p-2">النتيجة</th><th class="p-2">هل المعادلة صحيحة؟</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b"><td><span class="math-eq">١</span></td><td></td><td></td><td></td></tr>
                                        <tr class="border-b"><td><span class="math-eq">٢</span></td><td></td><td></td><td></td></tr>
                                        <tr class="border-b"><td><span class="math-eq">٣</span></td><td></td><td></td><td></td></tr>
                                        <tr><td><span class="math-eq">٤</span></td><td></td><td></td><td></td></tr>
                                    </tbody></table>
                                </div></div>`,
                            // Sub-step 1
                            `<div class="p-4 bg-white rounded-lg step-box interactive-step"><h4 class="font-bold">الخطوة 2: التحقق (ك=1)</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">قيمة <span class="math-eq">ك</span></th><th class="p-2">التعويض في <span class="math-eq">ك + ٥</span></th><th class="p-2">النتيجة</th><th class="p-2">هل المعادلة صحيحة؟</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq"><span class="substitution-value">١</span> + ٥</span></td><td><span class="math-eq">٦</span></td><td><span class="text-red-600 font-bold">خطأ</span> <span class="math-eq">(لأن ٦ ≠ ٧)</span></td></tr>
                                        <tr class="border-b"><td><span class="math-eq">٢</span></td><td></td><td></td><td></td></tr>
                                        <tr class="border-b"><td><span class="math-eq">٣</span></td><td></td><td></td><td></td></tr>
                                        <tr><td><span class="math-eq">٤</span></td><td></td><td></td><td></td></tr>
                                    </tbody></table>
                                </div></div>`,
                            // Sub-step 2
                            `<div class="p-4 bg-white rounded-lg step-box interactive-step"><h4 class="font-bold">الخطوة 2: التحقق (ك=2)</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">قيمة <span class="math-eq">ك</span></th><th class="p-2">التعويض في <span class="math-eq">ك + ٥</span></th><th class="p-2">النتيجة</th><th class="p-2">هل المعادلة صحيحة؟</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq"><span class="substitution-value">١</span> + ٥</span></td><td><span class="math-eq">٦</span></td><td><span class="text-red-600 font-bold">خطأ</span> <span class="math-eq">(لأن ٦ ≠ ٧)</span></td></tr>
                                        <tr class="border-b bg-green-50"><td><span class="math-eq">٢</span></td><td><span class="math-eq"><span class="substitution-value">٢</span> + ٥</span></td><td><span class="math-eq">٧</span></td><td><span class="text-green-600 font-bold">صحيحة ✔</span> <span class="math-eq">(لأن ٧ = ٧)</span></td></tr>
                                        <tr class="border-b"><td><span class="math-eq">٣</span></td><td></td><td></td><td></td></tr>
                                        <tr><td><span class="math-eq">٤</span></td><td></td><td></td><td></td></tr>
                                    </tbody></table>
                                </div></div>`,
                            // Sub-step 3
                            `<div class="p-4 bg-white rounded-lg step-box interactive-step"><h4 class="font-bold">الخطوة 2: التحقق (ك=3)</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">قيمة <span class="math-eq">ك</span></th><th class="p-2">التعويض في <span class="math-eq">ك + ٥</span></th><th class="p-2">النتيجة</th><th class="p-2">هل المعادلة صحيحة؟</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq"><span class="substitution-value">١</span> + ٥</span></td><td><span class="math-eq">٦</span></td><td><span class="text-red-600 font-bold">خطأ</span> <span class="math-eq">(لأن ٦ ≠ ٧)</span></td></tr>
                                        <tr class="border-b bg-green-50"><td><span class="math-eq">٢</span></td><td><span class="math-eq"><span class="substitution-value">٢</span> + ٥</span></td><td><span class="math-eq">٧</span></td><td><span class="text-green-600 font-bold">صحيحة ✔</span> <span class="math-eq">(لأن ٧ = ٧)</span></td></tr>
                                        <tr class="border-b"><td><span class="math-eq">٣</span></td><td><span class="math-eq"><span class="substitution-value">٣</span> + ٥</span></td><td><span class="math-eq">٨</span></td><td><span class="text-red-600 font-bold">خطأ</span> <span class="math-eq">(لأن ٨ ≠ ٧)</span></td></tr>
                                        <tr><td><span class="math-eq">٤</span></td><td></td><td></td><td></td></tr>
                                    </tbody></table>
                                </div></div>`,
                            // Sub-step 4 (Final state of the table)
                            `<div class="p-4 bg-white rounded-lg step-box interactive-step"><h4 class="font-bold">الخطوة 2: التحقق (الجدول مكتمل)</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">قيمة <span class="math-eq">ك</span></th><th class="p-2">التعويض في <span class="math-eq">ك + ٥</span></th><th class="p-2">النتيجة</th><th class="p-2">هل المعادلة صحيحة؟</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq"><span class="substitution-value">١</span> + ٥</span></td><td><span class="math-eq">٦</span></td><td><span class="text-red-600 font-bold">خطأ</span> <span class="math-eq">(لأن ٦ ≠ ٧)</span></td></tr>
                                        <tr class="border-b bg-green-50"><td><span class="math-eq">٢</span></td><td><span class="math-eq"><span class="substitution-value">٢</span> + ٥</span></td><td><span class="math-eq">٧</span></td><td><span class="text-green-600 font-bold">صحيحة ✔</span> <span class="math-eq">(لأن ٧ = ٧)</span></td></tr>
                                        <tr class="border-b"><td><span class="math-eq">٣</span></td><td><span class="math-eq"><span class="substitution-value">٣</span> + ٥</span></td><td><span class="math-eq">٨</span></td><td><span class="text-red-600 font-bold">خطأ</span> <span class="math-eq">(لأن ٨ ≠ ٧)</span></td></tr>
                                        <tr><td><span class="math-eq">٤</span></td><td><span class="math-eq"><span class="substitution-value">٤</span> + ٥</span></td><td><span class="math-eq">٩</span></td><td><span class="text-red-600 font-bold">خطأ</span> <span class="math-eq">(لأن ٩ ≠ ٧)</span></td></tr>
                                    </tbody></table>
                                </div></div>`
                        ],
                        // Main Step 2
                        `<div class="p-4 bg-green-200 rounded-lg step-box border-green-600 interactive-step"><h4 class="font-bold">الخطوة 3: تحديد مجموعة الحل</h4><p>بعد التحقق من جميع القيم، وجدنا أن القيمة التي تجعل المعادلة صحيحة هي <span class="math-eq">٢</span>. إذن، <span class="vocab-term">مجموعة الحل</span> هي <span class="math-eq">{٢}</span>.</div>`
                    ];
                    setupHybridExample('1', ex1_steps);

                    // Content for Example 2
                    const ex2_steps = [
                        `<div class="p-4 bg-white rounded-lg step-box interactive-step"><h4 class="font-bold">الخطوة 1: إنشاء جدول</h4><p>ننظم الحل بإنشاء جدول ونعوض عن كل قيمة لـ <span class="math-eq">س</span> لإيجاد قيمة <span class="math-eq">ص</span> المقابلة.</p></div>`,
                        [
                            `<div class="p-4 bg-white rounded-lg step-box interactive-step"><h4 class="font-bold">الخطوة 2: التعويض والحساب</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2"><span class="math-eq">س</span></th><th class="p-2">التعويض في <span class="math-eq">٨ - ٢س</span></th><th class="p-2"><span class="math-eq">ص</span></th><th class="p-2">الحل (<span class="math-eq">س، ص</span>)</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b"><td><span class="math-eq">١</span></td><td></td><td></td><td></td></tr>
                                        <tr class="border-b"><td><span class="math-eq">٢</span></td><td></td><td></td><td></td></tr>
                                        <tr><td><span class="math-eq">٣</span></td><td></td><td></td><td></td></tr>
                                    </tbody></table>
                                </div></div>`,
                            `<div class="p-4 bg-white rounded-lg step-box interactive-step"><h4 class="font-bold">الخطوة 2: التعويض والحساب (س=1)</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2"><span class="math-eq">س</span></th><th class="p-2">التعويض في <span class="math-eq">٨ - ٢س</span></th><th class="p-2"><span class="math-eq">ص</span></th><th class="p-2">الحل (<span class="math-eq">س، ص</span>)</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq">٨ - ٢(<span class="substitution-value">١</span>)</span></td><td><span class="math-eq">٦</span></td><td><span class="math-eq">(١، ٦)</span></td></tr>
                                        <tr class="border-b"><td><span class="math-eq">٢</span></td><td></td><td></td><td></td></tr>
                                        <tr><td><span class="math-eq">٣</span></td><td></td><td></td><td></td></tr>
                                    </tbody></table>
                                </div></div>`,
                            `<div class="p-4 bg-white rounded-lg step-box interactive-step"><h4 class="font-bold">الخطوة 2: التعويض والحساب (س=2)</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2"><span class="math-eq">س</span></th><th class="p-2">التعويض في <span class="math-eq">٨ - ٢س</span></th><th class="p-2"><span class="math-eq">ص</span></th><th class="p-2">الحل (<span class="math-eq">س، ص</span>)</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq">٨ - ٢(<span class="substitution-value">١</span>)</span></td><td><span class="math-eq">٦</span></td><td><span class="math-eq">(١، ٦)</span></td></tr>
                                        <tr class="border-b"><td><span class="math-eq">٢</span></td><td><span class="math-eq">٨ - ٢(<span class="substitution-value">٢</span>)</span></td><td><span class="math-eq">٤</span></td><td><span class="math-eq">(٢، ٤)</span></td></tr>
                                        <tr><td><span class="math-eq">٣</span></td><td></td><td></td><td></td></tr>
                                    </tbody></table>
                                </div></div>`,
                            `<div class="p-4 bg-white rounded-lg step-box interactive-step"><h4 class="font-bold">الخطوة 2: التعويض والحساب (الجدول مكتمل)</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2"><span class="math-eq">س</span></th><th class="p-2">التعويض في <span class="math-eq">٨ - ٢س</span></th><th class="p-2"><span class="math-eq">ص</span></th><th class="p-2">الحل (<span class="math-eq">س، ص</span>)</th></tr></thead>
                                    <tbody>
                                        <tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq">٨ - ٢(<span class="substitution-value">١</span>)</span></td><td><span class="math-eq">٦</span></td><td><span class="math-eq">(١، ٦)</span></td></tr>
                                        <tr class="border-b"><td><span class="math-eq">٢</span></td><td><span class="math-eq">٨ - ٢(<span class="substitution-value">٢</span>)</span></td><td><span class="math-eq">٤</span></td><td><span class="math-eq">(٢، ٤)</span></td></tr>
                                        <tr><td><span class="math-eq">٣</span></td><td><span class="math-eq">٨ - ٢(<span class="substitution-value">٣</span>)</span></td><td><span class="math-eq">٢</span></td><td><span class="math-eq">(٣، ٢)</span></td></tr>
                                    </tbody></table>
                                </div></div>`
                        ],
                        `<div class="p-4 bg-green-200 rounded-lg step-box border-green-600 interactive-step"><h4 class="font-bold">الخطوة 3: تحديد مجموعة الحل</h4><p><span class="vocab-term">مجموعة الحل</span> هي مجموعة الأزواج المرتبة: <span class="math-eq">{(١، ٦)، (٢، ٤)، (٣، ٢)}</span>.</p></div>`
                    ];
                    setupHybridExample('2', ex2_steps);
                })();
                break;
            case 'c1_l3':
                (function() {
                     const exampleContainers = document.querySelectorAll('[id^="interactive-example-"]');
                     const state = {};

                     exampleContainers.forEach(container => {
                         const exampleId = container.id.split('-')[2];
                         state[exampleId] = {
                             currentIndex: 0,
                             steps: container.querySelectorAll('.step-interactive'),
                             prevBtn: container.querySelector('.prev-btn'),
                             nextBtn: container.querySelector('.next-btn')
                         };

                         const updateButtons = () => {
                             state[exampleId].prevBtn.disabled = state[exampleId].currentIndex === 0;
                             state[exampleId].nextBtn.disabled = state[exampleId].currentIndex === state[exampleId].steps.length - 1;
                         };

                         state[exampleId].nextBtn.addEventListener('click', () => {
                             if (state[exampleId].currentIndex < state[exampleId].steps.length - 1) {
                                 state[exampleId].currentIndex++;
                                 state[exampleId].steps[state[exampleId].currentIndex].classList.add('active');
                                 updateButtons();
                             }
                         });

                         state[exampleId].prevBtn.addEventListener('click', () => {
                             if (state[exampleId].currentIndex > 0) {
                                 state[exampleId].steps[state[exampleId].currentIndex].classList.remove('active');
                                 state[exampleId].currentIndex--;
                                 updateButtons();
                             }
                         });

                         // Initial setup for each example
                         updateButtons();
                     });
                })();
                break;
                 case 'c1_l4':
                (function() {
                    document.querySelectorAll('.interactive-example').forEach(example => {
                        const nextBtn = example.querySelector('.next-btn');
                        const prevBtn = example.querySelector('.prev-btn');
                        const steps = Array.from(example.querySelectorAll('.steps-container .step-box'));
                        const stepCounter = example.querySelector('.step-counter');
                        let currentStep = -1;

                        const updateState = () => {
                            steps.forEach((step, index) => {
                                if (index <= currentStep) {
                                    step.classList.remove('hidden');
                                } else {
                                    step.classList.add('hidden');
                                }
                            });
                            
                            if(stepCounter){
                                if (currentStep >= 0) {
                                   stepCounter.textContent = `الخطوة ${currentStep + 1} من ${steps.length}`;
                                } else {
                                   stepCounter.textContent = 'ابدأ الحل';
                                }
                            }

                            prevBtn.disabled = currentStep < 0;
                            nextBtn.disabled = currentStep >= steps.length - 1;
                        };

                        nextBtn.addEventListener('click', () => {
                            if (currentStep < steps.length - 1) {
                                currentStep++;
                                updateState();
                            }
                        });

                        prevBtn.addEventListener('click', () => {
                            if (currentStep >= 0) {
                                currentStep--;
                                updateState();
                            }
                        });
                        updateState(); // Initial setup
                    });
                })();
                break;
             case 'c3_l2':
                (function() {
                    const configs = {
                        "1a": { totalSteps: 3, introText: `نبدأ بصيغة الميل والمقطع: <br><span class='math-eq'>ص = م س + ب</span>.`, stepsContent: [ { text: `<strong>1. نعوض بالمعطيات:</strong><br>الميل <span class='math-eq'>م = ٤</span>، والنقطة (<span class="text-red-600">٢</span>، <span class="text-blue-600">٥</span>).<br><span class='math-eq'><span class="text-blue-600">٥</span> = ٤(<span class="text-red-600">٢</span>) + ب</span>` }, { text: "<strong>2. نحل المعادلة لإيجاد (ب):</strong><br><span class='math-eq'>٥ = ٨ + ب</span><br>بطرح ٨ من الطرفين، نجد أن:<br><span class='math-eq'>ب = -٣</span>" }, { text: `<strong>3. نكتب المعادلة النهائية:</strong><br>الآن بعد أن عرفنا أن <span class='math-eq'>م = ٤</span> و <span class='math-eq'>ب = -٣</span>، نكتب المعادلة النهائية:<br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>ص = ٤س - ٣</span></div>` } ] },
                        "1b": { totalSteps: 3, introText: `نبدأ بصيغة الميل والمقطع: <br><span class='math-eq'>ص = م س + ب</span>.`, stepsContent: [ { text: `<strong>1. نعوض بالمعطيات:</strong><br>الميل <span class='math-eq'>م = -٢</span>، والنقطة (<span class="text-red-600">-١</span>، <span class="text-blue-600">٦</span>).<br><span class='math-eq'><span class="text-blue-600">٦</span> = -٢(<span class="text-red-600">-١</span>) + ب</span>` }, { text: "<strong>2. نحل المعادلة لإيجاد (ب):</strong><br><span class='math-eq'>٦ = ٢ + ب</span><br>بطرح ٢ من الطرفين، نجد أن:<br><span class='math-eq'>ب = ٤</span>" }, { text: `<strong>3. نكتب المعادلة النهائية:</strong><br>وجدنا أن <span class='math-eq'>م = -٢</span> و <span class='math-eq'>ب = ٤</span>. إذن المعادلة هي:<br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>ص = -٢س + ٤</span></div>` } ] },
                        "2a": { totalSteps: 3, introText: `لدينا نقطتان، لذلك سنقوم بثلاث خطوات بسيطة للوصول للحل.`, stepsContent: [ { text: `<strong>الخطوة 1: نجد الميل (م)</strong><br>نستخدم النقطتين (<span class="text-red-600">١</span>، <span class="text-blue-600">٢</span>) و (<span class="text-red-600">٣</span>، <span class="text-blue-600">٨</span>).<br><span class='math-eq'>م = <span class="fraction"><span>فرق الصادات</span><span>فرق السينات</span></span> = <span class="fraction"><span><span class="text-blue-600">٨</span> - <span class="text-blue-600">٢</span></span><span><span class="text-red-600">٣</span> - <span class="text-red-600">١</span></span></span> = <span class="fraction"><span>٦</span><span>٢</span></span> = ٣</span>` }, { text: `<strong>الخطوة 2: نجد المقطع (ب)</strong><br>الآن نعرف أن <span class='math-eq'>م = ٣</span>. نستخدم النقطة (<span class="text-red-600">١</span>، <span class="text-blue-600">٢</span>) ونعوض في <span class='math-eq'>ص = م س + ب</span>.<br><span class='math-eq'><span class="text-blue-600">٢</span> = ٣(<span class="text-red-600">١</span>) + ب</span><br><span class='math-eq'>٢ = ٣ + ب</span>  &larr;  <span class='math-eq'>ب = -١</span>` }, { text: `<strong>الخطوة 3: نكتب المعادلة النهائية</strong><br>وجدنا أن <span class='math-eq'>م = ٣</span> و <span class='math-eq'>ب = -١</span>. إذن المعادلة هي:<br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>ص = ٣س - ١</span></div>` } ] },
                        "2b": { totalSteps: 3, introText: `لدينا نقطتان، لذلك سنقوم بثلاث خطوات بسيطة للوصول للحل.`, stepsContent: [ { text: `<strong>الخطوة 1: نجد الميل (م)</strong><br>نستخدم النقطتين (<span class="text-red-600">٢</span>، <span class="text-blue-600">٥</span>) و (<span class="text-red-600">٤</span>، <span class="text-blue-600">١</span>).<br><span class='math-eq'>م = <span class="fraction"><span>فرق الصادات</span><span>فرق السينات</span></span> = <span class="fraction"><span><span class="text-blue-600">١</span> - <span class="text-blue-600">٥</span></span><span><span class="text-red-600">٤</span> - <span class="text-red-600">٢</span></span></span> = <span class="fraction"><span>-٤</span><span>٢</span></span> = -٢</span>` }, { text: `<strong>الخطوة 2: نجد المقطع (ب)</strong><br>الآن نعرف أن <span class='math-eq'>م = -٢</span>. نستخدم النقطة (<span class="text-red-600">٢</span>، <span class="text-blue-600">٥</span>) ونعوض في <span class='math-eq'>ص = م س + ب</span>.<br><span class='math-eq'><span class="text-blue-600">٥</span> = -٢(<span class="text-red-600">٢</span>) + ب</span><br><span class='math-eq'>٥ = -٤ + ب</span>  &larr;  <span class='math-eq'>ب = ٩</span>` }, { text: `<strong>الخطوة 3: نكتب المعادلة النهائية</strong><br>وجدنا أن <span class='math-eq'>م = -٢</span> و <span class='math-eq'>ب = ٩</span>. إذن المعادلة هي:<br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>ص = -٢س + ٩</span></div>` } ] },
                        "3a": { totalSteps: 5, introText: `لإيجاد المعادلة والتنبؤ بالأجرة، علينا أولاً تحديد الميل (م) والمقطع الصادي (ب).`, stepsContent: [ { text: `<strong>الخطوة 1: نحدد نقطتين من المسألة</strong><br>الراتب الأساسي (عند س=٠ ساعات) هو ٣٥١ ريال &larr; النقطة (<span class="text-red-600">٠</span>، <span class="text-blue-600">٣٥١</span>).<br>بعد ٥ ساعات إضافية، الأجرة ٤١٦ ريال &larr; النقطة (<span class="text-red-600">٥</span>، <span class="text-blue-600">٤١٦</span>).` }, { text: `<strong>الخطوة 2: نجد الميل (م)</strong><br>الميل هو الأجرة لكل ساعة إضافية.<br><span class='math-eq'>م = <span class="fraction"><span>٤١٦ - ٣٥١</span><span>٥ - ٠</span></span> = <span class="fraction"><span>٦٥</span><span>٥</span></span> = ١٣</span>` }, { text: `<strong>الخطوة 3: نجد المقطع (ب)</strong><br>نعوض الميل <span class='math-eq'>م = ١٣</span> والنقطة الأسهل (<span class='math-eq'>(٠، ٣٥١)</span>) في المعادلة <span class='math-eq'>ص = م س + ب</span>.<br><span class='math-eq'><span class="text-blue-600">٣٥١</span> = ١٣(<span class="text-red-600">٠</span>) + ب</span><br><span class='math-eq'>٣٥١ = ٠ + ب</span> &larr; <span class='math-eq'>ب = ٣٥١</span>` }, { text: `<strong>الخطوة 4: نكتب المعادلة</strong><br>الميل (م) = ١٣ والمقطع (ب) = ٣٥١.<br>إذن المعادلة هي:<br><div class="text-center mt-2 p-2 bg-blue-100 rounded-md"><span class='math-eq'>ص = ١٣س + ٣٥١</span></div>` }, { text: `<strong>الخطوة 5: نتنبأ بالأجرة لـ ٨ ساعات</strong><br>نعوض س = ٨ في المعادلة.<br><span class='math-eq'>ص = ١٣(٨) + ٣٥١</span><br><span class='math-eq'>ص = ١٠٤ + ٣٥١ = ٤٥٥</span><br><div class="text-center mt-2 p-2 bg-green-100 rounded-md">إذن، ستكون أجرته ٤٥٥ ريالاً.</div>` } ] },
                        "3b": { totalSteps: 4, introText: `لحل هذه المسألة، علينا أولاً إيجاد معادلة الخط المستقيم التي تمثل تكلفة الاشتراك.`, stepsContent: [ { text: `<strong>الخطوة 1: نحدد النقطتين</strong><br>النقطة الأولى هي (عدد الأشهر، التكلفة) = (<span class="text-red-600">٢</span>، <span class="text-blue-600">٣٠٠</span>).<br>النقطة الثانية هي (<span class="text-red-600">٥</span>، <span class="text-blue-600">٦٠٠</span>).` }, { text: `<strong>الخطوة 2: نجد الميل (م)</strong><br>الميل يمثل التكلفة الشهرية.<br><span class='math-eq'>م = <span class="fraction"><span>٦٠٠ - ٣٠٠</span><span>٥ - ٢</span></span> = <span class="fraction"><span>٣٠٠</span><span>٣</span></span> = ١٠٠</span> ريال لكل شهر.` }, { text: `<strong>الخطوة 3: نجد المعادلة</strong><br>نستخدم الميل <span class='math-eq'>م = ١٠٠</span> والنقطة (<span class="text-red-600">٢</span>، <span class="text-blue-600">٣٠٠</span>) لإيجاد (ب) (رسوم التسجيل الأولية).<br><span class='math-eq'>٣٠٠ = ١٠٠(٢) + ب</span>  &larr;  <span class='math-eq'>٣٠٠ = ٢٠٠ + ب</span>  &larr;  <span class='math-eq'>ب = ١٠٠</span>.<br>إذن المعادلة هي: <span class='math-eq'>ص = ١٠٠س + ١٠٠</span>.` }, { text: `<strong>الخطوة 4: نتنبأ بالتكلفة بعد ٨ أشهر</strong><br>نعوض <span class='math-eq'>س = ٨</span> في المعادلة.<br><span class='math-eq'>ص = ١٠٠(٨) + ١٠٠</span><br><span class='math-eq'>ص = ٨٠٠ + ١٠٠ = ٩٠٠</span><br><div class="text-center mt-2 p-2 bg-green-100 rounded-md">إذن، سيكون علي قد دفع ٩٠٠ ريال بعد ٨ أشهر.</div>` } ] }
                    };
                    Object.keys(configs).forEach(key => {
                        createInteractiveSection({
                            nextBtn: document.getElementById(`interactive-next-${key}`),
                            backBtn: document.getElementById(`interactive-back-${key}`),
                            stepCounter: document.getElementById(`interactive-step-counter-${key}`),
                            explanationDiv: document.getElementById(`interactive-explanation-${key}`),
                            ...configs[key]
                        });
                    });
                })();
                break;
            case 'c1_l5':
                (function() {
                    const examplesData = {
                        'eval-ex1': {
                            title: 'مثال ١: احسب قيمة <span class="math-eq">| هـ - ١٣ |</span>',
                            steps: [
                                'اضغط "التالي" لعرض خطوات الحل.',
                                '<h4>الخطوة ١: عوض عن هـ بقيمتها</h4><p class="math-block">| <span class="highlight-change">٥</span> - ١٣ |</p>',
                                '<h4>الخطوة ٢: احسب ما بداخل القيمة المطلقة</h4><p class="math-block">| -٨ |</p>',
                                '<h4>الخطوة ٣: أوجد القيمة المطلقة</h4><p class="math-block text-xl font-bold text-green-600">= ٨</p>'
                            ]
                        },
                        'eval-ex2': {
                            title: 'مثال ٢: احسب قيمة <span class="math-eq">| ١٦ - د | + | ف |</span>',
                            steps: [
                                'اضغط "التالي" لعرض خطوات الحل.',
                                '<h4>الخطوة ١: عوض عن المتغيرات بقيمها</h4><p class="math-block">| ١٦ - (<span class="highlight-change">-٤</span>) | + | (<span class="highlight-change">-٣</span>) |</p>',
                                '<h4>الخطوة ٢: احسب ما بداخل كل قيمة مطلقة</h4><p class="math-block">| ٢٠ | + | -٣ |</p>',
                                '<h4>الخطوة ٣: أوجد القيمة المطلقة</h4><p class="math-block">٢٠ + ٣</p>',
                                '<h4>الخطوة ٤: اجمع القيم</h4><p class="math-block text-xl font-bold text-green-600">= ٢٣</p>'
                            ]
                        },
                        'eval-ex3': {
                            title: 'مثال ٣: احسب قيمة <span class="math-eq">| ف + د | - هـ</span>',
                            steps: [
                                'اضغط "التالي" لعرض خطوات الحل.',
                                '<h4>الخطوة ١: عوض بالقيم</h4><p class="math-block">| (<span class="highlight-change">-٣</span>) + (<span class="highlight-change">-٤</span>) | - <span class="highlight-change">٥</span></p>',
                                '<h4>الخطوة ٢: احسب ما بداخل القيمة المطلقة</h4><p class="math-block">| -٧ | - ٥</p>',
                                '<h4>الخطوة ٣: اطرح القيم</h4><p class="math-block text-xl font-bold text-green-600">= ٧ - ٥ = ٢</p>'
                            ]
                        },
                        'eval-ex4': {
                            title: 'مثال ٤: احسب قيمة <span class="math-eq">٣ - | هـ |</span>',
                            steps: [
                                'اضغط "التالي" لعرض خطوات الحل.',
                                '<h4>الخطوة ١: عوض عن هـ بقيمتها</h4><p class="math-block">٣ - | <span class="highlight-change">٥</span> |</p>',
                                '<h4>الخطوة ٢: احسب القيمة المطلقة أولاً</h4><p class="math-block">٣ - <span class="highlight-change">٥</span></p>',
                                '<h4>الخطوة ٣: أوجد الناتج النهائي</h4><p class="math-block text-xl font-bold text-green-600">= -٢</p>'
                            ]
                        },
                        'solve-ex1': {
                            title: 'مثال ٥: حل المعادلة<span class="math-block">| س + ٣ | = ٨</span>',
                            steps: [
                                'لحل معادلة القيمة المطلقة، نفصلها إلى معادلتين. اضغط "التالي".',
                                '<h4>الخطوة ١: كتابة الحالتين</h4><p>بما أن القيمة المطلقة تساوي ٨، فما بداخلها إما أن يساوي ٨ أو -٨. هذا يعطينا معادلتين:</p><div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center mt-2"><div class="p-3 bg-blue-100 rounded-lg border border-blue-200"><h5><b>الحالة الأولى (الموجبة)</b></h5><hr class="my-2"><p class="math-block">س + ٣ = ٨</p></div><div class="p-3 bg-red-100 rounded-lg border border-red-200"><h5><b>الحالة الثانية (السالبة)</b></h5><hr class="my-2"><p class="math-block">س + ٣ = -٨</p></div></div>',
                                '<h4>الخطوة ٢: حل الحالتين</h4><p>الآن نحل كل حالة على حدة.</p><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2"><div class="p-3 bg-blue-100 rounded-lg border border-blue-200 text-center"><div class="space-y-1"><p>نطرح ٣ من الطرفين</p><p class="math-block">س = ٨ <span class="highlight-change">- ٣</span></p><p class="math-block font-bold text-green-600">س = ٥</p></div></div><div class="p-3 bg-red-100 rounded-lg border border-red-200 text-center"><div class="space-y-1"><p>نطرح ٣ من الطرفين</p><p class="math-block">س = -٨ <span class="highlight-change">- ٣</span></p><p class="math-block font-bold text-green-600">س = -١١</p></div></div></div>',
                                '<h4>الخطوة ٣: مجموعة الحل</h4><p>الحل يتكون من قيمتين. إذن، مجموعة الحل هي:</p><p class="math-block text-2xl">{٥، -١١}</p>'
                            ]
                        },
                        'solve-ex2': {
                            title: 'مثال ٦: حل المعادلة<span class="math-block">٢|س - ٣| + ٥ = ١٣</span>',
                            steps: [
                                'في هذه المعادلة، يجب أولاً عزل القيمة المطلقة في طرف لوحدها. اضغط "التالي" للبدء.',
                                '<h4>الخطوة ١: اطرح ٥ من الطرفين</h4><p>للبدء في عزل القيمة المطلقة، نتخلص أولاً من العدد ٥.</p><p class="math-block">٢|س - ٣| + ٥ <span class="highlight-change">- ٥</span> = ١٣ <span class="highlight-change">- ٥</span></p><p class="math-block">٢|س - ٣| = ٨</p>',
                                '<h4>الخطوة ٢: اقسم الطرفين على ٢</h4><p>الآن نتخلص من العدد ٢ المضروب في القيمة المطلقة.</p><p class="math-block"><span class="fraction"><span>٢|س - ٣|</span><span class="frac-bar"></span><span class="highlight-change">٢</span></span> = <span class="fraction"><span>٨</span><span class="frac-bar"></span><span class="highlight-change">٢</span></span></p><p class="math-block">|س - ٣| = ٤</p>',
                                '<h4>الخطوة ٣: كتابة الحالتين</h4><p>الآن بعد أن أصبحت القيمة المطلقة معزولة، نكتب المعادلتين الممكنتين:</p><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2"><div class="p-3 bg-blue-100 rounded-lg border border-blue-200 text-center"><h5><b>الحالة الأولى (الموجبة)</b></h5><hr class="my-2"><p class="math-block">س - ٣ = ٤</p></div><div class="p-3 bg-red-100 rounded-lg border border-red-200 text-center"><h5><b>الحالة الثانية (السالبة)</b></h5><hr class="my-2"><p class="math-block">س - ٣ = -٤</p></div></div>',
                                '<h4>الخطوة ٤: حل الحالتين</h4><p>الآن نحل كل حالة على حدة.</p><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2"><div class="p-3 bg-blue-100 rounded-lg border border-blue-200 text-center"><div class="space-y-1"><p>نضيف ٣ إلى الطرفين</p><p class="math-block">س = ٤ <span class="highlight-change">+ ٣</span></p><p class="math-block font-bold text-green-600">س = ٧</p></div></div><div class="p-3 bg-red-100 rounded-lg border border-red-200 text-center"><div class="space-y-1"><p>نضيف ٣ إلى الطرفين</p><p class="math-block">س = -٤ <span class="highlight-change">+ ٣</span></p><p class="math-block font-bold text-green-600">س = -١</p></div></div></div>',
                                '<h4>الخطوة ٥: مجموعة الحل</h4><p>الحل يتكون من قيمتين. إذن، مجموعة الحل هي:</p><p class="math-block text-2xl">{٧، -١}</p>'
                            ]
                        },
                        'write-ex1': {
                            title: 'مثال ٧: كتابة معادلة للتمثيل البياني',
                            steps: [
                                `<p class="mb-4 text-center">الفكرة هي وصف النقطتين (١١ و ١٩) باستخدام نقطة تقع في منتصفهما تماماً. اضغط 'التالي' للبدء.</p><svg viewBox="0 0 320 80" class="mx-auto my-2 w-full max-w-sm h-auto"><defs><marker id="arrowhead-interactive" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#4a5568"/></marker></defs><line x1="15" y1="40" x2="305" y2="40" stroke="#4a5568" stroke-width="2" marker-start="url(#arrowhead-interactive)" marker-end="url(#arrowhead-interactive)" /><g font-size="12" font-family="sans-serif" fill="#4a5568" text-anchor="middle"><text x="40" y="65">١١</text><line x1="40" y1="35" x2="40" y2="45" stroke="#4a5568" stroke-width="1.5" /><text x="280" y="65">١٩</text><line x1="280" y1="35" x2="280" y2="45" stroke="#4a5568" stroke-width="1.5" /></g><circle cx="40" cy="40" r="4" fill="#3b82f6" /><circle cx="280" cy="40" r="4" fill="#3b82f6" /></svg>`,
                                '<h4>الخطوة ١: إيجاد نقطة المنتصف (المركز)</h4><p class="text-center">أولاً، نجد العدد الذي يقع في المنتصف تماماً بين ١١ و ١٩ عن طريق حساب متوسطهما:</p><p class="math-block text-lg"><span class="fraction"><span>١١ + ١٩</span><span class="frac-bar"></span><span>٢</span></span> = ١٥</p><svg viewBox="0 0 320 80" class="mx-auto my-2 w-full max-w-sm h-auto"><line x1="15" y1="40" x2="305" y2="40" stroke="#4a5568" stroke-width="2" marker-start="url(#arrowhead-interactive)" marker-end="url(#arrowhead-interactive)" /><g font-size="12" font-family="sans-serif" fill="#4a5568" text-anchor="middle"><text x="40" y="65">١١</text><line x1="40" y1="35" x2="40" y2="45" stroke="#4a5568" stroke-width="1.5" /><text x="160" y="20" fill="#16a34a">المنتصف = ١٥</text><line x1="160" y1="35" x2="160" y2="45" stroke="#16a34a" stroke-width="1.5" /><text x="280" y="65">١٩</text><line x1="280" y1="35" x2="280" y2="45" stroke="#4a5568" stroke-width="1.5" /></g><circle cx="40" cy="40" r="4" fill="#3b82f6" /><circle cx="280" cy="40" r="4" fill="#3b82f6" /><circle cx="160" cy="40" r="4" fill="#16a34a" /></svg>',
                                '<h4>الخطوة ٢: إيجاد المسافة</h4><p class="text-center">الآن، نحسب كم تبعد كل نقطة عن المنتصف. المسافة من ١٥ إلى ١٩ هي ٤ خطوات.</p><p class="math-block">١٩ - ١٥ = ٤</p><svg viewBox="0 0 320 80" class="mx-auto my-2 w-full max-w-sm h-auto"><line x1="15" y1="40" x2="305" y2="40" stroke="#4a5568" stroke-width="2" marker-start="url(#arrowhead-interactive)" marker-end="url(#arrowhead-interactive)" /><g font-size="12" font-family="sans-serif" fill="#4a5568" text-anchor="middle"><text x="40" y="65">١١</text><text x="280" y="65">١٩</text></g><path d="M 160 30 Q 220 20 280 30" stroke="#ef4444" stroke-width="2" fill="none" stroke-dasharray="4 4" /><text x="220" y="18" fill="#ef4444" font-size="10" text-anchor="middle">المسافة = ٤</text><path d="M 160 50 Q 100 60 40 50" stroke="#ef4444" stroke-width="2" fill="none" stroke-dasharray="4 4" /><text x="100" y="68" fill="#ef4444" font-size="10" text-anchor="middle">المسافة = ٤</text><circle cx="40" cy="40" r="4" fill="#3b82f6" /><circle cx="280" cy="40" r="4" fill="#3b82f6" /><circle cx="160" cy="40" r="4" fill="#16a34a" /></svg>',
                                '<h4>الخطوة ٣: كتابة المعادلة</h4><p class="text-center">الصيغة العامة هي: <span class="math-eq">|س - المنتصف| = المسافة</span>. الآن نعوض بالقيم التي أوجدناها للحصول على المعادلة النهائية:</p><p class="math-block text-2xl text-center mt-4">| س - ١٥ | = ٤</p>'
                            ]
                        }
                    };

                    function setupInteractiveExample(containerId) {
                        const container = document.getElementById(containerId);
                        const data = examplesData[containerId];
                        if (!container || !data) return;

                        let currentStep = 0;
                        const totalSteps = data.steps.length - 1;

                        const title = document.createElement('h4');
                        title.className = 'text-lg font-bold text-gray-800 mb-4 text-center';
                        title.innerHTML = data.title;

                        const display = document.createElement('div');
                        display.className = 'interactive-display';

                        const controls = document.createElement('div');
                        controls.className = 'interactive-controls flex justify-between items-center mt-4';

                        const backBtn = document.createElement('button');
                        backBtn.textContent = 'رجوع';
                        backBtn.className = 'btn-back';

                        const stepCounter = document.createElement('span');
                        stepCounter.className = 'step-counter';

                        const nextBtn = document.createElement('button');
                        nextBtn.textContent = 'التالي';
                        nextBtn.className = 'btn-next';

                        controls.appendChild(backBtn);
                        controls.appendChild(stepCounter);
                        controls.appendChild(nextBtn);

                        container.innerHTML = '';
                        container.appendChild(title);
                        container.appendChild(display);
                        container.appendChild(controls);

                        function updateStep() {
                            display.style.opacity = 0;
                            setTimeout(() => {
                                let cumulativeHTML = '';
                                if (currentStep === 0) {
                                    cumulativeHTML = `<div class="text-center text-gray-600 p-4">${data.steps[0]}</div>`;
                                } else {
                                    for (let i = 1; i <= currentStep; i++) {
                                        cumulativeHTML += `<div class="step-wrapper">${data.steps[i]}</div>`;
                                    }
                                }
                                display.innerHTML = cumulativeHTML;
                                
                                stepCounter.textContent = `الخطوة ${currentStep}/${totalSteps}`;
                                backBtn.disabled = currentStep === 0;
                                nextBtn.disabled = currentStep === totalSteps;
                                display.style.opacity = 1;
                            }, 150);
                        }

                        nextBtn.addEventListener('click', () => {
                            if (currentStep < totalSteps) {
                                currentStep++;
                                updateStep();
                            }
                        });

                        backBtn.addEventListener('click', () => {
                            if (currentStep > 0) {
                                currentStep--;
                                updateStep();
                            }
                        });

                        updateStep(); // Initialize view
                    }

                    Object.keys(examplesData).forEach(id => {
                        setupInteractiveExample(id);
                    });
                })();
                break;
            case 'c3_l3':
                (function() {
                    const configs = {
                        "1a": { totalSteps: 2, introText: `نبدأ بصيغة الميل ونقطة: <br><span class='math-eq'>ص - ص₁ = م (س - س₁)</span>.`, stepsContent: [ { text: `<strong>1. نعوض بالمعطيات:</strong><br>الميل <span class='math-eq'>م = ٧</span>، والنقطة (<span class="text-red-600">-٣</span>، <span class="text-blue-600">٥</span>).<br><span class='math-eq'>ص - <span class="text-blue-600">٥</span> = ٧(س - (<span class="text-red-600">-٣</span>))</span>` }, { text: `<strong>2. نبسط المعادلة:</strong><br>عند طرح عدد سالب، فإننا نجمع.<br><div class='text-center mt-2 p-2 bg-green-100 rounded-md'><span class='math-eq'>ص - ٥ = ٧(س + ٣)</span></div>` } ] },
                        "1b": { totalSteps: 2, introText: `نبدأ بصيغة الميل ونقطة: <br><span class='math-eq'>ص - ص₁ = م (س - س₁)</span>.`, stepsContent: [ { text: `<strong>1. نعوض بالمعطيات:</strong><br>الميل <span class='math-eq'>م = -<span class="fraction"><span>١</span><span>٣</span></span></span>، والنقطة (<span class="text-red-600">٠</span>، <span class="text-blue-600">-٢</span>).<br><span class='math-eq'>ص - (<span class="text-blue-600">-٢</span>) = -<span class="fraction"><span>١</span><span>٣</span></span>(س - <span class="text-red-600">٠</span>)</span>` }, { text: `<strong>2. نبسط المعادلة:</strong><br><div class='text-center mt-2 p-2 bg-green-100 rounded-md'><span class='math-eq'>ص + ٢ = -<span class="fraction"><span>١</span><span>٣</span></span>س</span></div>` } ] },
                        "2a": { totalSteps: 3, introText: `المعادلة الأصلية: <span class='math-eq'>ص - ١٠ = ٢(س - ٨)</span><br>الهدف هو الوصول للصورة القياسية: <span class='math-eq'>أ س + ب ص = ج</span>.`, stepsContent: [ { text: `<strong>الخطوة 1: فك الأقواس (خاصية التوزيع)</strong><br><span class='math-eq'>ص - ١٠ = ٢س - ١٦</span>` }, { text: `<strong>الخطوة 2: نجمع <span style='color: #4f46e5;'>المتغيرات</span> و <span style='color: #db2777;'>الثوابت</span></strong><br>ننقل المتغيرات إلى طرف والثوابت إلى الطرف الآخر.<br><span class='math-eq'><span style='color: #4f46e5;'>-٢س + ص</span> = <span style='color: #db2777;'>-١٦ + ١٠</span></span><br><span class='math-eq'>-٢س + ص = -٦</span>` }, { text: `<strong>الخطوة 3: نجعل معامل 'س' موجبًا</strong><br>نضرب المعادلة كلها في -١.<br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>٢س - ص = ٦</span></div>` } ] },
                        "2b": { totalSteps: 2, introText: `المعادلة الأصلية: <span class='math-eq'>ص - ٦ = -٣(س + ٢)</span><br>الهدف هو الوصول للصورة القياسية: <span class='math-eq'>أ س + ب ص = ج</span>.`, stepsContent: [ { text: `<strong>الخطوة 1: فك الأقواس (خاصية التوزيع)</strong><br><span class='math-eq'>ص - ٦ = -٣س - ٦</span>` }, { text: `<strong>الخطوة 2: نجمع <span style='color: #4f46e5;'>المتغيرات</span> و <span style='color: #db2777;'>الثوابت</span></strong><br>ننقل المتغيرات إلى طرف والثوابت إلى الطرف الآخر.<br><span class='math-eq'><span style='color: #4f46e5;'>٣س + ص</span> = <span style='color: #db2777;'>-٦ + ٦</span></span><br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>٣س + ص = ٠</span></div>` } ] },
                        "3a": { totalSteps: 3, introText: `المعادلة الأصلية: <span class='math-eq'>ص - ٦ = -٢(س - ٧)</span><br>الهدف هو الوصول لصيغة الميل والمقطع: <span class='math-eq'>ص = م س + ب</span>.`, stepsContent: [ { text: `<strong>الخطوة 1: فك الأقواس (خاصية التوزيع)</strong><br><span class='math-eq'>ص - ٦ = -٢س + ١٤</span>` }, { text: `<strong>الخطوة 2: نعزل المتغير 'ص'</strong><br>ننقل -٦ إلى الطرف الآخر.<br><span class='math-eq'>ص = -٢س + ١٤ + ٦</span>` }, { text: `<strong>الخطوة 3: نبسط المعادلة</strong><br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>ص = -٢س + ٢٠</span></div>` } ] },
                        "3b": { totalSteps: 4, introText: `المعادلة الأصلية: <span class='math-eq'>٣ص + ٥ = ٢(س + ٧)</span><br>الهدف هو الوصول لصيغة الميل والمقطع: <span class='math-eq'>ص = م س + ب</span>.`, stepsContent: [ { text: `<strong>الخطوة 1: فك الأقواس (خاصية التوزيع)</strong><br><span class='math-eq'>٣ص + ٥ = ٢س + ١٤</span>` }, { text: `<strong>الخطوة 2: نعزل الحد '٣ص'</strong><br>ننقل +٥ إلى الطرف الآخر.<br><span class='math-eq'>٣ص = ٢س + ١٤ - ٥</span><br><span class='math-eq'>٣ص = ٢س + ٩</span>` }, { text: `<strong>الخطوة 3: نعزل المتغير 'ص'</strong><br>نقسم طرفي المعادلة على ٣.<br><span class='math-eq'>ص = <span class="fraction"><span>٢س + ٩</span><span>٣</span></span></span>`}, { text: `<strong>الخطوة 4: نبسط المعادلة</strong><br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>ص = <span class="fraction"><span>٢</span><span>٣</span></span>س + ٣</span></div>` } ] }
                    };
                    
                    Object.keys(configs).forEach(key => {
                        createInteractiveSection({
                            nextBtn: document.getElementById(`interactive-next-${key}`),
                            backBtn: document.getElementById(`interactive-back-${key}`),
                            stepCounter: document.getElementById(`interactive-step-counter-${key}`),
                            explanationDiv: document.getElementById(`interactive-explanation-${key}`),
                            ...configs[key]
                        });
                    });
                })();
                break;
            case 'c3_l4':
                (function() {
                    const formulaReminder = `<div class="text-sm">لحل هذا التمرين، تذكر الصيغ التالية:</div><ul class='list-disc pr-5 mt-1 space-y-1 text-sm'><li><strong>صيغة الميل والمقطع:</strong> <span class='math-eq'>ص = م س + ب</span></li><li><strong>صيغة الميل ونقطة:</strong> <span class='math-eq'>ص - ص₁ = م (س - س₁)</span></li></ul>`;
                    const configs = {
                        "1a": { totalSteps: 4, introText: formulaReminder, stepsContent: [ { text: `<strong>1. نحدد ميل المستقيم المعطى:</strong><br>المعادلة <span class='math-eq'>ص = ٣س + ٢</span> على صيغة الميل والمقطع. إذن، الميل <span class='math-eq'>م = ٣</span>.` }, { text: `<strong>2. نستخدم ميل المستقيم الموازي:</strong><br>المستقيمات المتوازية لها الميل نفسه. إذن، ميل المستقيم المطلوب هو <span class='math-eq'>م = ٣</span>.` }, { text: `<strong>3. نعوض في صيغة الميل ونقطة:</strong><br>النقطة (<span class="text-red-600 font-bold">-١</span>، <span class="text-blue-600 font-bold">-٥</span>) والميل <span class="text-green-600 font-bold">٣</span>.<br><span class='math-eq'>ص - (<span class="text-blue-600 font-bold">-٥</span>) = <span class="text-green-600 font-bold">٣</span>(س - (<span class="text-red-600 font-bold">-١</span>))</span>` }, { text: `<strong>4. نبسط المعادلة:</strong><br><div class='text-center mt-2 p-2 bg-green-100 rounded-md'><span class='math-eq'>ص + ٥ = ٣(س + ١)</span></div>` } ] },
                        "1b": { totalSteps: 5, introText: formulaReminder, stepsContent: [ { text: `<strong>1. نوجد ميل المستقيم المعطى:</strong><br>لكتابة المعادلة بصيغة الميل والمقطع، ننقل ٢س للطرف الآخر.<br><span class='math-eq'>ص = -٢س + ١</span>` }, { text: `<strong>2. نحدد الميل:</strong><br>من الصيغة الجديدة، الميل هو <span class='math-eq'>م = -٢</span>.` }, { text: `<strong>3. ميل المستقيم الموازي:</strong><br>ميل المستقيم المطلوب هو نفسه، أي <span class='math-eq'>م = -٢</span>.` }, { text: `<strong>4. نعوض في صيغة الميل ونقطة:</strong><br>النقطة (<span class="text-red-600 font-bold">٤</span>، <span class="text-blue-600 font-bold">٠</span>) والميل <span class="text-green-600 font-bold">-٢</span>.<br><span class='math-eq'>ص - <span class="text-blue-600 font-bold">٠</span> = <span class="text-green-600 font-bold">-٢</span>(س - <span class="text-red-600 font-bold">٤</span>)</span>` }, { text: `<strong>5. نبسط المعادلة:</strong><br><div class='text-center mt-2 p-2 bg-green-100 rounded-md'><span class='math-eq'>ص = -٢(س - ٤)</span></div>` } ] },
                        "2a": { totalSteps: 4, introText: formulaReminder, stepsContent: [ { text: `<strong>1. نحدد ميل المستقيم المعطى:</strong><br>ميل المستقيم المعطى هو <span class='math-eq'>م₁ = -٢</span>.` }, { text: `<strong>2. نوجد ميل المستقيم المتعامد:</strong><br>ميل المستقيم المتعامد هو معكوس مقلوب الميل الأول.<br><span class='math-eq'>م₂ = <span class="fraction"><span>١</span><span>٢</span></span></span>` }, { text: `<strong>3. نعوض في صيغة الميل ونقطة:</strong><br>النقطة (<span class="text-red-600 font-bold">٦</span>، <span class="text-blue-600 font-bold">-١</span>) والميل <span class="text-green-600 font-bold"><span class="fraction"><span>١</span><span>٢</span></span></span>.<br><span class='math-eq'>ص - (<span class="text-blue-600 font-bold">-١</span>) = <span class="text-green-600 font-bold"><span class="fraction"><span>١</span><span>٢</span></span></span>(س - <span class="text-red-600 font-bold">٦</span>)</span>` }, { text: `<strong>4. نبسط المعادلة:</strong><br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>ص + ١ = <span class="fraction"><span>١</span><span>٢</span></span>(س - ٦)</span></div>` } ] },
                        "2b": { totalSteps: 5, introText: formulaReminder, stepsContent: [ { text: `<strong>1. نوجد ميل المستقيم المعطى:</strong><br>نحول المعادلة إلى صيغة الميل والمقطع.<br>ننقل ٢س: <span class='math-eq'>-٥ص = -٢س + ١٠</span><br>نقسم على -٥: <span class='math-eq'>ص = <span class="fraction"><span>٢</span><span>٥</span></span>س - ٢</span>` }, { text: `<strong>2. نحدد الميل:</strong><br>ميل المستقيم المعطى هو <span class='math-eq'>م₁ = <span class="fraction"><span>٢</span><span>٥</span></span></span>.` }, { text: `<strong>3. نوجد ميل المستقيم المتعامد:</strong><br>الميل هو معكوس مقلوب الميل الأول.<br><span class='math-eq'>م₂ = -<span class="fraction"><span>٥</span><span>٢</span></span></span>` }, { text: `<strong>4. نعوض في صيغة الميل ونقطة:</strong><br>النقطة (<span class="text-red-600 font-bold">-٤</span>، <span class="text-blue-600 font-bold">٣</span>) والميل <span class="text-green-600 font-bold">-<span class="fraction"><span>٥</span><span>٢</span></span></span>.<br><span class='math-eq'>ص - <span class="text-blue-600 font-bold">٣</span> = <span class="text-green-600 font-bold">-<span class="fraction"><span>٥</span><span>٢</span></span></span>(س - (<span class="text-red-600 font-bold">-٤</span>))</span>` }, { text: `<strong>5. نبسط المعادلة:</strong><br><div class="text-center mt-2 p-2 bg-green-100 rounded-md"><span class='math-eq'>ص - ٣ = -<span class="fraction"><span>٥</span><span>٢</span></span>(س + ٤)</span></div>` } ] }
                    };
                    Object.keys(configs).forEach(key => {
                        createInteractiveSection({
                            nextBtn: document.getElementById(`interactive-next-${key}`),
                            backBtn: document.getElementById(`interactive-back-${key}`),
                            stepCounter: document.getElementById(`interactive-step-counter-${key}`),
                            explanationDiv: document.getElementById(`interactive-explanation-${key}`),
                            ...configs[key]
                        });
                    });
                })();
                break;
            case 'c4_l1':
                (function() {
                    function generateNumberLine(containerId, value, type) {
                        const container = document.getElementById(containerId);
                        if (!container) return;

                        const start = value - 5;
                        const end = value + 5;
                        const range = end - start;
                        const svgWidth = container.clientWidth > 0 ? container.clientWidth : 250;
                        const svgHeight = 100;

                        const valueToX = (val) => ((val - start) / range) * (svgWidth - 60) + 30;

                        const isClosed = type === 'gte' || type === 'lte';
                        const isLeft = type === 'lt' || type === 'lte';

                        let ticksHtml = '';
                        for (let i = start; i <= end; i++) {
                            const x = valueToX(i);
                            ticksHtml += `<line x1="${x}" y1="35" x2="${x}" y2="45" stroke="gray" stroke-width="1"></line>`;
                            ticksHtml += `<text x="${x}" y="65" text-anchor="middle" font-size="12" fill="black">${i}</text>`;
                        }

                        const valueX = valueToX(value);
                        const circleHtml = `<circle cx="${valueX}" cy="40" r="5" stroke="#3b82f6" stroke-width="2" fill="${isClosed ? '#3b82f6' : 'white'}"></circle>`;
                        
                        let rayHtml = '';
                        if (isLeft) {
                            rayHtml = `<line x1="${valueX}" y1="40" x2="0" y2="40" stroke="#3b82f6" stroke-width="3"></line>`;
                            rayHtml += `<polygon points="10,35 0,40 10,45" fill="#3b82f6"></polygon>`;
                        } else {
                            rayHtml = `<line x1="${valueX}" y1="40" x2="${svgWidth}" y2="40" stroke="#3b82f6" stroke-width="3"></line>`;
                            rayHtml += `<polygon points="${svgWidth-10},35 ${svgWidth},40 ${svgWidth-10},45" fill="#3b82f6"></polygon>`;
                        }

                        const svg = `<svg width="100%" height="${svgHeight}" class="number-line-svg">${ticksHtml}<line x1="0" y1="40" x2="${svgWidth}" y2="40" stroke="gray" stroke-width="2"></line>${rayHtml}${circleHtml}</svg>`;
                        container.innerHTML = svg;
                    }

                    const configs = {
                        "1a": { totalSteps: 4, introText: `<div class="text-sm">لحل المتباينة، نريد عزل المتغير <strong>س</strong> في طرف بمفرده.</div>`, stepsContent: [ { text: `<strong>1. أضف <span class='text-red-600 font-bold'>١٢</span> للطرفين:</strong><br>للتخلص من (-١٢) بجانب المتغير س.<br><span class='math-eq'>س - ١٢ <span class='text-red-600 font-bold'>+ ١٢</span> ≥ ٨ <span class='text-red-600 font-bold'>+ ١٢</span></span>` }, { text: `<strong>2. بسّط المعادلة:</strong><br>بجمع الأرقام في كل طرف.<br><span class='math-eq'>س ≥ ٢٠</span>` }, { text: `<strong>3. مجموعة الحل:</strong><br>الحل هو كل الأعداد الأكبر من أو تساوي ٢٠.<br><div class='solution-set mt-2'>{س | س ≥ ٢٠}</div>` }, { text: `<strong>4. التمثيل على خط الأعداد:</strong><div id="nl-1a" class="number-line-container"></div>`, action: () => generateNumberLine('nl-1a', 20, 'gte') } ] },
                        "1b": { totalSteps: 4, introText: `<div class="text-sm">لحل المتباينة، نريد عزل المتغير <strong>م</strong> في طرف بمفرده.</div>`, stepsContent: [ { text: `<strong>1. اطرح <span class='text-red-600 font-bold'>١٩</span> من الطرفين:</strong><br>للتخلص من (+١٩) بجانب المتغير م.<br><span class='math-eq'>م + ١٩ <span class='text-red-600 font-bold'>- ١٩</span> > ٥٦ <span class='text-red-600 font-bold'>- ١٩</span></span>` }, { text: `<strong>2. بسّط المعادلة:</strong><br>بطرح الأرقام في كل طرف.<br><span class='math-eq'>م > ٣٧</span>` }, { text: `<strong>3. مجموعة الحل:</strong><br>الحل هو كل الأعداد الأكبر من ٣٧.<br><div class='solution-set mt-2'>{م | م > ٣٧}</div>` }, { text: `<strong>4. التمثيل على خط الأعداد:</strong><div id="nl-1b" class="number-line-container"></div>`, action: () => generateNumberLine('nl-1b', 37, 'gt') } ] },
                        "2a": { totalSteps: 5, introText: `<div class="text-sm">لحل المتباينة، نجمع المتغيرات في طرف والأعداد في الطرف الآخر.</div>`, stepsContent: [ { text: `<strong>1. اطرح <span class='text-red-600 font-bold'>٤ن</span> من الطرفين:</strong><br>لجمع المتغيرات في الطرف الأيمن.<br><span class='math-eq'>٥ن <span class='text-red-600 font-bold'>- ٤ن</span> - ١ < ٤ن <span class='text-red-600 font-bold'>- ٤ن</span> + ٦</span>` }, { text: `<strong>2. بسّط:</strong><br><span class='math-eq'>ن - ١ < ٦</span>` }, { text: `<strong>3. أضف <span class='text-blue-600 font-bold'>١</span> للطرفين:</strong><br>لجمع الأعداد في الطرف الأيسر.<br><span class='math-eq'>ن - ١ <span class='text-blue-600 font-bold'>+ ١</span> < ٦ <span class='text-blue-600 font-bold'>+ ١</span></span>` }, { text: `<strong>4. الحل النهائي:</strong><br>الحل هو كل الأعداد الأصغر من ٧.<br><div class='solution-set mt-2'>{ن | ن < ٧}</div>` }, { text: `<strong>5. التمثيل على خط الأعداد:</strong><div id="nl-2a" class="number-line-container"></div>`, action: () => generateNumberLine('nl-2a', 7, 'lt') } ] },
                        "2b": { totalSteps: 5, introText: `<div class="text-sm">لحل المتباينة، نجمع المتغيرات في طرف والأعداد في الطرف الآخر.</div>`, stepsContent: [ { text: `<strong>1. اطرح <span class='text-red-600 font-bold'>٢س</span> من الطرفين:</strong><br>لجمع المتغيرات في الطرف الأيمن.<br><span class='math-eq'>٣س <span class='text-red-600 font-bold'>- ٢س</span> + ٦ ≤ ٢س <span class='text-red-600 font-bold'>- ٢س</span> + ٨</span>` }, { text: `<strong>2. بسّط:</strong><br><span class='math-eq'>س + ٦ ≤ ٨</span>` }, { text: `<strong>3. اطرح <span class='text-blue-600 font-bold'>٦</span> من الطرفين:</strong><br>لجمع الأعداد في الطرف الأيسر.<br><span class='math-eq'>س + ٦ <span class='text-blue-600 font-bold'>- ٦</span> ≤ ٨ <span class='text-blue-600 font-bold'>- ٦</span></span>` }, { text: `<strong>4. الحل النهائي:</strong><br>الحل هو كل الأعداد الأصغر من أو تساوي ٢.<br><div class='solution-set mt-2'>{س | س ≤ ٢}</div>` }, { text: `<strong>5. التمثيل على خط الأعداد:</strong><div id="nl-2b" class="number-line-container"></div>`, action: () => generateNumberLine('nl-2b', 2, 'lte') } ] }
                    };
                    const verbalConfig1 = { totalSteps: 3, layout: 'grid', introText: `<div class="text-sm">لنحول المسألة إلى متباينة رياضية ونحلها.</div>`, stepsContent: [ { text: `<strong>1. تحديد المتغير والعبارة:</strong><br>لنفرض أن سعر البنطال هو <span class='math-eq'>ب</span>.<br>المبلغ الإجمالي هو <span class='math-eq'>٧٥ + ب</span>.<br>الإنفاق يجب أن لا يزيد على ١٩٥ ريالاً.` }, { text: `<strong>2. كتابة المتباينة:</strong><br>عبارة "لا يزيد على" تعني "أقل من أو يساوي" (≤).<br><span class='math-eq'>٧٥ + ب ≤ ١٩٥</span>` }, { text: `<strong>3. حل المتباينة:</strong><br>اطرح <span class='text-red-600 font-bold'>٧٥</span> من الطرفين.<br><span class='math-eq'>ب ≤ ١٢٠</span>.<br>يجب أن يكون سعر البنطال ١٢٠ ريالاً أو أقل.` } ] };
                    const verbalConfig2 = { totalSteps: 3, layout: 'grid', introText: `<div class="text-sm">لنحول المسألة إلى متباينة رياضية ونحلها.</div>`, stepsContent: [ { text: `<strong>1. تحديد المتغير والعبارة:</strong><br>لنفرض أن المبلغ الإضافي هو <span class='math-eq'>س</span>.<br>المبلغ الإجمالي هو <span class='math-eq'>٢١٠ + س</span>.<br>الادخار يجب أن يكون ٥٠٠ ريال على الأقل.` }, { text: `<strong>2. كتابة المتباينة:</strong><br>عبارة "على الأقل" تعني "أكبر من أو يساوي" (≥).<br><span class='math-eq'>٢١٠ + س ≥ ٥٠٠</span>` }, { text: `<strong>3. حل المتباينة:</strong><br>اطرح <span class='text-red-600 font-bold'>٢١٠</span> من الطرفين.<br><span class='math-eq'>س ≥ ٢٩٠</span>.<br>يجب أن تدخر ٢٩٠ ريالاً أو أكثر.` } ] };

                    Object.keys(configs).forEach(key => {
                        createInteractiveSection({
                            nextBtn: document.getElementById(`interactive-next-${key}`),
                            backBtn: document.getElementById(`interactive-back-${key}`),
                            stepCounter: document.getElementById(`interactive-step-counter-${key}`),
                            explanationDiv: document.getElementById(`interactive-explanation-${key}`),
                            ...configs[key]
                        });
                    });

                    createInteractiveSection({
                        nextBtn: document.getElementById('interactive-next-verbal-1'),
                        backBtn: document.getElementById('interactive-back-verbal-1'),
                        stepCounter: document.getElementById('interactive-step-counter-verbal-1'),
                        explanationDiv: document.getElementById('interactive-explanation-verbal-1'),
                        ...verbalConfig1
                    });
                     createInteractiveSection({
                        nextBtn: document.getElementById('interactive-next-verbal-2'),
                        backBtn: document.getElementById('interactive-back-verbal-2'),
                        stepCounter: document.getElementById('interactive-step-counter-verbal-2'),
                        explanationDiv: document.getElementById('interactive-explanation-verbal-2'),
                        ...verbalConfig2
                    });
                })();
                break;
        }
    }
    /**
     * يجعل الدوال المساعدة متاحة بشكل عام للوصول إليها من خلال onclick.
     * @param {string} questionId معرف السؤال.
     * @param {string} view العرض المطلوب (mental أو formal).
     */
    window.toggleSolution = function(questionId, view) {
        const formalDiv = document.getElementById(`formal-solution-${questionId}`);
        const mentalDiv = document.getElementById(`mental-solution-${questionId}`);

        if (view === 'mental') {
            formalDiv.style.display = 'none';
            mentalDiv.style.display = 'block';
        } else {
            formalDiv.style.display = 'block';
            mentalDiv.style.display = 'none';
        }
    }

    // =================================================================
    // == 4. معالجات الأحداث (Event Listeners)
    // =================================================================
    
    document.addEventListener('DOMContentLoaded', () => {
        const storedStudentId = sessionStorage.getItem('studentId');
        if (storedStudentId) {
            handleLogin(storedStudentId);
        } else {
            showView(loginView);
        }
        initializeShareButtons(); // تهيئة أزرار المشاركة عند تحميل الصفحة
    });

    loginForm.addEventListener('submit', (e) => { e.preventDefault(); const studentId = document.getElementById('login-id').value.trim(); if (studentId) handleLogin(studentId); });
    document.getElementById('visitor-btn').addEventListener('click', () => { sessionStorage.removeItem('studentId'); sessionStorage.removeItem('visitorAttempts'); currentStudent = null; showMainScreen(null); });
    document.getElementById('logout-btn').addEventListener('click', () => { sessionStorage.removeItem('studentId'); sessionStorage.removeItem('visitorAttempts'); currentStudent = null; showView(loginView); });
    document.getElementById('dashboard-btn').addEventListener('click', () => { showView(mainContentView); });
    closeModalBtn.addEventListener('click', () => { explanationModal.classList.add('hidden'); });

    document.body.addEventListener('click', function(event) {
        const target = event.target.closest('button');
        if (!target) return;

        const action = target.dataset.action;
        if (action === 'back-to-main') {
            showMainScreen(currentStudent);
        } else if (action === 'retake-quiz') {
            showLessonView(target.dataset.lessonId);
        } else if (action === 'show-explanation') {
            showExplanation(target.dataset.index);
        }
    });

    </script>
</body>
</html>
