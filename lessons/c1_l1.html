<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدرس ١-١: المعادلات | منصة الرياضيات التفاعلية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-change { color: #ef4444; font-weight: bold; }
        .math-eq {
            color: #4338ca;
            font-weight: 900; /* خط عريض جداً */
            font-family: 'Courier New', Courier, monospace; /* خط مختلف وواضح */
            display: inline-block;
            font-size: 1.2em; /* تم تصغير الخط قليلاً */
            padding: 0 4px; /* زيادة المساحة حول الحرف */
            vertical-align: -3px; /* تعديل المحاذاة العمودية لتناسب الحجم الجديد */
            border: 1px solid #ddd; /* إضافة إطار خفيف للتمييز */
            background-color: #f7f7f9; /* خلفية بلون مختلف قليلاً */
            border-radius: 4px;
        }
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .substitution-value {
            color: #c026d3; /* fuchsia-600 */
            font-weight: bold;
            padding: 1px 4px;
            border-radius: 4px;
            background-color: #fce7f3; /* pink-100 */
        }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
        /* Styles for explanation modal AND interactive examples */
        .explanation-step {
            text-align: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .explanation-comment {
            color: #6b7280; /* gray-500 */
            font-size: 0.9em;
            font-family: 'Cairo', sans-serif;
            font-weight: normal;
            display: block;
            margin-bottom: 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">الدرس ١-١: المعادلات</h1>
                </header>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفهوم الأساسي</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <h3 class="font-bold text-lg mb-2">المفردات الأساسية:</h3>
                            <ul class="list-inside space-y-3">
                                <li><span class="vocab-term">الجملة المفتوحة:</span> هي جملة رياضية تحتوي على متغير، مثل: <span class="math-eq">س + ٣ = ٧</span> أو <span class="math-eq">ص + ٣</span>.</li>
                                <li><span class="vocab-term">المعادلة:</span> هي نوع خاص من الجمل المفتوحة، حيث يجب أن تحتوي على إشارة المساواة (<span class="math-eq">=</span>).</li>
                                <li><span class="vocab-term">مجموعة التعويض:</span> هي مجموعة من الأعداد التي نعوض بها عن قيمة المتغير.</li>
                                <li><span class="vocab-term">مجموعة الحل:</span> هي مجموعة العناصر من مجموعة التعويض التي تجعل المعادلة صحيحة.</li>
                                <li><span class="vocab-term">المتطابقة:</span> هي معادلة تكون صحيحة لـ <strong>جميع</strong> قيم المتغير التي نعوض بها. مثال: <span class="math-eq">٢(س + ٣) = ٢س + ٦</span>. مهما كانت قيمة س، سيبقى طرفا المعادلة متساويين.</li>
                            </ul>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg mt-4">
                            <h4 class="font-bold text-lg mb-2 text-red-800">متى لا يكون للمعادلة حل؟ (المعادلة المستحيلة)</h4>
                            <p>لا يكون للمعادلة حل عندما تؤدي تبسيطاتها إلى عبارة خاطئة دائماً، بغض النظر عن قيمة المتغير. مثال: <span class="math-eq">س + ٥ = س + ١</span>. إذا طرحنا 'س' من الطرفين، نحصل على <span class="math-eq">٥ = ١</span>، وهي عبارة خاطئة. لذا، لا يوجد أي قيمة للمتغير 'س' يمكن أن تجعل هذه المعادلة صحيحة، وتكون مجموعة الحل هي المجموعة الخالية { }.</p>
                        </div>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: أمثلة تفاعلية</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div class="grid grid-cols-1 gap-8">
                            <!-- Example 1 Start -->
                            <div id="interactive-container-1" class="p-4 bg-white rounded-lg">
                                <p class="text-lg font-semibold mb-4">مثال ١: حل المعادلة <span class="math-eq">ك + ٥ = ٧</span>، إذا كانت مجموعة التعويض هي <span class="math-eq">{١، ٢، ٣، ٤}</span>.</p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: التعويض</h4><p>نعوض عن المتغير <span class="math-eq">ك</span> بكل عنصر من مجموعة التعويض.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-1"><h4 class="font-bold">الخطوة 2: التحقق (ك=1)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">قيمة ك</th><th class="p-2">التعويض في <span class="math-eq">ك+٥</span></th><th class="p-2">النتيجة</th><th class="p-2">صحيحة؟</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq"><span class="substitution-value">١</span> + ٥</span></td><td><span class="math-eq">٦</span></td><td><span class="text-red-600 font-bold">خطأ</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-1"><h4 class="font-bold">الخطوة 2: التحقق (ك=2)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">قيمة ك</th><th class="p-2">التعويض في <span class="math-eq">ك+٥</span></th><th class="p-2">النتيجة</th><th class="p-2">صحيحة؟</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq">١ + ٥</span></td><td><span class="math-eq">٦</span></td><td><span class="text-red-600 font-bold">خطأ</span></td></tr><tr class="border-b bg-green-50"><td><span class="math-eq">٢</span></td><td><span class="math-eq"><span class="substitution-value">٢</span> + ٥</span></td><td><span class="math-eq">٧</span></td><td><span class="text-green-600 font-bold">✔</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-1"><h4 class="font-bold">الخطوة 2: التحقق (ك=3)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">قيمة ك</th><th class="p-2">التعويض في <span class="math-eq">ك+٥</span></th><th class="p-2">النتيجة</th><th class="p-2">صحيحة؟</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq">١ + ٥</span></td><td><span class="math-eq">٦</span></td><td><span class="text-red-600 font-bold">خطأ</span></td></tr><tr class="border-b bg-green-50"><td><span class="math-eq">٢</span></td><td><span class="math-eq">٢ + ٥</span></td><td><span class="math-eq">٧</span></td><td><span class="text-green-600 font-bold">✔</span></td></tr><tr class="border-b"><td><span class="math-eq">٣</span></td><td><span class="math-eq"><span class="substitution-value">٣</span> + ٥</span></td><td><span class="math-eq">٨</span></td><td><span class="text-red-600 font-bold">خطأ</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-1"><h4 class="font-bold">الخطوة 2: التحقق (ك=4)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">قيمة ك</th><th class="p-2">التعويض في <span class="math-eq">ك+٥</span></th><th class="p-2">النتيجة</th><th class="p-2">صحيحة؟</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq">١ + ٥</span></td><td><span class="math-eq">٦</span></td><td><span class="text-red-600 font-bold">خطأ</span></td></tr><tr class="border-b bg-green-50"><td><span class="math-eq">٢</span></td><td><span class="math-eq">٢ + ٥</span></td><td><span class="math-eq">٧</span></td><td><span class="text-green-600 font-bold">✔</span></td></tr><tr class="border-b"><td><span class="math-eq">٣</span></td><td><span class="math-eq">٣ + ٥</span></td><td><span class="math-eq">٨</span></td><td><span class="text-red-600 font-bold">خطأ</span></td></tr><tr><td><span class="math-eq">٤</span></td><td><span class="math-eq"><span class="substitution-value">٤</span> + ٥</span></td><td><span class="math-eq">٩</span></td><td><span class="text-red-600 font-bold">خطأ</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p>وجدنا أن القيمة التي تجعل المعادلة صحيحة هي <span class="math-eq">٢</span>. إذن، <span class="vocab-term">مجموعة الحل</span> هي <span class="math-eq">{٢}</span>.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                             <!-- Example 2 Start -->
                            <div id="interactive-container-2" class="p-4 bg-white rounded-lg">
                                <p class="text-lg font-semibold mb-4">مثال ٢: أوجد مجموعة حل المعادلة <span class="math-eq">ص = ٨ - ٢س</span>، إذا كان <span class="math-eq">س ∈ {١، ٢، ٣}</span>.</p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: إنشاء جدول</h4><p>ننظم الحل بإنشاء جدول ونعوض عن كل قيمة لـ <span class="math-eq">س</span> لإيجاد قيمة <span class="math-eq">ص</span> المقابلة.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-2"><h4 class="font-bold">الخطوة 2: التعويض (س=1)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">س</th><th class="p-2">التعويض في <span class="math-eq">٨-٢س</span></th><th class="p-2">ص</th><th class="p-2">الحل (س،ص)</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq">٨ - ٢(<span class="substitution-value">١</span>)</span></td><td><span class="math-eq">٦</span></td><td><span class="math-eq">(١، ٦)</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-2"><h4 class="font-bold">الخطوة 2: التعويض (س=2)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">س</th><th class="p-2">التعويض في <span class="math-eq">٨-٢س</span></th><th class="p-2">ص</th><th class="p-2">الحل (س،ص)</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq">٨ - ٢(١)</span></td><td><span class="math-eq">٦</span></td><td><span class="math-eq">(١، ٦)</span></td></tr><tr class="border-b"><td><span class="math-eq">٢</span></td><td><span class="math-eq">٨ - ٢(<span class="substitution-value">٢</span>)</span></td><td><span class="math-eq">٤</span></td><td><span class="math-eq">(٢، ٤)</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box" data-step-group="table-2"><h4 class="font-bold">الخطوة 2: التعويض (س=3)</h4><div class="overflow-x-auto"><table class="w-full mt-2 text-center"><thead class="bg-gray-200"><tr><th class="p-2">س</th><th class="p-2">التعويض في <span class="math-eq">٨-٢س</span></th><th class="p-2">ص</th><th class="p-2">الحل (س،ص)</th></tr></thead><tbody><tr class="border-b"><td><span class="math-eq">١</span></td><td><span class="math-eq">٨ - ٢(١)</span></td><td><span class="math-eq">٦</span></td><td><span class="math-eq">(١، ٦)</span></td></tr><tr class="border-b"><td><span class="math-eq">٢</span></td><td><span class="math-eq">٨ - ٢(٢)</span></td><td><span class="math-eq">٤</span></td><td><span class="math-eq">(٢، ٤)</span></td></tr><tr><td><span class="math-eq">٣</span></td><td><span class="math-eq">٨ - ٢(<span class="substitution-value">٣</span>)</span></td><td><span class="math-eq">٢</span></td><td><span class="math-eq">(٣، ٢)</span></td></tr></tbody></table></div></div>
                                    <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الحل النهائي</h4><p><span class="vocab-term">مجموعة الحل</span> هي مجموعة الأزواج المرتبة: <span class="math-eq">{(١، ٦)، (٢، ٤)، (٣، ٢)}</span>.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Example 3 Start -->
                            <div id="interactive-container-3" class="p-4 bg-white rounded-lg">
                                <p class="text-lg font-semibold mb-4">مثال ٣: هل المعادلة <span class="math-eq">٣(س + ٢) = ٣س + ٦</span> متطابقة؟</p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">المعادلة الأصلية</h4><div class="explanation-step justify-center mt-2"><span class="math-eq">٣(س + ٢) = ٣س + ٦</span></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: تبسيط الطرف الأيسر</h4><div class="text-center mt-2"><p class="explanation-comment mb-1">باستخدام خاصية التوزيع</p><span class="math-eq"><span class="highlight-change">٣ × س</span> + <span class="highlight-change">٣ × ٢</span> = ٣س + ٦</span></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: المقارنة</h4><div class="text-center mt-2"><p class="explanation-comment mb-1">الطرفان متطابقان</p><span class="math-eq">٣س + ٦ = ٣س + ٦</span></div></div>
                                    <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">الخطوة الأخيرة: الاستنتاج</h4><p>بما أن طرفي المعادلة متطابقان تمامًا، فهي <span class="vocab-term">متطابقة</span>. مجموعة الحل هي جميع الأعداد الحقيقية.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                            <!-- Example 4 Start -->
                            <div id="interactive-container-4" class="p-4 bg-white rounded-lg">
                                <p class="text-lg font-semibold mb-4">مثال ٤: هل للمعادلة <span class="math-eq">٥س + ٣ = ٥س + ٧</span> حل؟</p>
                                <div class="steps-container space-y-4 min-h-[250px]">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">المعادلة الأصلية</h4><div class="text-center mt-2"><span class="math-eq">٥س + ٣ = ٥س + ٧</span></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 1: عزل المتغير</h4><div class="text-center mt-2"><p class="explanation-comment mb-1">بطرح ٥س من الطرفين</p><span class="math-eq">٥س <span class="highlight-change">- ٥س</span> + ٣ = ٥س <span class="highlight-change">- ٥س</span> + ٧</span></div></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">الخطوة 2: التبسيط</h4><div class="text-center mt-2"><p class="explanation-comment mb-1">عبارة خاطئة</p><span class="math-eq">٣ = ٧</span></div></div>
                                    <div class="step-interactive p-4 bg-red-200 rounded-lg step-box border-red-600"><h4 class="font-bold">الخطوة الأخيرة: الاستنتاج</h4><p>بما أن العبارة <span class="math-eq">٣ = ٧</span> خاطئة دائمًا، فهذه المعادلة <span class="vocab-term">مستحيلة الحل</span>. مجموعة الحل هي المجموعة الخالية { }.</p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="4" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="4" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="4" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">✍️ رابعاً: حان دورك! اختبر فهمك</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">نتيجتك النهائية</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">إعادة الاختبار</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold" id="modal-title">💡 شرح الإجابة</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    // =================================================================================
    // دوال مشتركة (لا تقم بتعديل هذا القسم)
    // =================================================================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">منصة الرياضيات التفاعلية</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">منصة الرياضيات التفاعلية</h1></a>`; } let userInfoHtml = ''; const backLink = `<a href="../index.html" target="_top" class="text-xs text-blue-600 hover:underline">&larr; العودة إلى الفهرس</a>`; if (studentData) { userInfoHtml = `<div class="flex items-center gap-4"><div class="text-right"><span class="font-semibold block">أهلاً، ${studentData.name}</span>${backLink}</div><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600 self-start">خروج</a></div>`; } else { userInfoHtml = `<div class="text-right"><p class="text-lg text-gray-600">زائر</p>${backLink}</div>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; const logoutLink = headerContainer.querySelector('#logout-link'); if(logoutLink) { logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); } }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">© 2024 جميع الحقوق محفوظة | تصميم وتطوير: أ. عبدالعزيز خالد العبلان</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData, studentId, classId) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">لا توجد أسئلة متاحة لهذا الدرس حالياً.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `المحاولات المتبقية: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); const smartButton = q.smartExplanation ? `<button type="button" id="smart-explain-btn-${index}" class="hidden mt-2 ml-4 text-xs text-purple-600 hover:underline">💡 حل ذكي</button>` : ''; return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div class="flex items-center"><button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">اعرف لماذا؟</button>${smartButton}</div></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">تحقق من إجاباتي</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) { explainBtn.addEventListener('click', () => showExplanation(index, false)); } const smartExplainBtn = document.getElementById(`smart-explain-btn-${index}`); if(smartExplainBtn) { smartExplainBtn.addEventListener('click', () => showExplanation(index, true)); } }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'لا توجد محاولات متبقية'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = '✔ إجابة صحيحة!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `❌ إجابة خاطئة.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden'); const smartBtn = document.getElementById(`smart-explain-btn-${index}`); if(smartBtn) smartBtn.classList.remove('hidden'); }); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentId && classId) { saveGrade(lessonId, finalGrade, studentId, classId); if (attemptsLeft - 1 > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'تم عرض نتيجتك. سجل الدخول لحفظ تقدمك.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade, studentId, classId) { if (!studentId || !classId) { console.error("Student ID or Class ID is missing."); return; } const saveStatus = document.getElementById('save-status'); saveStatus.textContent = 'جارٍ حفظ نتيجتك...'; const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&classId=${classId}&lessonId=${lessonId}&grade=${grade}`; fetch(url) .then(res => res.json()) .then(result => { if (result.status === 'success') { saveStatus.textContent = '✔ تم حفظ نتيجتك بنجاح! ستظهر في لوحة التحكم عند العودة.'; const studentData = JSON.parse(localStorage.getItem('currentStudent')); if (studentData && studentData.id === studentId) { if (!studentData.lessons) studentData.lessons = {}; if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; } else { studentData.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(studentData)); } } else { throw new Error(result.message); } }) .catch(error => { saveStatus.textContent = '❌ حدث خطأ أثناء حفظ الدرجة.'; console.error("Save Grade Error:", error); }); }
    function showExplanation(questionIndex, isSmart) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); const modalTitle = document.getElementById('modal-title'); const question = currentQuestions[questionIndex]; if(modal && explanationText && modalTitle && question) { if (isSmart && question.smartExplanation) { modalTitle.innerHTML = '💡 الحل الذكي'; explanationText.innerHTML = `<p class="text-lg">${question.smartExplanation}</p>`; } else { modalTitle.innerHTML = '💡 شرح الإجابة'; explanationText.innerHTML = question.explanation; } modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    
    // =================================================================================
    // محتوى الدرس المحدد (هذا القسم يتم تعديله لكل درس)
    // =================================================================================
    const LESSON_ID = 'c1_l1'; 
    function generateQuiz() { 
        const questionBank = [
            { type: 'mcq', level: '⭐', topic: 'vocabulary', text: 'أي من التالي هو مثال على جملة مفتوحة وليست معادلة؟', options: [ { display: '<span class="math-eq">٥س - ٢</span>', value: '٥س - ٢' }, { display: '<span class="math-eq">٩ + ٧ = ١٦</span>', value: '٩ + ٧ = ١٦' }, { display: '<span class="math-eq">١٢ > ٤</span>', value: '١٢ > ٤' }, { display: '<span class="math-eq">س = ٥</span>', value: 'س = ٥' } ], correct: '٥س - ٢', explanation: `<p>الجملة المفتوحة تحتوي متغيراً، ولكنها لا تحتوي بالضرورة على علامة مساواة لتكون معادلة.</p><p class='mt-2 p-2 bg-gray-100 rounded-md'><span class='math-eq'>٥س - ٢</span> هي جملة مفتوحة لأنها تعتمد على قيمة س.</p>` },
            { type: 'mcq', level: '⭐⭐', topic: 'vocabulary', text: 'إذا كانت المعادلة هي <span class="math-eq">س + ٤ = ٩</span> و<span class="vocab-term">مجموعة التعويض</span> هي <span class="math-eq">{٣, ٤, ٥, ٦}</span>، فما هي <span class="vocab-term">مجموعة الحل</span>؟', options: [ { display: '<span class="math-eq">{٣}</span>', value: '{٣}' }, { display: '<span class="math-eq">{٥}</span>', value: '{٥}' }, { display: '<span class="math-eq">{٣, ٤, ٥}</span>', value: '{٣, ٤, ٥}' }, { display: '<span class="math-eq">{٤}</span>', value: '{٤}' } ], correct: '{٥}', smartExplanation: "بتجربة الخيارات، نبدأ بالعدد ٥: ٥ + ٤ = ٩. إجابة صحيحة مباشرة.", explanation: `<p>نعوض بكل عنصر في المعادلة:</p><ul class='list-disc pr-5 mt-2'><li>عند <span class="math-eq">س=٣</span>: <span class="math-eq">٣+٤ = ٧</span> (خطأ)</li><li>عند <span class="math-eq">س=٤</span>: <span class="math-eq">٤+٤ = ٨</span> (خطأ)</li><li class='text-green-600 font-bold'>عند <span class="math-eq">س=٥</span>: <span class="math-eq">٥+٤ = ٩</span> (صحيح)</li><li>عند <span class="math-eq">س=٦</span>: <span class="math-eq">٦+٤ = ١٠</span> (خطأ)</li></ul><p class='mt-2 p-2 bg-green-100 rounded-md'>إذن، مجموعة الحل هي <span class="math-eq">{٥}</span>.</p>` },
            { type: 'mcq', level: '⭐', topic: 'oneVariable', text: 'حل المعادلة: <span class="math-eq">س - ٤ = ٦</span>.', options: [ { display: '<span class="math-eq">٢</span>', value: '٢' }, { display: '<span class="math-eq">١٠</span>', value: '١٠' }, { display: '<span class="math-eq">٢٤</span>', value: '٢٤' }, { display: '<span class="math-eq">-٢</span>', value: '-٢' } ], correct: '١٠', smartExplanation: "ما هو العدد الذي إذا طرحنا منه ٤ يعطي ٦؟ بالتأكيد هو ١٠.", explanation: `<div class='space-y-3'><div class='explanation-step'><p class='explanation-comment'>المعادلة الأصلية</p><span class='math-eq'>س - ٤ = ٦</span></div><div class='explanation-step'><p class='explanation-comment'>بإضافة ٤ للطرفين</p><span class='math-eq'>س - ٤ <span class='highlight-change'>+ ٤</span> = ٦ <span class='highlight-change'>+ ٤</span></span></div><div class='explanation-step'><p class='explanation-comment'>الحل النهائي</p><span class='math-eq'>س = ١٠</span></div></div>` },
            { type: 'mcq', level: '⭐⭐', topic: 'oneVariable', text: 'حل المعادلة: <span class="math-eq">٣ن + ١ = ١٦</span>.', options: [ { display: '<span class="math-eq">٥</span>', value: '٥' }, { display: '<span class="math-eq">٦</span>', value: '٦' }, { display: '<span class="math-eq">١٥</span>', value: '١٥' }, { display: '<span class="math-eq">٤</span>', value: '٤' } ], correct: '٥', smartExplanation: "فكر عكسياً: ١٦ ناقص ١ يساوي ١٥. ما العدد الذي نضربه في ٣ ليعطي ١٥؟ إنه ٥.", explanation: `<div class='space-y-3'><div class='explanation-step'><p class='explanation-comment'>المعادلة الأصلية</p><span class='math-eq'>٣ن + ١ = ١٦</span></div><div class='explanation-step'><p class='explanation-comment'>بطرح ١ من الطرفين</p><span class='math-eq'>٣ن + ١ <span class='highlight-change'>- ١</span> = ١٦ <span class='highlight-change'>- ١</span></span></div><div class='explanation-step'><p class='explanation-comment'>بعد التبسيط</p><span class='math-eq'>٣ن = ١٥</span></div><div class='explanation-step'><p class='explanation-comment'>بقسمة الطرفين على ٣</p><span class='math-eq'><span class="fraction"><span>٣ن</span><span class="frac-bar"></span><span>٣</span></span> = <span class="fraction"><span>١٥</span><span class="frac-bar"></span><span>٣</span></span></span></div><div class='explanation-step'><p class='explanation-comment'>الحل النهائي</p><span class='math-eq'>ن = ٥</span></div></div>` },
            { type: 'mcq', level: '⭐⭐⭐', topic: 'identity', text: 'أي من المعادلات التالية تعتبر <span class="vocab-term">متطابقة</span>؟', options: [ { display: '<span class="math-eq">س + ٥ = ١٠</span>', value: 'س + ٥ = ١٠' }, { display: '<span class="math-eq">٣(س + ٢) = ٣س + ٦</span>', value: '٣(س + ٢) = ٣س + ٦' }, { display: '<span class="math-eq">س = س + ١</span>', value: 'س = س + ١' }, { display: '<span class="math-eq">٢س = ٨</span>', value: '٢س = ٨' } ], correct: '٣(س + ٢) = ٣س + ٦', smartExplanation: "بمجرد النظر، بتوزيع الضرب على القوس في الخيار الثاني (٣ × س و ٣ × ٢) نحصل على ٣س + ٦، وهو نفس الطرف الآخر.", explanation: `<p>المتطابقة هي معادلة صحيحة لجميع قيم المتغير. إذا وزعنا الضرب على الجمع في الطرف الأيمن من المعادلة <span class="math-eq">٣(س + ٢)</span>، نحصل على <span class="math-eq">٣س + ٦</span>، وهو نفس الطرف الأيسر. لذا هي متطابقة.</p>` },
            { type: 'mcq', level: '⭐⭐⭐', topic: 'noSolution', text: 'ما هي مجموعة حل المعادلة <span class="math-eq">ن + ٨ = ن - ٢</span>؟', options: [ { display: '<span class="math-eq">{١٠}</span>', value: '{١٠}' }, { display: '<span class="math-eq">{-٦}</span>', value: '{-٦}' }, { display: '<span class="math-eq">{كل الأعداد الحقيقية}</span>', value: 'all' }, { display: '<span class="math-eq">{ } (لا يوجد حل)</span>', value: 'none' } ], correct: 'none', smartExplanation: "لاحظ أن 'ن' موجودة في الطرفين. إذا حذفناها، يتبقى ٨ = -٢، وهذا مستحيل. إذن لا يوجد حل.", explanation: `<p>إذا حاولنا حل المعادلة وطرحنا <span class="math-eq">ن</span> من الطرفين، سنحصل على العبارة الخاطئة <span class="math-eq">٨ = -٢</span>. هذا يعني أنه لا توجد قيمة لـ <span class="math-eq">ن</span> تجعل المعادلة صحيحة، وبالتالي فمجموعة الحل فارغة.</p>` },
            { type: 'mcq', level: '⭐⭐', topic: 'oneVariable', text: 'حل المعادلة: <span class="math-eq">١٥ = ٢ب - ٣</span>.', options: [ { display: '<span class="math-eq">٩</span>', value: '٩' }, { display: '<span class="math-eq">٦</span>', value: '٦' }, { display: '<span class="math-eq">١٨</span>', value: '١٨' }, { display: '<span class="math-eq">-٩</span>', value: '-٩' } ], correct: '٩', smartExplanation: "فكر عكسياً: ١٥ زائد ٣ يساوي ١٨. ما العدد الذي نضربه في ٢ ليعطي ١٨؟ إنه ٩.", explanation: `<div class='space-y-3'><div class='explanation-step'><p class='explanation-comment'>المعادلة الأصلية</p><span class='math-eq'>١٥ = ٢ب - ٣</span></div><div class='explanation-step'><p class='explanation-comment'>بإضافة ٣ للطرفين</p><span class='math-eq'>١٥ <span class='highlight-change'>+ ٣</span> = ٢ب - ٣ <span class='highlight-change'>+ ٣</span></span></div><div class='explanation-step'><p class='explanation-comment'>بعد التبسيط</p><span class='math-eq'>١٨ = ٢ب</span></div><div class='explanation-step'><p class='explanation-comment'>بقسمة الطرفين على ٢</p><span class='math-eq'><span class="fraction"><span>١٨</span><span class="frac-bar"></span><span>٢</span></span> = <span class="fraction"><span>٢ب</span><span class="frac-bar"></span><span>٢</span></span></span></div><div class='explanation-step'><p class='explanation-comment'>الحل النهائي</p><span class='math-eq'>٩ = ب</span></div></div>` },
            { type: 'mcq', level: '⭐⭐', topic: 'twoVariables', text: 'إذا كان <span class="math-eq">(٣، ص)</span> حلاً للمعادلة <span class="math-eq">ص = ٥س - ٩</span>، فما قيمة <span class="math-eq">ص</span>؟', options: [ { display: '<span class="math-eq">١٥</span>', value: '١٥' }, { display: '<span class="math-eq">-١</span>', value: '-١' }, { display: '<span class="math-eq">٦</span>', value: '٦' }, { display: '<span class="math-eq">٢٤</span>', value: '٢٤' } ], correct: '٦', smartExplanation: "نعوض مباشرة: ٥ ضرب ٣ يساوي ١٥، ثم ١٥ ناقص ٩ يساوي ٦.", explanation: `<p>نعوض عن قيمة <span class="math-eq">س</span> بـ <span class="math-eq">٣</span> في المعادلة:</p><div class='space-y-3 mt-2'><div class='explanation-step'><p class='explanation-comment'>التعويض عن قيمة س</p><span class='math-eq'>ص = ٥(<span class='substitution-value'>٣</span>) - ٩</span></div><div class='explanation-step'><p class='explanation-comment'>حساب حاصل الضرب</p><span class='math-eq'>ص = ١٥ - ٩</span></div><div class='explanation-step'><p class='explanation-comment'>الحل النهائي</p><span class='math-eq'>ص = ٦</span></div></div>` },
            { type: 'mcq', level: '⭐⭐⭐', topic: 'identity', text: 'أي العبارات التالية تجعل المعادلة <span class="math-eq">٤(م - ١) = ...</span> متطابقة؟', options: [ { display: '<span class="math-eq">٤م - ١</span>', value: '٤م - ١' }, { display: '<span class="math-eq">م - ٤</span>', value: 'م - ٤' }, { display: '<span class="math-eq">٤م - ٤</span>', value: '٤م - ٤' }, { display: '<span class="math-eq">٤م</span>', value: '٤م' } ], correct: '٤م - ٤', smartExplanation: "بتوزيع الضرب: ٤ ضرب م هو ٤م، و ٤ ضرب -١ هو -٤. إذن الإجابة هي ٤م - ٤.", explanation: `<p>لكي تكون المعادلة متطابقة، يجب أن يكون الطرفان متساويين. باستخدام خاصية التوزيع، نضرب ٤ في كل حد داخل القوس:</p><div class='space-y-3 mt-2'><div class='explanation-step'><p class='explanation-comment'></p><span class='math-eq'>٤ × م = ٤م</span></div><div class='explanation-step'><p class='explanation-comment'></p><span class='math-eq'>٤ × -١ = -٤</span></div></div><p class='mt-2'>إذن، الطرف الآخر يجب أن يكون <span class="math-eq">٤م - ٤</span>.</p>` },
            { type: 'mcq', level: '⭐⭐⭐', topic: 'noSolution', text: 'حل المعادلة <span class="math-eq">٧ + ٢س = ٢(س + ١)</span>.', options: [ { display: '<span class="math-eq">س = ٥</span>', value: 'س = ٥' }, { display: '<span class="math-eq">{ } (لا يوجد حل)</span>', value: 'none' }, { display: '<span class="math-eq">{كل الأعداد الحقيقية}</span>', value: 'all' }, { display: '<span class="math-eq">س = -٥</span>', value: 'س = -٥' } ], correct: 'none', smartExplanation: "بفك القوس الأيمن نحصل على ٢س + ٢. لاحظ أن '٢س' موجودة في الطرفين. بحذفها يتبقى ٧ = ٢، وهذا مستحيل.", explanation: `<div class='space-y-3'><div class='explanation-step'><p class='explanation-comment'>المعادلة الأصلية</p><span class='math-eq'>٧ + ٢س = ٢(س + ١)</span></div><div class='explanation-step'><p class='explanation-comment'>بتوزيع الضرب على الجمع</p><span class='math-eq'>٧ + ٢س = <span class='highlight-change'>٢س + ٢</span></span></div><div class='explanation-step'><p class='explanation-comment'>بطرح ٢س من الطرفين</p><span class='math-eq'>٧ + ٢س <span class='highlight-change'>- ٢س</span> = ٢س + ٢ <span class='highlight-change'>- ٢س</span></span></div><div class='explanation-step'><p class='explanation-comment'>عبارة خاطئة</p><span class='math-eq'>٧ = ٢</span></div></div><p class='mt-4'>بما أن العبارة النهائية خاطئة، فالمعادلة ليس لها حل.</p>` },
            { type: 'mcq', level: '⭐', topic: 'vocabulary', text: 'ماذا تسمى المعادلة التي تكون صحيحة لجميع قيم المتغير؟', options: [ { display: 'معادلة مستحيلة', value: 'impossible' }, { display: 'جملة مفتوحة', value: 'open' }, { display: 'متطابقة', value: 'identity' }, { display: 'مجموعة حل', value: 'solution' } ], correct: 'identity', explanation: `<p>المعادلة التي تكون صحيحة دائمًا، بغض النظر عن قيمة المتغير، تسمى <span class="vocab-term">متطابقة</span>.</p>` },
            { type: 'mcq', level: '⭐⭐', topic: 'writing', text: 'اشترى أحمد كتابًا بسعر يزيد ٥ ريالات عن سعر قلمه. إذا كان سعر الكتاب ٣٠ ريالاً، فما المعادلة التي تمثل سعر القلم (ق)؟', options: [ { display: '<span class="math-eq">ق - ٥ = ٣٠</span>', value: 'ق - ٥ = ٣٠' }, { display: '<span class="math-eq">ق + ٥ = ٣٠</span>', value: 'ق + ٥ = ٣٠' }, { display: '<span class="math-eq">٥ق = ٣٠</span>', value: '٥ق = ٣٠' }, { display: '<span class="math-eq">ق = ٣٠ + ٥</span>', value: 'ق = ٣٠ + ٥' } ], correct: 'ق + ٥ = ٣٠', smartExplanation: "كلمة 'يزيد ٥' تعني أن سعر الكتاب هو (سعر القلم + ٥). إذن ٣٠ = ق + ٥.", explanation: `<p>سعر الكتاب (<span class="math-eq">٣٠</span>) يساوي سعر القلم (<span class="math-eq">ق</span>) مضافًا إليه <span class="math-eq">٥</span>. لذلك، المعادلة الصحيحة هي <span class="math-eq">ق + ٥ = ٣٠</span>.</p>` }
        ];
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random()); 
        const questionCount = Math.min(shuffled.length, 5); 
        return shuffled.slice(0, questionCount); 
    }

    // =================================================================================
    // مشغل الكود (لا تقم بتعديل هذا القسم)
    // =================================================================================
    document.addEventListener('DOMContentLoaded', () => { 
        const urlParams = new URLSearchParams(window.location.search);
        const studentId = urlParams.get('studentId');
        const classId = urlParams.get('classId');

        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            state[exampleId] = {
                currentIndex: -1,
                steps: container.querySelectorAll('.step-interactive'),
                placeholder: container.querySelector('.interactive-placeholder'),
                prevBtn: container.querySelector('.prev-btn'),
                nextBtn: container.querySelector('.next-btn'),
                resetBtn: container.querySelector('.reset-btn')
            };

            const steps = state[exampleId].steps;
            const totalSteps = steps.length;

            const updateButtons = () => {
                const isFirstStep = state[exampleId].currentIndex <= -1;
                const isLastStep = state[exampleId].currentIndex >= totalSteps - 1;
                state[exampleId].prevBtn.disabled = isFirstStep;
                if (isLastStep) {
                    state[exampleId].nextBtn.classList.add('hidden');
                    state[exampleId].resetBtn.classList.remove('hidden');
                } else {
                    state[exampleId].nextBtn.classList.remove('hidden');
                    state[exampleId].resetBtn.classList.add('hidden');
                }
            };

            const showState = () => {
                const index = state[exampleId].currentIndex;
                if (index === -1) {
                    if (state[exampleId].placeholder) state[exampleId].placeholder.classList.remove('hidden');
                    steps.forEach(s => s.classList.remove('active'));
                    return;
                }
                
                if (state[exampleId].placeholder) state[exampleId].placeholder.classList.add('hidden');

                const visibleSteps = new Set();
                const lastStepInGroup = {};

                for (let i = 0; i <= index; i++) {
                    const step = steps[i];
                    const group = step.dataset.stepGroup;
                    if (group) {
                        lastStepInGroup[group] = step;
                    } else {
                        visibleSteps.add(step);
                    }
                }
                Object.values(lastStepInGroup).forEach(step => visibleSteps.add(step));

                steps.forEach(step => {
                    if (visibleSteps.has(step)) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                });
            };

            const resetExample = () => {
                state[exampleId].currentIndex = -1;
                showState();
                updateButtons();
            };

            state[exampleId].nextBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex < totalSteps - 1) {
                    state[exampleId].currentIndex++;
                    showState();
                    updateButtons();
                }
            });

            state[exampleId].prevBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex > -1) {
                    state[exampleId].currentIndex--;
                    showState();
                    updateButtons();
                }
            });

            if(state[exampleId].resetBtn) {
                state[exampleId].resetBtn.addEventListener('click', resetExample);
            }
            updateButtons();
        });

        const student = getStudentFromStorage(); 
        const lessonTitleElement = document.getElementById('lesson-title'); 
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null; 
        buildHeader(student, lessonTitle); 
        buildFooter(); 
        const questions = generateQuiz(); 
        initializeQuiz(LESSON_ID, questions, student, studentId, classId); 
        const retakeBtn = document.getElementById('retake-quiz-btn'); 
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); } 
        const closeModalBtn = document.getElementById('closeModalBtn'); 
        if(closeModalBtn) { closeModalBtn.addEventListener('click', closeModal); } 
    });
    </script>
</body>
</html>
