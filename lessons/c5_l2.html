<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุฏุฑุณ ูฅ-ูข: ุญู ูุธุงู ูู ูุนุงุฏูุชูู ุจุงูุชุนููุถ | ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-change { color: #ef4444; font-weight: bold; }
        .math-eq { font-family: "Courier New", monospace; font-size: 1.2rem; font-weight: bold; color: #4338ca; background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 2px 8px; border-radius: 6px; display: inline-block; vertical-align: middle; }
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
        /* === ุชูุณูู ุฎุงุต ุจุงูุฃุฑูุงู (ุฌุฏูุฏ) === */
        .highlight-number {
            background-color: #fef9c3; /* yellow-100 */
            color: #b45309; /* amber-700 */
            padding: 1px 5px;
            border-radius: 4px;
            border: 1px solid #fde047; /* yellow-300 */
            font-weight: bold;
        }
        /* === ุฃููุงู ุงููุนุงุฏูุงุช (ุฌุฏูุฏ) === */
        .eq-1-color { color: #2563eb; /* blue-600 */ }
        .eq-2-color { color: #16a34a; /* green-600 */ }
        .eq-3-color { color: #9333ea; /* purple-600 */ }
        .eq-1-bg { background-color: #dbeafe; border-color: #93c5fd; }
        .eq-2-bg { background-color: #dcfce7; border-color: #86efac; }
        .eq-3-bg { background-color: #f3e8ff; border-color: #d8b4fe; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">ุงูุฏุฑุณ ูฅ-ูข: ุญู ูุธุงู ูู ูุนุงุฏูุชูู ุจุงูุชุนููุถ</h1>
                </header>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ก ุฃููุงู: ุงูููููู ุงูุฃุณุงุณู</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                        <p>ูุญู ูุธุงู ูู ุงููุนุงุฏูุงุช ุงูุฎุทูุฉ ุจุงูุชุนููุถุ ูุชุจุน ุงูุฎุทูุงุช ุงูุชุงููุฉ:</p>
                        <ol class="list-decimal pr-8 space-y-2">
                            <li><strong>ุงูุฎุทูุฉ ูก:</strong> ุญูู ุฅุญุฏู ุงููุนุงุฏูุชูู ุนูู ุงูุฃูู ุจุงุณุชุนูุงู ุฃุญุฏ ุงููุชุบูุฑูู ุฅุฐุง ูุงู ุฐูู ุถุฑูุฑูุงู. (ุงุจุญุซ ุนู ูุชุบูุฑ ูุนุงููู <span class="highlight-number">ูก</span> ุฃู <span class="highlight-number">-ูก</span> ูุชุณููู ุงูุญู).</li>
                            <li><strong>ุงูุฎุทูุฉ ูข:</strong> ุนููุถ ุงูููุฏุงุฑ ุงููุงุชุฌ ูู ุงูุฎุทูุฉ (<span class="highlight-number">ูก</span>) ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉุ ุซู ุญููุง.</li>
                            <li><strong>ุงูุฎุทูุฉ ูฃ:</strong> ุนููุถ ุงููููุฉ ุงููุงุชุฌุฉ ูู ุงูุฎุทูุฉ (<span class="highlight-number">ูข</span>) ูู ุฃู ูู ุงููุนุงุฏูุชูู ูุญููุง ูุฅูุฌุงุฏ ูููุฉ ุงููุชุบูุฑ ุงูุซุงููุ ูุงูุชุจ ุงูุญู ูู ุตูุฑุฉ ุฒูุฌ ูุฑุชุจ.</li>
                        </ol>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ฏ ุซุงููุงู: ุฃูุซูุฉ ุชูุงุนููุฉ</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="flex flex-col space-y-8">
                            <!-- ุงูุตู ุงูุฃูู ูู ุงูุฃูุซูุฉ -->
                            <div class="grid md:grid-cols-2 gap-8">
                                <!-- ุงููุซุงู ุงูุฃูู -->
                                <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูก: ุงุณุชุนูุงู ุงูุชุนููุถ ุงููุจุงุดุฑ</p>
                                    <p class="mb-4">ุญู ุงููุธุงู ุงูุขุชู: <br><span class="math-eq eq-1-bg eq-1-color">ุต = ูขุณ + ูก</span><br><span class="math-eq eq-2-bg eq-2-color">ูฃุณ + ุต = -ูฉ</span></p>
                                    <div class="steps-container space-y-4 min-h-[280px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 1: ุงููุนุงุฏูุฉ ุงูุฃููู ุฌุงูุฒุฉ</h4><p>ุงููุนุงุฏูุฉ ุงูุฃููู <span class="math-eq eq-1-bg eq-1-color">ุต = ูขุณ + ูก</span> ูุฌููุฒุฉ ุจุงููุนู.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุงูุชุนููุถ</h4><p>ูุนูุถ ูููุฉ <span class="font-bold eq-1-color">ุต</span> ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ: <br><span class="math-eq eq-2-bg eq-2-color">ูฃุณ + <span class="font-bold eq-1-color">(ูขุณ + ูก)</span> = -ูฉ</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 3: ุญู ูุฅูุฌุงุฏ ุณ</h4><p><span class="math-eq">ูฅุณ + ูก = -ูฉ</span><br><span class="math-eq">ูฅุณ = -ูกู</span><br><span class="math-eq">ุณ = -ูข</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 4: ุฅูุฌุงุฏ ุต</h4><p>ูุนูุถ <span class="math-eq">ุณ = -ูข</span> ูู ุงููุนุงุฏูุฉ ุงูุฃููู: <br><span class="math-eq eq-1-bg eq-1-color">ุต = ูข(-ูข) + ูก = -ูฃ</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุญู ุงูููุงุฆู</h4><p><span class="math-eq">(-ูข, -ูฃ)</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- ุงููุซุงู ุงูุซุงูู -->
                                <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูข: ุงูุญู ุซู ุงูุชุนููุถ</p>
                                    <p class="mb-4">ุญู ุงููุธุงู ุงูุขุชู: <br><span class="math-eq eq-1-bg eq-1-color">ุณ + ูขุต = ูฆ</span><br><span class="math-eq eq-2-bg eq-2-color">ูฃุณ - ูคุต = ูขูจ</span></p>
                                    <div class="steps-container space-y-4 min-h-[280px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 1: ุชุฌููุฒ ุงููุนุงุฏูุฉ</h4><p>ูุญู ุงููุนุงุฏูุฉ <span class="eq-1-color font-bold">ุงูุฃููู</span> ุจุงููุณุจุฉ ูู <span class="font-bold">ุณ</span>: <br><span class="math-eq eq-1-bg eq-1-color">ุณ = ูฆ - ูขุต</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุงูุชุนููุถ</h4><p>ูุนูุถ ุนู <span class="font-bold eq-1-color">ุณ</span> ูู ุงููุนุงุฏูุฉ <span class="eq-2-color font-bold">ุงูุซุงููุฉ</span>: <br><span class="math-eq eq-2-bg eq-2-color">ูฃ<span class="font-bold eq-1-color">(ูฆ - ูขุต)</span> - ูคุต = ูขูจ</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 3: ุญู ูุฅูุฌุงุฏ ุต</h4><p><span class="math-eq">ูกูจ - ูฆุต - ูคุต = ูขูจ</span><br><span class="math-eq">ูกูจ - ูกูุต = ูขูจ</span><br><span class="math-eq">-ูกูุต = ูกู</span><br><span class="math-eq">ุต = -ูก</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 4: ุฅูุฌุงุฏ ุณ</h4><p>ูุนูุถ <span class="math-eq">ุต = -ูก</span> ูู ุงููุนุงุฏูุฉ ุงููุฌูุฒุฉ: <br><span class="math-eq eq-1-bg eq-1-color">ุณ = ูฆ - ูข(-ูก) = ูจ</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุญู ุงูููุงุฆู</h4><p><span class="math-eq">(ูจ, -ูก)</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- ุงูุตู ุงูุซุงูู ูู ุงูุฃูุซูุฉ -->
                            <div class="grid md:grid-cols-2 gap-8">
                                <!-- ุงููุซุงู ุงูุซุงูุซ -->
                                <div id="interactive-container-3" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูฃ: ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู</p>
                                    <p class="mb-4">ุญู ุงููุธุงู ุงูุขุชู: <br><span class="math-eq eq-1-bg eq-1-color">ุต = ูขุณ - ูค</span><br><span class="math-eq eq-2-bg eq-2-color">ูฆุณ - ูฃุต = ูกูข</span></p>
                                    <div class="steps-container space-y-4 min-h-[200px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 1: ุงูุชุนููุถ</h4><p>ูุนูุถ ูููุฉ <span class="font-bold eq-1-color">ุต</span> ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ: <br><span class="math-eq eq-2-bg eq-2-color">ูฆุณ - ูฃ<span class="font-bold eq-1-color">(ูขุณ - ูค)</span> = ูกูข</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุชุจุณูุท ุงููุนุงุฏูุฉ</h4><p>ูุณุชุฎุฏู ุงูุชูุฒูุน: <span class="math-eq">ูฆุณ - ูฆุณ + ูกูข = ูกูข</span><br>ุซู ูุจุณุท: <span class="math-eq">ูกูข = ูกูข</span></p></div>
                                        <div class="step-interactive p-4 bg-yellow-100 rounded-lg step-box border-yellow-500"><h4 class="font-bold">ุงูุงุณุชูุชุงุฌ</h4><p>ุงูุนุจุงุฑุฉ <span class="math-eq">ูกูข = ูกูข</span> ุตุญูุญุฉ ุฏุงุฆูุงู. ุฅุฐูุ ููุฌุฏ <span class="font-bold">ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู</span>.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- ุงููุซุงู ุงูุฎุงูุณ (ุงูุฌุฏูุฏ) -->
                                <div id="interactive-container-5" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูฅ: ูุง ููุฌุฏ ุญู</p>
                                    <p class="mb-4">ุญู ุงููุธุงู ุงูุขุชู: <br><span class="math-eq eq-1-bg eq-1-color">ุต = ูขุณ + ูก</span><br><span class="math-eq eq-2-bg eq-2-color">ุต = ูขุณ - ูฅ</span></p>
                                    <div class="steps-container space-y-4 min-h-[200px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 1: ุงููุณุงูุงุฉ</h4><p>ุจูุง ุฃู ููุชุง ุงููุนุงุฏูุชูู ุชุณุงููุงู 'ุต'ุ ูุณุงููููุง ุจุจุนุถ.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ูุชุงุจุฉ ุงููุนุงุฏูุฉ</h4><p><span class="math-eq"><span class="eq-1-color">ูขุณ + ูก</span> = <span class="eq-2-color">ูขุณ - ูฅ</span></span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 3: ุชุจุณูุท ุงููุนุงุฏูุฉ</h4><p>ูุทุฑุญ <span class="math-eq">ูขุณ</span> ูู ุงูุทุฑููู. ููุชุฌ ูุฏููุง: <span class="math-eq">ูก = -ูฅ</span></p></div>
                                        <div class="step-interactive p-4 bg-red-100 rounded-lg step-box border-red-500"><h4 class="font-bold">ุงูุงุณุชูุชุงุฌ</h4><p>ุงูุนุจุงุฑุฉ <span class="math-eq">ูก = -ูฅ</span> ุฎุงุทุฆุฉ ุฏุงุฆูุงู. ุฅุฐูุ <span class="font-bold">ูุง ููุฌุฏ ุญู</span> ูููุธุงู (ุงูุฎุทุงู ูุชูุงุฒูุงู).</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="5" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="5" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="5" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- ุงูุตู ุงูุซุงูุซ ูู ุงูุฃูุซูุฉ -->
                            <div>
                                <!-- ุงููุซุงู ุงูุฑุงุจุน -->
                                <div id="interactive-container-4" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูค: ุชุทุจูู ููุฏุณู</p>
                                    <p class="mb-4">ุฅุฐุง ูุงู ูุฌููุน ููุงุณู ุงูุฒุงููุชูู ุณุ ุต ูุณุงูู <span class="highlight-number">ูกูจู</span> ุฏุฑุฌุฉ (ูุชูุงููุชุงู)ุ ูููุงุณ ุงูุฒุงููุฉ ุณ ูุฒูุฏ ุจููุฏุงุฑ <span class="highlight-number">ูขูค</span> ุฏุฑุฌุฉ ุนูู ููุงุณ ุงูุฒุงููุฉ ุต. ุฃูุฌุฏ ููุงุณ ูู ุฒุงููุฉ.</p>
                                    <div class="steps-container space-y-4 min-h-[200px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 1: ูุชุงุจุฉ ูุธุงู ุงููุนุงุฏูุงุช</h4><p>ูุชุฑุฌู ุงููุณุฃูุฉ ุฅูู ูุนุงุฏูุงุช:<br>ุงููุฌููุน ูกูจู: <span class="math-eq eq-1-bg eq-1-color">ุณ + ุต = ูกูจู</span><br>ุณ ูุฒูุฏ ุนู ุต: <span class="math-eq eq-2-bg eq-2-color">ุณ = ุต + ูขูค</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 2: ุงูุชุนููุถ</h4><p>ูุนูุถ ูููุฉ <span class="font-bold eq-2-color">ุณ</span> ูู ุงููุนุงุฏูุฉ ุงูุฃููู:<br><span class="math-eq eq-1-bg eq-1-color"><span class="font-bold eq-2-color">(ุต + ูขูค)</span> + ุต = ูกูจู</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 3: ุญู ูุฅูุฌุงุฏ ูููุฉ ุต</h4><p><span class="math-eq">ูขุต + ูขูค = ูกูจู</span><br><span class="math-eq">ูขุต = ูกูฅูฆ</span><br><span class="math-eq">ุต = ูงูจ</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ 4: ุฅูุฌุงุฏ ูููุฉ ุณ</h4><p>ูุนูุถ <span class="math-eq">ุต = ูงูจ</span> ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ: <br><span class="math-eq eq-2-bg eq-2-color">ุณ = ูงูจ + ูขูค = ูกููข</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุญู ุงูููุงุฆู</h4><p>ุงูุฒุงููุฉ ุณ = <span class="highlight-number">ูกููข</span>ยฐุ ุงูุฒุงููุฉ ุต = <span class="highlight-number">ูงูจ</span>ยฐ.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="4" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div>
                                            <button data-example="4" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                            <button data-example="4" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">โ๏ธ ุฑุงุจุนุงู: ุญุงู ุฏูุฑู! ุงุฎุชุจุฑ ูููู</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">ูุชูุฌุชู ุงูููุงุฆูุฉ</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">๐ก ุดุฑุญ ุงูุฅุฌุงุจุฉ</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <div id="smartExplanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full border-t-4 border-purple-500">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-purple-800">๐ง ุงูุญู ุงูุฐูู</h3>
                <button id="closeSmartModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="smartExplanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 

    //  =============  ุชุนุฏูู ุฌุฏูุฏ: ูุฑุงุกุฉ ุงููุนุฑูุงุช ูู ุงูุฑุงุจุท  =============
    const urlParams = new URLSearchParams(window.location.search);
    const studentIdFromUrl = urlParams.get('studentId');
    const classIdFromUrl = urlParams.get('classId');

    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    
    //  =============  ุชุนุฏูู ุฌุฏูุฏ: ุชุญุฏูุซ ุชุตููู ุงูุดุฑูุท ุงูุนููู  =============
    function buildHeader(studentData, lessonTitle = null) {
        const headerContainer = document.getElementById('main-header');
        if (!headerContainer) return;
        let titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle || ''}</h1></div>`;
        
        let userInfoHtml = '';
        if (studentData) {
            userInfoHtml = `<div class="text-right"><span class="font-semibold text-lg">ุฃููุงูุ ${studentData.name}</span><a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline block">&larr; ุงูุนูุฏุฉ ุฅูู ุงูููุฑุณ</a></div>`;
        } else {
            userInfoHtml = `<div class="text-right"><p class="text-lg text-gray-600">ุฒุงุฆุฑ</p><a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline block">&larr; ุงูุนูุฏุฉ ุฅูู ุงูููุฑุณ</a></div>`;
        }
        
        headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`;
    }

    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">ยฉ 2024 ุฌููุน ุงูุญููู ูุญููุธุฉ | ุชุตููู ูุชุทููุฑ: ุฃ. ุนุจุฏุงูุนุฒูุฒ ุฎุงูุฏ ุงูุนุจูุงู</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุชุงุญุฉ ููุฐุง ุงูุฏุฑุณ ุญุงููุงู.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `ุงููุญุงููุงุช ุงููุชุจููุฉ: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); const smartButtonHTML = q.smartExplanation ? `<button type="button" id="smart-explain-btn-${index}" class="hidden mt-2 text-xs text-purple-600 hover:underline font-semibold">๐ง ุงูุญู ุงูุฐูู</button>` : ''; return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div class="flex items-center space-x-4 space-x-reverse">${smartButtonHTML}<button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">ุงุนุฑู ููุงุฐุงุ</button></div></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">ุชุญูู ูู ุฅุฌุงุจุงุชู</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); if (q.smartExplanation) { const smartExplainBtn = document.getElementById(`smart-explain-btn-${index}`); if(smartExplainBtn) smartExplainBtn.addEventListener('click', () => showSmartExplanation(index)); } }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'ูุง ุชูุฌุฏ ูุญุงููุงุช ูุชุจููุฉ'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = 'โ ุฅุฌุงุจุฉ ุตุญูุญุฉ!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden'); if (q.smartExplanation) { document.getElementById(`smart-explain-btn-${index}`).classList.remove('hidden'); } }); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentIdFromUrl && classIdFromUrl) { saveGrade(lessonId, finalGrade); } else { document.getElementById('save-status').textContent = 'ูู ูุชู ุงูุญูุธ. ุจูุงูุงุช ุงูุทุงูุจ ุบูุฑ ููุฌูุฏุฉ ูู ุงูุฑุงุจุท.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    
    //  =============  ุชุนุฏูู ุฌุฏูุฏ: ุชุญุฏูุซ ุฏุงูุฉ ุญูุธ ุงูุฏุฑุฌุฉ  =============
    function saveGrade(lessonId, grade) {
        const saveStatus = document.getElementById('save-status');
        
        // ุงูุชุญูู ูู ูุฌูุฏ ุงููุนุฑูุงุช ูุจู ุงูุฅุฑุณุงู
        if (!studentIdFromUrl || !classIdFromUrl) {
            console.error("Student ID or Class ID is missing from the URL.");
            saveStatus.textContent = 'โ ุฎุทุฃ: ูุง ูููู ุญูุธ ูุชูุฌุชู. ุจูุงูุงุช ุงูุทุงูุจ ุฃู ุงููุตู ุบูุฑ ููุฌูุฏุฉ ูู ุงูุฑุงุจุท.';
            return;
        }

        saveStatus.textContent = 'ุฌุงุฑู ุญูุธ ูุชูุฌุชู...';
        const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentIdFromUrl}&classId=${classIdFromUrl}&lessonId=${lessonId}&grade=${grade}`;
        
        fetch(url)
            .then(res => res.json())
            .then(result => {
                if (result.status === 'success') {
                    saveStatus.textContent = 'โ ุชู ุญูุธ ูุชูุฌุชู ุจูุฌุงุญ!';
                    // ุชุญุฏูุซ ุจูุงูุงุช ุงููุญุงููุงุช ูู localStorage ุฅุฐุง ูุงู ุงูุทุงูุจ ูุณุฌูุงู
                    const studentData = getStudentFromStorage();
                    if (studentData && studentData.id === studentIdFromUrl) {
                        if (!studentData.lessons) studentData.lessons = {};
                        if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) {
                            studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 };
                        } else {
                            studentData.lessons[lessonId].attempts++;
                        }
                        localStorage.setItem('currentStudent', JSON.stringify(studentData));
                    }
                } else {
                    throw new Error(result.message);
                }
            })
            .catch(error => {
                saveStatus.textContent = 'โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุฏุฑุฌุฉ.';
                console.error("Save Grade Error:", error);
            });
    }

    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    function showSmartExplanation(questionIndex) { const modal = document.getElementById('smartExplanationModal'); const explanationText = document.getElementById('smartExplanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].smartExplanation) { explanationText.innerHTML = currentQuestions[questionIndex].smartExplanation; modal.classList.remove('hidden'); } }
    function closeSmartModal() { const modal = document.getElementById('smartExplanationModal'); if(modal) modal.classList.add('hidden'); }
    
    // =======================================================
    // ======== ุงููุญุชูู ุงููุฎุตุต ููุฏุฑุณ ูุจุฏุฃ ูู ููุง ========
    // =======================================================

    const LESSON_ID = 'c5_l2'; 
    
    function generateQuiz() {
        const questionBank = [
            {
                type: 'mcq',
                level: 'โญ',
                topic: 'substitution',
                text: 'ูุง ูู ุญู ุงููุธุงู ุงูุชุงููุ <br><span class="math-eq eq-1-bg eq-1-color">ุณ = ุต + ูฃ</span><br><span class="math-eq eq-2-bg eq-2-color">ูขุณ + ุต = ูฉ</span>',
                options: [
                    { display: '<span class="math-eq">(ูค, ูก)</span>', value: 'a' },
                    { display: '<span class="math-eq">(ูก, ูค)</span>', value: 'b' },
                    { display: '<span class="math-eq">(ูฃ, ู)</span>', value: 'c' },
                    { display: '<span class="math-eq">(ูฅ, ูข)</span>', value: 'd' }
                ],
                correct: 'a',
                explanation: '<strong>ุงูุฎุทูุฉ ูก:</strong> ุงููุนุงุฏูุฉ ุงูุฃููู <span class="math-eq eq-1-bg eq-1-color">ุณ = ุต + ูฃ</span> ุฌุงูุฒุฉ ููุชุนููุถ.<br><strong>ุงูุฎุทูุฉ ูข:</strong> ูุนูุถ ูููุฉ (ุณ) ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ: <span class="math-eq eq-2-bg eq-2-color">ูข<span class="eq-1-color font-bold">(ุต + ูฃ)</span> + ุต = ูฉ</span>.<br><strong>ุงูุฎุทูุฉ ูฃ:</strong> ูุญู ุงููุนุงุฏูุฉ: <span class="math-eq">ูขุต + ูฆ + ุต = ูฉ</span> โธ <span class="math-eq">ูฃุต = ูฃ</span> โธ <span class="math-eq">ุต = ูก</span>.<br><strong>ุงูุฎุทูุฉ ูค:</strong> ูุฌุฏ ูููุฉ ุณ: <span class="math-eq">ุณ = ูก + ูฃ = ูค</span>.<br><strong>ุงูุญู:</strong> <span class="math-eq">(ูค, ูก)</span>.',
                smartExplanation: 'ุงูุญู ุงูุฃุณุฑุน ูู ุชุฌุฑุจุฉ ุงูุฎูุงุฑุงุช. ููุจุฏุฃ ุจุงูุฎูุงุฑ (ุฃ) <span class="math-eq">(ูค, ูก)</span>.<br><strong>ุงููุนุงุฏูุฉ ุงูุฃููู:</strong> ูู <span class="highlight-number">ูค</span> = <span class="highlight-number">ูก</span> + <span class="highlight-number">ูฃ</span>ุ ูุนู.<br><strong>ุงููุนุงุฏูุฉ ุงูุซุงููุฉ:</strong> ูู <span class="highlight-number">ูข</span>(<span class="highlight-number">ูค</span>) + <span class="highlight-number">ูก</span> = <span class="highlight-number">ูฉ</span>ุ ูู <span class="highlight-number">ูจ</span> + <span class="highlight-number">ูก</span> = <span class="highlight-number">ูฉ</span>ุ ูุนู. ุจูุง ุฃูู ูุญูู ุงููุนุงุฏูุชููุ ููู ุงูุญู ุงูุตุญูุญ.'
            },
            {
                type: 'mcq',
                level: 'โญโญ',
                topic: 'solving_then_substitution',
                text: 'ูุญู ุงููุธุงู <span class="math-eq">ูขุณ + ุต = ูฅ</span> ู <span class="math-eq">ูฃุณ - ูขุต = ูค</span>ุ ูุง ูู ุฃูุถู ุฎุทูุฉ ุฃูููุ',
                options: [
                    { display: 'ุญู ุงููุนุงุฏูุฉ ุงูุฃููู ุจุงููุณุจุฉ ูู (ุต)', value: 'a' },
                    { display: 'ุญู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ ุจุงููุณุจุฉ ูู (ุณ)', value: 'b' },
                    { display: 'ุฌูุน ุงููุนุงุฏูุชูู', value: 'c' },
                    { display: 'ูุณูุฉ ุงููุนุงุฏูุฉ ุงูุซุงููุฉ ุนูู ูข', value: 'd' }
                ],
                correct: 'a',
                explanation: 'ุฃูุถู ุฎุทูุฉ ูู ุงูุจุญุซ ุนู ูุชุบูุฑ ูุนุงููู <span class="highlight-number">ูก</span> ุฃู <span class="highlight-number">-ูก</span>. ูู ุงููุนุงุฏูุฉ ุงูุฃููู <span class="math-eq">ูขุณ + ุต = ูฅ</span>ุ ูุนุงูู (ุต) ูู <span class="highlight-number">ูก</span>. ูุฐุงุ ุฃุณูู ุทุฑููุฉ ูู ุญููุง ูุชุตุจุญ <span class="math-eq">ุต = ูฅ - ูขุณ</span> ุซู ุงูุชุนููุถ.'
            },
            {
                type: 'mcq',
                level: 'โญโญ',
                topic: 'word_problem',
                text: 'ุงุดุชุฑู ุฎุงูุฏ ููููู ูุฏูุชุฑ ูุงุญุฏ ุจูุจูุบ <span class="highlight-number">ูกู</span> ุฑูุงูุงุช. ุฅุฐุง ูุงู ุซูู ุงูุฏูุชุฑ ูุฒูุฏ ุนู ุซูู ุงูููู ุจุฑูุงู ูุงุญุฏุ ููุง ุซูู ุงูููู ุงููุงุญุฏุ',
                options: [
                    { display: 'ูฃ ุฑูุงูุงุช', value: 'a' },
                    { display: 'ูค ุฑูุงูุงุช', value: 'b' },
                    { display: 'ูฅ ุฑูุงูุงุช', value: 'c' },
                    { display: 'ูข.ูฅ ุฑูุงู', value: 'd' }
                ],
                correct: 'a',
                explanation: 'ูููุฑุถ ุฃู ุณ ูู ุซูู ุงูููู ู ุต ูู ุซูู ุงูุฏูุชุฑ.<br><strong>ุงููุนุงุฏูุฉ ูก:</strong> <span class="math-eq">ูขุณ + ุต = ูกู</span><br><strong>ุงููุนุงุฏูุฉ ูข:</strong> <span class="math-eq">ุต = ุณ + ูก</span><br>ูุนูุถ (ุต) ูู ุงููุนุงุฏูุฉ ูข ูู ูก: <span class="math-eq">ูขุณ + (ุณ + ูก) = ูกู</span><br>ูุญู ุงููุนุงุฏูุฉ: <span class="math-eq">ูฃุณ + ูก = ูกู</span> โธ <span class="math-eq">ูฃุณ = ูฉ</span> โธ <span class="math-eq">ุณ = ูฃ</span>. ุฅุฐู ุซูู ุงูููู ูฃ ุฑูุงูุงุช.'
            },
            {
                type: 'mcq',
                level: 'โญโญโญ',
                topic: 'special_case_infinite',
                text: 'ูุงุฐุง ูุญุฏุซ ุนูุฏ ูุญุงููุฉ ุญู ุงููุธุงู ุงูุชุงููุ <br><span class="math-eq">ุต = ูฃุณ - ูข</span><br><span class="math-eq">ูฆุณ - ูขุต = ูค</span>',
                options: [
                    { display: 'ููุฌุฏ ุญู ูุญูุฏ', value: 'a' },
                    { display: 'ูุง ููุฌุฏ ุญู', value: 'b' },
                    { display: 'ููุฌุฏ ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู', value: 'c' },
                    { display: 'ุงูุญู ูู (ู,ู)', value: 'd' }
                ],
                correct: 'c',
                explanation: 'ูุนูุถ ูููุฉ (ุต) ูู ุงููุนุงุฏูุฉ ุงูุฃููู ูู ุงูุซุงููุฉ:<br><span class="math-eq">ูฆุณ - ูข(ูฃุณ - ูข) = ูค</span><br>ููุฒุน ุงูุถุฑุจ: <span class="math-eq">ูฆุณ - ูฆุณ + ูค = ูค</span><br>ูุจุณุท: <span class="math-eq">ูค = ูค</span>. ูุฐู ุนุจุงุฑุฉ ุตุญูุญุฉ ุฏุงุฆูุงูุ ููุง ูุนูู ุฃู ุงููุนุงุฏูุชูู ุชูุซูุงู ููุณ ุงูุฎุท ุงููุณุชููู. ูุฐููุ ููุฌุฏ ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู.',
                smartExplanation: 'ุจุฅุนุงุฏุฉ ุชุฑุชูุจ ุงููุนุงุฏูุฉ ุงูุซุงููุฉุ ุงูุณู ุนูู <span class="highlight-number">ูข</span>: <span class="math-eq">ูฃุณ - ุต = ูข</span>. ุซู ุงููู (ุต): <span class="math-eq">ูฃุณ - ูข = ุต</span>. ูุฐู ูู ููุณ ุงููุนุงุฏูุฉ ุงูุฃููู ุจุงูุถุจุท! ุฅุฐุง ูุงูุช ุงููุนุงุฏูุชุงู ูุชุทุงุจูุชููุ ูููุงู ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู.'
            },
            {
                type: 'mcq',
                level: 'โญ',
                topic: 'substitution',
                text: 'ุญู ุงููุธุงู: <span class="math-eq">ุต = ูฅ</span> ู <span class="math-eq">ูขุณ + ุต = ูกูฃ</span>',
                options: [
                    { display: '<span class="math-eq">(ูค, ูฅ)</span>', value: 'a' },
                    { display: '<span class="math-eq">(ูฅ, ูค)</span>', value: 'b' },
                    { display: '<span class="math-eq">(ูฉ, ูฅ)</span>', value: 'c' },
                    { display: '<span class="math-eq">(ูฅ, ูฃ)</span>', value: 'd' }
                ],
                correct: 'a',
                explanation: 'ูุฐุง ุฃุจุณุท ุฃููุงุน ุงูุชุนููุถ. ุจูุง ุฃู <span class="math-eq">ุต = ูฅ</span>ุ ูุนูุถ ูุฐู ุงููููุฉ ูุจุงุดุฑุฉ ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ: <span class="math-eq">ูขุณ + ูฅ = ูกูฃ</span>. ูุทุฑุญ <span class="highlight-number">ูฅ</span> ูู ุงูุทุฑููู: <span class="math-eq">ูขุณ = ูจ</span>. ููุณู ุนูู <span class="highlight-number">ูข</span>: <span class="math-eq">ุณ = ูค</span>. ุงูุญู ูู <span class="math-eq">(ูค, ูฅ)</span>.'
            },
            {
                type: 'mcq',
                level: 'โญ',
                topic: 'substitution',
                text: 'ุฅุฐุง ูุงู <span class="math-eq">ุต = -ูฃ</span>ุ ููุง ูู ุญู ุงููุธุงูุ<br><span class="math-eq">ุณ + ุต = ูก</span>',
                options: [
                    { display: '<span class="math-eq">(-ูข, -ูฃ)</span>', value: 'a' },
                    { display: '<span class="math-eq">(ูค, -ูฃ)</span>', value: 'b' },
                    { display: '<span class="math-eq">(-ูฃ, ูค)</span>', value: 'c' },
                    { display: '<span class="math-eq">(ูก, -ูฃ)</span>', value: 'd' }
                ],
                correct: 'b',
                explanation: 'ูุนูุถ <span class="math-eq">ุต = -ูฃ</span> ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ: <span class="math-eq">ุณ + (-ูฃ) = ูก</span>. ูุญู ุงููุนุงุฏูุฉุ ูุถูู <span class="highlight-number">ูฃ</span> ููุทุฑููู: <span class="math-eq">ุณ = ูก + ูฃ = ูค</span>. ุงูุญู ูู <span class="math-eq">(ูค, -ูฃ)</span>.'
            },
            {
                type: 'mcq',
                level: 'โญโญ',
                topic: 'solving_then_substitution',
                text: 'ูุง ูู ุญู ุงููุธุงู ุงูุชุงููุ<br><span class="math-eq">ุณ - ูขุต = ู</span><br><span class="math-eq">ูขุณ - ูฃุต = ูข</span>',
                options: [
                    { display: '<span class="math-eq">(ูค, ูข)</span>', value: 'a' },
                    { display: '<span class="math-eq">(ูข, ูก)</span>', value: 'b' },
                    { display: '<span class="math-eq">(ูฆ, ูฃ)</span>', value: 'c' },
                    { display: '<span class="math-eq">(-ูข, -ูก)</span>', value: 'd' }
                ],
                correct: 'a',
                explanation: 'ูู ุงููุนุงุฏูุฉ ุงูุฃูููุ ูุฌุฏ ุฃู <span class="math-eq">ุณ = ูขุต</span>. ูุนูุถ ูุฐุง ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ: <span class="math-eq">ูข(ูขุต) - ูฃุต = ูข</span>. ูุจุณุท: <span class="math-eq">ูคุต - ูฃุต = ูข</span>ุ ุฅุฐู <span class="math-eq">ุต = ูข</span>. ุงูุขู ูุฌุฏ ุณ: <span class="math-eq">ุณ = ูข(ูข) = ูค</span>. ุงูุญู ูู <span class="math-eq">(ูค, ูข)</span>.'
            },
            {
                type: 'mcq',
                level: 'โญโญโญ',
                topic: 'word_problem',
                text: 'ูุฌููุน ุนุฏุฏูู ูุณุงูู <span class="highlight-number">ูขู</span> ูุงููุฑู ุจููููุง <span class="highlight-number">ูค</span>. ูุง ููุง ุงูุนุฏุฏุงูุ',
                options: [
                    { display: 'ูกู ู ูกู', value: 'a' },
                    { display: 'ูกูฅ ู ูฅ', value: 'b' },
                    { display: 'ูกูข ู ูจ', value: 'c' },
                    { display: 'ูกูค ู ูฆ', value: 'd' }
                ],
                correct: 'c',
                explanation: 'ููุฑุถ ุงูุนุฏุฏูู ุณ ู ุต. <span class="math-eq">ุณ + ุต = ูขู</span> ู <span class="math-eq">ุณ - ุต = ูค</span>. ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ <span class="math-eq">ุณ = ูค + ุต</span>. ูุนูุถ ูู ุงูุฃููู: <span class="math-eq">(ูค + ุต) + ุต = ูขู</span>. ูุจุณุท: <span class="math-eq">ูค + ูขุต = ูขู</span> โธ <span class="math-eq">ูขุต = ูกูฆ</span> โธ <span class="math-eq">ุต = ูจ</span>. ูุฌุฏ ุณ: <span class="math-eq">ุณ = ูค + ูจ = ูกูข</span>. ุงูุนุฏุฏุงู ููุง ูกูข ู ูจ.',
                smartExplanation: 'ุงุจุญุซ ูู ุงูุฎูุงุฑุงุช ุนู ุนุฏุฏูู ูุฌููุนููุง <span class="highlight-number">ูขู</span> ูุงููุฑู ุจููููุง <span class="highlight-number">ูค</span>. ุงูุฎูุงุฑ (ุฌ): <span class="math-eq">ูกูข + ูจ = ูขู</span> (ุตุญูุญ)ุ ู <span class="math-eq">ูกูข - ูจ = ูค</span> (ุตุญูุญ). ุฅุฐู ูู ุงูุฌูุงุจ ุงูุตุญูุญ.'
            },
            {
                type: 'mcq',
                level: 'โญโญ',
                topic: 'special_case_no_solution',
                text: 'ูุง ูู ุญู ุงููุธุงู ุงูุชุงููุ<br><span class="math-eq">ุต = ูขุณ + ูก</span><br><span class="math-eq">ุต = ูขุณ - ูฅ</span>',
                options: [
                    { display: 'ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู', value: 'a' },
                    { display: 'ูุง ููุฌุฏ ุญู', value: 'b' },
                    { display: '<span class="math-eq">(ูก, -ูฃ)</span>', value: 'c' },
                    { display: '<span class="math-eq">(ู, ูก)</span>', value: 'd' }
                ],
                correct: 'b',
                explanation: 'ุจูุง ุฃู ุงูุทุฑู ุงูุฃููู ูู ููุชุง ุงููุนุงุฏูุชูู ูุณุงูู ุตุ ูููููุง ูุณุงูุงุชููุง ุจุจุนุถ: <span class="math-eq">ูขุณ + ูก = ูขุณ - ูฅ</span>. ุจุทุฑุญ <span class="math-eq">ูขุณ</span> ูู ุงูุทุฑูููุ ูุญุตู ุนูู <span class="math-eq">ูก = -ูฅ</span>. ูุฐู ุนุจุงุฑุฉ ุฎุงุทุฆุฉุ ููุง ูุนูู ุฃูู ูุง ููุฌุฏ ุญู ูููุธุงู.',
                smartExplanation: 'ูุงุญุธ ุฃู ุงููุนุงุฏูุชูู ูููุง ููุณ ุงูููู (<span class="highlight-number">ูข</span>) ูููู ููุทุน ุตุงุฏู ูุฎุชูู (<span class="highlight-number">ูก</span> ู <span class="highlight-number">-ูฅ</span>). ูุฐุง ูุนูู ุฃู ุงูุฎุทูู ูุชูุงุฒูุงู ููุง ูุชูุงุทุนุงู ุฃุจุฏุงูุ ูุจุงูุชุงูู ูุง ููุฌุฏ ุญู.'
            },
            {
                type: 'mcq',
                level: 'โญ',
                topic: 'substitution',
                text: 'ุฅุฐุง ูุงู <span class="math-eq">ุณ = -ุต</span>ุ ููุง ุญู ุงููุธุงูุ<br><span class="math-eq">ูฃุณ - ูขุต = -ูกู</span>',
                options: [
                    { display: '<span class="math-eq">(ูข, -ูข)</span>', value: 'a' },
                    { display: '<span class="math-eq">(-ูข, ูข)</span>', value: 'b' },
                    { display: '<span class="math-eq">(ูฅ, -ูฅ)</span>', value: 'c' },
                    { display: '<span class="math-eq">(-ูฅ, ูฅ)</span>', value: 'd' }
                ],
                correct: 'b',
                explanation: 'ูุนูุถ <span class="math-eq">ุณ = -ุต</span> ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ: <span class="math-eq">ูฃ(-ุต) - ูขุต = -ูกู</span>. ูุจุณุท: <span class="math-eq">-ูฃุต - ูขุต = -ูกู</span> โธ <span class="math-eq">-ูฅุต = -ูกู</span> โธ <span class="math-eq">ุต = ูข</span>. ูุฌุฏ ุณ: <span class="math-eq">ุณ = -(ูข) = -ูข</span>. ุงูุญู ูู <span class="math-eq">(-ูข, ูข)</span>.'
            },
            {
                type: 'mcq',
                level: 'โญโญ',
                topic: 'solving_then_substitution',
                text: 'ูุง ูู ุญู ุงููุธุงู ุงูุชุงููุ<br><span class="math-eq">ูฃุณ + ูขุต = ูกูข</span><br><span class="math-eq">ุณ - ุต = ูก</span>',
                options: [
                    { display: '<span class="math-eq">(ูข, ูก)</span>', value: 'a' },
                    { display: '<span class="math-eq">(ูค, ู)</span>', value: 'b' },
                    { display: '<span class="math-eq">(ูข.ูจ, ูก.ูจ)</span>', value: 'c' },
                    { display: '<span class="math-eq">(ูกูค/ูฅ, ูฉ/ูฅ)</span>', value: 'd' }
                ],
                correct: 'd',
                explanation: 'ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉุ <span class="math-eq">ุณ = ุต + ูก</span>. ูุนูุถ ูู ุงูุฃููู: <span class="math-eq">ูฃ(ุต + ูก) + ูขุต = ูกูข</span>. ูุจุณุท: <span class="math-eq">ูฃุต + ูฃ + ูขุต = ูกูข</span> โธ <span class="math-eq">ูฅุต = ูฉ</span> โธ <span class="math-eq">ุต = ูฉ/ูฅ</span>. ูุฌุฏ ุณ: <span class="math-eq">ุณ = ูฉ/ูฅ + ูก = ูฉ/ูฅ + ูฅ/ูฅ = ูกูค/ูฅ</span>. ุงูุญู ูู <span class="math-eq">(ูกูค/ูฅ, ูฉ/ูฅ)</span>.'
            },
            {
                type: 'mcq',
                level: 'โญโญโญ',
                topic: 'word_problem',
                text: 'ูุณุชุทูู ุทููู ูุฒูุฏ ุนู ุนุฑุถู ุจููุฏุงุฑ <span class="highlight-number">ูฅ</span> ุณู. ุฅุฐุง ูุงู ูุญูุทู <span class="highlight-number">ูฃูจ</span> ุณูุ ููุง ูู ุทูููุ',
                options: [
                    { display: 'ูง ุณู', value: 'a' },
                    { display: 'ูกูข ุณู', value: 'b' },
                    { display: 'ูกูค.ูฅ ุณู', value: 'c' },
                    { display: 'ูกูข.ูฅ ุณู', value: 'd' }
                ],
                correct: 'b',
                explanation: 'ููุฑุถ ุงูุทูู (ู) ูุงูุนุฑุถ (ุน). <span class="math-eq">ู = ุน + ูฅ</span>. ุงููุญูุท: <span class="math-eq">ูข(ู + ุน) = ูฃูจ</span>. ูุนูุถ (ู) ูู ูุนุงุฏูุฉ ุงููุญูุท: <span class="math-eq">ูข((ุน + ูฅ) + ุน) = ูฃูจ</span>. ูุจุณุท: <span class="math-eq">ูข(ูขุน + ูฅ) = ูฃูจ</span> โธ <span class="math-eq">ูคุน + ูกู = ูฃูจ</span> โธ <span class="math-eq">ูคุน = ูขูจ</span> โธ <span class="math-eq">ุน = ูง</span>. ูุฌุฏ ุงูุทูู: <span class="math-eq">ู = ูง + ูฅ = ูกูข</span>. ุงูุทูู ูู ูกูข ุณู.'
            }
        ];
        // Shuffle the bank and pick 5 questions
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        const questionCount = Math.min(shuffled.length, 5);
        return shuffled.slice(0, questionCount);
    }
    
    // =======================================================
    // ======== ูุง ุชุนุฏู ุฃู ุดูุก ุฃุณูู ูุฐุง ุงูุณุทุฑ ========
    // =======================================================

    document.addEventListener('DOMContentLoaded', () => {
        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            state[exampleId] = { currentIndex: -1, steps: container.querySelectorAll('.step-interactive'), placeholder: container.querySelector('.interactive-placeholder'), prevBtn: container.querySelector('.prev-btn'), nextBtn: container.querySelector('.next-btn'), resetBtn: container.querySelector('.reset-btn') };
            const resetExample = () => { state[exampleId].steps.forEach(step => step.classList.remove('active')); state[exampleId].currentIndex = -1; if (state[exampleId].placeholder) { state[exampleId].placeholder.classList.remove('hidden'); } updateButtons(); };
            const updateButtons = () => { const isFirstStep = state[exampleId].currentIndex <= -1; const isLastStep = state[exampleId].currentIndex >= state[exampleId].steps.length - 1; state[exampleId].prevBtn.disabled = isFirstStep; if (isLastStep) { state[exampleId].nextBtn.classList.add('hidden'); state[exampleId].resetBtn.classList.remove('hidden'); } else { state[exampleId].nextBtn.classList.remove('hidden'); state[exampleId].resetBtn.classList.add('hidden'); } };
            
            state[exampleId].nextBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex < state[exampleId].steps.length - 1) {
                    if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.add('hidden');
                    }
                    if (state[exampleId].currentIndex > -1) {
                       // Don't hide previous step, just activate the next one
                    }
                    state[exampleId].currentIndex++;
                    state[exampleId].steps[state[exampleId].currentIndex].classList.add('active');
                    updateButtons();
                }
            });
            state[exampleId].prevBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex > -1) {
                    state[exampleId].steps[state[exampleId].currentIndex].classList.remove('active');
                    state[exampleId].currentIndex--;
                     if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.remove('hidden');
                    }
                    updateButtons();
                }
            });

            if(state[exampleId].resetBtn) { state[exampleId].resetBtn.addEventListener('click', resetExample); }
            updateButtons();
        });

        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
        
        const closeSmartModalBtn = document.getElementById('closeSmartModalBtn');
        if(closeSmartModalBtn) closeSmartModalBtn.addEventListener('click', closeSmartModal);
    });
    </script>
</body>
</html>
