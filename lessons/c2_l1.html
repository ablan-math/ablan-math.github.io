<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุฏุฑุณ ูข-ูก: ุงูุนูุงูุงุช | ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; text-align: center;}
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        input[type="radio"]:disabled + .option-label { cursor: not-allowed; background-color: #f3f4f6; }
        input[type="radio"]:disabled:checked + .option-label { background-color: #dbeafe; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-change { color: #ef4444; font-weight: bold; }
        
        .math-eq {
            font-family: "Courier New", monospace;
            font-size: 1.2rem;
            font-weight: bold;
            color: #4338ca;
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            padding: 2px 8px;
            border-radius: 6px;
            display: inline-block;
            vertical-align: middle;
        }
        
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8 px-4">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">ุงูุฏุฑุณ ูข-ูก: ุงูุนูุงูุงุช</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; ุงูุนูุฏุฉ ุฅูู ุงูููุฑุณ</a>
                </header>
                
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ก ุฃููุงู: ุงูููููู ุงูุฃุณุงุณู</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                        <p>ูู ุงูุฑูุงุถูุงุชุ <span class="vocab-term">ุงูุนูุงูุฉ</span> ูู ุฃู ูุฌููุนุฉ ูู ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉ. ูููู ุชูุซูู ุงูุนูุงูุฉ ุจุนุฏุฉ ุทุฑู: ุฌุฏููุ ุชูุซูู ุจูุงููุ ุฃู ูุฎุทุท ุณููู.</p>
                        <p>ูู ุฒูุฌ ูุฑุชุจ ูุชููู ูู <span class="vocab-term">ุฅุญุฏุงุซู ุณููู</span> ู <span class="vocab-term">ุฅุญุฏุงุซู ุตุงุฏู</span>. ูุฌููุนุฉ ุงูุฅุญุฏุงุซูุงุช ุงูุณูููุฉ ุชุณูู <span class="vocab-term">ุงููุฌุงู</span>ุ ููุฌููุนุฉ ุงูุฅุญุฏุงุซูุงุช ุงูุตุงุฏูุฉ ุชุณูู <span class="vocab-term">ุงููุฏู</span>.</p>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ฏ ุซุงููุงู: ุฃูุซูุฉ ุชูุงุนููุฉ</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="flex flex-col space-y-8">
                            <!-- ุงููุซุงู ุงูุชูุงุนูู ุงูุฃูู (ุจุขููุฉ ุงูุนุฑุถ ุงูุชุฑุงููู) -->
                            <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4">ูุซุงู ูก: ูุซู ุงูุนูุงูุฉ <span class="math-eq">{ (ูขุ ูฅ)ุ (-ูขุ ูฃ)ุ (ูฅุ -ูข)ุ (-ูกุ -ูข) }</span></p>
                                
                                <div class="visuals-container min-h-[250px] flex justify-center items-start space-x-4 space-x-reverse">
                                    <div class="interactive-placeholder-1 text-center text-gray-500 p-4 w-full"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                    
                                    <div id="ex1-step0" class="hidden w-full md:w-1/3 p-2 transition-opacity duration-500">
                                        <h4 class="font-bold text-center mb-2">ูก. ุฌุฏูู</h4>
                                        <table class="w-full border text-center rounded-lg overflow-hidden"><thead class="bg-gray-200"><tr class="border-b"><th class="p-2">ุณ</th><th class="p-2">ุต</th></tr></thead><tbody><tr class="border-b"><td>ูข</td><td>ูฅ</td></tr><tr class="border-b"><td>-ูข</td><td>ูฃ</td></tr><tr class="border-b"><td>ูฅ</td><td>-ูข</td></tr><tr><td>-ูก</td><td>-ูข</td></tr></tbody></table>
                                    </div>
                                    <div id="ex1-step1" class="hidden w-full md:w-1/3 p-2 transition-opacity duration-500">
                                        <h4 class="font-bold text-center mb-2">ูข. ุชูุซูู ุจูุงูู</h4>
                                        <div class="p-2 bg-white border rounded-lg"><svg viewBox="-6 -6 12 12" class="w-full h-48"><g stroke="#e2e8f0" stroke-width="0.05"><path d="M -5 5 V -5 M -4 5 V -5 M -3 5 V -5 M -2 5 V -5 M -1 5 V -5 M 1 5 V -5 M 2 5 V -5 M 3 5 V -5 M 4 5 V -5 M 5 5 V -5" /><path d="M -5 5 H 5 M -5 4 H 5 M -5 3 H 5 M -5 2 H 5 M -5 1 H 5 M -5 -1 H 5 M -5 -2 H 5 M -5 -3 H 5 M -5 -4 H 5 M -5 -5 H 5" /></g><line x1="-5.5" y1="0" x2="5.5" y2="0" stroke="#a0aec0" stroke-width="0.1"/><line x1="0" y1="-5.5" x2="0" y2="5.5" stroke="#a0aec0" stroke-width="0.1"/><circle cx="2" cy="-5" r="0.2" fill="#ef4444"/><circle cx="-2" cy="-3" r="0.2" fill="#ef4444"/><circle cx="5" cy="2" r="0.2" fill="#ef4444"/><circle cx="-1" cy="2" r="0.2" fill="#ef4444"/></svg></div>
                                    </div>
                                    <div id="ex1-step2" class="hidden w-full md:w-1/3 p-2 transition-opacity duration-500">
                                        <h4 class="font-bold text-center mb-2">ูฃ. ูุฎุทุท ุณููู</h4>
                                        <div class="p-2 bg-white border rounded-lg"><svg viewBox="0 0 100 100" class="w-full h-48"><defs><marker id="arrow-new" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="4" markerHeight="4" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#3b82f6" /></marker></defs><rect x="5" y="5" width="30" height="90" rx="5" stroke="#60a5fa" fill="#eff6ff" /><text x="20" y="18" font-size="8" font-weight="bold" text-anchor="middle">ุงููุฌุงู</text><text x="20" y="35" font-size="8" text-anchor="middle">ูข</text><text x="20" y="50" font-size="8" text-anchor="middle">-ูข</text><text x="20" y="65" font-size="8" text-anchor="middle">ูฅ</text><text x="20" y="80" font-size="8" text-anchor="middle">-ูก</text><rect x="65" y="15" width="30" height="70" rx="5" stroke="#34d399" fill="#f0fdf4" /><text x="80" y="28" font-size="8" font-weight="bold" text-anchor="middle">ุงููุฏู</text><text x="80" y="45" font-size="8" text-anchor="middle">ูฅ</text><text x="80" y="60" font-size="8" text-anchor="middle">ูฃ</text><text x="80" y="75" font-size="8" text-anchor="middle">-ูข</text><path d="M 35 35 Q 50 40 65 45" stroke="#60a5fa" stroke-width="0.5" fill="none" marker-end="url(#arrow-new)" /><path d="M 35 50 Q 50 55 65 60" stroke="#60a5fa" stroke-width="0.5" fill="none" marker-end="url(#arrow-new)" /><path d="M 35 65 Q 50 70 65 75" stroke="#60a5fa" stroke-width="0.5" fill="none" marker-end="url(#arrow-new)" /><path d="M 35 80 Q 50 78 65 75" stroke="#60a5fa" stroke-width="0.5" fill="none" marker-end="url(#arrow-new)" /></svg></div>
                                    </div>
                                </div>
                                
                                <div id="ex1-step3" class="hidden p-4 mt-4 bg-green-100 rounded-lg step-box border-green-600 w-full transition-opacity duration-500">
                                    <h4 class="font-bold">ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ: ุชุญุฏูุฏ ุงููุฌุงู ูุงููุฏู</h4>
                                    <p><span class="vocab-term">ุงููุฌุงู</span> ูู ูุฌููุนุฉ ููู ุณ: <span class="math-eq">{ูขุ -ูขุ ูฅุ -ูก}</span></p><p class="mt-2"><span class="vocab-term">ุงููุฏู</span> ูู ูุฌููุนุฉ ููู ุต: <span class="math-eq">{ูฅุ ูฃุ -ูข}</span> (ุจุฏูู ุชูุฑุงุฑ)</p>
                                </div>
                                
                                <div class="flex justify-between mt-6">
                                    <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                    <div>
                                        <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                        <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                    </div>
                                </div>
                            </div>
                            <!-- ุงููุซุงู ุงูุชูุงุนูู ุงูุซุงูู (ุจุงูุขููุฉ ุงูุนุงุฏูุฉ) -->
                            <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4">ูุซุงู ูข: ุชุญููู ุงููุชุบูุฑุงุช (ุงููุณุชูู ูุงูุชุงุจุน)</p>
                                <div class="steps-container space-y-4 min-h-[200px] flex justify-center items-center">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box w-full"><h4 class="font-bold">ุงูุฎุทูุฉ ูก: ุงูุณููุงุฑูู</h4><p class="text-xl">ูุนูู ุฃุญูุฏ ูู ูุญู ุชุฌุงุฑู ููุชูุงุถู ุฃุฌุฑูุง ุนูู ูู ุณุงุนุฉ ุนูู.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box w-full"><h4 class="font-bold">ุงูุฎุทูุฉ ูข: ุชุญุฏูุฏ ุงููุชุบูุฑ ุงููุณุชูู</h4><p>ุงููุชุบูุฑ ุงูุฐู ูููู ุงูุชุญูู ููู ูู <span class="highlight-change">ุนุฏุฏ ุณุงุนุงุช ุงูุนูู</span>. ุฅุฐู ูู ุงููุชุบูุฑ ุงููุณุชูู.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box w-full"><h4 class="font-bold">ุงูุฎุทูุฉ ูฃ: ุชุญุฏูุฏ ุงููุชุบูุฑ ุงูุชุงุจุน</h4><p>ุงููุชุบูุฑ ุงูุฐู <span class="highlight-change">ูุนุชูุฏ</span> ุนูู ุนุฏุฏ ุณุงุนุงุช ุงูุนูู ูู <span class="highlight-change">ุงูุฃุฌุฑ ุงูุฅุฌูุงูู</span>. ุฅุฐู ูู ุงููุชุบูุฑ ุงูุชุงุจุน.</p></div>
                                    <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600 w-full"><h4 class="font-bold">ุงูุฎูุงุตุฉ</h4><p>ุงููุชุบูุฑ ุงููุณุชูู: ุนุฏุฏ ุณุงุนุงุช ุงูุนูู.<br>ุงููุชุบูุฑ ุงูุชุงุจุน: ุงูุฃุฌุฑ ุงูุฅุฌูุงูู.<br><small>(ูุฃู ุงูุฃุฌุฑ ุงูุฅุฌูุงูู ูุนุชูุฏ ุนูู ุนุฏุฏ ุงูุณุงุนุงุช ุงูุชู ุนูููุง ุฃุญูุฏ)</small></p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                    <div>
                                        <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                        <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">โ๏ธ ุฑุงุจุนุงู: ุญุงู ุฏูุฑู! ุงุฎุชุจุฑ ูููู</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">ูุชูุฌุชู ุงูููุงุฆูุฉ</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">๐ก ุดุฑุญ ุงูุฅุฌุงุจุฉ</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    // --- ุฏูุงู ูุดุชุฑูุฉ (ูุง ุชูู ุจุงูุชุนุฏูู) ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h1></a>`; } let userInfoHtml = ''; if (studentData) { userInfoHtml = `<div class="flex items-center gap-4"><span class="font-semibold">ุฃููุงูุ ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">ุฎุฑูุฌ</a></div>`; } else { userInfoHtml = `<p class="text-lg text-gray-600">ุฒุงุฆุฑ</p>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; const logoutLink = headerContainer.querySelector('#logout-link'); if(logoutLink) { logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); } }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">ยฉ 2024 ุฌููุน ุงูุญููู ูุญููุธุฉ | ุชุตููู ูุชุทููุฑ: ุฃ. ุนุจุฏุงูุนุฒูุฒ ุฎุงูุฏ ุงูุนุจูุงู</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุชุงุญุฉ ููุฐุง ุงูุฏุฑุณ ุญุงููุงู.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `ุงููุญุงููุงุช ุงููุชุจููุฉ: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${Math.max(0, attemptsLeft)}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); const questionText = q.graph ? `<div class="flex flex-col md:flex-row items-center gap-4"><div class="flex-1"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p></div><div class="flex-shrink-0 mx-auto">${q.graph}</div></div>` : `<p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p>`; return `<div class="p-4 border-2 border-gray-200 rounded-lg">${questionText}<div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold min-h-[20px]"></div><button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">ุงุนุฑู ููุงุฐุงุ</button></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">ุชุญูู ูู ุฅุฌุงุจุงุชู</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'ูุง ุชูุฌุฏ ูุญุงููุงุช ูุชุจููุฉ'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400', 'cursor-not-allowed'); } quizForm.onsubmit = (e) => { e.preventDefault(); const student = getStudentFromStorage(); let score = 0; questions.forEach((q, index) => { const radios = e.target.elements[`q${index}`]; const userAnswer = radios?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); radios.forEach(radio => radio.disabled = true); if (userAnswer === q.correct) { score++; feedbackEl.textContent = 'โ ุฅุฌุงุจุฉ ุตุญูุญุฉ!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden');}); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (student) { saveGrade(lessonId, finalGrade, student.id); const studentLessonData = student.lessons?.[lessonId] || { attempts: 0 }; const attemptsMade = studentLessonData.attempts; if (MAX_ATTEMPTS - (attemptsMade + 1) > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'ุชู ุนุฑุถ ูุชูุฌุชู. ุณุฌู ุงูุฏุฎูู ูุญูุธ ุชูุฏูู.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade, studentId) { const statusEl = document.getElementById('save-status'); statusEl.textContent = 'ุฌุงุฑู ุญูุธ ูุชูุฌุชู...'; const data = { action: 'saveGrade', studentId: studentId, lessonId: lessonId, grade: grade, timestamp: new Date().toISOString() }; fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data), headers: { 'Content-Type': 'text/plain;charset=utf-8' } }).then(() => { console.log('Grade submission sent.'); statusEl.textContent = `ุชู ุญูุธ ูุชูุฌุชู ุจูุฌุงุญ: ${grade} / 10`; statusEl.style.color = '#16a34a'; const student = getStudentFromStorage(); if (student) { if (!student.lessons) student.lessons = {}; const lessonData = student.lessons[lessonId] || { attempts: 0, highestGrade: -1 }; lessonData.attempts += 1; lessonData.highestGrade = Math.max(lessonData.highestGrade, grade); student.lessons[lessonId] = lessonData; localStorage.setItem('currentStudent', JSON.stringify(student)); } }).catch(error => { console.error('Network error while saving grade:', error); statusEl.textContent = 'ุญุฏุซ ุฎุทุฃ ูู ุงูุดุจูุฉ ุฃุซูุงุก ุญูุธ ุงููุชูุฌุฉ. ูุฑุฌู ุงูุชุญูู ูู ุงุชุตุงูู.'; statusEl.style.color = '#dc2626'; }); }
    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    
    // --- ูุญุชูู ุฎุงุต ุจุงูุฏุฑุณ (ูุชู ุชุนุฏููู ููู ุฏุฑุณ) ---
    const LESSON_ID = 'c2_l1'; 
    
    function generateQuiz() {
        const questionBank = [
            { type: 'mcq', level: 'โญ', topic: 'domain-range', text: 'ูุง ูู ูุฌุงู ุงูุนูุงูุฉ <span class="math-eq">{ (ูกุ ูข)ุ (ูฃุ ูค)ุ (ูกุ ูฅ) }</span>ุ', options: [ { display: '<span class="math-eq">{ูกุ ูฃ}</span>', value: '{1, 3}' }, { display: '<span class="math-eq">{ูขุ ูคุ ูฅ}</span>', value: '{2, 4, 5}' }, { display: '<span class="math-eq">{ูกุ ูขุ ูฃุ ูคุ ูฅ}</span>', value: '{1, 2, 3, 4, 5}' }, { display: '<span class="math-eq">{ูกุ ูฃุ ูก}</span>', value: '{1, 3, 1}' } ], correct: '{1, 3}', explanation: `<p class='mb-2'>ุงููุฌุงู ูู ูุฌููุนุฉ ูู ุงูุฅุญุฏุงุซูุงุช ุงูุณูููุฉ (ุงูุฃููู) ูู ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉุ ูุจุฏูู ุชูุฑุงุฑ.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉ: (<b>ูก</b>ุ ูข)ุ (<b>ูฃ</b>ุ ูค)ุ (<b>ูก</b>ุ ูฅ)<br>ุงููุฌุงู = {ูกุ ูฃ}</p>` },
            { type: 'mcq', level: 'โญ', topic: 'domain-range', text: 'ูุง ูู ูุฏู ุงูุนูุงูุฉ <span class="math-eq">{ (ูุ ู)ุ (-ูกุ ูข)ุ (ูกุ ูข) }</span>ุ', options: [ { display: '<span class="math-eq">{ูุ -ูกุ ูก}</span>', value: '{0, -1, 1}' }, { display: '<span class="math-eq">{ูุ ูขุ ูข}</span>', value: '{0, 2, 2}' }, { display: '<span class="math-eq">{ูุ ูข}</span>', value: '{0, 2}' }, { display: '<span class="math-eq">{ู}</span>', value: '{0}' } ], correct: '{0, 2}', explanation: `<p class='mb-2'>ุงููุฏู ูู ูุฌููุนุฉ ูู ุงูุฅุญุฏุงุซูุงุช ุงูุตุงุฏูุฉ (ุงูุซุงููุฉ) ูู ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉุ ูุจุฏูู ุชูุฑุงุฑ.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉ: (ูุ <b>ู</b>)ุ (-ูกุ <b>ูข</b>)ุ (ูกุ <b>ูข</b>)<br>ุงููุฏู = {ูุ ูข}</p>` },
            { type: 'mcq', level: 'โญโญ', topic: 'variables', text: 'ูู ุงูุนูุงูุฉ ุงูุชู ุชุฑุจุท ุนุฏุฏ ุณุงุนุงุช ุงูุฏุฑุงุณุฉ (ุณ) ุจุงูุฏุฑุฌุฉ ูู ุงูุงุฎุชุจุงุฑ (ุต)ุ ุฃู ูุชุบูุฑ ูู ุงูุชุงุจุนุ', options: [ { display: 'ุนุฏุฏ ุณุงุนุงุช ุงูุฏุฑุงุณุฉ', value: 's' }, { display: 'ุงูุฏุฑุฌุฉ ูู ุงูุงุฎุชุจุงุฑ', value: 'p' }, { display: 'ููุงููุง ูุณุชูู', value: 'both_ind' }, { display: 'ูุง ูููู ุงูุชุญุฏูุฏ', value: 'cannot' } ], correct: 'p', explanation: `<p class='mb-2'>ุงูุฏุฑุฌุฉ ุงูุชู ุชุญุตู ุนูููุง ูู ุงูุงุฎุชุจุงุฑ <strong class="text-green-600">ุชุนุชูุฏ</strong> ุนูู ุนุฏุฏ ุณุงุนุงุช ุฏุฑุงุณุชู. ูุฐููุ ุงูุฏุฑุฌุฉ (ุต) ูู ุงููุชุบูุฑ ุงูุชุงุจุน.</p>` },
            { type: 'mcq', level: 'โญโญ', topic: 'variables', text: 'ุชูููุฉ ุชุนุจุฆุฉ ุงููููุฏ ุชุนุชูุฏ ุนูู ุนุฏุฏ ุงููุชุฑุงุช ุงูุชู ุชุดุชุฑููุง. ุฃู ูุชุบูุฑ ูู ุงููุณุชููุ', options: [ { display: 'ุชูููุฉ ุงููููุฏ', value: 'cost' }, { display: 'ุนุฏุฏ ุงููุชุฑุงุช', value: 'liters' }, { display: 'ููุงููุง ุชุงุจุน', value: 'both_dep' }, { display: 'ููุน ุงูุณูุงุฑุฉ', value: 'car_type' } ], correct: 'liters', explanation: `<p class='mb-2'>ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ <strong class="text-green-600">ุชุนุชูุฏ</strong> ุนูู ุนุฏุฏ ุงููุชุฑุงุช. ุฃูุช ุชุฎุชุงุฑ ุนุฏุฏ ุงููุชุฑุงุช ุฃููุงู (ุงููุชุบูุฑ ุงููุณุชูู)ุ ูุจูุงุกู ุนููู ุชูุญุณุจ ุงูุชูููุฉ (ุงููุชุบูุฑ ุงูุชุงุจุน).</p>` },
            { type: 'graph_mcq', level: 'โญโญ', topic: 'domain-range', text: 'ูู ุงูุชูุซูู ุงูุจูุงูู ุงููุฌุงูุฑุ ูุง ูู <strong>ูุฌุงู</strong> ุงูุนูุงูุฉุ', graph: `<svg viewBox="-5 -5 10 10" class="w-48 h-48 bg-white border rounded-lg"><g stroke="#e2e8f0" stroke-width="0.05"><path d="M -4 4 V -4 M -3 4 V -4 M -2 4 V -4 M -1 4 V -4 M 1 4 V -4 M 2 4 V -4 M 3 4 V -4 M 4 4 V -4" /><path d="M -4 4 H 4 M -4 3 H 4 M -4 2 H 4 M -4 1 H 4 M -4 -1 H 4 M -4 -2 H 4 M -4 -3 H 4 M -4 -4 H 4" /></g><line x1="-4.5" y1="0" x2="4.5" y2="0" stroke="#a0aec0" stroke-width="0.1"/><line x1="0" y1="-4.5" x2="0" y2="4.5" stroke="#a0aec0" stroke-width="0.1"/><circle cx="-3" cy="-2" r="0.2" fill="#ef4444"/><circle cx="-1" cy="4" r="0.2" fill="#ef4444"/><circle cx="0" cy="-1" r="0.2" fill="#ef4444"/><circle cx="3" cy="-2" r="0.2" fill="#ef4444"/></svg>`, options: [ { display: '<span class="math-eq">{-ูฃ, -ูก, ู, ูฃ}</span>', value: '{-3, -1, 0, 3}' }, { display: '<span class="math-eq">{-ูข, -ูก, ูค}</span>', value: '{-2, -1, 4}' }, { display: '<span class="math-eq">{-ูค, -ูฃ, -ูก, ู, ูก, ูข, ูฃ}</span>', value: '{-4, -3, -1, 0, 1, 2, 3}' }, { display: '<span class="math-eq">{ูข, -ูค, ูก, ูข}</span>', value: '{2, -4, 1, 2}' } ], correct: '{-3, -1, 0, 3}', explanation: `<p class='mb-2'>ุงููุฌุงู ูู ูุฌููุนุฉ ููู <b>ุณ</b> ูุฌููุน ุงูููุงุท. ุจุงููุธุฑ ุฅูู ุงูุฑุณูุ ุงูููุงุท ูู (-ูฃ, -ูข)ุ (-ูก, ูค)ุ (ู, -ูก)ุ (ูฃ, -ูข). ุงูุฅุญุฏุงุซูุงุช ุงูุณูููุฉ ูู -ูฃุ -ูกุ ูุ ูฃ.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>ุงููุฌุงู = {-ูฃ, -ูก, ู, ูฃ}</p>` },
            { type: 'graph_mcq', level: 'โญโญ', topic: 'domain-range', text: 'ูู ุงูุชูุซูู ุงูุจูุงูู ุงููุฌุงูุฑุ ูุง ูู <strong>ูุฏู</strong> ุงูุนูุงูุฉุ', graph: `<svg viewBox="-5 -5 10 10" class="w-48 h-48 bg-white border rounded-lg"><g stroke="#e2e8f0" stroke-width="0.05"><path d="M -4 4 V -4 M -3 4 V -4 M -2 4 V -4 M -1 4 V -4 M 1 4 V -4 M 2 4 V -4 M 3 4 V -4 M 4 4 V -4" /><path d="M -4 4 H 4 M -4 3 H 4 M -4 2 H 4 M -4 1 H 4 M -4 -1 H 4 M -4 -2 H 4 M -4 -3 H 4 M -4 -4 H 4" /></g><line x1="-4.5" y1="0" x2="4.5" y2="0" stroke="#a0aec0" stroke-width="0.1"/><line x1="0" y1="-4.5" x2="0" y2="4.5" stroke="#a0aec0" stroke-width="0.1"/><circle cx="-4" cy="2" r="0.2" fill="#3b82f6"/><circle cx="-2" cy="-3" r="0.2" fill="#3b82f6"/><circle cx="1" cy="2" r="0.2" fill="#3b82f6"/><circle cx="4" cy="-1" r="0.2" fill="#3b82f6"/></svg>`, options: [ { display: '<span class="math-eq">{-ูฃ, -ูก, ูข}</span>', value: '{-3, -1, 2}' }, { display: '<span class="math-eq">{-ูค, -ูข, ูก, ูค}</span>', value: '{-4, -2, 1, 4}' }, { display: '<span class="math-eq">{ูข, -ูฃ, ูข, -ูก}</span>', value: '{2, -3, 2, -1}' }, { display: '<span class="math-eq">{-ูข, ูก, ูฃ}</span>', value: '{-2, 1, 3}' } ], correct: '{-3, -1, 2}', explanation: `<p class='mb-2'>ุงููุฏู ูู ูุฌููุนุฉ ููู <b>ุต</b> ูุฌููุน ุงูููุงุทุ ุจุฏูู ุชูุฑุงุฑ. ุจุงููุธุฑ ุฅูู ุงูุฑุณูุ ุงูููุงุท ูู (-ูค, ูข)ุ (-ูข, -ูฃ)ุ (ูก, ูข)ุ (ูค, -ูก). ุงูุฅุญุฏุงุซูุงุช ุงูุตุงุฏูุฉ ูู ูขุ -ูฃุ ูขุ -ูก.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>ุงููุฏู (ูุฑุชุจุงู ูุจุฏูู ุชูุฑุงุฑ) = {-ูฃ, -ูก, ูข}</p>` },
            { type: 'graph_mcq', level: 'โญโญโญ', topic: 'analysis', text: 'ูุตู ุงูุชูุซูู ุงูุจูุงูู ุงููุฌุงูุฑ ุฑุญูุฉ ุดุฎุต ูุง. ุฃู ูู ุงูุชุงูู ูู ุงููุตู ุงูุตุญูุญ ููุฑุญูุฉุ', graph: `<svg viewBox="0 0 100 100" class="w-48 h-48 bg-white border rounded-lg p-2"><polyline points="10,80 40,40 60,40 100,80" fill="none" stroke="#ef4444" stroke-width="3" /><text x="50" y="98" text-anchor="middle" font-size="8">ุงูุฒูู</text><text x="5" y="50" text-anchor="middle" font-size="8" transform="rotate(-90 5 50)">ุงููุณุงูุฉ ูู ุงูููุฒู</text><line x1="10" y1="0" x2="10" y2="90" stroke="black" stroke-width="1"/><line x1="10" y1="90" x2="100" y2="90" stroke="black" stroke-width="1"/></svg>`, options: [ { display: 'ุณุงุฑ ุงูุดุฎุต ูุจุชุนุฏุงู ุนู ุงูููุฒูุ ุซู ุชูููุ ุซู ุฃููู ุงูุณูุฑ ูุจุชุนุฏุงู.', value: 'away-stop-away' }, { display: 'ุณุงุฑ ุงูุดุฎุต ูุจุชุนุฏุงู ุนู ุงูููุฒูุ ุซู ุชููู ููุชุฑุฉุ ุซู ุนุงุฏ ุจุงุชุฌุงู ุงูููุฒู.', value: 'away-stop-back' },{ display: 'ูุงู ุงูุดุฎุต ุนุงุฆุฏุงู ููููุฒูุ ุซู ุชูููุ ุซู ุฃููู ุงูุนูุฏุฉ.', value: 'back-stop-back' },{ display: 'ุณุงุฑ ุงูุดุฎุต ูุจุชุนุฏุงู ุซู ุนุงุฏ ุฅูู ุงูููุฒู ูุจุงุดุฑุฉ.', value: 'away-back' } ], correct: 'away-stop-back', explanation: `<p class='mb-2'>ููุญูู ุงูุฑุณู ุงูุจูุงูู (ุงููุณุงูุฉ ูู ุงูููุฒู ููุงุจู ุงูุฒูู):</p><ul class='list-disc pr-4 space-y-1'><li><b>ุงูุฌุฒุก ุงูุฃูู (ูุงุฆู ููุฃุณูู):</b> ุงููุณุงูุฉ ูู ุงูููุฒู ุชููุ ููุง ูุนูู ุฃู ุงูุดุฎุต ููุชุฑุจ ูู ุงูููุฒู.</li><li><b>ุงูุฌุฒุก ุงูุซุงูู (ุฃููู):</b> ุงูุฒูู ููุฑ ูุงููุณุงูุฉ ุซุงุจุชุฉุ ููุง ูุนูู ุฃู ุงูุดุฎุต ูุฏ ุชููู.</li><li><b>ุงูุฌุฒุก ุงูุซุงูุซ (ูุงุฆู ููุฃุนูู):</b> ุงููุณุงูุฉ ูู ุงูููุฒู ุชุฒุฏุงุฏุ ููุง ูุนูู ุฃู ุงูุดุฎุต ูุจุชุนุฏ ุนู ุงูููุฒู.</li></ul><p class='mt-2 p-2 bg-green-100 rounded-md'>ุฅุฐูุงุ ุงููุตู ุงูุตุญูุญ ูู: ุงูุชุฑุจ ูู ุงูููุฒูุ ุชูููุ ุซู ุงุจุชุนุฏ.</p>` },
            { type: 'graph_mcq', level: 'โญโญโญ', topic: 'analysis', text: 'ููุซู ุงูุฑุณู ุงูุจูุงูู ุงููุฌุงูุฑ ูุณุชูู ุงููุงุก ูู ุฎุฒุงู ุฃุซูุงุก ููุฆู. ุฃู ูุตู ูู ุงูุตุญูุญุ', graph: `<svg viewBox="0 0 100 100" class="w-48 h-48 bg-white border rounded-lg p-2"><polyline points="10,90 40,60 60,60 90,10" fill="none" stroke="#0891b2" stroke-width="3" /><text x="50" y="98" text-anchor="middle" font-size="8">ุงูุฒูู</text><text x="5" y="50" text-anchor="middle" font-size="8" transform="rotate(-90 5 50)">ูุณุชูู ุงููุงุก</text><line x1="10" y1="0" x2="10" y2="90" stroke="black" stroke-width="1"/><line x1="10" y1="90" x2="100" y2="90" stroke="black" stroke-width="1"/></svg>`, options: [ { display: 'ุจุฏุฃ ุงูููุก ุซู ุชููู ุซู ุงุณุชูุฑ ุจููุณ ุงููุนุฏู.', value: 'fill-stop-fill' }, { display: 'ุจุฏุฃ ุงูููุก ุจุณุฑุนุฉุ ุซู ุฃุจุทุฃุ ุซู ุชููู.', value: 'fast-slow-stop' }, { display: 'ุจุฏุฃ ุงูููุก ุจูุนุฏู ุซุงุจุชุ ุซู ุชููู ููุชุฑุฉุ ุซู ุงุณุชูุฑ ุจูุนุฏู ุฃุณุฑุน.', value: 'fill-stop-faster' }, { display: 'ูุงู ุงูุฎุฒุงู ููุฑุบ ุซู ุงูุชูุฃ.', value: 'empty-fill' } ], correct: 'fill-stop-faster', explanation: `<p class='mb-2'>ููุญูู ุงูุฑุณู ุงูุจูุงูู:</p><ul class='list-disc pr-4 space-y-1'><li><b>ุงูุฌุฒุก ุงูุฃูู (ูุงุฆู ููุฃุนูู):</b> ูุณุชูู ุงููุงุก ูุฑุชูุน ุจูุนุฏู ุซุงุจุช.</li><li><b>ุงูุฌุฒุก ุงูุซุงูู (ุฃููู):</b> ููุฑ ุงูุฒูู ููุณุชูู ุงููุงุก ูุง ูุชุบูุฑุ ููุง ูุนูู ุฃู ุงูููุก ุชููู.</li><li><b>ุงูุฌุฒุก ุงูุซุงูุซ (ุฃูุซุฑ ุงูุญุฏุงุฑูุง):</b> ูุณุชูู ุงููุงุก ูุฑุชูุน ูุฑุฉ ุฃุฎุฑู ูููู ุจุดูู ุฃุณุฑุน ูู ุงููุฑุฉ ุงูุฃููู.</li></ul><p class='mt-2 p-2 bg-green-100 rounded-md'>ุฅุฐูุงุ ุงููุตู ุงูุตุญูุญ ูู: ุจุฏุฃ ุงูููุกุ ุซู ุชูููุ ุซู ุงุณุชูุฑ ุจูุนุฏู ุฃุณุฑุน.</p>` },
            { type: 'mcq', level: 'โญ', topic: 'domain-range', text: 'ูุง ูู ูุฏู ุงูุนูุงูุฉ <span class="math-eq">{ (ูฅุ -ูก)ุ (ูุ -ูก)ุ (ูขุ ูค) }</span>ุ', options: [ { display: '<span class="math-eq">{ูฅ, ู, ูข}</span>', value: '{5, 0, 2}' }, { display: '<span class="math-eq">{-ูก, ูค}</span>', value: '{-1, 4}' }, { display: '<span class="math-eq">{-ูก, -ูก, ูค}</span>', value: '{-1, -1, 4}' }, { display: '<span class="math-eq">{ูฅ, -ูก, ู, ูข, ูค}</span>', value: '{5, -1, 0, 2, 4}' } ], correct: '{-1, 4}', explanation: `<p class='mb-2'>ุงููุฏู ูู ูุฌููุนุฉ ูู ุงูุฅุญุฏุงุซูุงุช ุงูุตุงุฏูุฉ (ุงูุซุงููุฉ) ูู ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉุ ูุจุฏูู ุชูุฑุงุฑ.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉ: (ูฅุ <b>-ูก</b>)ุ (ูุ <b>-ูก</b>)ุ (ูขุ <b>ูค</b>)<br>ุงููุฏู = {-ูก, ูค}</p>` },
            { type: 'mcq', level: 'โญ', topic: 'domain-range', text: 'ูุง ูู ูุฌุงู ุงูุนูุงูุฉ <span class="math-eq">{ (-ูข, ู), (ูฃ, ูก), (ูค, ู) }</span>ุ', options: [ { display: '<span class="math-eq">{ู, ูก}</span>', value: '{0,1}' }, { display: '<span class="math-eq">{-ูข, ูฃ, ูค}</span>', value: '{-2,3,4}' }, { display: '<span class="math-eq">{ู, ูก, ู}</span>', value: '{0,1,0}' }, { display: '<span class="math-eq">{-ูข, ู, ูก, ูฃ, ูค}</span>', value: '{-2,0,1,3,4}' } ], correct: '{-2,3,4}', explanation: `<p class='mb-2'>ุงููุฌุงู ูู ูุฌููุนุฉ ูู ุงูุฅุญุฏุงุซูุงุช ุงูุณูููุฉ (ุงูุฃููู) ูู ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉ.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉ: (<b>-ูข</b>, ู), (<b>ูฃ</b>, ูก), (<b>ูค</b>, ู)<br>ุงููุฌุงู = {-ูข, ูฃ, ูค}</p>` },
            { type: 'mcq', level: 'โญโญ', topic: 'variables', text: 'ูููุง ุฒุงุฏ ุนุฏุฏ ุงูููุชุฌุงุช ุงููุจุงุนุฉุ ุฒุงุฏ ุงูุฑุจุญ. ุฃู ูุชุบูุฑ ูู ุงูุชุงุจุนุ', options: [ { display: 'ุนุฏุฏ ุงูููุชุฌุงุช', value: 'products' }, { display: 'ุงูุฑุจุญ', value: 'profit' }, { display: 'ุณุนุฑ ุงูููุชุฌ', value: 'price' }, { display: 'ูุง ูููู ุงูุชุญุฏูุฏ', value: 'cannot' } ], correct: 'profit', explanation: `<p class='mb-2'>ุงูุฑุจุญ <strong class="text-green-600">ูุนุชูุฏ</strong> ุนูู ุนุฏุฏ ุงูููุชุฌุงุช ุงูุชู ุชู ุจูุนูุง. ูุฐููุ ุงูุฑุจุญ ูู ุงููุชุบูุฑ ุงูุชุงุจุน.</p>` },
            { type: 'mcq', level: 'โญ', topic: 'domain-range', text: 'ูู ุงูุนูุงูุฉ <span class="math-eq">{ (ุฃ, ุจ), (ุฌ, ุฏ) }</span>ุ ูุง ูู ุงููุฌุงูุ', options: [ { display: '<span class="math-eq">{ุฃ, ุจ}</span>', value: '{a,b}' }, { display: '<span class="math-eq">{ุฌ, ุฏ}</span>', value: '{c,d}' }, { display: '<span class="math-eq">{ุฃ, ุฌ}</span>', value: '{a,c}' }, { display: '<span class="math-eq">{ุจ, ุฏ}</span>', value: '{b,d}' } ], correct: '{a,c}', explanation: `<p class='mb-2'>ุงููุฌุงู ูู ูุฌููุนุฉ ูู ุงูุฅุญุฏุงุซูุงุช ุงูุฃููู (ุงูุณูููุฉ) ูู ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉ.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>ุงููุฌุงู = {ุฃ, ุฌ}</p>` }
        ];
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        const questionCount = Math.min(shuffled.length, 5);
        return shuffled.slice(0, questionCount);
    }
    
    // --- ูุดุบู ุงูููุฏ (ูุง ุชูู ุจุงูุชุนุฏูู) ---
    document.addEventListener('DOMContentLoaded', () => {
        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            
            if (exampleId === '1') {
                // --- Logic for Cumulative Example 1 ---
                const state = {
                    currentIndex: -1,
                    steps: [
                        container.querySelector('#ex1-step0'),
                        container.querySelector('#ex1-step1'),
                        container.querySelector('#ex1-step2'),
                        container.querySelector('#ex1-step3')
                    ],
                    placeholder: container.querySelector('.interactive-placeholder-1'),
                    prevBtn: container.querySelector('.prev-btn'),
                    nextBtn: container.querySelector('.next-btn'),
                    resetBtn: container.querySelector('.reset-btn')
                };

                const updateEx1Buttons = () => {
                    const isFirstStep = state.currentIndex <= -1;
                    const isLastStep = state.currentIndex >= state.steps.length - 1;
                    state.prevBtn.disabled = isFirstStep;
                    if (isLastStep) {
                        state.nextBtn.classList.add('hidden');
                        state.resetBtn.classList.remove('hidden');
                    } else {
                        state.nextBtn.classList.remove('hidden');
                        state.resetBtn.classList.add('hidden');
                    }
                };

                const resetEx1 = () => {
                    state.steps.forEach(step => step.classList.add('hidden'));
                    if (state.placeholder) state.placeholder.classList.remove('hidden');
                    state.currentIndex = -1;
                    updateEx1Buttons();
                };

                state.nextBtn.addEventListener('click', () => {
                    if (state.currentIndex < state.steps.length - 1) {
                        if (state.currentIndex === -1 && state.placeholder) {
                            state.placeholder.classList.add('hidden');
                        }
                        state.currentIndex++;
                        if (state.steps[state.currentIndex]) {
                            state.steps[state.currentIndex].classList.remove('hidden');
                        }
                        updateEx1Buttons();
                    }
                });

                state.prevBtn.addEventListener('click', () => {
                    if (state.currentIndex > -1) {
                        if (state.steps[state.currentIndex]) {
                            state.steps[state.currentIndex].classList.add('hidden');
                        }
                        state.currentIndex--;
                        if (state.currentIndex === -1 && state.placeholder) {
                            state.placeholder.classList.remove('hidden');
                        }
                        updateEx1Buttons();
                    }
                });
                
                if (state.resetBtn) state.resetBtn.addEventListener('click', resetEx1);
                updateEx1Buttons();

            } else {
                // --- Logic for Sequential Examples (like Example 2) ---
                const state = { 
                    currentIndex: -1, 
                    steps: container.querySelectorAll('.step-interactive'), 
                    placeholder: container.querySelector('.interactive-placeholder'), 
                    prevBtn: container.querySelector('.prev-btn'), 
                    nextBtn: container.querySelector('.next-btn'), 
                    resetBtn: container.querySelector('.reset-btn') 
                };
                
                if (!state.steps.length || !state.prevBtn || !state.nextBtn) return;

                const updateButtons = () => {
                    const isFirstStep = state.currentIndex <= -1;
                    const isLastStep = state.currentIndex >= state.steps.length - 1;
                    state.prevBtn.disabled = isFirstStep;
                    if (isLastStep) {
                        state.nextBtn.classList.add('hidden');
                        if (state.resetBtn) state.resetBtn.classList.remove('hidden');
                    } else {
                        state.nextBtn.classList.remove('hidden');
                        if (state.resetBtn) state.resetBtn.classList.add('hidden');
                    }
                };

                const resetExample = () => {
                    state.steps.forEach(step => step.classList.remove('active'));
                    state.currentIndex = -1;
                    if (state.placeholder) state.placeholder.classList.remove('hidden');
                    updateButtons();
                };
                
                state.nextBtn.addEventListener('click', () => {
                    if (state.currentIndex < state.steps.length - 1) {
                        if (state.currentIndex === -1 && state.placeholder) {
                            state.placeholder.classList.add('hidden');
                        }
                        // Hide previous step for sequential display
                        if (state.currentIndex > -1) {
                            state.steps[state.currentIndex].classList.remove('active');
                        }
                        state.currentIndex++;
                        state.steps[state.currentIndex].classList.add('active');
                        updateButtons();
                    }
                });

                state.prevBtn.addEventListener('click', () => {
                    if (state.currentIndex > -1) {
                        state.steps[state.currentIndex].classList.remove('active');
                        state.currentIndex--;
                        if (state.currentIndex === -1 && state.placeholder) {
                            state.placeholder.classList.remove('hidden');
                        } else if (state.currentIndex > -1) {
                            state.steps[state.currentIndex].classList.add('active');
                        }
                        updateButtons();
                    }
                });

                if(state.resetBtn) state.resetBtn.addEventListener('click', resetExample);
                updateButtons();
            }
        });

        // --- Global Setup ---
        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        const closeModalBtn = document.getElementById('closeModalBtn');
        const explanationModal = document.getElementById('explanationModal');
        if(closeModalBtn) { closeModalBtn.addEventListener('click', closeModal); }
        if(explanationModal) { explanationModal.addEventListener('click', (e) => { if(e.target === explanationModal) closeModal(); }); }
    });
    </script>
</body>
</html>
