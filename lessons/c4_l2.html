<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¯Ø±Ø³ Ù¤-Ù¢: Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø§Øª Ø¨Ø§Ù„Ø¶Ø±Ø¨ ÙˆØ§Ù„Ù‚Ø³Ù…Ø© | Ù…Ù†ØµØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .vocab-term-alt { background-color: #dbeafe; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-number { background-color: #fef9c3; border: 1px solid #fde047; color: #b45309; font-weight: bold; padding: 0 5px; border-radius: 4px; }
        .math-eq { font-family: "Courier New", monospace; font-size: 1.1rem; font-weight: bold; color: #4338ca; background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 2px 8px; border-radius: 6px; display: inline-block; vertical-align: middle; }
        .math-eq .highlight-number { padding: 0; border: none; }
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
        .number-line-wrapper { margin-top: 1rem; padding: 1rem 0; }
        .number-line { position: relative; width: 100%; height: 2px; background-color: #374151; }
        .number-line::before, .number-line::after { content: ''; position: absolute; top: 50%; transform: translateY(-50%); width: 0; height: 0; border-style: solid; }
        .number-line::before { left: -1px; border-width: 6px 8px 6px 0; border-color: transparent #374151 transparent transparent; }
        .number-line::after { right: -1px; border-width: 6px 0 6px 8px; border-color: transparent transparent transparent #374151; }
        .ticks-container { position: relative; width: 100%; height: 2rem; }
        .tick { position: absolute; bottom: 0; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; font-size: 0.875rem; }
        .tick::before { content: ''; width: 2px; height: 8px; background-color: #374151; margin-bottom: 4px; }
        .solution-line { position: absolute; top: 50%; transform: translateY(-50%); height: 4px; background-color: #2563eb; }
        .solution-point { position: absolute; top: 50%; transform: translate(-50%, -50%); width: 12px; height: 12px; border-radius: 9999px; border: 2px solid #2563eb; }
        .solution-point.open { background-color: #fff; }
        .solution-point.closed { background-color: #2563eb; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">Ø§Ù„Ø¯Ø±Ø³ Ù¤-Ù¢: Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø§Øª Ø¨Ø§Ù„Ø¶Ø±Ø¨ ÙˆØ§Ù„Ù‚Ø³Ù…Ø©</h1>
                </header>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ’¡ Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">Ø§Ù„Ø¶Ø±Ø¨ Ø£Ùˆ Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ù…ÙˆØ¬Ø¨</h3>
                            <p class="text-center">Ø¹Ù†Ø¯ Ø¶Ø±Ø¨ Ø·Ø±ÙÙŠ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø£Ùˆ Ù‚Ø³Ù…ØªÙ‡Ù…Ø§ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ <span class="vocab-term">Ù…ÙˆØ¬Ø¨</span>ØŒ ÙŠØ¨Ù‚Ù‰ Ø§ØªØ¬Ø§Ù‡ Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <span class="vocab-term-alt">ÙƒÙ…Ø§ Ù‡Ùˆ</span>.</p>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-red-700 mb-2">Ø§Ù„Ø¶Ø±Ø¨ Ø£Ùˆ Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø³Ø§Ù„Ø¨</h3>
                            <p class="text-center">Ø¹Ù†Ø¯ Ø¶Ø±Ø¨ Ø·Ø±ÙÙŠ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø£Ùˆ Ù‚Ø³Ù…ØªÙ‡Ù…Ø§ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ <span class="vocab-term bg-red-100 text-red-800">Ø³Ø§Ù„Ø¨</span>ØŒ ÙŠØ¬Ø¨ <span class="vocab-term-alt bg-red-200 text-red-900">Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡</span> Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©.</p>
                             <div class="mt-4 p-4 bg-white rounded-lg border">
                                 <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-xl">
                                    <span class="math-eq">&lt;</span> ÙŠØµØ¨Ø­ <span class="math-eq">&gt;</span>
                                    <span class="mx-4 font-bold">Ùˆ</span>
                                    <span class="math-eq">â‰¥</span> ÙŠØµØ¨Ø­ <span class="math-eq">â‰¤</span>
                                 </p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ¯ Ø«Ø§Ù†ÙŠØ§Ù‹: Ø£Ù…Ø«Ù„Ø© ØªÙØ§Ø¹Ù„ÙŠØ©</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="flex flex-col space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <!-- Ø§Ù„Ù…Ø«Ø§Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ 1 -->
                                <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">Ù…Ø«Ø§Ù„ Ù¡: Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <span class="math-eq">Ù¨Ù† â‰¥ Ù¤Ù¨</span></p>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>Ø§Ø¶ØºØ· "Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ø¨Ø¯Ø¡ Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">Ø§Ù„Ø®Ø·ÙˆØ© Ù¡: Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ Ù¨</h4><p class="text-center"><span class="math-eq"><span class="fraction"><span>Ù¨Ù†</span><span class="frac-bar"></span><span class="highlight-number">Ù¨</span></span> â‰¥ <span class="fraction"><span>Ù¤Ù¨</span><span class="frac-bar"></span><span class="highlight-number">Ù¨</span></span></span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">Ø§Ù„Ø®Ø·ÙˆØ© Ù¢: Ø§Ù„ØªØ¨Ø³ÙŠØ·</h4><p class="text-center"><span class="math-eq">Ù† â‰¥ Ù¦</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">Ø§Ù„Ø®Ø·ÙˆØ© Ù£: Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø­Ù„</h4><p class="text-center"><span class="math-eq">{Ù† | Ù† â‰¥ Ù¦}</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">Ø§Ù„Ø®Ø·ÙˆØ© Ù¤: Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ</h4>
                                            <div class="number-line-wrapper">
                                                <div class="ticks-container">
                                                    <div class="tick" style="left: 20%;"><span>Ù¤</span></div>
                                                    <div class="tick" style="left: 40%;"><span>Ù¥</span></div>
                                                    <div class="tick" style="left: 60%;"><span>Ù¦</span></div>
                                                    <div class="tick" style="left: 80%;"><span>Ù§</span></div>
                                                    <div class="number-line">
                                                        <div class="solution-line" style="left: 60%; width: 40%;"></div>
                                                        <div class="solution-point closed" style="left: 60%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">Ø±Ø¬ÙˆØ¹</button>
                                        <div>
                                            <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                                            <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">Ø¥Ø¹Ø§Ø¯Ø©</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Ø§Ù„Ù…Ø«Ø§Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ 2 -->
                                <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                                    <p class="text-lg font-semibold mb-4">Ù…Ø«Ø§Ù„ Ù¢: Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <span class="math-eq">-Ù¥Ùƒ > Ù¢Ù¥</span></p>
                                    <div class="steps-container space-y-4 min-h-[250px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>Ø§Ø¶ØºØ· "Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ø¨Ø¯Ø¡ Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„</p></div>
                                        <div class="step-interactive p-4 bg-red-100 rounded-lg step-box border-red-500"><h4 class="font-bold text-red-800">Ø§Ù„Ø®Ø·ÙˆØ© Ù¡: Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ -Ù¥ (Ù†Ø¹ÙƒØ³ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©)</h4><p class="text-center"><span class="math-eq"><span class="fraction"><span>-Ù¥Ùƒ</span><span class="frac-bar"></span><span class="highlight-number">-Ù¥</span></span> < <span class="fraction"><span>Ù¢Ù¥</span><span class="frac-bar"></span><span class="highlight-number">-Ù¥</span></span></span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">Ø§Ù„Ø®Ø·ÙˆØ© Ù¢: Ø§Ù„ØªØ¨Ø³ÙŠØ·</h4><p class="text-center"><span class="math-eq">Ùƒ < -Ù¥</span></p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">Ø§Ù„Ø®Ø·ÙˆØ© Ù£: Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø­Ù„</h4><p class="text-center"><span class="math-eq">{Ùƒ | Ùƒ < -Ù¥}</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">Ø§Ù„Ø®Ø·ÙˆØ© Ù¤: Ø§Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ</h4>
                                            <div class="number-line-wrapper">
                                                <div class="ticks-container">
                                                    <div class="tick" style="left: 20%;"><span>-Ù§</span></div>
                                                    <div class="tick" style="left: 40%;"><span>-Ù¦</span></div>
                                                    <div class="tick" style="left: 60%;"><span>-Ù¥</span></div>
                                                    <div class="tick" style="left: 80%;"><span>-Ù¤</span></div>
                                                    <div class="number-line">
                                                        <div class="solution-line" style="left: 0%; width: 60%;"></div>
                                                        <div class="solution-point open" style="left: 60%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">Ø±Ø¬ÙˆØ¹</button>
                                        <div>
                                            <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                                            <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">Ø¥Ø¹Ø§Ø¯Ø©</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">âœï¸ Ø«Ø§Ù„Ø«Ø§Ù‹: Ø­Ø§Ù† Ø¯ÙˆØ±Ùƒ! Ø§Ø®ØªØ¨Ø± ÙÙ‡Ù…Ùƒ</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">Ù†ØªÙŠØ¬ØªÙƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>

    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">ğŸ’¡ Ø´Ø±Ø­ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <div id="smartExplanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full border-t-4 border-purple-500">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-purple-800">ğŸ§  Ø§Ù„Ø­Ù„ Ø§Ù„Ø°ÙƒÙŠ</h3>
                <button id="closeSmartModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="smartExplanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>

    <script>
    // --- 1. Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø¹Ø±Ù‘ÙØ§Øª Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ---
    const urlParams = new URLSearchParams(window.location.search);
    const studentId = urlParams.get('studentId');
    const classId = urlParams.get('classId');

    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 

    function getStudentFromStorage() { 
        const studentDataString = localStorage.getItem('currentStudent'); 
        if (studentDataString) { 
            try { 
                return JSON.parse(studentDataString); 
            } catch (e) { 
                return null; 
            } 
        } 
        return null; 
    }

    function buildHeader(studentData, lessonTitle = null) { 
        const headerContainer = document.getElementById('main-header'); 
        if (!headerContainer) return; 
        
        let titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">Ù…Ù†ØµØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</h1></a>`;
        if (lessonTitle) { 
            titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">Ù…Ù†ØµØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; 
        } 
        
        let userInfoHtml = ''; 
        if (studentData) { 
            userInfoHtml = `<div class="text-right">
                                <span class="font-semibold">Ø£Ù‡Ù„Ø§Ù‹ØŒ ${studentData.name}</span>
                                <a href="../index.html" target="_top" class="block text-sm text-blue-600 hover:underline">&larr; Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙÙ‡Ø±Ø³</a>
                           </div>`; 
        } else { 
            userInfoHtml = `<div class="text-right">
                                <p class="text-lg text-gray-600">Ø²Ø§Ø¦Ø±</p>
                                <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙÙ‡Ø±Ø³</a>
                           </div>`; 
        } 
        
        headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; 
    }
    
    function buildFooter() { 
        const footerContainer = document.getElementById('main-footer'); 
        if (!footerContainer) return; 
        footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">Â© 2024 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© | ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ±: Ø£. Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ø¨Ù„Ø§Ù†</p></div>`; 
    }

    function initializeQuiz(lessonId, questions, studentData) { 
        currentQuestions = questions; 
        const quizForm = document.getElementById('quizForm'); 
        if (!quizForm) return; 
        if (questions.length === 0) { 
            quizForm.innerHTML = `<p class="text-center text-gray-600">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>`; 
            return; 
        } 
        let attemptsLeft; 
        if (studentData) { 
            const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; 
            attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; 
        } else { 
            attemptsLeft = 1; 
        } 
        const attemptsCounter = document.getElementById('attempts-counter'); 
        if (attemptsCounter) { 
            attemptsCounter.innerHTML = `Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; 
        } 
        const quizHtml = questions.map((q, index) => { 
            const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); 
            const smartButtonHTML = q.smartExplanation ? `<button type="button" id="smart-explain-btn-${index}" class="hidden mt-2 text-xs text-purple-600 hover:underline font-semibold">ğŸ§  Ø§Ù„Ø­Ù„ Ø§Ù„Ø°ÙƒÙŠ</button>` : ''; 
            return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div class="flex items-center space-x-4 space-x-reverse">${smartButtonHTML}<button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">Ø§Ø¹Ø±Ù Ù„Ù…Ø§Ø°Ø§ØŸ</button></div></div>`; 
        }).join(''); 
        quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¬Ø§Ø¨Ø§ØªÙŠ</button>`; 
        questions.forEach((q, index) => { 
            const explainBtn = document.getElementById(`explain-btn-${index}`); 
            if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); 
            if (q.smartExplanation) { 
                const smartExplainBtn = document.getElementById(`smart-explain-btn-${index}`); 
                if(smartExplainBtn) smartExplainBtn.addEventListener('click', () => showSmartExplanation(index)); 
            } 
        }); 
        if (attemptsLeft <= 0) { 
            const submitBtn = quizForm.querySelector('#submit-quiz-btn'); 
            submitBtn.disabled = true; 
            submitBtn.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©'; 
            submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); 
        } 
        quizForm.onsubmit = (e) => { 
            e.preventDefault(); 
            let score = 0; 
            questions.forEach((q, index) => { 
                const userAnswer = e.target.elements[`q${index}`]?.value; 
                const feedbackEl = document.getElementById(`feedback-q${index}`); 
                if (userAnswer === q.correct) { 
                    score++; 
                    feedbackEl.textContent = 'âœ” Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!'; 
                    feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; 
                } else { 
                    feedbackEl.textContent = `âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©.`; 
                    feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; 
                } 
                document.getElementById(`explain-btn-${index}`).classList.remove('hidden'); 
                if (q.smartExplanation) { 
                    document.getElementById(`smart-explain-btn-${index}`).classList.remove('hidden'); 
                } 
            }); 
            const finalGrade = Math.round((score / questions.length) * 10); 
            const resultsDiv = document.getElementById('quiz-results'); 
            resultsDiv.classList.remove('hidden'); 
            document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; 
            
            if (studentId && classId) {
                saveGrade(LESSON_ID, finalGrade);
                if (studentData && (attemptsLeft - 1 > 0)) {
                    document.getElementById('retake-quiz-btn').classList.remove('hidden');
                }
            } else {
                document.getElementById('save-status').textContent = 'ØªÙ… Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬ØªÙƒ. Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø­ÙØ¸ ØªÙ‚Ø¯Ù…Ùƒ.';
            }
            
            e.target.querySelector('#submit-quiz-btn').disabled = true; 
        }; 
    }

    function saveGrade(lessonId, grade) {
        if (!studentId || !classId) {
            console.error("Student ID or Class ID is missing from the URL.");
            const saveStatus = document.getElementById('save-status');
            saveStatus.textContent = 'âŒ Ø®Ø·Ø£: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ Ù†ØªÙŠØ¬ØªÙƒ. Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø§Ù„ÙØµÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©.';
            return;
        }

        const saveStatus = document.getElementById('save-status');
        saveStatus.textContent = 'Ø¬Ø§Ø±Ù Ø­ÙØ¸ Ù†ØªÙŠØ¬ØªÙƒ...';
        
        const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&classId=${classId}&lessonId=${lessonId}&grade=${grade}`;
        
        fetch(url)
            .then(res => res.json())
            .then(result => {
                if (result.status === 'success') {
                    saveStatus.textContent = 'âœ” ØªÙ… Ø­ÙØ¸ Ù†ØªÙŠØ¬ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³ØªØ¸Ù‡Ø± ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø©.';
                    const studentData = getStudentFromStorage();
                    if (studentData) {
                        if (!studentData.lessons) studentData.lessons = {};
                        if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) {
                            studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 };
                        } else {
                            studentData.lessons[lessonId].attempts++;
                        }
                        localStorage.setItem('currentStudent', JSON.stringify(studentData));
                    }
                } else {
                    throw new Error(result.message);
                }
            })
            .catch(error => {
                saveStatus.textContent = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø©.';
                console.error("Save Grade Error:", error);
            });
    }

    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    function showSmartExplanation(questionIndex) { const modal = document.getElementById('smartExplanationModal'); const explanationText = document.getElementById('smartExplanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].smartExplanation) { explanationText.innerHTML = currentQuestions[questionIndex].smartExplanation; modal.classList.remove('hidden'); } }
    function closeSmartModal() { const modal = document.getElementById('smartExplanationModal'); if(modal) modal.classList.add('hidden'); }
    
    const LESSON_ID = 'c4_l2'; 
    
    function generateQuiz() { 
        const questionBank = [
            { type: 'mcq', level: 'â­', text: `Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <span class="math-eq">Ù§Øµ < -Ù¤Ù¢</span>`, options: [ { display: 'Øµ < -Ù¦', value: 'A' }, { display: 'Øµ > -Ù¦', value: 'B' }, { display: 'Øµ < Ù¦', value: 'C' }, { display: 'Øµ > Ù¦', value: 'D' } ], correct: 'A', explanation: `<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŒ Ù†Ù‚Ø³Ù… Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ <span class="highlight-number">Ù§</span>.</p><p>Ø¨Ù…Ø§ Ø£Ù† <span class="highlight-number">Ù§</span> Ø¹Ø¯Ø¯ Ù…ÙˆØ¬Ø¨ØŒ ÙØ¥Ù† Ø§ØªØ¬Ø§Ù‡ Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ù„Ø§ ÙŠØªØºÙŠØ±.</p><p><span class="math-eq"><span class="fraction"><span>Ù§Øµ</span><span class="frac-bar"></span><span>Ù§</span></span> < <span class="fraction"><span>-Ù¤Ù¢</span><span class="frac-bar"></span><span>Ù§</span></span></span></p><p>Ø§Ù„Ø­Ù„ Ù‡Ùˆ <span class="math-eq">Øµ < -Ù¦</span>.</p>`, },
            { type: 'mcq', level: 'â­â­', text: `Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <span class="math-eq"><span class="fraction"><span>Ø¨</span><span class="frac-bar"></span><span>-Ù¢</span></span> â‰¥ Ù¨</span>`, options: [ { display: 'Ø¨ â‰¥ -Ù¡Ù¦', value: 'A' }, { display: 'Ø¨ â‰¤ -Ù¤', value: 'B' }, { display: 'Ø¨ â‰¤ -Ù¡Ù¦', value: 'C' }, { display: 'Ø¨ â‰¥ -Ù¤', value: 'D' } ], correct: 'C', explanation: `<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŒ Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø·Ø±ÙÙŠÙ† ÙÙŠ <span class="highlight-number">-Ù¢</span>.</p><p>Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù†Ø¶Ø±Ø¨ ÙÙŠ Ø¹Ø¯Ø¯ Ø³Ø§Ù„Ø¨ØŒ <span class="text-red-600 font-bold">ÙŠØ¬Ø¨ Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡ Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©</span> Ù…Ù† â‰¥ Ø¥Ù„Ù‰ â‰¤.</p><p><span class="math-eq">Ø¨ â‰¥ Ù¨</span>  ->  <span class="math-eq">Ø¨ â‰¤ <span class="highlight-number">Ù¨</span> Ã— (<span class="highlight-number">-Ù¢</span>)</span></p><p>Ø§Ù„Ø­Ù„ Ù‡Ùˆ <span class="math-eq">Ø¨ â‰¤ -Ù¡Ù¦</span>.</p>`, smartExplanation: `<p>Ø¨Ù…Ø¬Ø±Ø¯ Ø£Ù† ØªØ±Ù‰ Ø£Ù†Ùƒ Ø³ØªØ¶Ø±Ø¨ Ø£Ùˆ ØªÙ‚Ø³Ù… Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø³Ø§Ù„Ø¨ØŒ Ø§Ø¹Ù„Ù… Ø£Ù† Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø³ØªÙØ¹ÙƒØ³. Ù‡Ø°Ø§ ÙŠÙ„ØºÙŠ Ø§Ù„Ø®ÙŠØ§Ø±ÙŠÙ† (Ø£) Ùˆ (Ø¯). Ø«Ù… Ø§Ø¶Ø±Ø¨ <span class="highlight-number">Ù¨</span> ÙÙŠ <span class="highlight-number">-Ù¢</span> Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ <span class="highlight-number">-Ù¡Ù¦</span>.</p>` },
            { type: 'mcq', level: 'â­', text: `Ø¹Ù†Ø¯ Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <span class="math-eq">-Ù¡Ù Ø£ â‰¤ Ù¡Ù Ù </span>ØŒ Ù…Ø§Ø°Ø§ Ù†ÙØ¹Ù„ Ø¨Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŸ`, options: [ { display: 'ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ', value: 'A' }, { display: 'Ù†Ø¹ÙƒØ³Ù‡Ø§', value: 'B' }, { display: 'Ù†Ø­Ø°ÙÙ‡Ø§', value: 'C' }, { display: 'Ù†ØºÙŠØ±Ù‡Ø§ Ø¥Ù„Ù‰ ÙŠØ³Ø§ÙˆÙŠ', value: 'D' } ], correct: 'B', explanation: `<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŒ Ø³Ù†Ù‚Ø³Ù… Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ <span class="highlight-number">-Ù¡Ù </span>.</p><p>Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© ØªÙ‚ÙˆÙ„: Ø¹Ù†Ø¯ Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø³Ø§Ù„Ø¨ØŒ ÙŠØ¬Ø¨ Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡ Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©.</p>`, },
            { type: 'mcq', level: 'â­â­', text: `Ù…Ø§ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªÙ…Ø«Ù„ Ø§Ù„Ø¬Ù…Ù„Ø© "Ù†Ø§ØªØ¬ Ù‚Ø³Ù…Ø© Ø¹Ø¯Ø¯ Ø¹Ù„Ù‰ <span class="highlight-number">Ù¥</span> Ø£ÙƒØ¨Ø± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ <span class="highlight-number">Ù£</span>"ØŸ`, options: [ { display: 'Ù¥Ù† â‰¥ Ù£', value: 'A' }, { display: 'Ù† - Ù¥ â‰¥ Ù£', value: 'B' }, { display: '<span class="math-eq"><span class="fraction"><span>Ù†</span><span class="frac-bar"></span><span>Ù¥</span></span> â‰¥ Ù£</span>', value: 'C' }, { display: '<span class="math-eq"><span class="fraction"><span>Ù†</span><span class="frac-bar"></span><span>Ù¥</span></span> â‰¤ Ù£</span>', value: 'D' } ], correct: 'C', explanation: `<p>"Ù‚Ø³Ù…Ø© Ø¹Ø¯Ø¯ (Ù†) Ø¹Ù„Ù‰ <span class="highlight-number">Ù¥</span>" ØªÙÙƒØªØ¨ <span class="math-eq"><span class="fraction"><span>Ù†</span><span class="frac-bar"></span><span>Ù¥</span></span></span>.</p><p>"Ø£ÙƒØ¨Ø± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ <span class="highlight-number">Ù£</span>" Ù‡ÙŠ Ø§Ù„Ø±Ù…Ø² <span class="math-eq">â‰¥</span>.</p><p>Ø¥Ø°Ù†ØŒ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ù‡ÙŠ <span class="math-eq"><span class="fraction"><span>Ù†</span><span class="frac-bar"></span><span>Ù¥</span></span> â‰¥ Ù£</span>.</p>` },
            { type: 'mcq', level: 'â­â­â­', text: `Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <span class="math-eq">-<span class="fraction"><span>Ù£</span><span class="frac-bar"></span><span>Ù¤</span></span>Ø¬Ù€ > Ù©</span>`, options: [ { display: 'Ø¬Ù€ > -Ù¡Ù¢', value: 'A' }, { display: 'Ø¬Ù€ < -Ù¡Ù¢', value: 'B' }, { display: 'Ø¬Ù€ > Ù¡Ù¢', value: 'C' }, { display: 'Ø¬Ù€ < Ù¡Ù¢', value: 'D' } ], correct: 'B', explanation: `<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŒ Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø·Ø±ÙÙŠÙ† ÙÙŠ Ù…Ù‚Ù„ÙˆØ¨ Ø§Ù„ÙƒØ³Ø± ÙˆÙ‡Ùˆ <span class="math-eq">-<span class="fraction"><span>Ù¤</span><span class="frac-bar"></span><span>Ù£</span></span></span>.</p><p>Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù†Ø¶Ø±Ø¨ ÙÙŠ Ø¹Ø¯Ø¯ Ø³Ø§Ù„Ø¨ØŒ <span class="text-red-600 font-bold">ÙŠØ¬Ø¨ Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©</span> Ù…Ù† > Ø¥Ù„Ù‰ <.</p><p><span class="math-eq">Ø¬Ù€ < <span class="highlight-number">Ù©</span> Ã— (-<span class="fraction"><span>Ù¤</span><span class="frac-bar"></span><span>Ù£</span></span>)</span></p><p><span class="math-eq">Ø¬Ù€ < -<span class="fraction"><span>Ù£Ù¦</span><span class="frac-bar"></span><span>Ù£</span></span></span></p><p>Ø§Ù„Ø­Ù„ Ù‡Ùˆ <span class="math-eq">Ø¬Ù€ < -Ù¡Ù¢</span>.</p>` },
            { type: 'mcq', level: 'â­', text: `Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <span class="math-eq">Ù¡Ù¢Ø³ â‰¤ Ù¦Ù </span>`, options: [ { display: 'Ø³ â‰¥ Ù¥', value: 'A' }, { display: 'Ø³ â‰¤ -Ù¥', value: 'B' }, { display: 'Ø³ â‰¤ Ù¥', value: 'C' }, { display: 'Ø³ â‰¥ -Ù¥', value: 'D' } ], correct: 'C', explanation: `<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŒ Ù†Ù‚Ø³Ù… Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ <span class="highlight-number">Ù¡Ù¢</span>.</p><p>Ø¨Ù…Ø§ Ø£Ù† <span class="highlight-number">Ù¡Ù¢</span> Ø¹Ø¯Ø¯ Ù…ÙˆØ¬Ø¨ØŒ ÙØ¥Ù† Ø§ØªØ¬Ø§Ù‡ Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ù„Ø§ ÙŠØªØºÙŠØ±.</p><p>Ø§Ù„Ø­Ù„ Ù‡Ùˆ <span class="math-eq">Ø³ â‰¤ Ù¥</span>.</p>`, },
            { type: 'mcq', level: 'â­â­', text: `Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <span class="math-eq"><span class="fraction"><span>Ù</span><span class="frac-bar"></span><span>-Ù¦</span></span> > Ù¤</span>`, options: [ { display: 'Ù > -Ù¢Ù¤', value: 'A' }, { display: 'Ù < -Ù¢Ù¤', value: 'B' }, { display: 'Ù > Ù¢Ù¤', value: 'C' }, { display: 'Ù < Ù¢Ù¤', value: 'D' } ], correct: 'B', explanation: `<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŒ Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø·Ø±ÙÙŠÙ† ÙÙŠ <span class="highlight-number">-Ù¦</span>.</p><p>Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù†Ø¶Ø±Ø¨ ÙÙŠ Ø¹Ø¯Ø¯ Ø³Ø§Ù„Ø¨ØŒ <span class="text-red-600 font-bold">ÙŠØ¬Ø¨ Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©</span> Ù…Ù† > Ø¥Ù„Ù‰ <.</p><p>Ø§Ù„Ø­Ù„ Ù‡Ùˆ <span class="math-eq">Ù < -Ù¢Ù¤</span>.</p>`, },
            { type: 'mcq', level: 'â­', text: `Ø£Ø±Ø¨Ø¹Ø© Ø£Ù…Ø«Ø§Ù„ Ø¹Ø¯Ø¯ Ù…Ø§ Ù‡Ùˆ Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙƒØ«Ø± <span class="highlight-number">Ù¢Ù </span>. Ø£ÙŠ Ù…ØªØ¨Ø§ÙŠÙ†Ø© ØªÙ…Ø«Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù…Ù„Ø©ØŸ`, options: [ { display: 'Ù¤Ù† > Ù¢Ù ', value: 'A' }, { display: 'Ù¤Ù† < Ù¢Ù ', value: 'B' }, { display: 'Ù¤Ù† â‰¥ Ù¢Ù ', value: 'C' }, { display: 'Ù¤Ù† â‰¤ Ù¢Ù ', value: 'D' } ], correct: 'D', explanation: `<p>"Ø£Ø±Ø¨Ø¹Ø© Ø£Ù…Ø«Ø§Ù„ Ø¹Ø¯Ø¯" ØªØ¹Ù†ÙŠ <span class="math-eq">Ù¤Ù†</span>.</p><p>Ø¹Ø¨Ø§Ø±Ø© "Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙƒØ«Ø±" ØªØ¹Ù†ÙŠ Ø£ØµØºØ± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ <span class="math-eq">â‰¤</span>.</p><p>Ø¥Ø°Ù†ØŒ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ù‡ÙŠ <span class="math-eq">Ù¤Ù† â‰¤ Ù¢Ù </span>.</p>`, },
            { type: 'mcq', level: 'â­â­', text: `Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <span class="math-eq"><span class="fraction"><span>Ù£</span><span class="frac-bar"></span><span>Ù§</span></span>Ø¯ < Ù¡Ù¥</span>`, options: [ { display: 'Ø¯ > Ù£Ù¥', value: 'A' }, { display: 'Ø¯ < Ù£Ù¥', value: 'B' }, { display: 'Ø¯ < Ù¢Ù¡', value: 'C' }, { display: 'Ø¯ > Ù¢Ù¡', value: 'D' } ], correct: 'B', explanation: `<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŒ Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø·Ø±ÙÙŠÙ† ÙÙŠ Ù…Ù‚Ù„ÙˆØ¨ Ø§Ù„ÙƒØ³Ø± ÙˆÙ‡Ùˆ <span class="math-eq"><span class="fraction"><span>Ù§</span><span class="frac-bar"></span><span>Ù£</span></span></span>.</p><p>Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„Ù…Ù‚Ù„ÙˆØ¨ Ø¹Ø¯Ø¯ Ù…ÙˆØ¬Ø¨ØŒ Ù„Ø§ Ù†Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©.</p><p><span class="math-eq">Ø¯ < <span class="highlight-number">Ù¡Ù¥</span> Ã— <span class="fraction"><span>Ù§</span><span class="frac-bar"></span><span>Ù£</span></span></span></p><p>Ø§Ù„Ø­Ù„ Ù‡Ùˆ <span class="math-eq">Ø¯ < Ù£Ù¥</span>.</p>`, },
            { type: 'mcq', level: 'â­â­â­', text: `Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <span class="math-eq">-<span class="fraction"><span>Ù¥</span><span class="frac-bar"></span><span>Ù¦</span></span>Ù… â‰¤ Ù¢Ù¥</span>`, options: [ { display: 'Ù… â‰¤ -Ù£Ù ', value: 'A' }, { display: 'Ù… â‰¥ -Ù£Ù ', value: 'B' }, { display: 'Ù… â‰¤ Ù£Ù ', value: 'C' }, { display: 'Ù… â‰¥ Ù£Ù ', value: 'D' } ], correct: 'B', explanation: `<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŒ Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø·Ø±ÙÙŠÙ† ÙÙŠ Ù…Ù‚Ù„ÙˆØ¨ Ø§Ù„ÙƒØ³Ø± ÙˆÙ‡Ùˆ <span class="math-eq">-<span class="fraction"><span>Ù¦</span><span class="frac-bar"></span><span>Ù¥</span></span></span>.</p><p>Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù†Ø¶Ø±Ø¨ ÙÙŠ Ø¹Ø¯Ø¯ Ø³Ø§Ù„Ø¨ØŒ <span class="text-red-600 font-bold">ÙŠØ¬Ø¨ Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©</span> Ù…Ù† â‰¤ Ø¥Ù„Ù‰ â‰¥.</p><p><span class="math-eq">Ù… â‰¥ <span class="highlight-number">Ù¢Ù¥</span> Ã— (-<span class="fraction"><span>Ù¦</span><span class="frac-bar"></span><span>Ù¥</span></span>)</span></p><p>Ø§Ù„Ø­Ù„ Ù‡Ùˆ <span class="math-eq">Ù… â‰¥ -Ù£Ù </span>.</p>`, },
            { type: 'mcq', level: 'â­â­â­', text: `Ø¥Ø°Ø§ ÙƒØ§Ù† Ø«Ù„Ø«Ø§ Ø¹Ø¯Ø¯ Ù…Ø§ Ø£Ù‚Ù„ Ù…Ù† <span class="highlight-number">-Ù¨</span>ØŒ ÙÙ…Ø§ Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŸ`, options: [ { display: 'Ø³ > -Ù¡Ù¢', value: 'A' }, { display: 'Ø³ < -Ù¢Ù¤', value: 'B' }, { display: 'Ø³ > -Ù¢Ù¤', value: 'C' }, { display: 'Ø³ < -Ù¡Ù¢', value: 'D' } ], correct: 'D', explanation: `<p>Ø£ÙˆÙ„Ø§Ù‹ØŒ Ù†ÙƒØªØ¨ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©: <span class="math-eq"><span class="fraction"><span>Ù¢</span><span class="frac-bar"></span><span>Ù£</span></span>Ø³ < -Ù¨</span>.</p><p>Ù„Ø­Ù„Ù‡Ø§ØŒ Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø·Ø±ÙÙŠÙ† ÙÙŠ Ù…Ù‚Ù„ÙˆØ¨ Ø§Ù„ÙƒØ³Ø± ÙˆÙ‡Ùˆ <span class="math-eq"><span class="fraction"><span>Ù£</span><span class="frac-bar"></span><span>Ù¢</span></span></span>.</p><p><span class="math-eq">Ø³ < <span class="highlight-number">-Ù¨</span> Ã— <span class="fraction"><span>Ù£</span><span class="frac-bar"></span><span>Ù¢</span></span></span></p><p>Ø§Ù„Ø­Ù„ Ù‡Ùˆ <span class="math-eq">Ø³ < -Ù¡Ù¢</span>.</p>`, },
            { type: 'mcq', level: 'â­â­', text: `Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <span class="math-eq">-Ù .Ù¥Øµ â‰¥ -Ù¡Ù </span>`, options: [ { display: 'Øµ â‰¥ Ù¢Ù ', value: 'A' }, { display: 'Øµ â‰¤ -Ù¢Ù ', value: 'B' }, { display: 'Øµ â‰¥ -Ù¢Ù ', value: 'C' }, { display: 'Øµ â‰¤ Ù¢Ù ', value: 'D' } ], correct: 'D', explanation: `<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŒ Ù†Ù‚Ø³Ù… Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ <span class="highlight-number">-Ù .Ù¥</span>.</p><p>Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù†Ù‚Ø³Ù… Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø³Ø§Ù„Ø¨ØŒ <span class="text-red-600 font-bold">ÙŠØ¬Ø¨ Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©</span> Ù…Ù† â‰¥ Ø¥Ù„Ù‰ â‰¤.</p><p>ØªØ°ÙƒØ± Ø£Ù† Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ <span class="highlight-number">-Ù .Ù¥</span> Ù‡ÙŠ Ù†ÙØ³Ù‡Ø§ Ø§Ù„Ø¶Ø±Ø¨ ÙÙŠ <span class="highlight-number">-Ù¢</span>.</p><p><span class="math-eq">Øµ â‰¤ <span class="highlight-number">-Ù¡Ù </span> Ã— (<span class="highlight-number">-Ù¢</span>)</span></p><p>Ø§Ù„Ø­Ù„ Ù‡Ùˆ <span class="math-eq">Øµ â‰¤ Ù¢Ù </span>.</p>` }
        ];
        
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        const questionCount = Math.min(shuffled.length, 5);
        return shuffled.slice(0, questionCount);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            state[exampleId] = { currentIndex: -1, steps: container.querySelectorAll('.step-interactive'), placeholder: container.querySelector('.interactive-placeholder'), prevBtn: container.querySelector('.prev-btn'), nextBtn: container.querySelector('.next-btn'), resetBtn: container.querySelector('.reset-btn') };
            const resetExample = () => { state[exampleId].steps.forEach(step => step.classList.remove('active')); state[exampleId].currentIndex = -1; if (state[exampleId].placeholder) { state[exampleId].placeholder.classList.remove('hidden'); } updateButtons(); };
            const updateButtons = () => { 
                const isFirstStep = state[exampleId].currentIndex <= -1; 
                const isLastStep = state[exampleId].currentIndex >= state[exampleId].steps.length - 1; 
                state[exampleId].prevBtn.disabled = isFirstStep; 
                if (isLastStep) { 
                    state[exampleId].nextBtn.classList.add('hidden'); 
                    state[exampleId].resetBtn.classList.remove('hidden'); 
                } else { 
                    state[exampleId].nextBtn.classList.remove('hidden'); 
                    state[exampleId].resetBtn.classList.add('hidden'); 
                } 
            };
            
            state[exampleId].nextBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex < state[exampleId].steps.length - 1) {
                    if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.add('hidden');
                    }
                    state[exampleId].currentIndex++;
                    state[exampleId].steps[state[exampleId].currentIndex].classList.add('active');
                    updateButtons();
                }
            });
            state[exampleId].prevBtn.addEventListener('click', () => {
                if (state[exampleId].currentIndex > -1) {
                    if(state[exampleId].steps[state[exampleId].currentIndex]) {
                       state[exampleId].steps[state[exampleId].currentIndex].classList.remove('active');
                    }
                    state[exampleId].currentIndex--;
                     if (state[exampleId].currentIndex === -1 && state[exampleId].placeholder) {
                        state[exampleId].placeholder.classList.remove('hidden');
                    }
                    updateButtons();
                }
            });

            if(state[exampleId].resetBtn) { state[exampleId].resetBtn.addEventListener('click', resetExample); }
            updateButtons();
        });

        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
        
        const closeSmartModalBtn = document.getElementById('closeSmartModalBtn');
        if(closeSmartModalBtn) closeSmartModalBtn.addEventListener('click', closeSmartModal);
    });
    </script>
</body>
</html>
