<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุฏุฑุณ ูฅ-ูฅ: ุชุทุจููุงุช ุนูู ุงููุธุงู ุงููููู ูู ูุนุงุฏูุชูู ุฎุทูุชูู | ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .math-eq { font-family: "Courier New", monospace; font-size: 1.2rem; font-weight: bold; padding: 4px 10px; border-radius: 6px; display: inline-block; vertical-align: middle; transition: all 0.3s ease-in-out; border: 1px solid; }
        .highlight-number {
            background-color: #fef9c3; /* yellow-100 */
            color: #b45309; /* amber-700 */
            padding: 1px 5px;
            border-radius: 4px;
            border: 1px solid #fde047; /* yellow-300 */
            font-weight: bold;
        }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback {
            padding: 10px;
            margin-top: 10px;
            border-radius: 8px;
            font-weight: bold;
            transition: opacity 0.5s ease-in-out;
        }
        .feedback.correct { background-color: #dcfce7; color: #16a34a; border-right: 4px solid #22c55e; }
        .feedback.incorrect { background-color: #fee2e2; color: #b91c1c; border-right: 4px solid #ef4444; }
        
        .eq-color-1 { color: #1d4ed8; background-color: #dbeafe; border-color: #93c5fd; } /* Blue */
        .eq-color-2 { color: #15803d; background-color: #dcfce7; border-color: #86efac; } /* Green */
        .eq-color-3 { color: #7e22ce; background-color: #f3e8ff; border-color: #d8b4fe; } /* Purple for new/modified */
        .final-answer-box { background-color: #fef9c3; border-color: #fde047; color: #b45309; }
        
        .part-1 { color: #1d4ed8; font-weight: bold; } /* Blue part */
        .part-2 { color: #15803d; font-weight: bold; } /* Green part */

        .step-box { 
            border-right: 4px solid #9333ea; 
            transition: opacity 0.5s, transform 0.5s;
            opacity: 1;
            transform: translateX(0);
        }
        .target-term {
            outline: 3px solid #ef4444; /* red-500 */
            box-shadow: 0 0 10px #f43f5e;
            border-radius: 4px;
            transition: all 0.3s ease-in-out;
        }
        .comment-box {
            min-height: 50px;
        }
        .sign-change {
            color: #dc2626; /* red-600 */
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-purple-800">ุงูุฏุฑุณ ูฅ-ูฅ: ุชุทุจููุงุช ุนูู ุงููุธุงู ุงููููู ูู ูุนุงุฏูุชูู ุฎุทูุชูู</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; ุงูุนูุฏุฉ ุฅูู ุงูููุฑุณ</a>
                </header>
                
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ก ุฃููุงู: ุชุญุฏูุฏ ุฃูุถู ุทุฑููุฉ ููุญู</h2>
                    <div class="p-4 bg-purple-50 rounded-lg space-y-3">
                        <p>ูุฃุญุฏ ุงูุชุทุจููุงุช ุงููุงูุฉุ ูุฌุจ ุชุญุฏูุฏ ุฃูุถู ุทุฑููุฉ ูุญู ุงููุธุงู. ุงูุฌุฏูู ุฃุฏูุงู ูุจูู ุฃูุถู ุญุงูุฉ ูุงุณุชุนูุงู ูู ุทุฑููุฉ:</p>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white rounded-lg shadow">
                                <thead class="bg-purple-600 text-white">
                                    <tr>
                                        <th class="text-right p-3">ุงูุทุฑููุฉ</th>
                                        <th class="text-right p-3">ุฃูุถู ุญุงูุฉ ูุงุณุชุนูุงููุง</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b"><td class="p-3 font-bold">ุงูุชูุซูู ุงูุจูุงูู</td><td class="p-3">ูุชูุฏูุฑ ุงูุญูููุ ูุงูุชูุซูู ุงูุจูุงูู ูุง ูุนุทู ูู ุงูุบุงูุจ ุญูุงู ุฏูููุงู.</td></tr>
                                    <tr class="border-b bg-gray-50"><td class="p-3 font-bold">ุงูุชุนููุถ</td><td class="p-3">ุฅุฐุง ูุงู ูุนุงูู ุฃุญุฏ ุงููุชุบูุฑูู ูู ุฅุญุฏู ุงููุนุงุฏูุชูู <span class="highlight-number">ูก</span> ุฃู <span class="highlight-number">-ูก</span>.</td></tr>
                                    <tr class="border-b"><td class="p-3 font-bold">ุงูุญุฐู ุจุงุณุชุนูุงู ุงูุฌูุน</td><td class="p-3">ุฅุฐุง ูุงู ูู ูู ูุนุงููู ุฃุญุฏ ุงููุชุบูุฑูู ูู ุงููุนุงุฏูุชูู ูุนููุณุงู ุฌูุนูุงู ููุขุฎุฑ.</td></tr>
                                    <tr class="border-b bg-gray-50"><td class="p-3 font-bold">ุงูุญุฐู ุจุงุณุชุนูุงู ุงูุทุฑุญ</td><td class="p-3">ุฅุฐุง ูุงู ูุนุงููุง ุฃุญุฏ ุงููุชุบูุฑูู ูู ุงููุนุงุฏูุชูู ูุชุณุงูููู.</td></tr>
                                    <tr class="bg-gray-50"><td class="p-3 font-bold">ุงูุญุฐู ุจุงุณุชุนูุงู ุงูุถุฑุจ</td><td class="p-3">ุฅุฐุง ูู ููู ุฃู ูู ุงููุนุงููุงุช (<span class="highlight-number">ูก</span>) ุฃู (<span class="highlight-number">-ูก</span>)ุ ูููุณ ูู ุงูุณูู ุงูุชุฎูุต ูู ุฃุญุฏ ุงููุชุบูุฑูู ุจุฌูุน ุงููุนุงุฏูุชูู ุฃู ุทุฑุญููุง.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ฏ ุซุงููุงู: ุงุฎุชุฑ ุงูุทุฑููุฉ ุงูุฃูุถู</h2>
                    <div id="interactive-choice-container" class="p-6 bg-gray-50 rounded-lg grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Interactive questions will be injected here by JavaScript -->
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ ุซุงูุซุงู: ุชุทุจููุงุช ูู ูุงูุน ุงูุญูุงุฉ</h2>
                    <div id="real-life-apps-container" class="space-y-8">
                        <!-- Real life examples injected here -->
                    </div>
                </section>
                
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">โ๏ธ ุฑุงุจุนุงู: ุญุงู ุฏูุฑู! ุงุฎุชุจุฑ ูููู</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">ูุชูุฌุชู ุงูููุงุฆูุฉ</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ</button>
                    </div>
                </section>

            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">๐ก ุดุฑุญ ุงูุฅุฌุงุจุฉ</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <div id="smartExplanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full border-t-4 border-purple-500">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-purple-800">๐ง ุงูุญู ุงูุฐูู</h3>
                <button id="closeSmartModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="smartExplanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    
    <script>
    // --- SCRIPT GENERAL ---
    // This function should be provided by the main platform to get student data
    // For standalone testing, it returns null.
    function getStudentFromStorage() {
        // In a real scenario, this would retrieve data from localStorage or another source.
        // const studentData = localStorage.getItem('currentStudent');
        // return studentData ? JSON.parse(studentData) : null;
        return null;
    }

    function buildHeader(studentData, lessonTitle = null) {
        const headerContainer = document.getElementById('main-header');
        if (!headerContainer) return;
        let titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-purple-800">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h1></a>`;
        if (lessonTitle) {
            titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h2><h1 class="text-xl font-bold text-purple-700 leading-tight">${lessonTitle}</h1></div>`;
        }
        // **FIX**: Display student name if available, otherwise show "Visitor"
        const studentName = studentData ? studentData.name : 'ุฒุงุฆุฑ';
        headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}<p class="text-lg text-gray-600">${studentName}</p></div>`;
    }
    function buildFooter() {
        const footerContainer = document.getElementById('main-footer');
        if (!footerContainer) return;
        footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">ยฉ 2024 ุฌููุน ุงูุญููู ูุญููุธุฉ | ุชุตููู ูุชุทููุฑ: ุฃ. ุนุจุฏุงูุนุฒูุฒ ุฎุงูุฏ ุงูุนุจูุงู</p></div>`;
    }
    function initializeQuiz(lessonId, questions, studentData) { 
        window.currentQuestions = questions; 
        const quizForm = document.getElementById('quizForm'); 
        if (!quizForm) return; 
        if (questions.length === 0) { 
            quizForm.innerHTML = `<p class="text-center text-gray-600">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุชุงุญุฉ ููุฐุง ุงูุฏุฑุณ ุญุงููุงู.</p>`; 
            return; 
        } 
        let attemptsLeft = 1; 
        const attemptsCounter = document.getElementById('attempts-counter'); 
        if (attemptsCounter) { 
            attemptsCounter.innerHTML = `ุงููุญุงููุงุช ุงููุชุจููุฉ: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; 
        } 
        
        questions.forEach(q => {
            q.correctAnswer = q.options.find(opt => opt.isCorrect).value;
        });

        const quizHtml = questions.map((q, index) => {
            const shuffledOptions = [...q.options].sort(() => 0.5 - Math.random());
            const optionsHTML = shuffledOptions.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); 
            const smartButtonHTML = q.smartExplanation ? `<button type="button" id="smart-explain-btn-${index}" class="hidden mt-2 text-xs text-purple-600 hover:underline font-semibold">๐ง ุงูุญู ุงูุฐูู</button>` : '';
            return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div class="flex items-center space-x-4 space-x-reverse">${smartButtonHTML}<button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">ุงุนุฑู ููุงุฐุงุ</button></div></div>`; 
        }).join(''); 
        
        quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">ุชุญูู ูู ุฅุฌุงุจุงุชู</button>`; 
        
        questions.forEach((q, index) => { 
            const explainBtn = document.getElementById(`explain-btn-${index}`); 
            if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); 
            if (q.smartExplanation) {
                const smartExplainBtn = document.getElementById(`smart-explain-btn-${index}`);
                if(smartExplainBtn) smartExplainBtn.addEventListener('click', () => showSmartExplanation(index));
            }
        }); 
        
        quizForm.onsubmit = (e) => { 
            e.preventDefault(); 
            let score = 0; 
            questions.forEach((q, index) => { 
                const userAnswer = e.target.elements[`q${index}`]?.value; 
                const feedbackEl = document.getElementById(`feedback-q${index}`); 
                if (userAnswer === q.correctAnswer) { 
                    score++; 
                    feedbackEl.textContent = 'โ ุฅุฌุงุจุฉ ุตุญูุญุฉ!'; 
                    feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; 
                } else { 
                    feedbackEl.textContent = `โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ.`; 
                    feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; 
                } 
                document.getElementById(`explain-btn-${index}`).classList.remove('hidden'); 
                if (q.smartExplanation) {
                    document.getElementById(`smart-explain-btn-${index}`).classList.remove('hidden');
                }
            }); 
            const finalGrade = Math.round((score / questions.length) * 10); 
            const resultsDiv = document.getElementById('quiz-results'); 
            resultsDiv.classList.remove('hidden'); 
            document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; 
            // **FIX**: Check if studentData exists before trying to save the grade
            if (studentData) {
                document.getElementById('save-status').textContent = 'ูุชู ุญูุธ ูุชูุฌุชู...';
                // This is where you would call the function to save the grade to the platform
                // saveGrade(lessonId, finalGrade, studentData.id); 
            } else {
                document.getElementById('save-status').textContent = 'ุชู ุนุฑุถ ูุชูุฌุชู. ุณุฌู ุงูุฏุฎูู ูุญูุธ ุชูุฏูู.';
            }
            e.target.querySelector('#submit-quiz-btn').disabled = true; 
        }; 
    }
    function showExplanation(questionIndex) { 
        const modal = document.getElementById('explanationModal'); 
        const explanationText = document.getElementById('explanationText'); 
        if(modal && explanationText && window.currentQuestions[questionIndex] && window.currentQuestions[questionIndex].explanation) { 
            explanationText.innerHTML = window.currentQuestions[questionIndex].explanation; 
            modal.classList.remove('hidden'); 
        } 
    }
    function closeModal() { 
        document.getElementById('explanationModal').classList.add('hidden'); 
    }
    function showSmartExplanation(questionIndex) {
        const modal = document.getElementById('smartExplanationModal');
        const explanationText = document.getElementById('smartExplanationText');
        if(modal && explanationText && window.currentQuestions[questionIndex] && window.currentQuestions[questionIndex].smartExplanation) {
            explanationText.innerHTML = window.currentQuestions[questionIndex].smartExplanation;
            modal.classList.remove('hidden');
        }
    }
    function closeSmartModal() {
        document.getElementById('smartExplanationModal').classList.add('hidden');
    }
    // --- END SCRIPT GENERAL ---

    document.addEventListener('DOMContentLoaded', () => {
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        
        // **FIX**: Call getStudentFromStorage to get student data
        const studentData = getStudentFromStorage();

        buildHeader(studentData, lessonTitle);
        buildFooter();
        
        const LESSON_ID = 'c5_l5';
        
        // --- Interactive Choice Section ---
        const interactiveQuestions = [
            { system: 'ุต = ูขุณ - ูก<br>ูฃุณ + ูขุต = ูขูฆ', options: ['ุงูุชุนููุถ', 'ุงูุญุฐู ุจุงูุฌูุน', 'ุงูุญุฐู ุจุงูุถุฑุจ'], correct: 'ุงูุชุนููุถ', reason: 'ูุฃู ุงููุนุงุฏูุฉ ุงูุฃููู ูุญูููุฉ ุจุงููุณุจุฉ ูููุชุบูุฑ (ุต)ุ ููุง ูุฌุนู ุงูุชุนููุถ ูุจุงุดุฑุฉู ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ ุณููุงู ุฌุฏุงู.' },
            { system: 'ูฅุณ - ูขุต = ูค<br>ูขุณ + ูขุต = ูกู', options: ['ุงูุชุนููุถ', 'ุงูุญุฐู ุจุงูุฌูุน', 'ุงูุญุฐู ุจุงูุทุฑุญ'], correct: 'ุงูุญุฐู ุจุงูุฌูุน', reason: 'ูุฃู ูุนุงููู ุงููุชุบูุฑ (ุต) ููุง <span class="highlight-number">-ูข</span> ู <span class="highlight-number">ูข</span>ุ ูููุง ูุนููุณุงู ุฌูุนูุงู ูุจุนุถููุงุ ููุง ูุณูุญ ุจุญุฐู (ุต) ูุจุงุดุฑุฉ ุนูุฏ ุฌูุน ุงููุนุงุฏูุชูู.' },
            { system: 'ูคุณ + ูฅุต = ูกูข<br>ูคุณ - ูฃุต = -ูค', options: ['ุงูุญุฐู ุจุงูุฌูุน', 'ุงูุญุฐู ุจุงูุทุฑุญ', 'ุงูุญุฐู ุจุงูุถุฑุจ'], correct: 'ุงูุญุฐู ุจุงูุทุฑุญ', reason: 'ูุฃู ูุนุงููู ุงููุชุบูุฑ (ุณ) ูุชุณุงููุงู (<span class="highlight-number">ูค</span>). ุทุฑุญ ุงููุนุงุฏูุชูู ูู ุจุนุถููุง ุณูุคุฏู ุฅูู ุญุฐู (ุณ) ูุจุงุดุฑุฉ.' },
            { system: 'ูขุณ + ูฃุต = ูง<br>ูฃุณ - ูคุต = ูข', options: ['ุงูุชูุซูู ุงูุจูุงูู', 'ุงูุชุนููุถ', 'ุงูุญุฐู ุจุงูุถุฑุจ'], correct: 'ุงูุญุฐู ุจุงูุถุฑุจ', reason: 'ูุฃู ูุง ููุฌุฏ ุฃู ูุนุงูู ูุณุงูู ูก ุฃู -ูก (ููุชุนููุถ)ุ ูุงููุนุงููุงุช ููุณุช ูุชุณุงููุฉ ุฃู ูุชุนุงูุณุฉ. ูุฐููุ ูุญุชุงุฌ ุฅูู ุถุฑุจ ุฅุญุฏู ุงููุนุงุฏูุชูู ุฃู ููุชูููุง ููุชููู ูู ุงูุญุฐู.' }
        ];

        const choiceContainer = document.getElementById('interactive-choice-container');
        interactiveQuestions.forEach((q, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'p-4 bg-white rounded-lg shadow flex flex-col';
            const systemHTML = `<div class="mb-4 p-3 bg-gray-100 rounded-lg text-center"><p class="font-semibold mb-2">ุญุฏุฏ ุฃูุถู ุทุฑููุฉ ูุญู ุงููุธุงู:</p><div class="inline-block text-left">${q.system.split('<br>').map((eq, i) => `<p class="math-eq eq-color-${i + 1}">${eq}</p>`).join('<br>')}</div></div>`;
            const optionsHTML = q.options.map(opt => `<button data-question="${index}" data-answer="${opt}" class="w-full text-center bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">${opt}</button>`).join('');
            questionDiv.innerHTML = `<div class="flex-grow">${systemHTML}<div class="grid grid-cols-1 gap-3">${optionsHTML.replace(/md:grid-cols-3/g, '')}</div></div><div id="feedback-interactive-${index}" class="feedback hidden mt-auto"></div>`;
            choiceContainer.appendChild(questionDiv);
        });

        choiceContainer.addEventListener('click', (e) => {
            if (e.target.matches('button[data-question]')) {
                const questionIndex = e.target.getAttribute('data-question');
                const userAnswer = e.target.getAttribute('data-answer');
                const question = interactiveQuestions[questionIndex];
                const feedbackEl = document.getElementById(`feedback-interactive-${questionIndex}`);
                const buttons = choiceContainer.querySelectorAll(`button[data-question="${questionIndex}"]`);
                buttons.forEach(btn => btn.disabled = true);
                if (userAnswer === question.correct) {
                    e.target.classList.replace('bg-blue-500', 'bg-green-500');
                    feedbackEl.innerHTML = `<strong>ุตุญูุญ!</strong> ${question.reason}`;
                    feedbackEl.className = 'feedback correct';
                } else {
                    e.target.classList.replace('bg-blue-500', 'bg-red-500');
                    const correctButton = choiceContainer.querySelector(`button[data-question="${questionIndex}"][data-answer="${question.correct}"]`);
                    correctButton.classList.replace('bg-blue-500', 'bg-green-500');
                    feedbackEl.innerHTML = `<strong>ุฎุทุฃ.</strong> ุงูุทุฑููุฉ ุงูุฃูุถู ูู <strong>${question.correct}</strong>. ${question.reason}`;
                    feedbackEl.className = 'feedback incorrect';
                }
                feedbackEl.classList.remove('hidden');
            }
        });
        
        // --- Real Life Apps Section ---
        const realLifeApps = [
            {
                id: 'shopping',
                title: '๐ ูุซุงู: ุงูุชุณูู',
                problem: 'ุงุดุชุฑู ุนุจุฏุงููู ูค ูุฑุงุณุงุช ู ูฃ ุญูุงุฆุจ ุจูุจูุบ ูกูจูก ุฑูุงูุงูุ ูุงุดุชุฑู ุนุจุฏุงูุฑุญูู ูุฑุงุณุฉ ูุญููุจุชูู ุจูุจูุบ ูฉูค ุฑูุงูุงู. ูุง ุซูู ูู ูู ุงููุฑุงุณุฉ ูุงูุญููุจุฉุ',
                totalSteps: 7
            },
            {
                id: 'recycling',
                title: 'โป๏ธ ูุซุงู: ุชุฏููุฑ',
                problem: 'ุฌูุน ูุญูุฏ ูฉ ูุฌู ุจูุงุณุชูู ู ูฃู ูุฌู ูุฑู ูุจุงุนูุง ุจูุจูุบ ูฃูฃ ุฑูุงูุงู. ูุฌูุน ุตุงูุญ ูฉ ูุฌู ุจูุงุณุชูู ู ูกูกูฅ ูุฌู ูุฑู ูุจุงุนูุง ุจูุจูุบ ูฅู ุฑูุงูุงู. ูุง ุณุนุฑ ุงูููููุฌุฑุงู ููู ูุงุฏุฉุ',
                totalSteps: 8 
            }
        ];

        const appsContainer = document.getElementById('real-life-apps-container');
        appsContainer.innerHTML = ''; // Clear previous content
        realLifeApps.forEach(app => {
            const appDiv = document.createElement('div');
            appDiv.className = 'p-6 bg-white rounded-lg shadow-lg';
            appDiv.innerHTML = `
                <h3 class="text-xl font-bold mb-3 text-purple-900">${app.title}</h3>
                <div class="mb-4 p-3 bg-purple-50 rounded-lg">
                    <p>${app.problem}</p>
                </div>
                <div id="solution-container-${app.id}" class="space-y-4 mt-4">
                    <!-- Steps will be dynamically inserted here -->
                </div>
                <div class="flex justify-between mt-6">
                    <button data-example="${app.id}" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                    <div>
                        <button data-example="${app.id}" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                        <button data-example="${app.id}" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                    </div>
                </div>
            `;
            appsContainer.appendChild(appDiv);
        });
        
        const examples = {};

        function updateButtons(exampleId, index) {
            const ex = examples[exampleId];
            ex.prevBtn.disabled = index <= -1;
            ex.nextBtn.classList.toggle('hidden', index >= ex.totalSteps);
            ex.resetBtn.classList.toggle('hidden', index < ex.totalSteps);
        }

        // --- Step Runner for Shopping Example ---
        window.runStep_shopping = (index) => {
            const container = examples.shopping.container;
            container.innerHTML = ''; 

            let eq1HTML = `<p class="math-eq eq-color-1">ูคู + ูฃุญ = ูกูจูก</p>`;
            let eq2HTML = `<p class="math-eq eq-color-2">ู + ูขุญ = ูฉูค</p>`;
            let commentHTML = `<div class="comment-box"></div>`;
            let solutionHTML = '';

            if (index >= 1) {
                eq2HTML = `<p class="math-eq eq-color-2 target-term">ู + ูขุญ = ูฉูค</p>`;
                commentHTML = `<div class="comment-box"><p class="text-purple-800 font-semibold">ุฃูุถู ุทุฑููุฉ ูู <b>ุงูุชุนููุถ</b> ูุฃู ูุนุงูู (ู) ูู ูก.</p></div>`;
            }
            if (index >= 2) {
                commentHTML = `<div class="comment-box"><p class="text-purple-800 font-semibold">ูุฌุนู ุงููุนุงุฏูุฉ ุจุฏูุงูุฉ (ู):</p></div>`;
            }
            if (index >= 3) {
                eq2HTML = `<p class="math-eq eq-color-3">ู = ูฉูค - ูขุญ</p>`;
                commentHTML = `<div class="comment-box"></div>`;
            }
            if (index >= 4) {
                 solutionHTML += `<div class="p-3 bg-gray-100 rounded-lg step-box mt-4"><p class="text-purple-800 font-semibold">ุงูุฎุทูุฉ ุงูุชุงููุฉ: ูุนูุถ ูููุฉ (ู) ูู ุงููุนุงุฏูุฉ ุงูุฃููู:</p><div class="text-center my-2"><div><p class="math-eq eq-color-1">ูค(<span class="part-2">ูฉูค - ูขุญ</span>) + ูฃุญ = ูกูจูก</p></div></div></div>`;
            }
            if (index >= 5) {
                solutionHTML += `<div class="p-3 bg-gray-100 rounded-lg step-box"><p class="text-purple-800 font-semibold">ูุญู ูุฅูุฌุงุฏ (ุญ):</p><div class="text-center my-2 flex flex-col items-center space-y-2"><div><p class="math-eq eq-color-3">ูฃูงูฆ - ูจุญ + ูฃุญ = ูกูจูก</p></div><div><p class="math-eq final-answer-box">-ูฅุญ = -ูกูฉูฅ โธ ุญ = ูฃูฉ</p></div></div></div>`;
            }
            if (index >= 6) {
                 solutionHTML += `<div class="p-3 bg-gray-100 rounded-lg step-box"><p class="text-purple-800 font-semibold">ุงูุขู ูุฌุฏ (ู):</p><div class="text-center my-2 flex flex-col items-center space-y-2"><div><p class="math-eq eq-color-2">ู = ูฉูค - ูข(<span class="part-1">ูฃูฉ</span>)</p></div><div><p class="math-eq final-answer-box">ู = ูกูฆ</p></div></div></div>`;
            }
            if (index >= 7) {
                solutionHTML += `<div class="p-3 bg-gray-100 rounded-lg step-box"><div class="mt-2 p-3 rounded-lg font-bold text-lg final-answer-box text-center">ุงูุญู: ุซูู ุงููุฑุงุณุฉ <span class="highlight-number">ูกูฆ</span> ุฑูุงูุงูุ ูุซูู ุงูุญููุจุฉ <span class="highlight-number">ูฃูฉ</span> ุฑูุงูุงู.</div></div>`;
            }

            if (index >= 0) {
                container.innerHTML = `
                    <div class="p-3 bg-gray-100 rounded-lg step-box">
                        <p class="text-purple-800 font-semibold">ูก. ูุญุฏุฏ ุงููุชุบูุฑุงุช ู ููุชุจ ุงููุนุงุฏูุงุช:</p>
                        <div class="my-3 text-center">
                            <p>ู = ุซูู ุงููุฑุงุณุฉุ ุญ = ุซูู ุงูุญููุจุฉ</p>
                            ${eq1HTML}<br>
                            <div class="flex items-center justify-center space-x-4 space-x-reverse mt-2">
                                ${eq2HTML}
                                ${commentHTML}
                            </div>
                        </div>
                    </div>
                    ${solutionHTML}
                `;
            } else {
                container.innerHTML = `<p class="text-center text-gray-500">ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p>`;
            }
            updateButtons('shopping', index);
        };

        // --- Step Runner for Recycling Example ---
        window.runStep_recycling = (index) => {
            const container = examples.recycling.container;
            container.innerHTML = '';

            let eq1HTML = `<p class="math-eq eq-color-1">ูฉุจ + ูฃูู = ูฃูฃ</p>`;
            let eq2HTML = `<p class="math-eq eq-color-2">ูฉุจ + ูกูกูฅู = ูฅู</p>`;
            let commentHTML = `<div class="comment-box"></div>`;
            let lineHTML = '';
            let resultHTML = '';
            let solutionHTML = '';
            
            if (index >= 1) {
                eq1HTML = `<p class="math-eq eq-color-1"><span class="target-term">ูฉุจ</span> + ูฃูู = ูฃูฃ</p>`;
                eq2HTML = `<p class="math-eq eq-color-2"><span class="target-term">ูฉุจ</span> + ูกูกูฅู = ูฅู</p>`;
                commentHTML = `<div class="comment-box"><p class="text-purple-800 font-semibold">ุฃูุถู ุทุฑููุฉ ูู <b class="text-red-600">ุงูุญุฐู ุจุงูุทุฑุญ</b> ูุฃู ูุนุงููู (ุจ) ูุชุณุงููุงู.</p></div>`;
            }
            if (index >= 2) {
                eq2HTML = `<div class="flex items-center space-x-2 space-x-reverse"><span class="text-red-600 font-bold text-2xl">ูู</span><p class="math-eq eq-color-2">ูฉุจ + ูกูกูฅู = ูฅู</p></div>`;
                commentHTML = `<div class="comment-box"></div>`;
            }
            if (index >= 3) {
                eq2HTML = `<p class="math-eq eq-color-3"><span class="sign-change">-</span>ูฉุจ <span class="sign-change">-</span> ูกูกูฅู = <span class="sign-change">-</span>ูฅู</p>`;
                lineHTML = `<div class="border-t-2 border-gray-700 my-2 w-full max-w-xs"></div>`;
            }
            if (index >= 4) {
                 resultHTML = `<div class="text-center my-2"><p class="math-eq eq-color-3">ูุจ - ูจูฅู = -ูกูง</p></div>`;
            }
            if (index >= 5) {
                resultHTML += `<div class="text-center my-2"><p class="math-eq eq-color-3">-ูจูฅู = -ูกูง</p></div>`;
            }
            if (index >= 6) {
                resultHTML += `<div class="text-center my-2"><p class="math-eq final-answer-box">ู = ู.ูข</p></div>`;
            }
            if (index >= 7) {
                solutionHTML += `<div class="p-3 bg-gray-100 rounded-lg step-box mt-4"><p class="text-purple-800 font-semibold">ูุนูุถ ูููุฉ (ู) ูู ุงููุนุงุฏูุฉ ุงูุฃููู ููุฌุฏ (ุจ):</p><div class="text-center my-2 flex flex-col items-center space-y-2"><div><p class="math-eq eq-color-1">ูฉุจ + ูฃู(<span class="part-2">ู.ูข</span>) = ูฃูฃ</p></div><div><p class="math-eq eq-color-3">ูฉุจ + ูฆ = ูฃูฃ โธ ูฉุจ = ูขูง</p></div><div><p class="math-eq final-answer-box">ุจ = ูฃ</p></div></div></div>`;
            }
            if (index >= 8) {
                solutionHTML += `<div class="p-3 bg-gray-100 rounded-lg step-box"><div class="mt-2 p-3 rounded-lg font-bold text-lg final-answer-box text-center">ุงูุญู: ุณุนุฑ ูุฌู ุงูุจูุงุณุชูู <span class="highlight-number">ูฃ</span> ุฑูุงูุงุชุ ูุณุนุฑ ูุฌู ุงููุฑู <span class="highlight-number">ู.ูข</span> ุฑูุงู (ูขู ูููุฉ).</div></div>`;
            }


            if (index >= 0) {
                 container.innerHTML = `
                    <div class="p-3 bg-gray-100 rounded-lg step-box">
                        <div class="my-3 text-center flex flex-col items-center space-y-2">
                            ${eq1HTML}
                            ${eq2HTML}
                            ${lineHTML}
                            ${resultHTML}
                        </div>
                        ${commentHTML}
                    </div>
                    ${solutionHTML}
                `;
            } else {
                 container.innerHTML = `<p class="text-center text-gray-500">ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p>`;
            }
            updateButtons('recycling', index);
        };

        realLifeApps.forEach(app => {
            examples[app.id] = {
                id: app.id,
                totalSteps: app.totalSteps,
                currentIndex: -1,
                container: document.getElementById(`solution-container-${app.id}`),
                nextBtn: document.querySelector(`button.next-btn[data-example="${app.id}"]`),
                prevBtn: document.querySelector(`button.prev-btn[data-example="${app.id}"]`),
                resetBtn: document.querySelector(`button.reset-btn[data-example="${app.id}"]`),
            };
            
            const ex = examples[app.id];
            ex.nextBtn.addEventListener('click', () => {
                if (ex.currentIndex < ex.totalSteps) { ex.currentIndex++; window[`runStep_${ex.id}`](ex.currentIndex); }
            });
            ex.prevBtn.addEventListener('click', () => {
                if (ex.currentIndex > -1) { ex.currentIndex--; window[`runStep_${ex.id}`](ex.currentIndex); }
            });
            ex.resetBtn.addEventListener('click', () => {
                ex.currentIndex = -1; window[`runStep_${ex.id}`](ex.currentIndex);
            });
            window[`runStep_${ex.id}`](-1); // Initial call
        });


        // --- Quiz Section ---
        const quizQuestions = generateQuiz();
        initializeQuiz(LESSON_ID, quizQuestions, studentData); // **FIX**: Pass studentData to the quiz
        
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        document.getElementById('closeModalBtn').addEventListener('click', closeModal);
        document.getElementById('closeSmartModalBtn').addEventListener('click', closeSmartModal);
    });

    function generateQuiz() {
        const questionBank = [
            { level: 'โญ', text: 'ูุง ูู ุฃูุถู ุทุฑููุฉ ูุญู ุงููุธุงู ุงูุชุงููุ<br><span class="math-eq">ุณ = ูคุต + ูง</span><br><span class="math-eq">ูขุณ - ูฃุต = ูฉ</span>', options: [ { display: 'ุงูุชูุซูู ุงูุจูุงูู', value: 'a' }, { display: 'ุงูุชุนููุถ', value: 'b', isCorrect: true }, { display: 'ุงูุญุฐู ุจุงูุฌูุน', value: 'c' }, { display: 'ุงูุญุฐู ุจุงูุถุฑุจ', value: 'd' } ], explanation: 'ุงูุชุนููุถ ูู ุงูุฃูุถู ูุฃู ุงููุนุงุฏูุฉ ุงูุฃููู ูุนุทุงุฉ ุจุฏูุงูุฉ (ุณ)ุ ููุง ูุณูู ุชุนููุถูุง ูุจุงุดุฑุฉ ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ.' },
            { level: 'โญ', text: 'ุญุฏุฏ ุงูุทุฑููุฉ ุงูุฃูุณุจ ูุญู ุงููุธุงู:<br><span class="math-eq">ูคุณ + ูขุต = ูกูค</span><br><span class="math-eq">ูฆุณ - ูขุต = ูฆ</span>', options: [ { display: 'ุงูุชุนููุถ', value: 'a' }, { display: 'ุงูุญุฐู ุจุงูุทุฑุญ', value: 'b' }, { display: 'ุงูุญุฐู ุจุงูุฌูุน', value: 'c', isCorrect: true }, { display: 'ุงูุญุฐู ุจุงูุถุฑุจ', value: 'd' } ], explanation: 'ุงูุญุฐู ุจุงูุฌูุน ูู ุงูุฃูุณุจ ูุฃู ูุนุงููู ุงููุชุบูุฑ (ุต) (+ูข ู -ูข) ููุง ูุนููุณุงู ุฌูุนูุงู ูุจุนุถููุง.' },
            { level: 'โญ', text: 'ูุง ุงูุทุฑููุฉ ุงูุชู ุณุชุณุชุฎุฏููุง ูุญู ุงููุธุงู:<br><span class="math-eq">ุต = ูฃุณ - ูฅ</span><br><span class="math-eq">ุต = -ูขุณ + ูกูฅ</span>', options: [ { display: 'ุงูุชุนููุถ ุฃู ุงูุชูุซูู ุงูุจูุงูู', value: 'a', isCorrect: true }, { display: 'ุงูุญุฐู ุจุงูุฌูุน', value: 'b' }, { display: 'ุงูุญุฐู ุจุงูุทุฑุญ', value: 'c' }, { display: 'ุงูุญุฐู ุจุงูุถุฑุจ', value: 'd' } ], explanation: 'ุจูุง ุฃู ููุชุง ุงููุนุงุฏูุชูู ูุญูููุชุงู ุจุงููุณุจุฉ ูู(ุต)ุ ูุงูุชุนููุถ (ุจูุณุงูุงุฉ ุงููุนุงุฏูุชูู: ูฃุณ - ูฅ = -ูขุณ + ูกูฅ) ูู ุฎูุงุฑ ููุชุงุฒ. ูุฐููุ ุตูุบุฉ ุงูููู ูุงูููุทุน ุชุฌุนู ุงูุชูุซูู ุงูุจูุงูู ุณููุงู ูุชูุฏูุฑ ุงูุญู.' },
            { level: 'โญโญ', text: 'ูุญู ุงููุธุงู: <span class="math-eq">ูฅุณ + ูฃุต = ูกูก</span> ู <span class="math-eq">ูขุณ + ูคุต = ูกูข</span>ุ ูุง ูู ุงูุทุฑููุฉ ุงูุฃูุซุฑ ูุนุงููุฉุ', options: [ { display: 'ุงูุชุนููุถ', value: 'a' }, { display: 'ุงูุญุฐู ุจุงูุฌูุน', value: 'b' }, { display: 'ุงูุญุฐู ุจุงูุทุฑุญ', value: 'c' }, { display: 'ุงูุญุฐู ุจุงูุถุฑุจ', value: 'd', isCorrect: true } ], explanation: 'ุงูุญุฐู ุจุงูุถุฑุจ ูู ุงูุฃูุซุฑ ูุนุงููุฉ ูุฃูู ูุง ููุฌุฏ ุฃู ูุนุงูู ูุณุงูู ูก ุฃู -ูกุ ูุงููุนุงููุงุช ููุณุช ูุชุณุงููุฉ ุฃู ูุชุนุงูุณุฉ. ุณุชุญุชุงุฌ ุฅูู ุถุฑุจ ุงููุนุงุฏูุชูู ูุฌุนู ุฃุญุฏ ุงููุนุงููุงุช ูุชุนุงูุณุงู (ูุซูุงูุ ุถุฑุจ ุงูุฃููู ูู -ูข ูุงูุซุงููุฉ ูู ูฅ ูุญุฐู ุณ).' },
            { level: 'โญ', text: 'ุฃู ูุธุงู ูู ุงูุฃูุธูุฉ ุงูุชุงููุฉ ูู ุงูุฃูุณุจ ููุญู ุจุทุฑููุฉ ุงูุญุฐู ุจุงูุทุฑุญุ', options: [ { display: '<span class="math-eq">ุณ+ุต=ูฅ<br>ุณ-ุต=ูก</span>', value: 'a' }, { display: '<span class="math-eq">ูขุณ+ูฃุต=ูง<br>ูขุณ-ูฅุต=ูก</span>', value: 'b', isCorrect: true }, { display: '<span class="math-eq">ุต=ุณ+ูก<br>ูขุณ+ุต=ูค</span>', value: 'c' }, { display: '<span class="math-eq">ูฃุณ+ูขุต=ูจ<br>ูขุณ+ูฃุต=ูง</span>', value: 'd' } ], explanation: 'ุงููุธุงู ูู ุงูุฎูุงุฑ (ุจ) ูู ุงูุฃูุณุจ ููุญุฐู ุจุงูุทุฑุญ ูุฃู ูุนุงููู ุงููุชุบูุฑ (ุณ) ูุชุณุงููุงู (ููุงููุง ูข)ุ ููุง ูุณูุญ ุจุญุฐูู ูุจุงุดุฑุฉ ุนูุฏ ุทุฑุญ ุงููุนุงุฏูุชูู.' },
            { level: 'โญ', text: 'ูุฌููุน ุนุฏุฏูู ูกูฅ ูุงููุฑู ุจููููุง ูฃ. ูุง ููุง ุงูุนุฏุฏุงูุ', options: [ { display: '(ูฉ, ูฆ)', value: 'a', isCorrect: true }, { display: '(ูกู, ูฅ)', value: 'b' }, { display: '(ูจ, ูง)', value: 'c' }, { display: '(ูกูข, ูฃ)', value: 'd' } ], explanation: 'ููุฑุถ ุงูุนุฏุฏูู ุณุ ุต. ุณ+ุต=ูกูฅ ู ุณ-ุต=ูฃ. ุจุงุณุชุฎุฏุงู ุงูุญุฐู ุจุงูุฌูุนุ ูขุณ=ูกูจ ุฅุฐู ุณ=ูฉ. ุจุงูุชุนููุถุ ูฉ+ุต=ูกูฅ ุฅุฐู ุต=ูฆ.', smartExplanation: 'ุงุจุญุซ ุนู ุฎูุงุฑูู ูุฌููุนููุง ูกูฅ. ุงูุฎูุงุฑุงู (ุฃ) ู (ุจ) ู (ุฌ) ูุญูููู ุฐูู. ุงูุขู ุงุจุญุซ ุนู ุฎูุงุฑูู ุงููุฑู ุจููููุง ูฃ. ููุท ุงูุฎูุงุฑ (ุฃ) (ูฉ-ูฆ=ูฃ) ูุญูู ุฐูู.' },
            { level: 'โญโญ', text: 'ูุง ูู ุญู ุงููุธุงู: <span class="math-eq">ุณ + ุต = ูฅ</span> ู <span class="math-eq">ูขุณ + ูขุต = ูกูข</span>ุ', options: [ { display: '(ูข, ูฃ)', value: 'a' }, { display: 'ูุง ููุฌุฏ ุญู', value: 'b', isCorrect: true }, { display: 'ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู', value: 'c' }, { display: '(ู, ูฅ)', value: 'd' } ], explanation: 'ุจุถุฑุจ ุงููุนุงุฏูุฉ ุงูุฃููู ูู -ูขุ ูุญุตู ุนูู -ูขุณ - ูขุต = -ูกู. ุจุฌูุนูุง ูุน ุงููุนุงุฏูุฉ ุงูุซุงููุฉ (ูขุณ + ูขุต = ูกูข)ุ ูุญุตู ุนูู ู = ูขุ ููู ุนุจุงุฑุฉ ุฎุงุทุฆุฉ. ูุฐุง ูุง ููุฌุฏ ุญู.', smartExplanation: 'ูุงุญุธ ุฃู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ ูู ุถุนู ุงููุนุงุฏูุฉ ุงูุฃููู ูู ุงูุทุฑู ุงูุฃููู (ูขุณ+ูขุต)ุ ูููู ุงูุทุฑู ุงูุฃูุณุฑ (ูกูข) ููุณ ุถุนู ุงูุทุฑู ุงูุฃูุณุฑ ูููุนุงุฏูุฉ ุงูุฃููู (ูฅ). ูุฐุง ุงูุชูุงูุถ ูุนูู ุฃู ุงูุฎุทูู ูุชูุงุฒูุงู ููุง ูุชูุงุทุนุงูุ ุฃู ูุง ููุฌุฏ ุญู.' },
            { level: 'โญโญ', text: 'ุญู ุงููุธุงู:<br><span class="math-eq">ูฃุณ + ูขุต = ูกูฆ</span><br><span class="math-eq">ูขุณ + ูฃุต = ูกูค</span>', options: [ { display: '(ูค, ูข)', value: 'a', isCorrect: true }, { display: '(ูข, ูฅ)', value: 'b' }, { display: '(ูฅ, ู.ูฅ)', value: 'c' }, { display: '(-ูค, ูกูค)', value: 'd' } ], explanation: 'ุจุงุณุชุฎุฏุงู ุงูุญุฐู ุจุงูุถุฑุจ (ูุถุฑุจ ุงูุฃููู ูู ูข ูุงูุซุงููุฉ ูู -ูฃ): ูฆุณ+ูคุต=ูฃูข ู -ูฆุณ-ูฉุต=-ูคูข. ุจุงูุฌูุน: -ูฅุต=-ูกู ุฅุฐู ุต=ูข. ุจุงูุชุนููุถ: ูฃุณ+ูข(ูข)=ูกูฆ ุฅุฐู ูฃุณ=ูกูข ููููุง ุณ=ูค.' },
            { level: 'โญโญโญ', text: 'ูุน ุฃุญูุฏ ููุญูุฏ ูุนุงู ูกูฅู ุฑูุงูุงู. ุฅุฐุง ูุงู ูุง ูุน ุฃุญูุฏ ูุณุงูู ุถุนู ูุง ูุน ูุญูุฏ ุฒุงุฆุฏ ูฃู ุฑูุงูุงู. ููู ูุน ูู ููููุงุ', options: [ { display: 'ุฃุญูุฏ ูกููุ ูุญูุฏ ูฅู', value: 'a' }, { display: 'ุฃุญูุฏ ูฉูุ ูุญูุฏ ูฆู', value: 'b' }, { display: 'ุฃุญูุฏ ูกูขูุ ูุญูุฏ ูฃู', value: 'c' }, { display: 'ุฃุญูุฏ ูกูกูุ ูุญูุฏ ูคู', value: 'd', isCorrect: true } ], explanation: 'ููุฑุถ ูุง ูุน ุฃุญูุฏ (ุฃ) ููุง ูุน ูุญูุฏ (ู). ุฃ+ู=ูกูฅู ู ุฃ=ูขู+ูฃู. ุจุงูุชุนููุถ: (ูขู+ูฃู)+ู=ูกูฅู โธ ูฃู=ูกูขู โธ ู=ูคู. ุฅุฐู ุฃ=ูกูฅู-ูคู=ูกูกู.' },
            { level: 'โญ', text: 'ุญู ุงููุธุงู:<br><span class="math-eq">ุต = ูฅุณ - ูก</span><br><span class="math-eq">ุต = ูขุณ + ูจ</span>', options: [ { display: '(ูฃ, ูกูค)', value: 'a', isCorrect: true }, { display: '(ูข, ูฉ)', value: 'b' }, { display: '(ูก, ูค)', value: 'c' }, { display: '(ูค, ูกูฉ)', value: 'd' } ], explanation: 'ุจูุง ุฃู ุต=ุตุ ุฅุฐู ูฅุณ-ูก=ูขุณ+ูจ. ูฃุณ=ูฉ โธ ุณ=ูฃ. ุจุงูุชุนููุถ: ุต=ูฅ(ูฃ)-ูก=ูกูค.' },
            { level: 'โญโญ', text: 'ุญู ุงููุธุงู:<br><span class="math-eq">ูงุณ - ูคุต = ูกู</span><br><span class="math-eq">-ูงุณ + ูฅุต = -ูฉ</span>', options: [ { display: '(ูกู/ูง, ู)', value: 'a' }, { display: '(ู, -ูข.ูฅ)', value: 'b' }, { display: '(ูข, ูก)', value: 'c', isCorrect: true }, { display: '(ูฅ, ูฆ.ูขูฅ)', value: 'd' } ], explanation: 'ุจุงุณุชุฎุฏุงู ุงูุญุฐู ุจุงูุฌูุน ูุจุงุดุฑุฉ: ุต=ูก. ุจุงูุชุนููุถ ูู ุงููุนุงุฏูุฉ ุงูุฃููู: ูงุณ-ูค(ูก)=ูกู โธ ูงุณ=ูกูค โธ ุณ=ูข. ุงูุญู ูู (ูข,ูก).' },
            { level: 'โญโญ', text: 'ูุง ูู ุญู ุงููุธุงู: <span class="math-eq">ูคุณ - ูขุต = ูจ</span> ู <span class="math-eq">ุต = ูขุณ - ูค</span>ุ', options: [ { display: 'ุญู ูุญูุฏ', value: 'a' }, { display: 'ูุง ููุฌุฏ ุญู', value: 'b' }, { display: 'ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู', value: 'c', isCorrect: true }, { display: '(ูข, ู)', value: 'd' } ], explanation: 'ุจุฅุนุงุฏุฉ ุชุฑุชูุจ ุงููุนุงุฏูุฉ ุงูุซุงููุฉ: ูขุต=ูคุณ-ูจ โธ ูขุต-ูคุณ=-ูจ. ุงููุนุงุฏูุฉ ุงูุฃููู ูู ูคุณ-ูขุต=ูจ. ุงููุนุงุฏูุชุงู ูุชูุงูุฆุชุงู. ููุฌุฏ ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู.', smartExplanation: 'ูุงุญุธ ุฃู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ (ุต = ูขุณ - ูค) ุฅุฐุง ุถุฑุจุชูุง ูู -ูข ุชุญุตู ุนูู -ูขุต = -ูคุณ + ูจุ ููู ููุณูุง ุงููุนุงุฏูุฉ ุงูุฃููู. ุจูุง ุฃู ุงููุนุงุฏูุชูู ููุง ููุณ ุงูุฎุทุ ูุฅูู ููุฌุฏ ุนุฏุฏ ูุง ููุงุฆู ูู ุงูุญููู.' }
        ];
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        return shuffled.slice(0, 5); // Select 5 random questions
    }

    </script>
</body>
</html>
