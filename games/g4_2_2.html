<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- ØªØ¹Ø¯ÙŠÙ„: Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù„Ø¹Ø¨Ø© --><title>Ù„Ø¹Ø¨Ø© Ø±Ø­Ù„Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Ø¥Ø¶Ø§ÙØ©: MathJax Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ³ÙˆØ± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ --><script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']]
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¶Ø§ÙØ© MathJax --><style>
        body {
            font-family: 'Tajawal', sans-serif;
            touch-action: manipulation;
            overscroll-behavior-y: contain;
            position: relative;
            background-color: #1a202c; /* Ù„ÙˆÙ† Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¯Ø§ÙƒÙ† */
        }
        /* ØªØ¹Ø¯ÙŠÙ„: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #1a202c; /* Ù„ÙˆÙ† Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¯Ø§ÙƒÙ† */
            background-image: url("https://ablan-math.github.io/img/g4/r&g.png");
            background-size: cover;
            background-position: center;
            z-index: -1;
            opacity: 1; 
            transition: opacity 0.5s ease-in-out;
        }

        .card-enter { animation: card-enter 0.5s ease-out forwards; }
        @keyframes card-enter {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .feedback-correct {
            animation: feedback-pop 0.3s ease-in-out;
            background-color: #10B981;
            color: white;
        }
        .feedback-incorrect {
            animation: feedback-shake 0.5s ease-in-out;
            background-color: #EF4444;
            color: white;
        }
        @keyframes feedback-pop {
            0% { transform: scale(0.8); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes feedback-shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        .modal-content { 
            animation: modal-pop 0.3s ease-out;
            background-color: rgb(255 255 255 / 0.95);
            backdrop-filter: blur(4px);
        }
        @keyframes modal-pop {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        /* ØªØ¹Ø¯ÙŠÙ„: ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø§Ø¦Ø­ÙŠ */
        .transition-screen {
            animation: fadeIn 0.5s ease-out;
            position: relative;
            overflow: hidden;
            /* ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‡Ø§Ù…Ø´ p-6 Ù…Ù† Ù‡Ù†Ø§ Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø´ÙØ§Ù Ø§Ù„Ø²Ø§Ø¦Ø¯ */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .transition-screen > * {
            position: relative;
            z-index: 2;
        }
        #game-content {
            position: relative;
            overflow: hidden;
        }

        .leaderboard-scroll {
            max-height: 180px;
            overflow-y: auto;
            padding-right: 5px;
        }
        .leaderboard-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .leaderboard-scroll::-webkit-scrollbar-track {
            background: #e0f2fe;
            border-radius: 10px;
        }
        .leaderboard-scroll::-webkit-scrollbar-thumb {
            background-color: #0ea5e9;
            border-radius: 10px;
            border: 2px solid #e0f2fe;
        }
    
        #start-screen h1, #start-screen .welcome-text {
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.5);
            color: #ffffff; 
        }
        .credits-text {
           color: #ffffff; 
           text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
        }
        @keyframes pulse-text {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        .pulse-animation {
            animation: pulse-text 2s infinite ease-in-out;
            display: inline-block;
        }

        /* ØªØ¹Ø¯ÙŠÙ„: ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø§Ø¦Ø­ÙŠ */
        .transition-content {
            background-color: rgb(255 255 255 / 0.85); /* Ø´Ø¨Ù‡ Ø´ÙØ§Ù ÙØ±Ø§Ø¦Ø­ÙŠ */
            backdrop-filter: blur(8px); /* ØªØ£Ø«ÙŠØ± Ø¶Ø¨Ø§Ø¨ÙŠ Ø£ÙƒØ«Ø± */
        }

        /* ØªØ¹Ø¯ÙŠÙ„: Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø³Ù…Ø§ÙˆÙŠ ÙˆÙˆØ±Ø¯ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ±) */
        .btn-primary {
            background-color: #0ea5e9; /* bg-sky-600 */
            color: white;
            transition: background-color 0.2s ease-in-out;
        }
        .btn-primary:hover {
            background-color: #ec4899; /* hover:bg-pink-600 */
        }
        
        .btn-secondary {
            background-color: #0d9488; /* bg-teal-600 */
            color: white;
            transition: background-color 0.2s ease-in-out;
        }
        .btn-secondary:hover {
            background-color: #0f766e; /* hover:bg-teal-700 */
        }
        
        /* Ù„ØªØµØºÙŠØ± Ø®Ø· Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ù„Ø®ÙŠØ§Ø±Ø§Øª */
        #question-text {
            font-size: 0.9rem; /* Ø£ØµØºØ± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù…Ù† text-base */
        }
        #options-container button {
            font-size: 0.9rem; /* Ø£ØµØºØ± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù…Ù† text-base */
        }

        /* Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø§Ø·Ø§Ø± Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ ÙˆÙˆØ§Ø¶Ø­ */
        #game-container {
            max-height: 98vh; /* Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØªØ¸Ù‡Ø± Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
            overflow-y: auto; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£ÙƒØ¨Ø± */
        }

    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen p-2 sm:p-4">

    <div id="loading-screen" class="fixed inset-0 bg-gray-900 flex flex-col items-center justify-center z-[100]">
        <div class="text-white text-2xl font-bold animate-pulse">... Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© ...</div>
        <div class="text-gray-400 text-sm mt-2">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
    </div>

    <!-- Start Screen --><!-- ØªØ¹Ø¯ÙŠÙ„: Ù„ÙˆÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± --><div id="start-screen" class="w-full max-w-sm mx-auto bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl p-4 text-center card-enter flex flex-col justify-center items-center h-full py-6 hidden">
        <h1 class="text-4xl font-bold text-sky-800">Ù„Ø¹Ø¨Ø© Ø±Ø­Ù„Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h1>
        
        <div id="welcomeMessage" class="text-base text-white mt-6 mb-8 bg-black/30 backdrop-blur-sm p-4 rounded-xl shadow-lg">
            <!-- ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø®ØªØµØ± --><p class="welcome-text">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø¨Ø·Ù„! Ø£Ù†Øª Ø§Ù„Ø¢Ù† ÙÙŠ Ø±Ø­Ù„Ø© Ø¹Ø§Ø¦Ù„ÙŠØ© Ù…Ù…ØªØ¹Ø©. ÙˆØ§Ù„Ø¯Ùƒ ÙŠØ«Ù‚ Ø¨Ùƒ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©.</p>
        </div>
        
        <!-- ØªØ¹Ø¯ÙŠÙ„: Ù„ÙˆÙ† Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø³Ù…Ø§ÙˆÙŠ) --><button onclick="startGame()" class="w-full btn-primary font-bold py-3 px-6 rounded-lg shadow-md focus:outline-none ring-2 ring-sky-300 backdrop-blur-sm">
            <span class="pulse-animation text-xl">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©!</span>
        </button>
        <p class="credits-text text-xs text-white/90 font-semibold mt-8 bg-black/30 p-2 rounded-lg">Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ‚Ø¯ÙŠÙ…: Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ø¨Ù„Ø§Ù†</p>
    </div>

    <!-- Game Container --><div id="game-container" class="w-full max-w-sm mx-auto bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl p-4 space-y-3 hidden">
        <div id="game-screen"></div>
    </div>

    <!-- Explanation Modal --><div id="explanation-modal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
        <div class="rounded-lg p-5 w-full max-w-sm modal-content">
            <div class="flex justify-between items-center mb-2">
                <!-- ØªØ¹Ø¯ÙŠÙ„: Ù„ÙˆÙ† Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ø§ÙØ°Ø© (Ø³Ù…Ø§ÙˆÙŠ) --><h3 class="text-lg font-bold text-sky-700">Ø´Ø±Ø­ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</h3>
                <button onclick="hideExplanation()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
            </div>
            <div id="explanation-content" class="space-y-2 text-sm text-gray-700 max-h-[75vh] overflow-y-auto pr-2"></div>
            <button onclick="hideExplanation()" class="mt-3 w-full bg-gray-500 text-white font-bold py-2 rounded-lg hover:bg-gray-600">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        // --- GAME LOGIC ---
        
        // --- Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ (5 Ù…Ù‡Ù…Ø§Øª) ---
        const allStages = [
          {
            // ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø²Ø§Ù„Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            levelTitle: "Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨",
            questions: [
              // Ø§Ù„Ù…Ù‡Ù…Ø© 1 (Ø¶Ø±Ø¨ Ù…ÙˆØ¬Ø¨)
              { 
                caseTitle: "Ø§Ù„Ù…Ù‡Ù…Ø© Ù¡: Ø£Ø³Ø§ÙˆØ± Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨",
                part1: { 
                  question: "Ø£Ø¹Ø·Ø§Ùƒ ÙˆØ§Ù„Ø¯Ùƒ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØµØ±Ø§ÙØŒ ÙˆØ·Ù„Ø¨ Ù…Ù†Ùƒ Ø´Ø±Ø§Ø¡ Ù¦ Ø£Ø³Ø§ÙˆØ± Ø£Ù„Ø¹Ø§Ø¨ Ù„Ùƒ ÙˆÙ„Ø¥Ø®ÙˆØªÙƒ (Ø³Ø¹Ø± Ø§Ù„Ø¥Ø³ÙˆØ±Ø© 'Ø³'). Ù‚Ø§Ù„ Ù„Ùƒ: \"ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„ØªÙƒÙ„ÙØ© Ù¡Ù¢Ù  Ø±ÙŠØ§Ù„Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙƒØ«Ø±\". Ù…Ø§ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŸ",
                  answer: "Ù¦Ø³ â‰¤ Ù¡Ù¢Ù ",
                  options: ["Ù¦Ø³ â‰¤ Ù¡Ù¢Ù ", "Ù¦Ø³ â‰¥ Ù¡Ù¢Ù ", "$\\frac{Ø³}{Ù¦}$ â‰¤ Ù¡Ù¢Ù ", "Ù¦ + Ø³ â‰¤ Ù¡Ù¢Ù "],
                  explanation: "<p><span class='font-bold'>Ø§Ù„ØªÙƒÙ„ÙØ©:</span> Ù‡ÙŠ Ù¦ (Ø£Ø³Ø§ÙˆØ±) Ù…Ø¶Ø±ÙˆØ¨Ø© ÙÙŠ Ø³Ø¹Ø± Ø§Ù„Ø¥Ø³ÙˆØ±Ø© (Ø³)ØŒ Ø£ÙŠ: Ù¦Ø³.</p><p><span class='font-bold'>Ø§Ù„Ø´Ø±Ø·:</span> 'Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙƒØ«Ø±' ØªØ¹Ù†ÙŠ Ø£ØµØºØ± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ (â‰¤).</p><p class='font-bold text-lg text-center p-2 bg-sky-100 rounded mt-2'>Ù¦Ø³ â‰¤ Ù¡Ù¢Ù </p>"
                }, 
                part2: { 
                  question: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ù‡ÙŠ: <strong>Ù¦Ø³ â‰¤ Ù¡Ù¢Ù </strong>. Ù…Ø§ Ù‡Ùˆ Ø£Ù‚ØµÙ‰ Ø³Ø¹Ø± (Ø³) Ù„Ù„Ø¥Ø³ÙˆØ±Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©ØŸ",
                  answer: "Ø³ â‰¤ Ù¢Ù ",
                  options: ["Ø³ â‰¤ Ù¢Ù ", "Ø³ â‰¥ Ù¢Ù ", "Ø³ â‰¤ Ù§Ù¢Ù ", "Ø³ < Ù¢Ù "],
                  explanation: "<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <strong>Ù¦Ø³ â‰¤ Ù¡Ù¢Ù </strong>ØŒ Ù†Ù‚Ø³Ù… Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ù¦.</p><p>Ù„Ø£Ù† Ù¦ Ø¹Ø¯Ø¯ Ù…ÙˆØ¬Ø¨ØŒ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© <strong>Ù„Ø§ ÙŠØªØºÙŠØ±</strong>.</p><p class='font-bold text-lg text-center p-2 bg-sky-100 rounded mt-2'>$\\frac{Ù¦Ø³}{Ù¦} â‰¤ \\frac{Ù¡Ù¢Ù }{Ù¦}$</p><p class='font-bold text-lg text-center'>Ø³ â‰¤ Ù¢Ù </p>"
                } 
              },
              // Ø§Ù„Ù…Ù‡Ù…Ø© 2 (Ù‚Ø³Ù…Ø© Ù…ÙˆØ¬Ø¨)
              { 
                caseTitle: "Ø§Ù„Ù…Ù‡Ù…Ø© Ù¢: ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨Ù„Øº",
                part1: { 
                  question: "ÙŠØ³Ø£Ù„Ùƒ ÙˆØ§Ù„Ø¯Ùƒ: \"Ù…Ø¹ÙŠ Ù…Ø¨Ù„Øº Ù…Ù† Ø§Ù„Ù…Ø§Ù„ ÙˆØ£Ø±ÙŠØ¯ ØªÙˆØ²ÙŠØ¹Ù‡ Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ Ø¹Ù„Ù‰ Ù¤ Ø£Ø´Ø®Ø§Øµ (Ø£Ù†Øª ÙˆØ¥Ø®ÙˆØªÙƒ Ø§Ù„Ø«Ù„Ø§Ø«Ø©). ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØµÙ„ ÙƒÙ„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ù¥Ù  Ø±ÙŠØ§Ù„Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„\". Ù…Ø§ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©ØŸ (ØªÙ„Ù…ÙŠØ­: Ø§Ø±Ù…Ø² Ù„Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø±Ù…Ø² Ù…)",
                  answer: "$\\frac{Ù…}{Ù¤}$ â‰¥ Ù¥Ù ",
                  options: ["$\\frac{Ù…}{Ù¤}$ â‰¥ Ù¥Ù ", "$\\frac{Ù…}{Ù¤}$ â‰¤ Ù¥Ù ", "Ù¤Ù… â‰¥ Ù¥Ù ", "Ù… - Ù¤ â‰¥ Ù¥Ù "],
                  explanation: "<p><span class='font-bold'>Ø§Ù„Ù†ØµÙŠØ¨:</span> Ø§Ù„Ù…Ø¨Ù„Øº (Ù…) Ù‚ÙØ³Ù… Ø¹Ù„Ù‰ Ù¤ Ø£Ø´Ø®Ø§ØµØŒ Ø£ÙŠ: $\\frac{Ù…}{Ù¤}$.</p><p><span class='font-bold'>Ø§Ù„Ø´Ø±Ø·:</span> 'Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„' ØªØ¹Ù†ÙŠ Ø£ÙƒØ¨Ø± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ (â‰¥).</p><p class='font-bold text-lg text-center p-2 bg-sky-100 rounded mt-2'>$\\frac{Ù…}{Ù¤}$ â‰¥ Ù¥Ù </p>"
                }, 
                part2: { 
                  question: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ù‡ÙŠ: <strong>$\\frac{Ù…}{Ù¤}$ â‰¥ Ù¥Ù </strong>. Ù…Ø§ Ù‡Ùˆ Ø£Ù‚Ù„ Ù…Ø¨Ù„Øº (Ù…) ÙƒØ§Ù† Ù…Ø¹ ÙˆØ§Ù„Ø¯ÙƒØŸ",
                  answer: "Ù… â‰¥ Ù¢Ù Ù ",
                  options: ["Ù… â‰¥ Ù¢Ù Ù ", "Ù… â‰¤ Ù¢Ù Ù ", "Ù… > Ù¢Ù Ù ", "Ù… â‰¥ Ù¤Ù¦"],
                  explanation: "<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <strong>$\\frac{Ù…}{Ù¤}$ â‰¥ Ù¥Ù </strong>ØŒ Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø·Ø±ÙÙŠÙ† ÙÙŠ Ù¤.</p><p>Ù„Ø£Ù† Ù¤ Ø¹Ø¯Ø¯ Ù…ÙˆØ¬Ø¨ØŒ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© <strong>Ù„Ø§ ÙŠØªØºÙŠØ±</strong>.</p><p class='font-bold text-lg text-center p-2 bg-sky-100 rounded mt-2'>(Ù¤) Ã— $\\frac{Ù…}{Ù¤}$ â‰¥ (Ù¤) Ã— Ù¥Ù </p><p class='font-bold text-lg text-center'>Ù… â‰¥ Ù¢Ù Ù </p>"
                } 
              },
              // Ø§Ù„Ù…Ù‡Ù…Ø© 3 (Ø¶Ø±Ø¨ Ø³Ø§Ù„Ø¨ - Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù…Ø©)
              { 
                caseTitle: "Ø§Ù„Ù…Ù‡Ù…Ø© Ù£: Ø¨ÙŠØª Ø§Ù„Ø£Ø´Ø¨Ø§Ø­",
                part1: { 
                  question: "ÙÙŠ Ù„Ø¹Ø¨Ø© \"Ø¨ÙŠØª Ø§Ù„Ø£Ø´Ø¨Ø§Ø­\"ØŒ ÙƒÙ„ Ø®Ø·Ø£ ØªØ±ØªÙƒØ¨Ù‡ ÙŠØ®ØµÙ… Ù£ Ù†Ù‚Ø§Ø· (-Ù£). ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø®ØµÙˆÙ…Ø© \"Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„\" -Ù¡Ù¥ Ù†Ù‚Ø·Ø© (Ø£ÙŠ -Ù¡Ù¥ Ø£Ùˆ Ø£ÙƒØ«Ø±). Ù…Ø§ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©ØŸ (ØªÙ„Ù…ÙŠØ­: Ø§Ø±Ù…Ø² Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¨Ø§Ù„Ø±Ù…Ø² Ø®)",
                  answer: "-Ù£Ø® â‰¥ -Ù¡Ù¥",
                  options: ["-Ù£Ø® â‰¥ -Ù¡Ù¥", "-Ù£Ø® â‰¤ -Ù¡Ù¥", "Ù£Ø® â‰¥ -Ù¡Ù¥", "Ø® - Ù£ â‰¥ -Ù¡Ù¥"],
                  explanation: "<p><span class='font-bold'>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø®ØµÙˆÙ…Ø©:</span> Ù‡ÙŠ (-Ù£) Ù…Ø¶Ø±ÙˆØ¨Ø© ÙÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ (Ø®)ØŒ Ø£ÙŠ: -Ù£Ø®.</p><p><span class='font-bold'>Ø§Ù„Ø´Ø±Ø·:</span> 'Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„' ØªØ¹Ù†ÙŠ Ø£ÙƒØ¨Ø± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ (â‰¥).</p><p class='font-bold text-lg text-center p-2 bg-sky-100 rounded mt-2'>-Ù£Ø® â‰¥ -Ù¡Ù¥</p>"
                }, 
                part2: { 
                  question: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ù‡ÙŠ: <strong>-Ù£Ø® â‰¥ -Ù¡Ù¥</strong>. Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø­Ù„ØŸ",
                  answer: "Ø® â‰¤ Ù¥",
                  options: ["Ø® â‰¤ Ù¥", "Ø® â‰¥ Ù¥", "Ø® â‰¤ -Ù¥", "Ø® â‰¥ -Ù¥"],
                  explanation: "<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© <strong>-Ù£Ø® â‰¥ -Ù¡Ù¥</strong>ØŒ Ù†Ù‚Ø³Ù… Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ -Ù£.</p><div class='p-2 bg-red-100 border-r-4 border-red-500 my-2'><span class='font-bold text-red-700'>!! Ø§Ù†ØªØ¨Ù‡ !!</span><p>Ø¹Ù†Ø¯ Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø³Ø§Ù„Ø¨ØŒ ÙŠØ¬Ø¨ Ø£Ù† <strong>Ù†Ø¹ÙƒØ³ (Ù†Ù‚Ù„Ø¨)</strong> Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ù…Ù† (â‰¥) Ø¥Ù„Ù‰ (â‰¤).</p></div><p class='font-bold text-lg text-center p-2 bg-sky-100 rounded mt-2'>$\\frac{-Ù£Ø®}{-Ù£}$ â‰¤ $\\frac{-Ù¡Ù¥}{-Ù£}$</p><p class='font-bold text-lg text-center'>Ø® â‰¤ Ù¥</p><p>(ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£Ø®Ø·Ø§Ø¤Ùƒ Ù¥ Ø£Ùˆ Ø£Ù‚Ù„).</p>"
                } 
              }
            ]
          },
          {
            // ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø²Ø§Ù„Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            levelTitle: "Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ù„Ù…ØªØ­Ù Ø§Ù„ÙˆØ·Ù†ÙŠ",
            questions: [
              // Ø§Ù„Ù…Ù‡Ù…Ø© 4 (ÙƒØ³Ø± Ù…ÙˆØ¬Ø¨)
              { 
                caseTitle: "Ø§Ù„Ù…Ù‡Ù…Ø© Ù¤: Ù‚Ø·Ø¹ Ø£Ø«Ø±ÙŠØ©",
                part1: { 
                  question: "ØªÙ‚Ø±Ø£ ØªÙ‚Ø±ÙŠØ±Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØ­Ù ÙŠÙ‚ÙˆÙ„: \"Ø«Ù„Ø«Ø§ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ø£Ø«Ø±ÙŠØ© Ø§Ù„ØªÙŠ Ø§ÙƒØªÙØ´ÙØª Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù… Ø¬Ø§Ø¡Øª Ù…Ù† Ø´Ù…Ø§Ù„ Ø§Ù„Ù…Ù…Ù„ÙƒØ©. Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¯Ø¯ ÙŠØ²ÙŠØ¯ Ø¹Ù† Ù¤Ù  Ù‚Ø·Ø¹Ø©\". Ù…Ø§ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŸ (ØªÙ„Ù…ÙŠØ­: Ø§Ø±Ù…Ø² Ù„Ù„Ù‚Ø·Ø¹ Ø§Ù„Ø£Ø«Ø±ÙŠØ© Ø¨Ø§Ù„Ø±Ù…Ø² Ù‚)",
                  answer: "$\\frac{Ù¢Ù‚}{Ù£}$ > Ù¤Ù ",
                  options: ["$\\frac{Ù¢Ù‚}{Ù£}$ > Ù¤Ù ", "$\\frac{Ù¢Ù‚}{Ù£}$ < Ù¤Ù ", "Ù‚ - $\\frac{Ù¢}{Ù£}$ > Ù¤Ù ", "$\\frac{Ù£Ù‚}{Ù¢}$ > Ù¤Ù "],
                  explanation: "<p><span class='font-bold'>Ø§Ù„Ø¹Ø¯Ø¯:</span> 'Ø«Ù„Ø«Ø§ (Ù‚)' ØªÙÙƒØªØ¨ $\\frac{Ù¢Ù‚}{Ù£}$.</p><p><span class='font-bold'>Ø§Ù„Ø´Ø±Ø·:</span> 'ÙŠØ²ÙŠØ¯ Ø¹Ù†' ØªØ¹Ù†ÙŠ Ø£ÙƒØ¨Ø± Ù…Ù† ( > ).</p><p class='font-bold text-lg text-center p-2 bg-sky-100 rounded mt-2'>$\\frac{Ù¢Ù‚}{Ù£}$ > Ù¤Ù </p>"
                }, 
                part2: { 
                  question: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ù‡ÙŠ: <strong>$\\frac{Ù¢Ù‚}{Ù£}$ > Ù¤Ù </strong>. Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø­Ù„ØŸ",
                  answer: "Ù‚ > Ù¦Ù ",
                  options: ["Ù‚ > Ù¦Ù ", "Ù‚ < Ù¦Ù ", "Ù‚ > Ù¢Ù¦Ù«Ù¦", "Ù‚ > Ù¤Ù "],
                  explanation: "<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŒ Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø·Ø±ÙÙŠÙ† ÙÙŠ Ù…Ù‚Ù„ÙˆØ¨ Ø§Ù„ÙƒØ³Ø± ($\frac{Ù£}{Ù¢}$).</p><p>Ù„Ø£Ù† ($\frac{Ù£}{Ù¢}$) Ø¹Ø¯Ø¯ Ù…ÙˆØ¬Ø¨ØŒ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© <strong>Ù„Ø§ ÙŠØªØºÙŠØ±</strong>.</p><p class='font-bold text-lg text-center p-2 bg-sky-100 rounded mt-2'>($\\frac{Ù£}{Ù¢}$) Ã— $\\frac{Ù¢Ù‚}{Ù£}$ > (Ù¤Ù ) Ã— ($\frac{Ù£}{Ù¢}$)</p><p class='font-bold text-lg text-center'>Ù‚ > $\\frac{Ù¡Ù¢Ù }{Ù¢}$</p><p class='font-bold text-lg text-center'>Ù‚ > Ù¦Ù </p><p>(ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù‚Ø·Ø¹ Ø£ÙƒØ«Ø± Ù…Ù† Ù¦Ù ).</p>"
                } 
              },
              // Ø§Ù„Ù…Ù‡Ù…Ø© 5 (ÙƒØ³Ø± Ø³Ø§Ù„Ø¨ - Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù…Ø©)
              // **** ØªØ¹Ø¯ÙŠÙ„: ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ÙŠØ¯ÙˆÙŠ ($\\frac{Ù¢Ø­-}{Ù¥}$) Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© Ù¥ ****
              // **** ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ø§Ù„ØµØ­ÙŠØ­ (Ù¢Ù  â‰¥ ...) ****
              { 
                caseTitle: "Ø§Ù„Ù…Ù‡Ù…Ø© Ù¥: Ø§Ù„Ø¹ØµØ± Ø§Ù„Ø¬Ù„ÙŠØ¯ÙŠ",
                part1: { 
                  question: "ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ø¹ØµØ± Ø§Ù„Ø¬Ù„ÙŠØ¯ÙŠØŒ ØªÙ‚Ø±Ø£ ØªÙ‚Ø±ÙŠØ±Ø§Ù‹ Ø¹Ù† Ù…Ø¹Ø¯Ù„ Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø­Ø±Ø§Ø±Ø©. Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙŠÙ‚ÙˆÙ„: \"Ù†Ø§ØªØ¬ Ø¶Ø±Ø¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ù†Ø®ÙØ§Ø¶ ÙÙŠ Ø³Ø§Ù„Ø¨ Ø®ÙÙ…Ø³ÙŠÙ’Ù† Ù‡Ùˆ Ù¢Ù  Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙƒØ«Ø±\". Ù…Ø§ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŸ (ØªÙ„Ù…ÙŠØ­: Ø§Ø±Ù…Ø² Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ù†Ø®ÙØ§Ø¶ Ø¨Ø§Ù„Ø±Ù…Ø² Ø­)",
                  // ØªØ¹Ø¯ÙŠÙ„: ØªÙ… Ø¥Ø±Ø¬Ø§Ø¹Ù‡Ø§ Ù„Ù„Ø´ÙƒÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚
                  answer: "$Ù¢Ù  \\ge \\frac{Ù¢Ø­-}{Ù¥}$",
                  options: ["$Ù¢Ù  \\ge \\frac{Ù¢Ø­-}{Ù¥}$", "$Ù¢Ù  \\ge \\frac{Ù¥Ø­-}{Ù¢}$", "$Ù¢Ù  \\ge \\frac{Ù¢Ø­}{Ù¥}$", "$Ù¢Ù  \\ge \\frac{Ù¡Ø­-}{Ù¥}$"],
                  explanation: "<p><span class='font-bold'>Ø§Ù„Ù†Ø§ØªØ¬:</span> 'Ù†Ø§ØªØ¬ Ø¶Ø±Ø¨ (Ø­) ÙÙŠ Ø³Ø§Ù„Ø¨ Ø®ÙÙ…Ø³ÙŠÙ’Ù†' ÙŠÙÙƒØªØ¨ $\\frac{Ù¢Ø­-}{Ù¥}$.</p><p><span class='font-bold'>Ø§Ù„Ø´Ø±Ø·:</span> 'Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙƒØ«Ø±' ØªØ¹Ù†ÙŠ Ø£ØµØºØ± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ (â‰¤).</p><p class='font-bold text-lg text-center p-2 bg-sky-100 rounded mt-2'>$Ù¢Ù  \\ge \\frac{Ù¢Ø­-}{Ù¥}$</p>"
                }, 
                part2: { 
                  // ØªØ¹Ø¯ÙŠÙ„: ØªÙ… Ø¥Ø±Ø¬Ø§Ø¹Ù‡Ø§ Ù„Ù„Ø´ÙƒÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚
                  question: "Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© Ù‡ÙŠ: <strong>$Ù¢Ù  \\ge \\frac{Ù¢Ø­-}{Ù¥}$</strong>. Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø­Ù„ØŸ",
                  answer: "Ø­ â‰¥ -Ù¥Ù ",
                  options: ["Ø­ â‰¥ -Ù¥Ù ", "Ø­ â‰¤ -Ù¥Ù ", "Ø­ â‰¤ -Ù¨", "Ø­ â‰¥ -Ù¨"],
                  explanation: "<p>Ù„Ø­Ù„ Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø©ØŒ Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø·Ø±ÙÙŠÙ† ÙÙŠ Ù…Ù‚Ù„ÙˆØ¨ Ø§Ù„ÙƒØ³Ø± ($\frac{-Ù¥}{Ù¢}$).</p><div class='p-2 bg-red-100 border-r-4 border-red-500 my-2'><span class='font-bold text-red-700'>!! Ø§Ù†ØªØ¨Ù‡ !!</span><p>Ù†Ø­Ù† Ù†Ø¶Ø±Ø¨ ÙÙŠ Ø¹Ø¯Ø¯ Ø³Ø§Ù„Ø¨ØŒ Ù„Ø°Ø§ ÙŠØ¬Ø¨ **Ø¹ÙƒØ³ (Ù†Ù‚Ù„Ø¨)** Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ù…Ù† (â‰¥) Ø¥Ù„Ù‰ (â‰¤).</p></div><p class='font-bold text-lg text-center p-2 bg-sky-100 rounded mt-2'>($\\frac{Ù¥-}{Ù¢}$) Ã— $(Ù¢Ù ) \\le (\\frac{Ù¥-}{Ù¢}$) Ã— $\\frac{Ù¢Ø­-}{Ù¥}$</p><p class='font-bold text-lg text-center'>$\\frac{-Ù¡Ù Ù }{Ù¢} \\le$ Ø­</p><p class='font-bold text-lg text-center'>-Ù¥Ù  \\le Ø­   (ÙˆÙ‡ÙŠ Ù†ÙØ³Ù‡Ø§: Ø­ \\ge -Ù¥Ù )</p>"
                } 
              }
            ]
          }
        ];
        // --- Ù†Ù‡Ø§ÙŠØ© Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ---


        const startScreenEl = document.getElementById('start-screen');
        const gameContainerEl = document.getElementById('game-container');
        const gameScreenEl = document.getElementById('game-screen');
        const explanationModalEl = document.getElementById('explanation-modal');
        const explanationContentEl = document.getElementById('explanation-content');
        
        let gameQuestions = [];
        let currentQuestionIndex = 0;
        let currentGameLevelIndex = 0;
        let currentStage = 1;
        let score = 0;
        let answered = false;
        
        let timerInterval = null;
        let questionStartTime = 0;
        let totalElapsedTime = 0;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function toArabicNumerals(numStr) {
            const arabicNumerals = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
            return String(numStr).replace(/[0-9.-]/g, (char) => {
                if (char === '.') return 'Ù«';
                if (char === '-') return '-';
                return arabicNumerals[parseInt(char)];
            });
        }
        
        function startTimer() {
            clearInterval(timerInterval);
            questionStartTime = Date.now();
            
            const updateTimerDisplay = () => {
                const timerEl = document.getElementById('timer-display');
                if (timerEl) {
                    const currentSessionTime = Date.now() - questionStartTime;
                    const displayTimeInSeconds = Math.floor((totalElapsedTime + currentSessionTime) / 1000);
                    timerEl.textContent = toArabicNumerals(displayTimeInSeconds);
                }
            };
            
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            if (questionStartTime > 0) {
                totalElapsedTime += Date.now() - questionStartTime;
                questionStartTime = 0;
            }
            const timerEl = document.getElementById('timer-display');
            if (timerEl) {
                const displayTimeInSeconds = Math.floor(totalElapsedTime / 1000);
                 timerEl.textContent = toArabicNumerals(displayTimeInSeconds);
            }
        }
        
        function startGame() {
            document.body.classList.add('game-started');
            
            currentGameLevelIndex = 0;
            score = 0;
            totalElapsedTime = 0;
            startScreenEl.classList.add('hidden');
            gameContainerEl.classList.remove('hidden');
            
            loadLevel();
        }
        
        function showLevelTransitionScreen() {
            const levelData = allStages[currentGameLevelIndex];
            let levelName = (currentGameLevelIndex === 0) ? "Ø§Ù„Ø£ÙˆÙ„Ù‰" : "Ø§Ù„Ø«Ø§Ù†ÙŠØ©";

            // ØªØ¹Ø¯ÙŠÙ„: ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø§Ø¦Ø­ÙŠ
            gameScreenEl.innerHTML = `
                <!-- ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø²Ø§Ù„Ø© p-6 Ù…Ù† Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø´ÙØ§Ù --><div class="transition-screen text-center flex flex-col justify-center items-center min-h-[350px]">
                    <!-- Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ø§Ù„Ø´ÙØ§Ù --><div class="transition-content rounded-2xl p-6 shadow-xl w-full max-w-sm">
                        <!-- ØªØ¹Ø¯ÙŠÙ„: Ù„ÙˆÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø³Ù…Ø§ÙˆÙŠ) --><h2 class="text-sky-800 text-2xl font-bold drop-shadow-md">Ø§Ù„Ø±Ø­Ù„Ø© ${levelName} Ù…Ù† ${toArabicNumerals(allStages.length)}</h2>
                        <p class="text-gray-700 text-lg mt-2 font-medium drop-shadow-sm">${levelData.levelTitle}</p>
                        <!-- ØªØ¹Ø¯ÙŠÙ„: Ø²Ø± (Ø³Ù…Ø§ÙˆÙŠ) --><button onclick="loadQuestion()" class="mt-6 w-full btn-primary font-bold py-3 px-10 rounded-lg shadow-md focus:outline-none transition-all ring-2 ring-sky-300">
                             <span class="pulse-animation text-xl">Ø§Ø¨Ø¯Ø£</span>
                        </button>
                    </div>
                </div>
            `;
        }

        function loadLevel() {
            const levelData = allStages[currentGameLevelIndex];
            gameQuestions = shuffleArray(levelData.questions.slice());
            currentQuestionIndex = 0;
            currentStage = 1;
            
            showLevelTransitionScreen();
        }

        function loadQuestion() {
            answered = false;
            const question = gameQuestions[currentQuestionIndex];
            
            gameScreenEl.innerHTML = `<div id="game-content" class="space-y-2 card-enter"></div>`;
            const gameContentEl = document.getElementById('game-content');

            // ØªØ¹Ø¯ÙŠÙ„: Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø³Ù…Ø§ÙˆÙŠ) + ØªØµØºÙŠØ± Ø§Ù„Ø®Ø·ÙˆØ·
            gameContentEl.innerHTML = `
                <div id="game-header" class="flex justify-between items-center text-base font-bold p-2 bg-sky-100 rounded-lg shadow-inner z-10 relative">
                    <div class="text-sky-700">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score-display">Ù </span></div>
                    <div class="text-red-600">Ø§Ù„ÙˆÙ‚Øª: <span id="timer-display">Ù </span> Ø«</div>
                </div>
                
                <!-- ØªØ¹Ø¯ÙŠÙ„: ØªØµØºÙŠØ± Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ­Ø°Ù Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ù…Ø§Øª --><div id="question-header" class="flex justify-between items-center mt-1 mb-2">
                    <div class="bg-sky-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow">
                        ${allStages[currentGameLevelIndex].levelTitle}
                    </div>
                    <div class="text-gray-600 text-xs font-bold bg-gray-200 px-3 py-1 rounded-full shadow-inner">
                        Ø§Ù„Ù…Ù‡Ù…Ø© ${toArabicNumerals(currentQuestionIndex + 1)} / ${toArabicNumerals(gameQuestions.length)}
                    </div>
                </div>
                 
                 <!-- ØªØ¹Ø¯ÙŠÙ„: Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© (Ø³Ù…Ø§ÙˆÙŠ) + ØªØµØºÙŠØ± Ø®Ø· Ø§Ù„Ø³Ø¤Ø§Ù„ --><div id="question-area" class="bg-sky-50/70 border border-sky-200 rounded-lg p-3 text-center z-10 relative min-h-[100px] flex flex-col justify-center">
                      <p class="font-bold text-sky-800">Ø§Ù„Ø¬Ø²Ø¡ ${toArabicNumerals(currentStage)} Ù…Ù† Ù¢</p>
                      <!-- ØªØ¹Ø¯ÙŠÙ„: ØªØµØºÙŠØ± Ø®Ø· Ø§Ù„Ø³Ø¤Ø§Ù„ --><p class="text-sm font-semibold text-gray-900 mt-1" id="question-text"></p>
                 </div>
                
                 <div id="options-container" class="grid grid-cols-2 gap-2 z-10 relative"></div>
                 <div id="feedback" class="text-center font-bold p-2 rounded-lg text-sm hidden my-1 z-10 relative"></div>
                 <div id="action-buttons" class="hidden flex justify-center items-center gap-2 z-10 relative"></div>`;
            
            document.getElementById('score-display').textContent = toArabicNumerals(score);
            const timerEl = document.getElementById('timer-display');
            if (timerEl) {
                 timerEl.textContent = toArabicNumerals(Math.floor(totalElapsedTime / 1000));
            }

            const questionTextEl = document.getElementById('question-text');
            const optionsContainerEl = document.getElementById('options-container');

            let part;
            if (currentStage === 1) {
                part = question.part1;
            } else {
                part = question.part2;
            }

            questionTextEl.innerHTML = part.question;
            
            const options = shuffleArray(part.options.slice());
            
            options.forEach(option => {
                const button = document.createElement('button');
                // ØªØ¹Ø¯ÙŠÙ„: Ù„ÙˆÙ† Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ø³Ù…Ø§ÙˆÙŠ)
                button.className = "w-full btn-primary font-bold p-2 rounded-lg shadow-md focus:outline-none flex items-center justify-center min-h-[50px] text-sm text-center";
                button.innerHTML = option; 
                button.onclick = () => checkAnswer(option);
                optionsContainerEl.appendChild(button);
            });

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ø¯ÙŠØ« MathJax Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            if (window.MathJax) {
                MathJax.typesetPromise([gameContentEl]).catch((err) => console.log('MathJax typeset error:', err));
            }

            startTimer();
        }

        function checkAnswer(selectedValue) {
            if (answered) return;
            stopTimer();
            answered = true;
            
            const question = gameQuestions[currentQuestionIndex];
            const feedbackEl = document.getElementById('feedback');
            const actionButtonsEl = document.getElementById('action-buttons');
            let isCorrect = false;

            document.getElementById('options-container').style.display = 'none';
            feedbackEl.classList.remove('hidden');
            actionButtonsEl.classList.remove('hidden');

            let correctAnswer;
            if (currentStage === 1) {
                correctAnswer = question.part1.answer;
            } else {
                correctAnswer = question.part2.answer;
            }
            
            // Ù…Ù‚Ø§Ø±Ù†Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù€ MathJax
            isCorrect = (selectedValue.replace(/\s/g, '') === correctAnswer.replace(/\s/g, ''));

            if (currentStage === 1) {
                if (isCorrect) {
                    feedbackEl.textContent = "Ø£Ø­Ø³Ù†Øª! Ø§Ù„Ù…ØªØ¨Ø§ÙŠÙ†Ø© ØµØ­ÙŠØ­Ø©.";
                } else {
                    // TJR: Added MathJax typesetting for the incorrect answer feedback
                    feedbackEl.innerHTML = `Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: <span class="math-display">${correctAnswer}</span>`;
                     setTimeout(() => {
                        if (window.MathJax) {
                            MathJax.typesetPromise([feedbackEl]).catch((err) => console.log('Feedback MathJax error:', err));
                        }
                    }, 50);
                }
                // ØªØ¹Ø¯ÙŠÙ„: Ø£Ù„ÙˆØ§Ù† Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø© (Ø³Ù…Ø§ÙˆÙŠ Ùˆ Ø²Ù…Ø±Ø¯ÙŠ)
                actionButtonsEl.innerHTML = `<button onclick="goToNextStage()" class="w-1/2 btn-primary font-bold py-2 px-4 rounded-lg shadow-md text-sm">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                                             <button onclick="showExplanation()" class="w-1/2 btn-secondary font-bold py-2 px-4 rounded-lg shadow-md text-sm">Ø§Ø¹Ø±Ù Ù„Ù…Ø§Ø°Ø§ØŸ</button>`;

            } else {
                if (isCorrect) {
                    feedbackEl.textContent = "Ø¥Ø¬Ø§Ø¨Ø© Ù…Ù…ØªØ§Ø²Ø©! Ø§Ù„Ø­Ù„ Ø¯Ù‚ÙŠÙ‚.";
                } else {
                     // TJR: Added MathJax typesetting for the incorrect answer feedback
                    feedbackEl.innerHTML = `Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: <span class="math-display">${correctAnswer}</span>`;
                    setTimeout(() => {
                        if (window.MathJax) {
                            MathJax.typesetPromise([feedbackEl]).catch((err) => console.log('Feedback MathJax error:', err));
                        }
                    }, 50);
                }
                
                const isLastQuestionInLevel = (currentQuestionIndex === gameQuestions.length - 1);
                const isLastLevel = (currentGameLevelIndex === allStages.length - 1);

                let buttonText = "Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©";
                if (isLastQuestionInLevel && !isLastLevel) {
                    buttonText = "Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©";
                } else if (isLastQuestionInLevel && isLastLevel) {
                    buttonText = "Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©";
                }

                // ØªØ¹Ø¯ÙŠÙ„: Ø£Ù„ÙˆØ§Ù† Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø© (Ø³Ù…Ø§ÙˆÙŠ Ùˆ Ø²Ù…Ø±Ø¯ÙŠ)
                actionButtonsEl.innerHTML = `<button onclick="nextQuestion()" class="w-1/2 btn-primary font-bold py-2 px-4 rounded-lg shadow-md text-sm">${buttonText}</button>
                                             <button onclick="showExplanation()" class="w-1/2 btn-secondary font-bold py-2 px-4 rounded-lg shadow-md text-sm">Ø§Ø¹Ø±Ù Ù„Ù…Ø§Ø°Ø§ØŸ</button>`;
            }

            if(isCorrect) {
                score++;
                document.getElementById('score-display').textContent = toArabicNumerals(score);
                feedbackEl.classList.add('feedback-correct');
            } else {
                feedbackEl.classList.add('feedback-incorrect');
            }
        }
        
        function goToNextStage() {
            currentStage = 2;
            loadQuestion();
        }

        function nextQuestion() {
            hideExplanation();
            currentQuestionIndex++;
            
            if (currentQuestionIndex < gameQuestions.length) {
                currentStage = 1;
                loadQuestion();
            } else {
                currentGameLevelIndex++;
                if (currentGameLevelIndex < allStages.length) {
                    loadLevel();
                } else {
                    endGame();
                }
            }
        }

        function endGame() {
            const finalTimeInSeconds = Math.round(totalElapsedTime / 1000);
            // ØªØ¹Ø¯ÙŠÙ„: Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† (Ø³Ù…Ø§ÙˆÙŠ)
             gameScreenEl.innerHTML = `
                 <div class="text-center space-y-3 card-enter p-4">
                 <h1 class="text-2xl font-bold text-sky-700">Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø±Ø­Ù„Ø©!</h1>
                 <p class="text-base">Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ù…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©.</p>
                 
                 <div id="final-result-display" class="bg-gray-100/80 p-3 my-2 rounded-lg shadow-inner">
                 </div>

                 <div id="leaderboard-loader" style="display: none;"></div>
                 <div id="leaderboard-container"></div>
                 
                 <div id="finish-game-wrapper" style="display: none;" class="space-y-2">
                       <!-- ØªØ¹Ø¯ÙŠÙ„: Ù„ÙˆÙ† Ø²Ø± Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ (Ø³Ù…Ø§ÙˆÙŠ) --><button id="finish-game-btn" class="w-full btn-primary font-bold py-3 px-6 rounded-lg shadow-md">
                         Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†ØµØ©
                       </button>
                 </div>
                 <button onclick="window.location.reload()" class="w-full bg-gray-500 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-gray-600 mt-2">
                   Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±Ø­Ù„Ø©
                 </button>
                 </div>`;
            if(window.saveAndFinishGame) {
                window.saveAndFinishGame(score, finalTimeInSeconds);
            }
        }
        
        function showExplanation() {
            const q = gameQuestions[currentQuestionIndex];
            
            if (currentStage === 1) {
                explanationContentEl.innerHTML = q.part1.explanation;
            } else {
                 explanationContentEl.innerHTML = q.part2.explanation;
            }
            
            explanationModalEl.classList.remove('hidden');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ø¯ÙŠØ« MathJax ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø±Ø­
            // Ù†Ø³ØªØ®Ø¯Ù… ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¹Ø±Ø¶
            setTimeout(() => {
                if (window.MathJax) {
                    MathJax.typesetPromise([explanationContentEl]).catch((err) => console.log('Explanation MathJax error:', err));
                }
            }, 50);
        }

        function hideExplanation() {
            explanationModalEl.classList.add('hidden');
        }
    </script>

    <script>
    // --- START OF CONNECTION & LEADERBOARD ENGINE ---
    (function() {
        // --- CONFIGURATION ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
        // ØªØ¹Ø¯ÙŠÙ„: ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù„Ø¹Ø¨Ø©
        const GAME_ID = 'g4_2_2';
        // ØªØ¹Ø¯ÙŠÙ„: 5 Ø£Ø³Ø¦Ù„Ø© * Ù…Ø±Ø­Ù„ØªÙŠÙ† = 10 Ù†Ù‚Ø§Ø·
        const GAME_MAX_POINTS = 10; 
        const PLATFORM_MAX_GRADE = 5;
        const METRIC_TYPE = 'time';
        const METRIC_LABEL = 'Ø§Ù„ÙˆÙ‚Øª (Ø«ÙˆØ§Ù†ÙŠ)';

        // --- Read URL Parameters ---
        const urlParams = new URLSearchParams(window.location.search);
        const studentId = urlParams.get('studentId');
        const classId = urlParams.get('classId');
        const studentName = urlParams.get('studentName');

        let currentUser = (studentId && studentName) ? { id: studentId, name: studentName } : null;

        // --- CORE FUNCTIONS ---

        window.saveAndFinishGame = function(points, metricValue) {
            const finalPoints = parseFloat(points) || 0;
            const finalMetric = parseFloat(metricValue) || 0;
            const maxPoints = parseFloat(GAME_MAX_POINTS) || 1;
            const finalGrade = (finalPoints / maxPoints) * PLATFORM_MAX_GRADE;

            const resultDisplay = document.getElementById('final-result-display');
            if (resultDisplay) {
                // ØªØ¹Ø¯ÙŠÙ„: Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¹Ø±Ø¶ (Ø³Ù…Ø§ÙˆÙŠ)
                resultDisplay.innerHTML = `
                    <div class="flex justify-around text-center">
                        <div>
                            <p class="text-sm">Ø§Ù„Ù†Ù‚Ø§Ø·:</p>
                            <p class="text-2xl font-bold text-sky-600 my-1">${toArabicNumerals(finalPoints)}<span class="text-lg text-gray-600">/${toArabicNumerals(maxPoints)}</span></p>
                        </div>
                        <div>
                            <p class="text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª:</p>
                            <p class="text-2xl font-bold text-red-600 my-1">${toArabicNumerals(finalMetric)} <span class="text-sm">Ø«</span></p>
                        </div>
                    </div>
                    <p class="text-blue-600 mt-3 text-center border-t pt-2">Ø§Ù„Ø¯Ø±Ø¬Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©: <span class="font-bold text-xl">${finalGrade.toFixed(1)} / ${PLATFORM_MAX_GRADE}</span></p>
                `;
            }

            if (studentId && classId) {
                const params = new URLSearchParams({
                    action: 'saveGrade',
                    studentId: studentId,
                    classId: classId,
                    itemId: GAME_ID,
                    grade: finalGrade.toFixed(2),
                    metricValue: Math.round(finalMetric).toString()
                });
                fetch(`${SCRIPT_URL}?${params.toString()}`)
                    .then(res => res.json())
                    .then(result => console.log('Save result:', result.status))
                    .catch(err => console.error("Save Error:", err))
                    .finally(fetchAndShowLeaderboard);
            } else {
                console.log(`Visitor finished. Score: ${finalPoints}, Metric: ${finalMetric}`);
                fetchAndShowLeaderboard();
            }
        }

        function fetchAndShowLeaderboard() {
            const loader = document.getElementById('leaderboard-loader');
            const container = document.getElementById('leaderboard-container');
            if (!loader || !container) return;
            
            if (!classId) {
                console.log("No classId found, skipping leaderboard for visitor.");
                container.innerHTML = `<p class="text-center text-gray-500 mt-4 text-sm">Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ Ù…ØªØ§Ø­ Ù„Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† ÙÙ‚Ø·.</p>`;
                showFinishButton();
                return;
            }

            loader.style.display = 'block';
            container.innerHTML = '';

            const params = new URLSearchParams({
                action: 'getLeaderboard',
                gameId: GAME_ID,
                metricType: METRIC_TYPE,
                classId: classId
            });

            fetch(`${SCRIPT_URL}?${params.toString()}`)
                .then(res => res.json())
                .then(response => {
                    if (response.status === 'success' && response.data) {
                        displayLeaderboard(response.data);
                    } else {
                        throw new Error(response.message || 'Failed to load leaderboard data.');
                    }
                })
                .catch(err => {
                    console.error("Leaderboard Error:", err);
                    container.innerHTML = `<p class="text-center text-red-500 text-sm">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„.</p>`;
                })
                .finally(() => {
                    loader.style.display = 'none';
                    showFinishButton();
                });
        }
        
        function displayLeaderboard(data) {
            const container = document.getElementById('leaderboard-container');
            if (!data || data.length === 0) {
                container.innerHTML = `<p class="text-center text-gray-500 mt-4 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„!</p>`;
                return;
            }

            let tableHTML = `
                <div class="mt-4 border-t pt-2">
                    <h3 class="text-xl font-bold text-center text-gray-800 mb-2">ğŸ† Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ ğŸ†</h3>
                    <div class="leaderboard-scroll">
                        <table class="min-w-full bg-white shadow-md rounded-lg text-sm">
                            <thead class="bg-gray-800 text-white sticky top-0">
                                <tr>
                                    <th class="text-center py-1 px-2">Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                                    <th class="text-right py-1 px-2">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                    <th class="text-center py-1 px-2">Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                                    <th class="text-center py-1 px-2">${METRIC_LABEL}</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-700">`;

            data.forEach((player, index) => {
                const rank = index + 1;
                let rankDisplay = rank;
                if (rank === 1) rankDisplay = 'ğŸ¥‡';
                if (rank === 2) rankDisplay = 'ğŸ¥ˆ';
                if (rank === 3) rankDisplay = 'ğŸ¥‰';

                const isCurrentUser = (currentUser && player.name === currentUser.name);
                // ØªØ¹Ø¯ÙŠÙ„: Ù„ÙˆÙ† Ø§Ù„ØªÙ…ÙŠÙŠØ² (Ø³Ù…Ø§ÙˆÙŠ)
                const rowClass = isCurrentUser ? 'bg-sky-100 font-bold' : (index % 2 === 0 ? 'bg-gray-100' : '');

                tableHTML += `
                    <tr class="${rowClass}">
                        <td class="text-center py-1 px-2 text-lg">${rankDisplay}</td>
                        <td class="text-right py-1 px-2">${player.name}</td>
                        <td class="text-center py-1 px-2">${player.grade.toFixed(1)}</td>
                        <td class="text-center py-1 px-2">${player.metricValue}</td>
                    </tr>`;
            });

            tableHTML += `</tbody></table></div></div>`;
            container.innerHTML = tableHTML;
        }

        function showFinishButton() {
            const finishWrapper = document.getElementById('finish-game-wrapper');
            if (finishWrapper) {
                finishWrapper.style.display = 'block';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            
            const loadingScreen = document.getElementById('loading-screen');
            const startScreen = document.getElementById('start-screen');
            const bgImage = new Image();
            const imageUrl = "https://ablan-math.github.io/img/g4/r&g.png";
            
            bgImage.onload = function() {
                if (loadingScreen) loadingScreen.style.display = 'none';
                if (startScreen) startScreen.classList.remove('hidden');
            };
            
            bgImage.onerror = function() {
                console.error("Background image failed to load.");
                if (loadingScreen) loadingScreen.style.display = 'none';
                if (startScreen) startScreen.classList.remove('hidden');
                document.body.style.backgroundColor = '#2D3748';
            };
            
            bgImage.src = imageUrl;

            const welcomeMessageEl = document.getElementById('welcomeMessage');
            if (studentName && welcomeMessageEl) {
                // ØªØ¹Ø¯ÙŠÙ„: Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ù„Ù„Ø·Ø§Ù„Ø¨
                welcomeMessageEl.innerHTML = `<p class="welcome-text">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ <span class="font-bold text-cyan-300">${studentName}</span>! Ø£Ù†Øª Ø§Ù„Ø¢Ù† ÙÙŠ Ø±Ø­Ù„Ø© Ø¹Ø§Ø¦Ù„ÙŠØ© Ù…Ù…ØªØ¹Ø©. ÙˆØ§Ù„Ø¯Ùƒ ÙŠØ«Ù‚ Ø¨Ùƒ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©.</p>`;
            }
            document.body.addEventListener('click', function(event) {
                if (event.target && event.target.id === 'finish-game-btn') {
                    window.parent.postMessage({ event: 'gameFinished', gameId: GAME_ID }, '*');
                }
            });
        });
    })();
    </script>
</body>
</html>



