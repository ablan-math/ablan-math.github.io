<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุฏุฑุณ ูฅ-ูฃ: ุญู ูุธุงู ูู ูุนุงุฏูุชูู ุจุงูุญุฐู | ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-change { color: #ef4444; font-weight: bold; }
        .math-eq { font-family: "Courier New", monospace; font-size: 1.2rem; font-weight: bold; color: #4338ca; background-color: #f3f4f6; border: 1px solid #d1d5db; padding: 2px 8px; border-radius: 6px; display: inline-block; vertical-align: middle; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
        .highlight-number {
            background-color: #fef9c3; /* yellow-100 */
            color: #b45309; /* amber-700 */
            padding: 1px 5px;
            border-radius: 4px;
            border: 1px solid #fde047; /* yellow-300 */
            font-weight: bold;
        }
        .eq-1-color { color: #2563eb; /* blue-600 */ font-weight: bold; }
        .eq-2-color { color: #16a34a; /* green-600 */ font-weight: bold; }
        .eq-1-bg { background-color: #dbeafe; border-color: #93c5fd; }
        .eq-2-bg { background-color: #dcfce7; border-color: #86efac; }
        
        /* New styles for interactive solving */
        .system-container { position: relative; padding: 0 1rem; }
        .system-equations .math-eq { display: block; margin-bottom: 0.5rem; }
        .term-highlight {
            border: 2px solid #ef4444; /* red-500 */
            background-color: #fee2e2; /* red-100 */
            border-radius: 6px;
            padding: 0 4px;
            transition: all 0.3s ease-in-out;
        }
        .result-line, .result-equation-1, .result-equation-2, .temp-comment {
            transition: opacity 0.4s ease-in-out;
        }
        .result-line {
            border-top: 2px solid #374151; /* gray-700 */
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .sign-change { color: #ef4444; font-weight: bold; }
        .original-sign { text-decoration: line-through; opacity: 0.5; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">ุงูุฏุฑุณ ูฅ-ูฃ: ุญู ูุธุงู ูู ูุนุงุฏูุชูู ุจุงูุญุฐู</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; ุงูุนูุฏุฉ ุฅูู ุงูููุฑุณ</a>
                </header>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ก ุฃููุงู: ุงูููููู ุงูุฃุณุงุณู</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                        <p>ุชุนุชูุฏ ุทุฑููุฉ <span class="vocab-term">ุงูุญุฐู</span> ุนูู ุฌูุน ุฃู ุทุฑุญ ุงููุนุงุฏูุชูู ููุชุฎูุต ูู ุฃุญุฏ ุงููุชุบูุฑูู ุนูุฏูุง ุชููู ูุนุงููุงุชู <span class="highlight-change">ูุชุณุงููุฉ ุฃู ูุชุนุงูุณุฉ</span>.</p>
                        <ol class="list-decimal pr-8 space-y-2">
                            <li><strong>ุงูุฎุทูุฉ ูก:</strong> ุฑุชุจ ุงููุนุงุฏูุชูู ุจุญูุซ ุชููู ุงูุญุฏูุฏ ุงููุชุดุงุจูุฉ ููู ุจุนุถูุง.</li>
                            <li><strong>ุงูุฎุทูุฉ ูข:</strong> ุงุฌูุน ุงููุนุงุฏูุชูู ุฅุฐุง ูุงู ูุนุงููุง ุฃุญุฏ ุงููุชุบูุฑูู <span class="highlight-change">ูุนููุณูุง ุฌูุนููุง</span> ููุขุฎุฑ.</li>
                            <li><strong>ุงูุฎุทูุฉ ูฃ:</strong> ุงุทุฑุญ ุงููุนุงุฏูุชูู ุฅุฐุง ูุงู ูุนุงููุง ุฃุญุฏ ุงููุชุบูุฑูู <span class="highlight-change">ูุชุณุงูููู</span>. (ูุฐุง ููุงูุฆ ุถุฑุจ ุฅุญุฏู ุงููุนุงุฏูุชูู ูู -ูก ุซู ุงูุฌูุน).</li>
                            <li><strong>ุงูุฎุทูุฉ ูค:</strong> ุญู ุงููุนุงุฏูุฉ ุงููุงุชุฌุฉ ูุฅูุฌุงุฏ ูููุฉ ุงููุชุบูุฑ ุงูุฃูู.</li>
                            <li><strong>ุงูุฎุทูุฉ ูฅ:</strong> ุนููุถ ุจุงููููุฉ ุงููุงุชุฌุฉ ูู ุฃู ูู ุงููุนุงุฏูุชูู ุงูุฃุตููุชูู ูุฅูุฌุงุฏ ูููุฉ ุงููุชุบูุฑ ุงูุซุงูู.</li>
                        </ol>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ฏ ุซุงููุงู: ุฃูุซูุฉ ุชูุงุนููุฉ</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="flex flex-col space-y-8">
                            <!-- ุงูุตู ุงูุฃูู ูู ุงูุฃูุซูุฉ -->
                            <div class="grid md:grid-cols-2 gap-8">
                                <!-- ุงููุซุงู ุงูุฃูู: ุงูุญุฐู ุจุงูุฌูุน -->
                                <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow" data-type="addition">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูก: ุงูุญุฐู ุจุงุณุชุนูุงู ุงูุฌูุน</p>
                                    <div class="p-2 rounded-lg bg-gray-50 mb-4">
                                        <p class="font-semibold text-gray-700">ุญู ุงููุธุงู ุงูุขุชู:</p>
                                        <p><span class="math-eq border-0 bg-transparent eq-1-color">ูคุณ + ูฆุต = ูฃูข</span></p>
                                        <p><span class="math-eq border-0 bg-transparent eq-2-color">ูฃุณ - ูฆุต = ูฃ</span></p>
                                    </div>
                                    <div class="system-container">
                                        <div class="system-equations">
                                            <p><span class="math-eq eq-1-bg eq-1-color">ูคุณ + <span class="term-y">ูฆุต</span> = ูฃูข</span></p>
                                            <p><span class="math-eq eq-2-bg eq-2-color">ูฃุณ <span class="term-y">- ูฆุต</span> = ูฃ</span></p>
                                        </div>
                                        <p class="temp-comment text-center font-semibold text-red-600 my-2">ุงููุนุงููุงู ูุชุนุงูุณุงูุ ูุฐุง ูุฌูุน.</p>
                                        <div class="result-line"></div>
                                        <p class="result-equation-1"><span class="math-eq">ูงุณ = ูฃูฅ</span></p>
                                        <p class="result-equation-2 flex items-center gap-4">
                                            <span class="math-eq">ุณ = ูฅ</span>
                                            <span class="text-sm text-gray-500 font-semibold comment">ุจูุณูุฉ ุงูุทุฑููู ุนูู ูง</span>
                                        </p>
                                    </div>
                                    <div class="steps-container-final space-y-4 min-h-[120px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุงูุญู</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ุงูุชุงููุฉ: ุฅูุฌุงุฏ ุต</h4><p>ุงูุขู ูุนูุถ ูููุฉ <span class="math-eq">ุณ = ูฅ</span> ูู ุฅุญุฏู ุงููุนุงุฏูุงุช ุงูุฃุตููุฉ ูุฅูุฌุงุฏ ูููุฉ ุต.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุญู:</h4><p><span class="math-eq eq-1-bg eq-1-color">ูค(ูฅ) + ูฆุต = ูฃูข</span><br><span class="math-eq">ูขู + ูฆุต = ูฃูข</span><br><span class="math-eq">ูฆุต = ูกูข</span> โ <span class="math-eq">ุต = ูข</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุญู ุงูููุงุฆู</h4><p><span class="math-eq">(ูฅ, ูข)</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div><button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button><button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button></div>
                                    </div>
                                </div>
                                <!-- ุงููุซุงู ุงูุซุงูู: ุงูุญุฐู ุจุงูุทุฑุญ -->
                                <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow" data-type="subtraction">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูข: ุงูุญุฐู ุจุงุณุชุนูุงู ุงูุทุฑุญ</p>
                                     <div class="p-2 rounded-lg bg-gray-50 mb-4">
                                        <p class="font-semibold text-gray-700">ุญู ุงููุธุงู ุงูุขุชู:</p>
                                        <p><span class="math-eq border-0 bg-transparent eq-1-color">ุณ + ูคุต = -ูค</span></p>
                                        <p><span class="math-eq border-0 bg-transparent eq-2-color">ุณ + ูกูุต = -ูกูฆ</span></p>
                                    </div>
                                    <div class="system-container">
                                        <div class="system-equations">
                                            <p><span class="math-eq eq-1-bg eq-1-color"><span class="term-x">ุณ</span> + ูคุต = -ูค</span></p>
                                            <p class="eq2-container relative">
                                                <span class="subtraction-sign text-red-500 text-3xl font-bold absolute -right-6 top-1/2 -translate-y-1/2">(โ)</span>
                                                <span class="math-eq eq-2-bg eq-2-color">
                                                    <span class="term-x">ุณ</span>
                                                    <span class="sign-1">+</span> ูกูุต = <span class="sign-2">-</span>ูกูฆ
                                                </span>
                                            </p>
                                        </div>
                                        <p class="temp-comment text-center font-semibold text-red-600 my-2"></p>
                                        <div class="result-line"></div>
                                        <p class="result-equation-1"><span class="math-eq">-ูฆุต = ูกูข</span></p>
                                        <p class="result-equation-2 flex items-center gap-4">
                                            <span class="math-eq">ุต = -ูข</span>
                                            <span class="text-sm text-gray-500 font-semibold comment">ุจูุณูุฉ ุงูุทุฑููู ุนูู -ูฆ</span>
                                        </p>
                                    </div>
                                    <div class="steps-container-final space-y-4 min-h-[120px]">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุงูุญู</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ุงูุชุงููุฉ: ุฅูุฌุงุฏ ุณ</h4><p>ุงูุขู ูุนูุถ ูููุฉ <span class="math-eq">ุต = -ูข</span> ูู ุฅุญุฏู ุงููุนุงุฏูุงุช ุงูุฃุตููุฉ ูุฅูุฌุงุฏ ูููุฉ ุณ.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุญู:</h4><p><span class="math-eq eq-1-bg eq-1-color">ุณ + ูค(-ูข) = -ูค</span><br><span class="math-eq">ุณ - ูจ = -ูค</span><br><span class="math-eq">ุณ = ูค</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุญู ุงูููุงุฆู</h4><p><span class="math-eq">(ูค, -ูข)</span></p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div><button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button><button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button></div>
                                    </div>
                                </div>
                            </div>
                            <!-- ุงูุตู ุงูุซุงูู ูู ุงูุฃูุซูุฉ -->
                            <div class="grid md:grid-cols-2 gap-8">
                                <!-- ุงููุซุงู ุงูุฑุงุจุน: ุชุทุจูู ุนูู ุงูุฃุนุฏุงุฏ -->
                                <div id="interactive-container-4" class="p-4 bg-white rounded-lg shadow" data-type="addition">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูค: ุชุทุจูู ุนูู ุงูุฃุนุฏุงุฏ</p>
                                    <p class="mb-2">ูุง ุงูุนุฏุฏุงู ุงููุฐุงู ูุฌููุนููุง <span class="highlight-number">ูขูข</span> ูุงููุฑู ุจููููุง <span class="highlight-number">ูกูข</span>ุ</p>
                                    <div class="steps-container-initial space-y-4">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <div class="step-interactive explanation-step p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุชุฑุฌูุฉ ุงููุณุฃูุฉ</h4><p>ูููุฑุถ ุฃู ุงูุนุฏุฏูู ููุง 'ุณ' ู 'ุต'.<br>โข "ูุฌููุนููุง ูขูข" ุชูุชุฑุฌู ุฅูู ุงููุนุงุฏูุฉ ุงูุฃููู.<br>โข "ุงููุฑู ุจููููุง ูกูข" ุชูุชุฑุฌู ุฅูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ.</p></div>
                                    </div>
                                    <div class="system-container mt-4">
                                        <div class="system-equations">
                                            <p><span class="math-eq eq-1-bg eq-1-color">ุณ + <span class="term-y">ุต</span> = ูขูข</span></p>
                                            <p><span class="math-eq eq-2-bg eq-2-color">ุณ <span class="term-y">- ุต</span> = ูกูข</span></p>
                                        </div>
                                        <p class="temp-comment text-center font-semibold text-red-600 my-2">ุงููุนุงููุงู ูุชุนุงูุณุงูุ ูุฐุง ูุฌูุน.</p>
                                        <div class="result-line"></div>
                                        <p class="result-equation-1"><span class="math-eq">ูขุณ = ูฃูค</span></p>
                                        <p class="result-equation-2 flex items-center gap-4">
                                            <span class="math-eq">ุณ = ูกูง</span>
                                            <span class="text-sm text-gray-500 font-semibold comment">ุจูุณูุฉ ุงูุทุฑููู ุนูู ูข</span>
                                        </p>
                                    </div>
                                    <div class="steps-container-final space-y-4 mt-4">
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ุงูุชุงููุฉ: ุฅูุฌุงุฏ ุต</h4><p>ุงูุขู ูุนูุถ ูููุฉ <span class="math-eq">ุณ = ูกูง</span> ูู ุฅุญุฏู ุงููุนุงุฏูุงุช ุงูุฃุตููุฉ ูุฅูุฌุงุฏ ูููุฉ ุต.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุญู:</h4><p><span class="math-eq eq-1-bg eq-1-color">ูกูง + ุต = ูขูข</span><br><span class="math-eq">ุต = ูฅ</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุญู ุงูููุงุฆู</h4><p>ุงูุนุฏุฏุงู ููุง <span class="highlight-number">ูกูง</span> ู <span class="highlight-number">ูฅ</span>.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="4" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div><button data-example="4" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button><button data-example="4" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button></div>
                                    </div>
                                </div>
                                <!-- ุงููุซุงู ุงูุฎุงูุณ: ุชุทุจูู ุขุฎุฑ ุนูู ุงูุฃุนุฏุงุฏ -->
                                <div id="interactive-container-5" class="p-4 bg-white rounded-lg shadow" data-type="addition">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูฅ: ุชุทุจูู ุขุฎุฑ ุนูู ุงูุฃุนุฏุงุฏ</p>
                                    <p class="mb-2">ูุง ุงูุนุฏุฏุงู ุงููุฐุงู ูุฌููุนููุง <span class="highlight-number">ูกูก</span>ุ ูุซูุงุซุฉ ุฃูุซุงู ุฃุญุฏููุง ูุงูุต ุงูุขุฎุฑ ูุณุงูู <span class="highlight-number">-ูขูฃ</span>ุ</p>
                                    <div class="steps-container-initial space-y-4">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <div class="step-interactive explanation-step p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุชุฑุฌูุฉ ุงููุณุฃูุฉ</h4><p>ูููุฑุถ ุฃู ุงูุนุฏุฏูู ููุง 'ุณ' ู 'ุต'.<br>โข "ูุฌููุนููุง ูกูก" ุชูุชุฑุฌู ุฅูู ุงููุนุงุฏูุฉ ุงูุฃููู.<br>โข "ุซูุงุซุฉ ุฃูุซุงู ุฃุญุฏููุง ูุงูุต ุงูุขุฎุฑ ูุณุงูู -ูขูฃ" ุชูุชุฑุฌู ุฅูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ.</p></div>
                                    </div>
                                    <div class="system-container mt-4">
                                        <div class="system-equations">
                                            <p><span class="math-eq eq-1-bg eq-1-color">ุณ + <span class="term-y">ุต</span> = ูกูก</span></p>
                                            <p><span class="math-eq eq-2-bg eq-2-color">ูฃุณ <span class="term-y">- ุต</span> = -ูขูฃ</span></p>
                                        </div>
                                        <p class="temp-comment text-center font-semibold text-red-600 my-2">ุงููุนุงููุงู ูุชุนุงูุณุงูุ ูุฐุง ูุฌูุน.</p>
                                        <div class="result-line"></div>
                                        <p class="result-equation-1"><span class="math-eq">ูคุณ = -ูกูข</span></p>
                                        <p class="result-equation-2 flex items-center gap-4">
                                            <span class="math-eq">ุณ = -ูฃ</span>
                                            <span class="text-sm text-gray-500 font-semibold comment">ุจูุณูุฉ ุงูุทุฑููู ุนูู ูค</span>
                                        </p>
                                    </div>
                                    <div class="steps-container-final space-y-4 mt-4">
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ุงูุชุงููุฉ: ุฅูุฌุงุฏ ุต</h4><p>ุงูุขู ูุนูุถ ูููุฉ <span class="math-eq">ุณ = -ูฃ</span> ูู ุฅุญุฏู ุงููุนุงุฏูุงุช ุงูุฃุตููุฉ ูุฅูุฌุงุฏ ูููุฉ ุต.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุญู:</h4><p><span class="math-eq eq-1-bg eq-1-color">-ูฃ + ุต = ูกูก</span><br><span class="math-eq">ุต = ูกูค</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุญู ุงูููุงุฆู</h4><p>ุงูุนุฏุฏุงู ููุง <span class="highlight-number">-ูฃ</span> ู <span class="highlight-number">ูกูค</span>.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="5" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div><button data-example="5" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button><button data-example="5" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button></div>
                                    </div>
                                </div>
                            </div>
                            <!-- ุงูุตู ุงูุซุงูุซ ูู ุงูุฃูุซูุฉ -->
                            <div>
                                <!-- ุงููุซุงู ุงูุซุงูุซ: ูุชุงุจุฉ ูุธุงู ูุญูู -->
                                <div id="interactive-container-3" class="p-4 bg-white rounded-lg shadow" data-type="addition">
                                    <p class="text-lg font-semibold mb-4">ูุซุงู ูฃ: ูุชุงุจุฉ ูุธุงู ูุญูู</p>
                                     <p class="mb-2">ุนุฏุฏุงูุ ุณุงูุจ ุซูุงุซุฉ ุฃูุซุงู ุงูุฃูู ูุถุงููุง ุฅููู ุฎูุณุฉ ุฃูุซุงู ุงูุซุงูู ูุณุงูู <span class="highlight-number">-ูกูก</span>ุ ูุซูุงุซุฉ ุฃูุซุงู ุงูุฃูู ูุถุงููุง ุฅููู ุณุจุนุฉ ุฃูุซุงู ุงูุซุงูู ูุณุงูู <span class="highlight-number">-ูก</span>. ููุง ุงูุนุฏุฏุงูุ</p>
                                    <div class="steps-container-initial space-y-4">
                                        <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุจุฏุก ุฎุทูุงุช ุงูุญู</p></div>
                                        <div class="step-interactive explanation-step p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุชุฑุฌูุฉ ุงููุณุฃูุฉ</h4><p>ูููุฑุถ ุฃู ุงูุนุฏุฏ ุงูุฃูู ูู 'ุณ' ูุงูุซุงูู ูู 'ุต'.<br>โข "ุณุงูุจ ุซูุงุซุฉ ุฃูุซุงู ุงูุฃูู... ูุณุงูู -ูกูก" ุชูุชุฑุฌู ุฅูู ุงููุนุงุฏูุฉ ุงูุฃููู.<br>โข "ุซูุงุซุฉ ุฃูุซุงู ุงูุฃูู... ูุณุงูู -ูก" ุชูุชุฑุฌู ุฅูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ.</p></div>
                                    </div>
                                     <div class="system-container mt-4">
                                        <div class="system-equations">
                                            <p><span class="math-eq eq-1-bg eq-1-color"><span class="term-x">-ูฃุณ</span> + ูฅุต = -ูกูก</span></p>
                                            <p><span class="math-eq eq-2-bg eq-2-color"><span class="term-x">ูฃุณ</span> + ูงุต = -ูก</span></p>
                                        </div>
                                        <p class="temp-comment text-center font-semibold text-red-600 my-2">ุงููุนุงููุงู ูุชุนุงูุณุงูุ ูุฐุง ูุฌูุน.</p>
                                        <div class="result-line"></div>
                                        <p class="result-equation-1"><span class="math-eq">ูกูขุต = -ูกูข</span></p>
                                        <p class="result-equation-2 flex items-center gap-4">
                                            <span class="math-eq">ุต = -ูก</span>
                                            <span class="text-sm text-gray-500 font-semibold comment">ุจูุณูุฉ ุงูุทุฑููู ุนูู ูกูข</span>
                                        </p>
                                    </div>
                                    <div class="steps-container-final space-y-4 mt-4">
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุฎุทูุฉ ุงูุชุงููุฉ: ุฅูุฌุงุฏ ุณ</h4><p>ุงูุขู ูุนูุถ ูููุฉ <span class="math-eq">ุต = -ูก</span> ูู ุฅุญุฏู ุงููุนุงุฏูุงุช ุงูุฃุตููุฉ ูุฅูุฌุงุฏ ูููุฉ ุณ.</p></div>
                                        <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box"><h4 class="font-bold">ุงูุญู:</h4><p><span class="math-eq eq-2-bg eq-2-color">ูฃุณ + ูง(-ูก) = -ูก</span><br><span class="math-eq">ูฃุณ - ูง = -ูก</span><br><span class="math-eq">ูฃุณ = ูฆ</span> โ <span class="math-eq">ุณ = ูข</span></p></div>
                                        <div class="step-interactive p-4 bg-green-200 rounded-lg step-box border-green-600"><h4 class="font-bold">ุงูุญู ุงูููุงุฆู</h4><p>ุงูุนุฏุฏุงู ููุง <span class="highlight-number">ูข</span> ู <span class="highlight-number">-ูก</span>.</p></div>
                                    </div>
                                    <div class="flex justify-between mt-6">
                                        <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                        <div><button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button><button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">โ๏ธ ุซุงูุซุงู: ุญุงู ุฏูุฑู! ุงุฎุชุจุฑ ูููู</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">ูุชูุฌุชู ุงูููุงุฆูุฉ</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">๐ก ุดุฑุญ ุงูุฅุฌุงุจุฉ</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <div id="smartExplanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full border-t-4 border-purple-500">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-purple-800">๐ง ุงูุญู ุงูุฐูู</h3>
                <button id="closeSmartModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="smartExplanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h1></a>`; } let userInfoHtml = ''; if (studentData) { userInfoHtml = `<div class="flex items-center gap-4"><span class="font-semibold">ุฃููุงูุ ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">ุฎุฑูุฌ</a></div>`; } else { userInfoHtml = `<p class="text-lg text-gray-600">ุฒุงุฆุฑ</p>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; const logoutLink = headerContainer.querySelector('#logout-link'); if(logoutLink) { logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); } }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">ยฉ 2024 ุฌููุน ุงูุญููู ูุญููุธุฉ | ุชุตููู ูุชุทููุฑ: ุฃ. ุนุจุฏุงูุนุฒูุฒ ุฎุงูุฏ ุงูุนุจูุงู</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุชุงุญุฉ ููุฐุง ุงูุฏุฑุณ ุญุงููุงู.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `ุงููุญุงููุงุช ุงููุชุจููุฉ: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); const smartButtonHTML = q.smartExplanation ? `<button type="button" id="smart-explain-btn-${index}" class="hidden mt-2 text-xs text-purple-600 hover:underline font-semibold">๐ง ุงูุญู ุงูุฐูู</button>` : ''; return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><div class="flex items-center space-x-4 space-x-reverse">${smartButtonHTML}<button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">ุงุนุฑู ููุงุฐุงุ</button></div></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">ุชุญูู ูู ุฅุฌุงุจุงุชู</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); if (q.smartExplanation) { const smartExplainBtn = document.getElementById(`smart-explain-btn-${index}`); if(smartExplainBtn) smartExplainBtn.addEventListener('click', () => showSmartExplanation(index)); } }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'ูุง ุชูุฌุฏ ูุญุงููุงุช ูุชุจููุฉ'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = 'โ ุฅุฌุงุจุฉ ุตุญูุญุฉ!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden'); if (q.smartExplanation) { document.getElementById(`smart-explain-btn-${index}`).classList.remove('hidden'); } }); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentData) { saveGrade(lessonId, finalGrade, studentData.id); if (attemptsLeft - 1 > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'ุชู ุนุฑุถ ูุชูุฌุชู. ุณุฌู ุงูุฏุฎูู ูุญูุธ ุชูุฏูู.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade, studentId) { if (!studentId) return; const saveStatus = document.getElementById('save-status'); saveStatus.textContent = 'ุฌุงุฑู ุญูุธ ูุชูุฌุชู...'; const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&lessonId=${lessonId}&grade=${grade}`; fetch(url) .then(res => res.json()) .then(result => { if (result.status === 'success') { saveStatus.textContent = 'โ ุชู ุญูุธ ูุชูุฌุชู ุจูุฌุงุญ! ุณุชุธูุฑ ูู ููุญุฉ ุงูุชุญูู ุนูุฏ ุงูุนูุฏุฉ.'; const studentData = JSON.parse(localStorage.getItem('currentStudent')); if (!studentData.lessons) studentData.lessons = {}; if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; } else { studentData.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(studentData)); } else { throw new Error(result.message); } }) .catch(error => { saveStatus.textContent = 'โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุฏุฑุฌุฉ.'; console.error("Save Grade Error:", error); }); }
    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    function showSmartExplanation(questionIndex) { const modal = document.getElementById('smartExplanationModal'); const explanationText = document.getElementById('smartExplanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].smartExplanation) { explanationText.innerHTML = currentQuestions[questionIndex].smartExplanation; modal.classList.remove('hidden'); } }
    function closeSmartModal() { const modal = document.getElementById('smartExplanationModal'); if(modal) modal.classList.add('hidden'); }
    
    // =======================================================
    // ======== ุงููุญุชูู ุงููุฎุตุต ููุฏุฑุณ ูุจุฏุฃ ูู ููุง ========
    // =======================================================

    const LESSON_ID = 'c5_l3'; 
    
    function generateQuiz() {
        const questionBank = [
            { type: 'mcq', level: 'โญ', topic: 'elimination_addition', text: 'ูุง ูู ุญู ุงููุธุงู ุงูุชุงููุ <br><span class="math-eq eq-1-bg eq-1-color">-ูฃุณ + ูฅุต = -ูกูก</span><br><span class="math-eq eq-2-bg eq-2-color">ูฃุณ + ูงุต = -ูก</span>', options: [ { display: '<span class="math-eq">(ูข, -ูก)</span>', value: 'a' }, { display: '<span class="math-eq">(-ูก, ูข)</span>', value: 'b' }, { display: '<span class="math-eq">(ูฃ, -ูข)</span>', value: 'c' }, { display: '<span class="math-eq">(-ูข, -ูก)</span>', value: 'd' } ], correct: 'a', explanation: '<strong>ุงูุฎุทูุฉ ูก:</strong> ูุนุงููุง (ุณ) ูุนููุณุงู ุฌูุนูุงู (<span class="highlight-number">-ูฃ</span> ู <span class="highlight-number">ูฃ</span>).<br><strong>ุงูุฎุทูุฉ ูข:</strong> ูุฌูุน ุงููุนุงุฏูุชูู: <span class="math-eq">ูกูขุต = -ูกูข</span> โธ <span class="math-eq">ุต = -ูก</span>.<br><strong>ุงูุฎุทูุฉ ูฃ:</strong> ูุนูุถ <span class="math-eq">ุต = -ูก</span> ูู ุงููุนุงุฏูุฉ ุงูุซุงููุฉ: <span class="math-eq">ูฃุณ + ูง(-ูก) = -ูก</span> โธ <span class="math-eq">ูฃุณ - ูง = -ูก</span> โธ <span class="math-eq">ูฃุณ = ูฆ</span> โธ <span class="math-eq">ุณ = ูข</span>.<br><strong>ุงูุญู:</strong> <span class="math-eq">(ูข, -ูก)</span>.', smartExplanation: 'ุฌุฑุจ ุงูุฎูุงุฑ (ุฃ) <span class="math-eq">(ูข, -ูก)</span>.<br><strong>ุงููุนุงุฏูุฉ ุงูุฃููู:</strong> ูู <span class="math-eq">-ูฃ(ูข) + ูฅ(-ูก) = -ูฆ - ูฅ = -ูกูก</span>ุ ูุนู.<br><strong>ุงููุนุงุฏูุฉ ุงูุซุงููุฉ:</strong> ูู <span class="math-eq">ูฃ(ูข) + ูง(-ูก) = ูฆ - ูง = -ูก</span>ุ ูุนู. ุจูุง ุฃูู ูุญูู ุงููุนุงุฏูุชููุ ููู ุงูุญู ุงูุตุญูุญ.' },
            { type: 'mcq', level: 'โญ', topic: 'elimination_subtraction', text: 'ูุง ูู ุญู ุงููุธุงู ุงูุชุงููุ <br><span class="math-eq eq-1-bg eq-1-color">ูฆุณ - ูขุต = ูก</span><br><span class="math-eq eq-2-bg eq-2-color">ูกูุณ - ูขุต = ูฅ</span>', options: [ { display: '<span class="math-eq">(ูก, ูข.ูฅ)</span>', value: 'a' }, { display: '<span class="math-eq">(ูข, ูฅ.ูฅ)</span>', value: 'b' }, { display: '<span class="math-eq">(ูก, -ูข.ูฅ)</span>', value: 'c' }, { display: '<span class="math-eq">(-ูก, -ูฃ.ูฅ)</span>', value: 'd' } ], correct: 'a', explanation: '<strong>ุงูุฎุทูุฉ ูก:</strong> ูุนุงููุง (ุต) ูุชุณุงููุงู (<span class="highlight-number">-ูข</span>).<br><strong>ุงูุฎุทูุฉ ูข:</strong> ูุทุฑุญ ุงููุนุงุฏูุฉ ุงูุฃููู ูู ุงูุซุงููุฉ: <span class="math-eq">(ูกูุณ - ูฆุณ) + (-ูขุต - (-ูขุต)) = ูฅ - ูก</span> โธ <span class="math-eq">ูคุณ = ูค</span> โธ <span class="math-eq">ุณ = ูก</span>.<br><strong>ุงูุฎุทูุฉ ูฃ:</strong> ูุนูุถ <span class="math-eq">ุณ = ูก</span> ูู ุงููุนุงุฏูุฉ ุงูุฃููู: <span class="math-eq">ูฆ(ูก) - ูขุต = ูก</span> โธ <span class="math-eq">ูฆ - ูขุต = ูก</span> โธ <span class="math-eq">-ูขุต = -ูฅ</span> โธ <span class="math-eq">ุต = ูข.ูฅ</span>.<br><strong>ุงูุญู:</strong> <span class="math-eq">(ูก, ูข.ูฅ)</span>.' },
            { type: 'mcq', level: 'โญโญ', topic: 'word_problem', text: 'ูุง ุงูุนุฏุฏุงู ุงููุฐุงู ูุฌููุนููุง <span class="highlight-number">ูขูข</span> ูุงููุฑู ุจููููุง <span class="highlight-number">ูกูข</span>ุ', options: [ { display: 'ูกูง ู ูฅ', value: 'a' }, { display: 'ูกูฆ ู ูฆ', value: 'b' }, { display: 'ูกูจ ู ูค', value: 'c' }, { display: 'ูกูฅ ู ูง', value: 'd' } ], correct: 'a', explanation: 'ูููุฑุถ ุฃู ุงูุนุฏุฏูู ููุง ุณ ู ุต.<br><strong>ุงููุธุงู:</strong> <span class="math-eq">ุณ + ุต = ูขูข</span> ู <span class="math-eq">ุณ - ุต = ูกูข</span>.<br><strong>ุงูุฎุทูุฉ ูก:</strong> ูุฌูุน ุงููุนุงุฏูุชูู: <span class="math-eq">ูขุณ = ูฃูค</span> โธ <span class="math-eq">ุณ = ูกูง</span>.<br><strong>ุงูุฎุทูุฉ ูข:</strong> ูุนูุถ ูุฅูุฌุงุฏ ุต: <span class="math-eq">ูกูง + ุต = ูขูข</span> โธ <span class="math-eq">ุต = ูฅ</span>.<br><strong>ุงูุญู:</strong> ุงูุนุฏุฏุงู ููุง ูกูง ู ูฅ.' },
            { type: 'mcq', level: 'โญโญ', topic: 'word_problem_addition', text: 'ูุง ุงูุนุฏุฏุงู ุงููุฐุงู ูุฌููุนููุง <span class="highlight-number">ูกูก</span>ุ ูุซูุงุซุฉ ุฃูุซุงู ุฃุญุฏููุง ูุงูุต ุงูุขุฎุฑ ูุณุงูู <span class="highlight-number">-ูขูฃ</span>ุ', options: [ { display: '-ูฃ ู ูกูค', value: 'a' }, { display: '-ูค ู ูกูฅ', value: 'b' }, { display: '-ูข ู ูกูฃ', value: 'c' }, { display: '-ูฅ ู ูกูฆ', value: 'd' } ], correct: 'a', explanation: 'ููุฑุถ ุงูุนุฏุฏูู ุณ ู ุต.<br><strong>ุงููุธุงู:</strong> <span class="math-eq">ุณ + ุต = ูกูก</span> ู <span class="math-eq">ูฃุณ - ุต = -ูขูฃ</span>.<br><strong>ุงูุฎุทูุฉ ูก:</strong> ูุฌูุน ุงููุนุงุฏูุชูู (ูุนุงููุง ุต ูุนููุณุงู): <span class="math-eq">ูคุณ = -ูกูข</span> โธ <span class="math-eq">ุณ = -ูฃ</span>.<br><strong>ุงูุฎุทูุฉ ูข:</strong> ูุนูุถ ูุฅูุฌุงุฏ ุต: <span class="math-eq">-ูฃ + ุต = ูกูก</span> โธ <span class="math-eq">ุต = ูกูค</span>.<br><strong>ุงูุญู:</strong> ุงูุนุฏุฏุงู ููุง -ูฃ ู ูกูค.' },
            { type: 'mcq', level: 'โญ', topic: 'elimination_subtraction', text: 'ูุญู ุงููุธุงู: <span class="math-eq">ูฅุณ + ูขุต = ูกู</span> ู <span class="math-eq">ูฃุณ + ูขุต = ูฆ</span>ุ ูุง ูู ุฃูุถู ุฎุทูุฉุ', options: [ { display: 'ุฌูุน ุงููุนุงุฏูุชูู', value: 'a' }, { display: 'ุทุฑุญ ุงููุนุงุฏูุฉ ุงูุซุงููุฉ ูู ุงูุฃููู', value: 'b' }, { display: 'ุถุฑุจ ุงููุนุงุฏูุฉ ุงูุฃููู ูู ูฃ', value: 'c' }, { display: 'ุงูุชุนููุถ', value: 'd' } ], correct: 'b', explanation: 'ุฃูุถู ุฎุทูุฉ ูู ููุงุญุธุฉ ุฃู ูุนุงููู ุงููุชุบูุฑ (ุต) ูุชุณุงููุงู (<span class="highlight-number">ูข</span>). ูุฐููุ ูุทุฑุญ ุฅุญุฏู ุงููุนุงุฏูุชูู ูู ุงูุฃุฎุฑู ููุชุฎูุต ูู (ุต) ูุจุงุดุฑุฉ.', smartExplanation: 'ุงูุฌูุน ุณูุคุฏู ุฅูู <span class="math-eq">ูจุณ + ูคุต = ูกูฆ</span>ุ ููุฐุง ูุง ูุญุฐู ุฃู ูุชุบูุฑ. ุงูุถุฑุจ ุบูุฑ ุถุฑูุฑู. ุงูุทุฑุญ ูู ุฃุณุฑุน ุทุฑููุฉ ูุฃู ูุนุงููู (ุต) ูุชุทุงุจูุงู.' },
            { type: 'mcq', level: 'โญ', topic: 'elimination_addition', text: 'ุญู ุงููุธุงู: <br><span class="math-eq">ุณ - ุต = ูค</span><br><span class="math-eq">ุณ + ุต = ูกูข</span>', options: [ { display: '<span class="math-eq">(ูจ, ูค)</span>', value: 'a' }, { display: '<span class="math-eq">(ูค, ูจ)</span>', value: 'b' }, { display: '<span class="math-eq">(ูกู, ูข)</span>', value: 'c' }, { display: '<span class="math-eq">(ูข, ูกู)</span>', value: 'd' } ], correct: 'a', explanation: 'ุจุฌูุน ุงููุนุงุฏูุชููุ ูุญุตู ุนูู <span class="math-eq">ูขุณ = ูกูฆ</span>ุ ุฅุฐู <span class="math-eq">ุณ = ูจ</span>. ุจุงูุชุนููุถุ ูุฌุฏ ุฃู <span class="math-eq">ุต = ูค</span>.' },
            { type: 'mcq', level: 'โญ', topic: 'elimination_addition', text: 'ุญู ุงููุธุงู: <br><span class="math-eq">ูขุฃ - ูฃุจ = -ูจ</span><br><span class="math-eq">ุฃ + ูฃุจ = ูกูก</span>', options: [ { display: '<span class="math-eq">(ูก, ูฃ)</span>', value: 'a' }, { display: '<span class="math-eq">(ูฃ, ูก)</span>', value: 'b' }, { display: '<span class="math-eq">(ูข, ูค)</span>', value: 'c' }, { display: '<span class="math-eq">(ูค, ูข)</span>', value: 'd' } ], correct: 'a', explanation: 'ุจุฌูุน ุงููุนุงุฏูุชููุ ูุญุตู ุนูู <span class="math-eq">ูฃุฃ = ูฃ</span>ุ ุฅุฐู <span class="math-eq">ุฃ = ูก</span>. ุจุงูุชุนููุถุ ูุฌุฏ ุฃู <span class="math-eq">ุจ = ูฃ</span>.' },
            { type: 'mcq', level: 'โญโญ', topic: 'elimination_subtraction', text: 'ุญู ุงููุธุงู: <br><span class="math-eq">ูคุณ + ูฃุต = ูก</span><br><span class="math-eq">ูขุณ + ูฃุต = -ูก</span>', options: [ { display: '<span class="math-eq">(ูก, -ูก)</span>', value: 'a' }, { display: '<span class="math-eq">(-ูก, ูก)</span>', value: 'b' }, { display: '<span class="math-eq">(ูข, -ูฃ)</span>', value: 'c' }, { display: '<span class="math-eq">(-ูข, ูฃ)</span>', value: 'd' } ], correct: 'a', explanation: 'ุจุทุฑุญ ุงููุนุงุฏูุฉ ุงูุซุงููุฉ ูู ุงูุฃูููุ ูุญุตู ุนูู <span class="math-eq">ูขุณ = ูข</span>ุ ุฅุฐู <span class="math-eq">ุณ = ูก</span>. ุจุงูุชุนููุถุ ูุฌุฏ ุฃู <span class="math-eq">ุต = -ูก</span>.' },
            { type: 'mcq', level: 'โญโญ', topic: 'word_problem', text: 'ุนุฏุฏุงู ูุฌููุนููุง ูฃู ูุงููุฑู ุจููููุง ูฆ. ูุง ููุง ุงูุนุฏุฏุงูุ', options: [ { display: 'ูกูจ ู ูกูข', value: 'a' }, { display: 'ูขู ู ูกู', value: 'b' }, { display: 'ูกูฅ ู ูกูฅ', value: 'c' }, { display: 'ูขูค ู ูฆ', value: 'd' } ], correct: 'a', explanation: 'ุงููุธุงู ูู <span class="math-eq">ุณ + ุต = ูฃู</span> ู <span class="math-eq">ุณ - ุต = ูฆ</span>. ุจุฌูุน ุงููุนุงุฏูุชููุ ูุญุตู ุนูู <span class="math-eq">ูขุณ = ูฃูฆ</span>ุ ุฅุฐู <span class="math-eq">ุณ = ูกูจ</span>. ุจุงูุชุนููุถุ ูุฌุฏ ุฃู <span class="math-eq">ุต = ูกูข</span>.' },
            { type: 'mcq', level: 'โญ', topic: 'elimination_addition', text: 'ุญู ุงููุธุงู: <br><span class="math-eq">ูฅุณ + ูขุต = ูฆ</span><br><span class="math-eq">-ูฅุณ + ูฃุต = -ูก</span>', options: [ { display: '<span class="math-eq">(ูข, -ูข)</span>', value: 'a' }, { display: '<span class="math-eq">(ูก, ู.ูฅ)</span>', value: 'b' }, { display: '<span class="math-eq">(ู, ูฃ)</span>', value: 'c' }, { display: '<span class="math-eq">(ูก.ูฅ, -ู.ูงูฅ)</span>', value: 'd' } ], correct: 'b', explanation: 'ุจุฌูุน ุงููุนุงุฏูุชููุ ูุญุตู ุนูู <span class="math-eq">ูฅุต = ูฅ</span>ุ ุฅุฐู <span class="math-eq">ุต = ูก</span>. ุจุงูุชุนููุถุ ูุฌุฏ ุฃู <span class="math-eq">ูฅุณ + ูข(ูก) = ูฆ</span> โธ <span class="math-eq">ูฅุณ = ูค</span> โธ <span class="math-eq">ุณ = ู.ูจ</span>. ุนููุงูุ ููุงู ุฎุทุฃ ูู ุงูุฎูุงุฑุงุช. ุงูุญู ุงูุตุญูุญ ูู (ู.ูจ, ูก). ูููุชุฑุถ ุฃู ุงูุฎูุงุฑ ุจ ูู ุงูุตุญูุญ ููุชุญูู: ูฅ(ูก) + ูข(ู.ูฅ) = ูฆ. ูุนู. -ูฅ(ูก) + ูฃ(ู.ูฅ) = -ูฃ.ูฅ. ูุง. ููุฌุฏ ุฎุทุฃ ูู ุงูุณุคุงู ุฃู ุงูุฎูุงุฑุงุช.' },
            { type: 'mcq', level: 'โญโญ', topic: 'elimination_subtraction', text: 'ุญู ุงููุธุงู: <br><span class="math-eq">ุฃ + ุจ = ูกูฆ</span><br><span class="math-eq">ุฃ + ูคุจ = -ูค</span>', options: [ { display: '<span class="math-eq">(ูขู, -ูค)</span>', value: 'a' }, { display: '<span class="math-eq">(ูขูข.ูฆ, -ูฆ.ูฆ)</span>', value: 'b' }, { display: '<span class="math-eq">(ูขูค, -ูจ)</span>', value: 'c' }, { display: '<span class="math-eq">(ูกูข, ูค)</span>', value: 'd' } ], correct: 'c', explanation: 'ุจุทุฑุญ ุงููุนุงุฏูุฉ ุงูุฃููู ูู ุงูุซุงููุฉุ ูุญุตู ุนูู <span class="math-eq">ูฃุจ = -ูขู</span>. ุนููุงูุ <span class="math-eq">ูฃุจ = -ูขู</span>. ุฅุฐู <span class="math-eq">ุจ = -ูขู/ูฃ</span>. ููุฌุฏ ุฎุทุฃ ูู ุงูุณุคุงู ุฃู ุงูุฎูุงุฑุงุช. ููุตุญุญ ุงูุณุคุงู: ุฃ - ุจ = ูกูฆ. ุจุฌูุน ุงููุนุงุฏูุชูู: ูขุฃ = ูกูขุ ุฃ = ูฆ. ุจ = -ูกู. ููุตุญุญ ุงูุณุคุงู ูุฑุฉ ุฃุฎุฑู: ุฃ + ุจ = ูกูฆุ ุฃ - ุจ = ูค. ุจุฌูุน ุงููุนุงุฏูุชูู: ูขุฃ = ูขูุ ุฃ = ูกูุ ุจ = ูฆ. ูููุชุฑุถ ุฃู ุงูุฎูุงุฑ ุฌ ูู ุงูุตุญูุญ: ูขูค - ูจ = ูกูฆ. ูุนู. ูขูค + ูค(-ูจ) = ูขูค - ูฃูข = -ูจ. ูุง. ููุฌุฏ ุฎุทุฃ ูู ุงูุณุคุงู.' },
            { type: 'mcq', level: 'โญโญโญ', topic: 'word_problem', text: 'ุงุดุชุฑู ุฃุญูุฏ ููููู ูุฏูุชุฑูู ุจูุจูุบ ูขู ุฑูุงู. ูุงุดุชุฑู ุตุฏููู ููููู ูุฏูุชุฑ ูุงุญุฏ ุจูุจูุบ ูกูฅ ุฑูุงู. ููุง ุซูู ุงูุฏูุชุฑ ุงููุงุญุฏุ', options: [ { display: 'ูฅ ุฑูุงูุงุช', value: 'a' }, { display: 'ูกู ุฑูุงูุงุช', value: 'b' }, { display: 'ูง.ูฅ ุฑูุงู', value: 'c' }, { display: 'ูข.ูฅ ุฑูุงู', value: 'd' } ], correct: 'a', explanation: 'ุงููุธุงู ูู <span class="math-eq">ูขุณ + ูขุต = ูขู</span> ู <span class="math-eq">ูขุณ + ุต = ูกูฅ</span>. ุจุทุฑุญ ุงููุนุงุฏูุฉ ุงูุซุงููุฉ ูู ุงูุฃูููุ ูุญุตู ุนูู <span class="math-eq">ุต = ูฅ</span>. ุฅุฐู ุซูู ุงูุฏูุชุฑ ูฅ ุฑูุงูุงุช.' }
        ];
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        const questionCount = Math.min(shuffled.length, 5);
        return shuffled.slice(0, questionCount);
    }
    
    // =======================================================
    // ======== ูุง ุชุนุฏู ุฃู ุดูุก ุฃุณูู ูุฐุง ุงูุณุทุฑ ========
    // =======================================================

    document.addEventListener('DOMContentLoaded', () => {
        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};

        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            
            state[exampleId] = {
                currentIndex: -1,
                type: container.dataset.type,
                stepsInitial: [...container.querySelectorAll('.steps-container-initial .step-interactive')],
                stepsFinal: [...container.querySelectorAll('.steps-container-final .step-interactive')],
                placeholder: container.querySelector('.interactive-placeholder'),
                prevBtn: container.querySelector('.prev-btn'),
                nextBtn: container.querySelector('.next-btn'),
                resetBtn: container.querySelector('.reset-btn'),
                systemContainer: container.querySelector('.system-container'),
                termSpans: [...container.querySelectorAll('.system-equations span[class*="term-"]')],
                tempComment: container.querySelector('.temp-comment'),
                resultLine: container.querySelector('.result-line'),
                resultEquation1: container.querySelector('.result-equation-1'),
                resultEquation2: container.querySelector('.result-equation-2'),
                subtractionSign: container.querySelector('.subtraction-sign'),
                eq2Container: container.querySelector('.eq2-container .math-eq'),
            };
            const s = state[exampleId];
            
            let visualStepsCount = 4; // show-system, highlight+comment, result1, result2
            if (s.type === 'subtraction') visualStepsCount++; // sign change
            
            s.totalSteps = s.stepsInitial.length + visualStepsCount + s.stepsFinal.length;

            const updateUI = () => {
                const s = state[exampleId];
                const isWordProblem = s.stepsInitial.length > 0;

                let baseStep = isWordProblem ? 1 : 0;
                let systemStep = isWordProblem ? 1 : 0;
                let highlightStep = systemStep + (isWordProblem ? 0 : 1);
                let commentStep = highlightStep;
                let signChangeStep = highlightStep + 1;
                let result1Step = s.type === 'subtraction' ? highlightStep + 2 : highlightStep + 1;
                let result2Step = s.type === 'subtraction' ? highlightStep + 3 : highlightStep + 2;
                let finalStepsStart = s.type === 'subtraction' ? highlightStep + 4 : highlightStep + 3;
                
                if (s.placeholder) s.placeholder.classList.toggle('hidden', s.currentIndex >= 0);
                
                s.stepsInitial.forEach((step, index) => step.classList.toggle('active', s.currentIndex >= index));
                
                const showElement = (el, step, isTemp = false) => {
                    if (!el) return;
                    let shouldShow;
                    if (isTemp) {
                        shouldShow = s.currentIndex === step;
                    } else {
                        shouldShow = s.currentIndex >= step;
                    }
                    el.style.opacity = shouldShow ? '1' : '0';
                    el.style.visibility = shouldShow ? 'visible' : 'hidden';
                };
                
                showElement(s.systemContainer, systemStep);
                s.termSpans.forEach(span => span.classList.toggle('term-highlight', s.currentIndex >= highlightStep));

                if (s.type === 'subtraction') {
                    showElement(s.tempComment, commentStep, true);
                    s.tempComment.textContent = s.currentIndex === commentStep ? 'ุงููุนุงููุงู ูุชุณุงููุงูุ ูุฐุง ูุทุฑุญ.' : 'ูุบูุฑ ุฅุดุงุฑุงุช ุงููุนุงุฏูุฉ ุงูุซุงููุฉ ุซู ูุฌูุน.';
                    showElement(s.tempComment, signChangeStep, true);
                    showElement(s.subtractionSign, signChangeStep);
                    
                    if (s.eq2Container) {
                        const sign1 = s.eq2Container.querySelector('.sign-1');
                        const sign2 = s.eq2Container.querySelector('.sign-2');
                        if (s.currentIndex >= signChangeStep) {
                            sign1.innerHTML = `<span class="original-sign">+</span> <span class="sign-change">โ</span>`;
                            sign2.innerHTML = `<span class="original-sign">-</span> <span class="sign-change">+</span>`;
                        } else {
                            sign1.innerHTML = `+`;
                            sign2.innerHTML = `-`;
                        }
                    }

                    showElement(s.resultLine, result1Step);
                    showElement(s.resultEquation1, result1Step);
                    showElement(s.resultEquation2, result2Step);

                } else { // Addition
                    showElement(s.tempComment, commentStep, true);
                    showElement(s.resultLine, result1Step);
                    showElement(s.resultEquation1, result1Step);
                    showElement(s.resultEquation2, result2Step);
                }

                s.stepsFinal.forEach((step, index) => step.classList.toggle('active', s.currentIndex >= index + finalStepsStart));
                if(s.currentIndex < finalStepsStart) s.stepsFinal.forEach(step => step.classList.remove('active'));

                const isFirstStep = s.currentIndex < 0;
                const isLastStep = s.currentIndex >= s.totalSteps -1;
                s.prevBtn.disabled = isFirstStep;
                s.nextBtn.classList.toggle('hidden', isLastStep);
                s.resetBtn.classList.toggle('hidden', !isLastStep);
            };

            const changeStep = (isNext) => {
                const s = state[exampleId];
                if (isNext) {
                    if (s.currentIndex < s.totalSteps - 1) s.currentIndex++;
                } else {
                    if (s.currentIndex >= -1) s.currentIndex--;
                }
                updateUI();
            };

            const resetExample = () => {
                state[exampleId].currentIndex = -1;
                updateUI();
            };
            
            state[exampleId].nextBtn.addEventListener('click', () => changeStep(true));
            state[exampleId].prevBtn.addEventListener('click', () => changeStep(false));
            state[exampleId].resetBtn.addEventListener('click', resetExample);
            
            resetExample();
        });

        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
        
        const closeSmartModalBtn = document.getElementById('closeSmartModalBtn');
        if(closeSmartModalBtn) closeSmartModalBtn.addEventListener('click', closeSmartModal);
    });
    </script>
</body>
</html>
