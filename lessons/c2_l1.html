<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدرس ٢-١: العلاقات | منصة الرياضيات التفاعلية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; text-align: center;}
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        input[type="radio"]:disabled + .option-label { cursor: not-allowed; background-color: #f3f4f6; }
        input[type="radio"]:disabled:checked + .option-label { background-color: #dbeafe; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-change { color: #ef4444; font-weight: bold; }
        
        .math-eq {
            font-family: "Courier New", monospace;
            font-size: 1.2rem;
            font-weight: bold;
            color: #4338ca;
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            padding: 2px 8px;
            border-radius: 6px;
            display: inline-block;
            vertical-align: middle;
        }
        
        .fraction { display: inline-flex; flex-direction: column; text-align: center; vertical-align: middle; margin: 0 0.2em; }
        .fraction > span { display: block; padding: 0 0.4em; }
        .fraction > .frac-bar { border-top: 2px solid #4338ca; }
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8 px-4">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">الدرس ٢-١: العلاقات</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; العودة إلى الفهرس</a>
                </header>
                
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفهوم الأساسي</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-3">
                        <p>في الرياضيات، <span class="vocab-term">العلاقة</span> هي أي مجموعة من الأزواج المرتبة. يمكن تمثيل العلاقة بعدة طرق: جدول، تمثيل بياني، أو مخطط سهمي.</p>
                        <p>كل زوج مرتب يتكون من <span class="vocab-term">إحداثي سيني</span> و <span class="vocab-term">إحداثي صادي</span>. مجموعة الإحداثيات السينية تسمى <span class="vocab-term">المجال</span>، ومجموعة الإحداثيات الصادية تسمى <span class="vocab-term">المدى</span>.</p>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: أمثلة تفاعلية</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="flex flex-col space-y-8">
                            <!-- المثال التفاعلي الأول (بآلية العرض التراكمي) -->
                            <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4">مثال ١: مثل العلاقة <span class="math-eq">{ (٢، ٥)، (-٢، ٣)، (٥، -٢)، (-١، -٢) }</span></p>
                                
                                <div class="visuals-container min-h-[250px] flex justify-center items-start space-x-4 space-x-reverse">
                                    <div class="interactive-placeholder-1 text-center text-gray-500 p-4 w-full"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    
                                    <div id="ex1-step0" class="hidden w-full md:w-1/3 p-2 transition-opacity duration-500">
                                        <h4 class="font-bold text-center mb-2">١. جدول</h4>
                                        <table class="w-full border text-center rounded-lg overflow-hidden"><thead class="bg-gray-200"><tr class="border-b"><th class="p-2">س</th><th class="p-2">ص</th></tr></thead><tbody><tr class="border-b"><td>٢</td><td>٥</td></tr><tr class="border-b"><td>-٢</td><td>٣</td></tr><tr class="border-b"><td>٥</td><td>-٢</td></tr><tr><td>-١</td><td>-٢</td></tr></tbody></table>
                                    </div>
                                    <div id="ex1-step1" class="hidden w-full md:w-1/3 p-2 transition-opacity duration-500">
                                        <h4 class="font-bold text-center mb-2">٢. تمثيل بياني</h4>
                                        <div class="p-2 bg-white border rounded-lg"><svg viewBox="-6 -6 12 12" class="w-full h-48"><g stroke="#e2e8f0" stroke-width="0.05"><path d="M -5 5 V -5 M -4 5 V -5 M -3 5 V -5 M -2 5 V -5 M -1 5 V -5 M 1 5 V -5 M 2 5 V -5 M 3 5 V -5 M 4 5 V -5 M 5 5 V -5" /><path d="M -5 5 H 5 M -5 4 H 5 M -5 3 H 5 M -5 2 H 5 M -5 1 H 5 M -5 -1 H 5 M -5 -2 H 5 M -5 -3 H 5 M -5 -4 H 5 M -5 -5 H 5" /></g><line x1="-5.5" y1="0" x2="5.5" y2="0" stroke="#a0aec0" stroke-width="0.1"/><line x1="0" y1="-5.5" x2="0" y2="5.5" stroke="#a0aec0" stroke-width="0.1"/><circle cx="2" cy="-5" r="0.2" fill="#ef4444"/><circle cx="-2" cy="-3" r="0.2" fill="#ef4444"/><circle cx="5" cy="2" r="0.2" fill="#ef4444"/><circle cx="-1" cy="2" r="0.2" fill="#ef4444"/></svg></div>
                                    </div>
                                    <div id="ex1-step2" class="hidden w-full md:w-1/3 p-2 transition-opacity duration-500">
                                        <h4 class="font-bold text-center mb-2">٣. مخطط سهمي</h4>
                                        <div class="p-2 bg-white border rounded-lg"><svg viewBox="0 0 100 100" class="w-full h-48"><defs><marker id="arrow-new" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="4" markerHeight="4" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#3b82f6" /></marker></defs><rect x="5" y="5" width="30" height="90" rx="5" stroke="#60a5fa" fill="#eff6ff" /><text x="20" y="18" font-size="8" font-weight="bold" text-anchor="middle">المجال</text><text x="20" y="35" font-size="8" text-anchor="middle">٢</text><text x="20" y="50" font-size="8" text-anchor="middle">-٢</text><text x="20" y="65" font-size="8" text-anchor="middle">٥</text><text x="20" y="80" font-size="8" text-anchor="middle">-١</text><rect x="65" y="15" width="30" height="70" rx="5" stroke="#34d399" fill="#f0fdf4" /><text x="80" y="28" font-size="8" font-weight="bold" text-anchor="middle">المدى</text><text x="80" y="45" font-size="8" text-anchor="middle">٥</text><text x="80" y="60" font-size="8" text-anchor="middle">٣</text><text x="80" y="75" font-size="8" text-anchor="middle">-٢</text><path d="M 35 35 Q 50 40 65 45" stroke="#60a5fa" stroke-width="0.5" fill="none" marker-end="url(#arrow-new)" /><path d="M 35 50 Q 50 55 65 60" stroke="#60a5fa" stroke-width="0.5" fill="none" marker-end="url(#arrow-new)" /><path d="M 35 65 Q 50 70 65 75" stroke="#60a5fa" stroke-width="0.5" fill="none" marker-end="url(#arrow-new)" /><path d="M 35 80 Q 50 78 65 75" stroke="#60a5fa" stroke-width="0.5" fill="none" marker-end="url(#arrow-new)" /></svg></div>
                                    </div>
                                </div>
                                
                                <div id="ex1-step3" class="hidden p-4 mt-4 bg-green-100 rounded-lg step-box border-green-600 w-full transition-opacity duration-500">
                                    <h4 class="font-bold">الخطوة الأخيرة: تحديد المجال والمدى</h4>
                                    <p><span class="vocab-term">المجال</span> هو مجموعة قيم س: <span class="math-eq">{٢، -٢، ٥، -١}</span></p><p class="mt-2"><span class="vocab-term">المدى</span> هو مجموعة قيم ص: <span class="math-eq">{٥، ٣، -٢}</span> (بدون تكرار)</p>
                                </div>
                                
                                <div class="flex justify-between mt-6">
                                    <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                            <!-- المثال التفاعلي الثاني (بالآلية العادية) -->
                            <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4">مثال ٢: تحليل المتغيرات (المستقل والتابع)</p>
                                <div class="steps-container space-y-4 min-h-[200px] flex justify-center items-center">
                                    <div class="interactive-placeholder text-center text-gray-500 p-4"><p>اضغط "التالي" لبدء خطوات الحل</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box w-full"><h4 class="font-bold">الخطوة ١: السيناريو</h4><p class="text-xl">يعمل أحمد في محل تجاري ويتقاضى أجرًا على كل ساعة عمل.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box w-full"><h4 class="font-bold">الخطوة ٢: تحديد المتغير المستقل</h4><p>المتغير الذي يمكن التحكم فيه هو <span class="highlight-change">عدد ساعات العمل</span>. إذن هو المتغير المستقل.</p></div>
                                    <div class="step-interactive p-4 bg-gray-50 rounded-lg step-box w-full"><h4 class="font-bold">الخطوة ٣: تحديد المتغير التابع</h4><p>المتغير الذي <span class="highlight-change">يعتمد</span> على عدد ساعات العمل هو <span class="highlight-change">الأجر الإجمالي</span>. إذن هو المتغير التابع.</p></div>
                                    <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600 w-full"><h4 class="font-bold">الخلاصة</h4><p>المتغير المستقل: عدد ساعات العمل.<br>المتغير التابع: الأجر الإجمالي.<br><small>(لأن الأجر الإجمالي يعتمد على عدد الساعات التي عملها أحمد)</small></p></div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">رجوع</button>
                                    <div>
                                        <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">التالي</button>
                                        <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">إعادة</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">✍️ رابعاً: حان دورك! اختبر فهمك</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">نتيجتك النهائية</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">إعادة الاختبار</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">💡 شرح الإجابة</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    // --- دوال مشتركة (لا تقم بالتعديل) ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">منصة الرياضيات التفاعلية</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">منصة الرياضيات التفاعلية</h1></a>`; } let userInfoHtml = ''; if (studentData) { userInfoHtml = `<div class="flex items-center gap-4"><span class="font-semibold">أهلاً، ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">خروج</a></div>`; } else { userInfoHtml = `<p class="text-lg text-gray-600">زائر</p>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; const logoutLink = headerContainer.querySelector('#logout-link'); if(logoutLink) { logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); } }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">© 2024 جميع الحقوق محفوظة | تصميم وتطوير: أ. عبدالعزيز خالد العبلان</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">لا توجد أسئلة متاحة لهذا الدرس حالياً.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `المحاولات المتبقية: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${Math.max(0, attemptsLeft)}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); const questionText = q.graph ? `<div class="flex flex-col md:flex-row items-center gap-4"><div class="flex-1"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p></div><div class="flex-shrink-0 mx-auto">${q.graph}</div></div>` : `<p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p>`; return `<div class="p-4 border-2 border-gray-200 rounded-lg">${questionText}<div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold min-h-[20px]"></div><button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">اعرف لماذا؟</button></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">تحقق من إجاباتي</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'لا توجد محاولات متبقية'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400', 'cursor-not-allowed'); } quizForm.onsubmit = (e) => { e.preventDefault(); const student = getStudentFromStorage(); let score = 0; questions.forEach((q, index) => { const radios = e.target.elements[`q${index}`]; const userAnswer = radios?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); radios.forEach(radio => radio.disabled = true); if (userAnswer === q.correct) { score++; feedbackEl.textContent = '✔ إجابة صحيحة!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `❌ إجابة خاطئة.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden');}); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (student) { saveGrade(lessonId, finalGrade, student.id); const studentLessonData = student.lessons?.[lessonId] || { attempts: 0 }; const attemptsMade = studentLessonData.attempts; if (MAX_ATTEMPTS - (attemptsMade + 1) > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'تم عرض نتيجتك. سجل الدخول لحفظ تقدمك.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade, studentId) { const statusEl = document.getElementById('save-status'); statusEl.textContent = 'جاري حفظ نتيجتك...'; const data = { action: 'saveGrade', studentId: studentId, lessonId: lessonId, grade: grade, timestamp: new Date().toISOString() }; fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data), headers: { 'Content-Type': 'text/plain;charset=utf-8' } }).then(() => { console.log('Grade submission sent.'); statusEl.textContent = `تم حفظ نتيجتك بنجاح: ${grade} / 10`; statusEl.style.color = '#16a34a'; const student = getStudentFromStorage(); if (student) { if (!student.lessons) student.lessons = {}; const lessonData = student.lessons[lessonId] || { attempts: 0, highestGrade: -1 }; lessonData.attempts += 1; lessonData.highestGrade = Math.max(lessonData.highestGrade, grade); student.lessons[lessonId] = lessonData; localStorage.setItem('currentStudent', JSON.stringify(student)); } }).catch(error => { console.error('Network error while saving grade:', error); statusEl.textContent = 'حدث خطأ في الشبكة أثناء حفظ النتيجة. يرجى التحقق من اتصالك.'; statusEl.style.color = '#dc2626'; }); }
    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    
    // --- محتوى خاص بالدرس (يتم تعديله لكل درس) ---
    const LESSON_ID = 'c2_l1'; 
    
    function generateQuiz() {
        const questionBank = [
            { type: 'mcq', level: '⭐', topic: 'domain-range', text: 'ما هو مجال العلاقة <span class="math-eq">{ (١، ٢)، (٣، ٤)، (١، ٥) }</span>؟', options: [ { display: '<span class="math-eq">{١، ٣}</span>', value: '{1, 3}' }, { display: '<span class="math-eq">{٢، ٤، ٥}</span>', value: '{2, 4, 5}' }, { display: '<span class="math-eq">{١، ٢، ٣، ٤، ٥}</span>', value: '{1, 2, 3, 4, 5}' }, { display: '<span class="math-eq">{١، ٣، ١}</span>', value: '{1, 3, 1}' } ], correct: '{1, 3}', explanation: `<p class='mb-2'>المجال هو مجموعة كل الإحداثيات السينية (الأولى) في الأزواج المرتبة، وبدون تكرار.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>الأزواج المرتبة: (<b>١</b>، ٢)، (<b>٣</b>، ٤)، (<b>١</b>، ٥)<br>المجال = {١، ٣}</p>` },
            { type: 'mcq', level: '⭐', topic: 'domain-range', text: 'ما هو مدى العلاقة <span class="math-eq">{ (٠، ٠)، (-١، ٢)، (١، ٢) }</span>؟', options: [ { display: '<span class="math-eq">{٠، -١، ١}</span>', value: '{0, -1, 1}' }, { display: '<span class="math-eq">{٠، ٢، ٢}</span>', value: '{0, 2, 2}' }, { display: '<span class="math-eq">{٠، ٢}</span>', value: '{0, 2}' }, { display: '<span class="math-eq">{٠}</span>', value: '{0}' } ], correct: '{0, 2}', explanation: `<p class='mb-2'>المدى هو مجموعة كل الإحداثيات الصادية (الثانية) في الأزواج المرتبة، وبدون تكرار.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>الأزواج المرتبة: (٠، <b>٠</b>)، (-١، <b>٢</b>)، (١، <b>٢</b>)<br>المدى = {٠، ٢}</p>` },
            { type: 'mcq', level: '⭐⭐', topic: 'variables', text: 'في العلاقة التي تربط عدد ساعات الدراسة (س) بالدرجة في الاختبار (ص)، أي متغير هو التابع؟', options: [ { display: 'عدد ساعات الدراسة', value: 's' }, { display: 'الدرجة في الاختبار', value: 'p' }, { display: 'كلاهما مستقل', value: 'both_ind' }, { display: 'لا يمكن التحديد', value: 'cannot' } ], correct: 'p', explanation: `<p class='mb-2'>الدرجة التي تحصل عليها في الاختبار <strong class="text-green-600">تعتمد</strong> على عدد ساعات دراستك. لذلك، الدرجة (ص) هي المتغير التابع.</p>` },
            { type: 'mcq', level: '⭐⭐', topic: 'variables', text: 'تكلفة تعبئة الوقود تعتمد على عدد اللترات التي تشتريها. أي متغير هو المستقل؟', options: [ { display: 'تكلفة الوقود', value: 'cost' }, { display: 'عدد اللترات', value: 'liters' }, { display: 'كلاهما تابع', value: 'both_dep' }, { display: 'نوع السيارة', value: 'car_type' } ], correct: 'liters', explanation: `<p class='mb-2'>التكلفة الإجمالية <strong class="text-green-600">تعتمد</strong> على عدد اللترات. أنت تختار عدد اللترات أولاً (المتغير المستقل)، وبناءً عليه تُحسب التكلفة (المتغير التابع).</p>` },
            { type: 'graph_mcq', level: '⭐⭐', topic: 'domain-range', text: 'من التمثيل البياني المجاور، ما هو <strong>مجال</strong> العلاقة؟', graph: `<svg viewBox="-5 -5 10 10" class="w-48 h-48 bg-white border rounded-lg"><g stroke="#e2e8f0" stroke-width="0.05"><path d="M -4 4 V -4 M -3 4 V -4 M -2 4 V -4 M -1 4 V -4 M 1 4 V -4 M 2 4 V -4 M 3 4 V -4 M 4 4 V -4" /><path d="M -4 4 H 4 M -4 3 H 4 M -4 2 H 4 M -4 1 H 4 M -4 -1 H 4 M -4 -2 H 4 M -4 -3 H 4 M -4 -4 H 4" /></g><line x1="-4.5" y1="0" x2="4.5" y2="0" stroke="#a0aec0" stroke-width="0.1"/><line x1="0" y1="-4.5" x2="0" y2="4.5" stroke="#a0aec0" stroke-width="0.1"/><circle cx="-3" cy="-2" r="0.2" fill="#ef4444"/><circle cx="-1" cy="4" r="0.2" fill="#ef4444"/><circle cx="0" cy="-1" r="0.2" fill="#ef4444"/><circle cx="3" cy="-2" r="0.2" fill="#ef4444"/></svg>`, options: [ { display: '<span class="math-eq">{-٣, -١, ٠, ٣}</span>', value: '{-3, -1, 0, 3}' }, { display: '<span class="math-eq">{-٢, -١, ٤}</span>', value: '{-2, -1, 4}' }, { display: '<span class="math-eq">{-٤, -٣, -١, ٠, ١, ٢, ٣}</span>', value: '{-4, -3, -1, 0, 1, 2, 3}' }, { display: '<span class="math-eq">{٢, -٤, ١, ٢}</span>', value: '{2, -4, 1, 2}' } ], correct: '{-3, -1, 0, 3}', explanation: `<p class='mb-2'>المجال هو مجموعة قيم <b>س</b> لجميع النقاط. بالنظر إلى الرسم، النقاط هي (-٣, -٢)، (-١, ٤)، (٠, -١)، (٣, -٢). الإحداثيات السينية هي -٣، -١، ٠، ٣.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>المجال = {-٣, -١, ٠, ٣}</p>` },
            { type: 'graph_mcq', level: '⭐⭐', topic: 'domain-range', text: 'من التمثيل البياني المجاور، ما هو <strong>مدى</strong> العلاقة؟', graph: `<svg viewBox="-5 -5 10 10" class="w-48 h-48 bg-white border rounded-lg"><g stroke="#e2e8f0" stroke-width="0.05"><path d="M -4 4 V -4 M -3 4 V -4 M -2 4 V -4 M -1 4 V -4 M 1 4 V -4 M 2 4 V -4 M 3 4 V -4 M 4 4 V -4" /><path d="M -4 4 H 4 M -4 3 H 4 M -4 2 H 4 M -4 1 H 4 M -4 -1 H 4 M -4 -2 H 4 M -4 -3 H 4 M -4 -4 H 4" /></g><line x1="-4.5" y1="0" x2="4.5" y2="0" stroke="#a0aec0" stroke-width="0.1"/><line x1="0" y1="-4.5" x2="0" y2="4.5" stroke="#a0aec0" stroke-width="0.1"/><circle cx="-4" cy="2" r="0.2" fill="#3b82f6"/><circle cx="-2" cy="-3" r="0.2" fill="#3b82f6"/><circle cx="1" cy="2" r="0.2" fill="#3b82f6"/><circle cx="4" cy="-1" r="0.2" fill="#3b82f6"/></svg>`, options: [ { display: '<span class="math-eq">{-٣, -١, ٢}</span>', value: '{-3, -1, 2}' }, { display: '<span class="math-eq">{-٤, -٢, ١, ٤}</span>', value: '{-4, -2, 1, 4}' }, { display: '<span class="math-eq">{٢, -٣, ٢, -١}</span>', value: '{2, -3, 2, -1}' }, { display: '<span class="math-eq">{-٢, ١, ٣}</span>', value: '{-2, 1, 3}' } ], correct: '{-3, -1, 2}', explanation: `<p class='mb-2'>المدى هو مجموعة قيم <b>ص</b> لجميع النقاط، بدون تكرار. بالنظر إلى الرسم، النقاط هي (-٤, ٢)، (-٢, -٣)، (١, ٢)، (٤, -١). الإحداثيات الصادية هي ٢، -٣، ٢، -١.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>المدى (مرتباً وبدون تكرار) = {-٣, -١, ٢}</p>` },
            { type: 'graph_mcq', level: '⭐⭐⭐', topic: 'analysis', text: 'يصف التمثيل البياني المجاور رحلة شخص ما. أي من التالي هو الوصف الصحيح للرحلة؟', graph: `<svg viewBox="0 0 100 100" class="w-48 h-48 bg-white border rounded-lg p-2"><polyline points="10,80 40,40 60,40 100,80" fill="none" stroke="#ef4444" stroke-width="3" /><text x="50" y="98" text-anchor="middle" font-size="8">الزمن</text><text x="5" y="50" text-anchor="middle" font-size="8" transform="rotate(-90 5 50)">المسافة من المنزل</text><line x1="10" y1="0" x2="10" y2="90" stroke="black" stroke-width="1"/><line x1="10" y1="90" x2="100" y2="90" stroke="black" stroke-width="1"/></svg>`, options: [ { display: 'سار الشخص مبتعداً عن المنزل، ثم توقف، ثم أكمل السير مبتعداً.', value: 'away-stop-away' }, { display: 'سار الشخص مبتعداً عن المنزل، ثم توقف لفترة، ثم عاد باتجاه المنزل.', value: 'away-stop-back' },{ display: 'كان الشخص عائداً للمنزل، ثم توقف، ثم أكمل العودة.', value: 'back-stop-back' },{ display: 'سار الشخص مبتعداً ثم عاد إلى المنزل مباشرة.', value: 'away-back' } ], correct: 'away-stop-back', explanation: `<p class='mb-2'>لنحلل الرسم البياني (المسافة من المنزل مقابل الزمن):</p><ul class='list-disc pr-4 space-y-1'><li><b>الجزء الأول (مائل للأسفل):</b> المسافة من المنزل تقل، مما يعني أن الشخص يقترب من المنزل.</li><li><b>الجزء الثاني (أفقي):</b> الزمن يمر والمسافة ثابتة، مما يعني أن الشخص قد توقف.</li><li><b>الجزء الثالث (مائل للأعلى):</b> المسافة من المنزل تزداد، مما يعني أن الشخص يبتعد عن المنزل.</li></ul><p class='mt-2 p-2 bg-green-100 rounded-md'>إذًا، الوصف الصحيح هو: اقترب من المنزل، توقف، ثم ابتعد.</p>` },
            { type: 'graph_mcq', level: '⭐⭐⭐', topic: 'analysis', text: 'يمثل الرسم البياني المجاور مستوى الماء في خزان أثناء ملئه. أي وصف هو الصحيح؟', graph: `<svg viewBox="0 0 100 100" class="w-48 h-48 bg-white border rounded-lg p-2"><polyline points="10,90 40,60 60,60 90,10" fill="none" stroke="#0891b2" stroke-width="3" /><text x="50" y="98" text-anchor="middle" font-size="8">الزمن</text><text x="5" y="50" text-anchor="middle" font-size="8" transform="rotate(-90 5 50)">مستوى الماء</text><line x1="10" y1="0" x2="10" y2="90" stroke="black" stroke-width="1"/><line x1="10" y1="90" x2="100" y2="90" stroke="black" stroke-width="1"/></svg>`, options: [ { display: 'بدأ الملء ثم توقف ثم استمر بنفس المعدل.', value: 'fill-stop-fill' }, { display: 'بدأ الملء بسرعة، ثم أبطأ، ثم توقف.', value: 'fast-slow-stop' }, { display: 'بدأ الملء بمعدل ثابت، ثم توقف لفترة، ثم استمر بمعدل أسرع.', value: 'fill-stop-faster' }, { display: 'كان الخزان يفرغ ثم امتلأ.', value: 'empty-fill' } ], correct: 'fill-stop-faster', explanation: `<p class='mb-2'>لنحلل الرسم البياني:</p><ul class='list-disc pr-4 space-y-1'><li><b>الجزء الأول (مائل للأعلى):</b> مستوى الماء يرتفع بمعدل ثابت.</li><li><b>الجزء الثاني (أفقي):</b> يمر الزمن ومستوى الماء لا يتغير، مما يعني أن الملء توقف.</li><li><b>الجزء الثالث (أكثر انحدارًا):</b> مستوى الماء يرتفع مرة أخرى ولكن بشكل أسرع من المرة الأولى.</li></ul><p class='mt-2 p-2 bg-green-100 rounded-md'>إذًا، الوصف الصحيح هو: بدأ الملء، ثم توقف، ثم استمر بمعدل أسرع.</p>` },
            { type: 'mcq', level: '⭐', topic: 'domain-range', text: 'ما هو مدى العلاقة <span class="math-eq">{ (٥، -١)، (٠، -١)، (٢، ٤) }</span>؟', options: [ { display: '<span class="math-eq">{٥, ٠, ٢}</span>', value: '{5, 0, 2}' }, { display: '<span class="math-eq">{-١, ٤}</span>', value: '{-1, 4}' }, { display: '<span class="math-eq">{-١, -١, ٤}</span>', value: '{-1, -1, 4}' }, { display: '<span class="math-eq">{٥, -١, ٠, ٢, ٤}</span>', value: '{5, -1, 0, 2, 4}' } ], correct: '{-1, 4}', explanation: `<p class='mb-2'>المدى هو مجموعة كل الإحداثيات الصادية (الثانية) في الأزواج المرتبة، وبدون تكرار.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>الأزواج المرتبة: (٥، <b>-١</b>)، (٠، <b>-١</b>)، (٢، <b>٤</b>)<br>المدى = {-١, ٤}</p>` },
            { type: 'mcq', level: '⭐', topic: 'domain-range', text: 'ما هو مجال العلاقة <span class="math-eq">{ (-٢, ٠), (٣, ١), (٤, ٠) }</span>؟', options: [ { display: '<span class="math-eq">{٠, ١}</span>', value: '{0,1}' }, { display: '<span class="math-eq">{-٢, ٣, ٤}</span>', value: '{-2,3,4}' }, { display: '<span class="math-eq">{٠, ١, ٠}</span>', value: '{0,1,0}' }, { display: '<span class="math-eq">{-٢, ٠, ١, ٣, ٤}</span>', value: '{-2,0,1,3,4}' } ], correct: '{-2,3,4}', explanation: `<p class='mb-2'>المجال هو مجموعة كل الإحداثيات السينية (الأولى) في الأزواج المرتبة.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>الأزواج المرتبة: (<b>-٢</b>, ٠), (<b>٣</b>, ١), (<b>٤</b>, ٠)<br>المجال = {-٢, ٣, ٤}</p>` },
            { type: 'mcq', level: '⭐⭐', topic: 'variables', text: 'كلما زاد عدد المنتجات المباعة، زاد الربح. أي متغير هو التابع؟', options: [ { display: 'عدد المنتجات', value: 'products' }, { display: 'الربح', value: 'profit' }, { display: 'سعر المنتج', value: 'price' }, { display: 'لا يمكن التحديد', value: 'cannot' } ], correct: 'profit', explanation: `<p class='mb-2'>الربح <strong class="text-green-600">يعتمد</strong> على عدد المنتجات التي تم بيعها. لذلك، الربح هو المتغير التابع.</p>` },
            { type: 'mcq', level: '⭐', topic: 'domain-range', text: 'في العلاقة <span class="math-eq">{ (أ, ب), (ج, د) }</span>، ما هو المجال؟', options: [ { display: '<span class="math-eq">{أ, ب}</span>', value: '{a,b}' }, { display: '<span class="math-eq">{ج, د}</span>', value: '{c,d}' }, { display: '<span class="math-eq">{أ, ج}</span>', value: '{a,c}' }, { display: '<span class="math-eq">{ب, د}</span>', value: '{b,d}' } ], correct: '{a,c}', explanation: `<p class='mb-2'>المجال هو مجموعة كل الإحداثيات الأولى (السينية) في الأزواج المرتبة.</p><p class='mt-2 p-2 bg-green-100 rounded-md'>المجال = {أ, ج}</p>` }
        ];
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        const questionCount = Math.min(shuffled.length, 5);
        return shuffled.slice(0, questionCount);
    }
    
    // --- مشغل الكود (لا تقم بالتعديل) ---
    document.addEventListener('DOMContentLoaded', () => {
        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        
        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            
            if (exampleId === '1') {
                // --- Logic for Cumulative Example 1 ---
                const state = {
                    currentIndex: -1,
                    steps: [
                        container.querySelector('#ex1-step0'),
                        container.querySelector('#ex1-step1'),
                        container.querySelector('#ex1-step2'),
                        container.querySelector('#ex1-step3')
                    ],
                    placeholder: container.querySelector('.interactive-placeholder-1'),
                    prevBtn: container.querySelector('.prev-btn'),
                    nextBtn: container.querySelector('.next-btn'),
                    resetBtn: container.querySelector('.reset-btn')
                };

                const updateEx1Buttons = () => {
                    const isFirstStep = state.currentIndex <= -1;
                    const isLastStep = state.currentIndex >= state.steps.length - 1;
                    state.prevBtn.disabled = isFirstStep;
                    if (isLastStep) {
                        state.nextBtn.classList.add('hidden');
                        state.resetBtn.classList.remove('hidden');
                    } else {
                        state.nextBtn.classList.remove('hidden');
                        state.resetBtn.classList.add('hidden');
                    }
                };

                const resetEx1 = () => {
                    state.steps.forEach(step => step.classList.add('hidden'));
                    if (state.placeholder) state.placeholder.classList.remove('hidden');
                    state.currentIndex = -1;
                    updateEx1Buttons();
                };

                state.nextBtn.addEventListener('click', () => {
                    if (state.currentIndex < state.steps.length - 1) {
                        if (state.currentIndex === -1 && state.placeholder) {
                            state.placeholder.classList.add('hidden');
                        }
                        state.currentIndex++;
                        if (state.steps[state.currentIndex]) {
                            state.steps[state.currentIndex].classList.remove('hidden');
                        }
                        updateEx1Buttons();
                    }
                });

                state.prevBtn.addEventListener('click', () => {
                    if (state.currentIndex > -1) {
                        if (state.steps[state.currentIndex]) {
                            state.steps[state.currentIndex].classList.add('hidden');
                        }
                        state.currentIndex--;
                        if (state.currentIndex === -1 && state.placeholder) {
                            state.placeholder.classList.remove('hidden');
                        }
                        updateEx1Buttons();
                    }
                });
                
                if (state.resetBtn) state.resetBtn.addEventListener('click', resetEx1);
                updateEx1Buttons();

            } else {
                // --- Logic for Sequential Examples (like Example 2) ---
                const state = { 
                    currentIndex: -1, 
                    steps: container.querySelectorAll('.step-interactive'), 
                    placeholder: container.querySelector('.interactive-placeholder'), 
                    prevBtn: container.querySelector('.prev-btn'), 
                    nextBtn: container.querySelector('.next-btn'), 
                    resetBtn: container.querySelector('.reset-btn') 
                };
                
                if (!state.steps.length || !state.prevBtn || !state.nextBtn) return;

                const updateButtons = () => {
                    const isFirstStep = state.currentIndex <= -1;
                    const isLastStep = state.currentIndex >= state.steps.length - 1;
                    state.prevBtn.disabled = isFirstStep;
                    if (isLastStep) {
                        state.nextBtn.classList.add('hidden');
                        if (state.resetBtn) state.resetBtn.classList.remove('hidden');
                    } else {
                        state.nextBtn.classList.remove('hidden');
                        if (state.resetBtn) state.resetBtn.classList.add('hidden');
                    }
                };

                const resetExample = () => {
                    state.steps.forEach(step => step.classList.remove('active'));
                    state.currentIndex = -1;
                    if (state.placeholder) state.placeholder.classList.remove('hidden');
                    updateButtons();
                };
                
                state.nextBtn.addEventListener('click', () => {
                    if (state.currentIndex < state.steps.length - 1) {
                        if (state.currentIndex === -1 && state.placeholder) {
                            state.placeholder.classList.add('hidden');
                        }
                        // Hide previous step for sequential display
                        if (state.currentIndex > -1) {
                            state.steps[state.currentIndex].classList.remove('active');
                        }
                        state.currentIndex++;
                        state.steps[state.currentIndex].classList.add('active');
                        updateButtons();
                    }
                });

                state.prevBtn.addEventListener('click', () => {
                    if (state.currentIndex > -1) {
                        state.steps[state.currentIndex].classList.remove('active');
                        state.currentIndex--;
                        if (state.currentIndex === -1 && state.placeholder) {
                            state.placeholder.classList.remove('hidden');
                        } else if (state.currentIndex > -1) {
                            state.steps[state.currentIndex].classList.add('active');
                        }
                        updateButtons();
                    }
                });

                if(state.resetBtn) state.resetBtn.addEventListener('click', resetExample);
                updateButtons();
            }
        });

        // --- Global Setup ---
        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        const closeModalBtn = document.getElementById('closeModalBtn');
        const explanationModal = document.getElementById('explanationModal');
        if(closeModalBtn) { closeModalBtn.addEventListener('click', closeModal); }
        if(explanationModal) { explanationModal.addEventListener('click', (e) => { if(e.target === explanationModal) closeModal(); }); }
    });
    </script>
</body>
</html>
