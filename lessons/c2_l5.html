<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدرس ٢-٥: معدل التغير والميل | منصة الرياضيات التفاعلية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .math-eq {
            color: #4338ca; /* indigo-700  */
            font-weight: bold;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }
        .explanation-step { 
            padding-right: 12px; 
            margin-bottom: 1rem; 
            border-right: 3px solid #1d4ed8; 
            transition: opacity 0.5s ease-in-out; 
        }
        .explanation-step:last-child {
            margin-bottom: 0;
        }
        .fraction {
            display: inline-flex;
            flex-direction: column;
            text-align: center;
            vertical-align: middle;
            margin: 0 0.2em;
            line-height: 1.2em;
        }
        .fraction > span { display: block; padding: 0 0.2em; }
        .fraction > span:last-child { border-top: 2px solid currentColor; }
        .animated-element { transition: opacity 0.3s ease-in-out, stroke 0.3s ease-in-out; }
        .nav-btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        .highlight-y { color: #dc2626; font-weight: bold; } /* red-600 */
        .highlight-x { color: #16a34a; font-weight: bold; } /* green-600 */
    </style>
</head>
<body class="bg-gray-100">

    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-4xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">الدرس ٢-٥: معدل التغير والميل</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; العودة إلى الفهرس</a>
                </header>
                
                <!-- All interactive sections from the old version are restored here -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">💡 أولاً: المفاهيم الأساسية</h2>
                    <div class="p-6 bg-blue-50 rounded-lg space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">معدل التغير</h3>
                            <p>معدل التغير هو نسبة تصف كيف تتغير كمية ما بالنسبة لتغير كمية أخرى. إنه يخبرنا بمدى سرعة تغير شيء ما.</p>
                            <p class="mt-2">أبسط مثال على معدل التغير هو السرعة، التي تصف تغير المسافة بالنسبة للزمن.</p>
                             <div class="mt-4 p-4 bg-white rounded-lg border">
                                 <p class="text-lg text-center font-bold">صيغة معدل التغير</p>
                                 <p class="text-center my-2 p-3 bg-indigo-50 rounded-md text-xl math-eq">
                                     معدل التغير = 
                                     <span class="fraction"><span>التغير في ص</span><span>التغير في س</span></span>
                                     =
                                     <span class="fraction"><span>ص₂ - ص₁</span><span>س₂ - س₁</span></span>
                                 </p>
                             </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">الميل</h3>
                            <p>في الدوال الخطية، يكون معدل التغير ثابتًا. ويُسمى معدل التغير الثابت هذا <span class="vocab-term">الميل</span>.</p>
                            <p class="font-bold mt-2">ميل الخط المستقيم هو نسبة التغير الرأسي (الارتفاع) إلى التغير الأفقي (الامتداد).</p>
                        </div>
                        <div class="mt-6">
                            <h3 class="text-xl font-semibold text-blue-700 mb-2">ملخص حالات الميل</h3>
                            <p>الرسوم التالية توضح الحالات الأربع للميل بصريًا:</p>
                            <div id="slope-summary-container" class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 text-center"></div>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🎯 ثانياً: حساب معدل التغير (الثابت وغير الثابت) من جدول</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-8 gap-y-12">
                            <!-- Example 1: Constant Rate -->
                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-gray-700">المثال 1: معدل التغير الثابت</h3>
                                <p>يوضح الجدول المجاور عدد الكيلومترات التي قطعها خالد بدراجته. هل معدل التغير ثابت؟</p>
                                <div class="grid grid-cols-[3rem_1fr_3rem] gap-x-1 items-center">
                                    <div class="relative h-full">
                                        <div id="table-const-vis-1a" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-green-600" style="top: 33%; left: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-x font-mono" style="top: 33%; left: -0.5rem;">+٣٠</span>
                                        </div>
                                        <div id="table-const-vis-2a" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-green-600" style="top: 66%; left: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-x font-mono" style="top: 66%; left: -0.5rem;">+٣٠</span>
                                        </div>
                                    </div>
                                    <table class="w-full border-collapse border border-slate-400 text-center">
                                        <thead class="bg-blue-100"><tr><th class="p-2 border border-slate-300">الزمن (س)</th><th class="p-2 border border-slate-300">المسافة (ص)</th></tr></thead>
                                        <tbody>
                                            <tr id="table-const-row-1"><td class="p-2 border border-slate-300 font-mono">٣٠</td><td class="p-2 border border-slate-300 font-mono">١٠</td></tr>
                                            <tr id="table-const-row-2"><td class="p-2 border border-slate-300 font-mono">٦٠</td><td class="p-2 border border-slate-300 font-mono">٢٠</td></tr>
                                            <tr id="table-const-row-3"><td class="p-2 border border-slate-300 font-mono">٩٠</td><td class="p-2 border border-slate-300 font-mono">٣٠</td></tr>
                                        </tbody>
                                    </table>
                                    <div class="relative h-full">
                                        <div id="table-const-vis-1b" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-red-600" style="top: 33%; right: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-y font-mono" style="top: 33%; right: -0.5rem;">+١٠</span>
                                        </div>
                                        <div id="table-const-vis-2b" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-red-600" style="top: 66%; right: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-y font-mono" style="top: 66%; right: -0.5rem;">+١٠</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-white p-4 rounded-lg border min-h-[200px]">
                                    <div id="table-const-explanation" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="table-const-back" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="table-const-step-counter">0</span> / 4</span>
                                    <button id="table-const-next" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-indigo-700">التالي</button>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-gray-700">المثال 2: معدل التغير غير الثابت</h3>
                                <p>يوضح الجدول التالي أرباح متجر صغير بالأيام. هل معدل التغير ثابت؟</p>
                                <div class="grid grid-cols-[3rem_1fr_3rem] gap-x-1 items-center">
                                    <div class="relative h-full">
                                        <div id="table-nonconst-vis-1a" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-green-600" style="top: 33%; left: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-x font-mono" style="top: 33%; left: -0.5rem;">+٤</span>
                                        </div>
                                        <div id="table-nonconst-vis-2a" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-green-600" style="top: 66%; left: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-x font-mono" style="top: 66%; left: -0.5rem;">+٢</span>
                                        </div>
                                    </div>
                                    <table class="w-full border-collapse border border-slate-400 text-center">
                                        <thead class="bg-orange-100"><tr><th class="p-2 border border-slate-300">اليوم (س)</th><th class="p-2 border border-slate-300">الأرباح (ص)</th></tr></thead>
                                        <tbody>
                                            <tr id="table-nonconst-row-1"><td class="p-2 border border-slate-300 font-mono">١</td><td class="p-2 border border-slate-300 font-mono">١٠٠</td></tr>
                                            <tr id="table-nonconst-row-2"><td class="p-2 border border-slate-300 font-mono">٥</td><td class="p-2 border border-slate-300 font-mono">٣٠٠</td></tr>
                                            <tr id="table-nonconst-row-3"><td class="p-2 border border-slate-300 font-mono">٧</td><td class="p-2 border border-slate-300 font-mono">٧٠٠</td></tr>
                                        </tbody>
                                    </table>
                                     <div class="relative h-full">
                                        <div id="table-nonconst-vis-1b" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-red-600" style="top: 33%; right: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-y font-mono" style="top: 33%; right: -1.5rem;">+٢٠٠</span>
                                        </div>
                                        <div id="table-nonconst-vis-2b" class="absolute inset-0 opacity-0 transition-opacity duration-300">
                                            <svg class="absolute w-6 h-6 text-red-600" style="top: 66%; right: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                            <span class="absolute highlight-y font-mono" style="top: 66%; right: -1.5rem;">+٤٠٠</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-white p-4 rounded-lg border min-h-[200px]">
                                    <div id="table-nonconst-explanation" class="text-right"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="table-nonconst-back" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="table-nonconst-step-counter">0</span> / 4</span>
                                    <button id="table-nonconst-next" class="nav-btn bg-orange-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-orange-700">التالي</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">📈 ثالثاً: إيجاد معدل التغير الثابت وغير الثابت من الرسم البياني</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-gray-700">المثال ١: معدل التغير الثابت (الميل)</h3>
                                <p>لإيجاد الميل، نحدد نقطتين على الخط، ثم نحسب "الارتفاع" و "الامتداد" بينهما. استخدم الأزرار للتنقل بين خطوات الشرح.</p>
                                <div class="text-center">
                                    <svg id="slope-animation-svg-constant" viewBox="-2 -2 12 12" class="w-full h-72 bg-white border rounded-lg">
                                       <path d="M 0,1 L 10,1 M 0,2 L 10,2 M 0,3 L 10,3 M 0,4 L 10,4 M 0,5 L 10,5 M 0,6 L 10,6 M 0,7 L 10,7 M 0,8 L 10,8 M 0,9 L 10,9" stroke="#e5e7eb" stroke-width="0.1" />
                                       <path d="M 1,0 L 1,10 M 2,0 L 2,10 M 3,0 L 3,10 M 4,0 L 4,10 M 5,0 L 5,10 M 6,0 L 6,10 M 7,0 L 7,10 M 8,0 L 8,10 M 9,0 L 9,10" stroke="#e5e7eb" stroke-width="0.1" />
                                       <line x1="0" y1="0" x2="0" y2="10" stroke="#6b7280" stroke-width="0.2"/>
                                       <line x1="0" y1="10" x2="10" y2="10" stroke="#6b7280" stroke-width="0.2"/>
                                       <line x1="0" y1="2" x2="8" y2="10" stroke="#3b82f6" stroke-width="0.3"/>
                                       <circle cx="2" cy="4" r="0.25" fill="#ef4444" /><text x="1.5" y="3.5" font-size="0.6" font-weight="bold">(٢, ٦)</text>
                                       <circle cx="6" cy="8" r="0.25" fill="#ef4444" /><text x="6.5" y="8.5" font-size="0.6" font-weight="bold">(٦, ٢)</text>
                                       <g id="anim-const-step-1" class="animated-element" opacity="0"><line x1="2" y1="4" x2="2" y2="8" stroke="#dc2626" stroke-width="0.2" stroke-dasharray="0.4 0.4" /></g>
                                       <g id="anim-const-step-2" class="animated-element" opacity="0"><text x="0.8" y="6" fill="#dc2626" font-size="0.7">-٤</text></g>
                                       <g id="anim-const-step-3" class="animated-element" opacity="0"><line x1="2" y1="8" x2="6" y2="8" stroke="#16a34a" stroke-width="0.2" stroke-dasharray="0.4 0.4" /></g>
                                       <g id="anim-const-step-4" class="animated-element" opacity="0"><text x="4" y="9" fill="#16a34a" font-size="0.7" text-anchor="middle">٤</text></g>
                                    </svg>
                                    <div id="animation-explanation-constant" class="mt-4 p-4 bg-white rounded-lg border text-right min-h-[150px]"></div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="slope-anim-back-constant" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="step-counter-constant">0</span> / 3</span>
                                        <button id="slope-anim-next-constant" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-indigo-700">التالي</button>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <h3 class="text-xl font-bold text-gray-700">المثال ٢: معدل التغير غير الثابت</h3>
                                <p>يوضح الرسم أرباح شركة بالألف ريال خلال عدة أعوام. هل معدل التغير ثابت؟</p>
                                <div class="text-center">
                                    <svg id="slope-animation-svg-non-constant" viewBox="0 0 100 80" class="w-full h-72 bg-white border rounded-lg">
                                        <line x1="10" y1="5" x2="10" y2="70" stroke="#6b7280" stroke-width="0.5"/>
                                        <line x1="10" y1="70" x2="95" y2="70" stroke="#6b7280" stroke-width="0.5"/>
                                        <text x="5" y="10" font-size="4" fill="#374151">الأرباح</text>
                                        <text x="50" y="78" font-size="4" fill="#374151" text-anchor="middle">العام</text>
                                        <g font-size="3.5" text-anchor="middle" fill="#6b7280">
                                            <text x="5" y="65.5">٨</text><line x1="10" y1="65" x2="95" y2="65" stroke="#e5e7eb" stroke-width="0.25"/>
                                            <text x="5" y="54.5">٩</text><line x1="10" y1="53.75" x2="95" y2="53.75" stroke="#e5e7eb" stroke-width="0.25"/>
                                            <text x="5" y="43.5">١٠</text><line x1="10" y1="42.5" x2="95" y2="42.5" stroke="#e5e7eb" stroke-width="0.25"/>
                                            <text x="5" y="32.5">١١</text><line x1="10" y1="31.25" x2="95" y2="31.25" stroke="#e5e7eb" stroke-width="0.25"/>
                                            <text x="5" y="21.5">١٢</text><line x1="10" y1="20" x2="95" y2="20" stroke="#e5e7eb" stroke-width="0.25"/>
                                        </g>
                                        <g font-size="3.5" text-anchor="middle" fill="#6b7280">
                                            <text x="23.3" y="75">٢٦</text><line x1="23.3" y1="5" x2="23.3" y2="70" stroke="#e5e7eb" stroke-width="0.25"/>
                                            <text x="46.6" y="75">٢٨</text><line x1="46.6" y1="5" x2="46.6" y2="70" stroke="#e5e7eb" stroke-width="0.25"/>
                                            <text x="69.9" y="75">٣٠</text><line x1="69.9" y1="5" x2="69.9" y2="70" stroke="#e5e7eb" stroke-width="0.25"/>
                                            <text x="93.2" y="75">٣٢</text><line x1="93.2" y1="5" x2="93.2" y2="70" stroke="#e5e7eb" stroke-width="0.25"/>
                                        </g>
                                        <line id="nc-line-1" class="animated-element" x1="23.3" y1="65" x2="46.6" y2="53.75" stroke="#f97316" stroke-width="1"/>
                                        <line id="nc-line-2" class="animated-element" x1="46.6" y1="53.75" x2="69.9" y2="31.25" stroke="#f97316" stroke-width="1"/>
                                        <line id="nc-line-3" class="animated-element" x1="69.9" y1="31.25" x2="93.2" y2="20" stroke="#f97316" stroke-width="1"/>
                                        <circle cx="23.3" cy="65" r="1.2" fill="#f97316" />
                                        <circle cx="46.6" cy="53.75" r="1.2" fill="#f97316" />
                                        <circle cx="69.9" cy="31.25" r="1.2" fill="#f97316" />
                                        <circle cx="93.2" cy="20" r="1.2" fill="#f97316" />
                                        <g id="nc-anim-group-1" class="animated-element" opacity="0">
                                            <line x1="46.6" y1="65" x2="46.6" y2="53.75" stroke="#dc2626" stroke-width="0.5" stroke-dasharray="1 1"/>
                                            <line x1="23.3" y1="65" x2="46.6" y2="65" stroke="#16a34a" stroke-width="0.5" stroke-dasharray="1 1"/>
                                            <text x="48" y="60" font-size="4" fill="#dc2626">+١</text>
                                            <text x="35" y="68" font-size="4" fill="#16a34a" text-anchor="middle">+٢</text>
                                        </g>
                                        <g id="nc-anim-group-2" class="animated-element" opacity="0">
                                            <line x1="69.9" y1="53.75" x2="69.9" y2="31.25" stroke="#dc2626" stroke-width="0.5" stroke-dasharray="1 1"/>
                                            <line x1="46.6" y1="53.75" x2="69.9" y2="53.75" stroke="#16a34a" stroke-width="0.5" stroke-dasharray="1 1"/>
                                            <text x="71.3" y="42.5" font-size="4" fill="#dc2626">+٢</text>
                                            <text x="58.25" y="57" font-size="4" fill="#16a34a" text-anchor="middle">+٢</text>
                                        </g>
                                        <g id="nc-anim-group-3" class="animated-element" opacity="0">
                                            <line x1="93.2" y1="31.25" x2="93.2" y2="20" stroke="#dc2626" stroke-width="0.5" stroke-dasharray="1 1"/>
                                            <line x1="69.9" y1="31.25" x2="93.2" y2="31.25" stroke="#16a34a" stroke-width="0.5" stroke-dasharray="1 1"/>
                                            <text x="94.5" y="26" font-size="4" fill="#dc2626">+١</text>
                                            <text x="81.55" y="34.5" font-size="4" fill="#16a34a" text-anchor="middle">+٢</text>
                                        </g>
                                    </svg>
                                     <div id="animation-explanation-non-constant" class="mt-4 p-4 bg-white rounded-lg border text-right min-h-[150px]"></div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="slope-anim-back-non-constant" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="step-counter-non-constant">0</span> / 7</span>
                                        <button id="slope-anim-next-non-constant" class="nav-btn bg-orange-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-orange-700">التالي</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">🔍 رابعاً: تطبيقات على الميل</h2>
                    <div class="p-6 bg-gray-50 rounded-lg space-y-8">
                        <div>
                            <h3 class="text-xl font-bold text-gray-700 mb-4">أمثلة تفاعلية: إيجاد الميل بمعلومية نقطتين</h3>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div class="bg-white p-4 rounded-lg border space-y-2">
                                    <p><strong>مثال ١:</strong> أوجد ميل المستقيم المار بالنقطتين (س<sub class="text-sm">١</sub>, ص<sub class="text-sm">١</sub>) = (<span class="highlight-x">٢</span>، <span class="highlight-y">١</span>) و (س<sub class="text-sm">٢</sub>, ص<sub class="text-sm">٢</sub>) = (<span class="highlight-x">٥</span>، <span class="highlight-y">٧</span>).</p>
                                    <div class="bg-gray-50 p-4 rounded-lg border min-h-[150px]">
                                        <div id="slope-ex1-explanation" class="text-right text-xl"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="slope-ex1-back" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="slope-ex1-step-counter">0</span> / 4</span>
                                        <button id="slope-ex1-next" class="nav-btn bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">التالي</button>
                                    </div>
                                </div>
                                <div class="bg-white p-4 rounded-lg border space-y-2">
                                     <p><strong>مثال ٢:</strong> أوجد ميل المستقيم المار بالنقطتين (س<sub class="text-sm">١</sub>, ص<sub class="text-sm">١</sub>) = (<span class="highlight-x">-٣</span>، <span class="highlight-y">٤</span>) و (س<sub class="text-sm">٢</sub>, ص<sub class="text-sm">٢</sub>) = (<span class="highlight-x">١</span>، <span class="highlight-y">-٢</span>).</p>
                                     <div class="bg-gray-50 p-4 rounded-lg border min-h-[150px]">
                                        <div id="slope-ex2-explanation" class="text-right text-xl"></div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <button id="slope-ex2-back" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button>
                                        <span class="text-sm font-bold text-gray-600">الخطوة <span id="slope-ex2-step-counter">0</span> / 4</span>
                                        <button id="slope-ex2-next" class="nav-btn bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">التالي</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-700 mb-4">تدريب تفاعلي: إيجاد الإحداثي المجهول</h3>
                            <div class="space-y-4">
                                <p class="text-lg"><strong>المسألة:</strong> أوجد قيمة (ر) التي تجعل ميل المستقيم المار بالنقطتين (س<sub class="text-sm">١</sub>, ص<sub class="text-sm">١</sub>) = (<span class="highlight-x">١</span>، <span class="highlight-y">٤</span>) و (س<sub class="text-sm">٢</sub>, ص<sub class="text-sm">٢</sub>) = (<span class="highlight-x">-٥</span>، <span class="highlight-y">ر</span>) يساوي <span class="math-eq"><span class="fraction"><span>١</span><span>٣</span></span></span>.</p>
                                <div class="bg-white p-4 rounded-lg border min-h-[200px]">
                                    <div id="interactive-solver-explanation" class="text-right text-xl"></div>
                                </div>
                                <div class="mt-4 flex justify-between items-center">
                                    <button id="solver-back" class="nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600">رجوع</button>
                                    <span class="text-sm font-bold text-gray-600">الخطوة <span id="solver-step-counter">0</span> / 7</span>
                                    <button id="solver-next" class="nav-btn bg-indigo-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-indigo-700">التالي</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">✍️ خامساً: حان دورك! اختبر فهمك</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">نتيجتك النهائية</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">إعادة الاختبار</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">💡 شرح الإجابة</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationContentWrapper" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    const fractionHTML = (num, den) => `<span class="fraction"><span>${num}</span><span>${den}</span></span>`;
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">منصة الرياضيات التفاعلية</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">منصة الرياضيات التفاعلية</h1></a>`; } let userInfoHtml = ''; if (studentData) { userInfoHtml = `<div class="flex items-center gap-4"><span class="font-semibold">أهلاً، ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">خروج</a></div>`; } else { userInfoHtml = `<p class="text-lg text-gray-600">زائر</p>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; const logoutLink = headerContainer.querySelector('#logout-link'); if(logoutLink) { logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); } }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">© 2024 جميع الحقوق محفوظة | تصميم وتطوير: أ. عبدالعزيز خالد العبلان</p></div>`; }
    function createInteractiveSection(config) { let currentStep = 0; const renderStep = (step) => { config.stepCounter.textContent = step; let cumulativeHTML = ''; if (step === 0) { cumulativeHTML = config.stepsContent[0].text; } else { for (let i = 1; i <= step; i++) { cumulativeHTML += `<div class="explanation-step">${config.stepsContent[i].text}</div>`; } } config.explanationDiv.innerHTML = cumulativeHTML; if (config.customRender) { config.customRender(step); } config.backBtn.disabled = (step === 0); config.nextBtn.textContent = (step === config.totalSteps) ? 'إعادة' : 'التالي'; }; config.nextBtn.addEventListener('click', () => { currentStep = (currentStep < config.totalSteps) ? currentStep + 1 : 0; renderStep(currentStep); }); config.backBtn.addEventListener('click', () => { if (currentStep > 0) { currentStep--; renderStep(currentStep); } }); renderStep(0); }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">لا توجد أسئلة متاحة لهذا الدرس حالياً.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `المحاولات المتبقية: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p>${q.graph || ''}<div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">اعرف لماذا؟</button></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">تحقق من إجاباتي</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'لا توجد محاولات متبقية'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = '✔ إجابة صحيحة!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `❌ إجابة خاطئة.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden');}); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentData) { saveGrade(lessonId, finalGrade, studentData.id); if (attemptsLeft - 1 > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'تم عرض نتيجتك. سجل الدخول لحفظ تقدمك.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade, studentId) { if (!studentId) return; const saveStatus = document.getElementById('save-status'); saveStatus.textContent = 'جارٍ حفظ نتيجتك...'; const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&lessonId=${lessonId}&grade=${grade}`; fetch(url) .then(res => res.json()) .then(result => { if (result.status === 'success') { saveStatus.textContent = '✔ تم حفظ نتيجتك بنجاح! ستظهر في لوحة التحكم عند العودة.'; const studentData = JSON.parse(localStorage.getItem('currentStudent')); if (!studentData.lessons) studentData.lessons = {}; if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; } else { studentData.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(studentData)); } else { throw new Error(result.message); } }) .catch(error => { saveStatus.textContent = '❌ حدث خطأ أثناء حفظ الدرجة.'; console.error("Save Grade Error:", error); }); }
    function showExplanation(questionIndex) { const q = currentQuestions[questionIndex]; const modal = document.getElementById('explanationModal'); const contentWrapper = document.getElementById('explanationContentWrapper'); if(!modal || !contentWrapper || !q || !q.explanation) return; contentWrapper.innerHTML = ''; if (typeof q.explanation === 'object' && q.explanation.isInteractive) { const interactiveContainer = document.createElement('div'); if(q.explanation.tableHTML) { const tableDiv = document.createElement('div'); tableDiv.innerHTML = q.explanation.tableHTML; interactiveContainer.append(tableDiv); } const explanationDiv = document.createElement('div'); explanationDiv.className = 'text-right text-base mb-4 min-h-[100px]'; const navContainer = document.createElement('div'); navContainer.className = 'flex justify-between items-center'; const backBtn = document.createElement('button'); backBtn.className = 'nav-btn bg-gray-500 text-white font-medium py-2 px-6 rounded-lg hover:bg-gray-600 text-sm'; backBtn.textContent = 'رجوع'; const stepCounter = document.createElement('span'); stepCounter.className = 'text-xs font-bold text-gray-600'; const nextBtn = document.createElement('button'); nextBtn.className = 'nav-btn bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700 text-sm'; nextBtn.textContent = 'التالي'; navContainer.append(backBtn, stepCounter, nextBtn); interactiveContainer.append(explanationDiv, navContainer); contentWrapper.append(interactiveContainer); createInteractiveSection({ nextBtn: nextBtn, backBtn: backBtn, stepCounter: stepCounter, explanationDiv: explanationDiv, totalSteps: q.explanation.totalSteps, stepsContent: q.explanation.stepsContent, customRender: (step) => { if (q.explanation.tableHTML) { const rowsToHighlight = q.explanation.stepsContent[step].highlightRows || []; const allRows = interactiveContainer.querySelectorAll(`tr[data-expl-row]`); allRows.forEach((row, index) => { row.classList.toggle('bg-blue-100', rowsToHighlight.includes(index)); }); } } }); } else { contentWrapper.innerHTML = q.explanation; } modal.classList.remove('hidden'); }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    const LESSON_ID = 'c2_l5'; 
    const generateQuiz = () => { const questionBank = [ { type: 'mcq', level: '⭐', topic: 'concept', text: 'ماذا يصف معدل التغير؟', options: [ { display: 'نقطة بداية الدالة', value: 'A' }, { display: 'كيف تتغير كمية ما بالنسبة لأخرى', value: 'B' }, { display: 'أعلى قيمة تصل إليها الدالة', value: 'C' }, { display: 'طول الخط المستقيم', value: 'D' } ], correct: 'B', explanation: '<p>معدل التغير هو نسبة تقارن مقدار التغير في كمية (مثل المسافة) بمقدار التغير في كمية أخرى (مثل الزمن).</p>' }, { type: 'mcq', level: '⭐', topic: 'concept', text: 'في دالة خطية، اسم آخر لمعدل التغير هو:', options: [ { display: 'المقطع السيني', value: 'A' }, { display: 'الميل', value: 'B' }, { display: 'نقطة الأصل', value: 'C' }, { display: 'المجال', value: 'D' } ], correct: 'B', explanation: '<p>الميل هو الاسم الذي يطلق على معدل التغير الثابت في أي دالة خطية.</p>' }, { type: 'mcq', level: '⭐⭐', topic: 'slope_concept', text: 'عندما يتحرك الخط المستقيم للأعلى عند التحرك من اليسار إلى اليمين، يكون ميله:', options: [ { display: 'موجبًا', value: 'A' }, { display: 'سالبًا', value: 'B' }, { display: 'صفرًا', value: 'C' }, { display: 'غير معرف', value: 'D' } ], correct: 'A', explanation: '<p>الميل الموجب يعني أن الخط يتجه صعودًا عند النظر إليه من اليسار إلى اليمين.</p>' }, { type: 'mcq', level: '⭐⭐', topic: 'table-rate', text: 'من الجدول، هل معدل التغير ثابت؟ وإذا كان كذلك، فما قيمته؟', graph: `<div class="flex justify-center my-2"><table class="w-2/3 text-center border"> <thead class="bg-gray-200"><tr><th class="p-1 border">س</th><th class="p-1 border">ص</th></tr></thead> <tbody> <tr><td class="p-1 border">٢</td><td class="p-1 border">٥</td></tr> <tr><td class="p-1 border">٤</td><td class="p-1 border">١٠</td></tr> <tr><td class="p-1 border">٦</td><td class="p-1 border">١٥</td></tr> </tbody></table></div>`, options: [ { display: `نعم، ثابت ويساوي <span class="math-eq">${fractionHTML('5','2')}</span>`, value: 'A' }, { display: `نعم، ثابت ويساوي <span class="math-eq">${fractionHTML('2','5')}</span>`, value: 'B' }, { display: 'لا، غير ثابت', value: 'C' }, { display: 'نعم، ثابت ويساوي ٥', value: 'D' } ], correct: 'A', explanation: { isInteractive: true, tableHTML: `<div class="flex justify-center my-2"><table class="w-full text-center border"> <thead class="bg-gray-200"><tr><th class="p-1 border">س</th><th class="p-1 border">ص</th></tr></thead> <tbody> <tr data-expl-row="0"><td class="p-1 border">٢</td><td class="p-1 border">٥</td></tr> <tr data-expl-row="1"><td class="p-1 border">٤</td><td class="p-1 border">١٠</td></tr> <tr data-expl-row="2"><td class="p-1 border">٦</td><td class="p-1 border">١٥</td></tr> </tbody></table></div>`, totalSteps: 3, stepsContent: [ { text: "اضغط 'التالي' لتحليل الجدول.", highlightRows: [] }, { text: `<strong>1. المعدل الأول:</strong><br><div class="math-eq text-center mt-2">${fractionHTML('التغير في ص','التغير في س')} = ${fractionHTML('٥','٢')}</div>`, highlightRows: [0, 1] }, { text: `<strong>2. المعدل الثاني:</strong><br><div class="math-eq text-center mt-2">${fractionHTML('التغير في ص','التغير في س')} = ${fractionHTML('٥','٢')}</div>`, highlightRows: [1, 2] }, { text: `<strong>الاستنتاج:</strong><br>بما أن المعدل متساوٍ، فهو ثابت ويساوي ${fractionHTML('٥','٢')}.`, highlightRows: [] } ] } }, { type: 'mcq', level: '⭐⭐', topic: 'table-rate', text: 'من الجدول، هل معدل التغير ثابت؟', graph: `<div class="flex justify-center my-2"><table class="w-2/3 text-center border"> <thead class="bg-gray-200"><tr><th class="p-1 border">س</th><th class="p-1 border">ص</th></tr></thead> <tbody> <tr><td class="p-1 border">١</td><td class="p-1 border">١٠</td></tr> <tr><td class="p-1 border">٢</td><td class="p-1 border">٢٠</td></tr> <tr><td class="p-1 border">٤</td><td class="p-1 border">٥٠</td></tr> </tbody></table></div>`, options: [ { display: 'نعم، ثابت ويساوي ١٠', value: 'A' }, { display: 'لا، غير ثابت', value: 'B' }, { display: 'نعم، ثابت ويساوي ١٥', value: 'C' }, { display: 'نعم، ثابت ويساوي ١٢.٥', value: 'D' } ], correct: 'B', explanation: { isInteractive: true, tableHTML: `<div class="flex justify-center my-2"><table class="w-full text-center border"> <thead class="bg-gray-200"><tr><th class="p-1 border">س</th><th class="p-1 border">ص</th></tr></thead> <tbody> <tr data-expl-row="0"><td class="p-1 border">١</td><td class="p-1 border">١٠</td></tr> <tr data-expl-row="1"><td class="p-1 border">٢</td><td class="p-1 border">٢٠</td></tr> <tr data-expl-row="2"><td class="p-1 border">٤</td><td class="p-1 border">٥٠</td></tr> </tbody></table></div>`, totalSteps: 3, stepsContent: [ { text: "اضغط 'التالي' لتحليل الجدول.", highlightRows: [] }, { text: `<strong>1. المعدل الأول:</strong><br><div class="math-eq text-center mt-2">${fractionHTML('التغير في ص','التغير في س')} = ${fractionHTML('١٠','١')} = ١٠</div>`, highlightRows: [0, 1] }, { text: `<strong>2. المعدل الثاني:</strong><br><div class="math-eq text-center mt-2">${fractionHTML('التغير في ص','التغير في س')} = ${fractionHTML('٣٠','٢')} = ١٥</div>`, highlightRows: [1, 2] }, { text: `<strong>الاستنتاج:</strong><br>بما أن ١٠ ≠ ١٥، فالمعدل غير ثابت.`, highlightRows: [] } ] } }, { type: 'mcq', level: '⭐⭐', topic: 'graph-rate', text: 'من الرسم البياني، هل معدل التغير ثابت؟ وإذا كان كذلك، فما قيمته؟', graph: '<svg viewBox="-1 -1 7 7" class="w-full h-40 bg-white border rounded-lg mt-2"><path d="M 0,1 L 6,1 M 0,2 L 6,2 M 0,3 L 6,3 M 0,4 L 6,4 M 0,5 L 6,5 M 1,0 L 1,6 M 2,0 L 2,6 M 3,0 L 3,6 M 4,0 L 4,6 M 5,0 L 5,6" stroke="#e5e7eb" stroke-width="0.1" /><line x1="0" y1="6" x2="0" y2="0" stroke="#9ca3af" stroke-width="0.15" /><line x1="0" y1="6" x2="6" y2="6" stroke="#9ca3af" stroke-width="0.15" /><line x1="1" y1="5" x2="3" y2="1" stroke="#3b82f6" stroke-width="0.3" /><circle cx="1" cy="5" r="0.15" fill="#ef4444" /><circle cx="3" cy="1" r="0.15" fill="#ef4444" /></svg>', options: [ { display: 'نعم، ثابت ويساوي ٢', value: 'A' }, { display: 'نعم، ثابت ويساوي -٢', value: 'B' }, { display: 'لا، غير ثابت', value: 'C' }, { display: `نعم، ثابت ويساوي -${fractionHTML('1','2')}`, value: 'D' } ], correct: 'A', explanation: { isInteractive: true, totalSteps: 3, stepsContent: [ { text: "اضغط 'التالي' لتحليل الرسم." }, { text: `<strong>1. تحديد نقطتين:</strong><br>نختار النقطتين (١، ١) و (٣، ٥).` }, { text: `<strong>2. حساب الميل:</strong><br><div class="math-eq text-center mt-2">${fractionHTML('٥ - ١','٣ - ١')} = ${fractionHTML('٤','٢')}</div>` }, { text: `<strong>الاستنتاج:</strong><br>الميل ثابت ويساوي ٢.` } ] } }, { type: 'mcq', level: '⭐⭐', topic: 'graph-rate', text: 'من الرسم البياني، هل معدل التغير ثابت؟', graph: '<svg viewBox="0 0 20 20" class="w-full h-40 bg-white border rounded-lg mt-2"><path d="M1,19 C 4,15 8,1 19,1" stroke="#f97316" fill="none" stroke-width="1.2"/></svg>', options: [ { display: 'نعم، لأن الخط يتجه للأعلى', value: 'A' }, { display: 'لا، لأنه منحنى وليس خطًا مستقيمًا', value: 'B' }, { display: 'نعم، لأن ميله موجب', value: 'C' }, { display: 'لا، لأن ميله سالب', value: 'D' } ], correct: 'B', explanation: '<p>الرسم لا يمثل خطًا مستقيمًا، بل منحنى. هذا يعني أن الميل يتغير عند كل نقطة، وبالتالي فإن معدل التغير غير ثابت.</p>' }, { type: 'mcq', level: '⭐⭐', topic: 'two-point-calc', text: 'أوجد ميل المستقيم المار بالنقطتين (٢, ٥) و (٤, ٩).', options: [ { display: '<span class="math-eq">٢</span>', value: 'A' }, { display: `<span class="math-eq">${fractionHTML('١','٢')}</span>`, value: 'B' }, { display: '<span class="math-eq">-٢</span>', value: 'C' }, { display: '<span class="math-eq">٤</span>', value: 'D' } ], correct: 'A', explanation: `<p>الميل = ${fractionHTML('٩ - ٥','٤ - ٢')} = ${fractionHTML('٤','٢')} = ٢.</p>` }, { type: 'mcq', level: '⭐⭐⭐', topic: 'two-point-calc', text: 'أوجد ميل المستقيم المار بالنقطتين (-١, ٣) و (٢, -٣).', options: [ { display: '<span class="math-eq">٢</span>', value: 'A' }, { display: '<span class="math-eq">٠</span>', value: 'B' }, { display: '<span class="math-eq">-٢</span>', value: 'C' }, { display: '<span class="math-eq">غير معرف</span>', value: 'D' } ], correct: 'C', explanation: `<p>الميل = ${fractionHTML('-٣ - ٣','٢ - (-١)')} = ${fractionHTML('-٦','٣')} = -٢.</p>` }, { type: 'mcq', level: '⭐⭐⭐', topic: 'find-coordinate', text: 'أوجد قيمة (ر) التي تجعل ميل المستقيم المار بالنقطتين (٢، ر) و (٥، ٨) يساوي ٢.', options: [ { display: '٢', value: 'A' }, { display: '١٤', value: 'B' }, { display: '٤', value: 'C' }, { display: '١', value: 'D' } ], correct: 'A', explanation: `<p>نستخدم صيغة الميل: ٢ = ${fractionHTML('٨ - ر', '٥ - ٢')}.<br>٢ = ${fractionHTML('٨ - ر', '٣')}.<br>٦ = ٨ - ر.<br>إذًا، ر = ٢.</p>` }, { type: 'mcq', level: '⭐⭐⭐', topic: 'real-life', text: 'طابعة تطبع ١٢٠ صفحة في ٤ دقائق. ما هو معدل تغير عدد الصفحات المطبوعة في الدقيقة؟', options: [ { display: '٣٠ صفحة/دقيقة', value: 'A' }, { display: '٤٨٠ صفحة/دقيقة', value: 'B' }, { display: '٤٠ صفحة/دقيقة', value: 'C' }, { display: '١٢٠ صفحة/دقيقة', value: 'D' } ], correct: 'A', explanation: `<p>معدل التغير = ${fractionHTML('١٢٠ صفحة','٤ دقائق')} = ٣٠ صفحة/دقيقة.</p>` }, { type: 'mcq', level: '⭐⭐', topic: 'table-rate', text: 'ما هو معدل التغير في سعر الدقيقة بين الشهرين الأول والثالث؟', graph: `<div class="flex justify-center my-2"><table class="w-2/3 text-center border"> <thead class="bg-gray-200"><tr><th class="p-1 border">الشهر</th><th class="p-1 border">سعر الدقيقة (هللة)</th></tr></thead> <tbody> <tr><td class="p-1 border">١</td><td class="p-1 border">٤٥</td></tr> <tr><td class="p-1 border">٢</td><td class="p-1 border">٤٠</td></tr> <tr><td class="p-1 border">٣</td><td class="p-1 border">٣٥</td></tr> </tbody></table></div>`, options: [ { display: '-٥ هللة/شهر', value: 'A' }, { display: '٥ هللة/شهر', value: 'B' }, { display: '-١٠ هللة/شهر', value: 'C' }, { display: '١٠ هللة/شهر', value: 'D' } ], correct: 'A', explanation: `<p>معدل التغير = ${fractionHTML('٣٥ - ٤٥','٣ - ١')} = ${fractionHTML('-١٠','٢')} = -٥ هللة لكل شهر.</p>` } ]; const shuffled = [...questionBank].sort(() => 0.5 - Math.random()); const questionCount = Math.min(shuffled.length, 5); return shuffled.slice(0, questionCount); }
    document.addEventListener('DOMContentLoaded', () => {
        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) { closeModalBtn.addEventListener('click', closeModal); }

        // Initialize all interactive examples from the old version
        const slopeSummaryContainer = document.getElementById('slope-summary-container');
        if(slopeSummaryContainer) {
            slopeSummaryContainer.innerHTML = `<div class="p-2 bg-white rounded-lg border"><svg viewBox="0 0 20 20" class="w-full h-24"><line x1="1" y1="10" x2="19" y2="10" stroke="#9ca3af" stroke-width="0.5"/><line x1="10" y1="1" x2="10" y2="19" stroke="#9ca3af" stroke-width="0.5"/><line x1="1" y1="15" x2="9" y2="5" stroke="#2563eb" stroke-width="1.2"/></svg><p class="font-bold mt-1 text-sm">ميل موجب</p></div><div class="p-2 bg-white rounded-lg border"><svg viewBox="0 0 20 20" class="w-full h-24"><line x1="1" y1="10" x2="19" y2="10" stroke="#9ca3af" stroke-width="0.5"/><line x1="10" y1="1" x2="10" y2="19" stroke="#9ca3af" stroke-width="0.5"/><line x1="1" y1="5" x2="9" y2="15" stroke="#dc2626" stroke-width="1.2"/></svg><p class="font-bold mt-1 text-sm">ميل سالب</p></div><div class="p-2 bg-white rounded-lg border"><svg viewBox="0 0 20 20" class="w-full h-24"><line x1="1" y1="10" x2="19" y2="10" stroke="#9ca3af" stroke-width="0.5"/><line x1="10" y1="1" x2="10" y2="19" stroke="#9ca3af" stroke-width="0.5"/><line x1="2" y1="5" x2="18" y2="5" stroke="#16a34a" stroke-width="1.2"/></svg><p class="font-bold mt-1 text-sm">ميل صفر</p></div><div class="p-2 bg-white rounded-lg border"><svg viewBox="0 0 20 20" class="w-full h-24"><line x1="1" y1="10" x2="19" y2="10" stroke="#9ca3af" stroke-width="0.5"/><line x1="10" y1="1" x2="10" y2="19" stroke="#9ca3af" stroke-width="0.5"/><line x1="15" y1="2" x2="15" y2="18" stroke="#ca8a04" stroke-width="1.2"/></svg><p class="font-bold mt-1 text-sm">ميل غير معرف</p></div>`;
        }
        createInteractiveSection({ nextBtn: document.getElementById('table-const-next'), backBtn: document.getElementById('table-const-back'), stepCounter: document.getElementById('table-const-step-counter'), explanationDiv: document.getElementById('table-const-explanation'), totalSteps: 4, stepsContent: [ { text: "اضغط 'التالي' للتحقق إذا كان معدل التغير ثابتًا." }, { text: `<strong>1. نحسب المعدل بين النقطتين الأولى والثانية:</strong><br><div class="math-eq text-center mt-2">${fractionHTML('التغير في ص', 'التغير في س')} = ${fractionHTML('١٠', '٣٠')} = ${fractionHTML('١', '٣')}</div>` }, { text: `<strong>2. نحسب المعدل بين النقطتين الثانية والثالثة:</strong><br><div class="math-eq text-center mt-2">${fractionHTML('التغير في ص', 'التغير في س')} = ${fractionHTML('١٠', '٣٠')} = ${fractionHTML('١', '٣')}</div>` }, { text: `<strong>3. المقارنة:</strong><br>المعدل في الحالتين = <span class="math-eq">${fractionHTML('١','٣')}</span>.`}, { text: `<strong>الاستنتاج:</strong><br>بما أن المعدل متساوٍ، فإن <span class="font-bold text-green-600">معدل التغير ثابت</span>.`} ], customRender: (step) => { document.getElementById('table-const-vis-1a').style.opacity = step >= 1 ? '1' : '0'; document.getElementById('table-const-vis-1b').style.opacity = step >= 1 ? '1' : '0'; document.getElementById('table-const-vis-2a').style.opacity = step >= 2 ? '1' : '0'; document.getElementById('table-const-vis-2b').style.opacity = step >= 2 ? '1' : '0'; document.getElementById('table-const-row-1').classList.toggle('bg-blue-100', step === 1); document.getElementById('table-const-row-2').classList.toggle('bg-blue-100', step === 1 || step === 2); document.getElementById('table-const-row-3').classList.toggle('bg-blue-100', step === 2); } });
        createInteractiveSection({ nextBtn: document.getElementById('table-nonconst-next'), backBtn: document.getElementById('table-nonconst-back'), stepCounter: document.getElementById('table-nonconst-step-counter'), explanationDiv: document.getElementById('table-nonconst-explanation'), totalSteps: 4, stepsContent: [ { text: "اضغط 'التالي' للتحقق إذا كان معدل التغير ثابتًا." }, { text: `<strong>1. نحسب المعدل بين اليوم الأول والخامس:</strong><br><div class="math-eq text-center mt-2">${fractionHTML('التغير في ص', 'التغير في س')} = ${fractionHTML('٢٠٠', '٤')} = ٥٠</div>` }, { text: `<strong>2. نحسب المعدل بين اليوم الخامس والسابع:</strong><br><div class="math-eq text-center mt-2">${fractionHTML('التغير في ص', 'التغير في س')} = ${fractionHTML('٤٠٠', '٢')} = ٢٠٠</div>` }, { text: `<strong>3. المقارنة:</strong><br>المعدل الأول <span class="math-eq">٥٠</span> لا يساوي المعدل الثاني <span class="math-eq">٢٠٠</span>.`}, { text: `<strong>الاستنتاج:</strong><br>بما أن المعدل مختلف، فإن <span class="font-bold text-red-600">معدل التغير غير ثابت</span>.`} ], customRender: (step) => { document.getElementById('table-nonconst-vis-1a').style.opacity = step >= 1 ? '1' : '0'; document.getElementById('table-nonconst-vis-1b').style.opacity = step >= 1 ? '1' : '0'; document.getElementById('table-nonconst-vis-2a').style.opacity = step >= 2 ? '1' : '0'; document.getElementById('table-nonconst-vis-2b').style.opacity = step >= 2 ? '1' : '0'; document.getElementById('table-nonconst-row-1').classList.toggle('bg-orange-100', step === 1); document.getElementById('table-nonconst-row-2').classList.toggle('bg-orange-100', step === 1 || step === 2); document.getElementById('table-nonconst-row-3').classList.toggle('bg-orange-100', step === 2); } });
        createInteractiveSection({ nextBtn: document.getElementById('slope-anim-next-constant'), backBtn: document.getElementById('slope-anim-back-constant'), stepCounter: document.getElementById('step-counter-constant'), explanationDiv: document.getElementById('animation-explanation-constant'), totalSteps: 3, stepsContent: [ { text: "اضغط على 'التالي' لبدء الشرح خطوة بخطوة." }, { text: "<strong>1. نجد التغير الرأسي (الارتفاع):</strong> أربع خطوات للأسفل (-٤)." }, { text: "<strong>2. نجد التغير الأفقي (الامتداد):</strong> أربع خطوات لليمين (+٤)." }, { text: `<strong>3. نحسب الميل:</strong><br><div class="p-2 bg-blue-100 rounded-md text-blue-800 text-lg mt-2">الميل = ${fractionHTML('الارتفاع','الامتداد')} = ${fractionHTML('-٤','٤')} = -١</div>` } ], customRender: (step) => { document.getElementById('anim-const-step-1').style.opacity = step >= 1 ? '1' : '0'; document.getElementById('anim-const-step-2').style.opacity = step >= 1 ? '1' : '0'; document.getElementById('anim-const-step-3').style.opacity = step >= 2 ? '1' : '0'; document.getElementById('anim-const-step-4').style.opacity = step >= 2 ? '1' : '0'; } });
        createInteractiveSection({ nextBtn: document.getElementById('slope-anim-next-non-constant'), backBtn: document.getElementById('slope-anim-back-non-constant'), stepCounter: document.getElementById('step-counter-non-constant'), explanationDiv: document.getElementById('animation-explanation-non-constant'), totalSteps: 7, stepsContent: [ { text: "اضغط 'التالي' لتحليل معدل التغير لكل فترة." }, { text: `<strong>الفترة الأولى (بين عامي ٢٦ و ٢٨):</strong><br>يظهر الرسم امتدادًا بمقدار ٢ و ارتفاعًا بمقدار ١.` }, { text: `معدل التغير = <div class="math-eq inline-block">${fractionHTML('١','٢')}</div>` }, { text: `<strong>الفترة الثانية (بين عامي ٢٨ و ٣٠):</strong><br>يظهر الرسم امتدادًا بمقدار ٢ و ارتفاعًا بمقدار ٢.` }, { text: `معدل التغير = <div class="math-eq inline-block">${fractionHTML('٢','٢')} = ١</div>` }, { text: `<strong>الفترة الثالثة (بين عامي ٣٠ و ٣٢):</strong><br>يظهر الرسم امتدادًا بمقدار ٢ و ارتفاعًا بمقدار ١.` }, { text: `معدل التغير = <div class="math-eq inline-block">${fractionHTML('١','٢')}</div>` }, { text: `<strong>الاستنتاج:</strong><br>بما أن المعدلات (${fractionHTML('١','٢')}، ١، ${fractionHTML('١','٢')}) مختلفة، فإن <span class="font-bold text-red-600">معدل التغير غير ثابت</span>.` } ], customRender: (step) => { const anim1 = document.getElementById('nc-anim-group-1'); const anim2 = document.getElementById('nc-anim-group-2'); const anim3 = document.getElementById('nc-anim-group-3'); anim1.style.opacity = (step >= 1 && step < 3) ? '1' : '0'; anim2.style.opacity = (step >= 3 && step < 5) ? '1' : '0'; anim3.style.opacity = (step >= 5 && step < 7) ? '1' : '0'; document.getElementById('nc-line-1').style.stroke = (step >= 1 && step < 3) ? '#dc2626' : '#f97316'; document.getElementById('nc-line-2').style.stroke = (step >= 3 && step < 5) ? '#dc2626' : '#f97316'; document.getElementById('nc-line-3').style.stroke = (step >= 5 && step < 7) ? '#dc2626' : '#f97316'; } });
        createInteractiveSection({ nextBtn: document.getElementById('slope-ex1-next'), backBtn: document.getElementById('slope-ex1-back'), stepCounter: document.getElementById('slope-ex1-step-counter'), explanationDiv: document.getElementById('slope-ex1-explanation'), totalSteps: 4, stepsContent: [ { text: "اضغط 'التالي' لبدء الحل." }, { text: `<strong>1. كتابة صيغة الميل:</strong><br><div class="math-eq text-center mt-2">م = ${fractionHTML('ص₂ - ص₁', 'س₂ - س₁')}</div>` }, { text: `<strong>2. التعويض في الصيغة:</strong><br><div class="math-eq text-center mt-2">م = ${fractionHTML('<span class="highlight-y">٧</span> - <span class="highlight-y">١</span>', '<span class="highlight-x">٥</span> - <span class="highlight-x">٢</span>')}</div>` }, { text: `<strong>3. تبسيط الكسر:</strong><br><div class="math-eq text-center mt-2">م = ${fractionHTML('٦', '٣')}</div>` }, { text: `<strong>4. الحل النهائي:</strong><br><div class="p-2 bg-green-100 rounded-md inline-block mt-2"><span class="math-eq text-green-700">م = ٢</span></div>` } ], customRender: () => {} });
        createInteractiveSection({ nextBtn: document.getElementById('slope-ex2-next'), backBtn: document.getElementById('slope-ex2-back'), stepCounter: document.getElementById('slope-ex2-step-counter'), explanationDiv: document.getElementById('slope-ex2-explanation'), totalSteps: 4, stepsContent: [ { text: "اضغط 'التالي' لبدء الحل." }, { text: `<strong>1. كتابة صيغة الميل:</strong><br><div class="math-eq text-center mt-2">م = ${fractionHTML('ص₂ - ص₁', 'س₂ - س₁')}</div>` }, { text: `<strong>2. التعويض في الصيغة:</strong><br><div class="math-eq text-center mt-2">م = ${fractionHTML('<span class="highlight-y">-٢</span> - <span class="highlight-y">٤</span>', '<span class="highlight-x">١</span> - (<span class="highlight-x">-٣</span>)')}</div>` }, { text: `<strong>3. تبسيط الكسر:</strong><br><div class="math-eq text-center mt-2">م = ${fractionHTML('-٦', '٤')}</div>` }, { text: `<strong>4. الحل النهائي:</strong><br><div class="p-2 bg-green-100 rounded-md inline-block mt-2"><span class="math-eq text-green-700">م = -${fractionHTML('٣', '٢')}</span></div>` } ], customRender: () => {} });
        createInteractiveSection({ nextBtn: document.getElementById('solver-next'), backBtn: document.getElementById('solver-back'), stepCounter: document.getElementById('solver-step-counter'), explanationDiv: document.getElementById('interactive-solver-explanation'), totalSteps: 7, stepsContent: [ { text: "اضغط 'التالي' لبدء حل المسألة خطوة بخطوة." }, { text: `<strong>1. كتابة صيغة الميل:</strong><br><div class="math-eq text-center mt-2">م = ${fractionHTML('ص<sub class="text-sm">٢</sub> - ص<sub class="text-sm">١</sub>', 'س<sub class="text-sm">٢</sub> - س<sub class="text-sm">١</sub>')}</div>` }, { text: `<strong>2. التعويض بالقيم:</strong><br><div class="math-eq text-center mt-2">${fractionHTML('١','٣')} = ${fractionHTML('<span class="highlight-y">ر</span> - <span class="highlight-y">٤</span>','<span class="highlight-x">-٥</span> - <span class="highlight-x">١</span>')}</div>` }, { text: `<strong>3. تبسيط المقام:</strong><br><div class="math-eq text-center mt-2">${fractionHTML('١','٣')} = ${fractionHTML('ر - ٤','-٦')}</div>` }, { text: `<strong>4. الضرب التبادلي:</strong><br><div class="math-eq text-center mt-2">١ × (-٦) = ٣ × (ر - ٤)</div>` }, { text: `<strong>5. تبسيط المعادلة:</strong><br><div class="math-eq text-center mt-2">-٦ = ٣ر - ١٢</div>` }, { text: `<strong>6. حل المعادلة (جمع ١٢ للطرفين):</strong><br><div class="math-eq text-center mt-2">٦ = ٣ر</div>` }, { text: `<strong>7. الحل النهائي (القسمة على ٣):</strong><br><div class="p-2 bg-green-100 rounded-md inline-block mt-2"><span class="math-eq text-green-700">ر = ٢</span></div>` } ], customRender: () => {} });
    });
    </script>
</body>
</html>
