<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุฏุฑุณ ูข-ูก: ุงูุนูุงูุงุช | ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .hidden { display: none; }
        .step-box { border-right: 4px solid #1d4ed8; }
        .vocab-term { background-color: #ffefc5; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .option-label { display: block; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease-in-out; }
        .option-label:hover { border-color: #3b82f6; background-color: #eff6ff; }
        input[type="radio"]:checked + .option-label { border-color: #2563eb; background-color: #dbeafe; box-shadow: 0 0 0 2px #bfdbfe; }
        input[type="radio"] { display: none; }
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .highlight-change { color: #ef4444; font-weight: bold; }
        
        .math-eq {
            font-family: "Courier New", monospace;
            font-size: 1.2rem;
            font-weight: bold;
            color: #4338ca;
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            padding: 2px 8px;
            border-radius: 6px;
            display: inline-block;
            vertical-align: middle;
        }
        
        .step-interactive { display: none; opacity: 0; transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; transform: translateY(10px); }
        .step-interactive.active { display: block; opacity: 1; transform: translateY(0); }

        /* Styles for Visuals */
        .styled-table { width: 100%; margin: 1rem auto; border-collapse: collapse; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .styled-table th, .styled-table td { border: 1px solid #e5e7eb; padding: 8px 12px; text-align: center; transition: color 0.3s ease-in-out, background-color 0.3s ease-in-out; }
        .styled-table th { background-color: #f9fafb; font-weight: bold; color: #374151; }
        .styled-table td.highlight-domain-bg { background-color: #dbeafe; }
        .styled-table td.highlight-range-bg { background-color: #dcfce7; }

        .diagram-container { position: relative; display: flex; justify-content: space-around; align-items: center; padding: 1rem; min-height: 220px; }
        .diagram-col { display: flex; flex-direction: column; gap: 1rem; padding: 1rem; border-radius: 8px; transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out; }
        .diagram-col-domain { border: 2px solid #93c5fd; background-color: #eff6ff; }
        .diagram-col-range { border: 2px solid #86efac; background-color: #f0fdf4; }
        .diagram-col.highlight-domain-border { border-color: #2563eb; box-shadow: 0 0 0 2px #bfdbfe; }
        .diagram-col.highlight-range-border { border-color: #22c55e; box-shadow: 0 0 0 2px #bbf7d0; }

        .diagram-col h5 { font-weight: bold; text-align: center; margin-bottom: 0.5rem; color: #1e40af; }
        .diagram-item { background-color: #fff; border: 1px solid #d1d5db; padding: 0.5rem 1rem; border-radius: 6px; font-weight: bold; text-align: center; transition: color 0.3s ease-in-out, border-color 0.3s ease-in-out; }
        .diagram-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        .graph-segment { stroke: #d1d5db; stroke-width: 4; stroke-linecap: round; fill: none; transition: stroke 0.5s ease-in-out; }
        .graph-segment.active-0 { stroke: #16a34a; }
        .graph-segment.active-1 { stroke: #f59e0b; }
        .graph-segment.active-2 { stroke: #8b5cf6; }

        .number-control-display { min-width: 4.5rem; }
        
        .faded { color: #d1d5db !important; border-color: #d1d5db !important; }
        .interactive-element { opacity: 0; transition: opacity 0.4s ease-in-out; }
        .interactive-element.visible { opacity: 1; }

    </style>
</head>
<body class="bg-gray-100">
    <div id="app-container" class="grid grid-template-rows: auto 1fr auto; min-height: 100vh;">
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-50"></header>
        <main class="container mx-auto max-w-5xl my-8">
            <div class="p-6 bg-white rounded-xl shadow-lg">
                <header class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h1 id="lesson-title" class="text-3xl font-bold text-blue-800">ุงูุฏุฑุณ ูข-ูก: ุงูุนูุงูุงุช</h1>
                    <a href="../index.html" target="_top" class="text-sm text-blue-600 hover:underline">&larr; ุงูุนูุฏุฉ ุฅูู ุงูููุฑุณ</a>
                </header>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ก ุฃููุงู: ุงูููููู ุงูุฃุณุงุณู</h2>
                    <div class="p-4 bg-blue-50 rounded-lg space-y-4">
                        <p>ูู ุงูุฑูุงุถูุงุชุ <span class="vocab-term">ุงูุนูุงูุฉ</span> ูู ูุฌููุนุฉ ูู ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉุ ูุซู <span class="math-eq">{ (ูข, ูก), (ูฃ, ูฅ), (-ูก, ูค) }</span>. ูููููุง ุชูุซูู ูุฐู ุงูุนูุงูุงุช ุจุทุฑู ูุฎุชููุฉ: ุฌุฏููุ ุชูุซูู ุจูุงููุ ุฃู ูุฎุทุท ุณููู.</p>
                        <p>ููู ุนูุงูุฉุ ูุญุฏุฏ ูุฌููุนุชูู ูููุชูู: <span class="vocab-term">ุงููุฌุงู</span> ููู ูุฌููุนุฉ ูู ุงูุฅุญุฏุงุซูุงุช ุงูุฃููู (ููู ุณ)ุ ู<span class="vocab-term">ุงููุฏู</span> ููู ูุฌููุนุฉ ูู ุงูุฅุญุฏุงุซูุงุช ุงูุซุงููุฉ (ููู ุต).</p>
                        <p>ุนูุฏูุง ุชุฑุจุท ุงูุนูุงูุฉ ุจูู ูููุชููุ ูุณูู ุฅุญุฏุงููุง <span class="vocab-term">ุงููุชุบูุฑ ุงููุณุชูู</span> (ุงููุฏุฎูุฉ) ูุงูุฃุฎุฑู <span class="vocab-term">ุงููุชุบูุฑ ุงูุชุงุจุน</span> (ุงููุฎุฑุฌุฉ)ุ ูุฃู ูููุฉ ุงููุชุบูุฑ ุงูุชุงุจุน ุชุนุชูุฏ ุนูู ูููุฉ ุงููุชุบูุฑ ุงููุณุชูู.</p>
                    </div>
                </section>
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">๐ฏ ุซุงููุงู: ุฃูุซูุฉ ุชูุงุนููุฉ</h2>
                    <div class="p-6 bg-gray-50 rounded-lg">
                        <div class="flex flex-col space-y-8">
                            <!-- ุงููุซุงู ุงูุฃูู ุงููุญุฏุซ -->
                            <div id="interactive-container-1" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4">ูุซุงู ูก: ุชูุซูู ุงูุนูุงูุฉ ูุชุญุฏูุฏ ุงููุฌุงู ูุงููุฏู</p>
                                <p class="mb-4">ูุซู ุงูุนูุงูุฉ <span class="math-eq">{ (ูค ,ูฃ) , (-ูข,-ูก) , (ูข,-ูค) , (ู,-ูค) }</span> ุฎุทูุฉ ุจุฎุทูุฉ.</p>
                                <div class="p-4 bg-gray-50 rounded-lg">
                                    <div class="grid md:grid-cols-3 gap-6 items-start">
                                        <div>
                                            <h4 class="font-bold text-center mb-2">ูก. ุฌุฏูู</h4>
                                            <table class="styled-table"><thead><tr><th>ุณ</th><th>ุต</th></tr></thead>
                                                <tbody>
                                                    <tr><td id="td-x-0" class="td-x">ูค</td><td id="td-y-0" class="td-y">ูฃ</td></tr>
                                                    <tr><td id="td-x-1" class="td-x">-ูข</td><td id="td-y-1" class="td-y">-ูก</td></tr>
                                                    <tr><td id="td-x-2" class="td-x">ูข</td><td id="td-y-2" class="td-y">-ูค</td></tr>
                                                    <tr><td id="td-x-3" class="td-x">ู</td><td id="td-y-3" class="td-y">-ูค</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-center mb-2">ูข. ุชูุซูู ุจูุงูู</h4>
                                            <svg viewBox="-50 -50 100 100" class="w-full h-auto bg-white border rounded">
                                                <g stroke="#e5e7eb" stroke-width="0.5">
                                                    <line x1="-50" y1="-40" x2="50" y2="-40"></line><line x1="-50" y1="-30" x2="50" y2="-30"></line><line x1="-50" y1="-20" x2="50" y2="-20"></line><line x1="-50" y1="-10" x2="50" y2="-10"></line>
                                                    <line x1="-50" y1="10" x2="50" y2="10"></line><line x1="-50" y1="20" x2="50" y2="20"></line><line x1="-50" y1="30" x2="50" y2="30"></line><line x1="-50" y1="40" x2="50" y2="40"></line>
                                                    <line x1="-40" y1="-50" x2="-40" y2="50"></line><line x1="-30" y1="-50" x2="-30" y2="50"></line><line x1="-20" y1="-50" x2="-20" y2="50"></line><line x1="-10" y1="-50" x2="-10" y2="50"></line>
                                                    <line x1="10" y1="-50" x2="10" y2="50"></line><line x1="20" y1="-50" x2="20" y2="50"></line><line x1="30" y1="-50" x2="30" y2="50"></line><line x1="40" y1="-50" x2="40" y2="50"></line>
                                                </g>
                                                <line x1="-50" y1="0" x2="50" y2="0" stroke="#9ca3af" stroke-width="1"/><line x1="0" y1="-50" x2="0" y2="50" stroke="#9ca3af" stroke-width="1"/>
                                                <g id="domain-projections" class="interactive-element">
                                                    <line x1="40" y1="-30" x2="40" y2="0" stroke="#3b82f6" stroke-width="1" stroke-dasharray="2,2"></line><text x="40" y="7" fill="#3b82f6" font-size="7" font-weight="bold" text-anchor="middle">ูค</text>
                                                    <line x1="-20" y1="10" x2="-20" y2="0" stroke="#3b82f6" stroke-width="1" stroke-dasharray="2,2"></line><text x="-20" y="7" fill="#3b82f6" font-size="7" font-weight="bold" text-anchor="middle">-ูข</text>
                                                    <line x1="20" y1="40" x2="20" y2="0" stroke="#3b82f6" stroke-width="1" stroke-dasharray="2,2"></line><text x="20" y="7" fill="#3b82f6" font-size="7" font-weight="bold" text-anchor="middle">ูข</text>
                                                    <line x1="0" y1="40" x2="0" y2="0" stroke="#3b82f6" stroke-width="1" stroke-dasharray="2,2"></line>
                                                    <circle cx="0" cy="0" r="2" fill="#3b82f6" stroke="#fff" stroke-width="0.5"></circle><text x="0" y="7" fill="#3b82f6" font-size="7" font-weight="bold" text-anchor="middle">ู</text>
                                                </g>
                                                <g id="range-projections" class="interactive-element">
                                                    <line x1="40" y1="-30" x2="0" y2="-30" stroke="#16a34a" stroke-width="1" stroke-dasharray="2,2"></line><text x="-7" y="-30" fill="#16a34a" font-size="7" font-weight="bold" text-anchor="middle">ูฃ</text>
                                                    <line x1="-20" y1="10" x2="0" y2="10" stroke="#16a34a" stroke-width="1" stroke-dasharray="2,2"></line><text x="-7" y="10" fill="#16a34a" font-size="7" font-weight="bold" text-anchor="middle">-ูก</text>
                                                    <line x1="20" y1="40" x2="0" y2="40" stroke="#16a34a" stroke-width="1" stroke-dasharray="2,2"></line><text x="-7" y="40" fill="#16a34a" font-size="7" font-weight="bold" text-anchor="middle">-ูค</text>
                                                </g>
                                                <circle id="point-0" class="interactive-element" cx="40" cy="-30" r="3" fill="#ef4444"/>
                                                <circle id="point-1" class="interactive-element" cx="-20" cy="10" r="3" fill="#ef4444"/>
                                                <circle id="point-2" class="interactive-element" cx="20" cy="40" r="3" fill="#ef4444"/>
                                                <circle id="point-3" class="interactive-element" cx="0" cy="40" r="3" fill="#ef4444"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-center mb-2">ูฃ. ูุฎุทุท ุณููู</h4>
                                            <div class="diagram-container">
                                                <div id="domain-container" class="diagram-col diagram-col-domain"><h5>ุงููุฌุงู</h5>
                                                    <div id="d-item-0" class="diagram-item">ูค</div>
                                                    <div id="d-item-1" class="diagram-item">-ูข</div>
                                                    <div id="d-item-2" class="diagram-item">ูข</div>
                                                    <div id="d-item-3" class="diagram-item">ู</div>
                                                </div>
                                                <div id="range-container" class="diagram-col diagram-col-range"><h5>ุงููุฏู</h5>
                                                    <div id="r-item-0" class="diagram-item">ูฃ</div>
                                                    <div id="r-item-1" class="diagram-item">-ูก</div>
                                                    <div id="r-item-2" class="diagram-item">-ูค</div>
                                                </div>
                                                <svg class="diagram-svg" id="arrow-svg-1"></svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="steps-container space-y-4 min-h-[80px] mt-4">
                                    <div class="step-interactive p-3 bg-blue-50 rounded-md border-r-4 border-blue-500">
                                        <p><span class="font-bold">ุงูุฎุทูุฉ ูก:</span> ุงูุฒูุฌ ุงููุฑุชุจ ุงูุฃูู ูู <span class="math-eq">(ูค, ูฃ)</span>. ููุถุญ ูููุชู ูู ุงูุฌุฏููุ ููุฑุณู ุงูููุทุฉุ ููุตู ุงูุณูู ุจูู ูููุชู ุงููุฌุงู ูุงููุฏู.</p>
                                    </div>
                                    <div class="step-interactive p-3 bg-blue-50 rounded-md border-r-4 border-blue-500">
                                        <p><span class="font-bold">ุงูุฎุทูุฉ ูข:</span> ุงูุฒูุฌ ุงููุฑุชุจ ุงูุชุงูู ูู <span class="math-eq">(-ูข, -ูก)</span>. ููุฑุฑ ููุณ ุงูุนูููุฉ.</p>
                                    </div>
                                    <div class="step-interactive p-3 bg-blue-50 rounded-md border-r-4 border-blue-500">
                                        <p><span class="font-bold">ุงูุฎุทูุฉ ูฃ:</span> ุงูุฒูุฌ ุงููุฑุชุจ ุงูุชุงูู ูู <span class="math-eq">(ูข, -ูค)</span>. ูุงุญุธ ุฃู ุงููููุฉ -ูค ููุฌูุฏุฉ ูุณุจูุงู ูู ุงููุฏู.</p>
                                    </div>
                                    <div class="step-interactive p-3 bg-blue-50 rounded-md border-r-4 border-blue-500">
                                        <p><span class="font-bold">ุงูุฎุทูุฉ ูค:</span> ุงูุฒูุฌ ุงููุฑุชุจ ุงูุฃุฎูุฑ ูู <span class="math-eq">(ู, -ูค)</span>. ุณูู ุขุฎุฑ ุณููุทูู ุฅูู ููุณ ุงููููุฉ -ูค ูู ุงููุฏู.</p>
                                    </div>
                                    <div class="step-interactive p-4 bg-blue-100 rounded-lg step-box border-blue-600">
                                        <h4 class="font-bold">ุชุญุฏูุฏ ุงููุฌุงู</h4>
                                        <p>ุงููุฌุงู ูู ูุฌููุนุฉ ูู ุงูุฅุญุฏุงุซูุงุช ุงูุณูููุฉ (ููู ุณ). ูุงุญุธ ููู ุชู ุชูููููุง ูู ุงูุชูุซููุงุช ุงูุซูุงุซุฉ.</p>
                                    </div>
                                     <div class="step-interactive p-4 bg-green-100 rounded-lg step-box border-green-600">
                                        <h4 class="font-bold">ุชุญุฏูุฏ ุงููุฏู</h4>
                                        <p>ุงููุฏู ูู ูุฌููุนุฉ ูู ุงูุฅุญุฏุงุซูุงุช ุงูุตุงุฏูุฉ (ููู ุต). ูุงุญุธ ููู ุชู ุชูููููุง ุฃูุถุงู.</p>
                                    </div>
                                    <div class="step-interactive p-4 bg-gray-100 rounded-lg step-box border-gray-600">
                                        <h4 class="font-bold">ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ</h4>
                                        <p>ุงููุฌุงู ูู: <span class="math-eq">{ูค, -ูข, ูข, ู}</span><br>ุงููุฏู ูู: <span class="math-eq">{ูฃ, -ูก, -ูค}</span></p>
                                    </div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="1" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                    <div>
                                        <button data-example="1" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                        <button data-example="1" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                    </div>
                                </div>
                            </div>

                            <!-- ุงูุชุฏุฑูุจ ุงูุชูุงุนูู ุงูุฌุฏูุฏ -->
                            <div class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4">ุชุฏุฑูุจ ุชูุงุนูู: ุชูุซูู ุงูููุงุท ูู ุงููุณุชูู ุงูุฅุญุฏุงุซู</p>
                                <div class="flex flex-col lg:flex-row gap-8">
                                    <!-- Left Column: Canvas -->
                                    <div class="lg:w-2/3 w-full">
                                        <div class="relative w-full aspect-square max-w-xl mx-auto bg-white border-2 border-blue-200 rounded-lg shadow-inner overflow-hidden">
                                            <canvas id="coordinateCanvas"></canvas>
                                        </div>
                                    </div>
                                    <!-- Right Column: Title and Controls -->
                                    <div class="lg:w-1/3 w-full flex flex-col justify-center">
                                        <div class="text-center lg:text-right mb-6">
                                            <h3 class="text-2xl font-bold text-gray-800">ุฌุฑุจ ุจููุณู!</h3>
                                            <p class="text-gray-600 mt-2">ุงุณุชุฎุฏู ุงูุฃุฒุฑุงุฑ ูุชุญุฏูุฏ ุฅุญุฏุงุซูุงุช ุงูููุทุฉุ ุซู ุดุงูุฏ ููู ูุชู ุชูุซูููุง.</p>
                                        </div>
                                        <!-- Controls for input and animation -->
                                        <div id="controls" class="flex flex-col items-center lg:items-stretch gap-4">
                                            <!-- Custom Number Control for X -->
                                            <div class="flex items-center justify-between gap-2 w-full max-w-xs">
                                                <label class="text-xl font-bold text-blue-600">ุณ:</label>
                                                <div class="flex items-center bg-gray-100 rounded-lg p-1 shadow-inner">
                                                    <button data-target="x" data-action="decrease" class="w-10 h-10 text-2xl font-bold text-gray-700 bg-gray-200 rounded hover:bg-gray-300 active:bg-gray-400 transition-colors">โ</button>
                                                    <span id="x-display" class="number-control-display text-center text-2xl font-semibold text-blue-800 px-2"></span>
                                                    <button data-target="x" data-action="increase" class="w-10 h-10 text-2xl font-bold text-gray-700 bg-gray-200 rounded hover:bg-gray-300 active:bg-gray-400 transition-colors">+</button>
                                                </div>
                                                <input type="hidden" id="x-value" value="-4">
                                            </div>
                                            <!-- Custom Number Control for Y -->
                                            <div class="flex items-center justify-between gap-2 w-full max-w-xs">
                                                <label class="text-xl font-bold text-red-600">ุต:</label>
                                                <div class="flex items-center bg-gray-100 rounded-lg p-1 shadow-inner">
                                                    <button data-target="y" data-action="decrease" class="w-10 h-10 text-2xl font-bold text-gray-700 bg-gray-200 rounded hover:bg-gray-300 active:bg-gray-400 transition-colors">โ</button>
                                                    <span id="y-display" class="number-control-display text-center text-2xl font-semibold text-red-800 px-2"></span>
                                                    <button data-target="y" data-action="increase" class="w-10 h-10 text-2xl font-bold text-gray-700 bg-gray-200 rounded hover:bg-gray-300 active:bg-gray-400 transition-colors">+</button>
                                                </div>
                                                <input type="hidden" id="y-value" value="-3">
                                            </div>
                                            <button id="plot-button" class="w-full max-w-xs bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 active:bg-indigo-800 transition-transform transform active:scale-95 shadow-md mt-6">
                                                ุชูุซูู ุงูููุทุฉ
                                            </button>
                                            <!-- Message box to show animation status -->
                                            <div id="message-box" class="mt-4 text-center text-xl font-semibold text-gray-700 h-8 transition-all flex justify-center items-center"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ุงููุซุงู ุงูุซุงูู -->
                            <div id="interactive-container-2" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4">ูุซุงู ูข: ุชุญุฏูุฏ ุงููุชุบูุฑ ุงููุณุชูู ูุงููุชุบูุฑ ุงูุชุงุจุน</p>
                                <div class="space-y-6">
                                    <!-- ุงููุณุฃูุฉ ุฃ -->
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="mb-2"><span class="font-bold text-xl text-blue-700 ml-2">ุฃ)</span> ูู ููุฑุฌุงู ุฑูุงุถูุ ูุณุฌู ูุดุงุฑู ุนุฏุฏ ุงููููููุชุฑุงุช ุงูุชู ููุทุนูุง ููููุฉ ุงูุณูุงุฆู ุงูุชู ูุญุชุงุฌูุง.</p>
                                        <div class="step-interactive p-3 bg-green-100 rounded-md border-r-4 border-green-500">
                                            <p><span class="font-bold">ุงูุญู:</span> ุงููุชุบูุฑ ุงููุณุชูู ูู <span class="vocab-term">ุนุฏุฏ ุงููููููุชุฑุงุช</span>ุ ูุงููุชุบูุฑ ุงูุชุงุจุน ูู <span class="vocab-term">ูููุฉ ุงูุณูุงุฆู</span>.</p>
                                            <p class="text-sm mt-1"><span class="font-bold">ุชูุถูุญ:</span> ูููุฉ ุงูุณูุงุฆู ุชุนุชูุฏ ุนูู ุงููุณุงูุฉ ุงูููุทูุนุฉ.</p>
                                        </div>
                                    </div>
                                    <!-- ุงููุณุฃูุฉ ุจ -->
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="mb-2"><span class="font-bold text-xl text-blue-700 ml-2">ุจ)</span> ูููุง ุฒุงุฏุช ุณุฑุนุฉ ุงูุณูุงุฑุฉุ ูู ุงูุฒูู ุงููุงุฒู ูููุตูู ุฅูู ุงููุฌูุฉ.</p>
                                        <div class="step-interactive p-3 bg-green-100 rounded-md border-r-4 border-green-500">
                                            <p><span class="font-bold">ุงูุญู:</span> ุงููุชุบูุฑ ุงููุณุชูู ูู <span class="vocab-term">ุณุฑุนุฉ ุงูุณูุงุฑุฉ</span>ุ ูุงููุชุบูุฑ ุงูุชุงุจุน ูู <span class="vocab-term">ุงูุฒูู</span>.</p>
                                            <p class="text-sm mt-1"><span class="font-bold">ุชูุถูุญ:</span> ุงูุฒูู ุงููุงุฒู ูููุตูู ูุนุชูุฏ ุนูู ูุฏู ุณุฑุนุฉ ุงูุณูุงุฑุฉ.</p>
                                        </div>
                                    </div>
                                    <!-- ุงููุณุฃูุฉ ุฌ -->
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="mb-2"><span class="font-bold text-xl text-blue-700 ml-2">ุฌ)</span> ูุนุชูุฏ ุงููุจูุบ ุงูุฐู ูุฏูุนู ุงููุดุชุฑู ุนูู ุนุฏุฏ ูุทุน ุงูุญููู ุงูุชู ูุดุชุฑููุง.</p>
                                        <div class="step-interactive p-3 bg-green-100 rounded-md border-r-4 border-green-500">
                                            <p><span class="font-bold">ุงูุญู:</span> ุงููุชุบูุฑ ุงููุณุชูู ูู <span class="vocab-term">ุนุฏุฏ ูุทุน ุงูุญููู</span>ุ ูุงููุชุบูุฑ ุงูุชุงุจุน ูู <span class="vocab-term">ุงููุจูุบ ุงููุฏููุน</span>.</p>
                                            <p class="text-sm mt-1"><span class="font-bold">ุชูุถูุญ:</span> ุงููุจูุบ ุงูุฅุฌูุงูู ูุนุชูุฏ ุนูู ุนุฏุฏ ุงููุทุน ุงููุดุชุฑุงุฉ.</p>
                                        </div>
                                    </div>
                                </div>
                                 <div class="flex justify-between mt-6">
                                    <button data-example="2" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                    <div>
                                        <button data-example="2" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                        <button data-example="2" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                    </div>
                                </div>
                            </div>
                             <!-- ุงููุซุงู ุงูุซุงูุซ: ุชุญููู ุงูุฑุณู ุงูุจูุงูู -->
                            <div id="interactive-container-3" class="p-4 bg-white rounded-lg shadow">
                                <p class="text-lg font-semibold mb-4">ูุซุงู ูฃ: ุชุญููู ุงูุชูุซูู ุงูุจูุงูู</p>
                                <div class="grid md:grid-cols-2 gap-6 items-center">
                                    <!-- Graph SVG -->
                                    <div class="w-full max-w-sm mx-auto">
                                        <svg viewBox="0 0 100 100" class="w-full h-auto bg-white border rounded">
                                            <defs>
                                                <marker id="arrowhead-axis" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="4" markerHeight="4" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#374151"></path></marker>
                                            </defs>
                                            <!-- Axes -->
                                            <line x1="10" y1="90" x2="90" y2="90" stroke="#374151" stroke-width="1" marker-end="url(#arrowhead-axis)"></line>
                                            <line x1="10" y1="90" x2="10" y2="10" stroke="#374151" stroke-width="1" marker-end="url(#arrowhead-axis)"></line>
                                            <text x="50" y="98" font-size="5" text-anchor="middle" font-family="Cairo, sans-serif">ุงูุฒูู</text>
                                            <text x="4" y="50" font-size="5" transform="rotate(-90, 4, 50)" text-anchor="middle" font-family="Cairo, sans-serif">ุงููุณุงูุฉ</text>
                                            
                                            <!-- Graph Segments -->
                                            <path id="seg1" class="graph-segment" d="M 10 90 L 40 30" />
                                            <path id="seg2" class="graph-segment" d="M 40 30 L 60 30" />
                                            <path id="seg3" class="graph-segment" d="M 60 30 L 90 10" />
                                        </svg>
                                    </div>
                                    <!-- Explanations -->
                                    <div class="min-h-[150px] space-y-4">
                                         <div class="interactive-placeholder text-center text-gray-500 p-4"><p>ุงุถุบุท "ุงูุชุงูู" ูุชุญููู ุงูุฑุณู ุงูุจูุงูู</p></div>
                                         <div class="step-interactive explanation-box p-3 bg-gray-50 rounded-md border-r-4 border-gray-400">
                                             <h4 class="font-bold">ุงูุฌุฒุก ุงูุฃูู:</h4>
                                             <p>ุชุฒุฏุงุฏ ุงููุณุงูุฉ ุจุงุฒุฏูุงุฏ ุงูุฒููุ ููุง ูุนูู ุฃู ุณุนุฏูุง ูุงู ูุจุชุนุฏ ุนู ููุทุฉ ุงูุจุฏุงูุฉ (ุฑุจูุง ูุงู ูุฑูุจ ุฏุฑุงุฌุชู ุตุนูุฏูุง).</p>
                                         </div>
                                         <div class="step-interactive explanation-box p-3 bg-gray-50 rounded-md border-r-4 border-gray-400">
                                             <h4 class="font-bold">ุงูุฌุฒุก ุงูุซุงูู:</h4>
                                             <p>ุงูุฎุท ุฃูููุ ููุง ูุนูู ุฃู ุงููุณุงูุฉ ูุง ุชุชุบูุฑ. ูุฐุง ููุซู ูุชุฑุฉ ุชููู ุฃู ุงุณุชุฑุงุญุฉ.</p>
                                         </div>
                                         <div class="step-interactive explanation-box p-3 bg-gray-50 rounded-md border-r-4 border-gray-400">
                                             <h4 class="font-bold">ุงูุฌุฒุก ุงูุซุงูุซ:</h4>
                                             <p>ุชุฒุฏุงุฏ ุงููุณุงูุฉ ูุฑุฉ ุฃุฎุฑู ูุน ุงูุฒูู. ูุฐุง ููุซู ุงุณุชุฆูุงู ุงูุญุฑูุฉ ูุงูุงุจุชุนุงุฏุ ูููู ุฑุจูุง ุจุณุฑุนุฉ ูุฎุชููุฉ.</p>
                                         </div>
                                    </div>
                                </div>
                                <div class="flex justify-between mt-6">
                                    <button data-example="3" class="prev-btn bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">ุฑุฌูุน</button>
                                    <div>
                                        <button data-example="3" class="next-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">ุงูุชุงูู</button>
                                        <button data-example="3" class="reset-btn hidden bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">ุฅุนุงุฏุฉ</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="mt-12">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">โ๏ธ ุฑุงุจุนุงู: ุญุงู ุฏูุฑู! ุงุฎุชุจุฑ ูููู</h2>
                        <div id="attempts-counter" class="text-sm font-bold text-gray-600"></div>
                    </div>
                    <form id="quizForm" class="p-6 bg-gray-50 rounded-lg space-y-8"></form>
                    <div id="quiz-results" class="hidden mt-6 p-4 rounded-lg text-center">
                        <h3 class="text-xl font-bold">ูุชูุฌุชู ุงูููุงุฆูุฉ</h3>
                        <p id="quiz-score" class="text-4xl font-bold my-2"></p>
                        <div id="save-status" class="mt-4 text-sm font-semibold"></div>
                        <button id="retake-quiz-btn" class="hidden mt-4 bg-blue-600 text-white font-medium py-2 px-6 rounded-lg hover:bg-blue-700">ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ</button>
                    </div>
                </section>
            </div>
        </main>
        <footer id="main-footer" class="bg-gray-200 py-4"></footer>
    </div>
    <div id="explanationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">๐ก ุดุฑุญ ุงูุฅุฌุงุจุฉ</h3>
                <button id="closeModalBtn" class="p-2 -m-2 rounded-full hover:bg-gray-200">
                    <svg class="h-6 w-6 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="explanationText" class="text-gray-700 max-h-[60vh] overflow-y-auto"></div>
        </div>
    </div>
    <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrf1-At3Pq7i39bGV3F1iD3-b0G-WWyRi5cgpKeQjyn_N5fh2EmGhoyRKUsbLd-F_UJQ/exec";
    const MAX_ATTEMPTS = 3;
    let currentQuestions = []; 
    function getStudentFromStorage() { const studentDataString = localStorage.getItem('currentStudent'); if (studentDataString) { try { return JSON.parse(studentDataString); } catch (e) { return null; } } return null; }
    function buildHeader(studentData, lessonTitle = null) { const headerContainer = document.getElementById('main-header'); if (!headerContainer) return; let titleHtml; if (lessonTitle) { titleHtml = `<div><h2 class="text-sm text-gray-500 leading-tight">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h2><h1 class="text-xl font-bold text-indigo-700 leading-tight">${lessonTitle}</h1></div>`; } else { titleHtml = `<a href="../index.html" target="_top"><h1 class="text-2xl font-bold text-blue-800">ููุตุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</h1></a>`; } let userInfoHtml = ''; if (studentData) { userInfoHtml = `<div class="flex items-center gap-4"><span class="font-semibold">ุฃููุงูุ ${studentData.name}</span><a href="../index.html" target="_top" id="logout-link" class="bg-red-500 text-white py-1 px-3 rounded-lg hover:bg-red-600">ุฎุฑูุฌ</a></div>`; } else { userInfoHtml = `<p class="text-lg text-gray-600">ุฒุงุฆุฑ</p>`; } headerContainer.innerHTML = `<div class="container mx-auto px-6 py-4 flex justify-between items-center">${titleHtml}${userInfoHtml}</div>`; const logoutLink = headerContainer.querySelector('#logout-link'); if(logoutLink) { logoutLink.addEventListener('click', () => { localStorage.removeItem('currentStudent'); }); } }
    function buildFooter() { const footerContainer = document.getElementById('main-footer'); if (!footerContainer) return; footerContainer.innerHTML = `<div class="container mx-auto px-6"><p class="text-center text-gray-600 text-sm">ยฉ 2024 ุฌููุน ุงูุญููู ูุญููุธุฉ | ุชุตููู ูุชุทููุฑ: ุฃ. ุนุจุฏุงูุนุฒูุฒ ุฎุงูุฏ ุงูุนุจูุงู</p></div>`; }
    function initializeQuiz(lessonId, questions, studentData) { currentQuestions = questions; const quizForm = document.getElementById('quizForm'); if (!quizForm) return; if (questions.length === 0) { quizForm.innerHTML = `<p class="text-center text-gray-600">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุชุงุญุฉ ููุฐุง ุงูุฏุฑุณ ุญุงููุงู.</p>`; return; } let attemptsLeft; if (studentData) { const studentLessonData = studentData.lessons?.[lessonId] || { attempts: 0 }; attemptsLeft = MAX_ATTEMPTS - studentLessonData.attempts; } else { attemptsLeft = 1; } const attemptsCounter = document.getElementById('attempts-counter'); if (attemptsCounter) { attemptsCounter.innerHTML = `ุงููุญุงููุงุช ุงููุชุจููุฉ: <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${attemptsLeft}</span>`; } const quizHtml = questions.map((q, index) => { const optionsHTML = q.options.map((opt, optIndex) => `<div><input type="radio" name="q${index}" value="${opt.value}" id="q${index}_opt${optIndex}" class="hidden"><label for="q${index}_opt${optIndex}" class="option-label">${opt.display}</label></div>`).join(''); return `<div class="p-4 border-2 border-gray-200 rounded-lg"><p class="font-bold">${index + 1}. <span class="text-yellow-500">${q.level}</span> ${q.text}</p><div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">${optionsHTML}</div><div id="feedback-q${index}" class="mt-2 text-sm font-bold"></div><button type="button" id="explain-btn-${index}" class="hidden mt-2 text-xs text-blue-600 hover:underline">ุงุนุฑู ููุงุฐุงุ</button></div>`; }).join(''); quizForm.innerHTML = quizHtml + `<button type="submit" id="submit-quiz-btn" class="w-full text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-5 py-3 mt-8">ุชุญูู ูู ุฅุฌุงุจุงุชู</button>`; questions.forEach((q, index) => { const explainBtn = document.getElementById(`explain-btn-${index}`); if(explainBtn) explainBtn.addEventListener('click', () => showExplanation(index)); }); if (attemptsLeft <= 0) { const submitBtn = quizForm.querySelector('#submit-quiz-btn'); submitBtn.disabled = true; submitBtn.textContent = 'ูุง ุชูุฌุฏ ูุญุงููุงุช ูุชุจููุฉ'; submitBtn.classList.add('bg-gray-400', 'hover:bg-gray-400'); } quizForm.onsubmit = (e) => { e.preventDefault(); let score = 0; questions.forEach((q, index) => { const userAnswer = e.target.elements[`q${index}`]?.value; const feedbackEl = document.getElementById(`feedback-q${index}`); if (userAnswer === q.correct) { score++; feedbackEl.textContent = 'โ ุฅุฌุงุจุฉ ุตุญูุญุฉ!'; feedbackEl.className = 'mt-2 text-sm font-bold text-green-600'; } else { feedbackEl.textContent = `โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ.`; feedbackEl.className = 'mt-2 text-sm font-bold text-red-600'; } document.getElementById(`explain-btn-${index}`).classList.remove('hidden');}); const finalGrade = Math.round((score / questions.length) * 10); const resultsDiv = document.getElementById('quiz-results'); resultsDiv.classList.remove('hidden'); document.getElementById('quiz-score').textContent = `${finalGrade} / 10`; if (studentData) { saveGrade(lessonId, finalGrade, studentData.id); if (attemptsLeft - 1 > 0) { document.getElementById('retake-quiz-btn').classList.remove('hidden'); } } else { document.getElementById('save-status').textContent = 'ุชู ุนุฑุถ ูุชูุฌุชู. ุณุฌู ุงูุฏุฎูู ูุญูุธ ุชูุฏูู.'; } e.target.querySelector('#submit-quiz-btn').disabled = true; }; }
    function saveGrade(lessonId, grade, studentId) { if (!studentId) return; const saveStatus = document.getElementById('save-status'); saveStatus.textContent = 'ุฌุงุฑู ุญูุธ ูุชูุฌุชู...'; const url = `${SCRIPT_URL}?action=saveGrade&studentId=${studentId}&lessonId=${lessonId}&grade=${grade}`; fetch(url) .then(res => res.json()) .then(result => { if (result.status === 'success') { saveStatus.textContent = 'โ ุชู ุญูุธ ูุชูุฌุชู ุจูุฌุงุญ! ุณุชุธูุฑ ูู ููุญุฉ ุงูุชุญูู ุนูุฏ ุงูุนูุฏุฉ.'; const studentData = JSON.parse(localStorage.getItem('currentStudent')); if (!studentData.lessons) studentData.lessons = {}; if (!studentData.lessons[lessonId] || studentData.lessons[lessonId].grade < grade) { studentData.lessons[lessonId] = { grade: grade, attempts: (studentData.lessons[lessonId]?.attempts || 0) + 1 }; } else { studentData.lessons[lessonId].attempts++; } localStorage.setItem('currentStudent', JSON.stringify(studentData)); } else { throw new Error(result.message); } }) .catch(error => { saveStatus.textContent = 'โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุฏุฑุฌุฉ.'; console.error("Save Grade Error:", error); }); }
    function showExplanation(questionIndex) { const modal = document.getElementById('explanationModal'); const explanationText = document.getElementById('explanationText'); if(modal && explanationText && currentQuestions[questionIndex] && currentQuestions[questionIndex].explanation) { explanationText.innerHTML = currentQuestions[questionIndex].explanation; modal.classList.remove('hidden'); } }
    function closeModal() { const modal = document.getElementById('explanationModal'); if(modal) modal.classList.add('hidden'); }
    
    const LESSON_ID = 'c2_l1'; 
    function generateQuiz() {
        const questionBank = [
            // Domain and Range Questions
            { type: 'mcq', level: 'โญ', topic: 'domain_range', text: 'ูุง ูู ูุฌุงู ุงูุนูุงูุฉ { (ูก, ูฅ), (ูข, ูจ), (ูฃ, ูก) } ุ', options: [ { display: '{ูก, ูข, ูฃ}', value: 'a' }, { display: '{ูฅ, ูจ, ูก}', value: 'b' }, { display: '{ูก, ูฅ, ูข, ูจ}', value: 'c' }, { display: '{ูก, ูจ, ูก}', value: 'd' } ], correct: 'a', explanation: 'ุงููุฌุงู ูู ูุฌููุนุฉ ูู ุงูุฅุญุฏุงุซูุงุช ุงูุฃููู (ููู ุณ) ูู ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉ.' },
            { type: 'mcq', level: 'โญ', topic: 'domain_range', text: 'ูุง ูู ูุฏู ุงูุนูุงูุฉ { (ุฃ, ูฉ), (ุจ, ูค), (ุฌ, ูฉ) } ุ', options: [ { display: '{ุฃ, ุจ, ุฌ}', value: 'a' }, { display: '{ูฉ, ูค}', value: 'b' }, { display: '{ูฉ, ูค, ูฉ}', value: 'c' }, { display: '{ุฃ, ูฉ, ุจ}', value: 'd' } ], correct: 'b', explanation: 'ุงููุฏู ูู ูุฌููุนุฉ ูู ุงูุฅุญุฏุงุซูุงุช ุงูุซุงููุฉ (ููู ุต) ุจุฏูู ุชูุฑุงุฑ.' },
            { type: 'mcq', level: 'โญโญโญ', topic: 'domain_range', text: 'ูู ุงูุนูุงูุฉ ุต = ุณ + ูฅุ ุฅุฐุง ูุงู ุงููุฌุงู ูู {ู, ูก, ูข}ุ ููุง ูู ุงููุฏูุ', options: [ { display: '{ู, ูก, ูข}', value: 'a' }, { display: '{ูฅ, ูฆ, ูง}', value: 'b' }, { display: '{ู, ูฅ, ูก, ูฆ}', value: 'c' }, { display: '{-ูฅ, -ูค, -ูฃ}', value: 'd' } ], correct: 'b', explanation: 'ูุนูุถ ุจููู ุงููุฌุงู ูู ุงููุนุงุฏูุฉ: ู+ูฅ=ูฅุ ูก+ูฅ=ูฆุ ูข+ูฅ=ูง. ุฅุฐู ุงููุฏู ูู {ูฅ, ูฆ, ูง}.' },
            { type: 'mcq', level: 'โญโญ', topic: 'graph_domain', text: `ูู ุงูุชูุซูู ุงูุจูุงูู ุงูุชุงููุ ูุง ูู <strong>ูุฌุงู</strong> ุงูุนูุงูุฉุ
                <div class="my-2 p-2 bg-white border rounded-lg"><svg viewBox="-50 -50 100 100" class="w-full max-w-xs mx-auto"><g stroke="#e5e7eb" stroke-width="0.5"><line x1="-50" y1="-40" x2="50" y2="-40"></line><line x1="-50" y1="-30" x2="50" y2="-30"></line><line x1="-50" y1="-20" x2="50" y2="-20"></line><line x1="-50" y1="-10" x2="50" y2="-10"></line><line x1="-50" y1="10" x2="50" y2="10"></line><line x1="-50" y1="20" x2="50" y2="20"></line><line x1="-50" y1="30" x2="50" y2="30"></line><line x1="-50" y1="40" x2="50" y2="40"></line><line x1="-40" y1="-50" x2="-40" y2="50"></line><line x1="-30" y1="-50" x2="-30" y2="50"></line><line x1="-20" y1="-50" x2="-20" y2="50"></line><line x1="-10" y1="-50" x2="-10" y2="50"></line><line x1="10" y1="-50" x2="10" y2="50"></line><line x1="20" y1="-50" x2="20" y2="50"></line><line x1="30" y1="-50" x2="30" y2="50"></line><line x1="40" y1="-50" x2="40" y2="50"></line></g><line x1="-50" y1="0" x2="50" y2="0" stroke="#d1d5db" stroke-width="1"/><line x1="0" y1="-50" x2="0" y2="50" stroke="#d1d5db" stroke-width="1"/><circle cx="-10" cy="30" r="3" fill="#ef4444"/><circle cx="10" cy="10" r="3" fill="#ef4444"/><circle cx="20" cy="-30" r="3" fill="#ef4444"/><circle cx="30" cy="-30" r="3" fill="#ef4444"/></svg></div>`,
                options: [ { display: '{-ูก, ูก, ูข, ูฃ}', value: 'a' }, { display: '{-ูฃ, ูก, ูฃ}', value: 'b' }, { display: '{-ูก, ูก, ูข}', value: 'c' }, { display: '{-ูฃ, ูก, ูฃ, ูค}', value: 'd' } ], correct: 'a', explanation: 'ุงููุฌุงู ูู ูุฌููุนุฉ ุงูุฅุญุฏุงุซูุงุช ุงูุณูููุฉ (ุงูุฃูููุฉ) ููููุงุทุ ููู: -ูกุ ูกุ ูขุ ูฃ.' },
            { type: 'mcq', level: 'โญโญ', topic: 'graph_range', text: `ูู ุงูุชูุซูู ุงูุจูุงูู ุงูุชุงููุ ูุง ูู <strong>ูุฏู</strong> ุงูุนูุงูุฉุ
                <div class="my-2 p-2 bg-white border rounded-lg"><svg viewBox="-50 -50 100 100" class="w-full max-w-xs mx-auto"><g stroke="#e5e7eb" stroke-width="0.5"><line x1="-50" y1="-40" x2="50" y2="-40"></line><line x1="-50" y1="-30" x2="50" y2="-30"></line><line x1="-50" y1="-20" x2="50" y2="-20"></line><line x1="-50" y1="-10" x2="50" y2="-10"></line><line x1="-50" y1="10" x2="50" y2="10"></line><line x1="-50" y1="20" x2="50" y2="20"></line><line x1="-50" y1="30" x2="50" y2="30"></line><line x1="-50" y1="40" x2="50" y2="40"></line><line x1="-40" y1="-50" x2="-40" y2="50"></line><line x1="-30" y1="-50" x2="-30" y2="50"></line><line x1="-20" y1="-50" x2="-20" y2="50"></line><line x1="-10" y1="-50" x2="-10" y2="50"></line><line x1="10" y1="-50" x2="10" y2="50"></line><line x1="20" y1="-50" x2="20" y2="50"></line><line x1="30" y1="-50" x2="30" y2="50"></line><line x1="40" y1="-50" x2="40" y2="50"></line></g><line x1="-50" y1="0" x2="50" y2="0" stroke="#d1d5db" stroke-width="1"/><line x1="0" y1="-50" x2="0" y2="50" stroke="#d1d5db" stroke-width="1"/><circle cx="-10" cy="30" r="3" fill="#ef4444"/><circle cx="10" cy="10" r="3" fill="#ef4444"/><circle cx="20" cy="-30" r="3" fill="#ef4444"/><circle cx="30" cy="-30" r="3" fill="#ef4444"/></svg></div>`,
                options: [ { display: '{-ูก, ูก, ูข, ูฃ}', value: 'a' }, { display: '{ูฃ, ูก, -ูฃ}', value: 'b' }, { display: '{-ูฃ, ูก}', value: 'c' }, { display: '{ูฃ, ูก, -ูฃ, -ูก}', value: 'd' } ], correct: 'b', explanation: 'ุงููุฏู ูู ูุฌููุนุฉ ุงูุฅุญุฏุงุซูุงุช ุงูุตุงุฏูุฉ (ุงูุฑุฃุณูุฉ) ููููุงุท ุจุฏูู ุชูุฑุงุฑุ ููู: ูฃุ ูกุ -ูฃ.' },
            
            // Independent/Dependent Variables Questions
            { type: 'mcq', level: 'โญ', topic: 'variables', text: 'ูููุง ูุฑุฃุช ุฃูุซุฑุ ุฒุงุฏุช ููุฑุฏุงุชู. ูุง ูู ุงููุชุบูุฑ ุงูุชุงุจุนุ', options: [ { display: 'ุนุฏุฏ ุงููููุงุช ุงูุชู ุชูุฑุฃูุง', value: 'a' }, { display: 'ุญุฌู ููุฑุฏุงุชู', value: 'b' }, { display: 'ุงูููุช ุงููุณุชุบุฑู ูู ุงููุฑุงุกุฉ', value: 'c' }, { display: 'ููุน ุงููุชุจ', value: 'd' } ], correct: 'b', explanation: 'ุญุฌู ุงูููุฑุฏุงุช ูุนุชูุฏ ุนูู ูููุฉ ุงููุฑุงุกุฉุ ูุฐุง ูู ุงููุชุบูุฑ ุงูุชุงุจุน.' },
            { type: 'mcq', level: 'โญ', topic: 'variables', text: 'ููู ุณุนุฑ ุฌูุงุฒ ุฅููุชุฑููู ูููุง ูุฑ ุงูุฒูู. ูุง ูู ุงููุชุบูุฑ ุงููุณุชููุ', options: [ { display: 'ุณุนุฑ ุงูุฌูุงุฒ', value: 'a' }, { display: 'ุงูุฒูู', value: 'b' }, { display: 'ููุน ุงูุฌูุงุฒ', value: 'c' }, { display: 'ููุงู ุงูุดุฑุงุก', value: 'd' } ], correct: 'b', explanation: 'ุณุนุฑ ุงูุฌูุงุฒ ูุชุบูุฑ ุจูุงุกู ุนูู ูุฑูุฑ ุงูุฒููุ ูุฐุง ุงูุฒูู ูู ุงููุชุบูุฑ ุงููุณุชูู.' },
            { type: 'mcq', level: 'โญโญ', topic: 'variables', text: 'ุชุนุชูุฏ ุชูููุฉ ูุงุชูุฑุฉ ุงูููุฑุจุงุก ุนูู ูููุฉ ุงูุงุณุชููุงู. ุงููุชุบูุฑ ุงููุณุชูู ูู:', options: [ { display: 'ุชูููุฉ ุงููุงุชูุฑุฉ', value: 'a' }, { display: 'ูููุฉ ุงูุงุณุชููุงู', value: 'b' }, { display: 'ุนุฏุฏ ุงูุฃุฌูุฒุฉ ูู ุงูููุฒู', value: 'c' }, { display: 'ููุช ุงูุงุณุชููุงู', value: 'd' } ], correct: 'b', explanation: 'ุงูุชูููุฉ ุชุนุชูุฏ ุนูู ุงูุงุณุชููุงู. ุฅุฐูุ ุงูุงุณุชููุงู ูู ุงููุชุบูุฑ ุงููุณุชูู.' },

            // Graph Analysis Questions
            { type: 'mcq', level: 'โญโญ', topic: 'graph_analysis', text: `ูู ุงูุฑุณู ุงูุจูุงูู (ูุณุงูุฉ-ุฒูู) ูุฑุญูุฉ ุณูุงุฑุฉุ ูุงุฐุง ูุนูู ุงูุฌุฒุก ุงูุฃููู ูู ุงูุฎุทุ
                <div class="my-2 p-2 bg-white border rounded-lg"><svg viewBox="0 0 100 60" class="w-full max-w-xs mx-auto"><line x1="5" y1="55" x2="95" y2="55" stroke="#9ca3af" stroke-width="1"/><line x1="10" y1="5" x2="10" y2="60" stroke="#9ca3af" stroke-width="1"/><path d="M 10 50 L 40 20 L 60 20 L 90 35" stroke="#ef4444" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg></div>`, 
                options: [ { display: 'ุชุชุญุฑู ุจุณุฑุนุฉ ุซุงุจุชุฉ', value: 'a' }, { display: 'ูุชูููุฉ', value: 'b' }, { display: 'ุชุนูุฏ ูููุทุฉ ุงูุจุฏุงูุฉ', value: 'c' }, { display: 'ุชุฒูุฏ ูู ุณุฑุนุชูุง', value: 'd' } ], correct: 'b', explanation: 'ุงูุฎุท ุงูุฃููู ูู ุฑุณู (ุงููุณุงูุฉ-ุงูุฒูู) ูุนูู ุฃู ุงููุณุงูุฉ ูุง ุชุชุบูุฑ ูุน ูุฑูุฑ ุงูุฒููุ ุฃู ุฃู ุงูุฌุณู ูุชููู.' },
            { type: 'mcq', level: 'โญโญ', topic: 'graph_analysis', text: `ูู ุฑุณู ุจูุงูู ููุซู ูุณุชูู ุงููุงุก ูู ุฎุฒุงู ูุน ุงูุฒููุ ูุงุฐุง ูุนูู ุงูุญุฏุงุฑ ุงูุฎุท ูุฃุณููุ
                <div class="my-2 p-2 bg-white border rounded-lg"><svg viewBox="0 0 100 60" class="w-full max-w-xs mx-auto"><line x1="5" y1="55" x2="95" y2="55" stroke="#9ca3af" stroke-width="1"/><line x1="10" y1="5" x2="10" y2="60" stroke="#9ca3af" stroke-width="1"/><path d="M 10 10 L 90 50" stroke="#3b82f6" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg></div>`, 
                options: [ { display: 'ุงูุฎุฒุงู ููุชูุฆ', value: 'a' }, { display: 'ุงููุงุก ูุฎุฑุฌ ูู ุงูุฎุฒุงู', value: 'b' }, { display: 'ูุณุชูู ุงููุงุก ุซุงุจุช', value: 'c' }, { display: 'ุงูุฎุฒุงู ูุงุฑุบ', value: 'd' } ], correct: 'b', explanation: 'ุงูุญุฏุงุฑ ุงูุฎุท ูุฃุณูู ูุนูู ุฃู ูููุฉ ุงููุงุก (ุงููุญูุฑ ุงูุตุงุฏู) ุชูู ูุน ูุฑูุฑ ุงูุฒูู (ุงููุญูุฑ ุงูุณููู).' },
            { type: 'mcq', level: 'โญโญโญ', topic: 'graph_analysis', text: `ููุซู ุฑุณู ุจูุงูู ุฑุญูุฉ ุทุงุฆุฑุฉ ุชูุตูู. ูุงุฐุง ููุซู ุงูุฌุฒุก ุงูุฃูููุ
                <div class="my-2 p-2 bg-white border rounded-lg"><svg viewBox="0 0 100 60" class="w-full max-w-xs mx-auto"><line x1="5" y1="55" x2="95" y2="55" stroke="#9ca3af" stroke-width="1"/><line x1="10" y1="5" x2="10" y2="60" stroke="#9ca3af" stroke-width="1"/><path d="M 10 50 L 30 20 L 70 20 L 90 50" stroke="#8b5cf6" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg></div>`, 
                options: [ { display: 'ุงูุทุงุฆุฑุฉ ุชุชุณุงุฑุน', value: 'a' }, { display: 'ุงูุทุงุฆุฑุฉ ุชุญูู ูู ููุงููุง', value: 'b' }, { display: 'ุงูุทุงุฆุฑุฉ ุชูุจุท', value: 'c' }, { display: 'ุงูุทุงุฆุฑุฉ ุนูู ุงูุฃุฑุถ', value: 'd' } ], correct: 'b', explanation: 'ุงูุฌุฒุก ุงูุฃููู ูุนูู ุฃู ุงูุงุฑุชูุงุน ุซุงุจุช ูุน ูุฑูุฑ ุงูุฒููุ ุฃู ุฃููุง ุชุญูู ูู ููุงููุง (ุฑุจูุง ูุชุณููู ุงูุทูุจ).' },

            // Representations (Arrow Diagram, etc.) Questions
            { 
                type: 'mcq', 
                level: 'โญโญ', 
                topic: 'arrow_diagram', 
                text: `ูุง ูู ูุฌููุนุฉ ุงูุฃุฒูุงุฌ ุงููุฑุชุจุฉ ุงูุชู ููุซููุง ุงููุฎุทุท ุงูุณููู ุงูุชุงููุ
                <svg viewBox="0 0 200 160" class="w-full max-w-xs mx-auto my-2 bg-gray-50 p-2 rounded-lg border">
                    <defs>
                        <marker id="q_arrowhead" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
                            <path d="M 0 0 L 10 5 L 0 10 z" fill="#2563eb"></path>
                        </marker>
                    </defs>
                    <!-- Titles -->
                    <text x="150" y="15" font-family="Cairo, sans-serif" font-weight="bold" text-anchor="middle" fill="#1e40af">ุงููุฌุงู</text>
                    <text x="50" y="15" font-family="Cairo, sans-serif" font-weight="bold" text-anchor="middle" fill="#1e40af">ุงููุฏู</text>
                    
                    <!-- Containers -->
                    <rect x="120" y="20" width="60" height="130" fill="#eff6ff" stroke="#93c5fd" rx="8"></rect>
                    <rect x="20" y="20" width="60" height="130" fill="#f0fdf4" stroke="#86efac" rx="8"></rect>

                    <!-- Domain Numbers -->
                    <text x="150" y="45" text-anchor="middle" font-weight="bold">ูก</text>
                    <text x="150" y="70" text-anchor="middle" font-weight="bold">-ูฃ</text>
                    <text x="150" y="95" text-anchor="middle" font-weight="bold">ูฅ</text>
                    <text x="150" y="120" text-anchor="middle" font-weight="bold">ูง</text>

                    <!-- Range Numbers -->
                    <text x="50" y="55" text-anchor="middle" font-weight="bold">ูข</text>
                    <text x="50" y="85" text-anchor="middle" font-weight="bold">ู</text>
                    <text x="50" y="115" text-anchor="middle" font-weight="bold">-ูฆ</text>
                    
                    <!-- Arrows -->
                    <line x1="120" y1="45" x2="90" y2="55" stroke="#2563eb" stroke-width="1.5" marker-end="url(#q_arrowhead)"></line>
                    <line x1="120" y1="70" x2="90" y2="85" stroke="#2563eb" stroke-width="1.5" marker-end="url(#q_arrowhead)"></line>
                    <line x1="120" y1="95" x2="90" y2="115" stroke="#2563eb" stroke-width="1.5" marker-end="url(#q_arrowhead)"></line>
                    <line x1="120" y1="120" x2="90" y2="85" stroke="#2563eb" stroke-width="1.5" marker-end="url(#q_arrowhead)"></line>
                </svg>`,
                options: [
                    { display: '{(ูก, ูข), (-ูฃ, ู), (ูฅ, -ูฆ), (ูง, ู)}', value: 'a' },
                    { display: '{(ูข, ูก), (ู, -ูฃ), (-ูฆ, ูฅ), (ู, ูง)}', value: 'b' },
                    { display: '{ูก, -ูฃ, ูฅ, ูง}', value: 'c' },
                    { display: '{ูข, ู, -ูฆ}', value: 'd' }
                ],
                correct: 'a',
                explanation: 'ูู ุณูู ููุซู ุฒูุฌุงู ูุฑุชุจุงูุ ุญูุซ ูููู ููุทูู ุงูุณูู (ูู ุงููุฌุงู) ูู ุงูุฅุญุฏุงุซู ุงูุฃููุ ูููุงูุฉ ุงูุณูู (ูู ุงููุฏู) ูู ุงูุฅุญุฏุงุซู ุงูุซุงูู.'
            }
        ];

        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        const questionCount = Math.min(shuffled.length, 5);
        return shuffled.slice(0, questionCount);
    }

    function setupPlottingInteractive() {
        const canvas = document.getElementById('coordinateCanvas');
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        const plotButton = document.getElementById('plot-button');
        const messageBox = document.getElementById('message-box');
        
        const xValueInput = document.getElementById('x-value');
        const yValueInput = document.getElementById('y-value');
        const xDisplay = document.getElementById('x-display');
        const yDisplay = document.getElementById('y-display');

        const AXIS_LIMIT = 7;
        let scale;
        let originX, originY;
        let animationFrameId;
        const animationSpeed = 800; // Slower animation

        function toArabicNumerals(num) {
            const arabicNumerals = ['ู', 'ูก', 'ูข', 'ูฃ', 'ูค', 'ูฅ', 'ูฆ', 'ูง', 'ูจ', 'ูฉ'];
            const absNumStr = Math.abs(num).toString();
            let result = '';
            for (let i = 0; i < absNumStr.length; i++) {
                result += arabicNumerals[parseInt(absNumStr[i])];
            }
            return result;
        }
        
        function drawArabicNumber(num, x, y) {
            const isNegative = num < 0;
            const numStr = toArabicNumerals(num);
            
            if (isNegative) {
                const sign = 'โ';
                const numWidth = ctx.measureText(numStr).width;
                const signWidth = ctx.measureText(sign).width;
                const totalWidth = numWidth + signWidth + 2;
                ctx.fillText(numStr, x - (totalWidth / 2) + (numWidth / 2), y);
                ctx.fillText(sign, x + (totalWidth / 2) - (signWidth / 2), y);
            } else {
                ctx.fillText(numStr, x, y);
            }
        }
        
        function formatArabicHTML(num) {
            const isNegative = num < 0;
            const numStr = toArabicNumerals(num);
            return `<span class="inline-flex flex-row-reverse items-baseline">${numStr}<span class="mr-1">${isNegative ? 'โ' : ''}</span></span>`;
        }

        function updateDisplay() {
            xDisplay.innerHTML = formatArabicHTML(parseInt(xValueInput.value));
            yDisplay.innerHTML = formatArabicHTML(parseInt(yValueInput.value));
        }

        document.querySelectorAll('#controls button[data-action]').forEach(button => {
            button.addEventListener('click', () => {
                const target = button.dataset.target;
                const action = button.dataset.action;
                const input = document.getElementById(`${target}-value`);
                let value = parseInt(input.value);
                
                if (action === 'increase') {
                    if (value < AXIS_LIMIT) value++;
                } else {
                    if (value > -AXIS_LIMIT) value--;
                }
                input.value = value;
                updateDisplay();
            });
        });

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            originX = canvas.width / 2;
            originY = canvas.height / 2;
            scale = Math.min(canvas.width, canvas.height) / ((AXIS_LIMIT + 1) * 2);
            drawGrid();
        }

        function drawGrid() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            ctx.beginPath();
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 1; i <= AXIS_LIMIT; i++) {
                ctx.moveTo(originX + i * scale, 0);
                ctx.lineTo(originX + i * scale, canvas.height);
                ctx.moveTo(originX - i * scale, 0);
                ctx.lineTo(originX - i * scale, canvas.height);
                ctx.moveTo(0, originY + i * scale);
                ctx.lineTo(canvas.width, originY + i * scale);
                ctx.moveTo(0, originY - i * scale);
                ctx.lineTo(canvas.width, originY - i * scale);
            }
            ctx.stroke();

            ctx.beginPath();
            ctx.strokeStyle = '#616161';
            ctx.lineWidth = 2;
            ctx.moveTo(0, originY); ctx.lineTo(canvas.width, originY);
            ctx.moveTo(originX, 0); ctx.lineTo(originX, canvas.height);
            ctx.stroke();

            ctx.fillStyle = '#333';
            const axisLabelFont = `${Math.min(16, scale)}px Cairo`;
            ctx.font = axisLabelFont;
            ctx.fillText('ุณ', canvas.width - scale, originY - scale);
            ctx.fillText('ุต', originX + scale, scale);
        }

        function drawPoint(x, y, color = 'red', size = 5) {
            ctx.beginPath();
            ctx.fillStyle = color;
            ctx.arc(originX + x * scale, originY - y * scale, size, 0, 2 * Math.PI);
            ctx.fill();
        }

        function animate() {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            plotButton.disabled = true;
            plotButton.classList.add('opacity-50', 'cursor-not-allowed');
            messageBox.innerHTML = '';

            const xTarget = parseInt(xValueInput.value) || 0;
            const yTarget = parseInt(yValueInput.value) || 0;
            
            let currentX = 0;
            const stepX = Math.sign(xTarget);
            const durationX = Math.abs(xTarget) * animationSpeed; 
            let startTime = null;

            function animateX(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = timestamp - startTime;
                currentX = Math.min(Math.abs(xTarget), Math.floor(progress / animationSpeed)) * stepX;
                drawGrid();
                messageBox.innerHTML = `ูุชุญุฑู ุนูู ูุญูุฑ ุงูุณููุงุช: ${formatArabicHTML(currentX)}`;
                ctx.beginPath();
                ctx.strokeStyle = '#3b82f6';
                ctx.lineWidth = 3;
                ctx.moveTo(originX, originY);
                ctx.lineTo(originX + currentX * scale, originY);
                ctx.stroke();
                drawPoint(currentX, 0, '#3b82f6', 7);
                if (progress < durationX) {
                    animationFrameId = requestAnimationFrame(animateX);
                } else {
                    startTime = null;
                    if (yTarget !== 0) {
                        animationFrameId = requestAnimationFrame(animateY);
                    } else {
                        drawFinalState(xTarget, yTarget);
                    }
                }
            }
            
            let currentY = 0;
            const stepY = Math.sign(yTarget);
            const durationY = Math.abs(yTarget) * animationSpeed;

            function animateY(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = timestamp - startTime;
                currentY = Math.min(Math.abs(yTarget), Math.floor(progress / animationSpeed)) * stepY;
                drawGrid();
                messageBox.innerHTML = `ูุชุญุฑู ุนูู ูุญูุฑ ุงูุตุงุฏุงุช: ${formatArabicHTML(currentY)}`;
                ctx.beginPath();
                ctx.strokeStyle = '#3b82f6';
                ctx.lineWidth = 3;
                ctx.moveTo(originX, originY);
                ctx.lineTo(originX + xTarget * scale, originY);
                ctx.stroke();
                drawPoint(xTarget, 0, '#3b82f6', 5);
                ctx.beginPath();
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 3;
                ctx.moveTo(originX + xTarget * scale, originY);
                ctx.lineTo(originX + xTarget * scale, originY - currentY * scale);
                ctx.stroke();
                drawPoint(xTarget, currentY, '#ef4444', 7);
                if (progress < durationY) {
                    animationFrameId = requestAnimationFrame(animateY);
                } else {
                    drawFinalState(xTarget, yTarget);
                }
            }
            if (xTarget !== 0) {
                animationFrameId = requestAnimationFrame(animateX);
            } else if (yTarget !== 0) {
                animationFrameId = requestAnimationFrame(animateY);
            } else {
                 drawFinalState(0, 0);
            }
        }

        function drawFinalState(x, y) {
            drawGrid();
            ctx.font = `${Math.min(16, scale * 0.9)}px Cairo`;
            
            // Draw horizontal line and its label
            ctx.beginPath();
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.moveTo(originX, originY);
            ctx.lineTo(originX + x * scale, originY);
            ctx.stroke();
            if (x !== 0) {
                ctx.fillStyle = '#1e3a8a';
                drawArabicNumber(x, originX + (x * scale / 2), originY - scale);
            }

            // Draw vertical line and its label
            ctx.beginPath();
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 3;
            ctx.moveTo(originX + x * scale, originY);
            ctx.lineTo(originX + x * scale, originY - y * scale);
            ctx.stroke();
            if (y !== 0) {
                ctx.fillStyle = '#991b1b';
                drawArabicNumber(y, originX + x * scale + (scale * (x >= 0 ? 1 : -1)), originY - (y * scale / 2));
            }
            
            drawPoint(x, y, '#d946ef', 8);

            messageBox.innerHTML = `ุงูููุทุฉ ุงูููุงุฆูุฉ: <span class="mx-1">(${formatArabicHTML(x)}ุ ${formatArabicHTML(y)})</span>`;
            plotButton.disabled = false;
            plotButton.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        plotButton.addEventListener('click', animate);
        window.addEventListener('resize', resizeCanvas);

        updateDisplay();
        resizeCanvas();
    }

    window.addEventListener('load', () => {
        // Setup for examples 1, 2, 3
        const exampleContainers = document.querySelectorAll('[id^="interactive-container-"]');
        const state = {};

        // --- NEW LOGIC FOR EXAMPLE 1 ---
        const example1Data = [
            { table_x_id: 'td-x-0', table_y_id: 'td-y-0', point_id: 'point-0', domain_id: 'd-item-0', range_id: 'r-item-0', arrow_from: 'd-item-0', arrow_to: 'r-item-0' },
            { table_x_id: 'td-x-1', table_y_id: 'td-y-1', point_id: 'point-1', domain_id: 'd-item-1', range_id: 'r-item-1', arrow_from: 'd-item-1', arrow_to: 'r-item-1' },
            { table_x_id: 'td-x-2', table_y_id: 'td-y-2', point_id: 'point-2', domain_id: 'd-item-2', range_id: 'r-item-2', arrow_from: 'd-item-2', arrow_to: 'r-item-2' },
            { table_x_id: 'td-x-3', table_y_id: 'td-y-3', point_id: 'point-3', domain_id: 'd-item-3', range_id: 'r-item-2', arrow_from: 'd-item-3', arrow_to: 'r-item-2' }
        ];

        function createExample1Arrows() {
            const svg = document.getElementById('arrow-svg-1');
            if (!svg) return;
            svg.innerHTML = `<defs><marker id="arrowhead" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#2563eb"></path></marker></defs>`;
            
            example1Data.forEach((rel, index) => {
                const fromEl = document.getElementById(rel.arrow_from);
                const toEl = document.getElementById(rel.arrow_to);
                if (fromEl && toEl) {
                    const fromRect = fromEl.getBoundingClientRect();
                    const toElRect = toEl.getBoundingClientRect();
                    const svgRect = svg.getBoundingClientRect();

                    const startX = fromRect.left - svgRect.left;
                    const startY = fromRect.top + fromRect.height / 2 - svgRect.top;
                    const endX = toElRect.right - svgRect.left;
                    const endY = toElRect.top + toElRect.height / 2 - svgRect.top;

                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('id', `arrow-${index}`);
                    line.setAttribute('class', 'interactive-element');
                    line.setAttribute('x1', startX);
                    line.setAttribute('y1', startY);
                    
                    const angle = Math.atan2(endY - startY, endX - startX);
                    const adjustedEndX = endX - (Math.cos(angle) * 12); 
                    const adjustedEndY = endY - (Math.sin(angle) * 12);
                    line.setAttribute('x2', adjustedEndX);
                    line.setAttribute('y2', adjustedEndY);

                    line.setAttribute('stroke', '#2563eb');
                    line.setAttribute('stroke-width', '1.5');
                    line.setAttribute('marker-end', 'url(#arrowhead)');
                    
                    svg.appendChild(line);
                }
            });
        }
        
        function updateExample1Step(index, show) {
            if (index < 0 || index >= example1Data.length) return;
            const data = example1Data[index];
            const action = show ? 'remove' : 'add';
            const visibility = show ? 'add' : 'remove';

            document.getElementById(data.table_x_id)?.classList[action]('faded');
            document.getElementById(data.table_y_id)?.classList[action]('faded');
            document.getElementById(data.domain_id)?.classList[action]('faded');
            document.getElementById(data.range_id)?.classList[action]('faded');
            document.getElementById(data.point_id)?.classList[visibility]('visible');
            document.getElementById(`arrow-${index}`)?.classList[visibility]('visible');
        }

        function handleExample1Highlights(index) {
            const domainCells = document.querySelectorAll('#interactive-container-1 .td-x');
            const rangeCells = document.querySelectorAll('#interactive-container-1 .td-y');
            const domainContainer = document.getElementById('domain-container');
            const rangeContainer = document.getElementById('range-container');
            const domainProjections = document.getElementById('domain-projections');
            const rangeProjections = document.getElementById('range-projections');

            // Reset all highlights
            domainCells.forEach(el => el.classList.remove('highlight-domain-bg'));
            rangeCells.forEach(el => el.classList.remove('highlight-range-bg'));
            domainContainer?.classList.remove('highlight-domain-border');
            rangeContainer?.classList.remove('highlight-range-border');
            domainProjections?.classList.remove('visible');
            rangeProjections?.classList.remove('visible');

            if (index === 4) { // "ุชุญุฏูุฏ ุงููุฌุงู" step
                domainCells.forEach(el => el.classList.add('highlight-domain-bg'));
                domainContainer?.classList.add('highlight-domain-border');
                domainProjections?.classList.add('visible');
            } else if (index === 5) { // "ุชุญุฏูุฏ ุงููุฏู" step
                rangeCells.forEach(el => el.classList.add('highlight-range-bg'));
                rangeContainer?.classList.add('highlight-range-border');
                rangeProjections?.classList.add('visible');
            }
        }

        // --- End of New Logic for Example 1 ---

        exampleContainers.forEach(container => {
            const exampleId = container.id.split('-')[2];
            state[exampleId] = {
                currentIndex: -1,
                steps: container.querySelectorAll('.step-interactive'),
                placeholder: container.querySelector('.interactive-placeholder'),
                prevBtn: container.querySelector('.prev-btn'),
                nextBtn: container.querySelector('.next-btn'),
                resetBtn: container.querySelector('.reset-btn')
            };

            const updateButtons = () => {
                const isFirstStep = state[exampleId].currentIndex <= -1;
                const isLastStep = state[exampleId].currentIndex >= state[exampleId].steps.length - 1;
                if(state[exampleId].prevBtn) state[exampleId].prevBtn.disabled = isFirstStep;
                if(state[exampleId].nextBtn) state[exampleId].nextBtn.classList.toggle('hidden', isLastStep);
                if(state[exampleId].resetBtn) state[exampleId].resetBtn.classList.toggle('hidden', !isLastStep);
            };

            const resetExample = () => {
                state[exampleId].currentIndex = -1;
                state[exampleId].steps.forEach(step => step.classList.remove('active'));
                if (state[exampleId].placeholder) {
                    state[exampleId].placeholder.classList.remove('hidden');
                }

                if (exampleId === '1') {
                    example1Data.forEach((data, index) => updateExample1Step(index, false));
                    document.querySelectorAll('#interactive-container-1 .faded').forEach(el => el.classList.remove('faded'));
                    document.querySelectorAll('#interactive-container-1 .styled-table td, #interactive-container-1 .diagram-item').forEach(el => el.classList.add('faded'));
                    handleExample1Highlights(-1);
                }
                
                if (exampleId === '3') {
                    const segments = container.querySelectorAll('.graph-segment');
                    const explanations = container.querySelectorAll('.explanation-box');
                    segments.forEach((seg) => seg.className = 'graph-segment');
                    explanations.forEach((exp) => {
                        const h4 = exp.querySelector('h4');
                        exp.className = 'step-interactive explanation-box p-3 bg-gray-50 rounded-md border-r-4 border-gray-400';
                        h4.className = 'font-bold';
                    });
                }
                updateButtons();
            };

            if(state[exampleId].nextBtn) {
                state[exampleId].nextBtn.addEventListener('click', () => {
                    if (state[exampleId].currentIndex < state[exampleId].steps.length - 1) {
                        if (state[exampleId].placeholder && state[exampleId].currentIndex === -1) {
                            state[exampleId].placeholder.classList.add('hidden');
                        }
                        state[exampleId].currentIndex++;
                        
                        if (exampleId === '1') {
                            if (state[exampleId].currentIndex < example1Data.length) {
                                updateExample1Step(state[exampleId].currentIndex, true);
                            }
                            handleExample1Highlights(state[exampleId].currentIndex);
                        }

                        if (exampleId === '2' || exampleId === '3') {
                            state[exampleId].steps[state[exampleId].currentIndex].classList.add('active');
                        } else { // For example 1
                             state[exampleId].steps.forEach((step, i) => {
                                if (i === state[exampleId].currentIndex) {
                                    step.classList.add('active');
                                } else {
                                    step.classList.remove('active');
                                }
                            });
                        }
                        
                        if (exampleId === '3') {
                            const segments = container.querySelectorAll('.graph-segment');
                            const explanations = container.querySelectorAll('.explanation-box');
                            const colors = [
                                {bg: 'bg-green-50', border: 'border-green-400', text: 'text-green-800', segment: 'active-0'},
                                {bg: 'bg-amber-50', border: 'border-amber-400', text: 'text-amber-800', segment: 'active-1'},
                                {bg: 'bg-purple-50', border: 'border-purple-400', text: 'text-purple-800', segment: 'active-2'}
                            ];
                            const currentIdx = state[exampleId].currentIndex;
                            if(segments[currentIdx] && colors[currentIdx]) {
                                segments[currentIdx].classList.add(colors[currentIdx].segment);
                                const currentExp = explanations[currentIdx];
                                const h4 = currentExp.querySelector('h4');
                                currentExp.classList.remove('bg-gray-50', 'border-gray-400');
                                currentExp.classList.add(colors[currentIdx].bg, colors[currentIdx].border);
                                h4.classList.add(colors[currentIdx].text);
                            }
                        }
                        updateButtons();
                    }
                });
            }

            if(state[exampleId].prevBtn) {
                state[exampleId].prevBtn.addEventListener('click', () => {
                    if (state[exampleId].currentIndex > -1) {
                         if (exampleId === '1') {
                            if (state[exampleId].currentIndex < example1Data.length) {
                                updateExample1Step(state[exampleId].currentIndex, false);
                            }
                            handleExample1Highlights(state[exampleId].currentIndex - 1);
                        }
                        
                        if (exampleId === '2' || exampleId === '3') {
                            state[exampleId].steps[state[exampleId].currentIndex].classList.remove('active');
                        } else { // For example 1
                            state[exampleId].steps[state[exampleId].currentIndex].classList.remove('active');
                        }

                        state[exampleId].currentIndex--;
                        if (exampleId === '1' && state[exampleId].currentIndex > -1) {
                            state[exampleId].steps[state[exampleId].currentIndex].classList.add('active');
                        }
                        
                        if (state[exampleId].placeholder && state[exampleId].currentIndex === -1) {
                            state[exampleId].placeholder.classList.remove('hidden');
                        }
                        updateButtons();
                    }
                });
            }

            if(state[exampleId].resetBtn) {
                state[exampleId].resetBtn.addEventListener('click', resetExample);
            }
            
            resetExample();
        });

        const student = getStudentFromStorage();
        const lessonTitleElement = document.getElementById('lesson-title');
        const lessonTitle = lessonTitleElement ? lessonTitleElement.textContent : null;
        buildHeader(student, lessonTitle);
        buildFooter();
        const questions = generateQuiz();
        initializeQuiz(LESSON_ID, questions, student);
        
        const retakeBtn = document.getElementById('retake-quiz-btn');
        if(retakeBtn) { retakeBtn.addEventListener('click', () => { window.location.reload(); }); }
        
        const closeModalBtn = document.getElementById('closeModalBtn');
        if(closeModalBtn) { closeModalBtn.addEventListener('click', closeModal); }
        
        window.addEventListener('click', (event) => {
            const modal = document.getElementById('explanationModal');
            if (event.target == modal) {
                closeModal();
            }
        });
        
        // Initial setup for example 1 arrows
        createExample1Arrows();
        document.querySelectorAll('#interactive-container-1 .styled-table td, #interactive-container-1 .diagram-item').forEach(el => el.classList.add('faded'));


        // Initialize the new plotting interactive
        setupPlottingInteractive();
    });
    </script>
</body>
</html>
